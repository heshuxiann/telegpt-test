{"version":3,"file":"src_global_actions_ui_calls_ts.681cb284886959ae7770.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOuE;AACO;AAChB;AACQ;AACvB;AACe;AAChB;AACA;AACE;AAI3B;AACkC;AACF;AAI5B;AAC2E;AACnC;;AAEjE;AACA;AACA,MAAMwB,WAAW,GAAG,yoBAAyoB;AAE7pB,IAAIC,YAA0C;AAC9C,IAAIC,YAAsC;AAC1C,IAAIC,MAA2C;;AAE/C;AACA;AACA;AACO,SAASC,yBAAyBA,CAAA,EAAG;EAC1CC,gBAAgB,CAAC,CAAC;EAElB,OAAOC,OAAO,CAACC,GAAG,CAACC,MAAM,CAACC,MAAM,CAACN,MAAM,CAAC,CAACO,GAAG,CAAEC,KAAK,IAAK;IACtD,MAAMC,OAAO,GAAGD,KAAK,CAACE,GAAG;IACzBF,KAAK,CAACE,GAAG,GAAGb,WAAW;IACvBW,KAAK,CAACG,KAAK,GAAG,IAAI;IAClBH,KAAK,CAACI,MAAM,GAAG,MAAM;IACrB,OAAOJ,KAAK,CAACK,IAAI,CAAC,CAAC,CAChBC,IAAI,CAAC,MAAM;MACVN,KAAK,CAACO,KAAK,CAAC,CAAC;MACbP,KAAK,CAACI,MAAM,GAAG,CAAC;MAChBJ,KAAK,CAACQ,WAAW,GAAG,CAAC;MACrBR,KAAK,CAACG,KAAK,GAAG,KAAK;MAEnBtC,6EAAmB,CAAC,MAAM;QACxBmC,KAAK,CAACE,GAAG,GAAGD,OAAO;MACrB,CAAC,CAAC;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,CAAC;AACL;AAEO,SAASP,gBAAgBA,CAAA,EAAG;EACjC,IAAIF,MAAM,EAAE;IACV;EACF;EACA,MAAMiB,SAAS,GAAG,IAAIC,KAAK,CAAC,sBAAsB,CAAC;EACnD,MAAMC,eAAe,GAAG,IAAID,KAAK,CAAC,4BAA4B,CAAC;EAC/DC,eAAe,CAACC,IAAI,GAAG,IAAI;EAC3B,MAAMC,UAAU,GAAG,IAAIH,KAAK,CAAC,uBAAuB,CAAC;EACrD,MAAMI,cAAc,GAAG,IAAIJ,KAAK,CAAC,6BAA6B,CAAC;EAC/D,MAAMK,SAAS,GAAG,IAAIL,KAAK,CAAC,iBAAiB,CAAC;EAC9C,MAAMM,YAAY,GAAG,IAAIN,KAAK,CAAC,oBAAoB,CAAC;EACpD,MAAMO,QAAQ,GAAG,IAAIP,KAAK,CAAC,gBAAgB,CAAC;EAC5C,MAAMQ,aAAa,GAAG,IAAIR,KAAK,CAAC,qBAAqB,CAAC;EACtDQ,aAAa,CAACN,IAAI,GAAG,IAAI;EACzB,MAAMO,YAAY,GAAG,IAAIT,KAAK,CAAC,oBAAoB,CAAC;EACpDS,YAAY,CAACP,IAAI,GAAG,IAAI;EAExBpB,MAAM,GAAG;IACP4B,IAAI,EAAEX,SAAS;IACfY,SAAS,EAAEP,cAAc;IACzBQ,KAAK,EAAET,UAAU;IACjBU,UAAU,EAAEZ,eAAe;IAC3Ba,QAAQ,EAAEN,aAAa;IACvBO,GAAG,EAAER,QAAQ;IACbS,OAAO,EAAEV,YAAY;IACrBW,IAAI,EAAEZ,SAAS;IACfa,OAAO,EAAET;EACX,CAAC;AACH;AAEA,eAAeU,cAAcA,CAAwBC,MAAS,EAAEC,SAAgC,EAAE;EAChG,IAAIlD,sEAAyB,CAACiD,MAAM,CAAC,EAAE,OAAOE,SAAS;EACvD,MAAMC,MAAM,GAAG,MAAM7D,oDAAO,CAAC,cAAc,EAAE;IAC3C8D,IAAI,EAAEH;EACR,CAAC,CAAC;EAEF,IAAI,CAACE,MAAM,EAAE,OAAOD,SAAS;EAE7BF,MAAM,GAAGvD,iDAAS,CAAC,CAAC;EAEpB,MAAM4D,iBAAiB,GAAGjD,kEAAe,CAAC4C,MAAM,EAAEC,SAAS,CAACK,EAAG,CAAC;EAEhEN,MAAM,GAAGrD,iEAAe,CACtBqD,MAAM,EACNC,SAAS,CAACK,EAAE,EACZnE,qDAAI,CAACgE,MAAM,CAACF,SAAS,EAAE,CAAC,iBAAiB,CAAC,CAAC,EAC3CC,SAAS,EACTG,iBAAiB,EAAEE,QAAQ,GAAGL,SAAS,GAAGC,MAAM,CAACF,SAAS,CAACO,iBAC7D,CAAC;EAED9D,iDAAS,CAACsD,MAAM,CAAC;EAEjB,OAAOG,MAAM,CAACF,SAAS;AACzB;AAEA,SAASQ,4BAA4BA,CACnCR,SAAgC,EAAES,UAAmB,EACrD;EACA,OAAOpE,oDAAO,CAAC,4BAA4B,EAAE;IAC3C8D,IAAI,EAAEH,SAAyB;IAC/BU,MAAM,EAAED;EACV,CAAC,CAAC;AACJ;AAEAlE,wDAAgB,CAAC,sBAAsB,EAAE,CAACwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAuB;EACvF,MAAM;IAAEC,KAAK;IAAEC,KAAK,GAAG7E,4EAAe,CAAC;EAAE,CAAC,GAAG2E,OAAO,IAAI,CAAC,CAAC;EAC1D,OAAOjE,+DAAc,CAACoD,MAAM,EAAE;IAC5BgB,kBAAkB,EAAE,OAAO,KAAKH,OAAO,IAAI,CAAC,CAAC,CAAC,GAAGC,KAAK,GAAG,CAAC9D,2DAAc,CAACgD,MAAM,EAAEe,KAAK,CAAC,CAACC;EAC1F,CAAC,EAAED,KAAK,CAAC;AACX,CAAC,CAAC;AAEFvE,wDAAgB,CAAC,iBAAiB,EAAE,OAAOwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAoB;EACrF,MAAM;IAAEI,MAAM;IAAEF,KAAK,GAAG7E,4EAAe,CAAC;EAAE,CAAC,GAAG2E,OAAO;EAErD,MAAMK,IAAI,GAAGrE,uDAAU,CAACmD,MAAM,EAAEiB,MAAM,CAAC;EACvC,IAAI,CAACC,IAAI,EAAE;IACT;EACF;EAEA,MAAMf,MAAM,GAAG,MAAM7D,oDAAO,CAAC,iBAAiB,EAAE;IAC9C6E,IAAI,EAAED;EACR,CAAC,CAAC;EAEF,IAAI,CAACf,MAAM,EAAE;EAEbH,MAAM,GAAGvD,iDAAS,CAAC,CAAC;EACpBuD,MAAM,GAAGrD,iEAAe,CAACqD,MAAM,EAAEG,MAAM,CAACG,EAAE,EAAE;IAC1C,GAAGH,MAAM;IACTc;EACF,CAAC,CAAC;EACFvE,iDAAS,CAACsD,MAAM,CAAC;EAEjBY,OAAO,CAACQ,6BAA6B,CAAC;IAAEd,EAAE,EAAEH,MAAM,CAACG,EAAE;IAAEe,UAAU,EAAElB,MAAM,CAACkB,UAAU;IAAEN;EAAM,CAAC,CAAC;AAChG,CAAC,CAAC;AAEFvE,wDAAgB,CAAC,2BAA2B,EAAE,OAAOwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAoB;EAC/F,MAAM;IAAEE,KAAK,GAAG7E,4EAAe,CAAC;EAAE,CAAC,GAAG2E,OAAO,IAAI,CAAC,CAAC;EACnD,MAAMZ,SAAS,GAAG/C,wEAAqB,CAAC8C,MAAM,CAAC;EAE/C,IAAI,CAACC,SAAS,IAAI,CAACA,SAAS,CAACgB,MAAM,EAAE;IACnC;EACF;EAEA,MAAMC,IAAI,GAAGrE,uDAAU,CAACmD,MAAM,EAAEC,SAAS,CAACgB,MAAM,CAAC;EACjD,IAAI,CAACC,IAAI,EAAE;IACT;EACF;EAEA,MAAMI,iBAAiB,GAAGC,OAAO,CAAChF,yDAAe,CAAC2E,IAAI,CAAC,CAAC;EAExD,IAAIM,UAAU,GAAG1E,+DAAkB,CAACkD,MAAM,EAAEkB,IAAI,CAACZ,EAAE,CAAC,EAAEkB,UAAU;EAChE,IAAIF,iBAAiB,EAAE;IACrBE,UAAU,GAAG,MAAMlF,oDAAO,CAAC,uBAAuB,EAAE;MAClD8D,IAAI,EAAEH,SAAS;MACfwB,aAAa,EAAE;IACjB,CAAC,CAAC;EACJ;EAEA,IAAI,CAACD,UAAU,EAAE;IACf;EACF;EAEAvF,oEAAmB,CAACuF,UAAU,CAAC;EAC/BZ,OAAO,CAACc,gBAAgB,CAAC;IACvBC,OAAO,EAAE;MACPC,GAAG,EAAE;IACP,CAAC;IACDb;EACF,CAAC,CAAC;AACJ,CAAC,CAAC;AAEFvE,wDAAgB,CAAC,qBAAqB,EAAE,OAAOwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAoB;EACzF,MAAM;IAAEgB,QAAQ;IAAEC,UAAU;IAAEf,KAAK,GAAG7E,4EAAe,CAAC;EAAE,CAAC,GAAG2E,OAAO;EAEnE,MAAMK,IAAI,GAAG,MAAM7D,gEAAmB,CAAC2C,MAAM,EAAE6B,QAAQ,CAAC;EAExD,IAAI,CAACX,IAAI,EAAE;IACTN,OAAO,CAACc,gBAAgB,CAAC;MAAEC,OAAO,EAAEvF,+DAAyB,CAAC,iBAAiB,CAAC;MAAE2E;IAAM,CAAC,CAAC;IAC1F;EACF;EAEAf,MAAM,GAAGvD,iDAAS,CAAC,CAAC;EACpB,MAAMuF,IAAI,GAAG,MAAM1E,yDAAY,CAAC0C,MAAM,EAAEY,OAAO,EAAEM,IAAI,CAAC;EAEtD,IAAIc,IAAI,EAAE/B,SAAS,EAAE;IACnBW,OAAO,CAACQ,6BAA6B,CAAC;MACpCd,EAAE,EAAE0B,IAAI,CAAC/B,SAAS,CAACK,EAAE;MACrBe,UAAU,EAAEW,IAAI,CAAC/B,SAAS,CAACoB,UAAU;MACrCS,UAAU;MACVf;IACF,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;AAEFvE,wDAAgB,CAAC,+BAA+B,EAAE,CAACwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAuB;EAChGD,OAAO,CAACqB,0BAA0B,CAAC;IACjCC,MAAM,EAAE,eAAe;IACvBrB,OAAO;IACPE,KAAK,EAAEF,OAAO,CAACE,KAAK,IAAI7E,4EAAe,CAAC;EAC1C,CAAC,CAAC;AACJ,CAAC,CAAC;AAEFM,wDAAgB,CAAC,4BAA4B,EAAE,CAACwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAuB;EAC7FD,OAAO,CAACqB,0BAA0B,CAAC;IACjCC,MAAM,EAAE,YAAY;IACpBrB,OAAO,EAAEX,SAAS;IAClBa,KAAK,EAAEF,OAAO,EAAEE,KAAK,IAAI7E,4EAAe,CAAC;EAC3C,CAAC,CAAC;AACJ,CAAC,CAAC;AAEFM,wDAAgB,CAAC,eAAe,EAAE,OAAOwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAoB;EACnF,MAAM;IACJI,MAAM;IAAEX,EAAE;IAAEe,UAAU;IAAES,UAAU;IAAEf,KAAK,GAAG7E,4EAAe,CAAC;EAC9D,CAAC,GAAG2E,OAAO;EAEX,IAAI,CAAC7E,gFAAmB,EAAE;IACxB4E,OAAO,CAACc,gBAAgB,CAAC;MACvBC,OAAO,EAAE,kDAAkD;MAC3DZ;IACF,CAAC,CAAC;IACF;EACF;EAEA,IAAIf,MAAM,CAACmC,SAAS,EAAE;IACpBvB,OAAO,CAACwB,oBAAoB,CAAC;MAAErB;IAAM,CAAC,CAAC;IACvC;EACF;EAEAsB,kBAAkB,CAAC,CAAC;EAEpBzE,gBAAgB,CAAC,CAAC;EAClBoC,MAAM,GAAGvD,iDAAS,CAAC,CAAC;EACpB,KAAK6F,kCAAkC,CAACtC,MAAM,EAAEY,OAAO,EAAE,IAAI,EAAEG,KAAK,CAAC;EAErE,MAAM;IAAEwB,UAAU,EAAE;MAAEC;IAAkB;EAAE,CAAC,GAAGxC,MAAM;EACpD,IAAIC,SAAS,GAAGK,EAAE,GAAGlD,kEAAe,CAAC4C,MAAM,EAAEM,EAAE,CAAC,GAAGnD,sEAAmB,CAAC6C,MAAM,EAAEiB,MAAO,CAAC;EAEvF,IAAIhB,SAAS,IAAIA,SAAS,CAACK,EAAE,KAAKkC,iBAAiB,EAAE;IACnD5B,OAAO,CAACwB,oBAAoB,CAAC;MAAErB;IAAM,CAAC,CAAC;IACvC;EACF;EAEA,IAAIyB,iBAAiB,EAAE;IACrB,IAAI,gBAAgB,IAAI5B,OAAO,EAAE;MAC/BA,OAAO,CAAC6B,cAAc,CAAC;QACrBC,MAAM,EAAE7B,OAAO;QACfE;MACF,CAAC,CAAC;IACJ;IACA;EACF;EAEA,IAAId,SAAS,IAAIuC,iBAAiB,KAAKvC,SAAS,CAACK,EAAE,EAAE;IACnDM,OAAO,CAACwB,oBAAoB,CAAC;MAAErB;IAAM,CAAC,CAAC;IACvC;EACF;EAEA,IAAI,CAACd,SAAS,KAAK,CAACK,EAAE,IAAI,CAACe,UAAU,CAAC,IAAIJ,MAAM,EAAE;IAChD,MAAMC,IAAI,GAAGrE,uDAAU,CAACmD,MAAM,EAAEiB,MAAM,CAAC;IAEvC,IAAI,CAACC,IAAI,EAAE;IAEX,MAAM5D,yDAAY,CAAC0C,MAAM,EAAEY,OAAO,EAAEM,IAAI,CAAC;IACzClB,MAAM,GAAGvD,iDAAS,CAAC,CAAC;IACpBwD,SAAS,GAAG9C,sEAAmB,CAAC6C,MAAM,EAAEiB,MAAM,CAAC;EACjD,CAAC,MAAM,IAAI,CAAChB,SAAS,IAAIK,EAAE,IAAIe,UAAU,EAAE;IACzCpB,SAAS,GAAG,MAAMF,cAAc,CAACC,MAAM,EAAE;MACvCM,EAAE;MACFe;IACF,CAAC,CAAC;EACJ;EAEA,IAAI,CAACpB,SAAS,EAAE;EAEhBD,MAAM,GAAGvD,iDAAS,CAAC,CAAC;EACpBuD,MAAM,GAAGrD,iEAAe,CACtBqD,MAAM,EACNC,SAAS,CAACK,EAAE,EACZ;IACE,GAAGL,SAAS;IACZ6B;EACF,CAAC,EACD5B,SAAS,EACTD,SAAS,CAACO,iBAAiB,GAAG,CAChC,CAAC;EACDR,MAAM,GAAG;IACP,GAAGA,MAAM;IACTuC,UAAU,EAAE;MACV,GAAGvC,MAAM,CAACuC,UAAU;MACpBC,iBAAiB,EAAEvC,SAAS,CAACK;IAC/B;EACF,CAAC;EAED5D,iDAAS,CAACsD,MAAM,CAAC;EAEjBY,OAAO,CAACwB,oBAAoB,CAAC;IAAEtB,KAAK,EAAE,KAAK;IAAEC;EAAM,CAAC,CAAC;AACvD,CAAC,CAAC;AAEFvE,wDAAgB,CAAC,oBAAoB,EAAE,CAACwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAuB;EACrF,MAAM;IAAE3C;EAAM,CAAC,GAAG2C,OAAO;EAEzB,IAAI,CAACnD,MAAM,GAAGQ,KAAK,CAAC,EAAE;IACpB;EACF;EAEA,MAAMyE,MAAM,GAAGA,CAAA,KAAM;IACnB,IAAIzE,KAAK,KAAK,YAAY,EAAE;MAC1BR,MAAM,CAAC+B,UAAU,CAAChB,KAAK,CAAC,CAAC;IAC3B;IACA,IAAIP,KAAK,KAAK,UAAU,EAAE;MACxBR,MAAM,CAACgC,QAAQ,CAACjB,KAAK,CAAC,CAAC;IACzB;IACA,IAAIP,KAAK,KAAK,SAAS,EAAE;MACvBR,MAAM,CAACoC,OAAO,CAACrB,KAAK,CAAC,CAAC;IACxB;IACApC,0DAAQ,CAACqB,MAAM,CAACQ,KAAK,CAAC,CAAC;EACzB,CAAC;EAEDyE,MAAM,CAAC,CAAC;AACV,CAAC,CAAC;AAEFnG,wDAAgB,CAAC,+BAA+B,EAAGwD,MAAM,IAAuB;EAC9E,MAAMC,SAAS,GAAG/C,wEAAqB,CAAC8C,MAAM,CAAC;EAC/C,IAAI,CAACC,SAAS,EAAE;IACd;EACF;EAEA,KAAKQ,4BAA4B,CAACR,SAAS,EAAEA,SAAS,CAACS,UAAU,CAAC;AACpE,CAAC,CAAC;AAEFlE,wDAAgB,CAAC,6BAA6B,EAAE,CAACwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAuB;EAC9FD,OAAO,CAACqB,0BAA0B,CAAC;IACjCC,MAAM,EAAE,aAAa;IACrBrB,OAAO;IACPE,KAAK,EAAEF,OAAO,CAACE,KAAK,IAAI7E,4EAAe,CAAC;EAC1C,CAAC,CAAC;AACJ,CAAC,CAAC;AAEFM,wDAAgB,CAAC,aAAa,EAAE,CAACwD,MAAM,EAAEY,OAAO,EAAEC,OAAO,KAAuB;EAC9E,MAAM;IAAE+B,MAAM;IAAEC,OAAO;IAAE9B,KAAK,GAAG7E,4EAAe,CAAC;EAAE,CAAC,GAAG2E,OAAO;EAE9D,IAAIb,MAAM,CAACmC,SAAS,EAAE;IACpBvB,OAAO,CAACwB,oBAAoB,CAAC;MAAErB;IAAM,CAAC,CAAC;IACvC;EACF;EAEA,MAAM+B,IAAI,GAAG7F,uDAAU,CAAC+C,MAAM,EAAE4C,MAAM,CAAC;EAEvC,IAAI,CAACE,IAAI,EAAE;IACT;EACF;EAEAlF,gBAAgB,CAAC,CAAC;EAClBoC,MAAM,GAAGvD,iDAAS,CAAC,CAAC;EACpB,KAAK6F,kCAAkC,CAACtC,MAAM,EAAEY,OAAO,EAAEiC,OAAO,EAAE9B,KAAK,CAAC;EAExEf,MAAM,GAAGvD,iDAAS,CAAC,CAAC;EACpBuD,MAAM,GAAG;IACP,GAAGA,MAAM;IACTmC,SAAS,EAAE;MACT7B,EAAE,EAAE,EAAE;MACNyC,KAAK,EAAE,YAAY;MACnBC,aAAa,EAAEJ,MAAM;MACrBC,OAAO;MACPI,OAAO,EAAEjD,MAAM,CAACkD;IAClB;EACF,CAAC;EACDxG,iDAAS,CAACsD,MAAM,CAAC;EAEjBY,OAAO,CAACwB,oBAAoB,CAAC;IAAEtB,KAAK,EAAE,KAAK;IAAEC;EAAM,CAAC,CAAC;AACvD,CAAC,CAAC;AAEF,SAASoC,kBAAkBA,CAAA,EAAG;EAC5B,OAAQ,KAAKC,MAAM,CAACC,YAAY,IAAKD,MAAM,CAASE,kBAAkB,EAAE,CAAC;AAC3E;AAEA,MAAMC,OAAO,GAAIC,GAAiB,IAAK;EACrC,MAAMC,UAAU,GAAGD,GAAG,CAACE,gBAAgB,CAAC,CAAC;EACzC,MAAMC,GAAG,GAAGF,UAAU,CAAC7D,OAAO,CAAC4D,GAAG,CAACI,4BAA4B,CAAC,CAAC,CAAC;EAClEH,UAAU,CAACI,KAAK,CAAC,CAAC;EAClB,OAAO,IAAIC,WAAW,CAAC,CAAC/F,MAAM,CAACgG,MAAM,CAAEJ,GAAG,CAASK,MAAM,CAACC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;IAAEC,OAAO,EAAE;EAAM,CAAC,CAAC,CAAC,CAAC;AACtG,CAAC;AAED,SAAS7B,kBAAkBA,CAAA,EAAG;EAC5B,MAAMmB,GAAG,GAAGL,kBAAkB,CAAC,CAAC;EAChC3F,YAAY,GAAG,IAAIoB,KAAK,CAAC,CAAC;EAC1BnB,YAAY,GAAG+F,GAAG;EAClBhG,YAAY,CAAC2G,SAAS,GAAGZ,OAAO,CAACC,GAAG,CAAC;EACrCnH,0DAAQ,CAACmB,YAAY,CAAC;AACxB;AAEO,SAAS4G,wBAAwBA,CAAA,EAAG;EACzC,OAAO5G,YAAY;AACrB;AAEO,SAAS6G,wBAAwBA,CAAA,EAAG;EACzC,OAAO5G,YAAY;AACrB;AAEO,SAAS6G,2BAA2BA,CAAA,EAAG;EAC5C9G,YAAY,EAAEiB,KAAK,CAAC,CAAC;EACrBhB,YAAY,GAAGyC,SAAS;EACxB1C,YAAY,GAAG0C,SAAS;AAC1B;;AAEA;AACA;AACA;AACO,SAASoC,kCAAkCA,CAChDtC,MAAS,EACTY,OAA8B,EAAEiC,OAAiB,EACjD,GAAG,CAAC9B,KAAK,GAAG7E,4EAAe,CAAC,CAAC,CAAa,EAC1C;EACA,IAAI2G,OAAO,EAAE;IACX0B,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;MAAEC,KAAK,EAAE;IAAK,CAAC,CAAC,CACjDlG,IAAI,CAAEwF,MAAM,IAAK;MAChB,IAAIA,MAAM,CAACW,cAAc,CAAC,CAAC,CAACC,MAAM,KAAK,CAAC,EAAE;QACxChE,OAAO,CAACc,gBAAgB,CAAC;UACvBC,OAAO,EAAEvF,+DAAyB,CAAC,mBAAmB,CAAC;UACvD2E;QACF,CAAC,CAAC;MACJ,CAAC,MAAM;QACLiD,MAAM,CAACa,SAAS,CAAC,CAAC,CAACC,OAAO,CAAEC,KAAK,IAAKA,KAAK,CAACC,IAAI,CAAC,CAAC,CAAC;QACnDC,yBAAyB,CAACjF,MAAM,EAAEY,OAAO,EAAEG,KAAK,CAAC;MACnD;IACF,CAAC,CAAC,CACDmE,KAAK,CAAC,MAAM;MACXtE,OAAO,CAACc,gBAAgB,CAAC;QACvBC,OAAO,EAAEvF,+DAAyB,CAAC,mBAAmB,CAAC;QACvD2E;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;EACN,CAAC,MAAM;IACLkE,yBAAyB,CAACjF,MAAM,EAAEY,OAAO,EAAEG,KAAK,CAAC;EACnD;AACF;AAEA,SAASkE,yBAAyBA,CAChCjF,MAAS,EAAEY,OAA8B,EAAE,GAAG,CAACG,KAAK,GAAG7E,4EAAe,CAAC,CAAC,CAAa,EACrF;EACAqI,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;IAAEU,KAAK,EAAE;EAAK,CAAC,CAAC,CACjD3G,IAAI,CAAEwF,MAAM,IAAK;IAChB,IAAIA,MAAM,CAACC,cAAc,CAAC,CAAC,CAACW,MAAM,KAAK,CAAC,EAAE;MACxChE,OAAO,CAACc,gBAAgB,CAAC;QACvBC,OAAO,EAAEvF,+DAAyB,CAAC,uCAAuC,CAAC;QAC3E2E;MACF,CAAC,CAAC;IACJ,CAAC,MAAM;MACLiD,MAAM,CAACa,SAAS,CAAC,CAAC,CAACC,OAAO,CAAEC,KAAK,IAAKA,KAAK,CAACC,IAAI,CAAC,CAAC,CAAC;IACrD;EACF,CAAC,CAAC,CACDE,KAAK,CAAC,MAAM;IACXtE,OAAO,CAACc,gBAAgB,CAAC;MACvBC,OAAO,EAAEvF,+DAAyB,CAAC,uCAAuC,CAAC;MAC3E2E;IACF,CAAC,CAAC;EACJ,CAAC,CAAC;AACN,C","sources":["webpack://TelyAI/./src/global/actions/ui/calls.ts"],"sourcesContent":["import type { ApiGroupCall } from '../../../api/types';\nimport type { CallSound } from '../../../types';\nimport type { RequiredGlobalActions } from '../../index';\nimport type {\n  ActionReturnType, GlobalState, TabArgs,\n} from '../../types';\n\nimport { requestNextMutation } from '../../../lib/fasterdom/fasterdom';\nimport { ARE_CALLS_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { omit } from '../../../util/iteratees';\nimport * as langProvider from '../../../util/oldLangProvider';\nimport safePlay from '../../../util/safePlay';\nimport { callApi } from '../../../api/gramjs';\nimport { getMainUsername } from '../../helpers';\nimport {\n  addActionHandler, getGlobal,\n  setGlobal,\n} from '../../index';\nimport { updateGroupCall } from '../../reducers/calls';\nimport { updateTabState } from '../../reducers/tabs';\nimport {\n  selectChat, selectChatFullInfo, selectIsCurrentUserFrozen,\n  selectTabState, selectUser,\n} from '../../selectors';\nimport { selectActiveGroupCall, selectChatGroupCall, selectGroupCall } from '../../selectors/calls';\nimport { fetchChatByUsername, loadFullChat } from '../api/chats';\n\n// This is a tiny MP3 file that is silent - retrieved from https://bigsoundbank.com and then modified\n// eslint-disable-next-line @stylistic/max-len\nconst silentSound = 'data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';\n\nlet audioElement: HTMLAudioElement | undefined;\nlet audioContext: AudioContext | undefined;\nlet sounds: Record<CallSound, HTMLAudioElement>;\n\n// Workaround: this function is called once on the first user interaction.\n// After that, it will be possible to play the notification on iOS without problems.\n// https://rosswintle.uk/2019/01/skirting-the-ios-safari-audio-auto-play-policy-for-ui-sound-effects/\nexport function initializeSoundsForSafari() {\n  initializeSounds();\n\n  return Promise.all(Object.values(sounds).map((sound) => {\n    const prevSrc = sound.src;\n    sound.src = silentSound;\n    sound.muted = true;\n    sound.volume = 0.0001;\n    return sound.play()\n      .then(() => {\n        sound.pause();\n        sound.volume = 1;\n        sound.currentTime = 0;\n        sound.muted = false;\n\n        requestNextMutation(() => {\n          sound.src = prevSrc;\n        });\n      });\n  }));\n}\n\nexport function initializeSounds() {\n  if (sounds) {\n    return;\n  }\n  const joinAudio = new Audio('./voicechat_join.mp3');\n  const connectingAudio = new Audio('./voicechat_connecting.mp3');\n  connectingAudio.loop = true;\n  const leaveAudio = new Audio('./voicechat_leave.mp3');\n  const allowTalkAudio = new Audio('./voicechat_onallowtalk.mp3');\n  const busyAudio = new Audio('./call_busy.mp3');\n  const connectAudio = new Audio('./call_connect.mp3');\n  const endAudio = new Audio('./call_end.mp3');\n  const incomingAudio = new Audio('./call_incoming.mp3');\n  incomingAudio.loop = true;\n  const ringingAudio = new Audio('./call_ringing.mp3');\n  ringingAudio.loop = true;\n\n  sounds = {\n    join: joinAudio,\n    allowTalk: allowTalkAudio,\n    leave: leaveAudio,\n    connecting: connectingAudio,\n    incoming: incomingAudio,\n    end: endAudio,\n    connect: connectAudio,\n    busy: busyAudio,\n    ringing: ringingAudio,\n  };\n}\n\nasync function fetchGroupCall<T extends GlobalState>(global: T, groupCall: Partial<ApiGroupCall>) {\n  if (selectIsCurrentUserFrozen(global)) return undefined;\n  const result = await callApi('getGroupCall', {\n    call: groupCall,\n  });\n\n  if (!result) return undefined;\n\n  global = getGlobal();\n\n  const existingGroupCall = selectGroupCall(global, groupCall.id!);\n\n  global = updateGroupCall(\n    global,\n    groupCall.id!,\n    omit(result.groupCall, ['connectionState']),\n    undefined,\n    existingGroupCall?.isLoaded ? undefined : result.groupCall.participantsCount,\n  );\n\n  setGlobal(global);\n\n  return result.groupCall;\n}\n\nfunction requestGroupCallParticipants(\n  groupCall: Partial<ApiGroupCall>, nextOffset?: string,\n) {\n  return callApi('fetchGroupCallParticipants', {\n    call: groupCall as ApiGroupCall,\n    offset: nextOffset,\n  });\n}\n\naddActionHandler('toggleGroupCallPanel', (global, actions, payload): ActionReturnType => {\n  const { force, tabId = getCurrentTabId() } = payload || {};\n  return updateTabState(global, {\n    isCallPanelVisible: 'force' in (payload || {}) ? force : !selectTabState(global, tabId).isCallPanelVisible,\n  }, tabId);\n});\n\naddActionHandler('createGroupCall', async (global, actions, payload): Promise<void> => {\n  const { chatId, tabId = getCurrentTabId() } = payload;\n\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  const result = await callApi('createGroupCall', {\n    peer: chat,\n  });\n\n  if (!result) return;\n\n  global = getGlobal();\n  global = updateGroupCall(global, result.id, {\n    ...result,\n    chatId,\n  });\n  setGlobal(global);\n\n  actions.requestMasterAndJoinGroupCall({ id: result.id, accessHash: result.accessHash, tabId });\n});\n\naddActionHandler('createGroupCallInviteLink', async (global, actions, payload): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload || {};\n  const groupCall = selectActiveGroupCall(global);\n\n  if (!groupCall || !groupCall.chatId) {\n    return;\n  }\n\n  const chat = selectChat(global, groupCall.chatId);\n  if (!chat) {\n    return;\n  }\n\n  const hasPublicUsername = Boolean(getMainUsername(chat));\n\n  let inviteLink = selectChatFullInfo(global, chat.id)?.inviteLink;\n  if (hasPublicUsername) {\n    inviteLink = await callApi('exportGroupCallInvite', {\n      call: groupCall,\n      canSelfUnmute: false,\n    });\n  }\n\n  if (!inviteLink) {\n    return;\n  }\n\n  copyTextToClipboard(inviteLink);\n  actions.showNotification({\n    message: {\n      key: 'LinkCopied',\n    },\n    tabId,\n  });\n});\n\naddActionHandler('joinVoiceChatByLink', async (global, actions, payload): Promise<void> => {\n  const { username, inviteHash, tabId = getCurrentTabId() } = payload;\n\n  const chat = await fetchChatByUsername(global, username);\n\n  if (!chat) {\n    actions.showNotification({ message: langProvider.oldTranslate('NoUsernameFound'), tabId });\n    return;\n  }\n\n  global = getGlobal();\n  const full = await loadFullChat(global, actions, chat);\n\n  if (full?.groupCall) {\n    actions.requestMasterAndJoinGroupCall({\n      id: full.groupCall.id,\n      accessHash: full.groupCall.accessHash,\n      inviteHash,\n      tabId,\n    });\n  }\n});\n\naddActionHandler('requestMasterAndJoinGroupCall', (global, actions, payload): ActionReturnType => {\n  actions.requestMasterAndCallAction({\n    action: 'joinGroupCall',\n    payload,\n    tabId: payload.tabId || getCurrentTabId(),\n  });\n});\n\naddActionHandler('requestMasterAndAcceptCall', (global, actions, payload): ActionReturnType => {\n  actions.requestMasterAndCallAction({\n    action: 'acceptCall',\n    payload: undefined,\n    tabId: payload?.tabId || getCurrentTabId(),\n  });\n});\n\naddActionHandler('joinGroupCall', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, id, accessHash, inviteHash, tabId = getCurrentTabId(),\n  } = payload;\n\n  if (!ARE_CALLS_SUPPORTED) {\n    actions.showNotification({\n      message: 'Sorry, your browser doesn\\'t support group calls',\n      tabId,\n    });\n    return;\n  }\n\n  if (global.phoneCall) {\n    actions.toggleGroupCallPanel({ tabId });\n    return;\n  }\n\n  createAudioElement();\n\n  initializeSounds();\n  global = getGlobal();\n  void checkNavigatorUserMediaPermissions(global, actions, true, tabId);\n\n  const { groupCalls: { activeGroupCallId } } = global;\n  let groupCall = id ? selectGroupCall(global, id) : selectChatGroupCall(global, chatId!);\n\n  if (groupCall && groupCall.id === activeGroupCallId) {\n    actions.toggleGroupCallPanel({ tabId });\n    return;\n  }\n\n  if (activeGroupCallId) {\n    if ('leaveGroupCall' in actions) {\n      actions.leaveGroupCall({\n        rejoin: payload,\n        tabId,\n      });\n    }\n    return;\n  }\n\n  if (groupCall && activeGroupCallId === groupCall.id) {\n    actions.toggleGroupCallPanel({ tabId });\n    return;\n  }\n\n  if (!groupCall && (!id || !accessHash) && chatId) {\n    const chat = selectChat(global, chatId);\n\n    if (!chat) return;\n\n    await loadFullChat(global, actions, chat);\n    global = getGlobal();\n    groupCall = selectChatGroupCall(global, chatId);\n  } else if (!groupCall && id && accessHash) {\n    groupCall = await fetchGroupCall(global, {\n      id,\n      accessHash,\n    });\n  }\n\n  if (!groupCall) return;\n\n  global = getGlobal();\n  global = updateGroupCall(\n    global,\n    groupCall.id,\n    {\n      ...groupCall,\n      inviteHash,\n    },\n    undefined,\n    groupCall.participantsCount + 1,\n  );\n  global = {\n    ...global,\n    groupCalls: {\n      ...global.groupCalls,\n      activeGroupCallId: groupCall.id,\n    },\n  };\n\n  setGlobal(global);\n\n  actions.toggleGroupCallPanel({ force: false, tabId });\n});\n\naddActionHandler('playGroupCallSound', (global, actions, payload): ActionReturnType => {\n  const { sound } = payload;\n\n  if (!sounds?.[sound]) {\n    return;\n  }\n\n  const doPlay = () => {\n    if (sound !== 'connecting') {\n      sounds.connecting.pause();\n    }\n    if (sound !== 'incoming') {\n      sounds.incoming.pause();\n    }\n    if (sound !== 'ringing') {\n      sounds.ringing.pause();\n    }\n    safePlay(sounds[sound]);\n  };\n\n  doPlay();\n});\n\naddActionHandler('loadMoreGroupCallParticipants', (global): ActionReturnType => {\n  const groupCall = selectActiveGroupCall(global);\n  if (!groupCall) {\n    return;\n  }\n\n  void requestGroupCallParticipants(groupCall, groupCall.nextOffset);\n});\n\naddActionHandler('requestMasterAndRequestCall', (global, actions, payload): ActionReturnType => {\n  actions.requestMasterAndCallAction({\n    action: 'requestCall',\n    payload,\n    tabId: payload.tabId || getCurrentTabId(),\n  });\n});\n\naddActionHandler('requestCall', (global, actions, payload): ActionReturnType => {\n  const { userId, isVideo, tabId = getCurrentTabId() } = payload;\n\n  if (global.phoneCall) {\n    actions.toggleGroupCallPanel({ tabId });\n    return;\n  }\n\n  const user = selectUser(global, userId);\n\n  if (!user) {\n    return;\n  }\n\n  initializeSounds();\n  global = getGlobal();\n  void checkNavigatorUserMediaPermissions(global, actions, isVideo, tabId);\n\n  global = getGlobal();\n  global = {\n    ...global,\n    phoneCall: {\n      id: '',\n      state: 'requesting',\n      participantId: userId,\n      isVideo,\n      adminId: global.currentUserId,\n    },\n  };\n  setGlobal(global);\n\n  actions.toggleGroupCallPanel({ force: false, tabId });\n});\n\nfunction createAudioContext() {\n  return (new (window.AudioContext || (window as any).webkitAudioContext)());\n}\n\nconst silence = (ctx: AudioContext) => {\n  const oscillator = ctx.createOscillator();\n  const dst = oscillator.connect(ctx.createMediaStreamDestination());\n  oscillator.start();\n  return new MediaStream([Object.assign((dst as any).stream.getAudioTracks()[0], { enabled: false })]);\n};\n\nfunction createAudioElement() {\n  const ctx = createAudioContext();\n  audioElement = new Audio();\n  audioContext = ctx;\n  audioElement.srcObject = silence(ctx);\n  safePlay(audioElement);\n}\n\nexport function getGroupCallAudioElement() {\n  return audioElement;\n}\n\nexport function getGroupCallAudioContext() {\n  return audioContext;\n}\n\nexport function removeGroupCallAudioElement() {\n  audioElement?.pause();\n  audioContext = undefined;\n  audioElement = undefined;\n}\n\n// This method is used instead of a navigator.permissions.query to determine permission to use a microphone,\n// because Firefox does not have support for 'microphone' and 'camera' permissions\n// https://github.com/mozilla/standards-positions/issues/19#issuecomment-370158947\nexport function checkNavigatorUserMediaPermissions<T extends GlobalState>(\n  global: T,\n  actions: RequiredGlobalActions, isVideo?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (isVideo) {\n    navigator.mediaDevices.getUserMedia({ video: true })\n      .then((stream) => {\n        if (stream.getVideoTracks().length === 0) {\n          actions.showNotification({\n            message: langProvider.oldTranslate('Call.Camera.Error'),\n            tabId,\n          });\n        } else {\n          stream.getTracks().forEach((track) => track.stop());\n          checkMicrophonePermission(global, actions, tabId);\n        }\n      })\n      .catch(() => {\n        actions.showNotification({\n          message: langProvider.oldTranslate('Call.Camera.Error'),\n          tabId,\n        });\n      });\n  } else {\n    checkMicrophonePermission(global, actions, tabId);\n  }\n}\n\nfunction checkMicrophonePermission<T extends GlobalState>(\n  global: T, actions: RequiredGlobalActions, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  navigator.mediaDevices.getUserMedia({ audio: true })\n    .then((stream) => {\n      if (stream.getAudioTracks().length === 0) {\n        actions.showNotification({\n          message: langProvider.oldTranslate('RequestAcces.Error.HaveNotAccess.Call'),\n          tabId,\n        });\n      } else {\n        stream.getTracks().forEach((track) => track.stop());\n      }\n    })\n    .catch(() => {\n      actions.showNotification({\n        message: langProvider.oldTranslate('RequestAcces.Error.HaveNotAccess.Call'),\n        tabId,\n      });\n    });\n}\n"],"names":["requestNextMutation","ARE_CALLS_SUPPORTED","copyTextToClipboard","getCurrentTabId","omit","langProvider","safePlay","callApi","getMainUsername","addActionHandler","getGlobal","setGlobal","updateGroupCall","updateTabState","selectChat","selectChatFullInfo","selectIsCurrentUserFrozen","selectTabState","selectUser","selectActiveGroupCall","selectChatGroupCall","selectGroupCall","fetchChatByUsername","loadFullChat","silentSound","audioElement","audioContext","sounds","initializeSoundsForSafari","initializeSounds","Promise","all","Object","values","map","sound","prevSrc","src","muted","volume","play","then","pause","currentTime","joinAudio","Audio","connectingAudio","loop","leaveAudio","allowTalkAudio","busyAudio","connectAudio","endAudio","incomingAudio","ringingAudio","join","allowTalk","leave","connecting","incoming","end","connect","busy","ringing","fetchGroupCall","global","groupCall","undefined","result","call","existingGroupCall","id","isLoaded","participantsCount","requestGroupCallParticipants","nextOffset","offset","actions","payload","force","tabId","isCallPanelVisible","chatId","chat","peer","requestMasterAndJoinGroupCall","accessHash","hasPublicUsername","Boolean","inviteLink","canSelfUnmute","showNotification","message","key","username","inviteHash","oldTranslate","full","requestMasterAndCallAction","action","phoneCall","toggleGroupCallPanel","createAudioElement","checkNavigatorUserMediaPermissions","groupCalls","activeGroupCallId","leaveGroupCall","rejoin","doPlay","userId","isVideo","user","state","participantId","adminId","currentUserId","createAudioContext","window","AudioContext","webkitAudioContext","silence","ctx","oscillator","createOscillator","dst","createMediaStreamDestination","start","MediaStream","assign","stream","getAudioTracks","enabled","srcObject","getGroupCallAudioElement","getGroupCallAudioContext","removeGroupCallAudioElement","navigator","mediaDevices","getUserMedia","video","getVideoTracks","length","getTracks","forEach","track","stop","checkMicrophonePermission","catch","audio"],"ignoreList":[],"sourceRoot":""}