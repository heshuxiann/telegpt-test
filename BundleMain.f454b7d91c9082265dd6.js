"use strict";
(self["webpackChunkTelyAI"] = self["webpackChunkTelyAI"] || []).push([["BundleMain"],{

/***/ "./src/assets/telegram-logo-filled.svg"
/*!*********************************************!*\
  !*** ./src/assets/telegram-logo-filled.svg ***!
  \*********************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "telegram-logo-filled.67469f6dc5e301e8e0bd.svg";

/***/ },

/***/ "./src/assets/wave_ripple.jpg"
/*!************************************!*\
  !*** ./src/assets/wave_ripple.jpg ***!
  \************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "wave_ripple.5d7d9fa793232bef56c0.jpg";

/***/ },

/***/ "./src/bundles/main.ts"
/*!*****************************!*\
  !*** ./src/bundles/main.ts ***!
  \*****************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   LockScreen: () => (/* reexport safe */ _components_main_LockScreen__WEBPACK_IMPORTED_MODULE_2__["default"]),
/* harmony export */   Main: () => (/* reexport safe */ _components_main_Main__WEBPACK_IMPORTED_MODULE_1__["default"])
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _components_main_Main__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/main/Main */ "./src/components/main/Main.tsx");
/* harmony import */ var _components_main_LockScreen__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../components/main/LockScreen */ "./src/components/main/LockScreen.tsx");



if (_config__WEBPACK_IMPORTED_MODULE_0__.DEBUG) {
  // eslint-disable-next-line no-console
  console.log('>>> FINISH LOAD MAIN BUNDLE');
}

/***/ },

/***/ "./src/components/calls/ActiveCallHeader.async.tsx"
/*!*********************************************************!*\
  !*** ./src/components/calls/ActiveCallHeader.async.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ActiveCallHeaderAsync = props => {
  const {
    isActive
  } = props;
  const ActiveCallHeader = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Calls, 'ActiveCallHeader', !isActive);
  return ActiveCallHeader ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ActiveCallHeader, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ActiveCallHeaderAsync);

/***/ },

/***/ "./src/components/calls/group/GroupCall.async.tsx"
/*!********************************************************!*\
  !*** ./src/components/calls/group/GroupCall.async.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GroupCallAsync = props => {
  const {
    groupCallId
  } = props;
  const GroupCall = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Calls, 'GroupCall', !groupCallId);
  return GroupCall ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GroupCall, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GroupCallAsync);

/***/ },

/***/ "./src/components/calls/phone/PhoneCall.async.tsx"
/*!********************************************************!*\
  !*** ./src/components/calls/phone/PhoneCall.async.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PhoneCallAsync = props => {
  const {
    isActive
  } = props;
  const PhoneCall = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Calls, 'PhoneCall', !isActive);
  return PhoneCall ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PhoneCall, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PhoneCallAsync);

/***/ },

/***/ "./src/components/calls/phone/RatePhoneCallModal.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/calls/phone/RatePhoneCallModal.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const RatePhoneCallModalAsync = props => {
  const {
    isOpen
  } = props;
  const RatePhoneCallModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Calls, 'RatePhoneCallModal', !isOpen);
  return RatePhoneCallModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(RatePhoneCallModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RatePhoneCallModalAsync);

/***/ },

/***/ "./src/components/chatAssistant/ai-chatfolders/active-tag.tsx"
/*!********************************************************************!*\
  !*** ./src/components/chatAssistant/ai-chatfolders/active-tag.tsx ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* eslint-disable */



const ActiveTag = ({
  folderType,
  tags,
  setActiveTag
}) => {
  function onDelete(tag) {
    const currentTag = tags.filter(item => item !== tag);
    setActiveTag(currentTag);
    let global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
    _store__WEBPACK_IMPORTED_MODULE_2__.ChataiStores.general?.set(folderType === "preset" ? _store__WEBPACK_IMPORTED_MODULE_2__.GLOBAL_PRESET_TAG : _store__WEBPACK_IMPORTED_MODULE_2__.GLOBAL_AI_TAG, currentTag);
    global = {
      ...global,
      chatFolders: {
        ...global.chatFolders,
        aiChatFolders: {
          ...global.chatFolders.aiChatFolders,
          [folderType === "preset" ? "activePresetTag" : "activeAITag"]: currentTag
        }
      }
    };
    (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  }
  if ((folderType === "preset" || folderType === "ai") && tags?.length) {
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
      className: "flex flex-row flex-wrap items-center gap-2 px-2 pt-3"
    }, tags.map(item => {
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
        className: "bg-[var(--color-aichatfolders-tag-bg)] h-[27px] leading-[27px] text-[13px] font-[500] text-[var(--color-aichatfolders-tag-text)] rounded-[6px] px-2 relative"
      }, item, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
        className: "absolute top-[-4px] right-[-4px] w-[12px] h-[12px] flex items-center justify-center bg-[var(--color-aichatfolders-tag-bg-active)] rounded-full cursor-pointer hover:opacity-80 border-[1px] border-[var(--color-aichatfolders-tag-border)]",
        onClick: () => onDelete(item)
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(CloseIcon, null)));
    }));
  }
  return null;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__.memo)(ActiveTag));
const CloseIcon = () => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("svg", {
  xmlns: "http://www.w3.org/2000/svg",
  width: 8,
  height: 8,
  fill: "none",
  className: "scale-[0.8]"
}, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("path", {
  fill: "#fff",
  d: "M4 4.7 1.55 7.15a.474.474 0 0 1-.35.137.474.474 0 0 1-.35-.137.474.474 0 0 1-.138-.35c0-.142.046-.258.138-.35L3.3 4 .85 1.55a.474.474 0 0 1-.138-.35A.474.474 0 0 1 1.2.713c.143 0 .26.045.35.137L4 3.3 6.45.85A.474.474 0 0 1 6.8.712a.474.474 0 0 1 .487.487.474.474 0 0 1-.136.35L4.7 4l2.45 2.45a.474.474 0 0 1 .137.35.474.474 0 0 1-.137.35.474.474 0 0 1-.35.138.474.474 0 0 1-.35-.137L4 4.7Z"
}));

/***/ },

/***/ "./src/components/chatAssistant/ai-chatfolders/preset-modal.tsx"
/*!**********************************************************************!*\
  !*** ./src/components/chatAssistant/ai-chatfolders/preset-modal.tsx ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _tag_filter__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./tag-filter */ "./src/components/chatAssistant/ai-chatfolders/tag-filter.ts");
/* eslint-disable */







const PRESET_TAGS = ["Public Chain", "DeFi", "NFT/GameFi", "Wallets & Tools", "DAO", "Layer2", "Security & Audits", "Fundraising & Investment", "Meme", "Launchpad/IDO", "KOL & Community Growth", "Legal & Compliance"];
const PresetTagModal = ({
  folderId,
  activeTag,
  setActiveTag,
  isOpen,
  onClose
}) => {
  const tagList = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_2__.useMemo)(() => {
    return folderId === _config__WEBPACK_IMPORTED_MODULE_0__.PRESET_FOLDER_ID ? PRESET_TAGS : (0,_tag_filter__WEBPACK_IMPORTED_MODULE_6__.getAITags)();
  }, [folderId, _tag_filter__WEBPACK_IMPORTED_MODULE_6__.getAITags]);
  function onClickTag(tag) {
    let currentTag = activeTag;
    if (currentTag.indexOf(tag) >= 0) {
      // remove tag
      currentTag = currentTag.filter(item => item !== tag);
    } else {
      // add tag
      currentTag = [...currentTag, tag];
    }
    setActiveTag(currentTag);
    let global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    _store__WEBPACK_IMPORTED_MODULE_5__.ChataiStores.general?.set(folderId === _config__WEBPACK_IMPORTED_MODULE_0__.PRESET_FOLDER_ID ? _store__WEBPACK_IMPORTED_MODULE_5__.GLOBAL_PRESET_TAG : _store__WEBPACK_IMPORTED_MODULE_5__.GLOBAL_AI_TAG, currentTag);
    global = {
      ...global,
      chatFolders: {
        ...global.chatFolders,
        aiChatFolders: {
          ...global.chatFolders.aiChatFolders,
          [folderId === _config__WEBPACK_IMPORTED_MODULE_0__.PRESET_FOLDER_ID ? 'activePresetTag' : 'activeAITag']: currentTag
        }
      }
    };
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
    onClose?.();
  }
  if (tagList?.length === 0) {
    return null;
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_2__["default"].createElement(_ui_Modal__WEBPACK_IMPORTED_MODULE_4__["default"], {
    isOpen: isOpen,
    onClose: onClose,
    dialogStyle: "max-width: 400px; max-height: 600px; position: absolute; left: 100px; top: 70px;"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_2__["default"].createElement("div", {
    className: "m-[-10px]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_2__["default"].createElement("div", {
    className: "text-[#676B74] text-[12px] font-[600] mb-2"
  }, folderId === _config__WEBPACK_IMPORTED_MODULE_0__.PRESET_FOLDER_ID ? 'Industry' : 'AI Tags'), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_2__["default"].createElement("div", {
    className: "flex flex-row flex-wrap gap-2 my-2"
  }, tagList.map(tag => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_2__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])("rounded-[6px] px-2 py-2 font-[500] text-[13px] hover:opacity-80 cursor-pointer", activeTag.indexOf(tag) >= 0 ? "bg-[var(--color-aichatfolders-tag-bg-active)] text-[#fff]" : "bg-[var(--color-aichatfolders-tag-bg)] text-[var(--color-aichatfolders-tag-text)]"),
    onClick: () => onClickTag(tag)
  }, tag)))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_2__.memo)(PresetTagModal));

/***/ },

/***/ "./src/components/chatAssistant/assets/ai-chat-folder.png"
/*!****************************************************************!*\
  !*** ./src/components/chatAssistant/assets/ai-chat-folder.png ***!
  \****************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "ai-chat-folder.7c79084d1b6bf14b125c.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/cgat-ai-logo.png"
/*!**************************************************************!*\
  !*** ./src/components/chatAssistant/assets/cgat-ai-logo.png ***!
  \**************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "cgat-ai-logo.7f71c08ed2a48c5fc95b.png";

/***/ },

/***/ "./src/components/chatAssistant/component/FloatingActionButton.scss"
/*!**************************************************************************!*\
  !*** ./src/components/chatAssistant/component/FloatingActionButton.scss ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/FloatingActionButton.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/chatAssistant/component/FloatingActionButton.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _FloatingActionButton_scss__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./FloatingActionButton.scss */ "./src/components/chatAssistant/component/FloatingActionButton.scss");




const FloatingActionButton = ({
  isShown,
  className,
  disabled,
  onClick,
  children
}) => {
  const handleClick = (0,lodash__WEBPACK_IMPORTED_MODULE_1__.debounce)(onClick, 500);
  const buttonClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('FloatingActionButton', 'w-[3.5rem] bg-[var(--color-primary)] h-[3.5rem] rounded-full flex items-center justify-center', isShown && 'revealed', className);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("button", {
    className: buttonClassName,
    disabled: disabled,
    onClick: isShown && !disabled ? handleClick : undefined,
    tabIndex: -1
  }, children);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (FloatingActionButton);

/***/ },

/***/ "./src/components/chatAssistant/component/InputText.scss"
/*!***************************************************************!*\
  !*** ./src/components/chatAssistant/component/InputText.scss ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/InputText.tsx"
/*!**************************************************************!*\
  !*** ./src/components/chatAssistant/component/InputText.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _InputText_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./InputText.scss */ "./src/components/chatAssistant/component/InputText.scss");



const InputText = ({
  ref,
  id,
  className,
  value,
  label,
  error,
  success,
  disabled,
  readOnly,
  placeholder,
  autoComplete,
  type = 'text',
  inputMode,
  maxLength,
  tabIndex,
  teactExperimentControlled,
  onChange,
  onInput,
  onKeyPress,
  onKeyDown,
  onBlur,
  onPaste
}) => {
  const labelText = error || success || label;
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('input-group', value && 'touched', error ? 'error' : success && 'success', disabled && 'disabled', readOnly && 'disabled', labelText && 'with-label', className);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: fullClassName
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("input", {
    ref: ref,
    className: "form-control",
    id: id,
    dir: "auto",
    type: type,
    value: value || '',
    tabIndex: tabIndex,
    placeholder: placeholder,
    maxLength: maxLength,
    autoComplete: autoComplete,
    inputMode: inputMode,
    disabled: disabled,
    readOnly: readOnly,
    onChange: onChange,
    onInput: onInput,
    onKeyPress: onKeyPress,
    onKeyDown: onKeyDown,
    onBlur: onBlur,
    onPaste: onPaste,
    "aria-label": labelText,
    teactExperimentControlled: teactExperimentControlled
  }), labelText && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("label", {
    htmlFor: id
  }, labelText));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (/*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(InputText));

/***/ },

/***/ "./src/components/chatAssistant/component/InviteButton.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/chatAssistant/component/InviteButton.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _InviteButton_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./InviteButton.scss */ "./src/components/chatAssistant/component/InviteButton.scss");
/* harmony import */ var _assets_invite_invite_gift_png__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../assets/invite/invite-gift.png */ "./src/components/chatAssistant/assets/invite/invite-gift.png");




const InviteButton = () => {
  const handleInviteFriendsClick = () => {
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openInviteFriendsModal();
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "invite-button",
    onClick: handleInviteFriendsClick
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[20px] h-[20px]",
    src: _assets_invite_invite_gift_png__WEBPACK_IMPORTED_MODULE_3__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[12px] font-medium"
  }, "Invite"));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (/*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(InviteButton));

/***/ },

/***/ "./src/components/chatAssistant/component/Spinner.scss"
/*!*************************************************************!*\
  !*** ./src/components/chatAssistant/component/Spinner.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/Spinner.tsx"
/*!************************************************************!*\
  !*** ./src/components/chatAssistant/component/Spinner.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _Spinner_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Spinner.scss */ "./src/components/chatAssistant/component/Spinner.scss");



const Spinner = ({
  color = 'blue',
  backgroundColor,
  className
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: classnames__WEBPACK_IMPORTED_MODULE_1___default()('Spinner-GPT', className, color, backgroundColor && 'with-background', backgroundColor && `bg-${backgroundColor}`)
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "Spinner__inner"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Spinner);

/***/ },

/***/ "./src/components/chatAssistant/component/Tab.scss"
/*!*********************************************************!*\
  !*** ./src/components/chatAssistant/component/Tab.scss ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/Tab.tsx"
/*!********************************************************!*\
  !*** ./src/components/chatAssistant/component/Tab.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_forceReflow__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/forceReflow */ "./src/util/forceReflow.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _Tab_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./Tab.scss */ "./src/components/chatAssistant/component/Tab.scss");








const classNames = {
  active: 'Tab--active',
  badgeActive: 'Tab__badge--active'
};
const Tab = ({
  className,
  title,
  isActive,
  badgeCount,
  isBadgeActive,
  previousActiveTab,
  onClick,
  clickArg
}) => {
  const tabRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    // Set initial active state
    if (isActive && previousActiveTab === undefined && tabRef.current) {
      tabRef.current.classList.add(classNames.active);
    }
  }, [isActive, previousActiveTab]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isActive || previousActiveTab === undefined) {
      return;
    }
    const tabEl = tabRef.current;
    const prevTabEl = tabEl.parentElement.children[previousActiveTab];
    if (!prevTabEl) {
      // The number of tabs in the parent component has decreased. It is necessary to add the active tab class name.
      if (isActive && !tabEl.classList.contains(classNames.active)) {
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
          tabEl.classList.add(classNames.active);
        });
      }
      return;
    }
    const platformEl = tabEl.querySelector('.platform');
    const prevPlatformEl = prevTabEl.querySelector('.platform');

    // We move and resize the platform, so it repeats the position and size of the previous one
    const shiftLeft = prevPlatformEl.parentElement.offsetLeft - platformEl.parentElement.offsetLeft;
    const scaleFactor = prevPlatformEl.clientWidth / platformEl.clientWidth;
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      prevPlatformEl.classList.remove('animate');
      platformEl.classList.remove('animate');
      platformEl.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestForcedReflow)(() => {
        (0,_util_forceReflow__WEBPACK_IMPORTED_MODULE_4__["default"])(platformEl);
        return () => {
          platformEl.classList.add('animate');
          platformEl.style.transform = 'none';
          prevTabEl.classList.remove(classNames.active);
          tabEl.classList.add(classNames.active);
        };
      });
    });
  }, [isActive, previousActiveTab]);
  const {
    handleClick,
    handleMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_6__.useFastClick)(e => {
    if (e.type === 'mousedown' && e.button !== _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.MouseButton.Main) {
      return;
    }
    onClick?.(clickArg);
  });
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('Tab', onClick && 'Tab--interactive', className),
    onClick: handleClick,
    onMouseDown: handleMouseDown,
    ref: tabRef
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "Tab_inner"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(title), Boolean(badgeCount) && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('badge', isBadgeActive && classNames.badgeActive)
  }, badgeCount), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("i", {
    className: "platform"
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Tab);

/***/ },

/***/ "./src/components/chatAssistant/component/TabList.scss"
/*!*************************************************************!*\
  !*** ./src/components/chatAssistant/component/TabList.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/TabList.tsx"
/*!************************************************************!*\
  !*** ./src/components/chatAssistant/component/TabList.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _util_animateHorizontalScroll__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/animateHorizontalScroll */ "./src/util/animateHorizontalScroll.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hook_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../hook/usePreviousDeprecated */ "./src/components/chatAssistant/hook/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useHorizontalScroll */ "./src/hooks/useHorizontalScroll.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _Tab__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./Tab */ "./src/components/chatAssistant/component/Tab.tsx");
/* harmony import */ var _TabList_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./TabList.scss */ "./src/components/chatAssistant/component/TabList.scss");









const TAB_SCROLL_THRESHOLD_PX = 16;
// Should match duration from `--slide-transition` CSS variable
const SCROLL_DURATION = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_IOS ? 450 : _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_ANDROID ? 400 : 300;
const TabList = ({
  tabs,
  activeTab,
  onSwitchTab,
  className,
  tabClassName,
  inversion
}) => {
  const containerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const previousActiveTab = (0,_hook_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_4__["default"])(activeTab);
  (0,_hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_5__["default"])(containerRef, undefined, true);

  // Scroll container to place active tab in the center
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const container = containerRef.current;
    const {
      scrollWidth,
      offsetWidth,
      scrollLeft
    } = container;
    if (scrollWidth <= offsetWidth) {
      return;
    }
    const activeTabElement = container.childNodes[activeTab];
    if (!activeTabElement) {
      return;
    }
    const {
      offsetLeft: activeTabOffsetLeft,
      offsetWidth: activeTabOffsetWidth
    } = activeTabElement;
    const newLeft = activeTabOffsetLeft - offsetWidth / 2 + activeTabOffsetWidth / 2;

    // Prevent scrolling by only a couple of pixels, which doesn't look smooth
    if (Math.abs(newLeft - scrollLeft) < TAB_SCROLL_THRESHOLD_PX) {
      return;
    }
    (0,_util_animateHorizontalScroll__WEBPACK_IMPORTED_MODULE_1__["default"])(container, newLeft, SCROLL_DURATION);
  }, [activeTab]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('TabList', 'no-scrollbar', inversion && 'inversion', className),
    ref: containerRef,
    dir: lang.isRtl ? 'rtl' : undefined
  }, tabs.map((tab, i) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_Tab__WEBPACK_IMPORTED_MODULE_7__["default"], {
    key: tab.id,
    title: tab.title,
    isActive: i === activeTab,
    badgeCount: tab.badgeCount,
    isBadgeActive: tab.isBadgeActive,
    previousActiveTab: previousActiveTab,
    onClick: onSwitchTab,
    clickArg: i,
    className: tabClassName
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (/*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(TabList));

/***/ },

/***/ "./src/components/chatAssistant/component/TextArea.tsx"
/*!*************************************************************!*\
  !*** ./src/components/chatAssistant/component/TextArea.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");



const TextArea = ({
  ref,
  id,
  className,
  value,
  label,
  error,
  success,
  disabled,
  readOnly,
  placeholder,
  autoComplete,
  inputMode,
  maxLength,
  maxLengthIndicator,
  tabIndex,
  onChange,
  onInput,
  onKeyPress,
  onKeyDown,
  onBlur,
  onPaste,
  noReplaceNewlines
}) => {
  let textareaRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  if (ref) {
    textareaRef = ref;
  }
  const labelText = error || success || label;
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('input-group', value && 'touched', error ? 'error' : success && 'success', disabled && 'disabled', readOnly && 'disabled', labelText && 'with-label', className);
  const resizeHeight = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(element => {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      element.style.height = '0';
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestForcedReflow)(() => {
        const newHeight = element.scrollHeight;
        return () => {
          element.style.height = `${newHeight}px`;
        };
      });
    });
  }, []);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    const textarea = textareaRef.current;
    if (!textarea) return;
    resizeHeight(textarea);
  }, [resizeHeight]);
  const handleChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    const target = e.currentTarget;
    if (!noReplaceNewlines) {
      const previousSelectionEnd = target.selectionEnd;
      // TDesktop replaces newlines with spaces as well
      target.value = target.value.replace(/\n/g, ' ');
      target.selectionEnd = previousSelectionEnd;
    }
    resizeHeight(target);
    onChange?.(e);
  }, [noReplaceNewlines, onChange, resizeHeight]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: fullClassName
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("textarea", {
    ref: textareaRef,
    className: "form-control",
    id: id,
    dir: "auto",
    value: value || '',
    tabIndex: tabIndex,
    placeholder: placeholder,
    maxLength: maxLength,
    autoComplete: autoComplete,
    inputMode: inputMode,
    disabled: disabled,
    readOnly: readOnly,
    onChange: handleChange,
    onInput: onInput,
    onKeyPress: onKeyPress,
    onKeyDown: onKeyDown,
    onBlur: onBlur,
    onPaste: onPaste,
    "aria-label": labelText
  }), labelText && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("label", {
    htmlFor: id
  }, labelText), maxLengthIndicator && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "max-length-indicator"
  }, maxLengthIndicator));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (/*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(TextArea));

/***/ },

/***/ "./src/components/chatAssistant/component/guidance/guidance-carousel.tsx"
/*!*******************************************************************************!*\
  !*** ./src/components/chatAssistant/component/guidance/guidance-carousel.tsx ***!
  \*******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/carousel/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../icons */ "./src/components/chatAssistant/icons.tsx");
/* harmony import */ var _guidance_module_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./guidance.module.scss */ "./src/components/chatAssistant/component/guidance/guidance.module.scss");
/* eslint-disable no-null/no-null */







const CarouselItem = ({
  className,
  children
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: classnames__WEBPACK_IMPORTED_MODULE_2___default()('guidance-carousel-item', className)
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[40px] h-full w-full flex items-center"
  }, children));
};
const GuidanceCarousel = ({
  handleClose
}) => {
  const carouselRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const handleNextClick = step => {
    carouselRef.current?.goTo(step);
    if (step === 4) {
      handleClose();
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "guidance-bubble"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "absolute top-[10px] right-[10px] cursor-pointer text-[#A89E9E] z-10",
    onClick: handleClose
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_4__.CloseIcon, {
    size: 24
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('guidance-carousel', _guidance_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].guidanceCarouselBg),
    ref: carouselRef
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(CarouselItem, {
    className: "guidance-summary"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col w-2/5  pt-[5%] pb-[12%] text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[45px] font-bold leading-[44px] mb-[20px]"
  }, "Chat Summary"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px]"
  }, "Message Summarization uses AI to extract key points from IM chats and provide regular summaries, helping users stay updated."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "guidance-carousel-next",
    onClick: () => handleNextClick(1)
  }, "Next")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "pt-[20px] pb-[50px] h-full w-3/5"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('h-full w-full', _guidance_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].guidanceSummaryBg)
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(CarouselItem, {
    className: "guidance-translation"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col w-2/5  pt-[5%] pb-[12%] text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[45px] font-bold leading-[44px] mb-[20px]"
  }, "Translation & Grammar Check"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px]"
  }, "Instant Translation: Real-time translation with auto language detection. Error Detection: Spots spelling, grammar, and structure issues."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "guidance-carousel-next",
    onClick: () => handleNextClick(2)
  }, "Next")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "pt-[20px] pb-[50px] h-full w-3/5"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('h-full w-full', _guidance_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].guidanceTranslationBg)
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(CarouselItem, {
    className: "guidance-meeting"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col w-2/5  pt-[5%] pb-[12%] text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[45px] font-bold leading-[44px] mb-[20px]"
  }, "Meeting Scheduler"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px]"
  }, "Automatically detects meeting chats, gathers details, and sends calendar invites\u2014all within the conversation."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "guidance-carousel-next",
    onClick: () => handleNextClick(3)
  }, "Next")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "pt-[20px] pb-[50px] h-full w-3/5"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('h-full w-full', _guidance_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].guidanceMeetingBg)
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(CarouselItem, {
    className: "guidance-actions"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col w-2/5  pt-[5%] pb-[12%] text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[45px] font-bold leading-[44px] mb-[20px]"
  }, "Action Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px]"
  }, "AI picks out tasks and follow-ups from chats in real time\u2014no manual notes needed."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "guidance-carousel-next",
    onClick: () => handleNextClick(4)
  }, "Next")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "pt-[20px] pb-[50px] h-full w-3/5"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('h-full w-full', _guidance_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].guidanceActionsBg)
  })))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GuidanceCarousel);

/***/ },

/***/ "./src/components/chatAssistant/component/guidance/guidance-modal.tsx"
/*!****************************************************************************!*\
  !*** ./src/components/chatAssistant/component/guidance/guidance-modal.tsx ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _utils_telegpt_api__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/telegpt-api */ "./src/components/chatAssistant/utils/telegpt-api.ts");
/* harmony import */ var _guidance_wrapper__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./guidance-wrapper */ "./src/components/chatAssistant/component/guidance/guidance-wrapper.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _guidance_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./guidance.scss */ "./src/components/chatAssistant/component/guidance/guidance.scss");







const GuidanceModal = () => {
  const telegptGuidance = localStorage.getItem('telegpt-guidance') === 'true';
  const [isFirstIn, setIsFirstIn] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!telegptGuidance);
  const checkInvitationStatus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(async () => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const {
      currentUserId
    } = global;
    if (!currentUserId) {
      setTimeout(() => {
        checkInvitationStatus();
      }, 2000);
      return;
    }
    const {
      openInviteCodeModal
    } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
    try {
      // API
      const response = await (0,_utils_telegpt_api__WEBPACK_IMPORTED_MODULE_2__.getMyInvitation)();
      if (response.code === 0) {
        const invitationInfo = response.data;
        // localStorage
        localStorage.setItem('user-invitation', JSON.stringify(invitationInfo));
        // 
        if (!invitationInfo) {
          openInviteCodeModal();
        }
      } else {
        setTimeout(() => {
          checkInvitationStatus();
        }, 20000);
        return;
      }
    } catch (error) {
      // eslint-disable-next-line no-console
      console.error('Failed to check invitation status:', error);
      // API10s
      setTimeout(() => {
        checkInvitationStatus();
      }, 20000);
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isFirstIn) {
      // 
      checkInvitationStatus();
    }
  }, [isFirstIn]);
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(async () => {
    localStorage.setItem('telegpt-guidance', 'true');
    setIsFirstIn(false);

    // 
    await checkInvitationStatus();
  });
  if (!isFirstIn) {
    return undefined;
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Modal__WEBPACK_IMPORTED_MODULE_5__["default"], {
    isOpen: true,
    noBackdropClose: true,
    onClose: handleClose,
    className: "guidance-modal"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_guidance_wrapper__WEBPACK_IMPORTED_MODULE_3__["default"], {
    handleClose: handleClose
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GuidanceModal);

/***/ },

/***/ "./src/components/chatAssistant/component/guidance/guidance-wrapper.tsx"
/*!******************************************************************************!*\
  !*** ./src/components/chatAssistant/component/guidance/guidance-wrapper.tsx ***!
  \******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _injectComponent__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../injectComponent */ "./src/components/chatAssistant/injectComponent.tsx");
/* harmony import */ var _guidance_carousel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./guidance-carousel */ "./src/components/chatAssistant/component/guidance/guidance-carousel.tsx");



const GuidanceWrapper = ({
  handleClose
}) => {
  const containerRef = (0,_injectComponent__WEBPACK_IMPORTED_MODULE_1__.injectComponent)({
    component: _guidance_carousel__WEBPACK_IMPORTED_MODULE_2__["default"],
    props: {
      handleClose
    }
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: containerRef
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GuidanceWrapper);

/***/ },

/***/ "./src/components/chatAssistant/component/guidance/guidance.module.scss"
/*!******************************************************************************!*\
  !*** ./src/components/chatAssistant/component/guidance/guidance.module.scss ***!
  \******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"guidanceCarouselBg":"UNOlA1Av","guidanceSummaryBg":"Jk5spp7T","guidanceTranslationBg":"c3MdsqG2","guidanceMeetingBg":"qxfJ3JIT","guidanceActionsBg":"L_4nPsr4"});

/***/ },

/***/ "./src/components/chatAssistant/component/guidance/guidance.scss"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/component/guidance/guidance.scss ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/upgrade-tip.tsx"
/*!****************************************************************!*\
  !*** ./src/components/chatAssistant/component/upgrade-tip.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _assets_chat_ai_folder_png__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../assets/chat_ai_folder.png */ "./src/assets/chat_ai_folder.png");
/* harmony import */ var _assets_chat_ai_folder_dark_png__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../assets/chat_ai_folder_dark.png */ "./src/assets/chat_ai_folder_dark.png");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");






const UpgradeTip = props => {
  const {
    theme,
    subscriptionType
  } = props;
  const {
    openPayPackageModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "p-[12px] flex flex-row items-center relative gap-3",
    style: `background-image: url(${theme === 'dark' ? _assets_chat_ai_folder_dark_png__WEBPACK_IMPORTED_MODULE_4__ : _assets_chat_ai_folder_png__WEBPACK_IMPORTED_MODULE_3__}); background-size: 100% 100%;`
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_5__,
    alt: "",
    className: "w-[24px] h-[24px]"
  }), subscriptionType && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[var(--color-aichatfolders-tag-text)] text-[12px]"
  }, subscriptionType === 'free' ? 'Unlock more power with TelyAI' : 'Go limitless with Pro.'), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "bg-[var(--color-background)] h-[24px] px-[8px] text-[12px] font-medium text-[var(--color-text)] ml-auto rounded-[12px] leading-[24px] cursor-pointer",
    onClick: () => openPayPackageModal()
  }, "Upgrade"));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    subscriptionInfo
  } = global;
  return {
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTheme)(global),
    subscriptionInfo
  };
})(UpgradeTip)));

/***/ },

/***/ "./src/components/chatAssistant/component/upgrade/UpgradeButton.scss"
/*!***************************************************************************!*\
  !*** ./src/components/chatAssistant/component/upgrade/UpgradeButton.scss ***!
  \***************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/upgrade/UpgradeButton.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/chatAssistant/component/upgrade/UpgradeButton.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _UpgradeButton_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./UpgradeButton.scss */ "./src/components/chatAssistant/component/upgrade/UpgradeButton.scss");



const UpgradeButton = ({
  subscriptionInfo
}) => {
  const handleUpgrade = e => {
    e.preventDefault();
    e.stopPropagation();
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openPayPackageModal();
  };
  const subscriptionType = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    switch (subscriptionInfo?.subscriptionType) {
      case 'basic':
        return 'Basic';
      case 'pro':
        return 'Pro';
      case 'plus':
        return 'Plus';
      default:
        return 'Upgrade';
    }
  }, [subscriptionInfo]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "upgrade-button",
    onClick: handleUpgrade
  }, subscriptionType);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const subscriptionInfo = global.subscriptionInfo;
  return {
    subscriptionInfo
  };
})(UpgradeButton));

/***/ },

/***/ "./src/components/chatAssistant/global-summary/GlobalSummaryWrapper.tsx"
/*!******************************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/GlobalSummaryWrapper.tsx ***!
  \******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _injectComponent__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../injectComponent */ "./src/components/chatAssistant/injectComponent.tsx");
/* harmony import */ var _global_summary__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./global-summary */ "./src/components/chatAssistant/global-summary/global-summary.tsx");



const GlobalSummaryWrapper = () => {
  const containerRef = (0,_injectComponent__WEBPACK_IMPORTED_MODULE_1__.injectComponent)({
    component: _global_summary__WEBPACK_IMPORTED_MODULE_2__["default"]
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex w-full h-full overflow-hidden",
    ref: containerRef
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GlobalSummaryWrapper);

/***/ },

/***/ "./src/components/chatAssistant/global-summary/global-summary.module.scss"
/*!********************************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/global-summary.module.scss ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"globaSummaryBg":"mykZ1IJ0"});

/***/ },

/***/ "./src/components/chatAssistant/global-summary/global-summary.scss"
/*!*************************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/global-summary.scss ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/global-summary/global-summary.tsx"
/*!************************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/global-summary.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _messages_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../messages/types */ "./src/components/chatAssistant/messages/types.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_generateUniqueId__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/generateUniqueId */ "./src/util/generateUniqueId.ts");
/* harmony import */ var _agent_useAgentChat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../agent/useAgentChat */ "./src/components/chatAssistant/agent/useAgentChat.ts");
/* harmony import */ var _hook_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../hook/use-scroll-to-bottom */ "./src/components/chatAssistant/hook/use-scroll-to-bottom.tsx");
/* harmony import */ var _hook_useEventBus__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../hook/useEventBus */ "./src/components/chatAssistant/hook/useEventBus.ts");
/* harmony import */ var _hook_usePerformanceMonitor__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../hook/usePerformanceMonitor */ "./src/components/chatAssistant/hook/usePerformanceMonitor.ts");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../messages */ "./src/components/chatAssistant/messages.tsx");
/* harmony import */ var _multi_input__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../multi-input */ "./src/components/chatAssistant/multi-input.tsx");
/* harmony import */ var _rightPanel_right_panel__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../rightPanel/right-panel */ "./src/components/chatAssistant/rightPanel/right-panel.tsx");
/* harmony import */ var _room_ai_room_ai_utils__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../room-ai/room-ai-utils */ "./src/components/chatAssistant/room-ai/room-ai-utils.ts");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _utils_intro_message_manager__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../utils/intro-message-manager */ "./src/components/chatAssistant/utils/intro-message-manager.ts");
/* harmony import */ var _variables__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _summary_header_actions__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./summary-header-actions */ "./src/components/chatAssistant/global-summary/summary-header-actions.tsx");
/* harmony import */ var _urgent_notification__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./urgent-notification */ "./src/components/chatAssistant/global-summary/urgent-notification.tsx");
/* harmony import */ var _ErrorBoundary__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../ErrorBoundary */ "./src/components/chatAssistant/ErrorBoundary.tsx");
/* harmony import */ var _DrawerContext__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* harmony import */ var _global_summary_scss__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./global-summary.scss */ "./src/components/chatAssistant/global-summary/global-summary.scss");
/* harmony import */ var _global_summary_module_scss__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./global-summary.module.scss */ "./src/components/chatAssistant/global-summary/global-summary.module.scss");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* eslint-disable no-null/no-null */

























const GlobalSummary = () => {
  // 
  (0,_hook_usePerformanceMonitor__WEBPACK_IMPORTED_MODULE_9__.usePerformanceMonitor)('ChatAssistant/GlobalSummary', {
    logThreshold: 30
  });
  const {
    isOpen
  } = (0,_DrawerContext__WEBPACK_IMPORTED_MODULE_20__.useDrawerStore)();
  const [notificationMessage, setNotificationMessage] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
  const [summaryMessages, setSummaryMessages] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [viewMessages, setViewMessages] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [pageInfo, setPageInfo] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({
    lastTime: undefined,
    hasMore: true
  });
  const {
    scrollToBottom,
    scrollLocked,
    isScrollLock
  } = (0,_hook_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_7__.useScrollToBottom)();

  // 
  const storeMessagesToDB = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(messagesToStore => {
    const messagesArray = Array.isArray(messagesToStore) ? messagesToStore : [messagesToStore];
    messagesArray.forEach(msg => {
      _store__WEBPACK_IMPORTED_MODULE_14__.ChataiStores.summary?.storeMessage(msg);
    });
  }, []);
  const {
    messages,
    setMessages,
    append,
    stop,
    status,
    currentPhase
  } = (0,_agent_useAgentChat__WEBPACK_IMPORTED_MODULE_6__.useAgentChat)({
    chatId: _variables__WEBPACK_IMPORTED_MODULE_16__.GLOBAL_SUMMARY_CHATID,
    onError: error => {
      try {
        const data = JSON.parse(error.message);
        if (data.code === 102 || data.code === 103) {
          const upgradeTip = (0,_room_ai_room_ai_utils__WEBPACK_IMPORTED_MODULE_13__.createUpgradeTipMessage)();
          setMessages(prev => [...prev, upgradeTip]);
          storeMessagesToDB(upgradeTip);
        }
      } catch (e) {
        // eslint-disable-next-line no-console
        console.error('error.message is not JSON:', error.message);
      }
    },
    onFinish: result => {
      // eslint-disable-next-line no-console
      console.log('[GlobalSummary] Finished:', result);
      // AI  assistant 
      setMessages(prev => {
        const lastMessage = prev[prev.length - 1];
        if (lastMessage && lastMessage.role === 'assistant') {
          storeMessagesToDB(lastMessage);
        }
        return prev;
      });
    }
  });

  //  ref 
  const prevMessagesLengthRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const sorted = (0,lodash__WEBPACK_IMPORTED_MODULE_1__.orderBy)((0,lodash__WEBPACK_IMPORTED_MODULE_1__.uniqBy)([...messages, ...summaryMessages], item => item.id), [item => new Date(item.createdAt).getTime()], ['asc']);
    setViewMessages(sorted);

    // 
    const currentLength = sorted.length;
    if (currentLength > prevMessagesLengthRef.current && !isScrollLock) {
      //  requestAnimationFrame 
      requestAnimationFrame(() => {
        scrollToBottom();
      });
    }
    prevMessagesLengthRef.current = currentLength;
  }, [messages, summaryMessages, isScrollLock, scrollToBottom]);
  const handleLoadMore = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    scrollLocked();
    return new Promise(resolve => {
      _store__WEBPACK_IMPORTED_MODULE_14__.ChataiStores.summary?.getMessages(pageInfo?.lastTime, 10)?.then(res => {
        if (res.messages) {
          const localChatAiMessages = res?.messages ?? [];
          setSummaryMessages(prev => [...localChatAiMessages, ...prev]);
        }
        setPageInfo({
          lastTime: res.lastTime,
          hasMore: res.hasMore
        });
        resolve();
      });
    });
  }, [pageInfo?.lastTime, scrollLocked, setSummaryMessages]);
  const handleAddSummaryMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(message => {
    setSummaryMessages(prev => [...prev, message]);
    storeMessagesToDB(message);
  }, [storeMessagesToDB]);
  const handleAddUrgentMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(message => {
    setSummaryMessages(prev => [...prev, message]);
    setNotificationMessage(message);
    storeMessagesToDB(message);
  }, [storeMessagesToDB]);
  const getSummaryHistory = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    //  IntroMessage
    const introMessageId = 'intro-message-global-summary';
    _store__WEBPACK_IMPORTED_MODULE_14__.ChataiStores.summary?.getMessage(introMessageId).then(async existingIntro => {
      if (!existingIntro) {
        //  IntroMessage
        const introMessage = _utils_intro_message_manager__WEBPACK_IMPORTED_MODULE_15__["default"].getIntroMessage(_variables__WEBPACK_IMPORTED_MODULE_16__.GLOBAL_SUMMARY_CHATID);
        _store__WEBPACK_IMPORTED_MODULE_14__.ChataiStores.summary?.storeMessage(introMessage);
      }

      // 
      const res = await _store__WEBPACK_IMPORTED_MODULE_14__.ChataiStores.summary?.getMessages(undefined, 30);
      if (res && res.messages) {
        const localChatAiMessages = res.messages ?? [];
        setSummaryMessages(localChatAiMessages);
        setPageInfo({
          lastTime: res.lastTime,
          hasMore: res.hasMore
        });
      }

      // 
      requestAnimationFrame(() => {
        scrollToBottom('instant');
      });
    });
  }, [scrollToBottom]);

  // useEffect(() => {
  //   const lastFocusTime = RoomStorage.getRoomLastFocusTime(GLOBAL_SUMMARY_CHATID);
  //   // 6
  //   if (lastFocusTime && lastFocusTime < Date.now() - 1000 * 60 * 60 * 6) {
  //     globalSummaryTask.initSummaryChats(false);
  //   }
  //   RoomStorage.updateRoomAIData(GLOBAL_SUMMARY_CHATID, 'lastFocusTime', new Date().getTime());
  // }, []);

  const deleteMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(messageId => {
    scrollLocked();
    _store__WEBPACK_IMPORTED_MODULE_14__.ChataiStores.summary?.delMessage(messageId).then(() => {
      setViewMessages(prev => prev.filter(message => message.id !== messageId));
    });
  }, [scrollLocked]);
  const handleInputSubmit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(value => {
    scrollToBottom();
    const newMessage = {
      role: 'user',
      content: value,
      id: (0,_util_generateUniqueId__WEBPACK_IMPORTED_MODULE_5__["default"])(),
      createdAt: new Date(),
      type: _messages_types__WEBPACK_IMPORTED_MODULE_2__.AIMessageType.Default,
      timestamp: Date.now()
    };
    append(newMessage);
    // 
    storeMessagesToDB(newMessage);
  }, [append, scrollToBottom, storeMessagesToDB]);
  (0,_hook_useEventBus__WEBPACK_IMPORTED_MODULE_8__.useEventListener)(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__.Actions.AskGlobalAI, handleInputSubmit);
  (0,_hook_useEventBus__WEBPACK_IMPORTED_MODULE_8__.useEventListener)(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__.Actions.AddUrgentMessage, handleAddUrgentMessage);
  (0,_hook_useEventBus__WEBPACK_IMPORTED_MODULE_8__.useEventListener)(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__.Actions.AddSummaryMessage, handleAddSummaryMessage);
  (0,_hook_useEventBus__WEBPACK_IMPORTED_MODULE_8__.useEventListener)(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__.Actions.ChatAIStoreReady, getSummaryHistory);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    getSummaryHistory();
  }, [getSummaryHistory]);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_global_summary_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].globaSummaryBg, 'flex flex-col w-full h-full', 'global-summary-inner', isOpen && 'right-panel-open');
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_19__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row w-full"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: className
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-[56px] w-full px-[20px] flex items-center bg-[var(--color-background)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[40px] h-[40px] rounded-full mr-[12px]",
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_23__,
    alt: "TelyAI"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[15px] font-semibold"
  }, "TelyAI"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center ml-auto gap-[20px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_summary_header_actions__WEBPACK_IMPORTED_MODULE_17__["default"], null))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex-1 flex flex-col overflow-hidden"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages__WEBPACK_IMPORTED_MODULE_10__.Messages, {
    className: "px-[15%] flex-1",
    status: status,
    messages: viewMessages,
    currentPhase: currentPhase,
    deleteMessage: deleteMessage,
    loadMore: handleLoadMore,
    hasMore: pageInfo.hasMore,
    chatId: _variables__WEBPACK_IMPORTED_MODULE_16__.GLOBAL_SUMMARY_CHATID
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mb-[26px] px-[15%]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_multi_input__WEBPACK_IMPORTED_MODULE_11__.MultiInput, {
    status: status,
    setMessages: setMessages,
    stop: stop,
    handleInputSubmit: handleInputSubmit
  })))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_rightPanel_right_panel__WEBPACK_IMPORTED_MODULE_12__.RightPanel, null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_urgent_notification__WEBPACK_IMPORTED_MODULE_18__["default"], {
    message: notificationMessage
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (/*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(GlobalSummary));

/***/ },

/***/ "./src/components/chatAssistant/global-summary/summary-header-actions.tsx"
/*!********************************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/summary-header-actions.tsx ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _api_user_settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../api/user-settings */ "./src/components/chatAssistant/api/user-settings.ts");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../icons */ "./src/components/chatAssistant/icons.tsx");
/* harmony import */ var _component_InviteButton__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../component/InviteButton */ "./src/components/chatAssistant/component/InviteButton.tsx");
/* harmony import */ var _DrawerContext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");





const SummaryHeaderActions = () => {
  const {
    openDrawer
  } = (0,_DrawerContext__WEBPACK_IMPORTED_MODULE_4__.useDrawerStore)();
  const handleShowRightPanel = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    openDrawer(_DrawerContext__WEBPACK_IMPORTED_MODULE_4__.DrawerKey.PersonalizeSettings);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_1__.telegptSettings.getGptSettings();
  }, [openDrawer]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[16px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_InviteButton__WEBPACK_IMPORTED_MODULE_3__["default"], null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "cursor-pointer flex flex-row gap-[6px] items-center",
    onClick: handleShowRightPanel
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[var(--color-text-secondary)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_2__.SettingIcon, null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[16px] font-semibold"
  }, "Personalize")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SummaryHeaderActions);

/***/ },

/***/ "./src/components/chatAssistant/global-summary/urgent-notification.tsx"
/*!*****************************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/urgent-notification.tsx ***!
  \*****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/notification/index.js");
/* harmony import */ var _assets_danger_png__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../assets/danger.png */ "./src/components/chatAssistant/assets/danger.png");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* eslint-disable no-null/no-null */
/* eslint-disable no-console */
/* eslint-disable max-len */





const UrgentNotification = ({
  message
}) => {
  const [api, contextHolder] = antd__WEBPACK_IMPORTED_MODULE_1__["default"].useNotification();
  const notificationUrgentMessage = msg => {
    const parsedMessage = JSON.parse(msg.content);
    if (parsedMessage && typeof parsedMessage === 'object' && parsedMessage.length > 0) {
      parsedMessage.forEach(item => {
        api.open({
          style: {
            padding: '12px 20px'
          },
          message: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
            className: "flex flex-row gap-[12px]"
          }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
            className: "w-[52px] h-[52px] rounded-full",
            src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_3__,
            alt: ""
          }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
            className: "flex flex-row items-center gap-[8px] mb-[10px]"
          }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
            src: _assets_danger_png__WEBPACK_IMPORTED_MODULE_2__,
            alt: "",
            className: "w-[26px] h-[26px]"
          }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
            className: "text-[20px] text-[#FF543D] font-bold"
          }, "Urgent Alert")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
            className: "text-[18px] font-semibold line-clamp-2 overflow-hidden text-ellipsis"
          }, item.content)))
        });
      });
    }
  };
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (message) {
      notificationUrgentMessage(message);
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [message]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, contextHolder, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UrgentNotification);

/***/ },

/***/ "./src/components/chatAssistant/hook/useEventBus.ts"
/*!**********************************************************!*\
  !*** ./src/components/chatAssistant/hook/useEventBus.ts ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   emitEvent: () => (/* binding */ emitEvent),
/* harmony export */   useEventListener: () => (/* binding */ useEventListener)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");


function useEventListener(event, handler, deps = []) {
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__["default"].on(event, handler);
    return () => _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__["default"].off(event, handler);
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, deps);
}
function emitEvent(event, payload) {
  _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__["default"].emit(event, payload);
}

/***/ },

/***/ "./src/components/chatAssistant/multi-input.tsx"
/*!******************************************************!*\
  !*** ./src/components/chatAssistant/multi-input.tsx ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MultiInput: () => (/* binding */ MultiInput)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var sonner__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! sonner */ "./node_modules/sonner/dist/index.mjs");
/* harmony import */ var usehooks_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! usehooks-ts */ "./node_modules/usehooks-ts/dist/index.js");
/* harmony import */ var _lib_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/utils */ "./src/lib/utils.ts");
/* harmony import */ var _component_AITextarea__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./component/AITextarea */ "./src/components/chatAssistant/component/AITextarea.tsx");
/* harmony import */ var _component_button__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./component/button */ "./src/components/chatAssistant/component/button.tsx");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./icons */ "./src/components/chatAssistant/icons.tsx");
/* eslint-disable no-null/no-null */










function PureMultimodalInput({
  status,
  stop,
  setMessages,
  handleInputSubmit,
  className
}) {
  const textareaRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const {
    width
  } = (0,usehooks_ts__WEBPACK_IMPORTED_MODULE_3__.useWindowSize)();
  const adjustHeight = () => {
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      const height = Math.min(200, Math.max(45, textareaRef.current.scrollHeight + 2));
      textareaRef.current.style.height = `${height}px`;
    }
  };
  const resetHeight = () => {
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      textareaRef.current.style.height = '45px';
    }
  };
  const [localStorageInput, setLocalStorageInput] = (0,usehooks_ts__WEBPACK_IMPORTED_MODULE_3__.useLocalStorage)('input', '');
  const [inputValue, setInputValue] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [isComposing, setIsComposing] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (textareaRef.current) {
      const domValue = textareaRef.current.value;
      // Prefer DOM value over localStorage to handle hydration
      const finalValue = domValue || localStorageInput || '';
      // setInput(finalValue);
      setInputValue(finalValue);
      if (finalValue) {
        adjustHeight();
      }
    }
    // Only run once after hydration
  }, [localStorageInput]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setLocalStorageInput(inputValue);
  }, [inputValue, setLocalStorageInput]);
  const handleInput = event => {
    setInputValue(event.target.value);
    adjustHeight();
  };
  const submitForm = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!inputValue) {
      return;
    }
    handleInputSubmit(inputValue);
    setInputValue('');
    setLocalStorageInput('');
    resetHeight();
    if (width && width > 768) {
      textareaRef.current?.focus();
    }
  }, [handleInputSubmit, inputValue, setLocalStorageInput, width]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "relative w-full flex flex-col gap-4"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_AITextarea__WEBPACK_IMPORTED_MODULE_5__.AITextarea, {
    ref: textareaRef,
    placeholder: "Send a message...",
    value: inputValue,
    onChange: handleInput,
    className: classnames__WEBPACK_IMPORTED_MODULE_1___default()('h-[45px] overflow-y-auto border-[#7D40FF] px-3 py-2 resize-none rounded-2xl !text-base pb-10 focus-visible:!ring-0 !ring-offset-0 dark:border-[#2F2F2F]', className),
    rows: 2
    // autoFocus
    ,
    onCompositionStart: () => setIsComposing(true),
    onCompositionEnd: () => setIsComposing(false),
    onKeyDown: event => {
      // 
      if (isComposing || event.nativeEvent.isComposing) {
        return;
      }
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        if (status !== 'ready') {
          sonner__WEBPACK_IMPORTED_MODULE_2__.toast.error('Please wait for the model to finish its response!');
        } else {
          submitForm();
        }
      }
    }
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "absolute bottom-0 right-0 p-2 w-fit flex flex-col justify-end"
  }, status === 'submitted' ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(StopButton, {
    stop: stop,
    setMessages: setMessages
  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SendButton, {
    input: inputValue,
    submitForm: submitForm
  })));
}
const MultiInput = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(PureMultimodalInput, (prevProps, nextProps) => {
  if (prevProps.status !== nextProps.status) return false;
  return true;
});
function PureStopButton({
  stop,
  setMessages
}) {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_button__WEBPACK_IMPORTED_MODULE_6__.Button, {
    className: "rounded-full p-1.5 h-fit border dark:border-zinc-600",
    onClick: event => {
      event.preventDefault();
      stop();
      setMessages(messages => (0,_lib_utils__WEBPACK_IMPORTED_MODULE_4__.sanitizeUIMessages)(messages));
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_7__.StopIcon, {
    size: 14
  }));
}
const StopButton = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(PureStopButton);
function PureSendButton({
  submitForm,
  input
}) {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_button__WEBPACK_IMPORTED_MODULE_6__.Button, {
    className: "!px-0 !py-0 !w-[24px] !h-[24px] !bg-transparent ",
    onClick: event => {
      event.preventDefault();
      submitForm();
    },
    disabled: input.length === 0
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("i", {
    className: "icon icon-send text-[#000000] text-[24px] dark:text-[#AAAAAA]"
  }));
}
const SendButton = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(PureSendButton, (prevProps, nextProps) => {
  if (prevProps.input !== nextProps.input) return false;
  return true;
});

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/add-topic-panel.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/add-topic-panel.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/message/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/switch/index.js");
/* harmony import */ var _api_user_settings__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../api/user-settings */ "./src/components/chatAssistant/api/user-settings.ts");
/* harmony import */ var _component_FloatingActionButton__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../component/FloatingActionButton */ "./src/components/chatAssistant/component/FloatingActionButton.tsx");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _component_InputText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../component/InputText */ "./src/components/chatAssistant/component/InputText.tsx");
/* harmony import */ var _component_Spinner__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../component/Spinner */ "./src/components/chatAssistant/component/Spinner.tsx");
/* harmony import */ var _component_TextArea__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../component/TextArea */ "./src/components/chatAssistant/component/TextArea.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* eslint-disable no-console */
/* eslint-disable react/jsx-no-bind */
/* eslint-disable max-len */









const AddTopicPanel = () => {
  const {
    phone
  } = _api_user_settings__WEBPACK_IMPORTED_MODULE_3__.telegptSettings.telegptSettings;
  const filterPhone = phone.replace(/^\+\d+\s*/, "").replace(/\s/g, "");
  const {
    openDrawer,
    drawerParams
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_9__.useDrawerStore)();
  const [topicError, setTopicError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [descriptionError, setDescriptionError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [phoneNumberError, setPhoneNumberError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [phoneNumber, setPhoneNumber] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(filterPhone);
  const [isLoading, setIsLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const initialValues = drawerParams || {
    topic: '',
    prompt: '',
    is_call: false,
    is_open: false
  };
  const [form, setForm] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(initialValues);
  const strongAlertChange = checked => {
    setForm(prev => {
      prev.is_call = checked;
      return {
        ...prev
      };
    });
    if (!checked) {
      setPhoneNumberError(false);
    }
  };
  const handleTopicNameChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    const topicName = e.currentTarget.value;
    setForm(prev => {
      prev.topic = topicName;
      return {
        ...prev
      };
    });
    if (topicName.trim().length) {
      setTopicError(false);
    }
  }, []);
  const handleTopicDescriptionChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    const topicDescription = e.currentTarget.value;
    setForm(prev => {
      prev.prompt = topicDescription;
      return {
        ...prev
      };
    });
    if (topicDescription.trim().length) {
      setDescriptionError(false);
    }
  }, []);
  const handlePhoneNumberChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    const number = e.currentTarget.value.trim();
    setPhoneNumber(number);
    if (number.trim().length === 0) {
      setPhoneNumberError(false);
    }
  }, []);
  const handleSave = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (form.topic.trim().length === 0) {
      setTopicError(true);
      return;
    }
    if (form.prompt.trim().length === 0) {
      setDescriptionError(true);
      return;
    }
    if (form.is_call && phoneNumber.length === 0) {
      setPhoneNumberError(true);
      return;
    }
    setIsLoading(true);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_3__.telegptSettings.updateUrgentTopic(form).then(res => {
      setIsLoading(false);
      if (res.code === 0) {
        openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_9__.DrawerKey.PersonalizeSettings, {
          activeKey: 1
        });
        if (form.is_call && phoneNumber.length > 0) {
          _api_user_settings__WEBPACK_IMPORTED_MODULE_3__.telegptSettings.setSettingOption({
            phone: phoneNumber
          });
        }
      } else {
        antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('save failed');
      }
    }).catch(() => {
      antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('save failed');
      setIsLoading(false);
    });
  }, [form, openDrawer, phoneNumber]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "urgent-topic-edit h-full overflow-hidden px-[18px] flex flex-col"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-full overflow-y-auto flex-1"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px] text-[#666666] mb-[24px]"
  }, "Please set the topics and descriptions for which you want alerts. When a message contains these keywords, you\u2019ll be notified."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_InputText__WEBPACK_IMPORTED_MODULE_6__["default"], {
    label: "Topic Name",
    value: form.topic,
    onChange: handleTopicNameChange,
    error: topicError ? 'Please enter the topic name' : undefined
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mb-[24px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_TextArea__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: "!mb-[12px]",
    label: "Topic Description",
    value: form.prompt,
    noReplaceNewlines: true,
    error: descriptionError ? 'Please enter the topic description' : undefined,
    onChange: handleTopicDescriptionChange
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px] text-[#767676]"
  }, "Please describe the specific content or keywords that should trigger an alert. For example, if \u2018Vitalik\u2019 + \u2018ETH\u2019 + \u2018sell\u2019 appear, please notify me.")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mb-[24px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center justify-between px-[14px] py-[10px] bg-[var(--color-chat-hover)] rounded-[6px] mb-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[var(--color-text)]"
  }, "Enable strong alerts"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_2__["default"], {
    value: form.is_call,
    onChange: strongAlertChange
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px] text-[#767676]"
  }, "Once enabled, these types of messages will trigger a phone alert.")), form.is_call && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_InputText__WEBPACK_IMPORTED_MODULE_6__["default"], {
    label: "Phone Number",
    type: "number",
    value: phoneNumber,
    onChange: handlePhoneNumberChange,
    error: phoneNumberError ? 'Please enter a valid phone number' : undefined
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_FloatingActionButton__WEBPACK_IMPORTED_MODULE_4__["default"], {
    isShown: true,
    onClick: handleSave
  }, isLoading ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Spinner__WEBPACK_IMPORTED_MODULE_7__["default"], {
    color: "white"
  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_5__["default"], {
    name: "check",
    className: "text-white text-[1.5rem]"
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AddTopicPanel);

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/chat-picker-panel.scss"
/*!************************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/chat-picker-panel.scss ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/rightPanel/chat-picker-panel.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/chat-picker-panel.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/checkbox/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/input/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hook_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../hook/useOldLang */ "./src/components/chatAssistant/hook/useOldLang.ts");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _component_FloatingActionButton__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../component/FloatingActionButton */ "./src/components/chatAssistant/component/FloatingActionButton.tsx");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* harmony import */ var _chat_picker_panel_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./chat-picker-panel.scss */ "./src/components/chatAssistant/rightPanel/chat-picker-panel.scss");
/* eslint-disable react/jsx-no-bind */
/* eslint-disable max-len */
/* eslint-disable no-console */















const PickerChatItem = ({
  id,
  isChecked,
  onChange
}) => {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  const lang = (0,_hook_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const {
    currentUserId
  } = global;
  const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeer)(global, id);
  if (!peer) {
    return undefined;
  }
  const isSelf = peer && !(0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__.isApiPeerChat)(peer) ? peer.isSelf : undefined;
  const customPeer = 'isCustomPeer' in peer ? peer : undefined;
  const realPeer = 'id' in peer ? peer : undefined;
  const isUser = realPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__.isApiPeerUser)(realPeer);
  const title = realPeer && (isUser ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getUserFullName)(realPeer) : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getChatTitle)(lang, realPeer));
  function getSubtitle() {
    if (!peer) return undefined;
    if (peer.id === currentUserId) return [lang('SavedMessagesInfo')];
    if ((0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__.isApiPeerChat)(peer)) {
      return [(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getGroupStatus)(lang, peer)];
    }
    const userStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUserStatus)(global, peer.id);
    return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getUserStatus)(lang, peer, userStatus);
  }
  function getTitle() {
    if (customPeer) {
      return customPeer?.title || lang(customPeer?.titleKey);
    }
    if (isSelf) {
      return lang('SavedMessages');
    }
    return title;
  }
  const subtitle = getSubtitle() || '';
  const specialTitle = getTitle();
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    value: id,
    className: "chat-picker-item rounded-[12px]",
    checked: isChecked,
    onChange: onChange
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex-1 flex flex-row items-center gap-[12px] px-[12px] py-[10px] hover:bg-[var(--color-chat-hover)] rounded-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
    peer: peer,
    isSavedMessages: isSelf,
    clickOpenRoom: false,
    size: "medium"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[4px] justify-center text-[var(--color-text)] flex-1 overflow-hidden"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "overflow-hidden overflow-ellipsis whitespace-nowrap"
  }, specialTitle), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, subtitle))));
};
const ChatPickerPanel = () => {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  const orderedIds = react__WEBPACK_IMPORTED_MODULE_0___default().useMemo(() => (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_8__.getOrderedIds)(_config__WEBPACK_IMPORTED_MODULE_4__.ALL_FOLDER_ID) || [], []);
  const {
    drawerParams
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_14__.useDrawerStore)();
  const selectedChats = drawerParams?.selectedChats || [];
  const [selected, setSelected] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(selectedChats);
  const [search, setSearch] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const filter = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => ['channels', 'chats', 'users', 'groups'], []);
  const ids = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const sorted = (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_9__["default"])((0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__.filterPeersByQuery)({
      ids: orderedIds,
      query: search
    }), undefined);
    return (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.filterChatIdsByType)(global, sorted, filter);
  }, [filter, global, orderedIds, search]);
  const handleSave = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    drawerParams?.onSave(selected);
  }, [drawerParams, selected]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-full px-[20px] flex flex-col text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_2__["default"], {
    placeholder: "Search",
    onChange: e => setSearch(e.target.value)
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex-1 overflow-y-auto"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"].Group, {
    className: "w-full",
    value: selected
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[12px] w-full overflow-hidden"
  }, ids.map(id => {
    const isChecked = selected.includes(id);
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(PickerChatItem, {
      id: id,
      isChecked: isChecked,
      onChange: e => {
        const checked = e.target.checked;
        setSelected(prev => {
          if (checked) {
            return [...prev, id];
          } else {
            return prev.filter(item => item !== id);
          }
        });
      }
    });
  })))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_FloatingActionButton__WEBPACK_IMPORTED_MODULE_12__["default"], {
    isShown: true,
    onClick: handleSave
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "check",
    className: "text-white text-[1.5rem]"
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatPickerPanel);

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/customization-prompt-panel.tsx"
/*!********************************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/customization-prompt-panel.tsx ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/message/index.js");
/* harmony import */ var _api_user_settings__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../api/user-settings */ "./src/components/chatAssistant/api/user-settings.ts");
/* harmony import */ var _component_FloatingActionButton__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../component/FloatingActionButton */ "./src/components/chatAssistant/component/FloatingActionButton.tsx");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _component_InputText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../component/InputText */ "./src/components/chatAssistant/component/InputText.tsx");
/* harmony import */ var _component_Spinner__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../component/Spinner */ "./src/components/chatAssistant/component/Spinner.tsx");
/* harmony import */ var _component_TextArea__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../component/TextArea */ "./src/components/chatAssistant/component/TextArea.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* eslint-disable max-len */









const CustomizationPromptPanel = () => {
  const {
    openDrawer,
    drawerParams
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.useDrawerStore)();
  const [titleError, setTitleError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [promptError, setPromptError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isLoading, setIsLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const initialValues = drawerParams || {
    topic: '',
    prompt: ''
  };
  const [form, setForm] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(initialValues);
  const handleSave = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (form.topic.trim().length === 0) {
      setTitleError(true);
      return;
    }
    if (form.prompt.trim().length === 0) {
      setPromptError(true);
      return;
    }
    setIsLoading(true);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_2__.telegptSettings.updateSummarizeTemplate(form).then(res => {
      setIsLoading(false);
      if (res.code === 0) {
        openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.DrawerKey.PersonalizeSettings, {
          activeKey: 0
        });
      } else {
        antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('save failed');
      }
    }).catch(() => {
      antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('save failed');
    });
  }, [form, openDrawer]);
  const handleTopicNameChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    const topic = e.currentTarget.value;
    setForm(prev => {
      prev.topic = topic;
      return {
        ...prev
      };
    });
    if (topic.trim().length) {
      setTitleError(false);
    }
  }, []);
  const handleTopicDescriptionChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    const prompt = e.currentTarget.value;
    setForm(prev => {
      prev.prompt = prompt;
      return {
        ...prev
      };
    });
    if (prompt.trim().length) {
      setPromptError(false);
    }
  }, []);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-full flex flex-col px-[18px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[14px] text-[#666666]"
  }, "Enter a topic you want AI to track and summarize. Add details so summaries are more accurate and relevant."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_InputText__WEBPACK_IMPORTED_MODULE_5__["default"], {
    label: "Topic name",
    value: form.topic,
    onChange: handleTopicNameChange,
    error: titleError ? 'Please enter the topic name' : undefined
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_TextArea__WEBPACK_IMPORTED_MODULE_7__["default"], {
    label: "Topic description",
    value: form.prompt,
    noReplaceNewlines: true,
    error: promptError ? 'Please enter the topic description' : undefined,
    onChange: handleTopicDescriptionChange
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_FloatingActionButton__WEBPACK_IMPORTED_MODULE_3__["default"], {
    isShown: true,
    onClick: handleSave
  }, isLoading ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Spinner__WEBPACK_IMPORTED_MODULE_6__["default"], {
    color: "white"
  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
    name: "check",
    className: "text-white text-[1.5rem]"
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CustomizationPromptPanel);

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/message-panel.scss"
/*!********************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/message-panel.scss ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/rightPanel/message-panel.tsx"
/*!*******************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/message-panel.tsx ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/skeleton/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_reducers_messages__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/reducers/messages */ "./src/global/reducers/messages.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_messages__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../global/selectors/messages */ "./src/global/selectors/messages.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _hook_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../hook/useOldLang */ "./src/components/chatAssistant/hook/useOldLang.ts");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../icons */ "./src/components/chatAssistant/icons.tsx");
/* harmony import */ var _utils_chat_api__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../utils/chat-api */ "./src/components/chatAssistant/utils/chat-api.ts");
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _utils_knowledge_match__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../utils/knowledge-match */ "./src/components/chatAssistant/utils/knowledge-match.ts");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _component_ChatAvatar__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../component/ChatAvatar */ "./src/components/chatAssistant/component/ChatAvatar.tsx");
/* harmony import */ var _ErrorBoundary__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../ErrorBoundary */ "./src/components/chatAssistant/ErrorBoundary.tsx");
/* harmony import */ var _message_panel_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./message-panel.scss */ "./src/components/chatAssistant/rightPanel/message-panel.scss");
/* harmony import */ var _assets_cgat_ai_logo_png__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../assets/cgat-ai-logo.png */ "./src/components/chatAssistant/assets/cgat-ai-logo.png");
/* eslint-disable no-console */
/* eslint-disable max-len */
/* eslint-disable no-null/no-null */
/* eslint-disable @typescript-eslint/no-shadow */




















const Message = ({
  chatId,
  messageId
}) => {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  const lang = (0,_hook_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const [message, setMessage] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const [showSmartReply, setShowSmartReply] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [replyResponse, setReplyResponse] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [isLoading, setIsLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const textareaRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const {
    updateDraftReplyInfo,
    sendMessage,
    clearDraft
  } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();
  const adjustHeight = () => {
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      textareaRef.current.style.height = `${textareaRef.current.scrollHeight + 2}px`;
    }
  };
  const {
    focusMessage
  } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (messageId) {
      const message = (0,_global_selectors_messages__WEBPACK_IMPORTED_MODULE_8__.selectChatMessage)(global, chatId, Number(messageId));
      if (message) {
        setMessage(message);
        setIsLoading(false);
      } else if (chat) {
        (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('fetchMessage', {
          chat,
          messageId
        }).then(result => {
          if (result) {
            if (result === _api_types__WEBPACK_IMPORTED_MODULE_3__.MESSAGE_DELETED) {
              setMessage(undefined);
            } else if (result.message.content.text?.text) {
              setMessage(result.message);
              (0,_global_reducers_messages__WEBPACK_IMPORTED_MODULE_6__.updateChatMessage)(global, chat.id, messageId, result.message);
            }
          }
          setIsLoading(false);
        }).catch(() => {
          setIsLoading(false);
        });
      }
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [chatId, messageId]);
  const handleSmaryReply = async message => {
    if (message.content.text?.text) {
      const bestMatch = await (0,_utils_knowledge_match__WEBPACK_IMPORTED_MODULE_14__.getBestKnowledgeMatch)(message.content.text.text);
      if (bestMatch && bestMatch.score > 0.8) {
        setReplyResponse(bestMatch.answer);
      } else {
        (0,_utils_chat_api__WEBPACK_IMPORTED_MODULE_12__.autoReply)({
          message: message.content.text?.text,
          message_id: message.id
        }).then(res => {
          setReplyResponse(res.data.reply);
        }).catch(() => {
          console.log('error');
        });
      }
    }
  };
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (textareaRef.current) {
      adjustHeight();
    }
  }, [replyResponse]);
  const handleInput = e => {
    setReplyResponse(e.target.value);
    adjustHeight();
  };
  const handleReply = () => {
    updateDraftReplyInfo({
      replyToMsgId: message?.id,
      replyToPeerId: undefined
    });
    setTimeout(() => {
      sendMessage({
        messageList: {
          chatId,
          threadId: -1,
          type: 'thread'
        },
        text: replyResponse
      });
    });
    setReplyResponse('');
    setShowSmartReply(false);
    setTimeout(() => {
      clearDraft({
        chatId,
        isLocalOnly: true
      });
    });
  };
  const handleFocusMessage = () => {
    if (messageId) {
      focusMessage({
        chatId,
        messageId: Number(messageId)
      });
    }
  };
  const renderMessage = () => {
    if (!message || !message.content.text?.text) {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "text-[15px] text-[#979797]"
      }, "Message Deleted");
    }
    const text = message.content.text?.text;
    const date = (0,_utils_util__WEBPACK_IMPORTED_MODULE_13__.formatTimestamp)(message.date * 1000);
    const senderId = message.senderId;
    const peer = senderId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, senderId) : undefined;
    const isUser = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__.isApiPeerUser)(peer);
    const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
    const title = peer && isUser ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getUserFullName)(peer) : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getChatTitle)(lang, chat);
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex flex-row items-center mb-[12px]"
    }, isUser ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_15__["default"], {
      peer: peer,
      size: 34
    }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_ChatAvatar__WEBPACK_IMPORTED_MODULE_16__["default"], {
      chatId: chatId,
      size: 34
    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[16px] font-semibold mr-[8px] ml-[12px] flex-1 whitespace-nowrap overflow-hidden text-ellipsis"
    }, title), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[#979797] text-[13px]"
    }, date)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "text-[15px] relative flex flex-row items-end justify-between"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "w-full"
    }, text), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_13__.cn)('right-panel-message-actions flex items-center flex-row justify-end gap-[4px]', {
        '!flex': showSmartReply
      })
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "w-[15px] h-[15px] cursor-pointer",
      onClick: () => {
        setShowSmartReply(true);
        handleSmaryReply(message);
      }
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
      src: _assets_cgat_ai_logo_png__WEBPACK_IMPORTED_MODULE_19__,
      alt: "ai-reply",
      className: "w-full h-full"
    })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "text-[#9F9F9F] cursor-pointer",
      onClick: handleFocusMessage,
      "aria-label": "Smart Reply"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_11__.ArrowRightIcon, {
      size: 16
    })))), showSmartReply ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex flex-row items-center gap-[6px]"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
      className: "w-[15px] h-[15px]",
      src: _assets_cgat_ai_logo_png__WEBPACK_IMPORTED_MODULE_19__,
      alt: "MingcuteaiIcon"
    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[14px] text-[#757575]"
    }, "Reply suggested by TelyAI")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex flex-row items-end gap-[12px]"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("textarea", {
      ref: textareaRef,
      className: "w-full py-[8px] px-[12px] border border-[#7949FF] rounded-[8px] mt-[12px] resize-none leading-[18px]",
      placeholder: "Type your reply here...",
      rows: 1,
      value: replyResponse,
      onChange: handleInput
    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("button", {
      className: "w-[36px] h-[36px] bg-[#8C59D0] flex items-center justify-center text-white rounded-full flex-shrink-0",
      "aria-label": "Send message",
      onClick: handleReply
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_11__.SendIcon, {
      size: 15
    })))) : null);
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "right-panel-message-item pb-[20px] pt-[16px] border-solid border-b-[1px] border-[rgba(0,0,0,0.1)] px-[18px]"
  }, isLoading ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    active: true,
    paragraph: {
      rows: 2
    }
  }) : renderMessage());
};
const CustomVirtualList = ({
  relevantMessages
}) => {
  const listData = relevantMessages.flatMap(item => item.messageIds.map(messageId => ({
    chatId: item.chatId,
    messageId
  })));
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-full overflow-y-auto"
  }, listData.map(item => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_17__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(Message, {
      chatId: item.chatId,
      messageId: item.messageId
    }));
  }));
};
const MessagePanel = ({
  relevantMessages
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-full"
  }, relevantMessages.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(CustomVirtualList, {
    relevantMessages: relevantMessages
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessagePanel);

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/personalized-settings.scss"
/*!****************************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/personalized-settings.scss ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/rightPanel/personalized-settings.tsx"
/*!***************************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/personalized-settings.tsx ***!
  \***************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _surmarize_tab__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./surmarize-tab */ "./src/components/chatAssistant/rightPanel/surmarize-tab.tsx");
/* harmony import */ var _urgent_alert_tab__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./urgent-alert-tab */ "./src/components/chatAssistant/rightPanel/urgent-alert-tab.tsx");
/* harmony import */ var _component_TabList__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../component/TabList */ "./src/components/chatAssistant/component/TabList.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* harmony import */ var _personalized_settings_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./personalized-settings.scss */ "./src/components/chatAssistant/rightPanel/personalized-settings.scss");
/* eslint-disable no-console */
/* eslint-disable react/jsx-no-bind */






const PersonalizeSettings = () => {
  const {
    drawerParams
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_4__.useDrawerStore)();
  const [selectedTabIndex, setSelectedTabIndex] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(drawerParams?.activeKey || 0);
  const transactionTabs = [{
    title: 'Chat Summary'
  }, {
    title: 'Urgent Alert'
  }];
  const renderContent = () => {
    switch (selectedTabIndex) {
      case 0:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_surmarize_tab__WEBPACK_IMPORTED_MODULE_1__["default"], null);
      case 1:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_urgent_alert_tab__WEBPACK_IMPORTED_MODULE_2__["default"], null);
      default:
        return undefined;
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col h-full w-full"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_TabList__WEBPACK_IMPORTED_MODULE_3__["default"], {
    activeTab: selectedTabIndex,
    tabs: transactionTabs,
    onSwitchTab: setSelectedTabIndex
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "pt-[20px] flex-1 overflow-y-auto"
  }, renderContent()));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PersonalizeSettings);

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/right-header.tsx"
/*!******************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/right-header.tsx ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* eslint-disable no-null/no-null */
/* eslint-disable max-len */




const hasBackDrawer = [_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.CustomizationPrompt, _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.AddTopicPanel, _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.ChatPicker];
const HeaderButton = ({
  icon,
  className,
  onClick
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: classnames__WEBPACK_IMPORTED_MODULE_1___default()('flex items-center justify-center cursor-pointer w-[2.75rem] h-[2.75rem] rounded-full text-[var(--color-text-secondary)] hover:bg-[var(--color-interactive-element-hover)]', className),
    onClick: onClick
  }, icon);
};
const RightHeader = props => {
  const {
    drawerKey,
    onClose
  } = props;
  const [title, setTitle] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const {
    openDrawer,
    drawerParams
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.useDrawerStore)();
  const handleBack = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (drawerParams?.onBack) {
      drawerParams.onBack();
    } else {
      openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.PersonalizeSettings, {
        activeKey: drawerKey === _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.CustomizationPrompt ? 0 : 1
      });
    }
  }, [drawerKey, drawerParams, openDrawer]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    switch (drawerKey) {
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.PersonalizeSettings:
        setTitle('Personalized settings');
        break;
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.OriginalMessages:
        setTitle('Original Messages');
        break;
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.CustomizationPrompt:
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.AddTopicPanel:
        setTitle('Add Topics');
        break;
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_3__.DrawerKey.ChatPicker:
        setTitle('Select chat');
        break;
      default:
        setTitle('');
    }
  }, [handleBack, drawerKey]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-[56px] flex items-center relative py-[0.5rem] px-[0.8125rem] w-[var(--right-column-width)]"
  }, drawerKey && hasBackDrawer.includes(drawerKey) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(HeaderButton, {
    icon: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_2__["default"], {
      name: "arrow-left",
      className: "text-[26px]"
    }),
    onClick: handleBack
  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(HeaderButton, {
    icon: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_2__["default"], {
      name: "close",
      className: "text-[26px]"
    }),
    onClick: onClose
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[1.25rem] font-[var(--font-weight-medium)] pl-[1.375rem]"
  }, title));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RightHeader);

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/right-panel.scss"
/*!******************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/right-panel.scss ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/rightPanel/right-panel.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/right-panel.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RightPanel: () => (/* binding */ RightPanel)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _add_topic_panel__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./add-topic-panel */ "./src/components/chatAssistant/rightPanel/add-topic-panel.tsx");
/* harmony import */ var _chat_picker_panel__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./chat-picker-panel */ "./src/components/chatAssistant/rightPanel/chat-picker-panel.tsx");
/* harmony import */ var _customization_prompt_panel__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./customization-prompt-panel */ "./src/components/chatAssistant/rightPanel/customization-prompt-panel.tsx");
/* harmony import */ var _message_panel__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message-panel */ "./src/components/chatAssistant/rightPanel/message-panel.tsx");
/* harmony import */ var _personalized_settings__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./personalized-settings */ "./src/components/chatAssistant/rightPanel/personalized-settings.tsx");
/* harmony import */ var _right_header__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./right-header */ "./src/components/chatAssistant/rightPanel/right-header.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* harmony import */ var _right_panel_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./right-panel.scss */ "./src/components/chatAssistant/rightPanel/right-panel.scss");
/* eslint-disable @typescript-eslint/no-shadow */
/* eslint-disable no-null/no-null */
/* eslint-disable max-len */










const RightPanel = () => {
  const {
    isOpen,
    drawerKey,
    drawerParams,
    closeDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.useDrawerStore)();
  const [rightPanelContent, setRightPanelContent] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    switch (drawerKey) {
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.DrawerKey.PersonalizeSettings:
        setRightPanelContent(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_personalized_settings__WEBPACK_IMPORTED_MODULE_6__["default"], null));
        break;
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.DrawerKey.OriginalMessages:
        setRightPanelContent(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_panel__WEBPACK_IMPORTED_MODULE_5__["default"], {
          relevantMessages: drawerParams?.relevantMessages
        }));
        break;
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.DrawerKey.CustomizationPrompt:
        setRightPanelContent(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_customization_prompt_panel__WEBPACK_IMPORTED_MODULE_4__["default"], null));
        break;
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.DrawerKey.ChatPicker:
        setRightPanelContent(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_chat_picker_panel__WEBPACK_IMPORTED_MODULE_3__["default"], null));
        break;
      case _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.DrawerKey.AddTopicPanel:
        setRightPanelContent(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_add_topic_panel__WEBPACK_IMPORTED_MODULE_2__["default"], null));
        break;
      default:
        setRightPanelContent(null);
    }
  }, [drawerKey, drawerParams]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: classnames__WEBPACK_IMPORTED_MODULE_1___default()('summary-panel-container', {
      'summary-panel-open': isOpen
    })
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_right_header__WEBPACK_IMPORTED_MODULE_7__["default"], {
    drawerKey: drawerKey,
    onClose: closeDrawer
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex-1 overflow-hidden w-[var(--right-column-width)]"
  }, rightPanelContent));
};

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/rooms-tab.scss"
/*!****************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/rooms-tab.scss ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/rightPanel/rooms-tab.tsx"
/*!***************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/rooms-tab.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RoomsTab: () => (/* binding */ RoomsTab)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _hook_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../hook/useOldLang */ "./src/components/chatAssistant/hook/useOldLang.ts");
/* harmony import */ var _variables__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _rooms_tab_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./rooms-tab.scss */ "./src/components/chatAssistant/rightPanel/rooms-tab.scss");
/* harmony import */ var _selected_chats_scss__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./selected-chats.scss */ "./src/components/chatAssistant/rightPanel/selected-chats.scss");
/* eslint-disable max-len */













const RoomsTab = props => {
  const {
    title,
    ignoredIds,
    onIgnored,
    onUnIgnored
  } = props;
  const orderedIds = react__WEBPACK_IMPORTED_MODULE_0___default().useMemo(() => {
    const ids = (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_6__.getOrderedIds)(_config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID) || [];
    return ids.filter(id => id !== _variables__WEBPACK_IMPORTED_MODULE_8__.GLOBAL_SUMMARY_CHATID);
  }, []);
  const unIgnoreIds = orderedIds.filter(id => !ignoredIds.includes(id));
  const [activeTab, setActiveTab] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('summary');
  const lang = (0,_hook_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const renderRoomItem = (id, isIgnored) => {
    const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectPeer)(global, id);
    if (!peer) {
      return undefined;
    }
    const isSelf = peer && !(0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerChat)(peer) ? peer.isSelf : undefined;
    const customPeer = 'isCustomPeer' in peer ? peer : undefined;
    const realPeer = 'id' in peer ? peer : undefined;
    const isUser = realPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerUser)(realPeer);
    // eslint-disable-next-line @typescript-eslint/no-shadow
    const title = realPeer && (isUser ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserFullName)(realPeer) : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getChatTitle)(lang, realPeer));
    function getSubtitle() {
      if (!peer) return undefined;
      if ((0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerChat)(peer)) {
        return [(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getGroupStatus)(lang, peer)];
      }
      const userStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectUserStatus)(global, peer.id);
      return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserStatus)(lang, peer, userStatus);
    }
    function getTitle() {
      if (customPeer) {
        // eslint-disable-next-line @typescript-eslint/no-non-null-asserted-optional-chain
        return customPeer?.title || lang(customPeer?.titleKey);
      }
      if (isSelf) {
        return lang('SavedMessages');
      }
      return title;
    }
    const subtitle = getSubtitle() || '';
    const specialTitle = getTitle();
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "chat-picker-item flex-1 flex flex-row items-center gap-[12px] py-[10px] rounded-[12px]",
      key: id
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_9__["default"], {
      peer: peer,
      isSavedMessages: isSelf,
      size: "medium"
    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex flex-col gap-[4px] justify-center flex-1 overflow-hidden"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "overflow-hidden overflow-ellipsis whitespace-nowrap font-medium"
    }, specialTitle), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "text-[var(--color-text-secondary)] text-sm"
    }, subtitle)), isIgnored ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "chat-picker-item-btn text-white text-sm bg-[#5493F2] w-auto px-[5px] h-[26px] rounded-[6px] flex items-center justify-center",
      onClick: () => onUnIgnored(id)
    }, "Stop Ignoring") : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "chat-picker-item-btn text-white text-sm bg-[#FF5757] w-auto px-[5px] h-[26px] rounded-[6px] flex items-center justify-center",
      onClick: () => onIgnored(id)
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_10__["default"], {
      name: "eye-crossed"
    }), "Ignore"));
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "summary-rooms-tab mt-[20px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "tabs-container"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("button", {
    className: `font-medium text-base ${activeTab === 'summary' ? 'text-[var(--color-text)] active' : 'text-[var(--color-text-secondary)] '}`,
    onClick: () => setActiveTab('summary')
  }, title), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("button", {
    className: `font-medium text-base ${activeTab === 'ignored' ? 'text-[var(--color-text)] active' : 'text-[var(--color-text-secondary)] '}`,
    onClick: () => setActiveTab('ignored')
  }, "Ignored Chats")), activeTab === 'summary' ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, unIgnoreIds.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mt-[16px] space-y-[8px]"
  }, unIgnoreIds.map(id => renderRoomItem(id, false)))) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, ignoredIds.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mt-[16px] space-y-[8px]"
  }, ignoredIds.map(id => renderRoomItem(id, true)))));
};

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/selected-chats.scss"
/*!*********************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/selected-chats.scss ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/rightPanel/surmarize-tab.tsx"
/*!*******************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/surmarize-tab.tsx ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/message/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_user_settings__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../api/user-settings */ "./src/components/chatAssistant/api/user-settings.ts");
/* harmony import */ var _rooms_tab__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./rooms-tab */ "./src/components/chatAssistant/rightPanel/rooms-tab.tsx");
/* harmony import */ var _component_FloatingActionButton__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../component/FloatingActionButton */ "./src/components/chatAssistant/component/FloatingActionButton.tsx");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _component_Spinner__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../component/Spinner */ "./src/components/chatAssistant/component/Spinner.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");











const SummaryItem = ({
  template,
  selectedTemp,
  handleSelect,
  onDelete
}) => {
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_10__.useDrawerStore)();
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_4__.getGlobal)();
  const {
    currentUserId
  } = global;
  const handeleDeleteTopic = e => {
    e.preventDefault();
    e.stopPropagation();
    onDelete(template.id);
  };
  const handleEditTopic = e => {
    e.preventDefault();
    e.stopPropagation();
    openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_10__.DrawerKey.CustomizationPrompt, template);
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: classnames__WEBPACK_IMPORTED_MODULE_2___default()('urgent-topic-item px-[20px] py-[12px] leading-[24px] bg-[var(--color-chat-hover)] rounded-[8px] flex flex-row items-center justify-between gap-[24px]', {
      '!bg-[var(--color-chat-active)] text-white': selectedTemp.includes(template.id)
    }),
    onClick: () => handleSelect(template.id)
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, template.topic), selectedTemp.includes(template.id) && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: "urgent-topic-item-check",
    name: "check"
  }), template.user_id === currentUserId && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "urgent-topic-item-actions flex flex-row gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
    name: "edit",
    className: "text-[14px] cursor-pointer",
    onClick: handleEditTopic
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
    name: "close",
    className: "text-[14px] cursor-pointer",
    onClick: handeleDeleteTopic
  })));
};
const AddSummaryTemplate = () => {
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_10__.useDrawerStore)();
  const handleAdd = () => {
    openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_10__.DrawerKey.CustomizationPrompt);
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "urgent-topic-item px-[20px] py-[12px] leading-[24px] bg-[var(--color-chat-hover)] rounded-[8px] flex flex-row items-center gap-[8px] text-[var(--color-chat-active)] cursor-pointer",
    onClick: handleAdd
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
    name: "add"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, "New Topic"));
};
const SummarizeTab = () => {
  const {
    curious_info,
    ignored_summary_chat_ids,
    curious_id
  } = _api_user_settings__WEBPACK_IMPORTED_MODULE_5__.telegptSettings.telegptSettings;
  const ignoredChatIds = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_5__.getIdsFromEntityTypes)(ignored_summary_chat_ids);
  const [summaryTemplate, setSummaryTemplate] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(curious_info);
  const [originSelectedTemp, setOriginSelectedTemp] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(curious_id);
  const [selectedTemp, setSelectedTemp] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(curious_id);
  const [ignoredIds, setIgnoredIds] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(ignoredChatIds);
  const [isLoading, setIsLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const actionsVisable = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return !(0,lodash__WEBPACK_IMPORTED_MODULE_3__.isEqual)(selectedTemp, originSelectedTemp);
  }, [originSelectedTemp, selectedTemp]);
  const handleTemplateSelect = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(selectedId => {
    let newSelected = [];
    if (selectedTemp.includes(selectedId)) {
      newSelected = selectedTemp.filter(id => id !== selectedId);
    } else {
      if (selectedTemp.length >= 3) {
        antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('You can only select up to three topics.');
        return;
      }
      newSelected = [...selectedTemp, selectedId];
    }
    setSelectedTemp(newSelected);
  }, [selectedTemp]);
  const handleSave = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setIsLoading(true);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_5__.telegptSettings.setSettingOption({
      curious_id: selectedTemp
    }, () => {
      setIsLoading(false);
      setOriginSelectedTemp(selectedTemp);
    });
  }, [selectedTemp]);
  const handleDelete = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(id => {
    if (selectedTemp.includes(id)) {
      const newSelectedTemp = selectedTemp.filter(item => item !== id);
      setSelectedTemp(newSelectedTemp);
      setOriginSelectedTemp(newSelectedTemp);
      _api_user_settings__WEBPACK_IMPORTED_MODULE_5__.telegptSettings.setSettingOption({
        curious_id: newSelectedTemp
      });
    }
    // TODO: delete summary template
    _api_user_settings__WEBPACK_IMPORTED_MODULE_5__.telegptSettings.deleteSummarizeTemplate(id).then(res => {
      if (res.code === 0) {
        const newSummaryTemplate = summaryTemplate.filter(item => item.id !== id);
        setSummaryTemplate(newSummaryTemplate);
      } else {
        antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('delete failed');
      }
    }).catch(() => {
      antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('delete failed');
    });
  }, [selectedTemp, summaryTemplate]);
  const handleIgnored = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(id => {
    const newSelected = [...new Set([...ignoredIds, id])];
    setIgnoredIds(newSelected);
    const entityTypes = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_5__.buildEntityTypeFromIds)(newSelected);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_5__.telegptSettings.setSettingOption({
      ignored_summary_chat_ids: entityTypes
    });
  }, [ignoredIds]);
  const handleUnIgnored = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(id => {
    const newSelected = ignoredIds.filter(item => item !== id);
    setIgnoredIds(newSelected);
    const entityTypes = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_5__.buildEntityTypeFromIds)(newSelected);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_5__.telegptSettings.setSettingOption({
      ignored_summary_chat_ids: entityTypes
    });
  }, [ignoredIds]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-full overflow-hidden relative"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-full flex flex-col px-[18px] overflow-auto"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", {
    className: "text-[18px] font-semibold text-[var(--color-text) mb-[24px]"
  }, "Topic Preferences"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[10px]"
  }, summaryTemplate.map(item => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryItem, {
      key: item.id,
      template: item,
      onDelete: handleDelete,
      selectedTemp: selectedTemp,
      handleSelect: handleTemplateSelect
    });
  }), summaryTemplate.length < 10 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(AddSummaryTemplate, null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_rooms_tab__WEBPACK_IMPORTED_MODULE_6__.RoomsTab, {
    ignoredIds: ignoredIds,
    onIgnored: handleIgnored,
    onUnIgnored: handleUnIgnored,
    title: "Chats for Summary"
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_FloatingActionButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
    isShown: actionsVisable,
    onClick: handleSave
  }, isLoading ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Spinner__WEBPACK_IMPORTED_MODULE_9__["default"], {
    color: "white"
  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
    name: "check",
    className: "text-white text-[1.5rem]"
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SummarizeTab);

/***/ },

/***/ "./src/components/chatAssistant/rightPanel/urgent-alert-tab.scss"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/urgent-alert-tab.scss ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/rightPanel/urgent-alert-tab.tsx"
/*!**********************************************************************!*\
  !*** ./src/components/chatAssistant/rightPanel/urgent-alert-tab.tsx ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/message/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _ai_task_urgent_check_task__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ai-task/urgent-check-task */ "./src/components/chatAssistant/ai-task/urgent-check-task.ts");
/* harmony import */ var _api_user_settings__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../api/user-settings */ "./src/components/chatAssistant/api/user-settings.ts");
/* harmony import */ var _rooms_tab__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./rooms-tab */ "./src/components/chatAssistant/rightPanel/rooms-tab.tsx");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* harmony import */ var _urgent_alert_tab_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./urgent-alert-tab.scss */ "./src/components/chatAssistant/rightPanel/urgent-alert-tab.scss");









const TopicItem = ({
  topic,
  onDelete
}) => {
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_7__.useDrawerStore)();
  const handeleDeleteTopic = () => {
    onDelete(topic.id);
  };
  const handleEditTopic = () => {
    openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_7__.DrawerKey.AddTopicPanel, topic);
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "urgent-topic-item px-[20px] py-[12px] leading-[24px] bg-[var(--color-chat-hover)] rounded-[8px] flex flex-row items-center justify-between gap-[24px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, topic.topic), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "urgent-topic-item-actions flex flex-row gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: "edit",
    className: "text-[14px] cursor-pointer",
    onClick: handleEditTopic
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: "close",
    className: "text-[14px] cursor-pointer",
    onClick: handeleDeleteTopic
  })));
};
const AddTopic = () => {
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_7__.useDrawerStore)();
  const handleAddTopic = () => {
    const {
      subscriptionInfo
    } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
    if ((subscriptionInfo.subscriptionType === 'plus' || subscriptionInfo.subscriptionType === 'pro') && !subscriptionInfo.isExpirated) {
      openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_7__.DrawerKey.AddTopicPanel);
    } else {
      (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)().openPayPackageModal();
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "urgent-topic-item px-[20px] py-[12px] leading-[24px] bg-[var(--color-chat-hover)] rounded-[8px] flex flex-row items-center gap-[8px] text-[var(--color-chat-active)] cursor-pointer",
    onClick: handleAddTopic
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: "add"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, "New Topic"));
};
const UrgentAlertTab = () => {
  const {
    urgent_info,
    ignored_urgent_chat_ids
  } = _api_user_settings__WEBPACK_IMPORTED_MODULE_4__.telegptSettings.telegptSettings;
  const selectUrgentChatIds = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_4__.getIdsFromEntityTypes)(ignored_urgent_chat_ids);
  const [topics, setTopics] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(urgent_info);
  const [ignoredIds, setIgnoredIds] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(selectUrgentChatIds);
  const handeleDeleteTopic = id => {
    _api_user_settings__WEBPACK_IMPORTED_MODULE_4__.telegptSettings.deleteUrgentTopic(id).then(res => {
      if (res.code === 0) {
        setTopics(topics.filter(t => t.id !== id));
      } else {
        antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('delete failed');
      }
    }).catch(() => {
      antd__WEBPACK_IMPORTED_MODULE_1__["default"].info('delete failed');
    });
  };
  const handleIgnored = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(id => {
    const newSelected = [...ignoredIds, id];
    setIgnoredIds(newSelected);
    const entityTypes = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_4__.buildEntityTypeFromIds)(newSelected);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_4__.telegptSettings.setSettingOption({
      ignored_urgent_chat_ids: entityTypes
    });
    _ai_task_urgent_check_task__WEBPACK_IMPORTED_MODULE_3__.urgentCheckTask.updateUrgentChats(newSelected);
  }, [ignoredIds]);
  const handleUnIgnored = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(id => {
    const newSelected = ignoredIds.filter(item => item !== id);
    setIgnoredIds(newSelected);
    const entityTypes = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_4__.buildEntityTypeFromIds)(newSelected);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_4__.telegptSettings.setSettingOption({
      ignored_urgent_chat_ids: entityTypes
    });
    _ai_task_urgent_check_task__WEBPACK_IMPORTED_MODULE_3__.urgentCheckTask.updateUrgentChats(newSelected);
  }, [ignoredIds]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-full overflow-auto px-[18px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", {
    className: "text-[18px] font-semibold mb-[24px]"
  }, "What types of messages require Alert?"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[10px]"
  }, topics.map(topic => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(TopicItem, {
      topic: topic,
      onDelete: handeleDeleteTopic
    });
  }), topics.length < 10 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(AddTopic, null))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_rooms_tab__WEBPACK_IMPORTED_MODULE_5__.RoomsTab, {
    ignoredIds: ignoredIds,
    onIgnored: handleIgnored,
    onUnIgnored: handleUnIgnored,
    title: "Chats for Urgent"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UrgentAlertTab);

/***/ },

/***/ "./src/components/chatAssistant/room-ai/SelectedMessagesBanner.module.scss"
/*!*********************************************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/SelectedMessagesBanner.module.scss ***!
  \*********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"banner":"Lpz4cnTr","content":"jHmSVPJf","label":"ghqaNyFM","messagePreview":"HHDZoWFu","senderName":"fE93kcGh","text":"jHdTURMT","closeButton":"njyqaXRW"});

/***/ },

/***/ "./src/components/chatAssistant/room-ai/SelectedMessagesBanner.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/SelectedMessagesBanner.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _SelectedMessagesBanner_module_scss__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./SelectedMessagesBanner.module.scss */ "./src/components/chatAssistant/room-ai/SelectedMessagesBanner.module.scss");





const SelectedMessagesBanner = ({
  selectedMessages
}) => {
  const {
    clearChatAISelectedMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleClearSelectedMessages = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    clearChatAISelectedMessages({});
  }, [clearChatAISelectedMessages]);
  if (!selectedMessages || selectedMessages.length === 0) {
    return null;
  }
  const message = selectedMessages[0];
  const truncatedContent = message.content.length > 100 ? `${message.content.substring(0, 100)}...` : message.content;
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_SelectedMessagesBanner_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].banner, 'selected-messages-banner')
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: _SelectedMessagesBanner_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].content
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: _SelectedMessagesBanner_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].label
  }, "Selected Message", selectedMessages.length > 1 && ` (+${selectedMessages.length - 1} more)`), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: _SelectedMessagesBanner_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].messagePreview
  }, message.senderName && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: _SelectedMessagesBanner_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].senderName
  }, message.senderName, ":", ' '), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: _SelectedMessagesBanner_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].text
  }, truncatedContent))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("button", {
    color: "translucent",
    onClick: handleClearSelectedMessages,
    className: _SelectedMessagesBanner_module_scss__WEBPACK_IMPORTED_MODULE_3__["default"].closeButton
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("i", {
    className: "icon icon-close"
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SelectedMessagesBanner);

/***/ },

/***/ "./src/components/chatAssistant/room-ai/room-actions.tsx"
/*!***************************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/room-actions.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/popover/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/subscriptionHandler */ "./src/util/subscriptionHandler.ts");
/* harmony import */ var _hook_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../hook/use-scroll-to-bottom */ "./src/components/chatAssistant/hook/use-scroll-to-bottom.tsx");
/* harmony import */ var _room_ai_utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./room-ai-utils */ "./src/components/chatAssistant/room-ai/room-ai-utils.ts");
/* harmony import */ var _room_ai_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./room-ai.scss */ "./src/components/chatAssistant/room-ai/room-ai.scss");








const actionItemClassName = 'py-[6px] px-[12px] border-[1px] border-[#E4E4E4] rounded-[8px] whitespace-nowrap cursor-pointer dark:border-[#292929]';
const RoomActions = ({
  chatId,
  insertMessage,
  setIsLoading
}) => {
  const {
    scrollToBottom
  } = (0,_hook_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_5__.useScrollToBottom)();
  const handleScheduleMeeting = () => {
    setIsLoading(true);
    (0,_room_ai_utils__WEBPACK_IMPORTED_MODULE_6__.scheduleGoogleMeeting)(insertMessage, () => setIsLoading(false));
    scrollToBottom();
  };
  const handleSummarize = () => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_4__.checkCredisBalance)()) {
      (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)().openPayPackageModal();
      return;
    }
    if (chatId) {
      setIsLoading(true);
      (0,_room_ai_utils__WEBPACK_IMPORTED_MODULE_6__.summaryRoomMessage)(chatId, insertMessage, () => setIsLoading(false));
      scrollToBottom();
    }
  };
  const handleMediaSummarize = () => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_4__.checkCredisBalance)()) {
      (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)().openPayPackageModal();
      return;
    }
    const {
      openRoomAttachmentsModal
    } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();
    openRoomAttachmentsModal();
  };
  const handleActionItems = () => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_4__.checkCredisBalance)()) {
      (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)().openPayPackageModal();
      return;
    }
    if (chatId) {
      setIsLoading(true);
      (0,_room_ai_utils__WEBPACK_IMPORTED_MODULE_6__.generateRoomActionItems)(chatId, insertMessage, () => setIsLoading(false));
      scrollToBottom();
    }
  };
  const handleNewFeature = () => {
    const newFeatureMessage = (0,_room_ai_utils__WEBPACK_IMPORTED_MODULE_6__.createNewFeatureReminderMessage)();
    insertMessage(newFeatureMessage);
  };
  const handleActions = payload => {
    const {
      action
    } = payload;
    if (payload.chatId === chatId) {
      switch (action) {
        case 'summary':
          handleSummarize();
          break;
        case 'schedule-meet':
          handleScheduleMeeting();
          break;
        case 'todo':
          handleActionItems();
          break;
        case 'new-feature':
          handleNewFeature();
          break;
        default:
          break;
      }
    }
  };
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__["default"].on(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__.Actions.RoomAIActions, handleActions);
    return () => {
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__["default"].off(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__.Actions.RoomAIActions, handleActions);
    };
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [chatId]);
  const popoverContent = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-3 py-2 rounded-[8px] hover:bg-gray-100 dark:hover:bg-[#2a2a2a] cursor-pointer flex items-center gap-2 text-[14px]",
    onClick: handleSummarize
  }, "\uD83E\uDDE0 Chat Summary"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-3 py-2 rounded-[8px] hover:bg-gray-100 dark:hover:bg-[#2a2a2a] cursor-pointer flex items-center gap-2 text-[14px]",
    onClick: handleMediaSummarize
  }, "\uD83D\uDCC1 Media/File Summary"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-3 py-2 rounded-[8px] hover:bg-gray-100 dark:hover:bg-[#2a2a2a] cursor-pointer flex items-center gap-2 text-[14px]",
    onClick: handleScheduleMeeting
  }, "\uD83D\uDCC5 Schedule meeting"));
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row gap-[6px] mb-[8px] px-[12px] w-full overflow-x-auto scrollbar-none text-[14px] text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: actionItemClassName,
    onClick: handleSummarize
  }, "\uD83E\uDDE0 Chat Summary"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: actionItemClassName,
    onClick: handleActionItems
  }, "\u2705 Action Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    content: popoverContent,
    trigger: "click",
    placement: "bottomLeft",
    overlayClassName: "room-actions-popover"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: actionItemClassName
  }, "\uD83D\uDE80 All")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RoomActions);

/***/ },

/***/ "./src/components/chatAssistant/room-ai/room-ai-input.tsx"
/*!****************************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/room-ai-input.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RoomAIInput: () => (/* binding */ RoomAIInput)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var sonner__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! sonner */ "./node_modules/sonner/dist/index.mjs");
/* harmony import */ var usehooks_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! usehooks-ts */ "./node_modules/usehooks-ts/dist/index.js");
/* harmony import */ var _lib_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../lib/utils */ "./src/lib/utils.ts");
/* harmony import */ var _component_AITextarea__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../component/AITextarea */ "./src/components/chatAssistant/component/AITextarea.tsx");
/* harmony import */ var _component_button__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../component/button */ "./src/components/chatAssistant/component/button.tsx");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../icons */ "./src/components/chatAssistant/icons.tsx");
/* eslint-disable no-null/no-null */










function PureMultimodalInput({
  status,
  stop,
  setMessages,
  handleInputSubmit,
  className
}) {
  const textareaRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const {
    width
  } = (0,usehooks_ts__WEBPACK_IMPORTED_MODULE_3__.useWindowSize)();
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (textareaRef.current) {
      adjustHeight();
    }
  }, []);
  const adjustHeight = () => {
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      textareaRef.current.style.height = `${Math.min(200, Math.max(90, textareaRef.current.scrollHeight + 2))}px`;
    }
  };
  const resetHeight = () => {
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      textareaRef.current.style.height = '90px';
    }
  };
  const [localStorageInput, setLocalStorageInput] = (0,usehooks_ts__WEBPACK_IMPORTED_MODULE_3__.useLocalStorage)('input', '');
  const [inputValue, setInputValue] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [isComposing, setIsComposing] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (textareaRef.current) {
      const domValue = textareaRef.current.value;
      const finalValue = domValue || localStorageInput || '';
      setInputValue(finalValue);
      adjustHeight();
    }
  }, []);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setLocalStorageInput(inputValue);
  }, [inputValue, setLocalStorageInput]);
  const handleInput = event => {
    setInputValue(event.target.value);
    adjustHeight();
  };
  const submitForm = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!inputValue) {
      return;
    }
    handleInputSubmit(inputValue);
    setInputValue('');
    setLocalStorageInput('');
    resetHeight();
    if (width && width > 768) {
      textareaRef.current?.focus();
    }
  }, [handleInputSubmit, inputValue, setLocalStorageInput, width]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "relative w-full flex flex-col gap-4"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_AITextarea__WEBPACK_IMPORTED_MODULE_5__.AITextarea, {
    ref: textareaRef,
    placeholder: "Ask me anything about this chat...",
    value: inputValue,
    onChange: handleInput,
    className: classnames__WEBPACK_IMPORTED_MODULE_1___default()('h-[90px] overflow-y-auto resize-none !text-base !p-0 focus-visible:!ring-0 !ring-offset-0 dark:border-[#2F2F2F] border-none', className),
    rows: 2,
    autoFocus: true,
    onCompositionStart: () => setIsComposing(true),
    onCompositionEnd: () => setIsComposing(false),
    onKeyDown: event => {
      // 
      if (isComposing || event.nativeEvent.isComposing) {
        return;
      }
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        if (status !== 'ready') {
          sonner__WEBPACK_IMPORTED_MODULE_2__.toast.error('Please wait for the model to finish its response!');
        } else {
          submitForm();
        }
      }
    }
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "absolute bottom-0 right-0  w-fit flex flex-row items-center justify-end"
  }, status === 'streaming' ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(StopButton, {
    stop: stop,
    setMessages: setMessages
  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SendButton, {
    input: inputValue,
    submitForm: submitForm
  })));
}
const RoomAIInput = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(PureMultimodalInput, (prevProps, nextProps) => {
  if (prevProps.status !== nextProps.status) return false;
  return true;
});
function PureStopButton({
  stop,
  setMessages
}) {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_button__WEBPACK_IMPORTED_MODULE_6__.Button, {
    onClick: event => {
      event.preventDefault();
      stop();
      setMessages(messages => (0,_lib_utils__WEBPACK_IMPORTED_MODULE_4__.sanitizeUIMessages)(messages));
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_7__.StopIcon, {
    size: 14
  }));
}
const StopButton = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(PureStopButton);
function PureSendButton({
  submitForm,
  input
}) {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_button__WEBPACK_IMPORTED_MODULE_6__.Button, {
    onClick: event => {
      event.preventDefault();
      submitForm();
    },
    disabled: input.length === 0
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("i", {
    className: "icon icon-send text-[#B27AFF] text-[24px]"
  }));
}
const SendButton = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(PureSendButton, (prevProps, nextProps) => {
  if (prevProps.input !== nextProps.input) return false;
  return true;
});

/***/ },

/***/ "./src/components/chatAssistant/room-ai/room-ai-wrapper.tsx"
/*!******************************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/room-ai-wrapper.tsx ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _injectComponent__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../injectComponent */ "./src/components/chatAssistant/injectComponent.tsx");
/* harmony import */ var _room_ai__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./room-ai */ "./src/components/chatAssistant/room-ai/room-ai.tsx");






const RoomAIWrapper = props => {
  const containerRef = (0,_injectComponent__WEBPACK_IMPORTED_MODULE_4__.injectComponent)({
    component: _room_ai__WEBPACK_IMPORTED_MODULE_5__["default"],
    props
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "chat-ai-room flex overflow-hidden",
    ref: containerRef
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)();
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  return {
    chatId,
    selectedMessages: tabState.chatAISelectedMessages
  };
})(RoomAIWrapper)));

/***/ },

/***/ "./src/components/chatAssistant/room-ai/room-ai.scss"
/*!***********************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/room-ai.scss ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/room-ai/room-ai.tsx"
/*!**********************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/room-ai.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! uuid */ "./node_modules/uuid/dist/esm-browser/v4.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _messages_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../messages/types */ "./src/components/chatAssistant/messages/types.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _util_browser_idb__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/browser/idb */ "./src/util/browser/idb.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _agent_useAgentChat__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../agent/useAgentChat */ "./src/components/chatAssistant/agent/useAgentChat.ts");
/* harmony import */ var _hook_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../hook/use-scroll-to-bottom */ "./src/components/chatAssistant/hook/use-scroll-to-bottom.tsx");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../messages */ "./src/components/chatAssistant/messages.tsx");
/* harmony import */ var _room_storage__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../room-storage */ "./src/components/chatAssistant/room-storage/index.tsx");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _store_messages_store__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../store/messages-store */ "./src/components/chatAssistant/store/messages-store.ts");
/* harmony import */ var _utils_intro_message_manager__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../utils/intro-message-manager */ "./src/components/chatAssistant/utils/intro-message-manager.ts");
/* harmony import */ var _room_actions__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./room-actions */ "./src/components/chatAssistant/room-ai/room-actions.tsx");
/* harmony import */ var _room_ai_input__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./room-ai-input */ "./src/components/chatAssistant/room-ai/room-ai-input.tsx");
/* harmony import */ var _room_ai_utils__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./room-ai-utils */ "./src/components/chatAssistant/room-ai/room-ai-utils.ts");
/* harmony import */ var _SelectedMessagesBanner__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./SelectedMessagesBanner */ "./src/components/chatAssistant/room-ai/SelectedMessagesBanner.tsx");
/* harmony import */ var _room_ai_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./room-ai.scss */ "./src/components/chatAssistant/room-ai/room-ai.scss");
/* harmony import */ var _room_ai_module_scss__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./room-ai.module.scss */ "./src/components/chatAssistant/room-ai/room-ai.module.scss");
/* eslint-disable no-null/no-null */





















const RoomAIInner = props => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();
  const {
    chatId,
    selectedMessages
  } = props;
  const [pageInfo, setPageInfo] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({
    lastTime: undefined,
    hasMore: true
  });
  const [isLoading, setIsLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const tokenRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const {
    scrollToBottom,
    scrollLocked,
    isScrollLock
  } = (0,_hook_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_8__.useScrollToBottom)();

  // 
  const storeMessagesToDB = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(messagesToStore => {
    if (!chatId) return;
    const messagesArray = Array.isArray(messagesToStore) ? messagesToStore : [messagesToStore];
    const storeMsgs = (0,_store_messages_store__WEBPACK_IMPORTED_MODULE_12__.parseMessage2StoreMessage)(chatId, messagesArray);
    storeMsgs.forEach(msg => {
      _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.storeMessage(msg);
    });
  }, [chatId]);
  const {
    messages,
    setMessages,
    append,
    stop,
    status,
    currentPhase,
    toolCalls
  } = (0,_agent_useAgentChat__WEBPACK_IMPORTED_MODULE_7__.useAgentChat)({
    chatId,
    selectedMessages,
    showThinking: false,
    showToolCalls: true,
    detailedCitations: true,
    onError: error => {
      try {
        const data = JSON.parse(error.message);
        if (data.code === 102 || data.code === 103) {
          const upgradeTip = (0,_room_ai_utils__WEBPACK_IMPORTED_MODULE_16__.createUpgradeTipMessage)();
          setMessages(prev => [...prev, upgradeTip]);
          storeMessagesToDB(upgradeTip);
        }
      } catch (e) {
        showNotification({
          message: error.message || 'An error occurred'
        });
      }
    },
    onFinish: result => {
      // eslint-disable-next-line no-console
      console.log('[RoomAI] Finished:', result);
      // AI  assistant 
      //  setMessages  messages
      setMessages(prev => {
        const lastMessage = prev[prev.length - 1];
        if (lastMessage && lastMessage.role === 'assistant') {
          storeMessagesToDB(lastMessage);
        }
        return prev;
      });
    }
  });
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isScrollLock) {
      scrollToBottom();
    }
  }, [isScrollLock, messages, scrollToBottom]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _util_browser_idb__WEBPACK_IMPORTED_MODULE_5__.CHATAI_IDB_STORE.get('google-token').then(token => {
      if (token) {
        tokenRef.current = token;
      }
    });
  }, []);
  const handleAddSummaryMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(message => {
    setMessages(prev => {
      const index = prev.findIndex(item => item.id === message.id);
      if (index !== -1) {
        const newMessages = [...prev];
        newMessages[index] = message;
        storeMessagesToDB(message);
        return newMessages;
      }
      storeMessagesToDB(message);
      return [...prev, message];
    });
  }, [setMessages, storeMessagesToDB]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].on(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.AddRoomAIMessage, handleAddSummaryMessage);
    return () => {
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].off(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.AddRoomAIMessage, handleAddSummaryMessage);
    };
  }, [handleAddSummaryMessage]);
  const initDate = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setMessages([]);
    setPageInfo({
      lastTime: undefined,
      hasMore: true
    });
  }, [setMessages]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId) {
      initDate();

      //  IntroMessage
      const introMessageId = `intro-message-${chatId}`;
      _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.getMessage(introMessageId).then(async existingIntro => {
        if (!existingIntro) {
          //  IntroMessage
          const introMessage = _utils_intro_message_manager__WEBPACK_IMPORTED_MODULE_13__["default"].getIntroMessage(chatId);
          const storeMsgs = (0,_store_messages_store__WEBPACK_IMPORTED_MODULE_12__.parseMessage2StoreMessage)(chatId, [introMessage]);
          storeMsgs.forEach(msg => {
            _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.storeMessage(msg);
          });
        }

        // 
        const res = await _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.getMessages(chatId, undefined, 10);
        if (res && res.messages) {
          const localChatAiMessages = (0,_store_messages_store__WEBPACK_IMPORTED_MODULE_12__.parseStoreMessage2Message)(res.messages);
          setMessages(localChatAiMessages);
          setPageInfo({
            lastTime: res.lastTime,
            hasMore: res.hasMore
          });
        }

        // 
        requestAnimationFrame(() => {
          scrollToBottom('instant');
        });
      });
      _room_storage__WEBPACK_IMPORTED_MODULE_10__["default"].updateRoomAIData(chatId, 'unreadCount', 0);
    }
  }, [chatId, initDate, setMessages, scrollToBottom]);
  const handleLoadMore = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    scrollLocked();
    return new Promise(resolve => {
      if (chatId) {
        _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.getMessages(chatId, pageInfo?.lastTime, 10)?.then(res => {
          if (res.messages) {
            const localChatAiMessages = (0,_store_messages_store__WEBPACK_IMPORTED_MODULE_12__.parseStoreMessage2Message)(res.messages);
            setMessages(prev => [...localChatAiMessages, ...prev]);
          }
          setPageInfo({
            lastTime: res.lastTime,
            hasMore: res.hasMore
          });
          resolve();
        });
      }
    });
  }, [chatId, pageInfo?.lastTime, scrollLocked, setMessages]);
  const insertMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(message => {
    setMessages(prev => [...prev, message]);
    storeMessagesToDB(message);
  }, [setMessages, storeMessagesToDB]);
  const handleCreateCalendarSuccess = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(payload => {
    const {
      message,
      response
    } = payload;
    if (response?.error) {
      showNotification({
        message: response.error?.message || 'Create Calendar Failed'
      });
      if (response.error?.code === 401 || response.error?.code === 403) {
        _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.delMessage(message?.id);
        const newMessage = messages.filter(item => item.id !== message?.id);
        setMessages(newMessage);
        const loginMessage = (0,_room_ai_utils__WEBPACK_IMPORTED_MODULE_16__.createGoogleLoginMessage)();
        insertMessage(loginMessage);
      }
    } else {
      _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.delMessage(message?.id);
      const newMessage = messages.filter(item => item.id !== message?.id);
      const appendMessage = [{
        id: (0,uuid__WEBPACK_IMPORTED_MODULE_1__["default"])(),
        role: 'assistant',
        content: 'I\'ll send the meeting invitation shortly. Please check your inbox in the next few minutes.',
        createdAt: new Date(),
        type: _messages_types__WEBPACK_IMPORTED_MODULE_3__.AIMessageType.Default
      }, {
        id: (0,uuid__WEBPACK_IMPORTED_MODULE_1__["default"])(),
        role: 'teleai-system',
        content: JSON.stringify({
          chatId,
          eventData: response
        }),
        createdAt: new Date(),
        type: _messages_types__WEBPACK_IMPORTED_MODULE_3__.AIMessageType.GoogleEventDetail
      }];
      const mergeMesssage = [...newMessage, ...appendMessage];
      setMessages(mergeMesssage);
      // 
      storeMessagesToDB(appendMessage);
    }
  }, [chatId, insertMessage, messages, setMessages, storeMessagesToDB]);
  const updateToken = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(payload => {
    const {
      message,
      token
    } = payload;
    tokenRef.current = token;
    if (message) {
      _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.delMessage(message.id);
      setMessages(prev => prev.filter(item => item.id !== message.id));
    }
  }, [setMessages]);
  const handleGoogleAuthSuccess = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    insertMessage((0,_room_ai_utils__WEBPACK_IMPORTED_MODULE_16__.createGoogleMeetingMessage)());
  }, [insertMessage]);
  const handleInputSubmit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(value => {
    scrollToBottom();
    const newMessage = {
      role: 'user',
      content: value,
      id: (0,uuid__WEBPACK_IMPORTED_MODULE_1__["default"])(),
      createdAt: new Date(),
      type: _messages_types__WEBPACK_IMPORTED_MODULE_3__.AIMessageType.Default,
      timestamp: Date.now()
    };
    append(newMessage);
    // 
    storeMessagesToDB(newMessage);
  }, [append, scrollToBottom, storeMessagesToDB]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].on(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.CreateCalendarSuccess, handleCreateCalendarSuccess);
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].on(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.UpdateGoogleToken, updateToken);
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].on(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.GoogleAuthSuccess, handleGoogleAuthSuccess);
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].on(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.AskRoomAI, handleInputSubmit);
    return () => {
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].off(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.CreateCalendarSuccess, handleCreateCalendarSuccess);
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].off(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.UpdateGoogleToken, updateToken);
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].off(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.GoogleAuthSuccess, handleGoogleAuthSuccess);
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__["default"].off(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_4__.Actions.AskRoomAI, handleInputSubmit);
    };
  }, [handleCreateCalendarSuccess, handleGoogleAuthSuccess, handleInputSubmit, updateToken]);
  const deleteMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(messageId => {
    _store__WEBPACK_IMPORTED_MODULE_11__.ChataiStores.message?.delMessage(messageId).then(() => {
      setMessages(prev => prev.filter(message => message.id !== messageId));
    });
  }, [setMessages]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_room_ai_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].rightPanelBg, 'right-panel-chat-ai')
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages__WEBPACK_IMPORTED_MODULE_9__.Messages, {
    className: "chat-ai-output-wrapper flex-1",
    isLoading: isLoading,
    status: status,
    messages: messages,
    currentPhase: currentPhase,
    toolCalls: toolCalls,
    deleteMessage: deleteMessage,
    loadMore: handleLoadMore,
    hasMore: pageInfo.hasMore,
    chatId: chatId
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[16px] pb-4"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_room_actions__WEBPACK_IMPORTED_MODULE_14__["default"], {
    setIsLoading: status => setIsLoading(status),
    insertMessage: insertMessage,
    chatId: chatId
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-2 w-full rounded-[20px] border border-[#E5E5E5] bg-white dark:bg-black px-[14px] py-[10px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, selectedMessages && selectedMessages.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_SelectedMessagesBanner__WEBPACK_IMPORTED_MODULE_17__["default"], {
    selectedMessages: selectedMessages
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_room_ai_input__WEBPACK_IMPORTED_MODULE_15__.RoomAIInput, {
    status: status,
    stop: stop,
    setMessages: setMessages,
    handleInputSubmit: handleInputSubmit
  })))));
};
const RoomAI = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(RoomAIInner, (prevProps, nextProps) => {
  if (prevProps.chatId !== nextProps.chatId) return false;
  if (prevProps.selectedMessages !== nextProps.selectedMessages) return false;
  return true;
});
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RoomAI);

/***/ },

/***/ "./src/components/chatAssistant/room-ai/room-attachments-modal.scss"
/*!**************************************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/room-attachments-modal.scss ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/room-ai/room-attachments-modal.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/room-attachments-modal.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../utils/ai-analyse-message */ "./src/components/chatAssistant/utils/ai-analyse-message.ts");
/* harmony import */ var _hooks_useCacheBuster__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useCacheBuster */ "./src/hooks/useCacheBuster.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _right_hooks_useTransitionFixes__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../right/hooks/useTransitionFixes */ "./src/components/right/hooks/useTransitionFixes.ts");
/* harmony import */ var _common_Document__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/Document */ "./src/components/common/Document.tsx");
/* harmony import */ var _common_Media__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/Media */ "./src/components/common/Media.tsx");
/* harmony import */ var _common_NothingFound__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/NothingFound */ "./src/components/common/NothingFound.tsx");
/* harmony import */ var _common_WebLink__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../common/WebLink */ "./src/components/common/WebLink.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _room_attachments_modal_scss__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./room-attachments-modal.scss */ "./src/components/chatAssistant/room-ai/room-attachments-modal.scss");

























const TABS = [{
  type: 'media',
  key: 'ProfileTabMedia'
}, {
  type: 'documents',
  key: 'ProfileTabFiles'
}, {
  type: 'links',
  key: 'ProfileTabLinks'
}];
const RoomAttachmentsModal = ({
  messagesById,
  foundIds,
  mediaSearchType,
  isChatProtected,
  nextProfileTab,
  isOpen,
  onClose
}) => {
  const {
    setSharedMediaSearchType,
    searchSharedMediaMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const transitionRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const tabs = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const arr = [];
    arr.push(...TABS);
    return arr.map(tab => ({
      type: tab.type,
      title: lang(tab.key)
    }));
  }, [lang]);
  const initialTab = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!nextProfileTab) {
      return 0;
    }
    const index = tabs.findIndex(({
      type
    }) => type === nextProfileTab);
    return index === -1 ? 0 : index;
  }, [nextProfileTab, tabs]);
  const [activeTab, setActiveTab] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(initialTab);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!nextProfileTab) return;
    const index = tabs.findIndex(({
      type
    }) => type === nextProfileTab);
    if (index === -1) return;
    setActiveTab(index);
  }, [nextProfileTab, tabs]);
  const handleSwitchTab = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(index => {
    setActiveTab(index);
  }, []);
  const renderingActiveTab = activeTab > tabs.length - 1 ? tabs.length - 1 : activeTab;
  const tabType = tabs[renderingActiveTab].type;

  // viewportmediadocumentslinks
  const resultType = tabType === 'members' || !mediaSearchType ? tabType : mediaSearchType;

  // foundIdsviewportIds
  const viewportIds = foundIds;
  const getMore = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    if (searchSharedMediaMessages) {
      searchSharedMediaMessages();
    }
  });
  const isFirstTab = resultType === 'media';
  const activeKey = tabs.findIndex(({
    type
  }) => type === resultType);
  const {
    applyTransitionFix,
    releaseTransitionFix
  } = (0,_right_hooks_useTransitionFixes__WEBPACK_IMPORTED_MODULE_14__["default"])(containerRef);
  const [cacheBuster, resetCacheBuster] = (0,_hooks_useCacheBuster__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const {
    observe: observeIntersectionForMedia
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_10__.useIntersectionObserver)({
    rootRef: containerRef
  });
  const handleTransitionStop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    releaseTransitionFix();
    resetCacheBuster();
  });

  // Update search type when switching tabs or forum topics
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setSharedMediaSearchType({
      mediaType: tabType
    });
  }, [setSharedMediaSearchType, tabType]);
  const handleSelectMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(messageId => {
    const message = messagesById?.[messageId];
    if (message) {
      const {
        photo,
        document,
        webPage,
        text,
        video
      } = message.content;
      const isUrl = (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_8__.checkIsUrl)(text?.text);
      if (photo) {
        (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_8__.photoSummary)(message);
      } else if (webPage || isUrl) {
        (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_8__.webPageSummary)(message);
      } else if (document) {
        (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_8__.documentSummary)(message);
      } else if (video) {
        (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_8__.videoSummary)(message);
      }
      onClose();
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!transitionRef.current || !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_7__.captureEvents)(transitionRef.current, {
      selectorToPreventScroll: '.Profile',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_7__.SwipeDirection.Left) {
          setActiveTab(Math.min(renderingActiveTab + 1, tabs.length - 1));
          return true;
        } else if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_7__.SwipeDirection.Right) {
          setActiveTab(Math.max(0, renderingActiveTab - 1));
          return true;
        }
        return false;
      }
    });
  }, [renderingActiveTab, tabs.length]);
  function renderContent() {
    if (!viewportIds || !messagesById) {
      const noSpinner = isFirstTab;
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "content empty-list"
      }, !noSpinner && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_21__["default"], null));
    }
    const isViewportIdsEmpty = viewportIds && !viewportIds?.length;
    if (isViewportIdsEmpty) {
      let text;
      switch (resultType) {
        case 'documents':
          text = oldLang('lng_media_file_empty');
          break;
        case 'links':
          text = oldLang('lng_media_link_empty');
          break;
        default:
          text = oldLang('SharedMedia.EmptyTitle');
      }
      return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "content empty-list"
      }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_NothingFound__WEBPACK_IMPORTED_MODULE_17__["default"], {
        text: text
      }));
    }
    return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: `content ${resultType}-list`,
      dir: oldLang.isRtl && resultType === 'media' ? 'rtl' : undefined,
      teactFastList: true
    }, resultType === 'media' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Media__WEBPACK_IMPORTED_MODULE_16__["default"], {
      key: id,
      message: messagesById[id],
      isProtected: isChatProtected || messagesById[id].isProtected,
      observeIntersection: observeIntersectionForMedia,
      onClick: () => handleSelectMedia(id)
    })) : resultType === 'documents' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Document__WEBPACK_IMPORTED_MODULE_15__["default"], {
      key: id,
      document: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageDocument)(messagesById[id]),
      withDate: true,
      smaller: true,
      className: "scroll-item",
      message: messagesById[id],
      observeIntersection: observeIntersectionForMedia,
      canAutoLoad: true,
      autoLoadFileMaxSizeMb: _config__WEBPACK_IMPORTED_MODULE_2__.SHARED_MEDIA_SLICE,
      onSelect: () => handleSelectMedia(id)
    })) : resultType === 'links' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_WebLink__WEBPACK_IMPORTED_MODULE_18__["default"], {
      key: id,
      message: messagesById[id],
      isProtected: isChatProtected || messagesById[id].isProtected,
      onlyWebPage: true,
      observeIntersection: observeIntersectionForMedia,
      onMessageClick: () => handleSelectMedia(id)
    })) : undefined);
  }

  // 
  if (!isOpen) {
    return undefined;
  }
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Modal__WEBPACK_IMPORTED_MODULE_20__["default"], {
    isOpen: isOpen,
    onClose: onClose,
    className: "room-attachments-modal",
    title: "Select a file",
    hasCloseButton: true
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: containerRef,
    className: "profile-container"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "shared-media"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('profile-content-wrapper', 'no-selection')
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "shared-media-wrapper"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "shared-media-header"
  }, tabs.length > 1 && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TabList__WEBPACK_IMPORTED_MODULE_22__["default"], {
    tabs: tabs,
    activeTab: activeKey,
    onSwitchTab: handleSwitchTab
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_23__["default"], {
    ref: transitionRef,
    name: "slide",
    activeKey: activeKey,
    renderCount: tabs.length,
    className: "shared-media-transition",
    onStart: applyTransitionFix,
    onStop: handleTransitionStop
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_19__["default"], {
    className: "shared-media-list",
    items: viewportIds,
    onLoadMore: getMore,
    cacheBuster: cacheBuster,
    noScrollRestore: activeTab !== activeKey,
    noFastList: true
  }, renderContent())))))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    chatId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global) || {};
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const {
    currentType: mediaSearchType,
    resultsByType
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentSharedMediaSearch)(global) || {};
  const {
    foundIds
  } = resultsByType && mediaSearchType && resultsByType[mediaSearchType] || {};
  const messagesById = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessages)(global, chatId);
  const {
    nextProfileTab
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const isRightColumnShown = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsRightColumnShown)(global);
  return {
    chatId: chatId,
    messagesById,
    foundIds,
    mediaSearchType,
    chatsById: global.chats.byId,
    usersById: global.users.byId,
    userStatusesById: global.users.statusesById,
    isRightColumnShown,
    isChatProtected: chat?.isProtected,
    nextProfileTab
  };
})(RoomAttachmentsModal)));

/***/ },

/***/ "./src/components/chatAssistant/utils/intro-message-manager.ts"
/*!*********************************************************************!*\
  !*** ./src/components/chatAssistant/utils/intro-message-manager.ts ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _global_summary_summary_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../global-summary/summary-utils */ "./src/components/chatAssistant/global-summary/summary-utils.ts");
/* harmony import */ var _room_ai_room_ai_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../room-ai/room-ai-utils */ "./src/components/chatAssistant/room-ai/room-ai-utils.ts");
/* harmony import */ var _variables__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../variables */ "./src/components/chatAssistant/variables.ts");




/**
 * 
 *  chat 
 *  ID
 */
class IntroMessageManager {
  /**
   *  chatId 
   * 
   */
  static getIntroMessage(chatId) {
    // 
    const introMessage = chatId === _variables__WEBPACK_IMPORTED_MODULE_2__.GLOBAL_SUMMARY_CHATID ? (0,_global_summary_summary_utils__WEBPACK_IMPORTED_MODULE_0__.createGlobalIntroduceMessage)() : (0,_room_ai_room_ai_utils__WEBPACK_IMPORTED_MODULE_1__.createRoomDescriptionMessage)(chatId);
    return introMessage;
  }
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (IntroMessageManager);

/***/ },

/***/ "./src/components/common/AboutMonetizationModal.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/common/AboutMonetizationModal.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const AboutMonetizationModalAsync = props => {
  const {
    isOpen
  } = props;
  const AboutMonetizationModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AboutMonetizationModal', !isOpen);
  return AboutMonetizationModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AboutMonetizationModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AboutMonetizationModalAsync);

/***/ },

/***/ "./src/components/common/CustomEmojiSetsModal.async.tsx"
/*!**************************************************************!*\
  !*** ./src/components/common/CustomEmojiSetsModal.async.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const CustomEmojiSetsModalAsync = props => {
  const {
    customEmojiSetIds
  } = props;
  const CustomEmojiSetsModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CustomEmojiSetsModal', !customEmojiSetIds);
  return CustomEmojiSetsModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CustomEmojiSetsModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CustomEmojiSetsModalAsync);

/***/ },

/***/ "./src/components/common/DeleteMessageModal.async.tsx"
/*!************************************************************!*\
  !*** ./src/components/common/DeleteMessageModal.async.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const DeleteMessageModalAsync = props => {
  const {
    isOpen
  } = props;
  const DeleteMessageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'DeleteMessageModal', !isOpen);
  return DeleteMessageModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(DeleteMessageModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DeleteMessageModalAsync);

/***/ },

/***/ "./src/components/common/PreviewMedia.tsx"
/*!************************************************!*\
  !*** ./src/components/common/PreviewMedia.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useMediaTransitionDeprecated */ "./src/hooks/useMediaTransitionDeprecated.ts");
/* harmony import */ var _Media_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./Media.scss */ "./src/components/common/Media.scss");












const PreviewMedia = ({
  media,
  idPrefix = 'preview-media',
  isProtected,
  observeIntersection,
  onClick,
  index
}) => {
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_6__.useIsIntersecting)(ref, observeIntersection);
  const thumbDataUri = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_5__["default"])(media);
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_4__["default"])(media, 'preview');
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_8__["default"])(mediaHash, !isIntersecting);
  const transitionClassNames = (0,_hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_9__["default"])(mediaBlobUrl);
  const video = media.content.video;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    onClick(index);
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    id: `${idPrefix}${index}`,
    className: "Media scroll-item",
    onClick: handleClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: thumbDataUri,
    className: "media-miniature",
    alt: "",
    draggable: !isProtected,
    decoding: "async",
    onContextMenu: isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_3__["default"] : undefined
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: mediaBlobUrl,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('full-media', 'media-miniature', transitionClassNames),
    alt: "",
    draggable: !isProtected,
    decoding: "async",
    onContextMenu: isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_3__["default"] : undefined
  }), video && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "video-duration"
  }, video.isGif ? 'GIF' : (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatMediaDuration)(video.duration)), isProtected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PreviewMedia));

/***/ },

/***/ "./src/components/common/PrivacySettingsNoticeModal.async.tsx"
/*!********************************************************************!*\
  !*** ./src/components/common/PrivacySettingsNoticeModal.async.tsx ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PrivacySettingsNoticeModalAsync = props => {
  const {
    isOpen
  } = props;
  const PrivacySettingsNoticeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PrivacySettingsNoticeModal', !isOpen);
  return PrivacySettingsNoticeModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PrivacySettingsNoticeModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PrivacySettingsNoticeModalAsync);

/***/ },

/***/ "./src/components/common/SeenByModal.async.tsx"
/*!*****************************************************!*\
  !*** ./src/components/common/SeenByModal.async.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SeenByModalAsync = props => {
  const {
    isOpen
  } = props;
  const SeenByModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SeenByModal', !isOpen);
  return SeenByModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SeenByModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SeenByModalAsync);

/***/ },

/***/ "./src/components/common/StickerSetModal.async.tsx"
/*!*********************************************************!*\
  !*** ./src/components/common/StickerSetModal.async.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StickerSetModalAsync = props => {
  const {
    isOpen
  } = props;
  const StickerSetModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StickerSetModal', !isOpen);
  return StickerSetModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StickerSetModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StickerSetModalAsync);

/***/ },

/***/ "./src/components/common/UnpinAllMessagesModal.async.tsx"
/*!***************************************************************!*\
  !*** ./src/components/common/UnpinAllMessagesModal.async.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const UnpinAllMessagesModalAsync = props => {
  const {
    isOpen
  } = props;
  const UnpinAllMessagesModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'UnpinAllMessagesModal', !isOpen);
  return UnpinAllMessagesModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(UnpinAllMessagesModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UnpinAllMessagesModalAsync);

/***/ },

/***/ "./src/components/common/UnreadCounter.tsx"
/*!*************************************************!*\
  !*** ./src/components/common/UnreadCounter.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_appBadge__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/appBadge */ "./src/util/appBadge.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");







const UnreadCounter = ({
  isForAppBadge
}) => {
  (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_4__.useFolderManagerForUnreadCounters)();
  const unreadNotificationsCount = (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_2__.getAllNotificationsCount)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isForAppBadge) {
      (0,_util_appBadge__WEBPACK_IMPORTED_MODULE_1__.updateAppBadge)(unreadNotificationsCount);
    }
  }, [isForAppBadge, unreadNotificationsCount]);
  if (isForAppBadge || !unreadNotificationsCount) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "unread-count active"
  }, (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatIntegerCompact)(lang, unreadNotificationsCount));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(UnreadCounter));

/***/ },

/***/ "./src/components/common/VerificationMonetizationModal.async.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/common/VerificationMonetizationModal.async.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const VerificationMonetizationModalAsync = props => {
  const {
    modal
  } = props;
  const VerificationMonetizationModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'VerificationMonetizationModal', !modal);
  return VerificationMonetizationModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(VerificationMonetizationModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (VerificationMonetizationModalAsync);

/***/ },

/***/ "./src/components/common/gift/SavedGift.module.scss"
/*!**********************************************************!*\
  !*** ./src/components/common/gift/SavedGift.module.scss ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"HN4dYXIk","star":"LLQBJODm","priceBadge":"haa6STaT","topIcon":"_TMVTkD4","hiddenGift":"xY4yqqYA","radialPattern":"_I9aOdGr","stickerWrapper":"NYuBBB9j"});

/***/ },

/***/ "./src/components/common/gift/SavedGift.tsx"
/*!**************************************************!*\
  !*** ./src/components/common/gift/SavedGift.tsx ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment.ts */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/objects/customPeer */ "./src/util/objects/customPeer.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _helpers_gifts__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useFlag_ts__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useFlag.ts */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _GiftMenuItems__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./GiftMenuItems */ "./src/components/common/gift/GiftMenuItems.tsx");
/* harmony import */ var _GiftRibbon__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./GiftRibbon */ "./src/components/common/gift/GiftRibbon.tsx");
/* harmony import */ var _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./SavedGift.module.scss */ "./src/components/common/gift/SavedGift.module.scss");

























const GIFT_STICKER_SIZE = 90;
const SavedGift = ({
  peerId,
  gift,
  style,
  fromPeer,
  currentUserId,
  hasAdminRights,
  collectibleEmojiStatuses,
  currentUserEmojiStatus,
  observeIntersection
}) => {
  const {
    openGiftInfoModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const stickerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const [isHover, markHover, unmarkHover] = (0,_hooks_useFlag_ts__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const canManage = peerId === currentUserId || hasAdminRights;
  const totalIssued = (0,_helpers_gifts__WEBPACK_IMPORTED_MODULE_10__.getTotalGiftAvailability)(gift.gift);
  const starGift = gift.gift;
  const starGiftUnique = starGift.type === 'starGiftUnique' ? starGift : undefined;
  const resellPrice = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!starGiftUnique?.resellPrice) return undefined;
    if (starGiftUnique.resaleTonOnly) {
      return starGiftUnique.resellPrice.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE);
    }
    return starGiftUnique.resellPrice.find(amount => amount.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE);
  }, [starGiftUnique]);
  const ribbonText = (() => {
    if (starGiftUnique?.resellPrice) {
      return lang('GiftRibbonSale');
    }
    if (gift.isPinned && starGiftUnique) {
      return lang('GiftSavedNumber', {
        number: starGiftUnique.number
      });
    }
    if (totalIssued) {
      return lang('ActionStarGiftLimitedRibbon', {
        total: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_9__.formatIntegerCompact)(lang, totalIssued)
      });
    }
    return undefined;
  })();
  const ribbonColor = starGiftUnique?.resellPrice ? 'green' : 'blue';
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_11__["default"])(ref);
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => ref.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => ref.current.closest('.custom-scroll'));
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => document.querySelector('#portals')?.querySelector('.saved-gift-context-menu .bubble'));
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => ({
    withPortal: true
  }));
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openGiftInfoModal({
      peerId,
      gift
    });
  });
  const avatarPeer = gift.isNameHidden && !fromPeer ? _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_8__.CUSTOM_PEER_HIDDEN : fromPeer;
  const sticker = (0,_helpers_gifts__WEBPACK_IMPORTED_MODULE_10__.getStickerFromGift)(gift.gift);
  const giftAttributes = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_helpers_gifts__WEBPACK_IMPORTED_MODULE_10__.getGiftAttributes)(gift.gift), [gift.gift]);
  const {
    backdrop,
    pattern
  } = giftAttributes || {};
  const radialPatternBackdrop = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!backdrop || !pattern) {
      return undefined;
    }
    const backdropColors = [backdrop.centerColor, backdrop.edgeColor];
    const patternColor = backdrop.patternColor;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_20__["default"], {
      className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].radialPattern,
      backgroundColors: backdropColors,
      patternColor: patternColor,
      patternIcon: pattern.sticker
    });
  }, [backdrop, pattern]);
  if (!sticker) return undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('interactive-gift scroll-item', _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].root),
    style: style,
    onClick: handleClick,
    onContextMenu: handleContextMenu,
    onMouseDown: handleBeforeContextMenu,
    onMouseEnter: !_util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? markHover : undefined,
    onMouseLeave: !_util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV ? unmarkHover : undefined
  }, radialPatternBackdrop, !radialPatternBackdrop && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Avatar__WEBPACK_IMPORTED_MODULE_18__["default"], {
    className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].topIcon,
    peer: avatarPeer,
    size: "micro"
  }), gift.isPinned && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    name: "pinned-message",
    className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].topIcon
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: stickerRef,
    className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].stickerWrapper,
    style: `width: ${GIFT_STICKER_SIZE}px; height: ${GIFT_STICKER_SIZE}px`
  }, sticker && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_StickerView__WEBPACK_IMPORTED_MODULE_15__["default"], {
    containerRef: stickerRef,
    sticker: sticker,
    size: GIFT_STICKER_SIZE,
    shouldLoop: isHover,
    shouldPreloadPreview: true,
    observeIntersectionForPlaying: observeIntersection,
    observeIntersectionForLoading: observeIntersection
  })), gift.isUnsaved && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].hiddenGift
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    name: "eye-crossed-outline"
  })), resellPrice && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_16__["default"], {
    className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].priceBadge,
    nonInteractive: true,
    size: "tiny",
    withSparkleEffect: true,
    pill: true,
    fluid: true
  }, resellPrice.currency === 'TON' ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_7__.formatTonAsIcon)(lang, resellPrice.amount, {
    shouldConvertFromNanos: true,
    className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].star
  }) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_7__.formatStarsAsIcon)(lang, resellPrice.amount, {
    asFont: true,
    className: _SavedGift_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].star
  })), ribbonText && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_GiftRibbon__WEBPACK_IMPORTED_MODULE_22__["default"], {
    color: ribbonColor,
    text: ribbonText
  }), contextMenuAnchor !== undefined && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_17__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuAnchor,
    className: "saved-gift-context-menu",
    autoClose: true,
    withPortal: true,
    getMenuElement: getMenuElement,
    getTriggerElement: getTriggerElement,
    getRootElement: getRootElement,
    getLayout: getLayout,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_GiftMenuItems__WEBPACK_IMPORTED_MODULE_21__["default"], {
    peerId: peerId,
    gift: gift,
    canManage: canManage,
    collectibleEmojiStatuses: collectibleEmojiStatuses,
    currentUserEmojiStatus: currentUserEmojiStatus
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId,
  gift
}) => {
  const fromPeer = gift.fromId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, gift.fromId) : undefined;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, peerId);
  const hasAdminRights = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getHasAdminRight)(chat, 'postMessages');
  const currentUserId = global.currentUserId;
  const currentUser = currentUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, currentUserId) : undefined;
  const currentUserEmojiStatus = currentUser?.emojiStatus;
  const collectibleEmojiStatuses = global.collectibleEmojiStatuses?.statuses;
  return {
    fromPeer,
    hasAdminRights,
    currentUserId,
    currentUserEmojiStatus,
    collectibleEmojiStatuses
  };
})(SavedGift)));

/***/ },

/***/ "./src/components/left/ArchivedChats.async.tsx"
/*!*****************************************************!*\
  !*** ./src/components/left/ArchivedChats.async.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const ArchivedChatsAsync = props => {
  const ArchivedChats = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ArchivedChats');
  return ArchivedChats ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ArchivedChats, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ArchivedChatsAsync);

/***/ },

/***/ "./src/components/left/ConnectionStatusOverlay.scss"
/*!**********************************************************!*\
  !*** ./src/components/left/ConnectionStatusOverlay.scss ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/left/ConnectionStatusOverlay.tsx"
/*!*********************************************************!*\
  !*** ./src/components/left/ConnectionStatusOverlay.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../hooks/useConnectionStatus */ "./src/hooks/useConnectionStatus.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ConnectionStatusOverlay_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ConnectionStatusOverlay.scss */ "./src/components/left/ConnectionStatusOverlay.scss");









const ConnectionStatusOverlay = ({
  connectionStatus,
  connectionStatusText,
  onClick
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_2__["default"])();
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "ConnectionStatusOverlay",
    dir: lang.isRtl ? 'rtl' : undefined,
    onClick: onClick
  }, connectionStatus !== _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_1__.ConnectionStatus.offline && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_5__["default"], {
    color: "black"
  }), connectionStatus === _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_1__.ConnectionStatus.offline ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "state-text offline"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_6__["default"], {
    activeKey: connectionStatus,
    name: "slideFade"
  }, "Network unavailable. Please Check your network.")) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "state-text"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_6__["default"], {
    activeKey: connectionStatus,
    name: "slideFade"
  }, connectionStatusText)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_4__["default"], {
    round: true,
    size: "tiny",
    color: "translucent-black"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_3__["default"], {
    name: "close"
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ConnectionStatusOverlay));

/***/ },

/***/ "./src/components/left/LeftColumn.scss"
/*!*********************************************!*\
  !*** ./src/components/left/LeftColumn.scss ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/left/LeftColumn.tsx"
/*!********************************************!*\
  !*** ./src/components/left/LeftColumn.tsx ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors/sharedState.ts */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_swipeController__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/swipeController */ "./src/util/swipeController.ts");
/* harmony import */ var _aiKnowledge_AIKnowledge_async__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./aiKnowledge/AIKnowledge.async */ "./src/components/left/aiKnowledge/AIKnowledge.async.tsx");
/* harmony import */ var _hooks_reducers_useFoldersReducer__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/reducers/useFoldersReducer */ "./src/hooks/reducers/useFoldersReducer.ts");
/* harmony import */ var _hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_useStateRef__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useStateRef */ "./src/hooks/useStateRef.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ArchivedChats_async__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./ArchivedChats.async */ "./src/components/left/ArchivedChats.async.tsx");
/* harmony import */ var _main_LeftMain__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./main/LeftMain */ "./src/components/left/main/LeftMain.tsx");
/* harmony import */ var _newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./newChat/NewChat.async */ "./src/components/left/newChat/NewChat.async.tsx");
/* harmony import */ var _settings_Settings_async__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./settings/Settings.async */ "./src/components/left/settings/Settings.async.tsx");
/* harmony import */ var _TelyAILanguage_TelyAILanguage_async_tsx__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./TelyAILanguage/TelyAILanguage.async.tsx */ "./src/components/left/TelyAILanguage/TelyAILanguage.async.tsx");
/* harmony import */ var _LeftColumn_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./LeftColumn.scss */ "./src/components/left/LeftColumn.scss");

























var ContentType = /*#__PURE__*/function (ContentType) {
  ContentType[ContentType["Main"] = 0] = "Main";
  ContentType[ContentType["Settings"] = 1] = "Settings";
  ContentType[ContentType["Archived"] = 2] = "Archived";
  ContentType[ContentType["NewGroup"] = 3] = "NewGroup";
  ContentType[ContentType["NewChannel"] = 4] = "NewChannel";
  ContentType[ContentType["AIKnowledge"] = 5] = "AIKnowledge";
  ContentType[ContentType["TelyAILanguage"] = 6] = "TelyAILanguage";
  return ContentType;
}(ContentType || {});
const RENDER_COUNT = Object.keys(ContentType).length / 2;
const RESET_TRANSITION_DELAY_MS = 250;
function LeftColumn({
  ref,
  contentKey,
  settingsScreen,
  searchQuery,
  searchDate,
  isFirstChatFolderActive,
  animationLevel,
  shouldSkipHistoryAnimations,
  currentUserId,
  hasPasscode,
  nextFoldersAction,
  isChatOpen,
  // isAppUpdateAvailable,
  isElectronUpdateAvailable,
  isForumPanelOpen,
  forumPanelChatId,
  isClosingSearch,
  archiveSettings,
  isArchivedStoryRibbonShown,
  isAccountFrozen
}) {
  const {
    setGlobalSearchQuery,
    setGlobalSearchClosing,
    setGlobalSearchChatId,
    resetChatCreation,
    setGlobalSearchDate,
    loadPasswordInfo,
    clearTwoFaError,
    openChat,
    openLeftColumnContent,
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [contactsFilter, setContactsFilter] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [foldersState, foldersDispatch] = (0,_hooks_reducers_useFoldersReducer__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const debouncedSetGlobalSearchQuery = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_8__.debounce)(query => {
    setGlobalSearchQuery({
      query
    });
  }, 200, false, true), [setGlobalSearchQuery]);

  // Used to reset child components in background.
  const [lastResetTime, setLastResetTime] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  let contentType = ContentType.Main;
  switch (contentKey) {
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived:
      contentType = ContentType.Archived;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings:
      contentType = ContentType.Settings;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1:
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep2:
      contentType = ContentType.NewChannel;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1:
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep2:
      contentType = ContentType.NewGroup;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.AIKonwledge:
      contentType = ContentType.AIKnowledge;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.TelyAILanguage:
      contentType = ContentType.TelyAILanguage;
      break;
  }
  const handleReset = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(forceReturnToChatList => {
    function fullReset() {
      openLeftColumnContent({
        contentKey: undefined
      });
      openSettingsScreen({
        screen: undefined
      });
      setContactsFilter('');
      setGlobalSearchClosing({
        isClosing: true
      });
      resetChatCreation();
      setTimeout(() => {
        setGlobalSearchQuery({
          query: ''
        });
        setGlobalSearchDate({
          date: undefined
        });
        setGlobalSearchChatId({
          id: undefined
        });
        setGlobalSearchClosing({
          isClosing: false
        });
        setLastResetTime(Date.now());
      }, RESET_TRANSITION_DELAY_MS);
    }
    if (forceReturnToChatList === true) {
      fullReset();
      return;
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep2) {
      openLeftColumnContent({
        contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1
      });
      return;
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep2) {
      openLeftColumnContent({
        contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1
      });
      return;
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1) {
      const pickerSearchInput = document.getElementById('new-group-picker-search');
      if (pickerSearchInput) {
        pickerSearchInput.blur();
      }
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings) {
      switch (settingsScreen) {
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.EditProfile:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Folders:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.General:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Notifications:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.DataStorage:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Performance:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.ActiveSessions:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Language:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Stickers:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Experimental:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackground:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.General
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackgroundColor:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.GeneralChatBackground
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumber:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyAddByPhone:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeen:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhoto:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBio:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthday:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGifts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCall:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2P:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwarding:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChats:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessages:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyMessages:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBlockedUsers:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.ActiveWebsites:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaDisabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaEnabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaCongratulations:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeCongratulations:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscode:
          openSettingsScreen({
            screen: hasPasscode ? _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled : _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeCurrent:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeTurnOff:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeEnabled
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscodeConfirm:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeNewPasscode
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeNew:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeCurrent
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeConfirm:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeChangePasscodeNew
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumberAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumberDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneNumber
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeenAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeenDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyLastSeen
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhotoAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhotoDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyProfilePhoto
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBioAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBioDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBio
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthdayAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthdayDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyBirthday
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGiftsAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGiftsDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGifts
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCallAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCallDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneCall
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2PAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2PDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyPhoneP2P
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwardingAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwardingDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyForwarding
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessagesAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessagesDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyVoiceMessages
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChatsAllowedContacts:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChatsDeniedContacts:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyGroupChats
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPassword:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaDisabled
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordConfirm:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPassword
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordHint:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordConfirm
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmail:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordHint
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmailCode:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaNewPasswordEmail
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordCurrent:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaTurnOff:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCurrentPassword:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaEnabled
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordNew:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordCurrent
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordConfirm:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordNew
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordHint:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaChangePasswordConfirm
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmail:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCurrentPassword
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmailCode:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaRecoveryEmail
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersCreateFolder:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolder:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Folders
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersShare:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolder
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersIncludedChatsFromChatList:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersExcludedChatsFromChatList:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderFromChatList
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderFromChatList:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderInvites:
          openLeftColumnContent({
            contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList
          });
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Main
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.QuickReaction:
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.CustomEmoji:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Stickers
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.DoNotTranslate:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Language
          });
          return;
        case _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyNoPaidMessages:
          openSettingsScreen({
            screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PrivacyMessages
          });
          return;
        default:
          break;
      }
    }
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList && isFirstChatFolderActive) {
      openLeftColumnContent({
        contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch
      });
      return;
    }
    fullReset();
  });
  const handleSearchQuery = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(query => {
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts) {
      setContactsFilter(query);
      return;
    }
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch
    });
    if (query !== searchQuery) {
      debouncedSetGlobalSearchQuery(query);
    }
  });
  const handleTopicSearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch
    });
    setGlobalSearchQuery({
      query: ''
    });
    setGlobalSearchChatId({
      id: forumPanelChatId
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const isArchived = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived;
    const isChatList = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
    const noChatOrForumOpen = !isChatOpen && !isForumPanelOpen;
    // We listen for escape key only in these cases:
    // 1. When we are in archived chats and no chat or forum is open.
    // 2. When we are in any other screen except chat list and archived chat list.
    // 3. When we are in chat list and first chat folder is active and no chat or forum is open.
    if (isArchived && noChatOrForumOpen || !isChatList && !isArchived || isFirstChatFolderActive && noChatOrForumOpen) {
      return (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
        handleReset();
      });
    } else {
      return undefined;
    }
  }, [isFirstChatFolderActive, contentKey, handleReset, isChatOpen, isForumPanelOpen]);
  const handleHotkeySearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(e => {
    if (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch) {
      return;
    }
    e.preventDefault();
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch
    });
  });
  const handleHotkeySavedMessages = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(e => {
    e.preventDefault();
    openChat({
      id: currentUserId,
      shouldReplaceHistory: true
    });
  });
  const handleArchivedChats = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(e => {
    e.preventDefault();
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived
    });
  });
  const handleHotkeySettings = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(e => {
    e.preventDefault();
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings
    });
  });
  (0,_hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_12__.useHotkeys)((0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => ({
    'Mod+Shift+F': handleHotkeySearch,
    // https://support.mozilla.org/en-US/kb/take-screenshots-firefox
    ...(!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_FIREFOX && {
      'Mod+Shift+S': handleHotkeySavedMessages
    }),
    ...(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_APP && {
      'Mod+0': handleHotkeySavedMessages,
      'Mod+9': handleArchivedChats
    }),
    ...(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_MAC_OS && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_APP && {
      'Mod+,': handleHotkeySettings
    })
  }), []));
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    clearTwoFaError();
    if (settingsScreen === _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Privacy) {
      loadPasswordInfo();
    }
  }, [clearTwoFaError, loadPasswordInfo, settingsScreen]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (nextFoldersAction) {
      foldersDispatch(nextFoldersAction);
    }
  }, [foldersDispatch, nextFoldersAction]);
  const prevSettingsScreenRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_15__.useStateRef)((0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_14__["default"])(contentType === ContentType.Settings ? settingsScreen : -1));
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_TOUCH_ENV) {
      return undefined;
    }
    return (0,_util_swipeController__WEBPACK_IMPORTED_MODULE_9__.captureControlledSwipe)(ref.current, {
      excludedClosestSelector: '.ProfileInfo, .color-picker, .hue-picker',
      selectorToPreventScroll: '#Settings .custom-scroll',
      onSwipeRightStart: handleReset,
      onCancel: () => {
        openLeftColumnContent({
          contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings
        });
        openSettingsScreen({
          screen: prevSettingsScreenRef.current
        });
      }
    });
  }, [prevSettingsScreenRef, ref]);
  function renderContent(isActive) {
    switch (contentType) {
      case ContentType.Archived:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ArchivedChats_async__WEBPACK_IMPORTED_MODULE_18__["default"], {
          isActive: isActive,
          onReset: handleReset,
          onTopicSearch: handleTopicSearch,
          foldersDispatch: foldersDispatch,
          isForumPanelOpen: isForumPanelOpen,
          archiveSettings: archiveSettings,
          isStoryRibbonShown: isArchivedStoryRibbonShown
        });
      case ContentType.Settings:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_settings_Settings_async__WEBPACK_IMPORTED_MODULE_21__["default"], {
          isActive: isActive,
          currentScreen: settingsScreen,
          foldersState: foldersState,
          foldersDispatch: foldersDispatch,
          animationLevel: animationLevel,
          shouldSkipTransition: shouldSkipHistoryAnimations,
          onReset: handleReset
        });
      case ContentType.NewChannel:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_20__["default"], {
          key: lastResetTime,
          isActive: isActive,
          isChannel: true,
          content: contentKey,
          animationLevel: animationLevel,
          onReset: handleReset
        });
      case ContentType.NewGroup:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_newChat_NewChat_async__WEBPACK_IMPORTED_MODULE_20__["default"], {
          key: lastResetTime,
          isActive: isActive,
          content: contentKey,
          animationLevel: animationLevel,
          onReset: handleReset
        });
      case ContentType.AIKnowledge:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_aiKnowledge_AIKnowledge_async__WEBPACK_IMPORTED_MODULE_10__["default"], {
          onReset: handleReset
        });
      case ContentType.TelyAILanguage:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TelyAILanguage_TelyAILanguage_async_tsx__WEBPACK_IMPORTED_MODULE_22__["default"], {
          onReset: handleReset
        });
      default:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_main_LeftMain__WEBPACK_IMPORTED_MODULE_19__["default"], {
          content: contentKey,
          isClosingSearch: isClosingSearch,
          searchQuery: searchQuery,
          searchDate: searchDate,
          contactsFilter: contactsFilter,
          foldersDispatch: foldersDispatch,
          onSearchQuery: handleSearchQuery,
          onReset: handleReset,
          shouldSkipTransition: shouldSkipHistoryAnimations
          // isAppUpdateAvailable={isAppUpdateAvailable}
          ,
          isElectronUpdateAvailable: isElectronUpdateAvailable,
          isForumPanelOpen: isForumPanelOpen,
          onTopicSearch: handleTopicSearch,
          isAccountFrozen: isAccountFrozen
        });
    }
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_17__["default"], {
    ref: ref,
    name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_7__.resolveTransitionName)('layers', animationLevel, shouldSkipHistoryAnimations),
    renderCount: RENDER_COUNT,
    activeKey: contentType,
    shouldCleanup: true,
    cleanupExceptionKey: ContentType.Main,
    shouldWrap: true,
    wrapExceptionKey: ContentType.Main,
    id: "LeftColumn",
    withSwipeControl: true
  }, renderContent);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const {
    globalSearch: {
      query,
      minDate
    },
    shouldSkipHistoryAnimations,
    activeChatFolder,
    leftColumn,
    nextFoldersAction,
    storyViewer: {
      isArchivedRibbonShown
    }
  } = tabState;
  const {
    currentUserId,
    passcode: {
      hasPasscode
    },
    // isAppUpdateAvailable,
    isElectronUpdateAvailable,
    archiveSettings
  } = global;
  const {
    animationLevel
  } = (0,_global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_4__.selectSharedSettings)(global);
  const currentChat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentChat)(global);
  const isChatOpen = Boolean(currentChat?.id);
  const isForumPanelOpen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsForumPanelOpen)(global);
  const forumPanelChatId = tabState.forumPanelChatId;
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserFrozen)(global);
  return {
    searchQuery: query,
    searchDate: minDate,
    isFirstChatFolderActive: activeChatFolder === 0,
    animationLevel,
    shouldSkipHistoryAnimations,
    currentUserId,
    hasPasscode,
    nextFoldersAction,
    isChatOpen,
    // isAppUpdateAvailable,
    isElectronUpdateAvailable,
    isForumPanelOpen,
    forumPanelChatId,
    isClosingSearch: tabState.globalSearch.isClosing,
    archiveSettings,
    isArchivedStoryRibbonShown: isArchivedRibbonShown,
    isAccountFrozen,
    contentKey: leftColumn.contentKey,
    settingsScreen: leftColumn.settingsScreen
  };
})(LeftColumn)));

/***/ },

/***/ "./src/components/left/NewChatButton.scss"
/*!************************************************!*\
  !*** ./src/components/left/NewChatButton.scss ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/left/NewChatButton.tsx"
/*!***********************************************!*\
  !*** ./src/components/left/NewChatButton.tsx ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _NewChatButton_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./NewChatButton.scss */ "./src/components/left/NewChatButton.scss");










const NewChatButton = ({
  isShown,
  onNewPrivateChat,
  onNewChannel,
  onNewGroup,
  isAccountFrozen
}) => {
  const [isMenuOpen, setIsMenuOpen] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    openFrozenAccountModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isShown) {
      setIsMenuOpen(false);
    }
  }, [isShown]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const fabClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('NewChatButton', isShown && 'revealed', isMenuOpen && 'menu-is-open');
  const toggleIsMenuOpen = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (isAccountFrozen) {
      openFrozenAccountModal();
      return;
    }
    setIsMenuOpen(!isMenuOpen);
  }, [isMenuOpen, isAccountFrozen]);
  const handleClose = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setIsMenuOpen(false);
  }, []);
  const menuItems = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "channel",
    onClick: onNewChannel
  }, lang('NewChannel')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "group",
    onClick: onNewGroup
  }, lang('NewGroup')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "user",
    onClick: onNewPrivateChat
  }, lang('NewMessageTitle'))), [lang, onNewChannel, onNewGroup, onNewPrivateChat]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: fabClassName,
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    round: true,
    color: "primary",
    className: isMenuOpen ? 'active' : '',
    onClick: toggleIsMenuOpen,
    ariaLabel: lang(isMenuOpen ? 'Close' : 'NewMessageTitle'),
    tabIndex: -1
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
    name: "new-chat-filled"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
    name: "close"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_6__["default"], {
    isOpen: isMenuOpen,
    positionX: lang.isRtl ? 'left' : 'right',
    positionY: "bottom",
    autoClose: true,
    onClose: handleClose
  }, menuItems));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewChatButton);

/***/ },

/***/ "./src/components/left/TelyAILanguage/TelyAILanguage.async.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/left/TelyAILanguage/TelyAILanguage.async.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const TelyAILanguageAsync = props => {
  const TelyAILanguage = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'TelyAILanguage');
  return TelyAILanguage ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(TelyAILanguage, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (TelyAILanguageAsync);

/***/ },

/***/ "./src/components/left/aiKnowledge/AIKnowledge.async.tsx"
/*!***************************************************************!*\
  !*** ./src/components/left/aiKnowledge/AIKnowledge.async.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const AIKnowledgeAsync = props => {
  const AIKnowledge = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AIKnowledge');

  // eslint-disable-next-line react/jsx-props-no-spreading
  return AIKnowledge ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AIKnowledge, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AIKnowledgeAsync);

/***/ },

/***/ "./src/components/left/main/AccountMenuItems.tsx"
/*!*******************************************************!*\
  !*** ./src/components/left/main/AccountMenuItems.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_multiaccount__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/multiaccount */ "./src/util/multiaccount.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMultiaccountInfo__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useMultiaccountInfo */ "./src/hooks/useMultiaccountInfo.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/MenuSeparator */ "./src/components/ui/MenuSeparator.tsx");
/* harmony import */ var _chatAssistant_component_upgrade_UpgradeButton__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../chatAssistant/component/upgrade/UpgradeButton */ "./src/components/chatAssistant/component/upgrade/UpgradeButton.tsx");














const NOTIFICATION_DURATION = 7000;
const AccountMenuItems = ({
  currentUser,
  totalLimit,
  onSelectCurrent
}) => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const accounts = (0,_hooks_useMultiaccountInfo__WEBPACK_IMPORTED_MODULE_7__["default"])(currentUser);
  const currentCount = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCurrentProdAccountCount)();
  const maxCount = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCurrentMaxAccountCount)();
  const currentAccountInfo = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return Object.values(accounts).find(account => account.userId === currentUser.id);
  }, [accounts, currentUser.id]);
  const shouldShowLimit = currentCount >= maxCount;
  const handleLimitClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    showNotification({
      title: lang('PremiumLimitAccountsTitle'),
      message: currentUser.isPremium ? lang('PremiumLimitAccounts') : lang('PremiumLimitAccountsNoPremium'),
      duration: NOTIFICATION_DURATION
    });
  });
  const newAccountUrl = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!Object.values(accounts).length) {
      return undefined;
    }
    if (currentCount === totalLimit) {
      return undefined;
    }
    let freeIndex = 1;
    while (accounts[freeIndex]) {
      freeIndex += 1;
    }
    return (0,_util_multiaccount__WEBPACK_IMPORTED_MODULE_3__.getAccountSlotUrl)(freeIndex, true);
  }, [accounts, currentCount, totalLimit]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, Object.entries(accounts || {}).sort(([, account]) => account.userId === currentUser.id ? -1 : 1).map(([slot, account], index, arr) => {
    const isSameServer = account.isTest === currentAccountInfo?.isTest;
    const mockUser = {
      title: [account.firstName, account.lastName].filter(Boolean).join(' '),
      isCustomPeer: true,
      peerColorId: account.color,
      emojiStatusId: isSameServer ? account.emojiStatusId : undefined,
      isPremium: account.isPremium
    };
    const hasSeparator = account.userId === currentUser.id && (newAccountUrl || arr.length > 1);
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_10__["default"], {
      className: "account-menu-item",
      customIcon: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_8__["default"], {
        size: "mini",
        className: "account-avatar",
        peer: mockUser,
        previewUrl: account.avatarUri
      }),
      onClick: account.userId === currentUser.id ? onSelectCurrent : undefined,
      href: account.userId !== currentUser.id ? (0,_util_multiaccount__WEBPACK_IMPORTED_MODULE_3__.getAccountSlotUrl)(Number(slot)) : undefined
    }, account.isTest && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "account-menu-item-test"
    }, "T"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_9__["default"], {
      peer: mockUser,
      withEmojiStatus: true,
      emojiStatusSize: _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM
    }), account.userId === currentUser.id && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_component_upgrade_UpgradeButton__WEBPACK_IMPORTED_MODULE_12__["default"], null)), hasSeparator && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_11__["default"], null));
  }), newAccountUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_10__["default"], {
    icon: "add",
    rel: "noopener" // Allow referrer to be passed
    ,
    href: !shouldShowLimit ? newAccountUrl : undefined,
    onClick: shouldShowLimit ? handleLimitClick : undefined
  }, lang('MenuAddAccount')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(AccountMenuItems));

/***/ },

/***/ "./src/components/left/main/ChatFolders.tsx"
/*!**************************************************!*\
  !*** ./src/components/left/main/ChatFolders.tsx ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _chatAssistant_ai_chatfolders_active_tag__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../chatAssistant/ai-chatfolders/active-tag */ "./src/components/chatAssistant/ai-chatfolders/active-tag.tsx");
/* harmony import */ var _chatAssistant_ai_chatfolders_ai_chatfolders_tip__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../chatAssistant/ai-chatfolders/ai-chatfolders-tip */ "./src/components/chatAssistant/ai-chatfolders/ai-chatfolders-tip.tsx");
/* harmony import */ var _chatAssistant_ai_chatfolders_preset_modal__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../chatAssistant/ai-chatfolders/preset-modal */ "./src/components/chatAssistant/ai-chatfolders/preset-modal.tsx");
/* harmony import */ var _chatAssistant_ai_chatfolders_tag_filter__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../chatAssistant/ai-chatfolders/tag-filter */ "./src/components/chatAssistant/ai-chatfolders/tag-filter.ts");
/* harmony import */ var _chatAssistant_ai_chatfolders_util__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../chatAssistant/ai-chatfolders/util */ "./src/components/chatAssistant/ai-chatfolders/util.ts");
/* harmony import */ var _chatAssistant_component_upgrade_tip_tsx__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../chatAssistant/component/upgrade-tip.tsx */ "./src/components/chatAssistant/component/upgrade-tip.tsx");
/* harmony import */ var _chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../chatAssistant/store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../chatAssistant/lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _story_StoryRibbon__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../story/StoryRibbon */ "./src/components/story/StoryRibbon.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ChatList__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./ChatList */ "./src/components/left/main/ChatList.tsx");
/* eslint-disable @stylistic/max-statements-per-line */



































const SAVED_MESSAGES_HOTKEY = '0';
const FIRST_FOLDER_INDEX = 0;
const ChatFolders = ({
  foldersDispatch,
  chatFoldersById,
  orderedFolderIds,
  activeChatFolder,
  currentUserId,
  isForumPanelOpen,
  animationLevel,
  shouldSkipHistoryAnimations,
  maxFolders,
  maxChatLists,
  shouldHideFolderTabs,
  folderInvitesById,
  maxFolderInvites,
  hasArchivedChats,
  hasArchivedStories,
  archiveSettings,
  isStoryRibbonShown,
  sessions,
  isAccountFrozen,
  aiChatFolders,
  subscriptionType
}) => {
  const {
    loadChatFolders,
    setActiveChatFolder,
    openChat,
    openShareChatFolderModal,
    openDeleteChatFolderModal,
    openEditChatFolder,
    openLimitReachedModal,
    markChatMessagesRead,
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const transitionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [shouldRenderPresetTagModal, openRenderPresetTagModal, closeRenderPresetTagModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_22__["default"])();
  const [activePresetTag, setActivePresetTag] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [activeAITag, setActiveAITag] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [shouldRenderAiChatFoldersTip, openRenderAiChatFoldersTip, closeRenderAiChatFoldersTip] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_22__["default"])();
  const [aiChatFoldersStep, setAiChatFoldersStep] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_chatAssistant_ai_chatfolders_ai_chatfolders_tip__WEBPACK_IMPORTED_MODULE_14__.AIChatFolderStep.classify);
  const [aiChatFoldersloading, setAiChatFoldersLoading] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_25__["default"])();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    loadChatFolders();
  }, []);
  const {
    ref,
    shouldRender: shouldRenderStoryRibbon,
    getIsClosing: getIsStoryRibbonClosing
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_27__["default"])({
    isOpen: isStoryRibbonShown,
    className: false,
    withShouldRender: true
  });
  const isStoryRibbonClosing = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_21__["default"])(getIsStoryRibbonClosing);
  const scrollToTop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(() => {
    const activeList = ref.current?.querySelector('.chat-list.Transition_slide-active');
    activeList?.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
  const allChatsFolder = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return {
      id: _config__WEBPACK_IMPORTED_MODULE_3__.ALL_FOLDER_ID,
      title: {
        text: orderedFolderIds?.[0] === _config__WEBPACK_IMPORTED_MODULE_3__.ALL_FOLDER_ID ? lang('FilterAllChatsShort') : lang('FilterAllChats')
      },
      includedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_11__.MEMO_EMPTY_ARRAY,
      excludedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_11__.MEMO_EMPTY_ARRAY
    };
  }, [orderedFolderIds, lang]);
  const presetChatsFolder = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return {
      id: _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID,
      title: {
        text: _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_TITLE
      },
      includedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_11__.MEMO_EMPTY_ARRAY,
      excludedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_11__.MEMO_EMPTY_ARRAY
    };
  }, []);
  const unreadChatsFolder = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return {
      id: _config__WEBPACK_IMPORTED_MODULE_3__.UNREAD_FOLDER_ID,
      title: {
        text: _config__WEBPACK_IMPORTED_MODULE_3__.UNREAD_FOLDER_TITLE
      },
      includedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_11__.MEMO_EMPTY_ARRAY,
      excludedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_11__.MEMO_EMPTY_ARRAY
    };
  }, []);
  const AIChatsFolder = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return {
      id: _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_ID,
      title: {
        text: _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_TITLE
      },
      includedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_11__.MEMO_EMPTY_ARRAY,
      excludedChatIds: _util_memo__WEBPACK_IMPORTED_MODULE_11__.MEMO_EMPTY_ARRAY
    };
  }, []);
  const displayedFolders = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const chatFolders = Object.values(chatFoldersById);
    return orderedFolderIds ? orderedFolderIds?.map(id => {
      if (id === _config__WEBPACK_IMPORTED_MODULE_3__.ALL_FOLDER_ID) {
        return allChatsFolder;
      }
      if (id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID && !chatFolders.find(o => o?.title?.text === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_TITLE)) {
        return presetChatsFolder;
      }
      if (id === _config__WEBPACK_IMPORTED_MODULE_3__.UNREAD_FOLDER_ID && !chatFolders.find(o => o?.title?.text === _config__WEBPACK_IMPORTED_MODULE_3__.UNREAD_FOLDER_TITLE)) {
        return unreadChatsFolder;
      }
      if (id === _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_ID && !chatFolders.find(o => o?.title?.text === _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_TITLE)) {
        return AIChatsFolder;
      }
      return chatFoldersById?.[id] || {};
    }).filter(Boolean) : undefined;
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [chatFoldersById, allChatsFolder, orderedFolderIds, JSON.stringify(orderedFolderIds), presetChatsFolder, unreadChatsFolder, AIChatsFolder]);
  const allChatsFolderIndex = displayedFolders?.findIndex(folder => folder.id === _config__WEBPACK_IMPORTED_MODULE_3__.ALL_FOLDER_ID);
  const isInAllChatsFolder = allChatsFolderIndex === activeChatFolder;
  const isInFirstFolder = FIRST_FOLDER_INDEX === activeChatFolder;
  const isInPresetFolder = displayedFolders?.findIndex(folder => folder.id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID) === activeChatFolder;
  const isInUnreadFolder = displayedFolders?.findIndex(folder => folder.id === _config__WEBPACK_IMPORTED_MODULE_3__.UNREAD_FOLDER_ID) === activeChatFolder;
  const isInAIFolder = displayedFolders?.findIndex(folder => folder.id === _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_ID) === activeChatFolder;
  const folderUnreadChatsCountersById = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_23__.useFolderManagerForUnreadChatsByFolder)();
  const handleReadAllChats = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(folderId => {
    const unreadChatIds = folderUnreadChatsCountersById[folderId];
    if (!unreadChatIds?.length) return;
    unreadChatIds.forEach(chatId => {
      markChatMessagesRead({
        id: chatId
      });
    });
  });
  const folderCountersById = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_23__.useFolderManagerForUnreadCounters)();
  const folderTabs = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!displayedFolders || !displayedFolders.length) {
      return undefined;
    }
    return displayedFolders.map((folder, i) => {
      const {
        id,
        title
      } = folder;
      const isBlocked = id !== _config__WEBPACK_IMPORTED_MODULE_3__.ALL_FOLDER_ID && i > maxFolders - 1;
      const canShareFolder = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanShareFolder)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), id);
      const contextActions = [];
      let badgeCount = folderCountersById[id]?.chatsCount;
      if (canShareFolder) {
        contextActions.push({
          title: lang('FilterShare'),
          icon: 'link',
          handler: () => {
            const chatListCount = Object.values(chatFoldersById).reduce((acc, el) => acc + (el.isChatList ? 1 : 0), 0);
            if (chatListCount >= maxChatLists && !folder.isChatList) {
              openLimitReachedModal({
                limit: 'chatlistJoined'
              });
              return;
            }

            // Greater amount can be after premium downgrade
            if (folderInvitesById[id]?.length >= maxFolderInvites) {
              openLimitReachedModal({
                limit: 'chatlistInvites'
              });
              return;
            }
            openShareChatFolderModal({
              folderId: id
            });
          }
        });
      }
      if (id === _config__WEBPACK_IMPORTED_MODULE_3__.ALL_FOLDER_ID) {
        contextActions.push({
          title: lang('FilterEditFolders'),
          icon: 'edit',
          handler: () => {
            openSettingsScreen({
              screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.Folders
            });
          }
        });
        if (folderUnreadChatsCountersById[id]?.length) {
          contextActions.push({
            title: lang('ChatListMarkAllAsRead'),
            icon: 'readchats',
            handler: () => handleReadAllChats(folder.id)
          });
        }
      }
      if (id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID || id === _config__WEBPACK_IMPORTED_MODULE_3__.UNREAD_FOLDER_ID || id === _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_ID) {
        if (folderUnreadChatsCountersById[id]?.length) {
          contextActions.push({
            title: lang('ChatListMarkAllAsRead'),
            icon: 'readchats',
            handler: () => handleReadAllChats(folder.id)
          });
        }
        if (id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID) {
          badgeCount = (0,_chatAssistant_ai_chatfolders_tag_filter__WEBPACK_IMPORTED_MODULE_16__.filterPresetTag)(folderUnreadChatsCountersById[id])?.length;
        } else if (id === _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_ID) {
          badgeCount = (0,_chatAssistant_ai_chatfolders_tag_filter__WEBPACK_IMPORTED_MODULE_16__.filterAITag)(folderUnreadChatsCountersById[id])?.length;
        }
      } else {
        contextActions.push({
          title: lang('EditFolder'),
          icon: 'edit',
          handler: () => {
            openEditChatFolder({
              folderId: id
            });
          }
        });
        if (folderUnreadChatsCountersById[id]?.length) {
          contextActions.push({
            title: lang('ChatListMarkAllAsRead'),
            icon: 'readchats',
            handler: () => handleReadAllChats(folder.id)
          });
        }
        contextActions.push({
          title: lang('FilterMenuDelete'),
          icon: 'delete',
          destructive: true,
          handler: () => {
            openDeleteChatFolderModal({
              folderId: id
            });
          }
        });
      }
      return {
        id,
        title: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_20__.renderTextWithEntities)({
          text: title.text,
          entities: title.entities,
          noCustomEmojiPlayback: folder.noTitleAnimations
        }),
        badgeCount,
        isBadgeActive: Boolean(folderCountersById[id]?.notificationsCount),
        isBlocked,
        contextActions: contextActions?.length ? contextActions : undefined
      };
    });
  }, [displayedFolders, maxFolders, folderCountersById, lang, chatFoldersById, maxChatLists, folderInvitesById, maxFolderInvites, folderUnreadChatsCountersById, openSettingsScreen]);
  const handleSwitchTab = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(index => {
    setActiveChatFolder({
      activeChatFolder: index
    }, {
      forceOnHeavyAnimation: true
    });
    if (activeChatFolder === index) {
      scrollToTop();
    }
    if (folderTabs[index].id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID || folderTabs[index].id === _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_ID) {
      openRenderPresetTagModal();
    } else {
      closeRenderPresetTagModal();
    }
  });

  // Prevent `activeTab` pointing at non-existing folder after update
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!folderTabs?.length) {
      return;
    }
    if (activeChatFolder >= folderTabs.length) {
      setActiveChatFolder({
        activeChatFolder: FIRST_FOLDER_INDEX
      });
    }
  }, [activeChatFolder, folderTabs, setActiveChatFolder]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_7__.IS_TOUCH_ENV || !folderTabs?.length || isForumPanelOpen) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_10__.captureEvents)(transitionRef.current, {
      selectorToPreventScroll: '.chat-list',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_10__.SwipeDirection.Left) {
          setActiveChatFolder({
            activeChatFolder: Math.min(activeChatFolder + 1, folderTabs.length - 1)
          }, {
            forceOnHeavyAnimation: true
          });
          return true;
        } else if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_10__.SwipeDirection.Right) {
          setActiveChatFolder({
            activeChatFolder: Math.max(0, activeChatFolder - 1)
          }, {
            forceOnHeavyAnimation: true
          });
          return true;
        }
        return false;
      }
    });
  }, [activeChatFolder, folderTabs, isForumPanelOpen, setActiveChatFolder]);
  const isNotInFirstFolderRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  isNotInFirstFolderRef.current = !isInFirstFolder;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isNotInFirstFolderRef.current ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (isNotInFirstFolderRef.current) {
      setActiveChatFolder({
        activeChatFolder: FIRST_FOLDER_INDEX
      });
    }
  }) : undefined, [activeChatFolder, setActiveChatFolder]);
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_24__["default"])({
    isActive: !isInFirstFolder,
    onBack: () => setActiveChatFolder({
      activeChatFolder: FIRST_FOLDER_INDEX
    }, {
      forceOnHeavyAnimation: true
    })
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const handleKeyDown = e => {
      if (e.ctrlKey && e.shiftKey && e.code.startsWith('Digit') && folderTabs) {
        const [, digit] = e.code.match(/Digit(\d)/) || [];
        if (!digit) return;
        if (digit === SAVED_MESSAGES_HOTKEY) {
          openChat({
            id: currentUserId,
            shouldReplaceHistory: true
          });
          return;
        }
        const folder = Number(digit) - 1;
        if (folder > folderTabs.length - 1) return;
        setActiveChatFolder({
          activeChatFolder: folder
        }, {
          forceOnHeavyAnimation: true
        });
        e.preventDefault();
      }
    };
    document.addEventListener('keydown', handleKeyDown, true);
    return () => {
      document.removeEventListener('keydown', handleKeyDown, true);
    };
  }, [currentUserId, folderTabs, openChat, setActiveChatFolder]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__.ChataiStores.general?.get(_chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__.GLOBAL_PRESET_TAG)?.then(res => {
      setActivePresetTag(res ?? []);
    });
    _chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__.ChataiStores.general?.get(_chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__.GLOBAL_AI_TAG)?.then(res => {
      setActiveAITag(res ?? []);
    });
  }, []);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const isNext = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().chatFolders.nextAiChatFolders?.length;
    if (isNext) {
      setAiChatFoldersStep(_chatAssistant_ai_chatfolders_ai_chatfolders_tip__WEBPACK_IMPORTED_MODULE_14__.AIChatFolderStep.apply);
    } else {
      setAiChatFoldersStep(_chatAssistant_ai_chatfolders_ai_chatfolders_tip__WEBPACK_IMPORTED_MODULE_14__.AIChatFolderStep.classify);
    }
    _chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__.ChataiStores.general?.get(_chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__.GLOBAL_AICHATFOLDERS_TIP_SHOW)?.then(res => {
      if (res === undefined || res === true && aiChatFolders) {
        openRenderAiChatFoldersTip();
      } else {
        closeRenderAiChatFoldersTip();
      }
    });
  }, [aiChatFoldersloading, shouldRenderAiChatFoldersTip, aiChatFolders]);
  const updateAIChatFoldsLoading = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async ({
    loading,
    isShowTip
  }) => {
    setAiChatFoldersLoading(loading);
    const tipShowRes = await _chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__.ChataiStores.general?.get(_chatAssistant_store__WEBPACK_IMPORTED_MODULE_19__.GLOBAL_AICHATFOLDERS_TIP_SHOW);
    if ((aiChatFolders || tipShowRes === undefined) && isShowTip) {
      openRenderAiChatFoldersTip();
    }
  }, [aiChatFolders]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_28__["default"].on(_chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_28__.Actions.UpdateAIChatFoldersApplying, updateAIChatFoldsLoading);
    return () => {
      _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_28__["default"].off(_chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_28__.Actions.UpdateAIChatFoldersApplying, updateAIChatFoldsLoading);
    };
  }, [updateAIChatFoldsLoading]);
  const {
    ref: placeholderRef,
    shouldRender: shouldRenderPlaceholder
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_27__["default"])({
    isOpen: !orderedFolderIds,
    noMountTransition: true,
    withShouldRender: true
  });
  function getFolderType() {
    if (isInAllChatsFolder) {
      return 'all';
    } else if (isInPresetFolder) {
      return 'preset';
    } else if (isInUnreadFolder) {
      return 'unread';
    } else if (isInAIFolder) {
      return 'ai';
    } else {
      return 'folder';
    }
  }
  function renderCurrentTab(isActive) {
    const activeFolder = Object.values(chatFoldersById).find(({
      id
    }) => id === folderTabs[activeChatFolder].id);
    const isFolder = activeFolder && !isInAllChatsFolder;
    const folderType = getFolderType();
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatList__WEBPACK_IMPORTED_MODULE_32__["default"], {
      folderType: isFolder ? 'folder' : folderType,
      folderId: isFolder ? activeFolder.id : undefined,
      isActive: isActive,
      isForumPanelOpen: isForumPanelOpen,
      foldersDispatch: foldersDispatch,
      isMainList: true,
      canDisplayArchive: (hasArchivedChats || hasArchivedStories) && !archiveSettings.isHidden,
      archiveSettings: archiveSettings,
      sessions: sessions,
      isAccountFrozen: isAccountFrozen,
      activeTag: shouldRenderFolders ? folderTabs[activeChatFolder]?.id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID ? activePresetTag : activeAITag : []
    });
  }
  const shouldRenderFolders = folderTabs && folderTabs.length > 1;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('ChatFolders', shouldRenderFolders && shouldHideFolderTabs && 'ChatFolders--tabs-hidden', shouldRenderStoryRibbon && 'with-story-ribbon')
  }, shouldRenderStoryRibbon && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_story_StoryRibbon__WEBPACK_IMPORTED_MODULE_29__["default"], {
    isClosing: isStoryRibbonClosing
  }), shouldRenderFolders ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TabList__WEBPACK_IMPORTED_MODULE_30__["default"], {
    contextRootElementSelector: "#LeftColumn",
    tabs: folderTabs,
    activeTab: activeChatFolder,
    onSwitchTab: handleSwitchTab
  }) : shouldRenderPlaceholder ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: placeholderRef,
    className: "tabs-placeholder"
  }) : undefined, shouldRenderAiChatFoldersTip && aiChatFoldersStep === _chatAssistant_ai_chatfolders_ai_chatfolders_tip__WEBPACK_IMPORTED_MODULE_14__.AIChatFolderStep.apply && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_ai_chatfolders_ai_chatfolders_tip__WEBPACK_IMPORTED_MODULE_14__["default"], {
    loading: aiChatFoldersloading,
    step: aiChatFoldersStep,
    onClose: closeRenderAiChatFoldersTip
  }), shouldRenderFolders && shouldRenderPresetTagModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_ai_chatfolders_preset_modal__WEBPACK_IMPORTED_MODULE_15__["default"], {
    activeTag: folderTabs[activeChatFolder].id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID ? activePresetTag : activeAITag,
    setActiveTag: folderTabs[activeChatFolder].id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID ? setActivePresetTag : setActiveAITag,
    isOpen: shouldRenderPresetTagModal,
    onClose: closeRenderPresetTagModal,
    folderId: folderTabs[activeChatFolder].id
  }), shouldRenderFolders && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_ai_chatfolders_active_tag__WEBPACK_IMPORTED_MODULE_13__["default"], {
    folderType: getFolderType(),
    tags: folderTabs[activeChatFolder]?.id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID ? activePresetTag : activeAITag,
    setActiveTag: folderTabs[activeChatFolder]?.id === _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID ? setActivePresetTag : setActiveAITag
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_31__["default"], {
    ref: transitionRef,
    name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_12__.resolveTransitionName)('slideOptimized', animationLevel, shouldSkipHistoryAnimations, lang.isRtl),
    activeKey: activeChatFolder,
    renderCount: shouldRenderFolders ? folderTabs.length : undefined
  }, renderCurrentTab), subscriptionType && (subscriptionType === 'free' || subscriptionType === 'basic') && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_component_upgrade_tip_tsx__WEBPACK_IMPORTED_MODULE_18__["default"], {
    subscriptionType: subscriptionType
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    chatFolders: {
      byId: chatFoldersById,
      invites: folderInvitesById
    },
    chats: {
      listIds: {
        archived
      }
    },
    stories: {
      orderedPeerIds: {
        archived: archivedStories
      }
    },
    activeSessions: {
      byHash: sessions
    },
    currentUserId,
    archiveSettings,
    subscriptionInfo
  } = global;
  let orderedFolderIds = global.chatFolders.orderedIds;
  const {
    shouldSkipHistoryAnimations,
    activeChatFolder
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const {
    storyViewer: {
      isRibbonShown: isStoryRibbonShown
    }
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsCurrentUserFrozen)(global);
  const {
    aiChatFolders
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_6__.selectSharedSettings)(global);
  if (aiChatFolders !== true) {
    orderedFolderIds = (0,_chatAssistant_ai_chatfolders_util__WEBPACK_IMPORTED_MODULE_17__.filterAIFolder)(orderedFolderIds);
  }
  const {
    animationLevel
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_6__.selectSharedSettings)(global);
  const subscriptionType = subscriptionInfo?.subscriptionType || 'free';
  return {
    chatFoldersById,
    folderInvitesById,
    orderedFolderIds,
    activeChatFolder,
    currentUserId,
    animationLevel,
    shouldSkipHistoryAnimations,
    hasArchivedChats: Boolean(archived?.length),
    hasArchivedStories: Boolean(archivedStories?.length),
    maxFolders: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_5__.selectCurrentLimit)(global, 'dialogFilters'),
    maxFolderInvites: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_5__.selectCurrentLimit)(global, 'chatlistInvites'),
    maxChatLists: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_5__.selectCurrentLimit)(global, 'chatlistJoined'),
    archiveSettings,
    isStoryRibbonShown,
    sessions,
    isAccountFrozen,
    aiChatFolders,
    subscriptionType
  };
})(ChatFolders)));

/***/ },

/***/ "./src/components/left/main/ContactList.async.tsx"
/*!********************************************************!*\
  !*** ./src/components/left/main/ContactList.async.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const ContactListAsync = props => {
  const ContactList = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ContactList');
  return ContactList ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ContactList, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ContactListAsync);

/***/ },

/***/ "./src/components/left/main/LeftMain.scss"
/*!************************************************!*\
  !*** ./src/components/left/main/LeftMain.scss ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/left/main/LeftMain.tsx"
/*!***********************************************!*\
  !*** ./src/components/left/main/LeftMain.tsx ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _hooks_useForumPanelRender__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useForumPanelRender */ "./src/hooks/useForumPanelRender.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _NewChatButton__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../NewChatButton */ "./src/components/left/NewChatButton.tsx");
/* harmony import */ var _search_LeftSearch_async__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../search/LeftSearch.async */ "./src/components/left/search/LeftSearch.async.tsx");
/* harmony import */ var _ChatFolders__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./ChatFolders */ "./src/components/left/main/ChatFolders.tsx");
/* harmony import */ var _ContactList_async__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./ContactList.async */ "./src/components/left/main/ContactList.async.tsx");
/* harmony import */ var _ForumPanel__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./ForumPanel */ "./src/components/left/main/ForumPanel.tsx");
/* harmony import */ var _LeftMainHeader__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./LeftMainHeader */ "./src/components/left/main/LeftMainHeader.tsx");
/* harmony import */ var _LeftMain_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./LeftMain.scss */ "./src/components/left/main/LeftMain.scss");









// import useShowTransitionDeprecated from '../../../hooks/useShowTransitionDeprecated';









const TRANSITION_RENDER_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent).length / 2;
const BUTTON_CLOSE_DELAY_MS = 250;
let closeTimeout;
const LeftMain = ({
  content,
  searchQuery,
  searchDate,
  isClosingSearch,
  contactsFilter,
  shouldSkipTransition,
  foldersDispatch,
  // isAppUpdateAvailable,
  isElectronUpdateAvailable,
  isForumPanelOpen,
  onSearchQuery,
  onReset,
  onTopicSearch,
  isAccountFrozen
}) => {
  const {
    closeForumPanel,
    openLeftColumnContent
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isNewChatButtonShown, setIsNewChatButtonShown] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV);
  const {
    shouldRenderForumPanel,
    handleForumPanelAnimationEnd,
    handleForumPanelAnimationStart,
    isAnimationStarted
  } = (0,_hooks_useForumPanelRender__WEBPACK_IMPORTED_MODULE_4__["default"])(isForumPanelOpen);
  const isForumPanelRendered = isForumPanelOpen && content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
  const isForumPanelVisible = isForumPanelRendered && isAnimationStarted;

  // const {
  //   shouldRender: shouldRenderUpdateButton,
  //   transitionClassNames: updateButtonClassNames,
  // } = useShowTransitionDeprecated(isElectronUpdateAvailable);

  const isMouseInside = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const handleMouseEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (content !== _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList) {
      return;
    }
    isMouseInside.current = true;
    setIsNewChatButtonShown(true);
  });
  const handleMouseLeave = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    isMouseInside.current = false;
    if (closeTimeout) {
      clearTimeout(closeTimeout);
      closeTimeout = undefined;
    }
    closeTimeout = window.setTimeout(() => {
      if (!isMouseInside.current) {
        setIsNewChatButtonShown(false);
      }
    }, BUTTON_CLOSE_DELAY_MS);
  });
  const handleSelectSettings = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Settings
    });
  });
  const handleSelectAIKonwledge = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.AIKonwledge
    });
  });
  const handleSelectAITranslate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.TelyAILanguage
    });
  });
  const handleSelectContacts = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts
    });
  });
  const handleSelectArchived = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived
    });
    closeForumPanel();
  });
  const handleUpdateClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    // fireBaseAnalytics.deferUpdate(webFireBase?.force_update_current_version!);
    // // window.location.reload();
    // // eslint-disable-next-line @typescript-eslint/no-non-null-asserted-optional-chain
    // if (webFireBase?.force_update_store_url!) {
    //   window.location.href = webFireBase?.force_update_store_url;
    // } else {
    //   window.location.reload();
    // }
    if (isElectronUpdateAvailable) {
      window.electron?.installUpdate();
    } else {
      window.location.reload();
    }
  });
  const handleSelectNewChannel = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewChannelStep1
    });
  });
  const handleSelectNewGroup = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.NewGroupStep1
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    let autoCloseTimeout;
    if (content !== _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList) {
      autoCloseTimeout = window.setTimeout(() => {
        setIsNewChatButtonShown(false);
      }, BUTTON_CLOSE_DELAY_MS);
    } else if (isMouseInside.current || _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV) {
      setIsNewChatButtonShown(true);
    }
    return () => {
      if (autoCloseTimeout) {
        clearTimeout(autoCloseTimeout);
        autoCloseTimeout = undefined;
      }
    };
  }, [content]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "LeftColumn-main",
    onMouseEnter: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV ? handleMouseEnter : undefined,
    onMouseLeave: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV ? handleMouseLeave : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_LeftMainHeader__WEBPACK_IMPORTED_MODULE_14__["default"], {
    shouldHideSearch: isForumPanelVisible,
    content: content,
    contactsFilter: contactsFilter,
    onSearchQuery: onSearchQuery,
    onSelectSettings: handleSelectSettings,
    onSelectContacts: handleSelectContacts,
    onSelectArchived: handleSelectArchived,
    onSelectAIKnowledge: handleSelectAIKonwledge,
    onSelectAITranslate: handleSelectAITranslate,
    onReset: onReset,
    shouldSkipTransition: shouldSkipTransition,
    isClosingSearch: isClosingSearch
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_8__["default"], {
    name: shouldSkipTransition ? 'none' : 'zoomFade',
    renderCount: TRANSITION_RENDER_COUNT,
    activeKey: content,
    shouldCleanup: true,
    cleanupExceptionKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList,
    shouldWrap: true,
    wrapExceptionKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList
  }, isActive => {
    switch (content) {
      case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatFolders__WEBPACK_IMPORTED_MODULE_11__["default"], {
          shouldHideFolderTabs: isForumPanelVisible,
          foldersDispatch: foldersDispatch,
          isForumPanelOpen: isForumPanelVisible
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_search_LeftSearch_async__WEBPACK_IMPORTED_MODULE_10__["default"], {
          searchQuery: searchQuery,
          searchDate: searchDate,
          isActive: isActive,
          onReset: onReset
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ContactList_async__WEBPACK_IMPORTED_MODULE_12__["default"], {
          filter: contactsFilter,
          isActive: isActive,
          onReset: onReset
        });
      default:
        return undefined;
    }
  }), isElectronUpdateAvailable && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
    fluid: true,
    badge: true,
    className: "btn-update",
    onClick: handleUpdateClick
  }, lang('lng_update_telegpt')), shouldRenderForumPanel && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ForumPanel__WEBPACK_IMPORTED_MODULE_13__["default"], {
    isOpen: isForumPanelOpen,
    isHidden: !isForumPanelRendered,
    onTopicSearch: onTopicSearch,
    onOpenAnimationStart: handleForumPanelAnimationStart,
    onCloseAnimationEnd: handleForumPanelAnimationEnd
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_NewChatButton__WEBPACK_IMPORTED_MODULE_9__["default"], {
    isShown: isNewChatButtonShown,
    onNewPrivateChat: handleSelectContacts,
    onNewChannel: handleSelectNewChannel,
    onNewGroup: handleSelectNewGroup,
    isAccountFrozen: isAccountFrozen
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(LeftMain));

/***/ },

/***/ "./src/components/left/main/LeftMainHeader.scss"
/*!******************************************************!*\
  !*** ./src/components/left/main/LeftMainHeader.scss ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/left/main/LeftMainHeader.tsx"
/*!*****************************************************!*\
  !*** ./src/components/left/main/LeftMainHeader.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useConnectionStatus */ "./src/hooks/useConnectionStatus.ts");
/* harmony import */ var _hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useElectronDrag */ "./src/hooks/useElectronDrag.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/window/useFullscreen */ "./src/hooks/window/useFullscreen.ts");
/* harmony import */ var _hooks_useLeftHeaderButtonRtlForumTransition__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./hooks/useLeftHeaderButtonRtlForumTransition */ "./src/components/left/main/hooks/useLeftHeaderButtonRtlForumTransition.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PeerChip__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../common/PeerChip */ "./src/components/common/PeerChip.tsx");
/* harmony import */ var _story_StoryToggler__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../story/StoryToggler */ "./src/components/story/StoryToggler.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_SearchInput__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../ui/SearchInput */ "./src/components/ui/SearchInput.tsx");
/* harmony import */ var _ui_ShowTransition__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../ui/ShowTransition */ "./src/components/ui/ShowTransition.tsx");
/* harmony import */ var _ConnectionStatusOverlay__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../ConnectionStatusOverlay */ "./src/components/left/ConnectionStatusOverlay.tsx");
/* harmony import */ var _LeftSideMenuItems__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./LeftSideMenuItems */ "./src/components/left/main/LeftSideMenuItems.tsx");
/* harmony import */ var _StatusButton__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./StatusButton */ "./src/components/left/main/StatusButton.tsx");
/* harmony import */ var _LeftMainHeader_scss__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./LeftMainHeader.scss */ "./src/components/left/main/LeftMainHeader.scss");
/* harmony import */ var _chatAssistant_utils_telegpt_api__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../chatAssistant/utils/telegpt-api */ "./src/components/chatAssistant/utils/telegpt-api.ts");

































const CLEAR_DATE_SEARCH_PARAM = {
  date: undefined
};
const CLEAR_CHAT_SEARCH_PARAM = {
  id: undefined
};
const LeftMainHeader = ({
  shouldHideSearch,
  content,
  contactsFilter,
  isClosingSearch,
  searchQuery,
  isLoading,
  isCurrentUserPremium,
  shouldSkipTransition,
  globalSearchChatId,
  currentContent,
  searchDate,
  theme,
  connectionState,
  isSyncing,
  isFetchingDifference,
  isMessageListOpen,
  isConnectionStatusMinimized,
  areChatsLoaded,
  hasPasscode,
  canSetPasscode,
  onSearchQuery,
  onSelectSettings,
  onSelectContacts,
  onSelectArchived,
  onReset,
  onSelectAIKnowledge,
  onSelectAITranslate
}) => {
  const {
    setGlobalSearchDate,
    setSharedSettingOption,
    setGlobalSearchChatId,
    lockScreen,
    openSettingsScreen,
    searchMessagesGlobal,
    updateSubscriptionInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_17__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const [isBotMenuOpen, markBotMenuOpen, unmarkBotMenuOpen] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const [connectionStatusOpen, openConnectionStatus, closeConnectionStatus] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const areContactsVisible = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts;
  const hasMenu = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.ChatList;
  const selectedSearchDate = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return searchDate ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_9__.formatDateToString)(new Date(searchDate * 1000)) : undefined;
  }, [searchDate]);
  const {
    connectionStatus,
    connectionStatusText,
    connectionStatusPosition
  } = (0,_hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_11__["default"])(oldLang, connectionState, isSyncing || isFetchingDifference, isMessageListOpen, isConnectionStatusMinimized, !areChatsLoaded);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (connectionStatus === _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_11__.ConnectionStatus.offline || connectionStatus === _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_11__.ConnectionStatus.waitingForNetwork || connectionStatus === _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_11__.ConnectionStatus.syncing) {
      openConnectionStatus();
    } else if (connectionStatus === _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_11__.ConnectionStatus.online) {
      closeConnectionStatus();
    }
  }, [connectionStatus]);
  const handleLockScreenHotkey = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(e => {
    e.preventDefault();
    e.stopPropagation();
    if (hasPasscode) {
      lockScreen();
    } else {
      openSettingsScreen({
        screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.PasscodeDisabled
      });
    }
  });
  (0,_hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_14__.useHotkeys)((0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => canSetPasscode ? {
    'Ctrl+Shift+L': handleLockScreenHotkey,
    'Alt+Shift+L': handleLockScreenHotkey,
    'Meta+Shift+L': handleLockScreenHotkey,
    ...(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_APP && {
      'Mod+L': handleLockScreenHotkey
    })
  } : undefined, [canSetPasscode]));
  const MainButton = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => {
      const handleTrigger = () => {
        onTrigger();
        (0,_chatAssistant_utils_telegpt_api__WEBPACK_IMPORTED_MODULE_31__.getSubscriptionInfo)().then(res => {
          if (res.code === 0) {
            updateSubscriptionInfo({
              subscriptionType: res.data.subscriptionType,
              creditBalance: res.data.creditBalance,
              createdAt: res.data.createdAt,
              subscriptionExpiresAt: res.data.subscriptionExpiresAt,
              isExpirated: res.data.isExpirated
            });
          }
        });
      };
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_23__["default"], {
        round: true,
        ripple: hasMenu && !isMobile,
        size: "smaller",
        color: "translucent",
        className: isOpen ? 'active' : '',
        onClick: hasMenu ? handleTrigger : () => onReset(),
        ariaLabel: hasMenu ? oldLang('AccDescrOpenMenu2') : 'Return to chat list'
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('animated-menu-icon', !hasMenu && 'state-back', shouldSkipTransition && 'no-animation')
      }));
    };
  }, [hasMenu, isMobile, oldLang, onReset, shouldSkipTransition]);
  const handleSearchFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (!searchQuery) {
      onSearchQuery('');
    }
  });
  const toggleConnectionStatus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    setSharedSettingOption({
      isConnectionStatusMinimized: !isConnectionStatusMinimized
    });
    closeConnectionStatus();
  });
  const handleLockScreen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    lockScreen();
  });
  const handleSearchEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (searchQuery && content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch) {
      searchMessagesGlobal({
        type: 'publicPosts',
        shouldResetResultsByType: true
      });
    }
  });
  const isSearchRelevant = Boolean(globalSearchChatId) || content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.GlobalSearch || content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts;
  const isSearchFocused = isMobile ? !isMessageListOpen && isSearchRelevant : isSearchRelevant;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isSearchFocused ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_8__["default"])(() => onReset()) : undefined, [isSearchFocused, onReset]);
  const searchInputPlaceholder = content === _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Contacts ? lang('SearchFriends') : lang('Search');

  // const versionString = IS_BETA ? `${APP_VERSION} Beta (${APP_REVISION})` : (DEBUG ? APP_REVISION : APP_VERSION);

  const isFullscreen = (0,_hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_18__.useFullscreenStatus)();

  // Disable dropdown menu RTL animation for resize
  const {
    shouldDisableDropdownMenuTransitionRef,
    handleDropdownMenuTransitionEnd
  } = (0,_hooks_useLeftHeaderButtonRtlForumTransition__WEBPACK_IMPORTED_MODULE_19__["default"])(shouldHideSearch);
  const headerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  (0,_hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_12__["default"])(headerRef);
  const withStoryToggler = !isSearchFocused && !selectedSearchDate && !globalSearchChatId && !areContactsVisible;
  const searchContent = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, selectedSearchDate && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerChip__WEBPACK_IMPORTED_MODULE_21__["default"], {
      icon: "calendar",
      title: selectedSearchDate,
      canClose: true,
      isMinimized: Boolean(globalSearchChatId),
      className: "left-search-picker-item",
      onClick: setGlobalSearchDate,
      isCloseNonDestructive: true,
      clickArg: CLEAR_DATE_SEARCH_PARAM
    }), globalSearchChatId && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerChip__WEBPACK_IMPORTED_MODULE_21__["default"], {
      className: "left-search-picker-item",
      peerId: globalSearchChatId,
      onClick: setGlobalSearchChatId,
      canClose: true,
      isMinimized: true,
      clickArg: CLEAR_CHAT_SEARCH_PARAM
    }));
  }, [globalSearchChatId, selectedSearchDate]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "LeftMainHeader"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "LeftMainHeader",
    className: "left-header",
    ref: headerRef
  }, oldLang.isRtl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "DropdownMenuFiller"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_24__["default"], {
    trigger: MainButton,
    footer: `${_config__WEBPACK_IMPORTED_MODULE_3__.APP_NAME} ${"0.0.30"}`,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('main-menu', oldLang.isRtl && 'rtl', shouldHideSearch && oldLang.isRtl && 'right-aligned', shouldDisableDropdownMenuTransitionRef.current && oldLang.isRtl && 'disable-transition'),
    forceOpen: isBotMenuOpen,
    positionX: shouldHideSearch && oldLang.isRtl ? 'right' : 'left',
    transformOriginX: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_ELECTRON && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_MAC_OS && !isFullscreen ? 90 : undefined,
    onTransitionEnd: oldLang.isRtl ? handleDropdownMenuTransitionEnd : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_LeftSideMenuItems__WEBPACK_IMPORTED_MODULE_28__["default"], {
    onSelectArchived: onSelectArchived,
    onSelectContacts: onSelectContacts,
    onSelectSettings: onSelectSettings,
    onSelectAIKnowledge: onSelectAIKnowledge,
    onSelectAITranslate: onSelectAITranslate,
    onBotMenuOpened: markBotMenuOpen,
    onBotMenuClosed: unmarkBotMenuOpen
  })), currentContent === _types__WEBPACK_IMPORTED_MODULE_2__.GlobalSearchContent.AI && !hasMenu ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "text-[16px] font-semibold flex flex-row justify-center items-center flex-1"
  }, "AI Search") : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_25__["default"], {
    inputId: "telegram-search-input",
    resultsItemSelector: ".LeftSearch .ListItem-button",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(globalSearchChatId || searchDate ? 'with-picker-item' : undefined, shouldHideSearch && 'SearchInput--hidden'),
    value: isClosingSearch ? undefined : contactsFilter || searchQuery,
    focused: isSearchFocused,
    isLoading: isLoading || connectionStatusPosition === 'minimized',
    spinnerColor: connectionStatusPosition === 'minimized' ? 'yellow' : undefined,
    spinnerBackgroundColor: connectionStatusPosition === 'minimized' && theme === 'light' ? 'light' : undefined,
    placeholder: searchInputPlaceholder,
    autoComplete: "off",
    canClose: Boolean(globalSearchChatId || searchDate),
    onChange: onSearchQuery,
    onReset: onReset,
    onFocus: handleSearchFocus,
    onSpinnerClick: connectionStatusPosition === 'minimized' ? toggleConnectionStatus : undefined,
    onEnter: handleSearchEnter
  }, searchContent, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_story_StoryToggler__WEBPACK_IMPORTED_MODULE_22__["default"], {
    canShow: withStoryToggler
  })), isCurrentUserPremium && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StatusButton__WEBPACK_IMPORTED_MODULE_29__["default"], null), hasPasscode && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_23__["default"], {
    round: true,
    ripple: !isMobile,
    size: "smaller",
    color: "translucent",
    ariaLabel: `${oldLang('ShortcutsController.Others.LockByPasscode')} (Ctrl+Shift+L)`,
    onClick: handleLockScreen,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(!isCurrentUserPremium && 'extra-spacing')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
    name: "lock"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ShowTransition__WEBPACK_IMPORTED_MODULE_26__["default"]
  // isOpen={connectionStatusPosition === 'overlay'}
  , {
    isOpen: connectionStatusOpen,
    isCustom: true,
    className: "connection-state-wrapper"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ConnectionStatusOverlay__WEBPACK_IMPORTED_MODULE_27__["default"], {
    connectionStatus: connectionStatus,
    connectionStatusText: connectionStatusText,
    onClick: toggleConnectionStatus
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const {
    query: searchQuery,
    fetchingStatus,
    chatId,
    minDate,
    currentContent
  } = tabState.globalSearch;
  const {
    connectionState,
    isSyncing,
    isFetchingDifference
  } = global;
  const {
    isConnectionStatusMinimized
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_5__.selectSharedSettings)(global);
  return {
    searchQuery,
    isLoading: fetchingStatus ? Boolean(fetchingStatus.chats || fetchingStatus.messages) : false,
    globalSearchChatId: chatId,
    currentContent,
    searchDate: minDate,
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTheme)(global),
    connectionState,
    isSyncing,
    isFetchingDifference,
    isMessageListOpen: Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global)),
    isConnectionStatusMinimized,
    isCurrentUserPremium: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsCurrentUserPremium)(global),
    areChatsLoaded: Boolean(global.chats.listIds.active),
    hasPasscode: Boolean(global.passcode.hasPasscode),
    canSetPasscode: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanSetPasscode)(global)
  };
})(LeftMainHeader)));

/***/ },

/***/ "./src/components/left/main/LeftSideMenuItems.tsx"
/*!********************************************************!*\
  !*** ./src/components/left/main/LeftSideMenuItems.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/modal/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_initialState__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/initialState */ "./src/global/initialState.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/browser/globalEnvironment */ "./src/util/browser/globalEnvironment.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_installPrompt__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../util/installPrompt */ "./src/util/installPrompt.ts");
/* harmony import */ var _util_permanentWebVersion__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../util/permanentWebVersion */ "./src/util/permanentWebVersion.ts");
/* harmony import */ var _chatAssistant_ai_chatfolders_ai_chatfolders_tip__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../chatAssistant/ai-chatfolders/ai-chatfolders-tip */ "./src/components/chatAssistant/ai-chatfolders/ai-chatfolders-tip.tsx");
/* harmony import */ var _chatAssistant_ai_chatfolders_util__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../chatAssistant/ai-chatfolders/util */ "./src/components/chatAssistant/ai-chatfolders/util.ts");
/* harmony import */ var _chatAssistant_ai_task_ai_chatfolders_task__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../chatAssistant/ai-task/ai-chatfolders-task */ "./src/components/chatAssistant/ai-task/ai-chatfolders-task.ts");
/* harmony import */ var _chatAssistant_assets_ai_chat_folder_png__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../chatAssistant/assets/ai-chat-folder.png */ "./src/components/chatAssistant/assets/ai-chat-folder.png");
/* harmony import */ var _chatAssistant_assets_invite_invite_gift_png__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../chatAssistant/assets/invite/invite-gift.png */ "./src/components/chatAssistant/assets/invite/invite-gift.png");
/* harmony import */ var _chatAssistant_assets_ai_translate_png__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../chatAssistant/assets/ai-translate.png */ "./src/components/chatAssistant/assets/ai-translate.png");
/* harmony import */ var _chatAssistant_store__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../chatAssistant/store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../chatAssistant/lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _middle_composer_AttachBotItem__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../middle/composer/AttachBotItem */ "./src/components/middle/composer/AttachBotItem.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../ui/MenuSeparator */ "./src/components/ui/MenuSeparator.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_Switcher__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../../ui/Switcher */ "./src/components/ui/Switcher.tsx");
/* harmony import */ var _ui_Toggle__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../../ui/Toggle */ "./src/components/ui/Toggle.tsx");
/* harmony import */ var _AccountMenuItems__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./AccountMenuItems */ "./src/components/left/main/AccountMenuItems.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");





































const LeftSideMenuItems = ({
  currentUserId,
  archiveSettings,
  animationLevel,
  theme,
  canInstall,
  attachBots,
  currentUser,
  accountsTotalLimit,
  aiChatFolders,
  enableChatSorting,
  subscriptionInfo,
  onSelectArchived,
  onSelectContacts,
  onSelectSettings,
  onBotMenuOpened,
  onBotMenuClosed,
  onSelectAIKnowledge,
  onSelectAITranslate
}) => {
  const {
    openChat,
    setSharedSettingOption,
    updatePerformanceSettings,
    openChatByUsername,
    openUrl,
    openChatWithInfo,
    openCreditsModal,
    openInviteFriendsModal,
    openLeftColumnContent
  } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_26__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_24__["default"])();
  const animationLevelValue = animationLevel !== _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_LEVEL_MIN ? animationLevel === _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_LEVEL_MAX ? 'max' : 'mid' : 'min';
  const withOtherVersions = !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_10__.IS_ELECTRON && (window.location.hostname === _config__WEBPACK_IMPORTED_MODULE_4__.PRODUCTION_HOSTNAME || _config__WEBPACK_IMPORTED_MODULE_4__.IS_TEST);
  const archivedUnreadChatsCount = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_23__.useFolderManagerForUnreadCounters)()[_config__WEBPACK_IMPORTED_MODULE_4__.ARCHIVED_FOLDER_ID]?.chatsCount || 0;
  const bots = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => Object.values(attachBots).filter(bot => bot.isForSideMenu), [attachBots]);
  const handleSelectMyProfile = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openChatWithInfo({
      id: currentUserId,
      shouldReplaceHistory: true,
      profileTab: 'stories'
    });
  });
  const handleSelectSaved = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openChat({
      id: currentUserId,
      shouldReplaceHistory: true
    });
  });
  const handleDarkModeToggle = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(e => {
    e.stopPropagation();
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setSharedSettingOption({
      theme: newTheme
    });
    setSharedSettingOption({
      shouldUseSystemTheme: false
    });
  });
  const handleCreditsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openCreditsModal();
  });
  const handleInviteFriendsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openInviteFriendsModal();
  });
  const handleAnimationLevelChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(e => {
    e.stopPropagation();
    let newLevel = animationLevel + 1;
    if (newLevel > _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_LEVEL_MAX) {
      newLevel = _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_LEVEL_MIN;
    }
    const performanceSettings = newLevel === _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_LEVEL_MIN ? _global_initialState__WEBPACK_IMPORTED_MODULE_5__.INITIAL_PERFORMANCE_STATE_MIN : newLevel === _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_LEVEL_MAX ? _global_initialState__WEBPACK_IMPORTED_MODULE_5__.INITIAL_PERFORMANCE_STATE_MAX : _global_initialState__WEBPACK_IMPORTED_MODULE_5__.INITIAL_PERFORMANCE_STATE_MED;
    setSharedSettingOption({
      animationLevel: newLevel,
      wasAnimationLevelSetManually: true
    });
    updatePerformanceSettings(performanceSettings);
  });
  const handleChangelogClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    window.open(_config__WEBPACK_IMPORTED_MODULE_4__.BETA_CHANGELOG_URL, '_blank', 'noopener');
  });
  const handleSwitchToWebK = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    (0,_util_permanentWebVersion__WEBPACK_IMPORTED_MODULE_15__.switchPermanentWebVersion)('K');
  });
  const handleOpenTipsChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openChatByUsername({
      username: oldLang('Settings.TipsUsername')
    });
  });
  const handleBugReportClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openUrl({
      url: _config__WEBPACK_IMPORTED_MODULE_4__.FEEDBACK_URL
    });
  });
  const handleOpenMyStories = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openChatWithInfo({
      id: currentUserId,
      shouldReplaceHistory: true,
      profileTab: 'stories'
    });
  });
  const [aiChatFoldersLoading, setAiChatFoldersLoading] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const handleSwitchChatSorting = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(e => {
    e.stopPropagation();
    const isEnabled = !enableChatSorting;
    setSharedSettingOption({
      enableChatSorting: isEnabled
    });
    // 
    setTimeout(() => {
      console.log('');
      (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_13__.forceResortFolder)(0); // 0  ID
    }, 0);
  });
  const handleSwitchAIChatFolders = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(async e => {
    if (aiChatFoldersLoading) return;
    e.stopPropagation();
    const isOpen = !aiChatFolders;
    if (!isOpen) {
      antd__WEBPACK_IMPORTED_MODULE_1__["default"].confirm({
        title: 'Are you sure?',
        content: 'This will hide all AI chat folders, but you can enable this feature again.',
        onOk: async () => {
          setAiChatFoldersLoading(true);
          setSharedSettingOption({
            aiChatFolders: isOpen
          });
          // delete ai chat folders
          await (0,_chatAssistant_ai_chatfolders_util__WEBPACK_IMPORTED_MODULE_17__.deleteAiChatFoldersFromUser)();
          (0,_chatAssistant_ai_chatfolders_util__WEBPACK_IMPORTED_MODULE_17__.hideTip)(_chatAssistant_ai_chatfolders_ai_chatfolders_tip__WEBPACK_IMPORTED_MODULE_16__.AIChatFolderStep.classify);
          setAiChatFoldersLoading(false);
        },
        onCancel: () => {}
      });
    } else {
      setAiChatFoldersLoading(true);
      setSharedSettingOption({
        aiChatFolders: isOpen
      });
      await _chatAssistant_ai_task_ai_chatfolders_task__WEBPACK_IMPORTED_MODULE_18__.aiChatFoldersTask.applyChatFolder();
      _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_27__["default"].emit(_chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_27__.Actions.UpdateAIChatFoldersApplying, {
        loading: false
      });
      _chatAssistant_store__WEBPACK_IMPORTED_MODULE_22__.ChataiStores.general?.set(_chatAssistant_store__WEBPACK_IMPORTED_MODULE_22__.GLOBAL_AICHATFOLDERS_TIP_SHOW, false);
      setAiChatFoldersLoading(false);
    }
  });
  const updateAIChatFoldersLoading = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(({
    loading,
    isApply
  }) => {
    if (isApply) {
      setAiChatFoldersLoading(loading);
    } else {
      const isNext = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)().chatFolders.nextAiChatFolders?.length;
      if (isNext) {
        setAiChatFoldersLoading(false);
      } else {
        setAiChatFoldersLoading(loading);
      }
    }
  }, []);
  const handleSelectNewGroup = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_3__.LeftColumnContent.NewGroupStep1
    });
  });
  const handleSelectNewChannel = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_3__.LeftColumnContent.NewChannelStep1
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_27__["default"].on(_chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_27__.Actions.UpdateSettingAIChatFoldersLoading, updateAIChatFoldersLoading);
    return () => {
      _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_27__["default"].off(_chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_27__.Actions.UpdateSettingAIChatFoldersLoading, updateAIChatFoldersLoading);
    };
  }, [updateAIChatFoldersLoading]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, _util_browser_globalEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_MULTIACCOUNT_SUPPORTED && currentUser && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AccountMenuItems__WEBPACK_IMPORTED_MODULE_34__["default"], {
    currentUser: currentUser,
    totalLimit: accountsTotalLimit,
    onSelectCurrent: onSelectSettings
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_30__["default"], null)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    onClick: handleCreditsClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "pl-[1.25rem] pr-[0.75rem] w-full flex items-center justify-between"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('Credits')), subscriptionInfo?.creditBalance && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[13px] font-semibold text-[#037EE5]"
  }, Math.max(0, Math.round(subscriptionInfo?.creditBalance))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_35__["default"], {
    name: "arrow-right",
    className: "mr-0"
  }))))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_30__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    customIcon: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: "icon",
      src: _chatAssistant_assets_ai_translate_png__WEBPACK_IMPORTED_MODULE_21__,
      alt: "ai-translate",
      style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_12__["default"])('width: 24px;height: 24px;max-width: 24px;')
    }),
    onClick: onSelectAITranslate
  }, oldLang('TelyAI Language')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    customIcon: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: "icon",
      src: _chatAssistant_assets_invite_invite_gift_png__WEBPACK_IMPORTED_MODULE_20__,
      alt: "ai-translate",
      style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_12__["default"])('width: 24px;height: 24px;max-width: 24px;')
    }),
    onClick: handleInviteFriendsClick
  }, oldLang('Invite Friends')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    customIcon: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: "icon",
      src: _chatAssistant_assets_ai_chat_folder_png__WEBPACK_IMPORTED_MODULE_19__,
      alt: "ai-chat-folders",
      style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_12__["default"])('width: 24px;height: 24px;max-width: 24px; padding:3px;')
    }),
    onClick: handleSwitchAIChatFolders
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-name capitalize"
  }, oldLang('AI Chat Folders')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("label", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_11__["default"])('Switcher no-animation', aiChatFoldersLoading ? 'disabled' : ''),
    title: ""
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("input", {
    type: "checkbox",
    id: "aiChatFolders",
    checked: aiChatFolders === true,
    disabled: true
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "widget"
  })), aiChatFoldersLoading && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_31__["default"], {
    className: "w-[18px] h-[18px] ml-2",
    color: theme === 'dark' ? 'white' : 'black'
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "sort",
    onClick: handleSwitchChatSorting
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-name"
  }, oldLang('Chat Sorting')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Switcher__WEBPACK_IMPORTED_MODULE_32__["default"], {
    label: "",
    checked: enableChatSorting === true,
    noAnimation: true
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "channel",
    onClick: handleSelectNewChannel
  }, lang('NewChannel')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "group",
    onClick: handleSelectNewGroup
  }, lang('NewGroup')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "saved-messages",
    onClick: handleSelectSaved
  }, oldLang('SavedMessages')), archiveSettings.isHidden && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "archive",
    onClick: onSelectArchived
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-name"
  }, oldLang('ArchivedChats')), archivedUnreadChatsCount > 0 && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "right-badge"
  }, archivedUnreadChatsCount)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "group",
    onClick: onSelectContacts
  }, oldLang('Contacts')), bots.map(bot => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_AttachBotItem__WEBPACK_IMPORTED_MODULE_28__["default"], {
    bot: bot,
    theme: theme,
    isInSideMenu: true,
    canShowNew: true,
    onMenuOpened: onBotMenuOpened,
    onMenuClosed: onBotMenuClosed
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "settings",
    onClick: onSelectSettings
  }, oldLang('Settings')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "darkmode",
    onClick: handleDarkModeToggle
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-name"
  }, oldLang('lng_menu_night_mode')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Switcher__WEBPACK_IMPORTED_MODULE_32__["default"], {
    id: "darkmode",
    label: oldLang(theme === 'dark' ? 'lng_settings_disable_night_theme' : 'lng_settings_enable_night_theme'),
    checked: theme === 'dark',
    noAnimation: true
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "animations",
    onClick: handleAnimationLevelChange
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-name capitalize"
  }, oldLang('Appearance.Animations').toLowerCase()), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Toggle__WEBPACK_IMPORTED_MODULE_33__["default"], {
    value: animationLevelValue
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "help",
    onClick: handleOpenTipsChat
  }, oldLang('TelegramFeatures')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "bug",
    onClick: handleBugReportClick
  }, lang('MenuReportBug')), _config__WEBPACK_IMPORTED_MODULE_4__.IS_BETA && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "permissions",
    onClick: handleChangelogClick
  }, lang('MenuBetaChangelog')), withOtherVersions && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "K",
    isCharIcon: true,
    href: `${_config__WEBPACK_IMPORTED_MODULE_4__.WEB_VERSION_BASE}k`,
    onClick: handleSwitchToWebK
  }, lang('MenuSwitchToK')), canInstall && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_29__["default"], {
    icon: "install",
    onClick: (0,_util_installPrompt__WEBPACK_IMPORTED_MODULE_14__.getPromptInstall)()
  }, lang('MenuInstallApp')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_2__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const {
    currentUserId,
    archiveSettings,
    subscriptionInfo
  } = global;
  const {
    animationLevel,
    aiChatFolders,
    enableChatSorting
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_8__.selectSharedSettings)(global);
  const attachBots = global.attachMenu.bots;
  return {
    currentUserId,
    currentUser: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, currentUserId),
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTheme)(global),
    animationLevel,
    canInstall: Boolean(tabState.canInstall),
    archiveSettings,
    attachBots,
    accountsTotalLimit: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_7__.selectPremiumLimit)(global, 'moreAccounts'),
    aiChatFolders,
    enableChatSorting,
    subscriptionInfo
  };
})(LeftSideMenuItems)));

/***/ },

/***/ "./src/components/left/main/StatusButton.tsx"
/*!***************************************************!*\
  !*** ./src/components/left/main/StatusButton.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_reactions_CustomEmojiEffect__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/reactions/CustomEmojiEffect */ "./src/components/common/reactions/CustomEmojiEffect.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _StatusPickerMenu_async__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./StatusPickerMenu.async */ "./src/components/left/main/StatusPickerMenu.async.tsx");















const EFFECT_DURATION_MS = 1500;
const EMOJI_STATUS_SIZE = 24;
const StatusButton = ({
  emojiStatus,
  collectibleStatuses,
  isAccountFrozen
}) => {
  const {
    setEmojiStatus,
    loadCurrentUser,
    openFrozenAccountModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const buttonRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [shouldShowEffect, markShouldShowEffect, unmarkShouldShowEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const [isEffectShown, showEffect, hideEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const [isStatusPickerOpen, openStatusPicker, closeStatusPicker] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(false);
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const delay = emojiStatus?.until ? (emojiStatus.until - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_4__.getServerTime)()) * 1000 : undefined;
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__["default"])(loadCurrentUser, delay);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__["default"])(([prevEmojiStatus]) => {
    if (shouldShowEffect && emojiStatus && emojiStatus.documentId !== prevEmojiStatus?.documentId) {
      showEffect();
      unmarkShouldShowEffect();
    }
  }, [emojiStatus, shouldShowEffect, showEffect, unmarkShouldShowEffect]);
  const handleEmojiStatusSet = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(sticker => {
    const collectibleStatus = collectibleStatuses?.find(status => 'collectibleId' in status && status.documentId === sticker.id);
    markShouldShowEffect();
    setEmojiStatus({
      emojiStatus: collectibleStatus || {
        type: 'regular',
        documentId: sticker.id
      }
    });
  }, [markShouldShowEffect, setEmojiStatus, collectibleStatuses]);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_5__["default"])(hideEffect, isEffectShown ? EFFECT_DURATION_MS : undefined);
  const handleEmojiStatusClick = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (isAccountFrozen) {
      openFrozenAccountModal();
      return;
    }
    openStatusPicker();
  }, [openStatusPicker, isAccountFrozen]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "StatusButton extra-spacing"
  }, Boolean(isEffectShown && emojiStatus) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_reactions_CustomEmojiEffect__WEBPACK_IMPORTED_MODULE_11__["default"], {
    reaction: emojiStatus,
    isLottie: true,
    className: "emoji-status-effect"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    round: true,
    ref: buttonRef,
    ripple: !isMobile,
    size: "smaller",
    color: "translucent",
    className: "emoji-status",
    onClick: handleEmojiStatusClick
  }, emojiStatus ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_9__["default"], {
    key: emojiStatus.documentId,
    documentId: emojiStatus.documentId,
    size: EMOJI_STATUS_SIZE,
    loopLimit: _config__WEBPACK_IMPORTED_MODULE_2__.EMOJI_STATUS_LOOP_LIMIT,
    withSparkles: emojiStatus?.type === 'collectible'
  }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_10__["default"], null)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StatusPickerMenu_async__WEBPACK_IMPORTED_MODULE_13__["default"], {
    statusButtonRef: buttonRef,
    isOpen: isStatusPickerOpen,
    onEmojiStatusSelect: handleEmojiStatusSet,
    onClose: closeStatusPicker
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    currentUserId
  } = global;
  const currentUser = currentUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, currentUserId) : undefined;
  const collectibleStatuses = global.collectibleEmojiStatuses?.statuses;
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserFrozen)(global);
  return {
    emojiStatus: currentUser?.emojiStatus,
    collectibleStatuses,
    isAccountFrozen
  };
})(StatusButton)));

/***/ },

/***/ "./src/components/left/main/StatusPickerMenu.async.tsx"
/*!*************************************************************!*\
  !*** ./src/components/left/main/StatusPickerMenu.async.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StatusPickerMenuAsync = props => {
  const {
    isOpen
  } = props;
  const StatusPickerMenu = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StatusPickerMenu', !isOpen);
  return StatusPickerMenu ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StatusPickerMenu, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StatusPickerMenuAsync);

/***/ },

/***/ "./src/components/left/newChat/NewChat.async.tsx"
/*!*******************************************************!*\
  !*** ./src/components/left/newChat/NewChat.async.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const NewChatAsync = props => {
  const NewChat = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'NewChat');
  return NewChat ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(NewChat, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewChatAsync);

/***/ },

/***/ "./src/components/left/search/LeftSearch.async.tsx"
/*!*********************************************************!*\
  !*** ./src/components/left/search/LeftSearch.async.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const LeftSearchAsync = props => {
  const LeftSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'LeftSearch');
  return LeftSearch ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(LeftSearch, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (LeftSearchAsync);

/***/ },

/***/ "./src/components/left/settings/Settings.async.tsx"
/*!*********************************************************!*\
  !*** ./src/components/left/settings/Settings.async.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const SettingsAsync = props => {
  const Settings = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Settings');
  return Settings ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Settings, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SettingsAsync);

/***/ },

/***/ "./src/components/main/AttachBotRecipientPicker.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/main/AttachBotRecipientPicker.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const AttachBotRecipientPickerAsync = props => {
  const {
    requestedAttachBotInChat
  } = props;
  const AttachBotRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AttachBotRecipientPicker', !requestedAttachBotInChat);
  return AttachBotRecipientPicker ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AttachBotRecipientPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AttachBotRecipientPickerAsync);

/***/ },

/***/ "./src/components/main/BotTrustModal.async.tsx"
/*!*****************************************************!*\
  !*** ./src/components/main/BotTrustModal.async.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const BotTrustModalAsync = props => {
  const {
    bot
  } = props;
  const BotTrustModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'BotTrustModal', !bot);
  return BotTrustModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(BotTrustModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BotTrustModalAsync);

/***/ },

/***/ "./src/components/main/DeleteFolderDialog.async.tsx"
/*!**********************************************************!*\
  !*** ./src/components/main/DeleteFolderDialog.async.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const DeleteFolderDialogAsync = props => {
  const {
    folder
  } = props;
  const DeleteFolderDialog = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'DeleteFolderDialog', !folder);
  return DeleteFolderDialog ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(DeleteFolderDialog, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DeleteFolderDialogAsync);

/***/ },

/***/ "./src/components/main/Dialogs.async.tsx"
/*!***********************************************!*\
  !*** ./src/components/main/Dialogs.async.tsx ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const DialogsAsync = ({
  isOpen
}) => {
  const Dialogs = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Dialogs', !isOpen);
  return Dialogs ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Dialogs, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DialogsAsync);

/***/ },

/***/ "./src/components/main/DownloadManager.tsx"
/*!*************************************************!*\
  !*** ./src/components/main/DownloadManager.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_download__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/download */ "./src/util/download.ts");
/* harmony import */ var _util_generateUniqueId__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/generateUniqueId */ "./src/util/generateUniqueId.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useRunDebounced */ "./src/hooks/useRunDebounced.ts");










const GLOBAL_UPDATE_DEBOUNCE = 1000;
const processedHashes = new Set();
const downloadedHashes = new Set();
const DownloadManager = ({
  activeDownloads
}) => {
  const {
    cancelMediaHashDownloads,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const runDebounced = (0,_hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_9__["default"])(GLOBAL_UPDATE_DEBOUNCE, true);
  const handleMediaDownloaded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(hash => {
    downloadedHashes.add(hash);
    runDebounced(() => {
      if (downloadedHashes.size) {
        cancelMediaHashDownloads({
          mediaHashes: Array.from(downloadedHashes)
        });
        downloadedHashes.clear();
      }
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!Object.keys(activeDownloads).length) {
      processedHashes.clear();
      return;
    }
    Object.entries(activeDownloads).forEach(([mediaHash, metadata]) => {
      if (processedHashes.has(mediaHash)) {
        return;
      }
      processedHashes.add(mediaHash);
      const {
        size,
        filename,
        format: mediaFormat
      } = metadata;
      const mediaData = _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.getFromMemory(mediaHash);
      if (mediaData) {
        (0,_util_download__WEBPACK_IMPORTED_MODULE_5__["default"])(mediaData, filename);
        handleMediaDownloaded(mediaHash);
        return;
      }
      if (size > _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.MAX_BUFFER_SIZE && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_OPFS_SUPPORTED && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_SERVICE_WORKER_SUPPORTED) {
        showNotification({
          message: 'Downloading files bigger than 2GB is not supported in your browser.'
        });
        handleMediaDownloaded(mediaHash);
        return;
      }
      const handleProgress = () => {
        const currentDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)()).activeDownloads;
        if (!currentDownloads[mediaHash]) {
          _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.cancelProgress(handleProgress);
        }
      };
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.fetch(mediaHash, mediaFormat, true, handleProgress, (0,_util_generateUniqueId__WEBPACK_IMPORTED_MODULE_6__["default"])()).then(result => {
        if (mediaFormat === _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.DownloadUrl) {
          const url = new URL(result, window.document.baseURI);
          url.searchParams.set('filename', encodeURIComponent(filename));
          const downloadWindow = window.open(url.toString());
          downloadWindow?.addEventListener('beforeunload', () => {
            showNotification({
              message: 'Download started. Please, do not close the app before it is finished.'
            });
          });
        } else if (result) {
          (0,_util_download__WEBPACK_IMPORTED_MODULE_5__["default"])(result, filename);
        }
        handleMediaDownloaded(mediaHash);
      });
    });
  }, [activeDownloads]);
  return undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global).activeDownloads;
  return {
    activeDownloads
  };
})(DownloadManager)));

/***/ },

/***/ "./src/components/main/DraftRecipientPicker.async.tsx"
/*!************************************************************!*\
  !*** ./src/components/main/DraftRecipientPicker.async.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const DraftRecipientPickerAsync = props => {
  const {
    requestedDraft
  } = props;
  const DraftRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'DraftRecipientPicker', !requestedDraft);
  return DraftRecipientPicker ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(DraftRecipientPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DraftRecipientPickerAsync);

/***/ },

/***/ "./src/components/main/ForwardRecipientPicker.async.tsx"
/*!**************************************************************!*\
  !*** ./src/components/main/ForwardRecipientPicker.async.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ForwardRecipientPickerAsync = props => {
  const {
    isOpen
  } = props;
  const ForwardRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ForwardRecipientPicker', !isOpen);
  return ForwardRecipientPicker ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ForwardRecipientPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ForwardRecipientPickerAsync);

/***/ },

/***/ "./src/components/main/GameModal.scss"
/*!********************************************!*\
  !*** ./src/components/main/GameModal.scss ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/main/GameModal.tsx"
/*!*******************************************!*\
  !*** ./src/components/main/GameModal.tsx ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useSendMessageAction__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useSendMessageAction */ "./src/hooks/useSendMessageAction.ts");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _GameModal_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./GameModal.scss */ "./src/components/main/GameModal.scss");










const PLAY_GAME_ACTION_INTERVAL = 5000;
const GameModal = ({
  openedGame,
  gameTitle,
  canPost
}) => {
  const {
    closeGame,
    openForwardMenu
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const {
    url,
    chatId,
    messageId
  } = openedGame || {};
  const isOpen = Boolean(url);
  const sendMessageAction = (0,_hooks_useSendMessageAction__WEBPACK_IMPORTED_MODULE_6__["default"])(chatId);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    sendMessageAction({
      type: 'playingGame'
    });
  }, isOpen && canPost ? PLAY_GAME_ACTION_INTERVAL : undefined);
  const handleMessage = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(event => {
    if (!chatId || !messageId) return;
    try {
      const data = JSON.parse(event.data);
      if (data.eventType === 'share_score') {
        openForwardMenu({
          fromChatId: chatId,
          messageIds: [messageId],
          withMyScore: true
        });
        closeGame();
      }
      if (data.eventType === 'share_game') {
        openForwardMenu({
          fromChatId: chatId,
          messageIds: [messageId]
        });
        closeGame();
      }
    } catch (e) {
      // Ignore other messages
    }
  }, [chatId, closeGame, messageId, openForwardMenu]);
  const handleLoad = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(event => {
    event.currentTarget.focus();
  }, []);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    window.addEventListener('message', handleMessage);
    return () => window.removeEventListener('message', handleMessage);
  }, [handleMessage]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Modal__WEBPACK_IMPORTED_MODULE_7__["default"], {
    className: "GameModal",
    isOpen: isOpen,
    onClose: closeGame,
    title: gameTitle,
    hasCloseButton: true
  }, isOpen && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("iframe", {
    className: "game-frame",
    onLoad: handleLoad,
    src: url,
    title: lang('AttachGame'),
    sandbox: "allow-scripts allow-same-origin allow-orientation-lock",
    allow: "fullscreen"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  openedGame
}) => {
  const {
    chatId
  } = openedGame || {};
  const chat = chatId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  const chatFullInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatFullInfo)(global, chatId) : undefined;
  const canPost = Boolean(chat) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCanPostInChat)(chat, undefined, undefined, chatFullInfo);
  return {
    canPost
  };
})(GameModal)));

/***/ },

/***/ "./src/components/main/HistoryCalendar.async.tsx"
/*!*******************************************************!*\
  !*** ./src/components/main/HistoryCalendar.async.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const HistoryCalendarAsync = props => {
  const {
    isOpen
  } = props;
  const HistoryCalendar = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'HistoryCalendar', !isOpen);
  return HistoryCalendar ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(HistoryCalendar, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (HistoryCalendarAsync);

/***/ },

/***/ "./src/components/main/LockScreen.module.scss"
/*!****************************************************!*\
  !*** ./src/components/main/LockScreen.module.scss ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"container":"bdKGCai4","wrapper":"BIi4Pl4Z","icon":"JwlsF2tF","help":"VlXFyC_a"});

/***/ },

/***/ "./src/components/main/LockScreen.tsx"
/*!********************************************!*\
  !*** ./src/components/main/LockScreen.tsx ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _util_passcode__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/passcode */ "./src/util/passcode.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_PasswordForm__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../common/PasswordForm */ "./src/components/common/PasswordForm.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./LockScreen.module.scss */ "./src/components/main/LockScreen.module.scss");
/* harmony import */ var _assets_lock_png__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../assets/lock.png */ "./src/assets/lock.png");
















const ICON_SIZE = 160;
const LockScreen = ({
  isLocked,
  passcodeSettings
}) => {
  const {
    unlockScreen,
    signOut,
    logInvalidUnlockAttempt,
    resetInvalidUnlockAttempts
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    invalidAttemptsCount,
    timeoutUntil,
    isLoading
  } = passcodeSettings;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const [validationError, setValidationError] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [shouldShowPasscode, setShouldShowPasscode] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isSignOutDialogOpen, openSignOutConfirmation, closeSignOutConfirmation] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])(false);
  const {
    shouldRender
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_7__["default"])(isLocked);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_4__["default"])(resetInvalidUnlockAttempts, timeoutUntil ? timeoutUntil - Date.now() : undefined);
  const handleClearError = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setValidationError('');
  }, []);
  const handleSubmit = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(passcode => {
    if (timeoutUntil !== undefined) {
      setValidationError(lang('FloodWait'));
      return;
    }
    setValidationError('');
    (0,_util_passcode__WEBPACK_IMPORTED_MODULE_2__.decryptSession)(passcode).then(unlockScreen, err => {
      if (err instanceof _util_passcode__WEBPACK_IMPORTED_MODULE_2__.UnrecoverablePasscodeError) {
        signOut({
          forceInitApi: true
        });
      }
      logInvalidUnlockAttempt();
      setValidationError(lang('lng_passcode_wrong'));
    });
  }, [lang, timeoutUntil]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (timeoutUntil !== undefined) {
      setValidationError(lang('FloodWait'));
    } else if (invalidAttemptsCount === 0) {
      setValidationError('');
    }
  }, [timeoutUntil, lang, invalidAttemptsCount]);
  const handleSignOutMessage = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    closeSignOutConfirmation();
    signOut({
      forceInitApi: true
    });
  }, [closeSignOutConfirmation, signOut]);
  if (!shouldRender) {
    return undefined;
  }
  function renderLogoutPrompt() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].help
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_12__["default"], {
      onClick: openSignOutConfirmation
    }, "Log out"), ' ', "if you don't remember your passcode."), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
      color: "translucent",
      size: "tiny",
      isText: true,
      onClick: openSignOutConfirmation
    }, lang('AccountSettings.Logout'))));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].container
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].wrapper,
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_8__["default"], {
    tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_3__.LOCAL_TGS_URLS.Lock,
    previewUrl: _assets_lock_png__WEBPACK_IMPORTED_MODULE_14__,
    size: ICON_SIZE,
    className: _LockScreen_module_scss__WEBPACK_IMPORTED_MODULE_13__["default"].icon
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PasswordForm__WEBPACK_IMPORTED_MODULE_9__["default"], {
    key: "password-form",
    shouldShowSubmit: true,
    shouldDisablePasswordManager: true,
    isLoading: isLoading,
    error: validationError,
    placeholder: lang('Passcode.EnterPasscodePlaceholder'),
    submitLabel: lang('Next'),
    clearError: handleClearError,
    isPasswordVisible: shouldShowPasscode,
    noRipple: true,
    onChangePasswordVisibility: setShouldShowPasscode,
    onSubmit: handleSubmit
  }), renderLogoutPrompt()), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isOpen: isSignOutDialogOpen,
    onClose: closeSignOutConfirmation,
    text: lang('lng_sure_logout'),
    confirmLabel: lang('AccountSettings.Logout'),
    confirmHandler: handleSignOutMessage,
    confirmIsDestructive: true
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    passcodeSettings: global.passcode
  };
})(LockScreen)));

/***/ },

/***/ "./src/components/main/Main.scss"
/*!***************************************!*\
  !*** ./src/components/main/Main.scss ***!
  \***************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/main/Main.tsx"
/*!**************************************!*\
  !*** ./src/components/main/Main.tsx ***!
  \**************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _global_actions_all__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../global/actions/all */ "./src/global/actions/all.ts");
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/teact/teact-dom */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types_electron__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../types/electron */ "./src/types/electron.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/cssAnimationEndListeners */ "./src/util/cssAnimationEndListeners.ts");
/* harmony import */ var _util_deeplink__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../util/deeplink */ "./src/util/deeplink.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _util_updateIcon__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../util/updateIcon */ "./src/util/updateIcon.ts");
/* harmony import */ var _chatAssistant_component_guidance_guidance_modal__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../chatAssistant/component/guidance/guidance-modal */ "./src/components/chatAssistant/component/guidance/guidance-modal.tsx");
/* harmony import */ var _chatAssistant_room_ai_room_attachments_modal__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../chatAssistant/room-ai/room-attachments-modal */ "./src/components/chatAssistant/room-ai/room-attachments-modal.tsx");
/* harmony import */ var _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../chatAssistant/variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePreventPinchZoomGesture__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/usePreventPinchZoomGesture */ "./src/hooks/usePreventPinchZoomGesture.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");
/* harmony import */ var _hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../hooks/window/useBeforeUnload */ "./src/hooks/window/useBeforeUnload.ts");
/* harmony import */ var _hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../hooks/window/useFullscreen */ "./src/hooks/window/useFullscreen.ts");
/* harmony import */ var _calls_ActiveCallHeader_async__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../calls/ActiveCallHeader.async */ "./src/components/calls/ActiveCallHeader.async.tsx");
/* harmony import */ var _calls_group_GroupCall_async__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../calls/group/GroupCall.async */ "./src/components/calls/group/GroupCall.async.tsx");
/* harmony import */ var _calls_phone_PhoneCall_async__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../calls/phone/PhoneCall.async */ "./src/components/calls/phone/PhoneCall.async.tsx");
/* harmony import */ var _calls_phone_RatePhoneCallModal_async__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../calls/phone/RatePhoneCallModal.async */ "./src/components/calls/phone/RatePhoneCallModal.async.tsx");
/* harmony import */ var _common_CustomEmojiSetsModal_async__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../common/CustomEmojiSetsModal.async */ "./src/components/common/CustomEmojiSetsModal.async.tsx");
/* harmony import */ var _common_DeleteMessageModal_async__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../common/DeleteMessageModal.async */ "./src/components/common/DeleteMessageModal.async.tsx");
/* harmony import */ var _common_StickerSetModal_async__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ../common/StickerSetModal.async */ "./src/components/common/StickerSetModal.async.tsx");
/* harmony import */ var _common_UnreadCounter__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ../common/UnreadCounter */ "./src/components/common/UnreadCounter.tsx");
/* harmony import */ var _left_LeftColumn__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ../left/LeftColumn */ "./src/components/left/LeftColumn.tsx");
/* harmony import */ var _mediaViewer_MediaViewer_async__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../mediaViewer/MediaViewer.async */ "./src/components/mediaViewer/MediaViewer.async.tsx");
/* harmony import */ var _middle_message_reactions_ReactionPicker_async__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ../middle/message/reactions/ReactionPicker.async */ "./src/components/middle/message/reactions/ReactionPicker.async.tsx");
/* harmony import */ var _middle_MessageListHistoryHandler__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ../middle/MessageListHistoryHandler */ "./src/components/middle/MessageListHistoryHandler.tsx");
/* harmony import */ var _middle_MiddleColumn__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ../middle/MiddleColumn */ "./src/components/middle/MiddleColumn.tsx");
/* harmony import */ var _middle_panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ../middle/panes/AudioPlayer */ "./src/components/middle/panes/AudioPlayer.tsx");
/* harmony import */ var _modals_ModalContainer__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ../modals/ModalContainer */ "./src/components/modals/ModalContainer.tsx");
/* harmony import */ var _payment_PaymentModal_async__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ../payment/PaymentModal.async */ "./src/components/payment/PaymentModal.async.tsx");
/* harmony import */ var _payment_ReceiptModal_async__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ../payment/ReceiptModal.async */ "./src/components/payment/ReceiptModal.async.tsx");
/* harmony import */ var _right_RightColumn__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ../right/RightColumn */ "./src/components/right/RightColumn.tsx");
/* harmony import */ var _story_StoryViewer_async__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ../story/StoryViewer.async */ "./src/components/story/StoryViewer.async.tsx");
/* harmony import */ var _AttachBotRecipientPicker_async__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ./AttachBotRecipientPicker.async */ "./src/components/main/AttachBotRecipientPicker.async.tsx");
/* harmony import */ var _BotTrustModal_async__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ./BotTrustModal.async */ "./src/components/main/BotTrustModal.async.tsx");
/* harmony import */ var _DeleteFolderDialog_async__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ./DeleteFolderDialog.async */ "./src/components/main/DeleteFolderDialog.async.tsx");
/* harmony import */ var _Dialogs_async__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ./Dialogs.async */ "./src/components/main/Dialogs.async.tsx");
/* harmony import */ var _DownloadManager__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ./DownloadManager */ "./src/components/main/DownloadManager.tsx");
/* harmony import */ var _DraftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./DraftRecipientPicker.async */ "./src/components/main/DraftRecipientPicker.async.tsx");
/* harmony import */ var _ForwardRecipientPicker_async__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ./ForwardRecipientPicker.async */ "./src/components/main/ForwardRecipientPicker.async.tsx");
/* harmony import */ var _GameModal__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ./GameModal */ "./src/components/main/GameModal.tsx");
/* harmony import */ var _HistoryCalendar_async__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ./HistoryCalendar.async */ "./src/components/main/HistoryCalendar.async.tsx");
/* harmony import */ var _NewContactModal_async__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ./NewContactModal.async */ "./src/components/main/NewContactModal.async.tsx");
/* harmony import */ var _Notifications_async__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ./Notifications.async */ "./src/components/main/Notifications.async.tsx");
/* harmony import */ var _premium_common_PremiumLimitReachedModal_async__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ./premium/common/PremiumLimitReachedModal.async */ "./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx");
/* harmony import */ var _premium_GiveawayModal_async__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! ./premium/GiveawayModal.async */ "./src/components/main/premium/GiveawayModal.async.tsx");
/* harmony import */ var _premium_PremiumMainModal_async__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! ./premium/PremiumMainModal.async */ "./src/components/main/premium/PremiumMainModal.async.tsx");
/* harmony import */ var _premium_StarsGiftingPickerModal_async__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! ./premium/StarsGiftingPickerModal.async */ "./src/components/main/premium/StarsGiftingPickerModal.async.tsx");
/* harmony import */ var _SafeLinkModal_async__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(/*! ./SafeLinkModal.async */ "./src/components/main/SafeLinkModal.async.tsx");
/* harmony import */ var _visualEffects_ConfettiContainer__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(/*! ./visualEffects/ConfettiContainer */ "./src/components/main/visualEffects/ConfettiContainer.tsx");
/* harmony import */ var _visualEffects_SnapEffectContainer__WEBPACK_IMPORTED_MODULE_67__ = __webpack_require__(/*! ./visualEffects/SnapEffectContainer */ "./src/components/main/visualEffects/SnapEffectContainer.tsx");
/* harmony import */ var _visualEffects_WaveContainer__WEBPACK_IMPORTED_MODULE_68__ = __webpack_require__(/*! ./visualEffects/WaveContainer */ "./src/components/main/visualEffects/WaveContainer.tsx");
/* harmony import */ var _Main_scss__WEBPACK_IMPORTED_MODULE_69__ = __webpack_require__(/*! ./Main.scss */ "./src/components/main/Main.scss");







































































// const APP_OUTDATED_TIMEOUT_MS = 5 * 60 * 1000; // 5 min
const CALL_BUNDLE_LOADING_DELAY_MS = 5000; // 5 sec

let DEBUG_isLogged = false;
const Main = ({
  isMobile,
  isLeftColumnOpen,
  isMiddleColumnOpen,
  isRightColumnOpen,
  isMediaViewerOpen,
  isStoryViewerOpen,
  isForwardModalOpen,
  hasNotifications,
  hasDialogs,
  activeGroupCallId,
  safeLinkModalUrl,
  isHistoryCalendarOpen,
  shouldSkipHistoryAnimations,
  limitReached,
  openedStickerSetShortName,
  openedCustomEmojiSetIds,
  isServiceChatReady,
  withInterfaceAnimations,
  wasTimeFormatSetManually,
  addedSetIds,
  addedCustomEmojiIds,
  isPhoneCallActive,
  newContactUserId,
  newContactByPhoneNumber,
  openedGame,
  gameTitle,
  isRatePhoneCallModalOpen,
  botTrustRequest,
  botTrustRequestBot,
  requestedAttachBotInChat,
  requestedDraft,
  isPremiumModalOpen,
  isGiveawayModalOpen,
  isDeleteMessageModalOpen,
  isStarsGiftingPickerModal,
  isPaymentModalOpen,
  isReceiptModalOpen,
  isReactionPickerOpen,
  isCurrentUserPremium,
  deleteFolderDialog,
  isMasterTab,
  noRightColumnAnimation,
  isSynced,
  currentUserId,
  isAccountFrozen,
  isAppConfigLoaded,
  isRoomAttachmentsModalOpen
}) => {
  const {
    initMain,
    loadAnimatedEmojis,
    loadBirthdayNumbersStickers,
    loadRestrictedEmojiStickers,
    loadNotificationSettings,
    loadNotificationExceptions,
    updateIsOnline,
    onTabFocusChange,
    loadTopInlineBots,
    loadEmojiKeywords,
    loadCountryList,
    loadAvailableReactions,
    loadStickerSets,
    loadPremiumGifts,
    loadTonGifts,
    loadStarGifts,
    loadDefaultTopicIcons,
    loadAddedStickers,
    loadFavoriteStickers,
    loadDefaultStatusIcons,
    ensureTimeFormat,
    closeStickerSetModal,
    closeCustomEmojiSets,
    checkVersionNotification,
    loadConfig,
    loadAppConfig,
    loadAttachBots,
    loadContactList,
    loadCustomEmojis,
    loadGenericEmojiEffects,
    closePaymentModal,
    clearReceipt,
    checkAppVersion,
    openThread,
    toggleLeftColumn,
    loadRecentEmojiStatuses,
    loadUserCollectibleStatuses,
    updatePageTitle,
    loadTopReactions,
    loadRecentReactions,
    loadDefaultTagReactions,
    loadFeaturedEmojiStickers,
    setIsElectronUpdateAvailable,
    loadAuthorizations,
    loadPeerColors,
    loadSavedReactionTags,
    loadTimezones,
    loadQuickReplies,
    loadStarStatus,
    loadAvailableEffects,
    loadTopBotApps,
    loadPaidReactionPrivacy,
    loadPasswordInfo,
    loadBotFreezeAppeal,
    loadAllChats,
    loadAllStories,
    loadAllHiddenStories,
    closeRoomAttachmentsModal,
    loadContentSettings
  } = (0,_global__WEBPACK_IMPORTED_MODULE_3__.getActions)();
  if (_config__WEBPACK_IMPORTED_MODULE_5__.DEBUG && !DEBUG_isLogged) {
    DEBUG_isLogged = true;
    // eslint-disable-next-line no-console
    console.log('>>> RENDER MAIN');
  }
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_23__["default"])();

  // Preload Calls bundle to initialize sounds for iOS
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_20__["default"])(() => {
    void (0,_util_moduleLoader__WEBPACK_IMPORTED_MODULE_14__.loadBundle)(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_14__.Bundles.Calls);
  }, CALL_BUNDLE_LOADING_DELAY_MS);
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)();
  const leftColumnRef = (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)();
  const {
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_21__["default"])();
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!isLeftColumnOpen && !isMiddleColumnOpen && !isDesktop) {
      // Always display at least one column
      toggleLeftColumn();
    } else if (isLeftColumnOpen && isMiddleColumnOpen && isMobile) {
      // Can't have two active columns at the same time
      toggleLeftColumn();
    }
  }, [isDesktop, isLeftColumnOpen, isMiddleColumnOpen, isMobile, toggleLeftColumn]);

  // useInterval(checkAppVersion, isMasterTab ? APP_OUTDATED_TIMEOUT_MS : undefined, true);

  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_ELECTRON) {
      return undefined;
    }
    const removeUpdateAvailableListener = window.electron.on(_types_electron__WEBPACK_IMPORTED_MODULE_4__.ElectronEvent.UPDATE_AVAILABLE, () => {
      setIsElectronUpdateAvailable({
        isAvailable: true
      });
    });
    const removeUpdateErrorListener = window.electron.on(_types_electron__WEBPACK_IMPORTED_MODULE_4__.ElectronEvent.UPDATE_ERROR, () => {
      setIsElectronUpdateAvailable({
        isAvailable: false
      });
      removeUpdateAvailableListener?.();
    });
    return () => {
      removeUpdateErrorListener?.();
      removeUpdateAvailableListener?.();
    };
  }, []);

  // Initial API calls
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isSynced) {
      updateIsOnline({
        isOnline: true
      });
      loadConfig();
      loadAppConfig();
      loadPeerColors();
      initMain();
      loadContactList();
      checkAppVersion();
      loadAuthorizations();
      loadPasswordInfo();
    }
  }, [isMasterTab, isSynced]);

  // Initial API calls
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isSynced && isAppConfigLoaded && !isAccountFrozen) {
      loadAllChats({
        listType: 'saved'
      });
      loadAllStories();
      loadAllHiddenStories();
      loadContentSettings();
      loadRecentReactions();
      loadDefaultTagReactions();
      loadAttachBots();
      loadNotificationSettings();
      loadNotificationExceptions();
      loadTopInlineBots();
      loadTopReactions();
      loadStarStatus();
      loadEmojiKeywords({
        language: _config__WEBPACK_IMPORTED_MODULE_5__.BASE_EMOJI_KEYWORD_LANG
      });
      loadFeaturedEmojiStickers();
      loadSavedReactionTags();
      loadTopBotApps();
      loadPaidReactionPrivacy();
      loadDefaultTopicIcons();
      loadAnimatedEmojis();
      loadAvailableReactions();
      loadUserCollectibleStatuses();
      loadGenericEmojiEffects();
      loadPremiumGifts();
      loadTonGifts();
      loadStarGifts();
      loadAvailableEffects();
      loadBirthdayNumbersStickers();
      loadRestrictedEmojiStickers();
      loadQuickReplies();
      loadTimezones();
    }
  }, [isMasterTab, isSynced, isAppConfigLoaded, isAccountFrozen]);

  // Initial Premium API calls
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isCurrentUserPremium && isAppConfigLoaded && !isAccountFrozen) {
      loadDefaultStatusIcons();
      loadRecentEmojiStatuses();
    }
  }, [isCurrentUserPremium, isMasterTab, isAppConfigLoaded, isAccountFrozen]);

  // Language-based API calls
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab) {
      if (lang.code !== _config__WEBPACK_IMPORTED_MODULE_5__.BASE_EMOJI_KEYWORD_LANG) {
        loadEmojiKeywords({
          language: lang.code
        });
      }
      loadCountryList({
        langCode: lang.code
      });
    }
  }, [lang, isMasterTab]);

  // Re-fetch cached saved emoji for `localDb`
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab) {
      loadCustomEmojis({
        ids: Object.keys((0,_global__WEBPACK_IMPORTED_MODULE_3__.getGlobal)().customEmojis.byId),
        ignoreCache: true
      });
    }
  }, [isMasterTab]);

  // Sticker sets
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isMasterTab && isSynced && isAppConfigLoaded && !isAccountFrozen) {
      if (!addedSetIds || !addedCustomEmojiIds) {
        loadStickerSets();
        loadFavoriteStickers();
      }
      if (addedSetIds && addedCustomEmojiIds) {
        loadAddedStickers();
      }
    }
  }, [addedSetIds, addedCustomEmojiIds, isMasterTab, isSynced, isAppConfigLoaded, isAccountFrozen]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    loadBotFreezeAppeal();
  }, [isAppConfigLoaded]);

  // Check version when service chat is ready
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (isServiceChatReady && isMasterTab) {
      checkVersionNotification();
    }
  }, [isServiceChatReady, isMasterTab]);

  // Ensure time format
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!wasTimeFormatSetManually) {
      ensureTimeFormat();
    }
  }, [wasTimeFormatSetManually]);

  // Parse deep link
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    if (!isSynced) return;
    updatePageTitle();
    const parsedInitialLocationHash = (0,_util_routing__WEBPACK_IMPORTED_MODULE_15__.parseInitialLocationHash)();
    if (parsedInitialLocationHash?.tgaddr) {
      (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_12__.processDeepLink)(decodeURIComponent(parsedInitialLocationHash.tgaddr));
    }
  }, [isSynced]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    return window.electron?.on(_types_electron__WEBPACK_IMPORTED_MODULE_4__.ElectronEvent.DEEPLINK, link => {
      (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_12__.processDeepLink)(decodeURIComponent(link));
    });
  }, []);
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    const parsedLocationHash = (0,_util_routing__WEBPACK_IMPORTED_MODULE_15__.parseLocationHash)(currentUserId);
    if (!parsedLocationHash) return;
    openThread({
      chatId: parsedLocationHash.chatId,
      threadId: parsedLocationHash.threadId,
      type: parsedLocationHash.type
    });
  }, [currentUserId]);

  // Default open summary chat when entering Main after login (no deep link)
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
    const parsed = (0,_util_routing__WEBPACK_IMPORTED_MODULE_15__.parseLocationHash)(global.currentUserId);
    if (parsed) return;
    const currentList = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_13__.getCurrentTabId)());
    if (!currentList || currentList.chatId !== _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_19__.GLOBAL_SUMMARY_CHATID) {
      (0,_global__WEBPACK_IMPORTED_MODULE_3__.getActions)().openChat({
        id: _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_19__.GLOBAL_SUMMARY_CHATID,
        shouldReplaceHistory: true
      });
    }
  }, [currentUserId]);

  // Restore Transition slide class after async rendering
  (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useLayoutEffect)(() => {
    const container = containerRef.current;
    if (container.parentNode.childElementCount === 1) {
      (0,_lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_2__.addExtraClass)(container, 'Transition_slide-active');
    }
  }, []);
  (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_26__["default"])({
    ref: containerRef,
    isOpen: isLeftColumnOpen,
    noCloseTransition: shouldSkipHistoryAnimations,
    prefix: 'left-column-'
  });
  const willAnimateLeftColumnRef = (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_22__["default"])();

  // Handle opening middle column
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__["default"])(([prevIsLeftColumnOpen]) => {
    if (prevIsLeftColumnOpen === undefined || isLeftColumnOpen === prevIsLeftColumnOpen || !withInterfaceAnimations) {
      return;
    }
    willAnimateLeftColumnRef.current = true;
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_ANDROID) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.requestNextMutation)(() => {
        document.body.classList.toggle('android-left-blackout-open', !isLeftColumnOpen);
      });
    }
    const endHeavyAnimation = (0,_teact__WEBPACK_IMPORTED_MODULE_1__.beginHeavyAnimation)();
    (0,_util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_11__.waitForTransitionEnd)(document.getElementById('MiddleColumn'), () => {
      endHeavyAnimation();
      willAnimateLeftColumnRef.current = false;
      forceUpdate();
    });
  }, [isLeftColumnOpen, withInterfaceAnimations, forceUpdate]);
  (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_26__["default"])({
    ref: containerRef,
    isOpen: isRightColumnOpen,
    noCloseTransition: shouldSkipHistoryAnimations,
    prefix: 'right-column-'
  });
  const willAnimateRightColumnRef = (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);
  const [isNarrowMessageList, setIsNarrowMessageList] = (0,_teact__WEBPACK_IMPORTED_MODULE_1__.useState)(isRightColumnOpen);
  const isFullscreen = (0,_hooks_window_useFullscreen__WEBPACK_IMPORTED_MODULE_30__.useFullscreenStatus)();

  // Handle opening right column
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__["default"])(([prevIsMiddleColumnOpen, prevIsRightColumnOpen]) => {
    if (prevIsRightColumnOpen === undefined || isRightColumnOpen === prevIsRightColumnOpen) {
      return;
    }
    if (!prevIsMiddleColumnOpen || noRightColumnAnimation) {
      setIsNarrowMessageList(isRightColumnOpen);
      return;
    }
    willAnimateRightColumnRef.current = true;
    const endHeavyAnimation = (0,_teact__WEBPACK_IMPORTED_MODULE_1__.beginHeavyAnimation)();
    (0,_util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_11__.waitForTransitionEnd)(document.getElementById('RightColumn'), () => {
      endHeavyAnimation();
      willAnimateRightColumnRef.current = false;
      forceUpdate();
      setIsNarrowMessageList(isRightColumnOpen);
    });
  }, [isMiddleColumnOpen, isRightColumnOpen, noRightColumnAnimation, forceUpdate]);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_10__["default"])(willAnimateLeftColumnRef.current && 'left-column-animating', willAnimateRightColumnRef.current && 'right-column-animating', isNarrowMessageList && 'narrow-message-list', shouldSkipHistoryAnimations && 'history-animation-disabled', isFullscreen && 'is-fullscreen');
  const handleBlur = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    onTabFocusChange({
      isBlurred: true
    });
  });
  const handleFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    onTabFocusChange({
      isBlurred: false
    });
    if (!document.title.includes(_config__WEBPACK_IMPORTED_MODULE_5__.INACTIVE_MARKER)) {
      updatePageTitle();
    }
    (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_16__["default"])(false);
  });
  const handleStickerSetModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    closeStickerSetModal();
  });
  const handleCustomEmojiSetsModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    closeCustomEmojiSets();
  });
  const handleRoomAttachmentsModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_24__["default"])(() => {
    closeRoomAttachmentsModal();
  });

  // Online status and browser tab indicators
  (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_28__["default"])(handleBlur, handleFocus, Boolean(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_ELECTRON));
  (0,_hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_29__["default"])(handleBlur);
  (0,_hooks_usePreventPinchZoomGesture__WEBPACK_IMPORTED_MODULE_25__["default"])(isMediaViewerOpen || isStoryViewerOpen);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    ref: containerRef,
    id: "Main",
    className: className
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_left_LeftColumn__WEBPACK_IMPORTED_MODULE_39__["default"], {
    ref: leftColumnRef
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_middle_MiddleColumn__WEBPACK_IMPORTED_MODULE_43__["default"], {
    leftColumnRef: leftColumnRef,
    isMobile: isMobile
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_right_RightColumn__WEBPACK_IMPORTED_MODULE_48__["default"], {
    isMobile: isMobile
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_mediaViewer_MediaViewer_async__WEBPACK_IMPORTED_MODULE_40__["default"], {
    isOpen: isMediaViewerOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_story_StoryViewer_async__WEBPACK_IMPORTED_MODULE_49__["default"], {
    isOpen: isStoryViewerOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_ForwardRecipientPicker_async__WEBPACK_IMPORTED_MODULE_56__["default"], {
    isOpen: isForwardModalOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_DraftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_55__["default"], {
    requestedDraft: requestedDraft
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_Notifications_async__WEBPACK_IMPORTED_MODULE_60__["default"], {
    isOpen: hasNotifications
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_Dialogs_async__WEBPACK_IMPORTED_MODULE_53__["default"], {
    isOpen: hasDialogs
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_middle_panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_44__["default"], {
    noUi: true
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_modals_ModalContainer__WEBPACK_IMPORTED_MODULE_45__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_SafeLinkModal_async__WEBPACK_IMPORTED_MODULE_65__["default"], {
    url: safeLinkModalUrl
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_HistoryCalendar_async__WEBPACK_IMPORTED_MODULE_58__["default"], {
    isOpen: isHistoryCalendarOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_common_StickerSetModal_async__WEBPACK_IMPORTED_MODULE_37__["default"], {
    isOpen: Boolean(openedStickerSetShortName),
    onClose: handleStickerSetModalClose,
    stickerSetShortName: openedStickerSetShortName
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_common_CustomEmojiSetsModal_async__WEBPACK_IMPORTED_MODULE_35__["default"], {
    customEmojiSetIds: openedCustomEmojiSetIds,
    onClose: handleCustomEmojiSetsModalClose
  }), activeGroupCallId && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_calls_group_GroupCall_async__WEBPACK_IMPORTED_MODULE_32__["default"], {
    groupCallId: activeGroupCallId
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_calls_ActiveCallHeader_async__WEBPACK_IMPORTED_MODULE_31__["default"], {
    isActive: Boolean(activeGroupCallId || isPhoneCallActive)
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_NewContactModal_async__WEBPACK_IMPORTED_MODULE_59__["default"], {
    isOpen: Boolean(newContactUserId || newContactByPhoneNumber),
    userId: newContactUserId,
    isByPhoneNumber: newContactByPhoneNumber
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_GameModal__WEBPACK_IMPORTED_MODULE_57__["default"], {
    openedGame: openedGame,
    gameTitle: gameTitle
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_DownloadManager__WEBPACK_IMPORTED_MODULE_54__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_visualEffects_ConfettiContainer__WEBPACK_IMPORTED_MODULE_66__["default"], null), _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_9__.IS_WAVE_TRANSFORM_SUPPORTED && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_visualEffects_WaveContainer__WEBPACK_IMPORTED_MODULE_68__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_visualEffects_SnapEffectContainer__WEBPACK_IMPORTED_MODULE_67__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_calls_phone_PhoneCall_async__WEBPACK_IMPORTED_MODULE_33__["default"], {
    isActive: isPhoneCallActive
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_common_UnreadCounter__WEBPACK_IMPORTED_MODULE_38__["default"], {
    isForAppBadge: true
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_calls_phone_RatePhoneCallModal_async__WEBPACK_IMPORTED_MODULE_34__["default"], {
    isOpen: isRatePhoneCallModalOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_BotTrustModal_async__WEBPACK_IMPORTED_MODULE_51__["default"], {
    bot: botTrustRequestBot,
    type: botTrustRequest?.type,
    shouldRequestWriteAccess: botTrustRequest?.shouldRequestWriteAccess
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_AttachBotRecipientPicker_async__WEBPACK_IMPORTED_MODULE_50__["default"], {
    requestedAttachBotInChat: requestedAttachBotInChat
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_middle_MessageListHistoryHandler__WEBPACK_IMPORTED_MODULE_42__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_premium_PremiumMainModal_async__WEBPACK_IMPORTED_MODULE_63__["default"], {
    isOpen: isPremiumModalOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_premium_GiveawayModal_async__WEBPACK_IMPORTED_MODULE_62__["default"], {
    isOpen: isGiveawayModalOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_premium_StarsGiftingPickerModal_async__WEBPACK_IMPORTED_MODULE_64__["default"], {
    isOpen: isStarsGiftingPickerModal
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_premium_common_PremiumLimitReachedModal_async__WEBPACK_IMPORTED_MODULE_61__["default"], {
    limit: limitReached
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_payment_PaymentModal_async__WEBPACK_IMPORTED_MODULE_46__["default"], {
    isOpen: isPaymentModalOpen,
    onClose: closePaymentModal
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_payment_ReceiptModal_async__WEBPACK_IMPORTED_MODULE_47__["default"], {
    isOpen: isReceiptModalOpen,
    onClose: clearReceipt
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_DeleteFolderDialog_async__WEBPACK_IMPORTED_MODULE_52__["default"], {
    folder: deleteFolderDialog
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_middle_message_reactions_ReactionPicker_async__WEBPACK_IMPORTED_MODULE_41__["default"], {
    isOpen: isReactionPickerOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_common_DeleteMessageModal_async__WEBPACK_IMPORTED_MODULE_36__["default"], {
    isOpen: isDeleteMessageModalOpen
  }), isRoomAttachmentsModalOpen && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_chatAssistant_room_ai_room_attachments_modal__WEBPACK_IMPORTED_MODULE_18__["default"], {
    isOpen: Boolean(isRoomAttachmentsModalOpen),
    onClose: handleRoomAttachmentsModalClose
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_chatAssistant_component_guidance_guidance_modal__WEBPACK_IMPORTED_MODULE_17__["default"], null));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_1__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_3__.withGlobal)((global, {
  isMobile
}) => {
  const {
    currentUserId
  } = global;
  const {
    botTrustRequest,
    requestedAttachBotInChat,
    requestedDraft,
    safeLinkModalUrl,
    openedStickerSetShortName,
    openedCustomEmojiSetIds,
    shouldSkipHistoryAnimations,
    openedGame,
    isLeftColumnShown,
    historyCalendarSelectedAt,
    notifications,
    dialogs,
    newContact,
    ratingPhoneCall,
    premiumModal,
    giveawayModal,
    deleteMessageModal,
    starsGiftingPickerModal,
    isMasterTab,
    payment,
    limitReachedModal,
    deleteFolderDialogModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global);
  const {
    wasTimeFormatSetManually
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_8__.selectSharedSettings)(global);
  const gameMessage = openedGame && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, openedGame.chatId, openedGame.messageId);
  const gameTitle = gameMessage?.content.game?.title;
  const {
    chatId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global) || {};
  const noRightColumnAnimation = !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPerformanceSettingsValue)(global, 'rightColumnAnimations') || !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCanAnimateInterface)(global);
  const deleteFolderDialog = deleteFolderDialogModal ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatFolder)(global, deleteFolderDialogModal) : undefined;
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsCurrentUserFrozen)(global);
  return {
    currentUserId,
    isLeftColumnOpen: isLeftColumnShown,
    isMiddleColumnOpen: Boolean(chatId),
    isRightColumnOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsRightColumnShown)(global, isMobile),
    isMediaViewerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsMediaViewerOpen)(global),
    isStoryViewerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsStoryViewerOpen)(global),
    isForwardModalOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsForwardModalOpen)(global),
    isReactionPickerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsReactionPickerOpen)(global),
    hasNotifications: Boolean(notifications.length),
    hasDialogs: Boolean(dialogs.length),
    safeLinkModalUrl,
    isHistoryCalendarOpen: Boolean(historyCalendarSelectedAt),
    shouldSkipHistoryAnimations,
    openedStickerSetShortName,
    openedCustomEmojiSetIds,
    isServiceChatReady: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsServiceChatReady)(global),
    activeGroupCallId: isMasterTab ? global.groupCalls.activeGroupCallId : undefined,
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCanAnimateInterface)(global),
    wasTimeFormatSetManually,
    isPhoneCallActive: isMasterTab ? Boolean(global.phoneCall) : undefined,
    addedSetIds: global.stickers.added.setIds,
    addedCustomEmojiIds: global.customEmojis.added.setIds,
    newContactUserId: newContact?.userId,
    newContactByPhoneNumber: newContact?.isByPhoneNumber,
    openedGame,
    gameTitle,
    isRatePhoneCallModalOpen: Boolean(ratingPhoneCall),
    botTrustRequest,
    botTrustRequestBot: botTrustRequest && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, botTrustRequest.botId),
    requestedAttachBotInChat,
    isCurrentUserPremium: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsCurrentUserPremium)(global),
    isPremiumModalOpen: premiumModal?.isOpen,
    isGiveawayModalOpen: giveawayModal?.isOpen,
    isDeleteMessageModalOpen: Boolean(deleteMessageModal),
    isStarsGiftingPickerModal: starsGiftingPickerModal?.isOpen,
    limitReached: limitReachedModal?.limit,
    isPaymentModalOpen: payment.isPaymentModalOpen,
    isReceiptModalOpen: Boolean(payment.receipt),
    deleteFolderDialog,
    isMasterTab,
    requestedDraft,
    noRightColumnAnimation,
    isSynced: global.isSynced,
    isAccountFrozen,
    isAppConfigLoaded: global.isAppConfigLoaded,
    isRoomAttachmentsModalOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global).isRoomAttachmentsModalOpen
  };
})(Main)));

/***/ },

/***/ "./src/components/main/NewContactModal.async.tsx"
/*!*******************************************************!*\
  !*** ./src/components/main/NewContactModal.async.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const NewContactModalAsync = props => {
  const {
    isOpen
  } = props;
  const NewContactModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'NewContactModal', !isOpen);
  return NewContactModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(NewContactModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NewContactModalAsync);

/***/ },

/***/ "./src/components/main/Notifications.async.tsx"
/*!*****************************************************!*\
  !*** ./src/components/main/Notifications.async.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const NotificationsAsync = ({
  isOpen
}) => {
  const Notifications = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Notifications', !isOpen);
  return Notifications ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Notifications, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NotificationsAsync);

/***/ },

/***/ "./src/components/main/SafeLinkModal.async.tsx"
/*!*****************************************************!*\
  !*** ./src/components/main/SafeLinkModal.async.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SafeLinkModalAsync = props => {
  const {
    url
  } = props;
  const SafeLinkModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SafeLinkModal', !url);
  return SafeLinkModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SafeLinkModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SafeLinkModalAsync);

/***/ },

/***/ "./src/components/main/WebAppsCloseConfirmationModal.async.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/main/WebAppsCloseConfirmationModal.async.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const WebAppsCloseConfirmationModalAsync = props => {
  const {
    modal
  } = props;
  const WebAppsCloseConfirmationModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'WebAppsCloseConfirmationModal', !modal);
  return WebAppsCloseConfirmationModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(WebAppsCloseConfirmationModal, {
    isOpen: modal
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (WebAppsCloseConfirmationModalAsync);

/***/ },

/***/ "./src/components/main/premium/GiveawayModal.async.tsx"
/*!*************************************************************!*\
  !*** ./src/components/main/premium/GiveawayModal.async.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiveawayModalAsync = props => {
  const {
    isOpen
  } = props;
  const GiveawayModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'GiveawayModal', !isOpen);
  return GiveawayModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiveawayModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiveawayModalAsync);

/***/ },

/***/ "./src/components/main/premium/PremiumMainModal.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/main/premium/PremiumMainModal.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PremiumMainModalAsync = props => {
  const {
    isOpen
  } = props;
  const PremiumMainModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PremiumMainModal', !isOpen);
  return PremiumMainModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PremiumMainModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PremiumMainModalAsync);

/***/ },

/***/ "./src/components/main/premium/StarsGiftingPickerModal.async.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/main/premium/StarsGiftingPickerModal.async.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StarsGiftingPickerModalAsync = props => {
  const {
    isOpen
  } = props;
  const StarsGiftingPickerModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'StarsGiftingPickerModal', !isOpen);
  return StarsGiftingPickerModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StarsGiftingPickerModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsGiftingPickerModalAsync);

/***/ },

/***/ "./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx"
/*!*******************************************************************************!*\
  !*** ./src/components/main/premium/common/PremiumLimitReachedModal.async.tsx ***!
  \*******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PremiumLimitReachedModalAsync = props => {
  const {
    limit
  } = props;
  const PremiumLimitReachedModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PremiumLimitReachedModal', !limit);
  return PremiumLimitReachedModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PremiumLimitReachedModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PremiumLimitReachedModalAsync);

/***/ },

/***/ "./src/components/main/visualEffects/ConfettiContainer.module.scss"
/*!*************************************************************************!*\
  !*** ./src/components/main/visualEffects/ConfettiContainer.module.scss ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"YUAfqWPN"});

/***/ },

/***/ "./src/components/main/visualEffects/ConfettiContainer.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/main/visualEffects/ConfettiContainer.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./ConfettiContainer.module.scss */ "./src/components/main/visualEffects/ConfettiContainer.module.scss");













const CONFETTI_FADEOUT_TIMEOUT = 10000;
const DEFAULT_CONFETTI_SIZE = 10;
const CONFETTI_COLORS = ['#E8BC2C', '#D0049E', '#02CBFE', '#5723FD', '#FE8C27', '#6CB859'];
// eslint-disable-next-line @stylistic/max-len
const STAR_PATH = new Path2D('M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z');
const STAR_SIZE_MULTIPLIER = 1.5;
const ConfettiContainer = ({
  confetti
}) => {
  const canvasRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const confettiRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)([]);
  const isRafStartedRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const windowSize = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const defaultConfettiAmount = isMobile ? 50 : 100;
  const {
    lastConfettiTime,
    top,
    width,
    left,
    height,
    style = 'poppers'
  } = confetti || {};
  const generateConfetti = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])((w, h, amount = defaultConfettiAmount) => {
    for (let i = 0; i < amount; i++) {
      const {
        position,
        velocity
      } = generateRandomPositionData(style, w, h, i);
      const size = DEFAULT_CONFETTI_SIZE + randomNumberAroundZero(DEFAULT_CONFETTI_SIZE / 2);
      const randomColor = CONFETTI_COLORS[Math.floor(Math.random() * CONFETTI_COLORS.length)];
      confettiRef.current.push({
        pos: position,
        size,
        color: randomColor,
        velocity,
        flicker: size,
        flickerFrequency: Math.random() * 0.2,
        rotation: 0,
        lastDrawnAt: Date.now(),
        frameCount: 0,
        isStar: confetti?.withStars && Math.random() > 0.8
      });
    }
  });
  const updateCanvas = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!canvasRef.current || !isRafStartedRef.current) {
      return;
    }
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    if (!ctx) {
      return;
    }
    const {
      width: canvasWidth,
      height: canvasHeight
    } = canvas;
    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
    const confettiToRemove = [];
    confettiRef.current.forEach((c, i) => {
      const {
        pos,
        velocity,
        size,
        color,
        flicker,
        flickerFrequency,
        rotation,
        lastDrawnAt,
        frameCount
      } = c;
      const diff = (Date.now() - lastDrawnAt) / 1000;
      const newPos = {
        x: pos.x + velocity.x * diff,
        y: pos.y + velocity.y * diff
      };
      const newVelocity = {
        x: velocity.x * 0.5 ** (diff / 1),
        // Air Resistance
        y: velocity.y += diff * 1000 // Gravity
      };
      const newFlicker = size * Math.abs(Math.sin(frameCount * flickerFrequency));
      const newRotation = 5 * frameCount * flickerFrequency * (Math.PI / 180);
      const newFrameCount = frameCount + 1;
      const newLastDrawnAt = Date.now();
      const shouldRemove = newPos.y > canvasHeight + c.size;
      if (shouldRemove) {
        confettiToRemove.push(c);
        return;
      }
      const newConfetti = {
        ...c,
        pos: newPos,
        velocity: newVelocity,
        flicker: newFlicker,
        rotation: newRotation,
        lastDrawnAt: newLastDrawnAt,
        frameCount: newFrameCount
      };
      confettiRef.current[i] = newConfetti;
      ctx.fillStyle = color;
      if (c.isStar) {
        ctx.save();
        ctx.translate(pos.x, pos.y);
        ctx.scale(size / DEFAULT_CONFETTI_SIZE * STAR_SIZE_MULTIPLIER, size / DEFAULT_CONFETTI_SIZE * STAR_SIZE_MULTIPLIER);
        ctx.rotate(rotation);
        ctx.fill(STAR_PATH);
        ctx.restore();
      } else {
        ctx.beginPath();
        ctx.ellipse(pos.x, pos.y, size, flicker, rotation, 0, 2 * Math.PI);
        ctx.fill();
      }
    });
    confettiRef.current = confettiRef.current.filter(c => !confettiToRemove.includes(c));
    if (confettiRef.current.length) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(updateCanvas);
    } else {
      isRafStartedRef.current = false;
    }
  });
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_9__["default"])(([prevConfettiTime]) => {
    let hideTimeout;
    if (prevConfettiTime !== lastConfettiTime) {
      generateConfetti(width || windowSize.width, height || windowSize.height);
      hideTimeout = setTimeout(forceUpdate, CONFETTI_FADEOUT_TIMEOUT);
      if (!isRafStartedRef.current) {
        isRafStartedRef.current = true;
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(updateCanvas);
      }
    }
    return () => {
      clearTimeout(hideTimeout);
    };
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps -- Old timeout should be cleared only if new confetti is generated
  }, [lastConfettiTime, forceUpdate, updateCanvas]);
  if (!lastConfettiTime || Date.now() - lastConfettiTime > CONFETTI_FADEOUT_TIMEOUT) {
    return undefined;
  }
  const containerStyle = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(Boolean(top) && `top: ${top}px`, Boolean(left) && `left: ${left}px`, Boolean(width) && `width: ${width}px`, Boolean(height) && `height: ${height}px`);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "Confetti",
    className: _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root,
    style: containerStyle
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: canvasRef,
    className: _ConfettiContainer_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].canvas,
    width: windowSize.width,
    height: windowSize.height
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.pick)((0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global), ['confetti']))(ConfettiContainer)));
function generateRandomPositionData(style, containerWidth, containerHeight, index) {
  if (style === 'poppers') {
    const leftSide = index % 2;
    const position = {
      x: containerWidth * (leftSide ? -0.1 : 1.1),
      y: containerHeight * 0.66
    };
    const randomX = Math.random() * containerWidth;
    const randomY = -containerHeight - randomNumberAroundZero(containerHeight * 0.75);
    const velocity = {
      x: leftSide ? randomX : randomX * -1,
      y: randomY
    };
    return {
      position,
      velocity
    };
  } else {
    const position = {
      x: Math.random() * containerWidth,
      y: -DEFAULT_CONFETTI_SIZE * 2
    };
    const randomX = randomNumberAroundZero(containerWidth);
    const randomY = -containerHeight * Math.random() * 1.25;
    const velocity = {
      x: randomX,
      y: randomY
    };
    return {
      position,
      velocity
    };
  }
}
function randomNumberAroundZero(max = 1) {
  return Math.random() * max - max / 2;
}

/***/ },

/***/ "./src/components/main/visualEffects/WaveContainer.module.scss"
/*!*********************************************************************!*\
  !*** ./src/components/main/visualEffects/WaveContainer.module.scss ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"RMsQzedH","wave":"YLR2Oh2f","waveGrow":"rqfv5Mai"});

/***/ },

/***/ "./src/components/main/visualEffects/WaveContainer.tsx"
/*!*************************************************************!*\
  !*** ./src/components/main/visualEffects/WaveContainer.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_svgController__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/svgController */ "./src/util/svgController.ts");
/* harmony import */ var _util_windowSize__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/windowSize */ "./src/util/windowSize.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _WaveContainer_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./WaveContainer.module.scss */ "./src/components/main/visualEffects/WaveContainer.module.scss");
/* harmony import */ var _assets_wave_ripple_jpg__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../assets/wave_ripple.jpg */ "./src/assets/wave_ripple.jpg");












const BASE_SIZE_MULTIPLIER = 1.73;
const FILTER_ID = 'wave-filter';
const FILTER_SCALE = '20';
const WAVE_COUNT_LIMIT = 7;
const WaveContainer = ({
  waveInfo
}) => {
  const [waves, setWaves] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const addWave = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(newWave => {
    if (waves.length >= WAVE_COUNT_LIMIT) return;
    setWaves(prevWaves => [...prevWaves, newWave]);
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!waveInfo) return;
    const {
      startX,
      startY
    } = waveInfo;
    const {
      width,
      height
    } = _util_windowSize__WEBPACK_IMPORTED_MODULE_7__["default"].get();
    const maxSize = Math.max(width - startX, height - startY, startX, startY);
    const overlaySize = maxSize * BASE_SIZE_MULTIPLIER;
    const top = startY - overlaySize / 2;
    const left = startX - overlaySize / 2;
    addWave({
      startTime: waveInfo.lastWaveTime,
      waveWidth: overlaySize,
      top,
      left
    });
  }, [waveInfo]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    (0,_util_svgController__WEBPACK_IMPORTED_MODULE_6__.addSvgDefinition)(/*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("filter", {
      x: "0",
      y: "0",
      width: "1",
      height: "1",
      "color-interpolation-filters": "sRGB",
      xmlns: _config__WEBPACK_IMPORTED_MODULE_2__.SVG_NAMESPACE
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feImage", {
      href: _assets_wave_ripple_jpg__WEBPACK_IMPORTED_MODULE_10__,
      result: "waveImage"
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feDisplacementMap", {
      in: "SourceGraphic",
      in2: "waveImage",
      scale: FILTER_SCALE,
      xChannelSelector: "R",
      yChannelSelector: "B"
    })), FILTER_ID);
    return () => {
      (0,_util_svgController__WEBPACK_IMPORTED_MODULE_6__.removeSvgDefinition)(FILTER_ID);
    };
  }, []);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_WaveContainer_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root),
    teactFastList: true
  }, waves.map(wave => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _WaveContainer_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].wave,
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_5__["default"])(`--wave-width: ${wave.waveWidth}px`, `--wave-pos-top: ${wave.top}px`, `--wave-pos-left: ${wave.left}px`),
    key: wave.startTime,
    onAnimationEnd: () => setWaves(prevWaves => prevWaves.filter(w => w !== wave))
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  return {
    waveInfo: tabState.wave
  };
})(WaveContainer)));

/***/ },

/***/ "./src/components/mediaViewer/MediaViewer.async.tsx"
/*!**********************************************************!*\
  !*** ./src/components/mediaViewer/MediaViewer.async.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MediaViewerAsync = ({
  isOpen
}) => {
  const MediaViewer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MediaViewer', !isOpen);
  return MediaViewer ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MediaViewer, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MediaViewerAsync);

/***/ },

/***/ "./src/components/middle/ChatLanguageModal.async.tsx"
/*!***********************************************************!*\
  !*** ./src/components/middle/ChatLanguageModal.async.tsx ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ChatLanguageModalAsync = props => {
  const {
    isOpen
  } = props;
  const ChatLanguageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ChatLanguageModal', !isOpen);
  return ChatLanguageModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ChatLanguageModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatLanguageModalAsync);

/***/ },

/***/ "./src/components/middle/ContactGreeting.module.scss"
/*!***********************************************************!*\
  !*** ./src/components/middle/ContactGreeting.module.scss ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"osdROIcA","wrapper":"c3NtU3JZ","explainer":"WIbO6rja","title":"n2KO1cAv","description":"MVSedxKc","sticker":"qsfxNv7L"});

/***/ },

/***/ "./src/components/middle/ContactGreeting.tsx"
/*!***************************************************!*\
  !*** ./src/components/middle/ContactGreeting.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ContactGreeting.module.scss */ "./src/components/middle/ContactGreeting.module.scss");









const ContactGreeting = ({
  defaultStickers,
  connectionState,
  lastUnreadMessageId,
  currentMessageList,
  businessIntro,
  user
}) => {
  const {
    loadGreetingStickers,
    sendMessage,
    markMessageListRead
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const sticker = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (businessIntro?.sticker) return businessIntro.sticker;
    if (!defaultStickers?.length) return undefined;
    const randomIndex = Math.floor(Math.random() * defaultStickers.length);
    return defaultStickers[randomIndex];
  }, [businessIntro?.sticker, defaultStickers]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (defaultStickers?.length || connectionState !== 'connectionStateReady') {
      return;
    }
    loadGreetingStickers();
  }, [connectionState, loadGreetingStickers, defaultStickers]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (connectionState === 'connectionStateReady' && lastUnreadMessageId) {
      markMessageListRead({
        maxId: lastUnreadMessageId
      });
    }
  }, [connectionState, markMessageListRead, lastUnreadMessageId]);
  const handleStickerSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!currentMessageList) {
      return;
    }
    sendMessage({
      sticker: {
        ...sticker,
        isPreloadedGlobally: true
      },
      messageList: currentMessageList
    });
  });
  const title = businessIntro?.title || lang('Conversation.EmptyPlaceholder');
  const description = businessIntro?.description || lang('Conversation.GreetingText');
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].wrapper
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].title,
    dir: "auto"
  }, title), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].description,
    dir: "auto"
  }, description), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: containerRef,
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].sticker,
    onClick: handleStickerSelect
  }, sticker && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_StickerView__WEBPACK_IMPORTED_MODULE_6__["default"], {
    containerRef: containerRef,
    sticker: sticker,
    size: 160,
    shouldLoop: true
  }))), businessIntro && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ContactGreeting_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].explainer
  }, lang('Chat.EmptyStateIntroFooter', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(user))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  userId
}) => {
  const {
    stickers
  } = global.stickers.greeting;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, userId);
  if (!chat) {
    return {};
  }
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, userId);
  const fullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, userId);
  const lastMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatLastMessage)(global, chat.id);
  return {
    defaultStickers: stickers,
    lastUnreadMessageId: lastMessage && lastMessage.id !== chat.lastReadInboxMessageId ? lastMessage.id : undefined,
    connectionState: global.connectionState,
    currentMessageList: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMessageList)(global),
    businessIntro: fullInfo?.businessIntro,
    user
  };
})(ContactGreeting)));

/***/ },

/***/ "./src/components/middle/EmojiInteractionAnimation.async.tsx"
/*!*******************************************************************!*\
  !*** ./src/components/middle/EmojiInteractionAnimation.async.tsx ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const EmojiInteractionAnimationAsync = props => {
  const {
    activeEmojiInteraction
  } = props;
  const EmojiInteractionAnimation = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'EmojiInteractionAnimation', !activeEmojiInteraction);
  return EmojiInteractionAnimation ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(EmojiInteractionAnimation, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmojiInteractionAnimationAsync);

/***/ },

/***/ "./src/components/middle/FloatingActionButtons.module.scss"
/*!*****************************************************************!*\
  !*** ./src/components/middle/FloatingActionButtons.module.scss ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"VWoOZCD5","hidden":"UMXbiYB3","reactions":"eO_Fz8SD","transform-down":"gn3iLVq1","transformDown":"gn3iLVq1","unread":"u62x81QI","revealed":"iozW83la","no-composer":"yzzjqibi","noComposer":"yzzjqibi","no-extra-shift":"wDwOdyQH","noExtraShift":"wDwOdyQH","hide-scroll-down":"UBa5kAK5","hideScrollDown":"UBa5kAK5","is-symbol-menu-open":"qoyRzwL6","isSymbolMenuOpen":"qoyRzwL6"});

/***/ },

/***/ "./src/components/middle/FloatingActionButtons.tsx"
/*!*********************************************************!*\
  !*** ./src/components/middle/FloatingActionButtons.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ScrollDownButton__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ScrollDownButton */ "./src/components/middle/ScrollDownButton.tsx");
/* harmony import */ var _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./FloatingActionButtons.module.scss */ "./src/components/middle/FloatingActionButtons.module.scss");










const FOCUS_MARGIN = 20;
const FloatingActionButtons = ({
  withScrollDown,
  canPost,
  messageListType,
  chatId,
  threadId,
  unreadCount,
  unreadReactions,
  unreadMentions,
  reactionsCount,
  mentionsCount,
  withExtraShift
}) => {
  const {
    focusNextReply,
    focusNextReaction,
    focusNextMention,
    fetchUnreadReactions,
    readAllMentions,
    readAllReactions,
    fetchUnreadMentions
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const elementRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const hasUnreadReactions = Boolean(reactionsCount);
  const hasUnreadMentions = Boolean(mentionsCount);
  const handleReadAllReactions = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!chatId) return;
    readAllReactions({
      chatId,
      threadId
    });
  });
  const handleReadAllMentions = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!chatId) return;
    readAllMentions({
      chatId,
      threadId
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadReactions && chatId && !unreadReactions?.length) {
      fetchUnreadReactions({
        chatId
      });
    }
  }, [chatId, fetchUnreadReactions, hasUnreadReactions, unreadReactions?.length]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadReactions && chatId) {
      fetchUnreadReactions({
        chatId
      });
    }
  }, [chatId, fetchUnreadReactions, hasUnreadReactions]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadMentions && chatId && !unreadMentions?.length) {
      fetchUnreadMentions({
        chatId
      });
    }
  }, [chatId, fetchUnreadMentions, hasUnreadMentions, unreadMentions?.length]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasUnreadMentions && chatId) {
      fetchUnreadMentions({
        chatId
      });
    }
  }, [chatId, fetchUnreadMentions, hasUnreadMentions]);
  const handleScrollDownClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!withScrollDown) {
      return;
    }
    if (messageListType === 'thread') {
      focusNextReply();
    } else {
      const messagesContainer = elementRef.current.parentElement.querySelector('.Transition_slide-active > .MessageList');
      const messageElements = messagesContainer.querySelectorAll('.message-list-item');
      const lastMessageElement = messageElements[messageElements.length - 1];
      if (!lastMessageElement) {
        return;
      }
      (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_4__["default"])({
        container: messagesContainer,
        element: lastMessageElement,
        position: 'end',
        margin: FOCUS_MARGIN
      });
    }
  });
  const fabClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].root, (withScrollDown || Boolean(reactionsCount) || Boolean(mentionsCount)) && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].revealed, (Boolean(reactionsCount) || Boolean(mentionsCount)) && !withScrollDown && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].hideScrollDown, !canPost && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].noComposer, !withExtraShift && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].noExtraShift);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: elementRef,
    className: fabClassName
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "heart-outline",
    ariaLabelLang: "AccDescrReactionMentionDown",
    onClick: focusNextReaction,
    onReadAll: handleReadAllReactions,
    unreadCount: reactionsCount,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].reactions, !hasUnreadReactions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].hidden, !hasUnreadMentions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].transformDown)
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "mention",
    ariaLabelLang: "AccDescrMentionDown",
    onClick: focusNextMention,
    onReadAll: handleReadAllMentions,
    unreadCount: mentionsCount,
    className: !hasUnreadMentions && _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].hidden
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ScrollDownButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
    icon: "arrow-down",
    ariaLabelLang: "AccDescrPageDown",
    onClick: handleScrollDownClick,
    unreadCount: unreadCount,
    className: _FloatingActionButtons_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].unread
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const currentMessageList = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMessageList)(global);
  if (!currentMessageList) {
    return {};
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  const hasActiveMiddleSearch = Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMiddleSearch)(global));
  const shouldShowCount = chat && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && messageListType === 'thread' && !hasActiveMiddleSearch;
  return {
    messageListType,
    chatId,
    threadId,
    reactionsCount: shouldShowCount ? chat.unreadReactionsCount : undefined,
    unreadReactions: shouldShowCount ? chat.unreadReactions : undefined,
    unreadMentions: shouldShowCount ? chat.unreadMentions : undefined,
    mentionsCount: shouldShowCount ? chat.unreadMentionsCount : undefined,
    unreadCount: shouldShowCount ? chat.unreadCount : undefined
  };
})(FloatingActionButtons)));

/***/ },

/***/ "./src/components/middle/FrozenAccountPlaceholder.module.scss"
/*!********************************************************************!*\
  !*** ./src/components/middle/FrozenAccountPlaceholder.module.scss ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"GuZke_HG","title":"oLWeN4mA","subtitle":"ZxTe54MY"});

/***/ },

/***/ "./src/components/middle/FrozenAccountPlaceholder.tsx"
/*!************************************************************!*\
  !*** ./src/components/middle/FrozenAccountPlaceholder.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _FrozenAccountPlaceholder_module_scss__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./FrozenAccountPlaceholder.module.scss */ "./src/components/middle/FrozenAccountPlaceholder.module.scss");






function FrozenAccountPlaceholder() {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const {
    openFrozenAccountModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    openFrozenAccountModal();
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FrozenAccountPlaceholder_module_scss__WEBPACK_IMPORTED_MODULE_4__["default"].root,
    onClick: handleClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FrozenAccountPlaceholder_module_scss__WEBPACK_IMPORTED_MODULE_4__["default"].title
  }, lang('ComposerTitleFrozenAccount')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FrozenAccountPlaceholder_module_scss__WEBPACK_IMPORTED_MODULE_4__["default"].subtitle
  }, lang('ComposerSubtitleFrozenAccount')));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(FrozenAccountPlaceholder));

/***/ },

/***/ "./src/components/middle/MessageList.scss"
/*!************************************************!*\
  !*** ./src/components/middle/MessageList.scss ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/MessageList.tsx"
/*!***********************************************!*\
  !*** ./src/components/middle/MessageList.tsx ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _teact_teact_dom_ts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @teact/teact-dom.ts */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_chats__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../global/selectors/chats */ "./src/global/selectors/chats.ts");
/* harmony import */ var _global_selectors_messages__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../global/selectors/messages */ "./src/global/selectors/messages.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_resetScroll__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../util/resetScroll */ "./src/util/resetScroll.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_visibility_getOffsetToContainer__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../util/visibility/getOffsetToContainer */ "./src/util/visibility/getOffsetToContainer.ts");
/* harmony import */ var _helpers_groupMessages__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./helpers/groupMessages */ "./src/components/middle/helpers/groupMessages.ts");
/* harmony import */ var _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useNativeCopySelectedMessages__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/useNativeCopySelectedMessages */ "./src/hooks/useNativeCopySelectedMessages.ts");
/* harmony import */ var _hooks_useStateRef__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../hooks/useStateRef */ "./src/hooks/useStateRef.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");
/* harmony import */ var _hooks_useContainerHeight__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./hooks/useContainerHeight */ "./src/components/middle/hooks/useContainerHeight.ts");
/* harmony import */ var _hooks_useStickyDates__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./hooks/useStickyDates */ "./src/components/middle/hooks/useStickyDates.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _ui_Transition_tsx__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../ui/Transition.tsx */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ContactGreeting__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./ContactGreeting */ "./src/components/middle/ContactGreeting.tsx");
/* harmony import */ var _MessageListAccountInfo__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./MessageListAccountInfo */ "./src/components/middle/MessageListAccountInfo.tsx");
/* harmony import */ var _MessageListContent__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./MessageListContent */ "./src/components/middle/MessageListContent.tsx");
/* harmony import */ var _NoMessages__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./NoMessages */ "./src/components/middle/NoMessages.tsx");
/* harmony import */ var _RequirementToContactMessage__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./RequirementToContactMessage */ "./src/components/middle/RequirementToContactMessage.tsx");
/* harmony import */ var _MessageList_scss__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./MessageList.scss */ "./src/components/middle/MessageList.scss");








































var Content = /*#__PURE__*/function (Content) {
  Content[Content["Loading"] = 0] = "Loading";
  Content[Content["Restricted"] = 1] = "Restricted";
  Content[Content["StarsRequired"] = 2] = "StarsRequired";
  Content[Content["PremiumRequired"] = 3] = "PremiumRequired";
  Content[Content["AccountInfo"] = 4] = "AccountInfo";
  Content[Content["ContactGreeting"] = 5] = "ContactGreeting";
  Content[Content["NoMessages"] = 6] = "NoMessages";
  Content[Content["MessageList"] = 7] = "MessageList";
  return Content;
}(Content || {});
const MESSAGE_REACTIONS_POLLING_INTERVAL = 20 * 1000;
const MESSAGE_COMMENTS_POLLING_INTERVAL = 20 * 1000;
const MESSAGE_FACT_CHECK_UPDATE_INTERVAL = 5 * 1000;
const MESSAGE_STORY_POLLING_INTERVAL = 5 * 60 * 1000;
const BOTTOM_THRESHOLD = 50;
const UNREAD_DIVIDER_TOP = 10;
const SCROLL_DEBOUNCE = 200;
const MESSAGE_ANIMATION_DURATION = 500;
const BOTTOM_FOCUS_MARGIN = 20;
const SELECT_MODE_ANIMATION_DURATION = 200;
const UNREAD_DIVIDER_CLASS = 'unread-divider';
const runDebouncedForScroll = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_17__.debounce)(cb => cb(), SCROLL_DEBOUNCE, false);
const MessageList = ({
  chatId,
  threadId,
  type,
  isChatLoaded,
  isForum,
  isChannelChat,
  isGroupChat,
  isChannelWithAvatars,
  canPost,
  isSynced,
  isChatMonoforum,
  isReady,
  isChatWithSelf,
  isSystemBotChat,
  isAnonymousForwards,
  isCreator,
  isBot,
  isNonContact,
  nameChangeDate,
  photoChangeDate,
  messageIds,
  messagesById,
  firstUnreadId,
  isComments,
  isViewportNewest,
  isRestricted,
  restrictionReasons,
  isEmptyThread,
  focusingId,
  isSelectModeActive,
  lastMessage,
  hasLinkedChat,
  withBottomShift,
  withDefaultBg,
  topic,
  noMessageSendingAnimation,
  isServiceNotificationsChat,
  currentUserId,
  isContactRequirePremium,
  paidMessagesStars,
  areAdsEnabled,
  channelJoinInfo,
  isChatProtected,
  isAccountFrozen,
  hasCustomGreeting,
  monoforumChannelId,
  isAppConfigLoaded,
  canTranslate,
  translationLanguage,
  detectedLanguage,
  shouldAutoTranslate,
  chatAutoTranslate,
  onIntersectPinnedMessage,
  onScrollDownToggle,
  onNotchToggle
}) => {
  const {
    loadViewportMessages,
    setScrollOffset,
    loadSponsoredMessages,
    loadMessageReactions,
    copyMessagesByIds,
    loadMessageViews,
    loadPeerStoriesByIds,
    loadFactChecks,
    requestChatTranslation
  } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();

  // We update local cached `scrollOffsetRef` when opening chat.
  // Then we update global version every second on scrolling.
  const scrollOffsetRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(type === 'thread' && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectScrollOffset)((0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)(), chatId, threadId) || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectLastScrollOffset)((0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)(), chatId, threadId) || 0);
  const anchorIdRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const anchorTopRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const listItemElementsRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const memoFirstUnreadIdRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const memoUnreadDividerBeforeIdRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const memoFocusingIdRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isScrollTopJustUpdatedRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const shouldAnimateAppearanceRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(Boolean(lastMessage));
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const hasOpenChatButton = isSavedDialog && threadId !== _config__WEBPACK_IMPORTED_MODULE_5__.ANONYMOUS_USER_ID;
  const areMessagesLoaded = Boolean(messageIds);
  const isPrivate = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_13__.isUserId)(chatId);
  const withUsers = Boolean(!isPrivate && !isChannelChat || isChatWithSelf || isSystemBotChat || isAnonymousForwards || isChannelWithAvatars);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__["default"])(() => {
    // We only need it first time when message list appears
    if (areMessagesLoaded) {
      (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_17__.onTickEnd)(() => {
        shouldAnimateAppearanceRef.current = false;
      });
    }
  }, [areMessagesLoaded]);

  // Updated every time (to be used from intersection callback closure)
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__["default"])(() => {
    memoFirstUnreadIdRef.current = firstUnreadId;
  }, [firstUnreadId]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const canHaveAds = isChannelChat || isBot;
    if (areAdsEnabled && canHaveAds && isSynced && isReady && isAppConfigLoaded) {
      loadSponsoredMessages({
        peerId: chatId
      });
    }
  }, [chatId, isSynced, isReady, isChannelChat, isBot, areAdsEnabled, isAppConfigLoaded]);

  // Updated only once when messages are loaded (as we want the unread divider to keep its position)
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__["default"])(() => {
    if (areMessagesLoaded) {
      memoUnreadDividerBeforeIdRef.current = memoFirstUnreadIdRef.current;
    }
  }, [areMessagesLoaded]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__["default"])(() => {
    memoFocusingIdRef.current = focusingId;
  }, [focusingId]);

  // Enable auto translation for the chat if it's available
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!chatAutoTranslate || !canTranslate || !detectedLanguage) return;
    if (detectedLanguage === translationLanguage) return;
    requestChatTranslation({
      chatId,
      toLanguageCode: translationLanguage
    });
  }, [chatAutoTranslate, canTranslate, translationLanguage, chatId, detectedLanguage]);
  (0,_hooks_useNativeCopySelectedMessages__WEBPACK_IMPORTED_MODULE_25__["default"])(copyMessagesByIds);
  const messageGroups = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!messageIds?.length || !messagesById) {
      return undefined;
    }
    const listedMessages = [];
    messageIds.forEach((id, index, arr) => {
      const prevMessage = listedMessages[listedMessages.length - 1];
      const message = messagesById[id];
      if (!message) {
        return;
      }
      const {
        shouldAppendJoinMessage,
        shouldAppendJoinMessageAfterCurrent
      } = (() => {
        if (!channelJoinInfo || type !== 'thread') return undefined;
        if (prevMessage && prevMessage.date < channelJoinInfo.joinedDate && channelJoinInfo.joinedDate <= message.date) {
          return {
            shouldAppendJoinMessage: true,
            shouldAppendJoinMessageAfterCurrent: false
          };
        }
        if (index === arr.length - 1 && message.date < channelJoinInfo.joinedDate) {
          return {
            shouldAppendJoinMessage: true,
            shouldAppendJoinMessageAfterCurrent: true
          };
        }
        return undefined;
      })() || {};
      if (shouldAppendJoinMessageAfterCurrent) {
        listedMessages.push(message);
      }
      if (shouldAppendJoinMessage) {
        const lastMessageId = shouldAppendJoinMessageAfterCurrent ? message.id : prevMessage?.id || message.id - 1;
        listedMessages.push({
          id: generateChannelJoinMessageId(lastMessageId),
          chatId: message.chatId,
          date: channelJoinInfo.joinedDate,
          isOutgoing: false,
          content: {
            action: {
              mediaType: 'action',
              type: 'channelJoined',
              inviterId: channelJoinInfo?.inviterId,
              isViaRequest: channelJoinInfo?.isViaRequest || undefined
            }
          }
        });
      }
      if (!shouldAppendJoinMessageAfterCurrent) {
        listedMessages.push(message);
      }
    });

    // Service notifications have local IDs which may be not in sync with real message history
    const orderRule = type === 'scheduled' || isServiceNotificationsChat ? ['date', 'id'] : ['id'];
    return listedMessages.length ? (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_19__.groupMessages)((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_14__.orderBy)(listedMessages, orderRule), memoUnreadDividerBeforeIdRef.current, !isForum ? Number(threadId) : undefined, isChatWithSelf, withUsers) : undefined;
  }, [withUsers, messageIds, messagesById, type, isServiceNotificationsChat, isForum, threadId, isChatWithSelf, channelJoinInfo]);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!messageIds || !messagesById || type === 'scheduled' || isAccountFrozen) return;
    if (!isChannelChat && !isGroupChat) return;
    const ids = messageIds.filter(id => {
      const message = messagesById[id];
      return message && message.reactions?.results.length && !message.content.action;
    });
    if (!ids.length) return;
    loadMessageReactions({
      chatId,
      ids
    });
  }, MESSAGE_REACTIONS_POLLING_INTERVAL);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!messageIds || !messagesById || type === 'scheduled') {
      return;
    }
    const storyDataList = messageIds.map(id => messagesById[id]?.content.storyData).filter(Boolean);
    if (!storyDataList.length) return;
    const storiesByPeerIds = storyDataList.reduce((acc, storyData) => {
      const {
        peerId,
        id
      } = storyData;
      if (!acc[peerId]) {
        acc[peerId] = [];
      }
      acc[peerId].push(id);
      return acc;
    }, {});
    Object.entries(storiesByPeerIds).forEach(([peerId, storyIds]) => {
      loadPeerStoriesByIds({
        peerId,
        storyIds
      });
    });
  }, MESSAGE_STORY_POLLING_INTERVAL);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!messageIds || !messagesById || threadId !== _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID || type === 'scheduled') {
      return;
    }
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
    const ids = messageIds.filter(id => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectThreadInfo)(global, chatId, id)?.isCommentsInfo || messagesById[id]?.viewsCount !== undefined);
    if (!ids.length) return;
    loadMessageViews({
      chatId,
      ids
    });
  }, MESSAGE_COMMENTS_POLLING_INTERVAL, true);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_21__["default"])(() => {
    if (!messageIds || !messagesById || threadId !== _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID || type === 'scheduled') {
      return;
    }
    const ids = messageIds.filter(id => messagesById[id]?.factCheck?.shouldFetch);
    if (!ids.length) return;
    loadFactChecks({
      chatId,
      ids
    });
  }, MESSAGE_FACT_CHECK_UPDATE_INTERVAL);
  const loadMoreAround = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (type !== 'thread') {
      return undefined;
    }
    return (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_17__.debounce)(() => loadViewportMessages({
      direction: _types__WEBPACK_IMPORTED_MODULE_4__.LoadMoreDirection.Around
    }), 1000, true, false);
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [loadViewportMessages, messageIds]);
  const {
    isScrolled,
    updateStickyDates
  } = (0,_hooks_useStickyDates__WEBPACK_IMPORTED_MODULE_30__["default"])();
  const handleScroll = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_23__["default"])(() => {
    if (isScrollTopJustUpdatedRef.current) {
      isScrollTopJustUpdatedRef.current = false;
      return;
    }
    const container = containerRef.current;
    if (!container) {
      return;
    }
    if (!memoFocusingIdRef.current) {
      updateStickyDates(container);
    }
    runDebouncedForScroll(() => {
      const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
      const isFocusing = Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global).focusedMessage?.chatId);
      if (!isFocusing) {
        onIntersectPinnedMessage({
          shouldCancelWaiting: true
        });
      }
      if (!container.parentElement) {
        return;
      }
      scrollOffsetRef.current = container.scrollHeight - container.scrollTop;
      if (type === 'thread') {
        setScrollOffset({
          chatId,
          threadId,
          scrollOffset: scrollOffsetRef.current
        });
      }
    });
  });
  const [getContainerHeight, prevContainerHeightRef] = (0,_hooks_useContainerHeight__WEBPACK_IMPORTED_MODULE_29__["default"])(containerRef, canPost && !isSelectModeActive);

  // Initial message loading
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!loadMoreAround || !isChatLoaded || isRestricted || focusingId) {
      return;
    }

    // Loading history while sending a message can return the same message and cause ambiguity
    const isLastMessageLocal = messageIds && (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_15__.isLocalMessageId)(messageIds[messageIds.length - 1]);
    if (isLastMessageLocal) {
      return;
    }
    const container = containerRef.current;
    if (!messageIds || messageIds.length === 1 || messageIds.length < _config__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_LIST_SLICE / 2 && container.firstElementChild.clientHeight <= container.offsetHeight) {
      loadMoreAround();
    }
  }, [isChatLoaded, messageIds, loadMoreAround, focusingId, isRestricted]);
  const rememberScrollPositionRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_26__.useStateRef)(() => {
    if (!messageIds || !listItemElementsRef.current) {
      return;
    }
    const preservedItemElements = listItemElementsRef.current.filter(element => messageIds.includes(Number(element.dataset.messageId)));

    // We avoid the very first item as it may be a partly-loaded album
    // and also because it may be removed when messages limit is reached
    const anchor = preservedItemElements[1] || preservedItemElements[0];
    if (!anchor) {
      return;
    }
    anchorIdRef.current = anchor.id;
    anchorTopRef.current = anchor.getBoundingClientRect().top;
  });
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_27__["default"])(() => (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.forceMeasure)(() => rememberScrollPositionRef.current()),
  // This will run before modifying content and should match deps for `useLayoutEffectWithPrevDeps` below
  [messageIds, isViewportNewest, rememberScrollPositionRef]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => rememberScrollPositionRef.current(),
  // This is only needed to react on signal updates
  [getContainerHeight, rememberScrollPositionRef]);

  // Handles updated message list, takes care of scroll repositioning
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_24__["default"])(([prevMessageIds, prevIsViewportNewest]) => {
    if (false) // removed by dead control flow
{}
    const containerHeight = getContainerHeight();
    const prevContainerHeight = prevContainerHeightRef.current;
    prevContainerHeightRef.current = containerHeight;

    // Skip initial resize observer callback
    if (messageIds === prevMessageIds && isViewportNewest === prevIsViewportNewest && containerHeight !== prevContainerHeight && prevContainerHeight === undefined) {
      return;
    }
    const container = containerRef.current;
    listItemElementsRef.current = Array.from(container.querySelectorAll('.message-list-item'));
    const lastItemElement = listItemElementsRef.current[listItemElementsRef.current.length - 1];
    const firstUnreadElement = memoFirstUnreadIdRef.current ? container.querySelector(`#${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.getMessageHtmlId)(memoFirstUnreadIdRef.current)}`) : undefined;
    const hasLastMessageChanged = messageIds && prevMessageIds && messageIds[messageIds.length - 1] !== prevMessageIds[prevMessageIds.length - 1];
    const hasViewportShifted = messageIds?.[0] !== prevMessageIds?.[0] && messageIds?.length === _config__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_LIST_SLICE / 2 + 1;
    const wasMessageAdded = hasLastMessageChanged && !hasViewportShifted;

    // Add extra height when few messages to allow scroll animation
    if (isViewportNewest && wasMessageAdded && messageIds && messageIds.length < _config__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_LIST_SLICE / 2 && !container.parentElement.classList.contains('force-messages-scroll') && (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.forceMeasure)(() => container.firstElementChild.clientHeight <= container.offsetHeight * 2)) {
      (0,_teact_teact_dom_ts__WEBPACK_IMPORTED_MODULE_1__.addExtraClass)(container.parentElement, 'force-messages-scroll');
      container.parentElement.classList.add('force-messages-scroll');
      setTimeout(() => {
        if (container.parentElement) {
          (0,_teact_teact_dom_ts__WEBPACK_IMPORTED_MODULE_1__.removeExtraClass)(container.parentElement, 'force-messages-scroll');
        }
      }, MESSAGE_ANIMATION_DURATION);
    }
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.requestForcedReflow)(() => {
      const {
        scrollTop,
        scrollHeight,
        offsetHeight
      } = container;
      const scrollOffset = scrollOffsetRef.current;
      let bottomOffset = scrollOffset - (prevContainerHeight || offsetHeight);
      if (wasMessageAdded) {
        // If two new messages come at once (e.g. when bot responds) then the first message will update `scrollOffset`
        // right away (before animation) which creates inconsistency until the animation completes. To work around that,
        // we calculate `isAtBottom` with a "buffer" of the latest message height (this is approximate).
        const lastItemHeight = lastItemElement ? lastItemElement.offsetHeight : 0;
        bottomOffset -= lastItemHeight;
      }
      const isAtBottom = isViewportNewest && prevIsViewportNewest && bottomOffset <= BOTTOM_THRESHOLD;
      const isAlreadyFocusing = messageIds && memoFocusingIdRef.current === messageIds[messageIds.length - 1];

      // Animate incoming message, but if app is in background mode, scroll to the first unread
      if (wasMessageAdded && isAtBottom && !isAlreadyFocusing) {
        // Break out of `forceLayout`
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.requestMeasure)(() => {
          const shouldScrollToBottom = !(0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_28__.isBackgroundModeActive)() || !firstUnreadElement;
          (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_11__["default"])({
            container,
            element: shouldScrollToBottom ? lastItemElement : firstUnreadElement,
            position: shouldScrollToBottom ? 'end' : 'start',
            margin: BOTTOM_FOCUS_MARGIN,
            forceDuration: noMessageSendingAnimation ? 0 : undefined
          });
        });
      }
      const isResized = prevContainerHeight !== undefined && prevContainerHeight !== containerHeight;
      if (isResized && (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_11__.isAnimatingScroll)()) {
        return undefined;
      }
      const anchor = anchorIdRef.current && container.querySelector(`#${anchorIdRef.current}`);
      const unreadDivider = !anchor && memoUnreadDividerBeforeIdRef.current && container.querySelector(`.${UNREAD_DIVIDER_CLASS}`);
      let newScrollTop;
      if (isAtBottom && isResized) {
        newScrollTop = scrollHeight - offsetHeight;
      } else if (anchor) {
        const newAnchorTop = anchor.getBoundingClientRect().top;
        newScrollTop = scrollTop + (newAnchorTop - (anchorTopRef.current || 0));
      } else if (unreadDivider) {
        newScrollTop = Math.min((0,_util_visibility_getOffsetToContainer__WEBPACK_IMPORTED_MODULE_18__["default"])(unreadDivider, container).top - UNREAD_DIVIDER_TOP, scrollHeight - scrollOffset);
      } else {
        newScrollTop = scrollHeight - scrollOffset;
      }
      return () => {
        (0,_util_resetScroll__WEBPACK_IMPORTED_MODULE_16__["default"])(container, Math.ceil(newScrollTop));
        (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_11__.restartCurrentScrollAnimation)();
        scrollOffsetRef.current = Math.max(Math.ceil(scrollHeight - newScrollTop), offsetHeight);
        if (!memoFocusingIdRef.current) {
          isScrollTopJustUpdatedRef.current = true;
          (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_6__.requestMeasure)(() => {
            isScrollTopJustUpdatedRef.current = false;
          });
        }
        if (false) // removed by dead control flow
{}
      };
    });
    // This should match deps for `useSyncEffect` above
  }, [messageIds, isViewportNewest, getContainerHeight, prevContainerHeightRef, noMessageSendingAnimation]);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_22__["default"])(([prevIsSelectModeActive]) => {
    if (prevIsSelectModeActive !== undefined) {
      (0,_teact__WEBPACK_IMPORTED_MODULE_0__.beginHeavyAnimation)(SELECT_MODE_ANIMATION_DURATION + _config__WEBPACK_IMPORTED_MODULE_5__.ANIMATION_END_DELAY);
    }
  }, [isSelectModeActive]);
  const noAvatars = Boolean(!withUsers || isChannelChat && !isChannelWithAvatars);
  const shouldRenderGreeting = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_13__.isUserId)(chatId) && !isChatWithSelf && !isBot && !isAnonymousForwards && type === 'thread' && (!messageGroups && !lastMessage && messageIds
  // Used to avoid flickering when deleting a greeting that has just been sent
  && (!listItemElementsRef.current || listItemElementsRef.current.length === 0) || messageIds?.length === 1 && messagesById?.[messageIds[0]]?.content.action?.type === 'contactSignUp' || lastMessage?.content?.action?.type === 'contactSignUp');
  const isGroupChatJustCreated = isGroupChat && isCreator && messageIds?.length === 1 && messagesById?.[messageIds[0]]?.content.action?.type === 'chatCreate';
  const isEmptyTopic = messageIds?.length === 1 && messagesById?.[messageIds[0]]?.content.action?.type === 'topicCreate';
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('MessageList custom-scroll', noAvatars && 'no-avatars', !canPost && 'no-composer', type === 'pinned' && 'type-pinned', withBottomShift && 'with-bottom-shift', withDefaultBg && 'with-default-bg', isSelectModeActive && 'select-mode-active', isScrolled && 'scrolled', !isReady && 'is-animating', hasOpenChatButton && 'saved-dialog', isChatProtected && 'hide-on-print');
  const hasMessages = Boolean(messageIds && messageGroups || lastMessage);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasMessages) return;
    onScrollDownToggle(false);
  }, [hasMessages, onScrollDownToggle]);
  const activeKey = isRestricted ? Content.Restricted : paidMessagesStars && !hasMessages && !hasCustomGreeting ? Content.StarsRequired : isContactRequirePremium && !hasMessages ? Content.PremiumRequired : (isBot || isNonContact) && !hasMessages ? Content.AccountInfo : shouldRenderGreeting ? Content.ContactGreeting : messageIds && (!messageGroups || isGroupChatJustCreated || isEmptyTopic) ? Content.NoMessages : hasMessages ? Content.MessageList : Content.Loading;
  function renderContent() {
    return activeKey === Content.Restricted ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "empty"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, restrictionReasons?.[0]?.text || `This is a private ${isChannelChat ? 'channel' : 'chat'}`)) : activeKey === Content.StarsRequired ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_RequirementToContactMessage__WEBPACK_IMPORTED_MODULE_37__["default"], {
      paidMessagesStars: paidMessagesStars,
      peerId: monoforumChannelId || chatId
    }) : activeKey === Content.PremiumRequired ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_RequirementToContactMessage__WEBPACK_IMPORTED_MODULE_37__["default"], {
      peerId: chatId
    }) : activeKey === Content.AccountInfo ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageListAccountInfo__WEBPACK_IMPORTED_MODULE_34__["default"], {
      chatId: chatId,
      hasMessages: hasMessages
    }) : activeKey === Content.ContactGreeting ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ContactGreeting__WEBPACK_IMPORTED_MODULE_33__["default"], {
      key: chatId,
      userId: chatId
    }) : activeKey === Content.NoMessages ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_NoMessages__WEBPACK_IMPORTED_MODULE_36__["default"], {
      chatId: chatId,
      topic: topic,
      type: type,
      isChatWithSelf: isChatWithSelf,
      isGroupChatJustCreated: isGroupChatJustCreated
    }) : activeKey === Content.MessageList ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageListContent__WEBPACK_IMPORTED_MODULE_35__["default"], {
      canShowAds: areAdsEnabled && isChannelChat,
      chatId: chatId,
      isComments: isComments,
      isChannelChat: isChannelChat,
      isChatMonoforum: isChatMonoforum,
      isSavedDialog: isSavedDialog,
      messageIds: messageIds || [lastMessage.id],
      messageGroups: messageGroups || (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_19__.groupMessages)([lastMessage]),
      getContainerHeight: getContainerHeight,
      isViewportNewest: Boolean(isViewportNewest),
      isUnread: Boolean(firstUnreadId),
      isEmptyThread: isEmptyThread,
      withUsers: withUsers,
      noAvatars: noAvatars,
      containerRef: containerRef,
      anchorIdRef: anchorIdRef,
      memoUnreadDividerBeforeIdRef: memoUnreadDividerBeforeIdRef,
      memoFirstUnreadIdRef: memoFirstUnreadIdRef,
      threadId: threadId,
      type: type,
      isReady: isReady,
      hasLinkedChat: hasLinkedChat,
      isSchedule: messageGroups ? type === 'scheduled' : false,
      shouldRenderAccountInfo: isBot || isNonContact,
      nameChangeDate: nameChangeDate,
      photoChangeDate: photoChangeDate,
      noAppearanceAnimation: !messageGroups || !shouldAnimateAppearanceRef.current,
      onScrollDownToggle: onScrollDownToggle,
      onNotchToggle: onNotchToggle,
      onIntersectPinnedMessage: onIntersectPinnedMessage,
      canPost: canPost
    }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_31__["default"], {
      color: "white",
      backgroundColor: "dark"
    });
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition_tsx__WEBPACK_IMPORTED_MODULE_32__["default"], {
    ref: containerRef,
    className: className,
    name: "fade",
    activeKey: activeKey,
    shouldCleanup: true,
    onScroll: handleScroll,
    onMouseDown: _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_20__.preventMessageInputBlur
  }, renderContent());
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_2__.withGlobal)((global, {
  chatId,
  threadId,
  type
}) => {
  const currentUserId = global.currentUserId;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const userFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUserFullInfo)(global, chatId);
  if (!chat) {
    return {
      currentUserId
    };
  }
  const detectedLanguage = chat.detectedLanguage;
  const messageIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageIds)(global, chatId, threadId, type);
  const messagesById = type === 'scheduled' ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatScheduledMessages)(global, chatId) : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessages)(global, chatId);
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, currentUserId);
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID && !isSavedDialog && !chat?.isForum && !(messagesById && threadId && messagesById[Number(threadId)])) {
    return {
      currentUserId
    };
  }
  const isRestricted = (0,_global_selectors_chats__WEBPACK_IMPORTED_MODULE_9__.selectIsChatRestricted)(global, chatId);
  const restrictionReasons = (0,_global_selectors_messages__WEBPACK_IMPORTED_MODULE_10__.selectActiveRestrictionReasons)(global, chat?.restrictionReasons);
  const lastMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatLastMessage)(global, chatId, isSavedDialog ? 'saved' : 'all');
  const focusingId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectFocusedMessageId)(global, chatId);
  const withLastMessageWhenPreloading = threadId === _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID && !messageIds && !chat.unreadCount && !focusingId && lastMessage && !lastMessage.groupedId;
  const chatBot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectBot)(global, chatId);
  const isNonContact = Boolean(userFullInfo?.settings?.canAddContact);
  const nameChangeDate = userFullInfo?.settings?.nameChangeDate;
  const photoChangeDate = userFullInfo?.settings?.photoChangeDate;
  const topic = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTopic)(global, chatId, threadId);
  const chatFullInfo = !(0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_13__.isUserId)(chatId) ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatFullInfo)(global, chatId) : undefined;
  const isEmptyThread = !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectThreadInfo)(global, chatId, threadId)?.messagesCount;
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserPremium)(global);
  const areAdsEnabled = !isCurrentUserPremium || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUserFullInfo)(global, currentUserId)?.areAdsEnabled;
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserFrozen)(global);
  const hasCustomGreeting = Boolean(userFullInfo?.businessIntro);
  const isAppConfigLoaded = global.isAppConfigLoaded;
  const monoforumChannelId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectMonoforumChannel)(global, chatId)?.id;
  const canTranslate = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCanTranslateChat)(global, chatId) && !chatFullInfo?.isTranslationDisabled;
  const shouldAutoTranslate = chat?.hasAutoTranslation;
  const translationLanguage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTranslationLanguage)(global);
  const chatAutoTranslate = global.chatAutoTranslate;
  return {
    areAdsEnabled,
    isChatLoaded: true,
    isRestricted,
    restrictionReasons,
    isChannelChat: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isChatChannel)(chat),
    isChatMonoforum: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isChatMonoforum)(chat),
    isGroupChat: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isChatGroup)(chat),
    isChannelWithAvatars: chat.areProfilesShown,
    isCreator: chat.isCreator,
    isChatWithSelf: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatWithSelf)(global, chatId),
    isSystemBotChat: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isSystemBot)(chatId),
    isAnonymousForwards: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_7__.isAnonymousForwardsChat)(chatId),
    isBot: Boolean(chatBot),
    isNonContact,
    nameChangeDate,
    photoChangeDate,
    isSynced: global.isSynced,
    messageIds,
    messagesById,
    firstUnreadId: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectFirstUnreadId)(global, chatId, threadId),
    isViewportNewest: type !== 'thread' || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsViewportNewest)(global, chatId, threadId),
    focusingId,
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsInSelectMode)(global),
    hasLinkedChat: chatFullInfo ? Boolean(chatFullInfo.linkedChatId) : undefined,
    channelJoinInfo: chatFullInfo?.joinInfo,
    topic,
    noMessageSendingAnimation: !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPerformanceSettingsValue)(global, 'messageSendingAnimations'),
    isServiceNotificationsChat: chatId === _config__WEBPACK_IMPORTED_MODULE_5__.SERVICE_NOTIFICATIONS_USER_ID,
    isForum: chat.isForum,
    isEmptyThread,
    currentUserId,
    isChatProtected: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatProtected)(global, chatId),
    ...(withLastMessageWhenPreloading && {
      lastMessage
    }),
    isAccountFrozen,
    hasCustomGreeting,
    isAppConfigLoaded,
    monoforumChannelId,
    canTranslate,
    translationLanguage,
    detectedLanguage,
    shouldAutoTranslate,
    chatAutoTranslate
  };
})(MessageList)));
function generateChannelJoinMessageId(lastMessageId) {
  return lastMessageId + 10e-7; // Smaller than smallest possible id with `getNextLocalMessageId`
}

/***/ },

/***/ "./src/components/middle/MessageListAccountInfo.module.scss"
/*!******************************************************************!*\
  !*** ./src/components/middle/MessageListAccountInfo.module.scss ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"tFPZHCMt","chatInfo":"ubFGDy3d","chatBackground":"niS9Gfcl","botBackground":"kXKBpNnb","bot-info-description":"kpMdEhns","botInfoDescription":"kpMdEhns","bot-info-title":"H__cBlx8","botInfoTitle":"H__cBlx8","media":"mtKNWJmZ","chatInfoTitle":"RyB2zw9K","chatInfoSubtitle":"n9OcHdnh","chatDescription":"TYJGFKqJ","country":"WuX68A65","chatNotVerified":"sCB3zhO3","verifiedTitle":"dlaTjW_s","link":"yIJ4jRxH","linkInfo":"_MPDNfhr","icon":"KYcoeDmo","textColor":"BH_g_jqY"});

/***/ },

/***/ "./src/components/middle/MessageListAccountInfo.tsx"
/*!**********************************************************!*\
  !*** ./src/components/middle/MessageListAccountInfo.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_emoji_emoji__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/emoji/emoji */ "./src/util/emoji/emoji.ts");
/* harmony import */ var _util_phoneNumber__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/phoneNumber */ "./src/util/phoneNumber.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AvatarList__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../common/AvatarList */ "./src/components/common/AvatarList.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MiniTable__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../common/MiniTable */ "./src/components/common/MiniTable.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../ui/OptimizedVideo */ "./src/components/ui/OptimizedVideo.tsx");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./MessageListAccountInfo.module.scss */ "./src/components/middle/MessageListAccountInfo.module.scss");























const MessageListAccountInfo = ({
  chat,
  chatId,
  botInfo,
  isLoadingFullUser,
  phoneCodeList,
  commonChats,
  userFullInfo,
  hasMessages
}) => {
  const {
    loadCommonChats,
    openChatWithInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const {
    phoneCountry,
    registrationMonth,
    nameChangeDate,
    photoChangeDate
  } = userFullInfo?.settings || {};
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    loadCommonChats({
      userId: chatId
    });
  }, [chatId]);
  const country = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!phoneCodeList || !phoneCountry) return undefined;
    return (0,_util_phoneNumber__WEBPACK_IMPORTED_MODULE_8__.getCountryCodeByIso)(phoneCodeList, phoneCountry);
  }, [phoneCodeList, phoneCountry]);
  const botInfoPhotoUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_13__["default"])(botInfo?.photo ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getBotCoverMediaHash)(botInfo.photo) : undefined);
  const botInfoGifUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_13__["default"])(botInfo?.gif ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getVideoMediaHash)(botInfo.gif, 'full') : undefined);
  const botInfoDimensions = botInfo?.photo ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getPhotoFullDimensions)(botInfo.photo) : botInfo?.gif ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getVideoDimensions)(botInfo.gif) : undefined;
  const isBotInfoEmpty = botInfo && !botInfo.description && !botInfo.gif && !botInfo.photo;
  const isChatInfoEmpty = !country || !registrationMonth;
  const isVerifyCodes = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatWithVerificationCodesBot)(chatId);
  const {
    width,
    height
  } = botInfoDimensions || {};
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(e => {
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_9__["default"])(e);
    openChatWithInfo({
      id: chatId,
      shouldReplaceHistory: true,
      profileTab: 'commonChats',
      forceScrollProfileTab: true
    });
  });
  const securityNameInfo = nameChangeDate && chat ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "local-action-message",
    key: "security-name-message"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('UserUpdatedName', {
    user: chat.title,
    time: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatPastDatetime)(lang, nameChangeDate)
  }, {
    withNodes: true,
    withMarkdown: true
  }))) : undefined;
  const securityPhotoInfo = photoChangeDate && chat ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "local-action-message",
    key: "security-photo-message"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('UserUpdatedPhoto', {
    user: chat.title,
    time: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatPastDatetime)(lang, photoChangeDate)
  }, {
    withNodes: true,
    withMarkdown: true
  }))) : undefined;
  const tableData = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const entries = [];
    if (country) {
      entries.push([oldLang('PrivacyPhone'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].chatDescription
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].country
      }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])((0,_util_emoji_emoji__WEBPACK_IMPORTED_MODULE_7__.isoToEmoji)(country?.iso2))), country?.defaultName)]);
    }
    if (registrationMonth) {
      entries.push([lang('ContactInfoRegistration'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatRegistrationMonth)(lang.code, registrationMonth)]);
    }
    if (userFullInfo?.commonChatsCount) {
      const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
      const peers = commonChats?.ids.slice(0, 3).map(id => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, id)).filter(Boolean);
      entries.push([lang('ChatNonContactUserGroups'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_18__["default"], {
        className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].link,
        onClick: handleClick
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].linkInfo
      }, lang('ChatGroups', {
        count: userFullInfo.commonChatsCount
      }, {
        pluralValue: userFullInfo.commonChatsCount
      })), Boolean(peers?.length) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AvatarList__WEBPACK_IMPORTED_MODULE_15__["default"], {
        size: "micro",
        peers: peers
      }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
        name: "next",
        className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].icon
      }))]);
    }
    return entries;
  }, [lang, oldLang, country, registrationMonth, commonChats, userFullInfo]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].root, 'empty')
  }, isLoadingFullUser && isChatInfoEmpty && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('Loading')), isBotInfoEmpty && isChatInfoEmpty && !isLoadingFullUser && !hasMessages && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('NoMessages')), botInfo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].chatInfo, _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].botBackground),
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_5__["default"])(width ? `width: ${width}px` : undefined)
  }, botInfoPhotoUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].media,
    src: botInfoPhotoUrl,
    width: width,
    height: height,
    alt: "Bot info"
  }), botInfoGifUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_19__["default"], {
    canPlay: true,
    className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].media,
    src: botInfoGifUrl,
    loop: true,
    disablePictureInPicture: true,
    muted: true,
    playsInline: true,
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_5__["default"])(Boolean(width) && `width: ${width}px`, Boolean(height) && `height: ${height}px`)
  }), botInfoDimensions && !botInfoPhotoUrl && !botInfoGifUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_20__["default"], {
    className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].media,
    width: width,
    height: height,
    forceAspectRatio: true
  }), isVerifyCodes && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].botInfoDescription
  }, oldLang('VerifyChatInfo')), !isVerifyCodes && botInfo.description && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].botInfoDescription
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].botInfoTitle
  }, oldLang('BotInfoTitle')), (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(botInfo.description, ['br', 'emoji', 'links']))), !isChatInfoEmpty && chat && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].chatInfo, _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].chatBackground)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].chatInfoTitle
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, chat))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].chatInfoSubtitle, _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].textColor)
  }, lang('ChatNonContactUserSubtitle')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MiniTable__WEBPACK_IMPORTED_MODULE_17__["default"], {
    keyClassName: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].textColor,
    data: tableData
  }), !chat?.isVerified && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].chatNotVerified, _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].textColor)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
    name: "info-filled"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _MessageListAccountInfo_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].verifiedTitle
  }, lang('ContactInfoNotVerified')))), securityNameInfo, securityPhotoInfo);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const {
    countryList: {
      phoneCodes: phoneCodeList
    }
  } = global;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  const userFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, chatId);
  const commonChats = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserCommonChats)(global, chatId);
  const chatBot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectBot)(global, chatId);
  let isLoadingFullUser = false;
  let botInfo;
  if (chatBot) {
    if (userFullInfo) {
      botInfo = userFullInfo.botInfo;
    } else {
      isLoadingFullUser = true;
    }
  }
  return {
    chat,
    userFullInfo,
    botInfo,
    isLoadingFullUser,
    phoneCodeList,
    commonChats
  };
})(MessageListAccountInfo)));

/***/ },

/***/ "./src/components/middle/MessageListContent.tsx"
/*!******************************************************!*\
  !*** ./src/components/middle/MessageListContent.tsx ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _helpers_groupMessages__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./helpers/groupMessages */ "./src/components/middle/helpers/groupMessages.ts");
/* harmony import */ var _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _message_helpers_messageActions__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./message/helpers/messageActions */ "./src/components/middle/message/helpers/messageActions.tsx");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useMessageObservers__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./hooks/useMessageObservers */ "./src/components/middle/hooks/useMessageObservers.ts");
/* harmony import */ var _hooks_useScrollHooks__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./hooks/useScrollHooks */ "./src/components/middle/hooks/useScrollHooks.ts");
/* harmony import */ var _common_MiniTable__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../common/MiniTable */ "./src/components/common/MiniTable.tsx");
/* harmony import */ var _message_ActionMessage__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./message/ActionMessage */ "./src/components/middle/message/ActionMessage.tsx");
/* harmony import */ var _message_Message__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./message/Message */ "./src/components/middle/message/Message.tsx");
/* harmony import */ var _message_SenderGroupContainer__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./message/SenderGroupContainer */ "./src/components/middle/message/SenderGroupContainer.tsx");
/* harmony import */ var _message_SponsoredMessage__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./message/SponsoredMessage */ "./src/components/middle/message/SponsoredMessage.tsx");
/* harmony import */ var _MessageListAccountInfo__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./MessageListAccountInfo */ "./src/components/middle/MessageListAccountInfo.tsx");
/* harmony import */ var _message_ActionMessage_module_scss__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./message/ActionMessage.module.scss */ "./src/components/middle/message/ActionMessage.module.scss");





























const UNREAD_DIVIDER_CLASS = 'unread-divider';
const MessageListContent = ({
  canShowAds,
  chatId,
  threadId,
  messageIds,
  messageGroups,
  getContainerHeight,
  isViewportNewest,
  isUnread,
  isComments,
  isEmptyThread,
  withUsers,
  isChannelChat,
  isChatMonoforum,
  noAvatars,
  containerRef,
  anchorIdRef,
  memoUnreadDividerBeforeIdRef,
  memoFirstUnreadIdRef,
  type,
  isReady,
  hasLinkedChat,
  isSchedule,
  shouldRenderAccountInfo,
  nameChangeDate,
  photoChangeDate,
  noAppearanceAnimation,
  isSavedDialog,
  onScrollDownToggle,
  onNotchToggle,
  onIntersectPinnedMessage,
  canPost
}) => {
  const {
    openHistoryCalendar
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const getIsHeavyAnimating2 = _teact__WEBPACK_IMPORTED_MODULE_0__.getIsHeavyAnimating;
  const getIsReady = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_15__["default"])(() => isReady && !getIsHeavyAnimating2(), [isReady, getIsHeavyAnimating2]);
  const areDatesClickable = !isSavedDialog && !isSchedule;
  const {
    observeIntersectionForReading,
    observeIntersectionForLoading,
    observeIntersectionForPlaying
  } = (0,_hooks_useMessageObservers__WEBPACK_IMPORTED_MODULE_19__["default"])(type, containerRef, memoFirstUnreadIdRef, onIntersectPinnedMessage, chatId);
  const {
    withHistoryTriggers,
    backwardsTriggerRef,
    forwardsTriggerRef,
    fabTriggerRef
  } = (0,_hooks_useScrollHooks__WEBPACK_IMPORTED_MODULE_20__["default"])(type, containerRef, messageIds, getContainerHeight, isViewportNewest, isUnread, onScrollDownToggle, onNotchToggle, isReady);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_17__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const unreadDivider = /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(UNREAD_DIVIDER_CLASS, 'local-action-message'),
    key: "unread-messages"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('UnreadMessages')));
  const renderPaidMessageAction = (message, album) => {
    if (message.paidMessageStars) {
      const messagesLength = album?.messages?.length || 1;
      const amount = message.paidMessageStars * messagesLength;
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('local-action-message'),
        key: `paid-messages-action-${message.id}`
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, message.isOutgoing ? lang('ActionPaidOneMessageOutgoing', {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsText)(lang, amount)
      }) : (() => {
        const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectSender)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), message);
        const userTitle = sender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__.getPeerTitle)(lang, sender) : '';
        return lang('ActionPaidOneMessageIncoming', {
          user: userTitle,
          amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsText)(lang, amount)
        });
      })()));
    }
    return undefined;
  };
  const renderSuggestedPostInfoAction = message => {
    if (message.suggestedPostInfo) {
      const {
        price,
        scheduleDate
      } = message.suggestedPostInfo;
      const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectSender)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), message);
      const userTitle = sender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__.getPeerTitle)(lang, sender) : '';
      const userLink = (0,_message_helpers_messageActions__WEBPACK_IMPORTED_MODULE_14__.renderPeerLink)(sender?.id, userTitle || lang('ActionFallbackUser'));
      const originalMessage = message.replyInfo?.type === 'message' && message.replyInfo.replyToMsgId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatMessage)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), message.chatId, message.replyInfo.replyToMsgId) : undefined;
      const changesInfo = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getSuggestedChangesInfo)(message, originalMessage);
      const titleText = changesInfo ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getSuggestedChangesActionText)(lang, message, originalMessage, message.isOutgoing, userLink) : message.isOutgoing ? lang('ActionSuggestedPostOutgoing', undefined, {
        withNodes: true,
        withMarkdown: true
      }) : lang('ActionSuggestedPostIncoming', {
        user: userLink
      }, {
        withNodes: true,
        withMarkdown: true
      });
      const tableData = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_10__.compact)([[lang('TitlePrice'), price ? price.currency === 'TON' ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatTonAsText)(lang, (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_9__.convertTonFromNanos)(price.amount)) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsText)(lang, price.amount) : lang('SuggestMessageNoPrice')], [lang('TitleTime'), scheduleDate ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__.formatScheduledDateTime)(scheduleDate, lang, oldLang) : lang('SuggestMessageAnytime')]]);
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('local-action-message'),
        key: `suggested-post-action-${message.id}`
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: _message_ActionMessage_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].suggestedPostContainer
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: _message_ActionMessage_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].suggestedPostTitle
      }, titleText), Boolean(tableData.length) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MiniTable__WEBPACK_IMPORTED_MODULE_21__["default"], {
        className: _message_ActionMessage_module_scss__WEBPACK_IMPORTED_MODULE_27__["default"].suggestedPostInfo,
        data: tableData
      })));
    }
    return undefined;
  };
  const messageCountToAnimate = noAppearanceAnimation ? 0 : messageGroups.reduce((acc, messageGroup) => {
    return acc + messageGroup.senderGroups.flat().length;
  }, 0);
  let appearanceIndex = 0;
  const prevMessageIds = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_18__["default"])(messageIds);
  const isNewMessage = Boolean(messageIds && prevMessageIds && messageIds[messageIds.length - 2] === prevMessageIds[prevMessageIds.length - 1]);
  function calculateSenderGroups(dateGroup, dateGroupIndex, dateGroupsArray) {
    return dateGroup.senderGroups.map((senderGroup, senderGroupIndex, senderGroupsArray) => {
      if (senderGroup.length === 1 && !(0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_12__.isAlbum)(senderGroup[0]) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isActionMessage)(senderGroup[0]) && senderGroup[0].content.action?.type !== 'phoneCall') {
        const message = senderGroup[0];
        const isLastInList = senderGroupIndex === senderGroupsArray.length - 1 && dateGroupIndex === dateGroupsArray.length - 1;
        return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_10__.compact)([message.id === memoUnreadDividerBeforeIdRef.current && unreadDivider, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_message_ActionMessage__WEBPACK_IMPORTED_MODULE_22__["default"], {
          key: message.id,
          message: message,
          threadId: threadId,
          observeIntersectionForBottom: observeIntersectionForReading,
          observeIntersectionForLoading: observeIntersectionForLoading,
          observeIntersectionForPlaying: observeIntersectionForPlaying,
          memoFirstUnreadIdRef: memoFirstUnreadIdRef,
          appearanceOrder: messageCountToAnimate - ++appearanceIndex,
          isJustAdded: isLastInList && isNewMessage,
          isLastInList: isLastInList,
          getIsMessageListReady: getIsReady,
          onIntersectPinnedMessage: onIntersectPinnedMessage
        })]);
      }
      let currentDocumentGroupId;
      const senderGroupElements = senderGroup.map((messageOrAlbum, messageIndex) => {
        const message = (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_12__.isAlbum)(messageOrAlbum) ? messageOrAlbum.mainMessage : messageOrAlbum;
        const album = (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_12__.isAlbum)(messageOrAlbum) ? messageOrAlbum : undefined;
        const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isOwnMessage)(message);
        const isMessageAlbum = (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_12__.isAlbum)(messageOrAlbum);
        const nextMessage = senderGroup[messageIndex + 1];
        if (message.previousLocalId && anchorIdRef.current === (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageHtmlId)(message.previousLocalId)) {
          anchorIdRef.current = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageHtmlId)(message.id);
        }
        const documentGroupId = !isMessageAlbum && message.groupedId ? message.groupedId : undefined;
        const nextDocumentGroupId = nextMessage && !(0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_12__.isAlbum)(nextMessage) ? nextMessage.groupedId : undefined;
        const isTopicTopMessage = message.id === threadId;
        const position = {
          isFirstInGroup: messageIndex === 0,
          isLastInGroup: messageIndex === senderGroup.length - 1,
          isFirstInDocumentGroup: Boolean(documentGroupId && documentGroupId !== currentDocumentGroupId),
          isLastInDocumentGroup: Boolean(documentGroupId && documentGroupId !== nextDocumentGroupId),
          isLastInList: messageIndex === senderGroup.length - 1 && senderGroupIndex === senderGroupsArray.length - 1 && dateGroupIndex === dateGroupsArray.length - 1
        };
        currentDocumentGroupId = documentGroupId;
        const originalId = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageOriginalId)(message);
        // Service notifications saved in cache in previous versions may share the same `previousLocalId`
        const key = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isServiceNotificationMessage)(message) ? `${message.date}_${originalId}` : originalId;
        const noComments = hasLinkedChat === false || !isChannelChat || Boolean(isChatMonoforum);
        return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_10__.compact)([message.id === memoUnreadDividerBeforeIdRef.current && unreadDivider, message.paidMessageStars && !withUsers && renderPaidMessageAction(message, album), message.suggestedPostInfo && renderSuggestedPostInfoAction(message), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_message_Message__WEBPACK_IMPORTED_MODULE_23__["default"], {
          key: key,
          message: message,
          observeIntersectionForBottom: observeIntersectionForReading,
          observeIntersectionForLoading: observeIntersectionForLoading,
          observeIntersectionForPlaying: observeIntersectionForPlaying,
          album: album,
          noAvatars: noAvatars,
          withAvatar: position.isLastInGroup && withUsers && !isOwn && (!isTopicTopMessage || !isComments),
          withSenderName: position.isFirstInGroup && withUsers && !isOwn,
          threadId: threadId,
          messageListType: type,
          noComments: noComments,
          noReplies: !noComments || threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID || type === 'scheduled',
          appearanceOrder: messageCountToAnimate - ++appearanceIndex,
          isJustAdded: position.isLastInList && isNewMessage,
          isFirstInGroup: position.isFirstInGroup,
          isLastInGroup: position.isLastInGroup,
          isFirstInDocumentGroup: position.isFirstInDocumentGroup,
          isLastInDocumentGroup: position.isLastInDocumentGroup,
          isLastInList: position.isLastInList,
          memoFirstUnreadIdRef: memoFirstUnreadIdRef,
          onIntersectPinnedMessage: onIntersectPinnedMessage,
          getIsMessageListReady: getIsReady
        }), message.id === threadId &&
        /*#__PURE__*/
        // eslint-disable-next-line react-x/no-duplicate-key
        _teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "local-action-message",
          key: "discussion-started"
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang(isEmptyThread ? isComments ? 'NoComments' : 'NoReplies' : 'DiscussionStarted')))]);
      }).flat();
      if (!withUsers) return senderGroupElements;
      const lastMessageOrAlbum = senderGroup[senderGroup.length - 1];
      const lastMessage = (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_12__.isAlbum)(lastMessageOrAlbum) ? lastMessageOrAlbum.mainMessage : lastMessageOrAlbum;
      const lastMessageId = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageOriginalId)(lastMessage);
      const lastAppearanceOrder = messageCountToAnimate - appearanceIndex;
      const isTopicTopMessage = lastMessage.id === threadId;
      const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isOwnMessage)(lastMessage);
      const firstMessageOrAlbum = senderGroup[0];
      const firstMessage = (0,_helpers_groupMessages__WEBPACK_IMPORTED_MODULE_12__.isAlbum)(firstMessageOrAlbum) ? firstMessageOrAlbum.mainMessage : firstMessageOrAlbum;
      const firstMessageId = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMessageOriginalId)(firstMessage);
      const key = `${firstMessageId}-${lastMessageId}`;
      const id = firstMessageId === lastMessageId ? `message-group-${firstMessageId}` : `message-group-${firstMessageId}-${lastMessageId}`;
      const withAvatar = withUsers && !isOwn && (!isTopicTopMessage || !isComments);
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_message_SenderGroupContainer__WEBPACK_IMPORTED_MODULE_24__["default"], {
        key: key,
        id: id,
        message: lastMessage,
        withAvatar: withAvatar,
        appearanceOrder: lastAppearanceOrder,
        canPost: canPost
      }, senderGroupElements);
    });
  }
  const dateGroups = messageGroups.map((dateGroup, dateGroupIndex, dateGroupsArray) => {
    const senderGroups = calculateSenderGroups(dateGroup, dateGroupIndex, dateGroupsArray);
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('message-date-group', !(nameChangeDate || photoChangeDate) && dateGroupIndex === 0 && 'first-message-date-group'),
      key: dateGroup.datetime,
      onMouseDown: _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_13__.preventMessageInputBlur,
      teactFastList: true
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('sticky-date', areDatesClickable && 'interactive'),
      key: "date-header",
      onMouseDown: _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_13__.preventMessageInputBlur,
      onClick: areDatesClickable ? () => openHistoryCalendar({
        selectedAt: dateGroup.datetime
      }) : undefined
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      dir: "auto"
    }, isSchedule && dateGroup.originalDate === _config__WEBPACK_IMPORTED_MODULE_3__.SCHEDULED_WHEN_ONLINE && oldLang('MessageScheduledUntilOnline'), isSchedule && dateGroup.originalDate !== _config__WEBPACK_IMPORTED_MODULE_3__.SCHEDULED_WHEN_ONLINE && oldLang('MessageScheduledOn', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__.formatHumanDate)(oldLang, dateGroup.datetime, undefined, true)), !isSchedule && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__.formatHumanDate)(oldLang, dateGroup.datetime))), senderGroups.flat());
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "messages-container",
    teactFastList: true
  }, withHistoryTriggers && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: backwardsTriggerRef,
    key: "backwards-trigger",
    className: "backwards-trigger"
  }), shouldRenderAccountInfo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageListAccountInfo__WEBPACK_IMPORTED_MODULE_26__["default"], {
    key: `account_info_${chatId}`,
    chatId: chatId,
    hasMessages: true
  }), dateGroups.flat(), withHistoryTriggers && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: forwardsTriggerRef,
    key: "forwards-trigger",
    className: "forwards-trigger"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: fabTriggerRef,
    key: "fab-trigger",
    className: "fab-trigger"
  }), canShowAds && isViewportNewest && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_message_SponsoredMessage__WEBPACK_IMPORTED_MODULE_25__["default"], {
    key: chatId,
    chatId: chatId,
    containerRef: containerRef,
    observeIntersectionForLoading: observeIntersectionForLoading,
    observeIntersectionForPlaying: observeIntersectionForPlaying
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MessageListContent));

/***/ },

/***/ "./src/components/middle/MessageListHistoryHandler.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/MessageListHistoryHandler.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }






// Actual `MessageList` components are unmounted when deep in the history,
// so we need a separate component just for handling history
const MessageListHistoryHandler = ({
  messageLists
}) => {
  const {
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const closeChat = () => {
    openChat({
      id: undefined
    }, {
      forceSyncOnIOs: true
    });
  };
  const MessageHistoryRecord = ({
    chatId,
    type,
    threadId
  }) => {
    (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_4__["default"])({
      isActive: true,
      hash: (0,_util_routing__WEBPACK_IMPORTED_MODULE_3__.createLocationHash)(chatId, type, threadId),
      onBack: closeChat
    });
  };
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, messageLists?.map((messageList, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MessageHistoryRecord, _extends({
    key: `${messageList.chatId}_${messageList.threadId}_${messageList.type}_${i}`
  }, messageList))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    messageLists: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global).messageLists
  };
})(MessageListHistoryHandler)));

/***/ },

/***/ "./src/components/middle/MessageSelectToolbar.async.tsx"
/*!**************************************************************!*\
  !*** ./src/components/middle/MessageSelectToolbar.async.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MessageSelectToolbarAsync = props => {
  const {
    isActive
  } = props;
  const MessageSelectToolbar = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MessageSelectToolbar', !isActive);
  return MessageSelectToolbar ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MessageSelectToolbar, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageSelectToolbarAsync);

/***/ },

/***/ "./src/components/middle/MiddleColumn.module.scss"
/*!********************************************************!*\
  !*** ./src/components/middle/MiddleColumn.module.scss ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"background":"C6IaXYew","customBgImage":"K1xhz7U5","customBgColor":"CwoXMwaR","withTransition":"nXhZtCma","draggable":"jMpPshUt","blurred":"JBrOVLsX","withRightColumn":"Lyw3O8XE"});

/***/ },

/***/ "./src/components/middle/MiddleColumn.scss"
/*!*************************************************!*\
  !*** ./src/components/middle/MiddleColumn.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/MiddleColumn.tsx"
/*!************************************************!*\
  !*** ./src/components/middle/MiddleColumn.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors/sharedState.ts */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _chatAssistant_room_ai_room_ai_utils__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../chatAssistant/room-ai/room-ai-utils */ "./src/components/chatAssistant/room-ai/room-ai-utils.ts");
/* harmony import */ var _chatAssistant_store__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../chatAssistant/store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _chatAssistant_store_messages_store__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../chatAssistant/store/messages-store */ "./src/components/chatAssistant/store/messages-store.ts");
/* harmony import */ var _chatAssistant_utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../chatAssistant/utils/schedule-meeting */ "./src/components/chatAssistant/utils/schedule-meeting.ts");
/* harmony import */ var _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../chatAssistant/variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./helpers/calculateMiddleFooterTransforms */ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useCustomBackground */ "./src/hooks/useCustomBackground.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../hooks/usePrevDuringAnimation */ "./src/hooks/usePrevDuringAnimation.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useResize__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../hooks/useResize */ "./src/hooks/useResize.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _hooks_usePinnedMessage__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./hooks/usePinnedMessage */ "./src/components/middle/hooks/usePinnedMessage.ts");
/* harmony import */ var _message_hooks_useFluidBackgroundFilter__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./message/hooks/useFluidBackgroundFilter */ "./src/components/middle/message/hooks/useFluidBackgroundFilter.tsx");
/* harmony import */ var _chatAssistant_global_summary_GlobalSummaryWrapper__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../chatAssistant/global-summary/GlobalSummaryWrapper */ "./src/components/chatAssistant/global-summary/GlobalSummaryWrapper.tsx");
/* harmony import */ var _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../chatAssistant/lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _common_Composer__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../common/Composer */ "./src/components/common/Composer.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PrivacySettingsNoticeModal_async__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ../common/PrivacySettingsNoticeModal.async */ "./src/components/common/PrivacySettingsNoticeModal.async.tsx");
/* harmony import */ var _common_SeenByModal_async__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ../common/SeenByModal.async */ "./src/components/common/SeenByModal.async.tsx");
/* harmony import */ var _common_UnpinAllMessagesModal_async__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../common/UnpinAllMessagesModal.async */ "./src/components/common/UnpinAllMessagesModal.async.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _ChatLanguageModal_async__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./ChatLanguageModal.async */ "./src/components/middle/ChatLanguageModal.async.tsx");
/* harmony import */ var _composer_DropArea__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./composer/DropArea */ "./src/components/middle/composer/DropArea.tsx");
/* harmony import */ var _EmojiInteractionAnimation_async__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./EmojiInteractionAnimation.async */ "./src/components/middle/EmojiInteractionAnimation.async.tsx");
/* harmony import */ var _FloatingActionButtons__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./FloatingActionButtons */ "./src/components/middle/FloatingActionButtons.tsx");
/* harmony import */ var _FrozenAccountPlaceholder__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./FrozenAccountPlaceholder */ "./src/components/middle/FrozenAccountPlaceholder.tsx");
/* harmony import */ var _MessageList__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./MessageList */ "./src/components/middle/MessageList.tsx");
/* harmony import */ var _MessageSelectToolbar_async__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ./MessageSelectToolbar.async */ "./src/components/middle/MessageSelectToolbar.async.tsx");
/* harmony import */ var _MiddleHeader__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ./MiddleHeader */ "./src/components/middle/MiddleHeader.tsx");
/* harmony import */ var _MiddleHeaderPanes__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ./MiddleHeaderPanes */ "./src/components/middle/MiddleHeaderPanes.tsx");
/* harmony import */ var _PremiumRequiredPlaceholder__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ./PremiumRequiredPlaceholder */ "./src/components/middle/PremiumRequiredPlaceholder.tsx");
/* harmony import */ var _ReactorListModal_async__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ./ReactorListModal.async */ "./src/components/middle/ReactorListModal.async.tsx");
/* harmony import */ var _search_MiddleSearch_async__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ./search/MiddleSearch.async */ "./src/components/middle/search/MiddleSearch.async.tsx");
/* harmony import */ var _MiddleColumn_scss__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./MiddleColumn.scss */ "./src/components/middle/MiddleColumn.scss");
/* harmony import */ var _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ./MiddleColumn.module.scss */ "./src/components/middle/MiddleColumn.module.scss");
/* harmony import */ var _chatAssistant_room_storage_index_tsx__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ../chatAssistant/room-storage/index.tsx */ "./src/components/chatAssistant/room-storage/index.tsx");



























































function isImage(item) {
  return item.kind === 'file' && item.type && _config__WEBPACK_IMPORTED_MODULE_3__.SUPPORTED_PHOTO_CONTENT_TYPES.has(item.type);
}
function isVideo(item) {
  return item.kind === 'file' && item.type && _config__WEBPACK_IMPORTED_MODULE_3__.SUPPORTED_VIDEO_CONTENT_TYPES.has(item.type);
}
const LAYER_ANIMATION_DURATION_MS = 450 + _config__WEBPACK_IMPORTED_MODULE_3__.ANIMATION_END_DELAY;
function MiddleColumn({
  leftColumnRef,
  chatId,
  threadId,
  isComments,
  messageListType,
  isMobile,
  chat,
  draftReplyInfo,
  isPrivate,
  isPinnedMessageList,
  canPost,
  currentUserBannedRights,
  defaultBannedRights,
  pinnedMessagesCount,
  customBackground,
  theme,
  backgroundColor,
  patternColor,
  isLeftColumnShown,
  isRightColumnShown,
  isBackgroundBlurred,
  leftColumnWidth,
  hasActiveMiddleSearch,
  isSelectModeActive,
  isSeenByModalOpen,
  isPrivacySettingsNoticeModalOpen,
  isReactorListModalOpen,
  isChatLanguageModalOpen,
  animationLevel,
  withInterfaceAnimations,
  withRightColumnAnimation,
  shouldSkipHistoryAnimations,
  currentTransitionKey,
  isChannel,
  arePeerSettingsLoaded,
  canSubscribe,
  canStartBot,
  canRestartBot,
  activeEmojiInteractions,
  shouldJoinToSend,
  shouldSendJoinRequest,
  shouldLoadFullChat,
  pinnedIds,
  canUnpin,
  canUnblock,
  isSavedDialog,
  canShowOpenChatButton,
  isContactRequirePremium,
  topics,
  paidMessagesStars,
  isAccountFrozen,
  freezeAppealChat,
  isSerena,
  shouldBlockSendInMonoforum
}) {
  const {
    openChat,
    openPreviousChat,
    unpinAllMessages,
    loadUser,
    loadPeerSettings,
    exitMessageSelectMode,
    joinChannel,
    sendBotCommand,
    restartBot,
    showNotification,
    loadFullChat,
    setLeftColumnWidth,
    resetLeftColumnWidth,
    unblockUser
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_31__["default"])();
  const {
    isTablet,
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_20__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_26__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_24__["default"])();
  const [dropAreaState, setDropAreaState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_composer_DropArea__WEBPACK_IMPORTED_MODULE_44__.DropAreaState.None);
  const [isScrollDownNeeded, setIsScrollDownShown] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const isScrollDownShown = isScrollDownNeeded && (!isMobile || !hasActiveMiddleSearch);
  const [isNotchShown, setIsNotchShown] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isUnpinModalOpen, setIsUnpinModalOpen] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    handleIntersectPinnedMessage,
    handleFocusPinnedMessage,
    getCurrentPinnedIndex,
    getLoadingPinnedId
  } = (0,_hooks_usePinnedMessage__WEBPACK_IMPORTED_MODULE_32__["default"])(chatId, threadId, pinnedIds);
  const closeAnimationDuration = isMobile ? LAYER_ANIMATION_DURATION_MS : undefined;
  const renderingChatId = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(chatId, closeAnimationDuration);
  const renderingThreadId = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(threadId, closeAnimationDuration);
  const renderingMessageListType = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(messageListType, closeAnimationDuration);
  const renderingCanSubscribe = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(canSubscribe, closeAnimationDuration);
  const renderingCanStartBot = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(canStartBot, closeAnimationDuration);
  const renderingCanRestartBot = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(canRestartBot, closeAnimationDuration);
  const renderingCanUnblock = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(canUnblock, closeAnimationDuration);
  const renderingCanPost = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(canPost, closeAnimationDuration) && !renderingCanRestartBot && !renderingCanStartBot && !renderingCanSubscribe && !renderingCanUnblock && chatId !== _config__WEBPACK_IMPORTED_MODULE_3__.TMP_CHAT_ID && !isContactRequirePremium;
  const renderingIsScrollDownShown = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(isScrollDownShown, closeAnimationDuration) && chatId !== _config__WEBPACK_IMPORTED_MODULE_3__.TMP_CHAT_ID;
  const renderingIsChannel = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(isChannel, closeAnimationDuration);
  const renderingShouldJoinToSend = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(shouldJoinToSend, closeAnimationDuration);
  const renderingShouldSendJoinRequest = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(shouldSendJoinRequest, closeAnimationDuration);
  const renderingHandleIntersectPinnedMessage = (0,_hooks_usePrevDuringAnimation__WEBPACK_IMPORTED_MODULE_27__["default"])(chatId ? handleIntersectPinnedMessage : undefined, closeAnimationDuration);
  const prevTransitionKey = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_28__["default"])(currentTransitionKey);
  const cleanupExceptionKey = prevTransitionKey !== undefined && prevTransitionKey < currentTransitionKey ? prevTransitionKey : undefined;
  const {
    isReady,
    handleCssTransitionEnd,
    handleSlideTransitionStop
  } = useIsReady(!shouldSkipHistoryAnimations && withInterfaceAnimations, currentTransitionKey, prevTransitionKey, chatId, isMobile);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return chatId ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
      openChat({
        id: undefined
      });
    }) : undefined;
  }, [chatId, openChat]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_30__["default"])(() => {
    setDropAreaState(_composer_DropArea__WEBPACK_IMPORTED_MODULE_44__.DropAreaState.None);
    setIsNotchShown(undefined);
  }, [chatId]);

  // Track chat stay duration for analytics
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    let enterTime;
    if (chatId) {
      // Record enter time when entering a chat
      enterTime = Date.now();
    }
    return () => {
      // Record stay duration when leaving a chat
      if (chatId && enterTime) {
        const stayDuration = Date.now() - enterTime;
        _chatAssistant_room_storage_index_tsx__WEBPACK_IMPORTED_MODULE_57__["default"].addStayDuration(chatId, stayDuration);
      }
    };
  }, [chatId]);

  // Fix for mobile virtual keyboard
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_IOS && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_ANDROID) {
      return undefined;
    }
    const {
      visualViewport
    } = window;
    if (!visualViewport) {
      return undefined;
    }
    const handleResize = () => {
      const isFixNeeded = visualViewport.height !== document.documentElement.clientHeight;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMutation)(() => {
        document.body.classList.toggle('keyboard-visible', isFixNeeded);
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
          if (!isFixNeeded && visualViewport.offsetTop) {
            (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMutation)(() => {
              window.scrollTo({
                top: 0
              });
            });
          }
        });
      });
    };
    visualViewport.addEventListener('resize', handleResize);
    return () => {
      visualViewport.removeEventListener('resize', handleResize);
    };
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isPrivate) {
      loadUser({
        userId: chatId
      });
    }
  }, [chatId, isPrivate, loadUser]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!arePeerSettingsLoaded) {
      loadPeerSettings({
        peerId: chatId
      });
    }
  }, [chatId, isPrivate, arePeerSettingsLoaded]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId && shouldLoadFullChat && isReady) {
      loadFullChat({
        chatId
      });
    }
  }, [shouldLoadFullChat, chatId, isReady, loadFullChat]);
  const handleAnalyticsMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(({
    message
  }) => {
    const messageText = message.content.text?.text;
    if (messageText === _chatAssistant_utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_15__.ASK_MEETING_TIMEZONE || messageText === _chatAssistant_utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_15__.ASK_MEETING_TIME || messageText === _chatAssistant_utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_15__.ASK_MEETING_EMAIL || messageText === _chatAssistant_utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_15__.MEETING_INVITATION_TIP) {
      return;
    }
    if (_chatAssistant_utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_15__["default"].get(chatId)) {
      return;
    }
    const meetingMentionMessage = (0,_chatAssistant_room_ai_room_ai_utils__WEBPACK_IMPORTED_MODULE_12__.createMeetingMentionMessage)({
      messageId: message.id,
      chatId: message.chatId,
      senderId: message.senderId,
      messageText
    });
    _chatAssistant_store__WEBPACK_IMPORTED_MODULE_13__.ChataiStores?.message?.storeMessage((0,_chatAssistant_store_messages_store__WEBPACK_IMPORTED_MODULE_14__.parseMessage2StoreMessage)(message.chatId, [meetingMentionMessage])[0]);
    // TODO: add meeting time confirm message and open ai room
    if (chatId === message.chatId) {
      _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_35__["default"].emit(_chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_35__.Actions.AddRoomAIMessage, meetingMentionMessage);
      (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openChatAIWithInfo({
        chatId: message.chatId
      });
    }
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_35__["default"].on(_chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_35__.Actions.IntentionToScheduleMeeting, handleAnalyticsMessage);
    return () => _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_35__["default"].off(_chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_35__.Actions.IntentionToScheduleMeeting, handleAnalyticsMessage);
  }, []);
  const {
    initResize,
    resetResize,
    handleMouseUp
  } = (0,_hooks_useResize__WEBPACK_IMPORTED_MODULE_29__.useResize)(leftColumnRef, n => setLeftColumnWidth({
    leftColumnWidth: n
  }), resetLeftColumnWidth, leftColumnWidth, '--left-column-width');
  const handleDragEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(e => {
    const {
      items
    } = e.dataTransfer || {};
    // In Safari, the e.dataTransfer.items list may be empty during dragenter/dragover events,
    // preventing the ability to determine file types in advance. More details: https://bugs.webkit.org/show_bug.cgi?id=223517
    const shouldDrawQuick = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_SAFARI || items && items.length > 0 && Array.from(items)
    // Filter unnecessary element for drag and drop images in Firefox (https://github.com/Ajaxy/telegram-tt/issues/49)
    // https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API/Recommended_drag_types#image
    .filter(item => item.type !== 'text/uri-list').every(item => isImage(item) || isVideo(item));
    setDropAreaState(shouldDrawQuick ? _composer_DropArea__WEBPACK_IMPORTED_MODULE_44__.DropAreaState.QuickFile : _composer_DropArea__WEBPACK_IMPORTED_MODULE_44__.DropAreaState.Document);
  });
  const handleHideDropArea = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    setDropAreaState(_composer_DropArea__WEBPACK_IMPORTED_MODULE_44__.DropAreaState.None);
  });
  const handleOpenUnpinModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    setIsUnpinModalOpen(true);
  });
  const closeUnpinModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    setIsUnpinModalOpen(false);
  });
  const handleOpenChatFromSaved = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openChat({
      id: String(threadId)
    });
  });
  const handleUnpinAllMessages = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    unpinAllMessages({
      chatId: chatId,
      threadId: threadId
    });
    closeUnpinModal();
    openPreviousChat();
  });
  const handleTabletFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    openChat({
      id: chatId
    });
  });
  const handleSubscribeClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    joinChannel({
      chatId: chatId
    });
    if (renderingShouldSendJoinRequest) {
      showNotification({
        message: isChannel ? oldLang('RequestToJoinChannelSentDescription') : oldLang('RequestToJoinGroupSentDescription')
      });
    }
  });
  const handleStartBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    sendBotCommand({
      command: '/start'
    });
  });
  const handleRestartBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    restartBot({
      chatId: chatId
    });
  });
  const handleUnblock = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_25__["default"])(() => {
    unblockUser({
      userId: chatId
    });
  });
  const customBackgroundValue = (0,_hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_21__["default"])(theme, customBackground);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.MASK_IMAGE_DISABLED ? 'mask-image-disabled' : 'mask-image-enabled');
  const bgClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])(_MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_56__["default"].background, withRightColumnAnimation && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_56__["default"].withTransition, customBackground && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_56__["default"].customBgImage, backgroundColor && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_56__["default"].customBgColor, customBackground && isBackgroundBlurred && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_56__["default"].blurred, isRightColumnShown && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_56__["default"].withRightColumn, _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_ELECTRON && !(renderingChatId && renderingThreadId) && _MiddleColumn_module_scss__WEBPACK_IMPORTED_MODULE_56__["default"].draggable);
  const messagingDisabledClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('messaging-disabled', !isSelectModeActive && 'shown');
  const messageSendingRestrictionReason = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageSendingRestrictionReason)(oldLang, currentUserBannedRights, defaultBannedRights);
  const forumComposerPlaceholder = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getForumComposerPlaceholder)(oldLang, chat, threadId, topics, Boolean(draftReplyInfo));
  const composerRestrictionMessage = messageSendingRestrictionReason || forumComposerPlaceholder || (shouldBlockSendInMonoforum ? lang('MonoforumComposerPlaceholder') : undefined) || (isContactRequirePremium ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PremiumRequiredPlaceholder__WEBPACK_IMPORTED_MODULE_52__["default"], {
    userId: chatId
  }) : undefined) || (isAccountFrozen && freezeAppealChat?.id !== chatId ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FrozenAccountPlaceholder__WEBPACK_IMPORTED_MODULE_47__["default"], null) : undefined);

  // CSS Variables calculation doesn't work properly with transforms, so we calculate transform values in JS
  const {
    composerHiddenScale,
    toolbarHiddenScale,
    composerTranslateX,
    toolbarTranslateX,
    unpinHiddenScale,
    toolbarForUnpinHiddenScale
  } = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_19__["default"])(windowWidth, renderingCanPost), [renderingCanPost, windowWidth]);
  const footerClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('middle-column-footer', !renderingCanPost && 'no-composer', renderingCanPost && isNotchShown && !isSelectModeActive && 'with-notch');
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_23__["default"])({
    isActive: isSelectModeActive,
    onBack: exitMessageSelectMode
  });

  // Prepare filter beforehand to avoid flickering
  (0,_message_hooks_useFluidBackgroundFilter__WEBPACK_IMPORTED_MODULE_33__["default"])(patternColor);
  const isMessagingDisabled = Boolean(!isPinnedMessageList && !isSavedDialog && !renderingCanPost && !renderingCanRestartBot && !renderingCanStartBot && !renderingCanSubscribe && composerRestrictionMessage) || isAccountFrozen && freezeAppealChat?.id !== chatId;
  const withMessageListBottomShift = Boolean(renderingCanRestartBot || renderingCanSubscribe || renderingShouldSendJoinRequest || renderingCanStartBot || isPinnedMessageList && canUnpin || canShowOpenChatButton || renderingCanUnblock);
  const withExtraShift = Boolean(isMessagingDisabled || isSelectModeActive);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "MiddleColumn",
    className: className,
    onTransitionEnd: handleCssTransitionEnd,
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_10__["default"])(`--composer-hidden-scale: ${composerHiddenScale}`, `--toolbar-hidden-scale: ${toolbarHiddenScale}`, `--unpin-hidden-scale: ${unpinHiddenScale}`, `--toolbar-unpin-hidden-scale: ${toolbarForUnpinHiddenScale},`, `--composer-translate-x: ${composerTranslateX}px`, `--toolbar-translate-x: ${toolbarTranslateX}px`, `--pattern-color: ${patternColor}`, backgroundColor && `--theme-background-color: ${backgroundColor}`),
    onClick: isTablet && isLeftColumnShown ? handleTabletFocus : undefined
  }, isDesktop && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "resize-handle",
    onMouseDown: initResize,
    onMouseUp: handleMouseUp,
    onDoubleClick: resetResize
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: bgClassName,
    style: customBackgroundValue ? `--custom-background: ${customBackgroundValue}` : undefined
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "middle-column-portals"
  }), isSerena && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_global_summary_GlobalSummaryWrapper__WEBPACK_IMPORTED_MODULE_34__["default"], null), Boolean(renderingChatId && renderingThreadId && !isSerena) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "messages-layout",
    onDragEnter: renderingCanPost ? handleDragEnter : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MiddleHeaderPanes__WEBPACK_IMPORTED_MODULE_51__["default"], {
    key: renderingChatId,
    chatId: renderingChatId,
    threadId: renderingThreadId,
    messageListType: renderingMessageListType,
    getCurrentPinnedIndex: getCurrentPinnedIndex,
    getLoadingPinnedId: getLoadingPinnedId,
    onFocusPinnedMessage: handleFocusPinnedMessage
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MiddleHeader__WEBPACK_IMPORTED_MODULE_50__["default"], {
    chatId: renderingChatId,
    threadId: renderingThreadId,
    messageListType: renderingMessageListType,
    isComments: isComments,
    isMobile: isMobile,
    getCurrentPinnedIndex: getCurrentPinnedIndex,
    getLoadingPinnedId: getLoadingPinnedId,
    onFocusPinnedMessage: handleFocusPinnedMessage
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_42__["default"], {
    name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_18__.resolveTransitionName)('slide', animationLevel, shouldSkipHistoryAnimations || !withInterfaceAnimations),
    activeKey: currentTransitionKey,
    shouldCleanup: true,
    cleanupExceptionKey: cleanupExceptionKey,
    isBlockingAnimation: true,
    onStop: handleSlideTransitionStop
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageList__WEBPACK_IMPORTED_MODULE_48__["default"], {
    key: `${renderingChatId}-${renderingThreadId}-${renderingMessageListType}`,
    chatId: renderingChatId,
    threadId: renderingThreadId,
    type: renderingMessageListType,
    isComments: isComments,
    canPost: renderingCanPost,
    onScrollDownToggle: setIsScrollDownShown,
    onNotchToggle: setIsNotchShown,
    isReady: isReady,
    isContactRequirePremium: isContactRequirePremium,
    paidMessagesStars: paidMessagesStars,
    withBottomShift: withMessageListBottomShift,
    withDefaultBg: Boolean(!customBackground && !backgroundColor),
    onIntersectPinnedMessage: renderingHandleIntersectPinnedMessage
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: footerClassName
  }, renderingCanPost && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Composer__WEBPACK_IMPORTED_MODULE_36__["default"], {
    type: "messageList",
    chatId: renderingChatId,
    threadId: renderingThreadId,
    messageListType: renderingMessageListType,
    dropAreaState: dropAreaState,
    onDropHide: handleHideDropArea,
    isReady: isReady,
    isMobile: isMobile,
    editableInputId: _config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_ID,
    editableInputCssSelector: _config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_CSS_SELECTOR,
    inputId: "message-input-text"
  }), isPinnedMessageList && canUnpin && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_41__["default"], {
    size: "tiny",
    fluid: true,
    color: "secondary",
    className: "composer-button unpin-all-button",
    onClick: handleOpenUnpinModal
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_37__["default"], {
    name: "unpin"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('Chat.Pinned.UnpinAll', pinnedMessagesCount, 'i')))), canShowOpenChatButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_41__["default"], {
    size: "tiny",
    fluid: true,
    color: "secondary",
    className: "composer-button open-chat-button",
    onClick: handleOpenChatFromSaved
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('SavedOpenChat')))), isMessagingDisabled && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: messagingDisabledClassName
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "messaging-disabled-inner"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, composerRestrictionMessage))), isMobile && (renderingCanSubscribe || renderingShouldJoinToSend && !renderingShouldSendJoinRequest) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_41__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleSubscribeClick
  }, oldLang(renderingIsChannel ? 'ProfileJoinChannel' : 'ProfileJoinGroup'))), isMobile && renderingShouldSendJoinRequest && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_41__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleSubscribeClick
  }, oldLang('ChannelJoinRequest'))), isMobile && renderingCanStartBot && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_41__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleStartBot
  }, oldLang('BotStart'))), isMobile && renderingCanRestartBot && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_41__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleRestartBot
  }, oldLang('BotRestart'))), isMobile && renderingCanUnblock && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "middle-column-footer-button-container",
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_41__["default"], {
    size: "tiny",
    fluid: true,
    ripple: true,
    className: "composer-button join-subscribe-button",
    onClick: handleUnblock
  }, oldLang('Unblock'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageSelectToolbar_async__WEBPACK_IMPORTED_MODULE_49__["default"], {
    messageListType: renderingMessageListType,
    isActive: isSelectModeActive,
    canPost: renderingCanPost
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_SeenByModal_async__WEBPACK_IMPORTED_MODULE_39__["default"], {
    isOpen: isSeenByModalOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivacySettingsNoticeModal_async__WEBPACK_IMPORTED_MODULE_38__["default"], {
    isOpen: isPrivacySettingsNoticeModalOpen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ReactorListModal_async__WEBPACK_IMPORTED_MODULE_53__["default"], {
    isOpen: isReactorListModalOpen
  }), _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_TRANSLATION_SUPPORTED && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatLanguageModal_async__WEBPACK_IMPORTED_MODULE_43__["default"], {
    isOpen: isChatLanguageModalOpen
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FloatingActionButtons__WEBPACK_IMPORTED_MODULE_46__["default"], {
    withScrollDown: renderingIsScrollDownShown,
    canPost: renderingCanPost,
    withExtraShift: withExtraShift
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_search_MiddleSearch_async__WEBPACK_IMPORTED_MODULE_54__["default"], {
    isActive: Boolean(hasActiveMiddleSearch)
  })), chatId && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_UnpinAllMessagesModal_async__WEBPACK_IMPORTED_MODULE_40__["default"], {
    isOpen: isUnpinModalOpen,
    chatId: chatId,
    pinnedMessagesCount: pinnedMessagesCount,
    onClose: closeUnpinModal,
    onUnpin: handleUnpinAllMessages
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    teactFastList: true
  }, activeEmojiInteractions?.map((activeEmojiInteraction, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_EmojiInteractionAnimation_async__WEBPACK_IMPORTED_MODULE_45__["default"], {
    teactOrderKey: i,
    key: activeEmojiInteraction.id,
    activeEmojiInteraction: activeEmojiInteraction
  }))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  isMobile
}) => {
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTheme)(global);
  const {
    isBlurred: isBackgroundBlurred,
    background: customBackground,
    backgroundColor,
    patternColor
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThemeValues)(global, theme) || {};
  const {
    messageLists,
    isLeftColumnShown,
    activeEmojiInteractions,
    seenByModal,
    reactorModal,
    shouldSkipHistoryAnimations,
    chatLanguageModal,
    privacySettingsNoticeModal
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const currentMessageList = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global);
  const {
    leftColumnWidth
  } = global;
  const state = {
    theme,
    customBackground,
    backgroundColor,
    patternColor,
    isLeftColumnShown,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsRightColumnShown)(global, isMobile),
    isBackgroundBlurred,
    hasActiveMiddleSearch: Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMiddleSearch)(global)),
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsInSelectMode)(global),
    isSeenByModalOpen: Boolean(seenByModal),
    isPrivacySettingsNoticeModalOpen: Boolean(privacySettingsNoticeModal),
    isReactorListModalOpen: Boolean(reactorModal),
    isChatLanguageModalOpen: Boolean(chatLanguageModal),
    animationLevel: (0,_global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_7__.selectSharedSettings)(global).animationLevel,
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateInterface)(global),
    withRightColumnAnimation: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateRightColumn)(global),
    currentTransitionKey: Math.max(0, messageLists.length - 1),
    activeEmojiInteractions,
    leftColumnWidth
  };
  if (!currentMessageList) {
    return state;
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  const isPrivate = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_17__.isUserId)(chatId);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const bot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectBot)(global, chatId);
  const pinnedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPinnedIds)(global, chatId, threadId);
  const chatFullInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId) : undefined;
  const userFullInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUserFullInfo)(global, chatId) : undefined;
  const editingId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectEditingId)(global, chatId, threadId);
  const threadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThreadInfo)(global, chatId, threadId);
  const isMessageThread = Boolean(!threadInfo?.isCommentsInfo && threadInfo?.fromChannelId);
  const topic = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopic)(global, chatId, threadId);
  const canPost = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanPostInChat)(chat, topic, isMessageThread, chatFullInfo);
  const isBotNotStarted = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatBotNotStarted)(global, chatId);
  const isPinnedMessageList = messageListType === 'pinned';
  const isMainThread = messageListType === 'thread' && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID;
  const isChannel = Boolean(chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat));
  const canSubscribe = Boolean(chat && isMainThread && (isChannel || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatSuperGroup)(chat)) && chat.isNotJoined && !chat.joinRequests && !chat.isMonoforum);
  const shouldJoinToSend = Boolean(chat?.isNotJoined && chat.isJoinToSend);
  const shouldSendJoinRequest = Boolean(chat?.isNotJoined && chat.isJoinRequest);
  const isUserBlocked = isPrivate ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsUserBlocked)(global, chatId) : false;
  const canRestartBot = Boolean(bot && isUserBlocked);
  const canStartBot = !canRestartBot && isBotNotStarted;
  const canUnblock = isUserBlocked && !bot;
  const shouldLoadFullChat = Boolean(chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatGroup)(chat) && !chatFullInfo);
  const draftReplyInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const shouldBlockSendInForum = chat?.isForum ? threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !draftReplyInfo && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopic)(global, chatId, _config__WEBPACK_IMPORTED_MODULE_3__.GENERAL_TOPIC_ID)?.isClosed : false;
  const isMonoforumAdmin = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsMonoforumAdmin)(global, chatId);
  const shouldBlockSendInMonoforum = Boolean(chat?.isMonoforum && !draftReplyInfo && isMonoforumAdmin && !editingId);
  const topics = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopics)(global, chatId);
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const canShowOpenChatButton = isSavedDialog && threadId !== _config__WEBPACK_IMPORTED_MODULE_3__.ANONYMOUS_USER_ID;
  const canUnpin = chat && (isPrivate || chat?.isCreator || !isChannel && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserRightBanned)(chat, 'pinMessages') || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getHasAdminRight)(chat, 'pinMessages'));
  const userFull = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUserFullInfo)(global, chatId);
  const isContactRequirePremium = userFull?.isContactRequirePremium;
  const paidMessagesStars = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeerPaidMessagesStars)(global, chatId);
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsCurrentUserFrozen)(global);
  const botFreezeAppealId = global.botFreezeAppealId;
  const freezeAppealChat = botFreezeAppealId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, botFreezeAppealId) : undefined;
  const isSerena = chatId === _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_16__.GLOBAL_SUMMARY_CHATID;
  return {
    ...state,
    chatId,
    threadId,
    messageListType,
    chat,
    draftReplyInfo,
    isPrivate,
    arePeerSettingsLoaded: Boolean(userFullInfo?.settings),
    isComments: isMessageThread,
    canPost: !isPinnedMessageList && (!chat || canPost) && !isBotNotStarted && !(shouldJoinToSend && chat?.isNotJoined) && !shouldBlockSendInForum && !shouldBlockSendInMonoforum && !isSavedDialog && (!isAccountFrozen || freezeAppealChat?.id === chatId),
    isPinnedMessageList,
    currentUserBannedRights: chat?.currentUserBannedRights,
    defaultBannedRights: chat?.defaultBannedRights,
    pinnedMessagesCount: pinnedIds ? pinnedIds.length : 0,
    shouldSkipHistoryAnimations,
    isChannel,
    canSubscribe,
    canStartBot,
    canRestartBot,
    shouldJoinToSend,
    shouldSendJoinRequest,
    shouldLoadFullChat,
    pinnedIds,
    canUnpin,
    canUnblock,
    isSavedDialog,
    canShowOpenChatButton,
    isContactRequirePremium,
    topics,
    paidMessagesStars,
    isAccountFrozen,
    freezeAppealChat,
    isSerena,
    shouldBlockSendInMonoforum
  };
})(MiddleColumn)));
function useIsReady(withAnimations, currentTransitionKey, prevTransitionKey, chatId, isMobile) {
  const [isReady, setIsReady] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isMobile);
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_22__["default"])();
  const willSwitchMessageList = prevTransitionKey !== undefined && prevTransitionKey !== currentTransitionKey;
  if (willSwitchMessageList) {
    if (withAnimations) {
      setIsReady(false);

      // Make sure to end even if end callback was not called (which was some hardly-reproducible bug)
      setTimeout(() => {
        setIsReady(true);
      }, LAYER_ANIMATION_DURATION_MS);
    } else {
      forceUpdate();
    }
  }
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_30__["default"])(() => {
    if (!withAnimations) {
      setIsReady(true);
    }
  }, [withAnimations]);
  function handleCssTransitionEnd(e) {
    if (e.propertyName === 'transform' && e.target === e.currentTarget) {
      setIsReady(Boolean(chatId));
    }
  }
  function handleSlideTransitionStop() {
    setIsReady(true);
  }
  return {
    isReady: isReady && !willSwitchMessageList,
    handleCssTransitionEnd: withAnimations ? handleCssTransitionEnd : undefined,
    handleSlideTransitionStop: withAnimations ? handleSlideTransitionStop : undefined
  };
}

/***/ },

/***/ "./src/components/middle/MiddleHeader.scss"
/*!*************************************************!*\
  !*** ./src/components/middle/MiddleHeader.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/MiddleHeader.tsx"
/*!************************************************!*\
  !*** ./src/components/middle/MiddleHeader.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useConnectionStatus */ "./src/hooks/useConnectionStatus.ts");
/* harmony import */ var _hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useElectronDrag */ "./src/hooks/useElectronDrag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLongPress__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useLongPress */ "./src/hooks/useLongPress.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../common/GroupChatInfo */ "./src/components/common/GroupChatInfo.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _common_UnreadCounter__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../common/UnreadCounter */ "./src/components/common/UnreadCounter.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _HeaderActions__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./HeaderActions */ "./src/components/middle/HeaderActions.tsx");
/* harmony import */ var _panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./panes/AudioPlayer */ "./src/components/middle/panes/AudioPlayer.tsx");
/* harmony import */ var _panes_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./panes/HeaderPinnedMessage */ "./src/components/middle/panes/HeaderPinnedMessage.tsx");
/* harmony import */ var _MiddleHeader_scss__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./MiddleHeader.scss */ "./src/components/middle/MiddleHeader.scss");



























const BACK_BUTTON_INACTIVE_TIME = 450;
const EMOJI_STATUS_SIZE = 22;
const SEARCH_LONGTAP_THRESHOLD = 500;
const MiddleHeader = ({
  chatId,
  threadId,
  messageListType,
  isMobile,
  typingStatus,
  isSelectModeActive,
  isLeftColumnShown,
  audioMessage,
  chat,
  messagesCount,
  isComments,
  isChatWithSelf,
  shouldSkipHistoryAnimations,
  currentTransitionKey,
  connectionState,
  isSyncing,
  isFetchingDifference,
  getCurrentPinnedIndex,
  getLoadingPinnedId,
  emojiStatusSticker,
  emojiStatusSlug,
  isSavedDialog,
  onFocusPinnedMessage
}) => {
  const {
    openThreadWithInfo,
    openChat,
    openPreviousChat,
    toggleLeftColumn,
    exitMessageSelectMode,
    openPremiumModal,
    openStickerSet,
    updateMiddleSearch,
    openUniqueGiftBySlug
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const isBackButtonActive = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(true);
  const {
    isTablet
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const {
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const isLeftColumnHideable = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_4__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN;
  const shouldShowCloseButton = isTablet && isLeftColumnShown;
  const componentRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const handleOpenSearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    updateMiddleSearch({
      chatId,
      threadId,
      update: {}
    });
  });
  const handleOpenChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(event => {
    if (event.target.closest('.title > .custom-emoji')) return;
    openThreadWithInfo({
      chatId,
      threadId
    });
  });
  const {
    onMouseDown: handleLongPressMouseDown,
    onMouseUp: handleLongPressMouseUp,
    onMouseLeave: handleLongPressMouseLeave,
    onTouchStart: handleLongPressTouchStart,
    onTouchEnd: handleLongPressTouchEnd
  } = (0,_hooks_useLongPress__WEBPACK_IMPORTED_MODULE_13__["default"])({
    onStart: handleOpenSearch,
    onClick: handleOpenChat,
    threshold: SEARCH_LONGTAP_THRESHOLD
  });
  const setBackButtonActive = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    setTimeout(() => {
      isBackButtonActive.current = true;
    }, BACK_BUTTON_INACTIVE_TIME);
  });
  const handleUserStatusClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    if (emojiStatusSlug) {
      openUniqueGiftBySlug({
        slug: emojiStatusSlug
      });
      return;
    }
    openPremiumModal({
      fromUserId: chatId
    });
  });
  const handleChannelStatusClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    if (emojiStatusSlug) {
      openUniqueGiftBySlug({
        slug: emojiStatusSlug
      });
      return;
    }
    openStickerSet({
      stickerSetInfo: emojiStatusSticker.stickerSetInfo
    });
  });
  const handleBackClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(e => {
    if (!isBackButtonActive.current) return;

    // Workaround for missing UI when quickly clicking the Back button
    isBackButtonActive.current = false;
    if (isMobile) {
      const messageInput = document.querySelector(_config__WEBPACK_IMPORTED_MODULE_4__.EDITABLE_INPUT_CSS_SELECTOR);
      messageInput?.blur();
    }
    if (isSelectModeActive) {
      exitMessageSelectMode();
      setBackButtonActive();
      return;
    }
    if (messageListType === 'thread' && currentTransitionKey === 0) {
      if (!isTablet || shouldShowCloseButton) {
        e.stopPropagation(); // Stop propagation to prevent chat re-opening on tablets
        openChat({
          id: undefined
        }, {
          forceOnHeavyAnimation: true
        });
      } else {
        toggleLeftColumn();
      }
      setBackButtonActive();
      return;
    }
    openPreviousChat();
    setBackButtonActive();
  });
  const prevTransitionKey = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_15__["default"])(currentTransitionKey);
  const cleanupExceptionKey = prevTransitionKey !== undefined && prevTransitionKey < currentTransitionKey ? prevTransitionKey : undefined;
  const isAudioPlayerActive = Boolean(audioMessage);
  const isAudioPlayerRendering = isDesktop && isAudioPlayerActive;
  const isPinnedMessagesFullWidth = isAudioPlayerActive || !isDesktop;
  const {
    connectionStatusText
  } = (0,_hooks_useConnectionStatus__WEBPACK_IMPORTED_MODULE_10__["default"])(lang, connectionState, isSyncing || isFetchingDifference, true);
  function renderInfo() {
    if (messageListType === 'thread') {
      if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID || isSavedDialog || chat?.isForum) {
        return renderChatInfo();
      }
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderBackButton(), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", null, messagesCount !== undefined ? messageListType === 'thread' ? messagesCount ? lang(isComments ? 'Comments' : 'Replies', messagesCount, 'i') : lang(isComments ? 'CommentsTitle' : 'RepliesTitle') : messageListType === 'pinned' ? lang('PinnedMessagesCount', messagesCount, 'i') : messageListType === 'scheduled' ? isChatWithSelf ? lang('Reminders') : lang('messages', messagesCount, 'i') : undefined : lang('Loading')));
  }
  function renderChatInfo() {
    // TODO Implement count
    const savedMessagesStatus = isSavedDialog ? lang('SavedMessages') : undefined;
    const realChatId = isSavedDialog ? String(threadId) : chatId;
    const displayChatId = chat?.isMonoforum ? chat.linkedMonoforumId : realChatId;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, (isLeftColumnHideable || currentTransitionKey > 0) && renderBackButton(shouldShowCloseButton, !isSavedDialog), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "chat-info-wrapper",
      onMouseDown: handleLongPressMouseDown,
      onMouseUp: handleLongPressMouseUp,
      onMouseLeave: handleLongPressMouseLeave,
      onTouchStart: handleLongPressTouchStart,
      onTouchEnd: handleLongPressTouchEnd
    }, (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_8__.isUserId)(displayChatId) ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_18__["default"], {
      key: displayChatId,
      userId: displayChatId,
      typingStatus: typingStatus,
      status: connectionStatusText || savedMessagesStatus,
      withDots: Boolean(connectionStatusText),
      withFullInfo: true,
      withMediaViewer: true,
      withStory: !isChatWithSelf,
      withUpdatingStatus: true,
      isSavedDialog: isSavedDialog,
      storyViewerOrigin: _types__WEBPACK_IMPORTED_MODULE_3__.StoryViewerOrigin.MiddleHeaderAvatar,
      emojiStatusSize: EMOJI_STATUS_SIZE,
      noRtl: true,
      onEmojiStatusClick: handleUserStatusClick
    }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_17__["default"], {
      key: displayChatId,
      chatId: displayChatId,
      threadId: !isSavedDialog ? threadId : undefined,
      typingStatus: typingStatus,
      withMonoforumStatus: chat?.isMonoforum,
      status: connectionStatusText || savedMessagesStatus,
      withDots: Boolean(connectionStatusText),
      withMediaViewer: threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
      withFullInfo: threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
      withUpdatingStatus: true,
      withStory: true,
      isSavedDialog: isSavedDialog,
      storyViewerOrigin: _types__WEBPACK_IMPORTED_MODULE_3__.StoryViewerOrigin.MiddleHeaderAvatar,
      emojiStatusSize: EMOJI_STATUS_SIZE,
      onEmojiStatusClick: handleChannelStatusClick,
      noRtl: true
    })));
  }
  function renderBackButton(asClose = false, withUnreadCounter = false) {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "back-button"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_20__["default"], {
      round: true,
      size: "smaller",
      color: "translucent",
      onClick: handleBackClick,
      ariaLabel: lang(asClose ? 'Close' : 'Back')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('animated-close-icon', !asClose && 'state-back')
    })), withUnreadCounter && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_UnreadCounter__WEBPACK_IMPORTED_MODULE_19__["default"], null));
  }
  (0,_hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_11__["default"])(componentRef);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "MiddleHeader",
    ref: componentRef
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_21__["default"], {
    name: shouldSkipHistoryAnimations ? 'none' : 'slideFade',
    activeKey: currentTransitionKey,
    shouldCleanup: true,
    cleanupExceptionKey: cleanupExceptionKey
  }, renderInfo()), !isPinnedMessagesFullWidth && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_panes_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_24__["default"], {
    key: chatId,
    chatId: chatId,
    threadId: threadId,
    messageListType: messageListType,
    onFocusPinnedMessage: onFocusPinnedMessage,
    getLoadingPinnedId: getLoadingPinnedId,
    getCurrentPinnedIndex: getCurrentPinnedIndex
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "header-tools"
  }, isAudioPlayerRendering && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_23__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HeaderActions__WEBPACK_IMPORTED_MODULE_22__["default"], {
    chatId: chatId,
    threadId: threadId,
    messageListType: messageListType,
    isMobile: isMobile,
    canExpandActions: !isAudioPlayerRendering
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId,
  messageListType,
  isMobile
}) => {
  const {
    isLeftColumnShown,
    shouldSkipHistoryAnimations,
    audioPlayer,
    messageLists
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, chatId);
  const {
    chatId: audioChatId,
    messageId: audioMessageId
  } = audioPlayer;
  const audioMessage = audioChatId && audioMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatMessage)(global, audioChatId, audioMessageId) : undefined;
  let messagesCount;
  if (messageListType === 'pinned') {
    const pinnedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPinnedIds)(global, chatId, threadId);
    messagesCount = pinnedIds?.length;
  } else if (messageListType === 'scheduled') {
    const scheduledIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectScheduledIds)(global, chatId, threadId);
    messagesCount = scheduledIds?.length;
  } else if (messageListType === 'thread' && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID) {
    const threadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThreadInfo)(global, chatId, threadId);
    messagesCount = threadInfo?.messagesCount || 0;
  }
  const typingStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThreadParam)(global, chatId, threadId, 'typingStatus');
  const emojiStatus = peer?.emojiStatus;
  const emojiStatusSticker = emojiStatus && global.customEmojis.byId[emojiStatus.documentId];
  const emojiStatusSlug = emojiStatus?.type === 'collectible' ? emojiStatus.slug : undefined;
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  return {
    typingStatus,
    isLeftColumnShown,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsRightColumnShown)(global, isMobile),
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsInSelectMode)(global),
    audioMessage,
    chat,
    messagesCount,
    isChatWithSelf: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatWithSelf)(global, chatId),
    shouldSkipHistoryAnimations,
    currentTransitionKey: Math.max(0, messageLists.length - 1),
    connectionState: global.connectionState,
    isSyncing: global.isSyncing,
    isFetchingDifference: global.isFetchingDifference,
    emojiStatusSticker,
    emojiStatusSlug,
    isSavedDialog
  };
})(MiddleHeader)));

/***/ },

/***/ "./src/components/middle/MiddleHeaderPanes.module.scss"
/*!*************************************************************!*\
  !*** ./src/components/middle/MiddleHeaderPanes.module.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"oCUr3DTX","root_withRightColumnAnimation":"YPrc0luK","rootWithRightColumnAnimation":"YPrc0luK"});

/***/ },

/***/ "./src/components/middle/MiddleHeaderPanes.tsx"
/*!*****************************************************!*\
  !*** ./src/components/middle/MiddleHeaderPanes.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @teact/teact-dom */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useEffectOnce__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useEffectOnce */ "./src/hooks/useEffectOnce.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useSignalEffect__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useSignalEffect */ "./src/hooks/useSignalEffect.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _calls_group_GroupCallTopPane__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../calls/group/GroupCallTopPane */ "./src/components/calls/group/GroupCallTopPane.tsx");
/* harmony import */ var _panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./panes/AudioPlayer */ "./src/components/middle/panes/AudioPlayer.tsx");
/* harmony import */ var _panes_BotAdPane__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./panes/BotAdPane */ "./src/components/middle/panes/BotAdPane.tsx");
/* harmony import */ var _panes_BotVerificationPane__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./panes/BotVerificationPane */ "./src/components/middle/panes/BotVerificationPane.tsx");
/* harmony import */ var _panes_ChatReportPane__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./panes/ChatReportPane */ "./src/components/middle/panes/ChatReportPane.tsx");
/* harmony import */ var _panes_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./panes/HeaderPinnedMessage */ "./src/components/middle/panes/HeaderPinnedMessage.tsx");
/* harmony import */ var _panes_PaidMessageChargePane__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./panes/PaidMessageChargePane */ "./src/components/middle/panes/PaidMessageChargePane.tsx");
/* harmony import */ var _MiddleHeaderPanes_module_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./MiddleHeaderPanes.module.scss */ "./src/components/middle/MiddleHeaderPanes.module.scss");




















const FALLBACK_PANE_STATE = {
  height: 0
};
const MiddleHeaderPanes = ({
  className,
  chatId,
  threadId,
  messageListType,
  chat,
  userFullInfo,
  getCurrentPinnedIndex,
  getLoadingPinnedId,
  isAudioPlayerRendered,
  isMiddleSearchOpen,
  withRightColumnAnimation,
  onFocusPinnedMessage
}) => {
  const {
    settings
  } = userFullInfo || {};
  const {
    isDesktop
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const [getAudioPlayerState, setAudioPlayerState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getPinnedState, setPinnedState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getGroupCallState, setGroupCallState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getChatReportState, setChatReportState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getBotAdState, setBotAdState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getBotVerificationState, setBotVerificationState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const [getPaidMessageChargeState, setPaidMessageChargeState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(FALLBACK_PANE_STATE);
  const isPinnedMessagesFullWidth = isAudioPlayerRendered || !isDesktop;
  const isFirstRenderRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(true);
  const {
    shouldRender,
    ref
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_8__["default"])({
    isOpen: !isMiddleSearchOpen,
    withShouldRender: true,
    noMountTransition: true
  });
  (0,_hooks_useEffectOnce__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    isFirstRenderRef.current = false;
  });
  (0,_hooks_useSignalEffect__WEBPACK_IMPORTED_MODULE_9__.useSignalEffect)(() => {
    const audioPlayerState = getAudioPlayerState();
    const botVerificationState = getBotVerificationState();
    const pinnedState = getPinnedState();
    const groupCallState = getGroupCallState();
    const chatReportState = getChatReportState();
    const botAdState = getBotAdState();
    const paidMessageState = getPaidMessageChargeState();

    // Keep in sync with the order of the panes in the DOM
    const stateArray = [audioPlayerState, groupCallState, chatReportState, botVerificationState, pinnedState, botAdState, paidMessageState];
    const isFirstRender = isFirstRenderRef.current;
    const totalHeight = stateArray.reduce((acc, state) => acc + state.height, 0);
    const middleColumn = document.getElementById('MiddleColumn');
    if (!middleColumn) return;
    (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__.applyAnimationState)(stateArray, isFirstRender);
    (0,_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__.setExtraStyles)(middleColumn, {
      '--middle-header-panes-height': `${totalHeight}px`
    });
  }, [getAudioPlayerState, getGroupCallState, getPinnedState, getChatReportState, getBotAdState, getBotVerificationState, getPaidMessageChargeState]);
  if (!shouldRender) return undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_MiddleHeaderPanes_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].root, withRightColumnAnimation && _MiddleHeaderPanes_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].root_withRightColumnAnimation, className)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_panes_AudioPlayer__WEBPACK_IMPORTED_MODULE_12__["default"], {
    isFullWidth: true,
    onPaneStateChange: setAudioPlayerState,
    isHidden: isDesktop
  }), threadId === _api_types__WEBPACK_IMPORTED_MODULE_3__.MAIN_THREAD_ID && !chat?.isForum && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_calls_group_GroupCallTopPane__WEBPACK_IMPORTED_MODULE_11__["default"], {
    chatId: chatId,
    onPaneStateChange: setGroupCallState
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_panes_ChatReportPane__WEBPACK_IMPORTED_MODULE_15__["default"], {
    chatId: chatId,
    canAddContact: settings?.canAddContact,
    canBlockContact: settings?.canBlockContact,
    canReportSpam: settings?.canReportSpam,
    isAutoArchived: settings?.isAutoArchived,
    onPaneStateChange: setChatReportState
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_panes_BotVerificationPane__WEBPACK_IMPORTED_MODULE_14__["default"], {
    peerId: chatId,
    onPaneStateChange: setBotVerificationState
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_panes_PaidMessageChargePane__WEBPACK_IMPORTED_MODULE_17__["default"], {
    peerId: chatId,
    onPaneStateChange: setPaidMessageChargeState
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_panes_HeaderPinnedMessage__WEBPACK_IMPORTED_MODULE_16__["default"], {
    chatId: chatId,
    threadId: threadId,
    messageListType: messageListType,
    onFocusPinnedMessage: onFocusPinnedMessage,
    getLoadingPinnedId: getLoadingPinnedId,
    getCurrentPinnedIndex: getCurrentPinnedIndex,
    onPaneStateChange: setPinnedState,
    isFullWidth: true,
    shouldHide: !isPinnedMessagesFullWidth
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_panes_BotAdPane__WEBPACK_IMPORTED_MODULE_13__["default"], {
    chatId: chatId,
    messageListType: messageListType,
    onPaneStateChange: setBotAdState
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_2__.withGlobal)((global, {
  chatId
}) => {
  const {
    audioPlayer
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const userFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUserFullInfo)(global, chatId);
  const {
    chatId: audioChatId,
    messageId: audioMessageId
  } = audioPlayer;
  const audioMessage = audioChatId && audioMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessage)(global, audioChatId, audioMessageId) : undefined;
  const isMiddleSearchOpen = Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMiddleSearch)(global));
  return {
    chat,
    userFullInfo,
    isAudioPlayerRendered: Boolean(audioMessage),
    isMiddleSearchOpen,
    withRightColumnAnimation: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanAnimateRightColumn)(global)
  };
})(MiddleHeaderPanes)));

/***/ },

/***/ "./src/components/middle/NoMessages.scss"
/*!***********************************************!*\
  !*** ./src/components/middle/NoMessages.scss ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/NoMessages.tsx"
/*!**********************************************!*\
  !*** ./src/components/middle/NoMessages.tsx ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_TopicIcon__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../common/TopicIcon */ "./src/components/common/TopicIcon.tsx");
/* harmony import */ var _NoMessages_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./NoMessages.scss */ "./src/components/middle/NoMessages.scss");








const ICON_SIZE = 3 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const NoMessages = ({
  isChatWithSelf,
  type,
  isGroupChatJustCreated,
  topic
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  if (type === 'scheduled') {
    return renderScheduled(lang);
  }
  if (isChatWithSelf) {
    return renderSavedMessages(lang);
  }
  if (isGroupChatJustCreated) {
    return renderGroup(lang);
  }
  if (topic) {
    return renderTopic(lang, topic);
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "empty"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('NoMessages')));
};
function renderTopic(lang, topic) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "NoMessages"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "wrapper"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_TopicIcon__WEBPACK_IMPORTED_MODULE_5__["default"], {
    topic: topic,
    size: ICON_SIZE,
    className: "no-messages-icon topic-icon"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: "title"
  }, lang('Chat.EmptyTopicPlaceholder.Title')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "description topic-description"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_2__["default"])(lang('Chat.EmptyTopicPlaceholder.Text'), ['br']))));
}
function renderScheduled(lang) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "empty"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, lang('ScheduledMessages.EmptyPlaceholder')));
}
function renderSavedMessages(lang) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "NoMessages"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "wrapper"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
    name: "cloud-download",
    className: "no-messages-icon"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: "title"
  }, lang('Conversation.CloudStorageInfo.Title')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("ul", {
    className: "description"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('Conversation.ClousStorageInfo.Description1')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('Conversation.ClousStorageInfo.Description2')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('Conversation.ClousStorageInfo.Description3')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('Conversation.ClousStorageInfo.Description4')))));
}
function renderGroup(lang) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "NoMessages"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "wrapper",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: "title"
  }, lang('EmptyGroupInfo.Title')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "description"
  }, lang('EmptyGroupInfo.Subtitle')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("ul", {
    className: "list-checkmarks"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('EmptyGroupInfo.Line1')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('EmptyGroupInfo.Line2')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('EmptyGroupInfo.Line3')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("li", null, lang('EmptyGroupInfo.Line4')))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(NoMessages));

/***/ },

/***/ "./src/components/middle/PinnedMessageNavigation.module.scss"
/*!*******************************************************************!*\
  !*** ./src/components/middle/PinnedMessageNavigation.module.scss ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"pinned-message-border":"L5TQCriM","pinnedMessageBorder":"L5TQCriM","pinned-message-border-wrapper-1":"v5sJGzfS","pinnedMessageBorderWrapper1":"v5sJGzfS","pinned-message-border-wrapper":"p6PQhvds","pinnedMessageBorderWrapper":"p6PQhvds","pinned-message-border-mark":"M2PQZgBd","pinnedMessageBorderMark":"M2PQZgBd"});

/***/ },

/***/ "./src/components/middle/PinnedMessageNavigation.tsx"
/*!***********************************************************!*\
  !*** ./src/components/middle/PinnedMessageNavigation.tsx ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PinnedMessageNavigation.module.scss */ "./src/components/middle/PinnedMessageNavigation.module.scss");




const BORDER_MASK_LEVEL = 4;
const PinnedMessageNavigation = ({
  count,
  index
}) => {
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const markupParams = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return calculateMarkup(count, index);
  }, [count, index]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!containerRef.current) {
      return;
    }
    const {
      trackHeight,
      trackTranslateY,
      markHeight,
      markTranslateY,
      clipPathId,
      clipPath
    } = markupParams;
    const firstChild = containerRef.current.firstElementChild;
    if (containerRef?.current) {
      const currentElement = containerRef.current;
      const {
        style
      } = currentElement;
      style.height = `${trackHeight}px`;
      style.transform = `translateY(-${trackTranslateY}px)`;
      style.clipPath = `url("#${clipPathId}")`;
      const svg = currentElement.querySelector('svg');
      const div = currentElement.querySelector('div');
      const defs = currentElement.querySelector('defs');
      if (!svg) {
        if (firstChild) {
          firstChild.innerHTML = `<svg height="0" width="0"><defs> ${clipPath} </defs></svg>`;
        }
      }
      if (defs) {
        defs.innerHTML = clipPath;
      }
      if (div) {
        div.style.height = `${markHeight}px`;
        div.style.transform = `translateY(${markTranslateY}px)`;
      }
    }
  }, [markupParams]);
  if (count === 1) {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorder
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderWrapper1,
      ref: containerRef
    }));
  }
  const {
    trackHeight,
    trackTranslateY,
    markHeight,
    markTranslateY,
    clipPathId
  } = markupParams;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorder, count > BORDER_MASK_LEVEL && _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderMask)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderWrapper,
    ref: containerRef,
    style: `clip-path: url("#${clipPathId}"); width: 2px;
          height: ${trackHeight}px; transform: translateY(-${trackTranslateY}px);`
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PinnedMessageNavigation_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].pinnedMessageBorderMark,
    style: `--height: ${markHeight}px; --translate-y: ${markTranslateY}px; ` + `--translate-track: ${trackTranslateY}px;`
  })));
};
function calculateMarkup(count, index) {
  const reverseIndex = count - index - 1;
  const barHeight = getBarHeight(count);
  const markHeight = getMarkHeight(count, reverseIndex);
  const trackHeight = getTrackHeight(count, barHeight);
  const clipPathId = `clipPath${count}`;
  const clipPath = getClipPath(clipPathId, barHeight, count);
  const markTranslateY = getMarkTranslateY(reverseIndex, barHeight, count);
  const trackTranslateY = getTrackTranslateY(reverseIndex, count, barHeight, trackHeight);
  return {
    markHeight,
    clipPath,
    markTranslateY,
    trackTranslateY,
    trackHeight,
    clipPathId
  };
}
function getBarHeight(count) {
  let barHeight = 8;
  if (count === 1) {
    barHeight = 36;
  } else if (count === 2) {
    barHeight = 17;
  } else if (count === 3) {
    barHeight = 11;
  } else if (count === 4) {
    barHeight = 7.5;
  } else if (count > 3) {
    barHeight = 7.5;
  }
  return barHeight;
}
function getMarkHeight(count, index) {
  let barHeight = 36;
  if (count === 1) {
    barHeight = 36;
  } else if (count === 2) {
    barHeight = 17;
  } else if (count === 3) {
    barHeight = index === 1 ? 12 : 11;
  } else if (count === 4) {
    barHeight = 7.5;
  } else if (count > 3) {
    barHeight = 7.5;
  }
  return barHeight;
}
function getTrackHeight(count, barHeight) {
  return count <= 3 ? 36 : barHeight * count + 2 * (count - 1);
}
function getClipPath(id, barHeight, count) {
  const radius = 1;
  let d = '';
  if (count === 3) {
    d = drawRect(0, 0, 2, barHeight, radius) + drawRect(0, 12, 2, barHeight + 1, radius) + drawRect(0, 25, 2, barHeight, radius);
  } else {
    for (let i = 0; i < count; i++) {
      d += drawRect(0, (barHeight + 2) * i, 2, barHeight, radius);
    }
  }
  return `<clipPath id="${id}">
      <path d="${d}" />
    </clipPath>`;
}
function drawRect(x, y, width, height, radius) {
  return `M${x},${y + radius}a${radius},${radius},0,0,1,
  ${width},0v${height - 2 * radius}a${radius},${radius},0,0,1,${-width},0Z`;
}
function getMarkTranslateY(index, barHeight, count) {
  if (count === 1) {
    return 0;
  } else if (count === 2) {
    return index === 0 ? 0 : barHeight + 2;
  }
  if (count === 3) {
    if (index === 0) {
      return 0;
    } else if (index === 1) {
      return 12;
    }
    return 25;
  } else {
    return (barHeight + 2) * index;
  }
}
function getTrackTranslateY(index, count, barHeight, trackHeight) {
  if (count <= 4) {
    return 0;
  }
  if (index <= 1) {
    return 0;
  } else if (index >= count - 2) {
    return trackHeight - 36;
  }
  return (barHeight + 4) / 2 + (index - 2) * (barHeight + 2);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PinnedMessageNavigation));

/***/ },

/***/ "./src/components/middle/PremiumRequiredPlaceholder.tsx"
/*!**************************************************************!*\
  !*** ./src/components/middle/PremiumRequiredPlaceholder.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");








function PremiumRequiredPlaceholder({
  userName
}) {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const {
    openPremiumModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleOpenPremiumModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => openPremiumModal());
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, lang('Chat.MessagingRestrictedPlaceholder', userName)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_6__["default"], {
    isPrimary: true,
    onClick: handleOpenPremiumModal
  }, lang('Chat.MessagingRestrictedPlaceholderAction')));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  userId
}) => {
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, userId);
  return {
    userName: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(user)
  };
})(PremiumRequiredPlaceholder)));

/***/ },

/***/ "./src/components/middle/ReactorListModal.async.tsx"
/*!**********************************************************!*\
  !*** ./src/components/middle/ReactorListModal.async.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReactorListModalAsync = props => {
  const {
    isOpen
  } = props;
  const ReactorListModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReactorListModal', !isOpen);
  return ReactorListModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReactorListModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReactorListModalAsync);

/***/ },

/***/ "./src/components/middle/RequirementToContactMessage.module.scss"
/*!***********************************************************************!*\
  !*** ./src/components/middle/RequirementToContactMessage.module.scss ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"J2RfusJI","button":"Nz8BOo0i","disabled":"zHsizIwX","inner":"C90W_KKX","icons-container":"Qi7tZATP","iconsContainer":"Qi7tZATP","animated-unlock":"lfcZJyxp","animatedUnlock":"lfcZJyxp","comments-icon":"zd5EAc5e","commentsIcon":"zd5EAc5e","description":"E_YZ3IQs","starIconContainer":"IL_EHscS","starIcon":"C_e1ij6A"});

/***/ },

/***/ "./src/components/middle/RequirementToContactMessage.tsx"
/*!***************************************************************!*\
  !*** ./src/components/middle/RequirementToContactMessage.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_Sparkles__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../common/Sparkles */ "./src/components/common/Sparkles.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./RequirementToContactMessage.module.scss */ "./src/components/middle/RequirementToContactMessage.module.scss");
















function RequirementToContactMessage({
  patternColor,
  peer,
  paidMessagesStars
}) {
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    openPremiumModal,
    openStarsBalanceModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleOpenPremiumModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => openPremiumModal());
  const handleGetMoreStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openStarsBalanceModal({});
  });
  if (!peer) return undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].inner
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].iconsContainer
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_10__["default"], {
    tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_5__.LOCAL_TGS_URLS.Unlock,
    size: 54,
    color: patternColor,
    className: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].animatedUnlock
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "comments-sticker",
    className: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].commentsIcon
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].description
  }, paidMessagesStars ? lang((0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.isApiPeerUser)(peer) ? 'MessagesPlaceholderPaidUser' : 'MessagesPlaceholderPaidChannel', {
    peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, peer),
    amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, paidMessagesStars, {
      asFont: true,
      className: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].starIcon,
      containerClassName: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].starIconContainer
    })
  }, {
    withNodes: true,
    withMarkdown: true
  }) : (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(oldLang('MessageLockedPremium', (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, peer)), ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_13__["default"], {
    color: "translucent-black",
    size: "default",
    pill: true,
    onClick: paidMessagesStars ? handleGetMoreStars : handleOpenPremiumModal,
    className: _RequirementToContactMessage_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].button
  }, paidMessagesStars ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, lang('ButtonBuyStars'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Sparkles__WEBPACK_IMPORTED_MODULE_12__["default"], {
    preset: "button"
  })) : oldLang('MessagePremiumUnlock'))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId: userId
}) => {
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTheme)(global);
  const {
    patternColor
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectThemeValues)(global, theme) || {};
  const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, userId);
  return {
    patternColor,
    peer
  };
})(RequirementToContactMessage)));

/***/ },

/***/ "./src/components/middle/ScrollDownButton.module.scss"
/*!************************************************************!*\
  !*** ./src/components/middle/ScrollDownButton.module.scss ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Y2NKrpKj","button":"cxwA6gDO","icon":"F4zNUFhH","unread-count":"GovSzpfQ","unreadCount":"GovSzpfQ"});

/***/ },

/***/ "./src/components/middle/ScrollDownButton.tsx"
/*!****************************************************!*\
  !*** ./src/components/middle/ScrollDownButton.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./ScrollDownButton.module.scss */ "./src/components/middle/ScrollDownButton.module.scss");












const ScrollDownButton = ({
  icon,
  ariaLabelLang,
  unreadCount,
  onClick,
  onReadAll,
  className
}) => {
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_3__["default"])(ref, !onReadAll);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root, className),
    ref: ref
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
    color: "secondary",
    round: true,
    className: _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].button,
    onClick: onClick,
    onContextMenu: handleContextMenu,
    ariaLabel: oldLang(ariaLabelLang)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: icon,
    className: _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].icon
  })), Boolean(unreadCount) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ScrollDownButton_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].unreadCount
  }, (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_2__.formatIntegerCompact)(lang, unreadCount)), onReadAll && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isOpen: isContextMenuOpen,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide,
    autoClose: true,
    positionX: "right",
    positionY: "bottom"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
    icon: "readchats",
    onClick: onReadAll
  }, oldLang('MarkAllAsRead'))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ScrollDownButton));

/***/ },

/***/ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts"
/*!**************************************************************************!*\
  !*** ./src/components/middle/helpers/calculateMiddleFooterTransforms.ts ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MIN_LEFT_COLUMN_WIDTH: () => (/* binding */ MIN_LEFT_COLUMN_WIDTH),
/* harmony export */   SIDE_COLUMN_MAX_WIDTH: () => (/* binding */ SIDE_COLUMN_MAX_WIDTH),
/* harmony export */   "default": () => (/* binding */ calculateMiddleFooterTransforms)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");


const MAX_TOOLBAR_WIDTH = 32 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const MAX_MESSAGES_LIST_WIDTH = 45.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const SIDE_COLUMN_MAX_WIDTH = 26.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const MIN_LEFT_COLUMN_WIDTH = 16 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
const UNPIN_BUTTON_WIDTH = 16.125 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
function calculateMiddleFooterTransforms(windowWidth, canPost) {
  const sidePadding = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_0__.MOBILE_SCREEN_MAX_WIDTH ? _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM : 2 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
  const messageListWidth = getMessageListWidth(windowWidth);
  const sendButtonWidth = 3 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_1__.REM;
  const composerWidth = canPost ? messageListWidth - sidePadding - sendButtonWidth : messageListWidth - sidePadding;
  const toolbarWidth = windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MOBILE_SCREEN_MAX_WIDTH ? Math.min(messageListWidth - sidePadding, MAX_TOOLBAR_WIDTH) : messageListWidth - sidePadding;
  const composerHiddenScale = toolbarWidth / composerWidth;
  const toolbarHiddenScale = composerWidth / toolbarWidth;
  const unpinHiddenScale = toolbarWidth / UNPIN_BUTTON_WIDTH;
  const toolbarForUnpinHiddenScale = UNPIN_BUTTON_WIDTH / toolbarWidth;
  const composerTranslateX = canPost ? sendButtonWidth / 2 * toolbarHiddenScale : 0;
  const toolbarTranslateX = canPost ? sendButtonWidth / 2 * -1 * composerHiddenScale : 0;
  return {
    composerHiddenScale,
    toolbarHiddenScale,
    composerTranslateX,
    toolbarTranslateX,
    unpinHiddenScale,
    toolbarForUnpinHiddenScale
  };
}
function getMessageListWidth(windowWidth) {
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN) {
    const leftColumnWidth = Math.min(Math.max(windowWidth * 0.25, MIN_LEFT_COLUMN_WIDTH), SIDE_COLUMN_MAX_WIDTH);
    const rightColumnWidth = Math.min(windowWidth * 0.25, SIDE_COLUMN_MAX_WIDTH);
    return Math.min(windowWidth - leftColumnWidth - rightColumnWidth, MAX_MESSAGES_LIST_WIDTH);
  }
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN) {
    const leftColumnWidth = Math.min(Math.max(windowWidth * 0.4, MIN_LEFT_COLUMN_WIDTH), SIDE_COLUMN_MAX_WIDTH);
    return Math.min(windowWidth - leftColumnWidth, MAX_MESSAGES_LIST_WIDTH);
  }
  if (windowWidth > MAX_MESSAGES_LIST_WIDTH) {
    return MAX_MESSAGES_LIST_WIDTH;
  }
  return windowWidth;
}

/***/ },

/***/ "./src/components/middle/helpers/groupMessages.ts"
/*!********************************************************!*\
  !*** ./src/components/middle/helpers/groupMessages.ts ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   groupMessages: () => (/* binding */ groupMessages),
/* harmony export */   isAlbum: () => (/* binding */ isAlbum)
/* harmony export */ });
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");


const GROUP_INTERVAL_SECONDS = 600; // 10 minutes

function isAlbum(messageOrAlbum) {
  return 'albumId' in messageOrAlbum;
}
function groupMessages(messages, firstUnreadId, topMessageId, isChatWithSelf, withUsers) {
  const initDateGroup = {
    originalDate: messages[0].date,
    datetime: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__.getDayStartAt)(messages[0].date * 1000),
    senderGroups: [[]]
  };
  let currentAlbum;
  const dateGroups = [initDateGroup];
  messages.forEach((message, index) => {
    const currentDateGroup = dateGroups[dateGroups.length - 1];
    const currentSenderGroup = currentDateGroup.senderGroups[currentDateGroup.senderGroups.length - 1];
    if (message.isInAlbum) {
      if (!currentAlbum) {
        currentAlbum = {
          albumId: message.groupedId,
          messages: [message],
          mainMessage: message,
          hasMultipleCaptions: false
        };
      } else {
        currentAlbum.messages.push(message);
        if (message.hasComments) {
          currentAlbum.commentsMessage = message;
        }
        if (message.content.text && !currentAlbum.hasMultipleCaptions) {
          if (currentAlbum.captionMessage) {
            currentAlbum.hasMultipleCaptions = true;
            currentAlbum.captionMessage = undefined;
          } else {
            currentAlbum.captionMessage = message;
          }
        }
      }
    } else if ((message.content.paidMedia?.extendedMedia.length || 0) > 1) {
      currentSenderGroup.push({
        albumId: `paid-${message.id}`,
        messages: [message],
        mainMessage: message,
        hasMultipleCaptions: false,
        isPaidMedia: true
      });
    } else {
      currentSenderGroup.push(message);
    }
    const nextMessage = messages[index + 1];
    if (currentAlbum && (!nextMessage || !nextMessage.groupedId || nextMessage.groupedId !== currentAlbum.albumId)) {
      currentSenderGroup.push(currentAlbum);
      currentAlbum = undefined;
    }
    const lastMessageInSenderGroup = currentSenderGroup[currentSenderGroup.length - 1];
    if (nextMessage && !currentAlbum) {
      const nextMessageDayStartsAt = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__.getDayStartAt)(nextMessage.date * 1000);
      if (currentDateGroup.datetime !== nextMessageDayStartsAt) {
        const newDateGroup = {
          originalDate: nextMessage.date,
          datetime: nextMessageDayStartsAt,
          senderGroups: [[]]
        };
        dateGroups.push(newDateGroup);
      } else if (nextMessage.id === firstUnreadId || message.senderId !== nextMessage.senderId || !withUsers && message.paidMessageStars || nextMessage.suggestedPostInfo || message.isOutgoing !== nextMessage.isOutgoing || message.postAuthorTitle !== nextMessage.postAuthorTitle || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.isActionMessage)(message) && message.content.action?.type !== 'phoneCall' || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.isActionMessage)(nextMessage) && nextMessage.content.action?.type !== 'phoneCall' || message.inlineButtons || nextMessage.inlineButtons || nextMessage.date - message.date > GROUP_INTERVAL_SECONDS || topMessageId && (message.id === topMessageId || lastMessageInSenderGroup && 'mainMessage' in lastMessageInSenderGroup && lastMessageInSenderGroup.mainMessage?.id === topMessageId) && nextMessage.id !== topMessageId || isChatWithSelf && message.forwardInfo?.fromId !== nextMessage.forwardInfo?.fromId) {
        currentDateGroup.senderGroups.push([]);
      }
    }
  });
  return dateGroups;
}

/***/ },

/***/ "./src/components/middle/hooks/useContainerHeight.ts"
/*!***********************************************************!*\
  !*** ./src/components/middle/hooks/useContainerHeight.ts ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useContainerHeight)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");



function useContainerHeight(containerRef, isComposerVisible) {
  const [getContainerHeight, setContainerHeight] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)();

  // Container resize observer (caused by Composer reply/webpage panels)
  const handleResize = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__["default"])(entry => {
    setContainerHeight(entry.contentRect.height);
  });
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_2__["default"])(containerRef, handleResize);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const currentNormalHeight = Number(containerRef.current.dataset.normalHeight) || 0;
    const containerHeight = getContainerHeight();
    if (containerHeight && containerHeight > currentNormalHeight && isComposerVisible) {
      containerRef.current.dataset.normalHeight = String(containerHeight);
    }
  }, [isComposerVisible, containerRef, getContainerHeight]);
  const prevContainerHeight = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  return [getContainerHeight, prevContainerHeight];
}

/***/ },

/***/ "./src/components/middle/hooks/useMessageObservers.ts"
/*!************************************************************!*\
  !*** ./src/components/middle/hooks/useMessageObservers.ts ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useMessageObservers)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");





const INTERSECTION_THROTTLE_FOR_READING = 150;
const INTERSECTION_THROTTLE_FOR_MEDIA = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_ANDROID ? 1000 : 350;
function useMessageObservers(type, containerRef, memoFirstUnreadIdRef, onIntersectPinnedMessage, chatId) {
  const {
    markMessageListRead,
    markMentionsRead,
    animateUnreadReaction,
    scheduleForViewsIncrement
  } = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getActions)();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const INTERSECTION_MARGIN_FOR_LOADING = isMobile ? 300 : 500;
  const {
    observe: observeIntersectionForReading,
    freeze: freezeForReading,
    unfreeze: unfreezeForReading
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE_FOR_READING
  }, entries => {
    if (type !== 'thread' || (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_4__.isBackgroundModeActive)()) {
      return;
    }
    let maxId = 0;
    const mentionIds = [];
    const reactionIds = [];
    const viewportPinnedIdsToAdd = [];
    const viewportPinnedIdsToRemove = [];
    const scheduledToUpdateViews = [];
    entries.forEach(entry => {
      const {
        isIntersecting,
        target
      } = entry;
      const {
        dataset
      } = target;
      const messageId = Number(dataset.lastMessageId || dataset.messageId);
      const shouldUpdateViews = dataset.shouldUpdateViews === 'true';
      const albumMainId = dataset.albumMainId ? Number(dataset.albumMainId) : undefined;
      if (!isIntersecting) {
        if (dataset.isPinned) {
          viewportPinnedIdsToRemove.push(albumMainId || messageId);
        }
        return;
      }
      if (messageId > maxId) {
        maxId = messageId;
      }
      if (dataset.hasUnreadMention) {
        mentionIds.push(messageId);
      }
      if (dataset.hasUnreadReaction) {
        reactionIds.push(messageId);
      }
      if (dataset.isPinned) {
        viewportPinnedIdsToAdd.push(albumMainId || messageId);
      }
      if (shouldUpdateViews) {
        scheduledToUpdateViews.push(albumMainId || messageId);
      }
    });
    if (memoFirstUnreadIdRef.current && maxId >= memoFirstUnreadIdRef.current) {
      markMessageListRead({
        maxId
      });
    }
    if (mentionIds.length) {
      markMentionsRead({
        chatId,
        messageIds: mentionIds
      });
    }
    if (reactionIds.length) {
      animateUnreadReaction({
        messageIds: reactionIds
      });
    }
    if (viewportPinnedIdsToAdd.length || viewportPinnedIdsToRemove.length) {
      onIntersectPinnedMessage({
        viewportPinnedIdsToAdd,
        viewportPinnedIdsToRemove
      });
    }
    if (scheduledToUpdateViews.length) {
      scheduleForViewsIncrement({
        chatId,
        ids: scheduledToUpdateViews
      });
    }
  });
  (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_4__["default"])(freezeForReading, unfreezeForReading);
  const {
    observe: observeIntersectionForLoading
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE_FOR_MEDIA,
    margin: INTERSECTION_MARGIN_FOR_LOADING
  });
  const {
    observe: observeIntersectionForPlaying
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE_FOR_MEDIA
  });
  return {
    observeIntersectionForReading,
    observeIntersectionForLoading,
    observeIntersectionForPlaying
  };
}

/***/ },

/***/ "./src/components/middle/hooks/usePinnedMessage.ts"
/*!*********************************************************!*\
  !*** ./src/components/middle/hooks/usePinnedMessage.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePinnedMessage)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_cycleRestrict__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/cycleRestrict */ "./src/util/cycleRestrict.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");







let viewportPinnedIds;
let lastFocusedId;
function usePinnedMessage(chatId, threadId, pinnedIds) {
  const [getPinnedIndexByKey, setPinnedIndexByKey] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)({});
  const [getLoadingPinnedId, setLoadingPinnedId] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)();
  const key = chatId ? `${chatId}_${threadId}` : undefined;
  const getCurrentPinnedIndex = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_5__["default"])(() => getPinnedIndexByKey()[key] ?? 0, [getPinnedIndexByKey, key]);

  // Reset when switching chat
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    viewportPinnedIds = undefined;
    setLoadingPinnedId(undefined);
  }, [chatId, setPinnedIndexByKey, setLoadingPinnedId, threadId]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!key) return;
    const currentPinnedIndex = getPinnedIndexByKey()[key];
    const pinnedLength = pinnedIds?.length || 0;
    if (currentPinnedIndex >= pinnedLength) {
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: clampIndex(pinnedLength - 1)
      });
    }
  }, [getPinnedIndexByKey, key, pinnedIds?.length, setPinnedIndexByKey]);
  const handleIntersectPinnedMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(({
    viewportPinnedIdsToAdd = [],
    viewportPinnedIdsToRemove = [],
    shouldCancelWaiting
  }) => {
    if (!chatId || !threadId || !key || !pinnedIds?.length) return;
    if (shouldCancelWaiting) {
      lastFocusedId = undefined;
      setLoadingPinnedId(undefined);
      return;
    }
    const loadingPinnedId = getLoadingPinnedId();
    if (loadingPinnedId) {
      const newPinnedIndex = pinnedIds.indexOf(loadingPinnedId);
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: clampIndex(newPinnedIndex)
      });
      setLoadingPinnedId(undefined);
    }
    viewportPinnedIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)((viewportPinnedIds?.filter(id => !viewportPinnedIdsToRemove.includes(id)) ?? []).concat(viewportPinnedIdsToAdd));

    // Sometimes this callback is called after focus has been reset in global, so we leverage `lastFocusedId`
    const focusedMessageId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectFocusedMessageId)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), chatId) || lastFocusedId;
    if (lastFocusedId && viewportPinnedIds.includes(lastFocusedId)) {
      lastFocusedId = undefined;
    }
    if (focusedMessageId) {
      const pinnedIndexAboveFocused = pinnedIds.findIndex(id => id < focusedMessageId);
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: clampIndex(pinnedIndexAboveFocused)
      });
    } else if (viewportPinnedIds.length) {
      const maxViewportPinnedId = Math.max(...viewportPinnedIds);
      const newIndex = pinnedIds.indexOf(maxViewportPinnedId);
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: clampIndex(newIndex)
      });
    }
  });
  const handleFocusPinnedMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(messageId => {
    // Focusing on a post in comments
    if (!chatId || !threadId || !pinnedIds?.length) {
      return;
    }
    lastFocusedId = messageId;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const listedIds = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectListedIds)(global, chatId, threadId);
    const isMessageLoaded = listedIds?.includes(messageId) || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectOutlyingListByMessageId)(global, chatId, threadId, messageId);
    const currentIndex = pinnedIds.indexOf(messageId);
    const newIndex = (0,_util_cycleRestrict__WEBPACK_IMPORTED_MODULE_3__["default"])(pinnedIds.length, currentIndex + 1);
    if (isMessageLoaded) {
      setPinnedIndexByKey({
        ...getPinnedIndexByKey(),
        [key]: newIndex
      });
    } else {
      setLoadingPinnedId(pinnedIds[newIndex]);
    }
  });
  return {
    handleIntersectPinnedMessage,
    handleFocusPinnedMessage,
    getCurrentPinnedIndex,
    getLoadingPinnedId
  };
}
function clampIndex(id) {
  return Math.max(0, id);
}

/***/ },

/***/ "./src/components/middle/hooks/useScrollHooks.ts"
/*!*******************************************************!*\
  !*** ./src/components/middle/hooks/useScrollHooks.ts ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useScrollHooks)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useSignalEffect__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useSignalEffect */ "./src/hooks/useSignalEffect.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");











const FAB_THRESHOLD = 50;
const NOTCH_THRESHOLD = 1; // Notch has zero height so we at least need a 1px margin to intersect
const CONTAINER_HEIGHT_DEBOUNCE = 200;
const TOOLS_FREEZE_TIMEOUT = 350; // Approximate message sending animation duration

function useScrollHooks(type, containerRef, messageIds, getContainerHeight, isViewportNewest, isUnread, onScrollDownToggle, onNotchToggle, isReady) {
  const {
    loadViewportMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [loadMoreBackwards, loadMoreForwards] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => type === 'thread' ? [(0,_util_schedulers__WEBPACK_IMPORTED_MODULE_5__.debounce)(() => loadViewportMessages({
    direction: _types__WEBPACK_IMPORTED_MODULE_2__.LoadMoreDirection.Backwards
  }), 1000, true, false), (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_5__.debounce)(() => loadViewportMessages({
    direction: _types__WEBPACK_IMPORTED_MODULE_2__.LoadMoreDirection.Forwards
  }), 1000, true, false)] : [],
  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  [loadViewportMessages, messageIds]);
  const backwardsTriggerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const forwardsTriggerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const fabTriggerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const toggleScrollTools = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!isReady) return;
    if (!messageIds?.length) {
      onScrollDownToggle(false);
      onNotchToggle(false);
      return;
    }
    if (!isViewportNewest) {
      onScrollDownToggle(true);
      onNotchToggle(true);
      return;
    }
    const container = containerRef.current;
    const fabTrigger = fabTriggerRef.current;
    if (!container || !fabTrigger) return;
    const {
      offsetHeight,
      scrollHeight,
      scrollTop
    } = container;
    const fabOffsetTop = fabTrigger.offsetTop;
    const scrollBottom = Math.round(fabOffsetTop - scrollTop - offsetHeight);
    const isNearBottom = scrollBottom <= FAB_THRESHOLD;
    const isAtBottom = scrollBottom <= NOTCH_THRESHOLD;
    if (scrollHeight === 0) return;
    onScrollDownToggle(isUnread ? !isAtBottom : !isNearBottom);
    onNotchToggle(!isAtBottom);
  });
  const {
    observe: observeIntersectionForHistory
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useIntersectionObserver)({
    rootRef: containerRef,
    margin: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.MESSAGE_LIST_SENSITIVE_AREA
  }, entries => {
    if (!loadMoreForwards || !loadMoreBackwards) {
      return;
    }
    entries.forEach(({
      isIntersecting,
      target
    }) => {
      if (!isIntersecting) return;
      if (target.className === 'backwards-trigger') {
        loadMoreBackwards();
      }
      if (target.className === 'forwards-trigger') {
        loadMoreForwards();
      }
    });
  });
  const withHistoryTriggers = messageIds && messageIds.length > 1;
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useOnIntersect)(backwardsTriggerRef, withHistoryTriggers ? observeIntersectionForHistory : undefined);
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useOnIntersect)(forwardsTriggerRef, withHistoryTriggers ? observeIntersectionForHistory : undefined);
  const {
    observe: observeIntersectionForFab,
    freeze: freezeForFab,
    unfreeze: unfreezeForFab
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useIntersectionObserver)({
    rootRef: containerRef,
    margin: FAB_THRESHOLD * 2,
    throttleScheduler: _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMeasure
  }, toggleScrollTools);
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useOnIntersect)(fabTriggerRef, observeIntersectionForFab);
  const {
    observe: observeIntersectionForNotch,
    freeze: freezeForNotch,
    unfreeze: unfreezeForNotch
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useIntersectionObserver)({
    rootRef: containerRef,
    margin: NOTCH_THRESHOLD,
    throttleScheduler: _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMeasure
  }, toggleScrollTools);
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useOnIntersect)(fabTriggerRef, observeIntersectionForNotch);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isReady) {
      toggleScrollTools();
    }
  }, [isReady, toggleScrollTools]);
  const freezeShortly = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    freezeForFab();
    freezeForNotch();
    setTimeout(() => {
      unfreezeForNotch();
      unfreezeForFab();
    }, TOOLS_FREEZE_TIMEOUT);
  });

  // Workaround for FAB and notch flickering with tall incoming message
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_10__["default"])(freezeShortly, [freezeShortly, messageIds]);

  // Workaround for notch flickering when opening Composer Embedded Message
  const getContainerHeightDebounced = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_6__.useDebouncedSignal)(getContainerHeight, CONTAINER_HEIGHT_DEBOUNCE);
  (0,_hooks_useSignalEffect__WEBPACK_IMPORTED_MODULE_9__.useSignalEffect)(freezeShortly, [freezeShortly, getContainerHeightDebounced]);
  return {
    withHistoryTriggers,
    backwardsTriggerRef,
    forwardsTriggerRef,
    fabTriggerRef
  };
}

/***/ },

/***/ "./src/components/middle/hooks/useStickyDates.ts"
/*!*******************************************************!*\
  !*** ./src/components/middle/hooks/useStickyDates.ts ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useStickyDates)
/* harmony export */ });
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useRunDebounced */ "./src/hooks/useRunDebounced.ts");




const DEBOUNCE = 1000;
const STICKY_TOP = 10;
function useStickyDates() {
  // For some reason we can not synchronously hide a sticky element (from `useLayoutEffect`) when chat opens
  // so we will add `position: sticky` only after first scroll. There would be no animation on the first show though.
  const [isScrolled, markIsScrolled] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_1__["default"])(false);
  const runDebounced = (0,_hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_3__["default"])(DEBOUNCE, true);
  const updateStickyDates = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(container => {
    markIsScrolled();
    if (!document.body.classList.contains('is-scrolling-messages')) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMutation)(() => {
        document.body.classList.add('is-scrolling-messages');
      });
    }
    runDebounced(() => {
      const stuckDateEl = findStuckDate(container);
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMutation)(() => {
        const currentStuck = document.querySelector('.stuck');
        if (currentStuck) {
          currentStuck.classList.remove('stuck');
        }
        if (stuckDateEl) {
          stuckDateEl.classList.add('stuck');
        }
        document.body.classList.remove('is-scrolling-messages');
      });
    });
  });
  return {
    isScrolled,
    updateStickyDates
  };
}
function findStuckDate(container) {
  const allElements = container.querySelectorAll('.sticky-date');
  const containerTop = container.scrollTop;
  const computedStyle = getComputedStyle(container);
  const headerActionsHeight = parseInt(computedStyle.getPropertyValue('--middle-header-panes-height'), 10);
  return Array.from(allElements).find(el => {
    const {
      offsetTop,
      offsetHeight
    } = el;
    const top = offsetTop - containerTop;
    return -offsetHeight <= top && top <= headerActionsHeight + STICKY_TOP;
  });
}

/***/ },

/***/ "./src/components/middle/message/SenderGroupAvatar.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/message/SenderGroupAvatar.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _right_userPortrait_UserPortraitBasicCardMenu__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../right/userPortrait/UserPortraitBasicCardMenu */ "./src/components/right/userPortrait/UserPortraitBasicCardMenu.tsx");
/* harmony import */ var _ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../ui/ResponsiveHoverButton */ "./src/components/ui/ResponsiveHoverButton.tsx");
/* harmony import */ var _SenderGroupContainer_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./SenderGroupContainer.module.scss */ "./src/components/middle/message/SenderGroupContainer.module.scss");










const SenderGroupAvatar = ({
  avatarPeer,
  forwardInfo,
  handleAvatarClick
}) => {
  const {
    openUserPortrait
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const hiddenName = !avatarPeer && forwardInfo ? forwardInfo.hiddenUserName : undefined;
  const [isSymbolMenuOpen, openSymbolMenu, closeSymbolMenu] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const [contextMenuAnchor, setContextMenuAnchor] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const triggerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const menuRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const getTriggerElement = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => ref.current, []);
  const getMenuElement = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => menuRef.current, []);
  const getRootElement = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => ref.current.closest('.custom-scroll, .no-scrollbar'), []);
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => ({
    withPortal: true,
    shouldAvoidNegativePosition: true
  }));
  const handleActivateSymbolMenu = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    openSymbolMenu();
    const triggerEl = triggerRef.current;
    if (!triggerEl) return;
    const {
      x,
      y
    } = triggerEl.getBoundingClientRect();
    setContextMenuAnchor({
      x,
      y
    });
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "inline-block",
    ref: ref
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_7__["default"], {
    round: true,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('!p-0 !w-auto !h-auto'),
    color: "translucent",
    onActivate: handleActivateSymbolMenu
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: triggerRef,
    className: "symbol-menu-trigger"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_5__["default"], {
    size: "small",
    className: _SenderGroupContainer_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].senderAvatar,
    peer: avatarPeer,
    text: hiddenName,
    onClick: avatarPeer ? handleAvatarClick : undefined
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_right_userPortrait_UserPortraitBasicCardMenu__WEBPACK_IMPORTED_MODULE_6__.UserPortraitBasicCardMenu, {
    isOpen: isSymbolMenuOpen,
    onClose: closeSymbolMenu,
    userId: avatarPeer?.id,
    anchor: contextMenuAnchor,
    menuRef: menuRef,
    getTriggerElement: getTriggerElement,
    getMenuElement: getMenuElement,
    getRootElement: getRootElement,
    getLayout: getLayout
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SenderGroupAvatar);

/***/ },

/***/ "./src/components/middle/message/SenderGroupContainer.module.scss"
/*!************************************************************************!*\
  !*** ./src/components/middle/message/SenderGroupContainer.module.scss ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Tk8btfOT","avatarContainer":"UPrRM3Ks","senderAvatar":"jdvqXfYh","contextMenu":"FHxnbOg6"});

/***/ },

/***/ "./src/components/middle/message/SenderGroupContainer.tsx"
/*!****************************************************************!*\
  !*** ./src/components/middle/message/SenderGroupContainer.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _SenderGroupContainer_module_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./SenderGroupContainer.module.scss */ "./src/components/middle/message/SenderGroupContainer.module.scss");
/* harmony import */ var _SenderGroupAvatar__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./SenderGroupAvatar */ "./src/components/middle/message/SenderGroupAvatar.tsx");


















const SenderGroupContainer = ({
  message,
  withAvatar,
  children,
  id,
  appearanceOrder,
  sender,
  canShowSender,
  originSender,
  isChatWithSelf,
  isRepliesChat,
  isAnonymousForwards,
  canPost
}) => {
  const {
    openChat,
    updateInsertingPeerIdMention
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    forwardInfo
  } = message;
  const messageSender = canShowSender ? sender : undefined;
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const noAppearanceAnimation = appearanceOrder <= 0;
  const [isShown, markShown] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(noAppearanceAnimation);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (noAppearanceAnimation) {
      return;
    }
    setTimeout(markShown, appearanceOrder * _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_APPEARANCE_DELAY);
  }, [appearanceOrder, markShown, noAppearanceAnimation]);
  const shouldPreferOriginSender = forwardInfo && (isChatWithSelf || isRepliesChat || isAnonymousForwards || !messageSender);
  const avatarPeer = shouldPreferOriginSender ? originSender : messageSender;
  const isAvatarPeerUser = avatarPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerUser)(avatarPeer);
  const handleOpenChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    if (!avatarPeer) {
      return;
    }
    openChat({
      id: avatarPeer.id
    });
  });
  const handleMention = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    if (!avatarPeer) {
      return;
    }
    const messageInput = document.querySelector(_config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_CSS_SELECTOR);
    if (messageInput) {
      updateInsertingPeerIdMention({
        peerId: avatarPeer.id
      });
    }
  });
  const handleAvatarClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    handleOpenChat();
  });
  const {
    ref: avatarRef,
    shouldRender
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_11__["default"])({
    isOpen: withAvatar && isShown,
    noMountTransition: isShown,
    withShouldRender: true
  });
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_7__["default"])(avatarRef);
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => avatarRef.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => document.querySelector('.Transition_slide-active > .MessageList'));
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => avatarRef?.current?.querySelector(`.${_SenderGroupContainer_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].contextMenu} .bubble`));
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => ({
    withPortal: true
  }));
  const canMention = canPost && avatarPeer && (isAvatarPeerUser || Boolean((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMainUsername)(avatarPeer)));
  const shouldRenderContextMenu = Boolean(contextMenuAnchor) && (isAvatarPeerUser || canMention);
  function renderContextMenu() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_13__["default"], {
      isOpen: isContextMenuOpen,
      anchor: contextMenuAnchor,
      getTriggerElement: getTriggerElement,
      getRootElement: getRootElement,
      getLayout: getLayout,
      getMenuElement: getMenuElement,
      className: _SenderGroupContainer_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].contextMenu,
      onClose: handleContextMenuClose,
      onCloseAnimationEnd: handleContextMenuHide,
      withPortal: true,
      autoClose: true
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, isAvatarPeerUser && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
      icon: "comments",
      onClick: handleOpenChat
    }, lang('SendMessage')), canMention && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
      icon: "mention",
      onClick: handleMention
    }, lang('ContextMenuItemMention'))));
  }
  function renderAvatar() {
    const hiddenName = !avatarPeer && forwardInfo ? forwardInfo.hiddenUserName : undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_12__["default"], {
      size: "small",
      className: _SenderGroupContainer_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].senderAvatar,
      peer: avatarPeer,
      text: hiddenName,
      onClick: avatarPeer ? handleAvatarClick : undefined,
      onContextMenu: handleContextMenu
    });
  }
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('sender-group-container', _SenderGroupContainer_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].root);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: id,
    className: className
  }, shouldRender && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: avatarRef,
    className: _SenderGroupContainer_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].avatarContainer
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SenderGroupAvatar__WEBPACK_IMPORTED_MODULE_16__["default"], {
    handleAvatarClick: handleAvatarClick,
    avatarPeer: avatarPeer,
    forwardInfo: forwardInfo
  }), shouldRenderContextMenu && renderContextMenu()), children);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, ownProps) => {
  const {
    message,
    withAvatar
  } = ownProps;
  const {
    chatId
  } = message;
  const isChatWithSelf = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsChatWithSelf)(global, chatId);
  const isSystemBotChat = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isSystemBot)(chatId);
  const isAnonymousForwards = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isAnonymousForwardsChat)(chatId);
  const forceSenderName = !isChatWithSelf && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isAnonymousOwnMessage)(message);
  const canShowSender = withAvatar || forceSenderName;
  const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectSender)(global, message);
  const originSender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectForwardedSender)(global, message);
  return {
    sender,
    canShowSender,
    originSender,
    isChatWithSelf,
    isRepliesChat: isSystemBotChat,
    isAnonymousForwards
  };
})(SenderGroupContainer)));

/***/ },

/***/ "./src/components/middle/message/SponsoredContextMenuContainer.async.tsx"
/*!*******************************************************************************!*\
  !*** ./src/components/middle/message/SponsoredContextMenuContainer.async.tsx ***!
  \*******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SponsoredContextMenuContainerAsync = props => {
  const {
    isOpen
  } = props;
  const SponsoredContextMenuContainer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SponsoredContextMenuContainer', !isOpen);
  return SponsoredContextMenuContainer ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SponsoredContextMenuContainer, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SponsoredContextMenuContainerAsync);

/***/ },

/***/ "./src/components/middle/message/SponsoredMessage.scss"
/*!*************************************************************!*\
  !*** ./src/components/middle/message/SponsoredMessage.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/SponsoredMessage.tsx"
/*!************************************************************!*\
  !*** ./src/components/middle/message/SponsoredMessage.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_media__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/middle/message/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_BadgeButton__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/BadgeButton */ "./src/components/common/BadgeButton.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _MessageAppendix__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./MessageAppendix */ "./src/components/middle/message/MessageAppendix.tsx");
/* harmony import */ var _Photo__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./Photo */ "./src/components/middle/message/Photo.tsx");
/* harmony import */ var _SponsoredContextMenuContainer_async__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./SponsoredContextMenuContainer.async */ "./src/components/middle/message/SponsoredContextMenuContainer.async.tsx");
/* harmony import */ var _Video__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./Video */ "./src/components/middle/message/Video.tsx");
/* harmony import */ var _SponsoredMessage_scss__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./SponsoredMessage.scss */ "./src/components/middle/message/SponsoredMessage.scss");



























const INTERSECTION_DEBOUNCE_MS = 200;
const SponsoredMessage = ({
  chatId,
  message,
  containerRef,
  theme,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  isDownloading,
  canAutoLoadMedia,
  canAutoPlayMedia
}) => {
  const {
    viewSponsored,
    openUrl,
    hideSponsored,
    clickSponsored,
    openMediaViewer,
    openAboutAdsModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const contentRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const shouldObserve = Boolean(message);
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const {
    observe: observeIntersection
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_13__.useIntersectionObserver)({
    rootRef: containerRef,
    debounceMs: INTERSECTION_DEBOUNCE_MS,
    threshold: 1
  });
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_12__["default"])(ref, undefined, true, _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_ANDROID);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return shouldObserve ? observeIntersection(contentRef.current, target => {
      if (target.isIntersecting && message?.randomId) {
        viewSponsored({
          randomId: message.randomId
        });
      }
    }) : undefined;
  }, [message?.randomId, shouldObserve, observeIntersection, viewSponsored]);
  const handleMouseDown = e => {
    (0,_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_9__.preventMessageInputBlur)(e);
    handleBeforeContextMenu(e);
  };
  const handleHideSponsoredMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    hideSponsored();
  });
  const {
    photo,
    video
  } = message ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageContent)(message) : {
    photo: undefined,
    video: undefined
  };
  const isGif = video?.isGif;
  const hasMedia = Boolean(photo || video);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!message) return;
    clickSponsored({
      randomId: message.randomId,
      isMedia: photo || isGif ? true : undefined
    });
    openUrl({
      url: message.url,
      shouldSkipModal: true
    });
  });
  const handleOpenMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!message) return;
    clickSponsored({
      randomId: message.randomId,
      isMedia: true
    });
    openMediaViewer({
      origin: _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.SponsoredMessage,
      chatId,
      isSponsoredMessage: true
    });
  });
  const handleOpenAboutAdsModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!message) return;
    openAboutAdsModal({
      randomId: message.randomId,
      canReport: message.canReport,
      additionalInfo: message.additionalInfo,
      sponsorInfo: message.sponsorInfo
    });
  });
  const extraPadding = 0;
  const sizeCalculations = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    let calculatedWidth;
    let contentWidth;
    const noMediaCorners = false;
    let style = '';
    if (photo || video) {
      let width;
      if (photo) {
        width = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__.calculateMediaDimensions)({
          media: photo,
          isMobile
        }).width;
      } else if (video) {
        width = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__.calculateMediaDimensions)({
          media: video,
          isMobile
        }).width;
      }
      if (width) {
        if (width < _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__.MIN_MEDIA_WIDTH_WITH_TEXT) {
          contentWidth = width;
        }
        calculatedWidth = Math.max((0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__.getMinMediaWidth)(), width);
      }
    }
    if (calculatedWidth) {
      style = `width: ${calculatedWidth + extraPadding}px`;
    }
    return {
      contentWidth,
      noMediaCorners,
      style
    };
  }, [photo, video, isMobile]);
  const {
    contentWidth,
    style
  } = sizeCalculations;
  if (!message || !message.content) {
    return undefined;
  }
  function renderContent() {
    if (!message) return undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-title message-peer",
      dir: "auto"
    }, message.title), Boolean(message.content?.text) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-content with-meta",
      dir: "auto",
      ref: contentRef
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "text-content-inner",
      dir: "auto"
    }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_8__.renderTextWithEntities)({
      text: message.content.text.text,
      entities: message.content.text.entities
    }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_20__["default"], {
      className: "SponsoredMessage__button",
      size: "tiny",
      color: "translucent",
      isRectangular: true,
      onClick: handleClick
    }, message.buttonText));
  }
  function renderMediaContent() {
    if (!message) return undefined;
    if (photo) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Photo__WEBPACK_IMPORTED_MODULE_22__["default"], {
        photo: photo,
        theme: theme,
        canAutoLoad: canAutoLoadMedia,
        isDownloading: isDownloading,
        observeIntersection: observeIntersectionForLoading,
        noAvatars: true,
        onClick: handleClick,
        forcedWidth: contentWidth
      });
    }
    if (video) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Video__WEBPACK_IMPORTED_MODULE_24__["default"], {
        video: video,
        observeIntersectionForLoading: observeIntersectionForLoading,
        observeIntersectionForPlaying: observeIntersectionForPlaying,
        noAvatars: true,
        canAutoLoad: canAutoLoadMedia,
        canAutoPlay: canAutoPlayMedia,
        isDownloading: isDownloading,
        onClick: isGif ? handleClick : handleOpenMedia,
        forcedWidth: contentWidth
      });
    }
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    key: "sponsored-message",
    className: "SponsoredMessage Message open sponsored-media-preview"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-content media has-shadow has-solid-background has-appendix",
    dir: "auto",
    style: style,
    onMouseDown: handleMouseDown,
    onContextMenu: handleContextMenu
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_19__["default"], {
    peerColor: message.peerColor,
    className: "content-inner",
    dir: "auto"
  }, renderMediaContent(), message.photo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_16__["default"], {
    size: "large",
    photo: message.photo,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('channel-avatar', lang.isRtl && 'is-rtl')
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('message-title message-type', hasMedia && 'has-media')
  }, message.isRecommended ? lang('Message.RecommendedLabel') : lang('SponsoredMessage'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_17__["default"], {
    onClick: handleOpenAboutAdsModal,
    className: "ad-about"
  }, lang('SponsoredMessageAdWhatIsThis'))), renderContent()), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageAppendix__WEBPACK_IMPORTED_MODULE_21__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-action-buttons"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_20__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: lang('Close'),
    onClick: handleHideSponsoredMessage
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_18__["default"], {
    name: "close",
    className: "sponsored-action-icon"
  })), message.canReport && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_20__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: lang('More'),
    onClick: handleContextMenu,
    onContextMenu: handleContextMenu
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_18__["default"], {
    name: "more",
    className: "sponsored-action-icon"
  })))), contextMenuAnchor && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SponsoredContextMenuContainer_async__WEBPACK_IMPORTED_MODULE_23__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuAnchor,
    triggerRef: ref,
    randomId: message.randomId,
    canReport: message.canReport,
    sponsorInfo: message.sponsorInfo,
    additionalInfo: message.additionalInfo,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const message = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectSponsoredMessage)(global, chatId);
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectActiveDownloads)(global);
  const downloadableMedia = message ? (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_5__.selectMessageDownloadableMedia)(global, message) : undefined;
  const isDownloading = downloadableMedia && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getIsDownloading)(activeDownloads, downloadableMedia);
  return {
    message,
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTheme)(global),
    isDownloading,
    canAutoLoadMedia: message ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanAutoLoadMedia)(global, message) : undefined,
    canAutoPlayMedia: message ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanAutoPlayMedia)(global, message) : undefined
  };
})(SponsoredMessage)));

/***/ },

/***/ "./src/components/middle/message/reactions/ReactionPicker.async.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/middle/message/reactions/ReactionPicker.async.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReactionPickerAsync = props => {
  const {
    isOpen
  } = props;
  const ReactionPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReactionPicker', !isOpen);
  return ReactionPicker ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReactionPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReactionPickerAsync);

/***/ },

/***/ "./src/components/middle/panes/AudioPlayer.scss"
/*!******************************************************!*\
  !*** ./src/components/middle/panes/AudioPlayer.scss ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/panes/AudioPlayer.tsx"
/*!*****************************************************!*\
  !*** ./src/components/middle/panes/AudioPlayer.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_media__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _util_audioPlayer__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/audioPlayer */ "./src/util/audioPlayer.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_mediaSession__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/mediaSession */ "./src/util/mediaSession.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useAudioPlayer__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useAudioPlayer */ "./src/hooks/useAudioPlayer.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMessageMediaMetadata__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/useMessageMediaMetadata */ "./src/hooks/useMessageMediaMetadata.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_RangeSlider__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../ui/RangeSlider */ "./src/components/ui/RangeSlider.tsx");
/* harmony import */ var _ui_RippleEffect__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../ui/RippleEffect */ "./src/components/ui/RippleEffect.tsx");
/* harmony import */ var _AudioPlayer_scss__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./AudioPlayer.scss */ "./src/components/middle/panes/AudioPlayer.scss");































const PLAYBACK_RATES = {
  0.5: 0.66,
  0.75: 0.8,
  1: 1,
  1.5: 1.4,
  2: 1.8
};
const PLAYBACK_RATE_VALUES = Object.keys(PLAYBACK_RATES).sort().map(Number);
const REGULAR_PLAYBACK_RATE = 1;
const DEFAULT_FAST_PLAYBACK_RATE = 2;
const AudioPlayer = ({
  message,
  mediaDuration,
  className,
  noUi,
  sender,
  chat,
  volume,
  playbackRate,
  isPlaybackRateActive,
  isMuted,
  isFullWidth,
  timestamp,
  onPaneStateChange
}) => {
  const {
    setAudioPlayerVolume,
    setAudioPlayerPlaybackRate,
    setAudioPlayerMuted,
    focusMessage,
    closeAudioPlayer
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_20__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const renderingMessage = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_17__["default"])(message);
  const {
    audio,
    voice,
    video
  } = renderingMessage ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageContent)(renderingMessage) : {};
  const isVoice = Boolean(voice || video);
  const shouldRenderPlaybackButton = isVoice || (audio?.duration || 0) > _config__WEBPACK_IMPORTED_MODULE_2__.PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION;
  const senderName = sender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, sender) : undefined;
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_13__["default"])(renderingMessage, 'inline');
  const mediaData = mediaHash && _util_mediaLoader__WEBPACK_IMPORTED_MODULE_10__.getFromMemory(mediaHash);
  const mediaMetadata = (0,_hooks_useMessageMediaMetadata__WEBPACK_IMPORTED_MODULE_19__["default"])(renderingMessage, sender, chat);
  const {
    playPause,
    stop,
    isPlaying,
    requestNextTrack,
    requestPreviousTrack,
    isFirst,
    isLast,
    setVolume,
    toggleMuted,
    setPlaybackRate,
    setCurrentTime
  } = (0,_hooks_useAudioPlayer__WEBPACK_IMPORTED_MODULE_15__["default"])(message && (0,_util_audioPlayer__WEBPACK_IMPORTED_MODULE_7__.makeTrackId)(message), mediaDuration || 0, isVoice ? 'voice' : 'audio', mediaData, undefined, mediaMetadata, undefined, true, undefined, undefined, message && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isMessageLocal)(message), true);
  const isOpen = Boolean(message);
  const {
    ref: transitionRef
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_21__["default"])({
    isOpen,
    shouldForceOpen: isFullWidth // Use pane animation instead
  });
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_22__["default"])({
    isOpen,
    isDisabled: !isFullWidth,
    ref: transitionRef,
    onStateChange: onPaneStateChange
  });
  const {
    isContextMenuOpen,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_16__["default"])(transitionRef, !shouldRender);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (timestamp) {
      setCurrentTime(timestamp);
    }
  }, [timestamp, setCurrentTime]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    const {
      chatId,
      id
    } = renderingMessage;
    focusMessage({
      chatId,
      messageId: id
    });
  });
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    if (!stop) {
      return;
    }
    if (isPlaying) {
      playPause();
    }
    closeAudioPlayer();
    (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_11__.clearMediaSession)();
    stop();
  });
  const handleVolumeChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(value => {
    if (!setVolume) {
      return;
    }
    setAudioPlayerVolume({
      volume: value / 100
    });
    setVolume(value / 100);
  });
  const handleVolumeClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_TOUCH_ENV && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_IOS) return;
    if (!toggleMuted) {
      return;
    }
    toggleMuted();
    setAudioPlayerMuted({
      isMuted: !isMuted
    });
  });
  const updatePlaybackRate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])((newRate, isActive = true) => {
    if (!setPlaybackRate) {
      return;
    }
    const rate = PLAYBACK_RATES[newRate];
    const shouldBeActive = newRate !== REGULAR_PLAYBACK_RATE && isActive;
    setAudioPlayerPlaybackRate({
      playbackRate: rate,
      isPlaybackRateActive: shouldBeActive
    });
    setPlaybackRate(shouldBeActive ? rate : REGULAR_PLAYBACK_RATE);
  });
  const handlePlaybackClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    handleContextMenuClose();
    const oldRate = Number(Object.entries(PLAYBACK_RATES).find(([, rate]) => rate === playbackRate)?.[0]) || REGULAR_PLAYBACK_RATE;
    const newIsActive = !isPlaybackRateActive;
    updatePlaybackRate(newIsActive && oldRate === REGULAR_PLAYBACK_RATE ? DEFAULT_FAST_PLAYBACK_RATE : oldRate, newIsActive);
  });
  const PlaybackRateButton = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    const displayRate = Object.entries(PLAYBACK_RATES).find(([, rate]) => rate === playbackRate)?.[0] || REGULAR_PLAYBACK_RATE;
    const text = `${playbackRate === REGULAR_PLAYBACK_RATE ? DEFAULT_FAST_PLAYBACK_RATE : displayRate}`;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "playback-wrapper"
    }, isContextMenuOpen && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "playback-backdrop",
      onClick: handleContextMenuClose
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
      round: true,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('playback-button', isPlaybackRateActive && 'applied', isContextMenuOpen && 'on-top'),
      color: "translucent",
      size: "smaller",
      ariaLabel: "Playback Rate",
      ripple: !isMobile,
      onMouseEnter: handleContextMenu,
      onClick: handlePlaybackClick,
      onMouseDown: handleBeforeContextMenu,
      onContextMenu: handleContextMenu
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('playback-button-inner', text.length === 4 && 'small', text.length === 5 && 'tiny')
    }, text)));
  });
  const volumeIcon = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (volume === 0 || isMuted) return 'muted';
    if (volume < 0.3) return 'volume-1';
    if (volume < 0.6) return 'volume-2';
    return 'volume-3';
  }, [volume, isMuted]);
  if (noUi || !shouldRender) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('AudioPlayer', isFullWidth ? 'full-width-player' : 'mini-player min-desktop', className),
    dir: lang.isRtl ? 'rtl' : undefined,
    ref: ref
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "AudioPlayer-content",
    onClick: handleClick
  }, audio ? renderAudio(audio) : renderVoice(lang('AttachAudio'), senderName), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RippleEffect__WEBPACK_IMPORTED_MODULE_28__["default"], null)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    round: true,
    ripple: !isMobile,
    color: "translucent",
    size: "smaller",
    className: "player-button",
    disabled: isFirst?.(),
    onClick: requestPreviousTrack,
    ariaLabel: "Previous track"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
    name: "skip-previous"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    round: true,
    ripple: !isMobile,
    color: "translucent",
    size: "smaller",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_9__["default"])('toggle-play', 'player-button', isPlaying ? 'pause' : 'play'),
    onClick: playPause,
    ariaLabel: isPlaying ? 'Pause audio' : 'Play audio'
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
    name: "play"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
    name: "pause"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    round: true,
    ripple: !isMobile,
    color: "translucent",
    size: "smaller",
    className: "player-button",
    disabled: isLast?.(),
    onClick: requestNextTrack,
    ariaLabel: "Next track"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
    name: "skip-next"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "volume-button-wrapper"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    round: true,
    className: "player-button volume-button",
    color: "translucent",
    size: "smaller",
    ariaLabel: "Volume",
    onClick: handleVolumeClick,
    ripple: !isMobile
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
    name: volumeIcon
  })), !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_IOS && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "volume-slider-wrapper"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "volume-slider-spacer"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "volume-slider"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RangeSlider__WEBPACK_IMPORTED_MODULE_27__["default"], {
    bold: true,
    value: isMuted ? 0 : volume * 100,
    onChange: handleVolumeChange
  })))), shouldRenderPlaybackButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_25__["default"], {
    forceOpen: isContextMenuOpen,
    positionX: "right",
    positionY: "top",
    className: "playback-rate-menu",
    trigger: PlaybackRateButton,
    onClose: handleContextMenuClose,
    onHide: handleContextMenuHide,
    onMouseEnterBackdrop: handleContextMenuClose
  }, PLAYBACK_RATE_VALUES.map(rate => {
    return renderPlaybackRateMenuItem(rate, playbackRate, updatePlaybackRate, isPlaybackRateActive);
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    round: true,
    className: "player-close",
    color: "translucent",
    size: "smaller",
    onClick: handleClose,
    ariaLabel: "Close player"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
    name: "close"
  })));
};
function renderAudio(audio) {
  const {
    title,
    performer,
    fileName
  } = audio;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title",
    dir: "auto"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_12__["default"])(title || fileName)), performer && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "subtitle",
    dir: "auto"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_12__["default"])(performer)));
}
function renderVoice(subtitle, senderName) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title",
    dir: "auto"
  }, senderName && (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_12__["default"])(senderName)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "subtitle",
    dir: "auto"
  }, subtitle));
}
function renderPlaybackRateMenuItem(rate, currentRate, onClick, isPlaybackRateActive) {
  const isSelected = currentRate === PLAYBACK_RATES[rate] && isPlaybackRateActive || rate === REGULAR_PLAYBACK_RATE && !isPlaybackRateActive;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_26__["default"], {
    key: rate,
    onClick: () => onClick(rate),
    icon: isSelected ? 'check' : undefined,
    customIcon: !isSelected ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
      name: "placeholder"
    }) : undefined
  }, rate, "X");
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  isHidden
}) => {
  const {
    audioPlayer
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const {
    chatId,
    messageId
  } = audioPlayer;
  const message = !isHidden && chatId && messageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatMessage)(global, chatId, messageId) : undefined;
  const sender = message && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectSender)(global, message);
  const chat = message && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, message.chatId);
  const {
    volume,
    playbackRate,
    isMuted,
    isPlaybackRateActive,
    timestamp
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global).audioPlayer;
  const mediaDuration = message ? (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_6__.selectMessageMediaDuration)(global, message) : undefined;
  return {
    message,
    sender,
    chat,
    volume,
    playbackRate,
    isPlaybackRateActive,
    isMuted,
    timestamp,
    mediaDuration
  };
})(AudioPlayer));

/***/ },

/***/ "./src/components/middle/panes/BotAdPane.module.scss"
/*!***********************************************************!*\
  !*** ./src/components/middle/panes/BotAdPane.module.scss ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"yMkfzjus","content":"__w9Ejd3","info":"wdU19Be7","avatar":"AQFE1t4V","title":"u2vIptvT","text":"SVG6BaX3","aboutAd":"SrgXYpPk"});

/***/ },

/***/ "./src/components/middle/panes/BotAdPane.tsx"
/*!***************************************************!*\
  !*** ./src/components/middle/panes/BotAdPane.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_peerColor__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/peerColor */ "./src/components/common/helpers/peerColor.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_BadgeButton__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/BadgeButton */ "./src/components/common/BadgeButton.tsx");
/* harmony import */ var _message_SponsoredContextMenuContainer__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../message/SponsoredContextMenuContainer */ "./src/components/middle/message/SponsoredContextMenuContainer.tsx");
/* harmony import */ var _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./BotAdPane.module.scss */ "./src/components/middle/panes/BotAdPane.module.scss");
















const BotAdPane = ({
  chatId,
  isBot,
  messageListType,
  sponsoredMessage,
  onPaneStateChange
}) => {
  const {
    viewSponsored,
    openUrl,
    clickSponsored,
    openAboutAdsModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isOpen = Boolean(isBot && sponsoredMessage && messageListType === 'thread');
  const renderingSponsoredMessage = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__["default"])(sponsoredMessage);
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__["default"])({
    isOpen,
    withResizeObserver: true,
    onStateChange: onPaneStateChange
  });
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_6__["default"])(ref, !shouldRender, true);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (!renderingSponsoredMessage) return;
    clickSponsored({
      randomId: renderingSponsoredMessage.randomId
    });
    openUrl({
      url: renderingSponsoredMessage.url,
      shouldSkipModal: true
    });
  });
  const handleAboutClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    if (!renderingSponsoredMessage) return;
    const {
      randomId,
      additionalInfo,
      canReport,
      sponsorInfo
    } = renderingSponsoredMessage;
    e.stopPropagation();
    openAboutAdsModal({
      randomId,
      additionalInfo,
      canReport,
      sponsorInfo
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldRender && renderingSponsoredMessage) {
      viewSponsored({
        randomId: renderingSponsoredMessage.randomId
      });
    }
  }, [shouldRender, renderingSponsoredMessage, chatId]);
  if (!shouldRender || !renderingSponsoredMessage) {
    return undefined;
  }
  const {
    randomId,
    canReport,
    additionalInfo,
    sponsorInfo
  } = renderingSponsoredMessage;
  const {
    peerColor,
    content,
    photo,
    title
  } = renderingSponsoredMessage;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].root,
    onClick: handleClick,
    onMouseDown: handleBeforeContextMenu,
    onContextMenu: handleContextMenu
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].content, peerColor && (0,_common_helpers_peerColor__WEBPACK_IMPORTED_MODULE_4__.getApiPeerColorClass)(peerColor))
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].info
  }, lang('SponsoredMessageAd'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_12__["default"], {
    onClick: handleAboutClick,
    className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].aboutAd
  }, lang('SponsoredMessageAdWhatIsThis'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].title
  }, title), content.text && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].text
  }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_5__.renderTextWithEntities)({
    text: content.text.text,
    entities: content.text.entities
  }))), photo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
    size: "large",
    photo: photo,
    className: _BotAdPane_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].avatar
  })), contextMenuAnchor && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_message_SponsoredContextMenuContainer__WEBPACK_IMPORTED_MODULE_13__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuAnchor,
    triggerRef: ref,
    randomId: randomId,
    additionalInfo: additionalInfo,
    canReport: canReport,
    sponsorInfo: sponsorInfo,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const bot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectBot)(global, chatId);
  const sponsoredMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectSponsoredMessage)(global, chatId);
  return {
    isBot: Boolean(bot),
    sponsoredMessage
  };
})(BotAdPane)));

/***/ },

/***/ "./src/components/middle/panes/BotVerificationPane.module.scss"
/*!*********************************************************************!*\
  !*** ./src/components/middle/panes/BotVerificationPane.module.scss ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"sAWttcxl","icon":"tK9d2y8u"});

/***/ },

/***/ "./src/components/middle/panes/BotVerificationPane.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/panes/BotVerificationPane.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _BotVerificationPane_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./BotVerificationPane.module.scss */ "./src/components/middle/panes/BotVerificationPane.module.scss");









const BOT_VERIFICATION_ICON_SIZE = 16;
const DISPLAY_DURATION_MS = 5000; // 5 sec

const BotVerificationPane = ({
  peerId,
  wasShown,
  botVerification,
  onPaneStateChange
}) => {
  const isOpen = Boolean(!wasShown && botVerification);
  const {
    markBotVerificationInfoShown
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_5__["default"])({
    isOpen,
    onStateChange: onPaneStateChange
  });
  const markAsShowed = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    markBotVerificationInfoShown({
      peerId
    });
  });
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_3__["default"])(markAsShowed, !wasShown ? DISPLAY_DURATION_MS : undefined);
  if (!shouldRender || !botVerification) return undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: _BotVerificationPane_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _BotVerificationPane_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].icon
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_6__["default"], {
    documentId: botVerification.iconId,
    size: BOT_VERIFICATION_ICON_SIZE
  })), botVerification.description);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId
}) => {
  const peerFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeerFullInfo)(global, peerId);
  const botVerification = peerFullInfo?.botVerification;
  const wasShown = global.settings.botVerificationShownPeerIds.includes(peerId);
  return {
    botVerification,
    wasShown
  };
})(BotVerificationPane)));

/***/ },

/***/ "./src/components/middle/panes/ChatReportPane.scss"
/*!*********************************************************!*\
  !*** ./src/components/middle/panes/ChatReportPane.scss ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/panes/ChatReportPane.tsx"
/*!********************************************************!*\
  !*** ./src/components/middle/panes/ChatReportPane.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ChatReportPane_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./ChatReportPane.scss */ "./src/components/middle/panes/ChatReportPane.scss");

















const ChatReportPane = ({
  chatId,
  className,
  isAutoArchived,
  canReportSpam,
  canAddContact,
  canBlockContact,
  peer,
  currentUserId,
  onPaneStateChange
}) => {
  const {
    openAddContactDialog,
    blockUser,
    reportSpam,
    deleteChat,
    leaveChannel,
    deleteChatUser,
    deleteHistory,
    toggleChatArchived,
    hidePeerSettingsBar
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [isBlockUserModalOpen, openBlockUserModal, closeBlockUserModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const [shouldReportSpam, setShouldReportSpam] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [shouldDeleteChat, setShouldDeleteChat] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const renderingPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(peer);
  const chat = renderingPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerChat)(renderingPeer) ? renderingPeer : undefined;
  const user = renderingPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerUser)(renderingPeer) ? renderingPeer : undefined;
  const isBasicGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatBasicGroup)(chat);
  const renderingCanAddContact = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(canAddContact);
  const renderingCanBlockContact = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(canBlockContact);
  const renderingCanReportSpam = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(canReportSpam);
  const renderingIsAutoArchived = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_6__["default"])(isAutoArchived);
  const handleAddContact = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openAddContactDialog({
      userId: chatId
    });
    if (renderingIsAutoArchived) {
      toggleChatArchived({
        id: chatId
      });
    }
  });
  const handleConfirmBlock = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    closeBlockUserModal();
    blockUser({
      userId: chatId
    });
    if (renderingCanReportSpam && shouldReportSpam) {
      reportSpam({
        chatId
      });
    }
    if (shouldDeleteChat) {
      deleteChat({
        chatId
      });
    }
  });
  const handleCloseReportPane = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    hidePeerSettingsBar({
      peerId: chatId
    });
  });
  const handleChatReportSpam = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    closeBlockUserModal();
    reportSpam({
      chatId
    });
    if (isBasicGroup) {
      deleteChatUser({
        chatId,
        userId: currentUserId
      });
      deleteHistory({
        chatId,
        shouldDeleteForAll: false
      });
    } else {
      leaveChannel({
        chatId
      });
    }
  });
  const hasAnyButton = canAddContact || canBlockContact || canReportSpam;
  const isRendering = Boolean(hasAnyButton && peer);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isRendering) {
      closeBlockUserModal();
    }
  }, [isRendering]);
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_10__["default"])({
    isOpen: isRendering,
    onStateChange: onPaneStateChange
  });
  if (!shouldRender) return undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('ChatReportPane', className),
    dir: lang.isRtl ? 'rtl' : undefined
  }, renderingCanAddContact && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    isText: true,
    fluid: true,
    size: "tiny",
    className: "ChatReportPane--Button",
    onClick: handleAddContact
  }, lang('lng_new_contact_add')), renderingCanBlockContact && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    color: "danger",
    isText: true,
    fluid: true,
    size: "tiny",
    className: "ChatReportPane--Button",
    onClick: openBlockUserModal
  }, lang('lng_new_contact_block')), renderingCanReportSpam && !renderingCanBlockContact && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    color: "danger",
    isText: true,
    fluid: true,
    size: "tiny",
    className: "ChatReportPane--Button",
    onClick: openBlockUserModal
  }, lang('lng_report_spam_and_leave')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    round: true,
    ripple: true,
    size: "smaller",
    color: "translucent",
    onClick: handleCloseReportPane,
    ariaLabel: lang('Close')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "close"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_14__["default"], {
    isOpen: isBlockUserModalOpen,
    onClose: closeBlockUserModal,
    title: lang('BlockUserTitle', user ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(user) : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, chat)),
    text: user ? lang('UserInfo.BlockConfirmationTitle', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(user)) : lang('Chat.Confirm.ReportSpam.Channel'),
    confirmIsDestructive: true,
    confirmLabel: lang('Block'),
    confirmHandler: user ? handleConfirmBlock : handleChatReportSpam
  }, user && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_13__["default"], {
    className: "dialog-checkbox",
    label: lang('DeleteThisChat'),
    checked: shouldDeleteChat,
    onCheck: setShouldDeleteChat
  }), user && canReportSpam && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_13__["default"], {
    className: "ChatReportPane--Checkbox dialog-checkbox",
    label: lang('ReportChat'),
    checked: shouldReportSpam,
    onCheck: setShouldReportSpam
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => ({
  currentUserId: global.currentUserId,
  peer: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, chatId)
}))(ChatReportPane)));

/***/ },

/***/ "./src/components/middle/panes/HeaderPinnedMessage.module.scss"
/*!*********************************************************************!*\
  !*** ./src/components/middle/panes/HeaderPinnedMessage.module.scss ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"tE8PJzpv","mini":"lrBhOgvf","fullWidth":"gutn4asD","pinnedMessage":"ayLUtX1S","messageText":"ETMw73qH","loading":"yvd9_9PF","pinListIcon":"LFRysfVa","pinListIconHidden":"E_C4DXKN","no-hover":"WVjde2rq","noHover":"WVjde2rq","messageTextTransition":"mA1i07pG","withMedia":"BWZytkCB","title":"IWpRWVBg","summary":"k19QLKaH","inlineButton":"fpQMpARI","pictogramTransition":"Gp431jU4","pinnedThumb":"XjjZeOUy","pinnedThumbImage":"ljzqevcj"});

/***/ },

/***/ "./src/components/middle/panes/HeaderPinnedMessage.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/panes/HeaderPinnedMessage.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_cycleRestrict__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/cycleRestrict */ "./src/util/cycleRestrict.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../composer/helpers/renderKeyboardButtonText */ "./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useEnsureMessage */ "./src/hooks/useEnsureMessage.ts");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../right/hooks/useAsyncRendering */ "./src/components/right/hooks/useAsyncRendering.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _common_MessageSummary__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../common/MessageSummary */ "./src/components/common/MessageSummary.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_RippleEffect__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../ui/RippleEffect */ "./src/components/ui/RippleEffect.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _PinnedMessageNavigation__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../PinnedMessageNavigation */ "./src/components/middle/PinnedMessageNavigation.tsx");
/* harmony import */ var _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./HeaderPinnedMessage.module.scss */ "./src/components/middle/panes/HeaderPinnedMessage.module.scss");





































const MAX_LENGTH = 256;
const SHOW_LOADER_DELAY = 450;
const EMOJI_SIZE = 1.125 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_9__.REM;
const HeaderPinnedMessage = ({
  chatId,
  threadId,
  canUnpin,
  getLoadingPinnedId,
  pinnedMessageIds,
  messagesById,
  isFullWidth,
  topMessageSender,
  getCurrentPinnedIndex,
  className,
  chat,
  isSynced,
  shouldHide,
  onPaneStateChange,
  onFocusPinnedMessage
}) => {
  const {
    clickBotInlineButton,
    focusMessage,
    openThread,
    pinMessage,
    loadPinnedMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_19__["default"])();
  const currentPinnedIndex = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_15__["default"])(getCurrentPinnedIndex);
  const pinnedMessageId = Array.isArray(pinnedMessageIds) ? pinnedMessageIds[currentPinnedIndex] : pinnedMessageIds;
  const pinnedMessage = messagesById && pinnedMessageId ? messagesById[pinnedMessageId] : undefined;
  const pinnedMessagesCount = Array.isArray(pinnedMessageIds) ? pinnedMessageIds.length : pinnedMessageIds ? 1 : 0;
  const pinnedMessageNumber = Math.max(pinnedMessagesCount - currentPinnedIndex, 1);
  const topMessageTitle = topMessageSender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, topMessageSender) : undefined;
  const video = pinnedMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageVideo)(pinnedMessage);
  const gif = video?.isGif ? video : undefined;
  const isVideoThumbnail = Boolean(gif && !gif.previewPhotoSizes?.length);
  const mediaThumbnail = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_13__["default"])(pinnedMessage);
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_12__["default"])(pinnedMessage, isVideoThumbnail ? 'full' : 'pictogram');
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_21__["default"])(mediaHash);
  const isSpoiler = pinnedMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageIsSpoiler)(pinnedMessage);
  const isLoading = Boolean((0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_15__["default"])(getLoadingPinnedId));
  const canRenderLoader = (0,_right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_23__["default"])([isLoading], SHOW_LOADER_DELAY);
  const shouldShowLoader = canRenderLoader && isLoading;
  const renderingPinnedMessage = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_14__["default"])(pinnedMessage, true);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isSynced && (threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID || chat?.isForum)) {
      loadPinnedMessages({
        chatId,
        threadId
      });
    }
  }, [chatId, threadId, isSynced, chat?.isForum]);
  (0,_hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_16__["default"])(chatId, pinnedMessageId, pinnedMessage);
  const isOpen = Boolean(pinnedMessage) && !shouldHide;
  const {
    ref: transitionRef
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_22__["default"])({
    isOpen,
    noOpenTransition: true,
    shouldForceOpen: isFullWidth // Use pane animation instead
  });
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_24__["default"])({
    isOpen,
    isDisabled: !isFullWidth,
    ref: transitionRef,
    onStateChange: onPaneStateChange
  });
  const [isUnpinDialogOpen, openUnpinDialog, closeUnpinDialog] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const handleUnpinMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(() => {
    closeUnpinDialog();
    pinMessage({
      chatId,
      messageId: pinnedMessage.id,
      isUnpin: true
    });
  });
  const inlineButton = pinnedMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageSingleInlineButton)(pinnedMessage);
  const handleInlineButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(() => {
    if (inlineButton) {
      clickBotInlineButton({
        chatId: pinnedMessage.chatId,
        messageId: pinnedMessage.id,
        button: inlineButton
      });
    }
  });
  const handleAllPinnedClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(() => {
    openThread({
      chatId,
      threadId,
      type: 'pinned'
    });
  });
  const handleMessageClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_20__["default"])(e => {
    const nextMessageId = e.shiftKey && Array.isArray(pinnedMessageIds) ? pinnedMessageIds[(0,_util_cycleRestrict__WEBPACK_IMPORTED_MODULE_8__["default"])(pinnedMessageIds.length, pinnedMessageIds.indexOf(pinnedMessageId) - 2)] : pinnedMessageId;
    if (!getLoadingPinnedId()) {
      focusMessage({
        chatId,
        threadId,
        messageId: nextMessageId,
        noForumTopicPanel: true
      });
      onFocusPinnedMessage(nextMessageId);
    }
  });
  const [noHoverColor, markNoHoverColor, unmarkNoHoverColor] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const {
    handleClick,
    handleMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_17__.useFastClick)(handleMessageClick);
  function renderPictogram(thumbDataUri, blobUrl, isFullVideo, asSpoiler) {
    const {
      width,
      height
    } = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_9__.getPictogramDimensions)();
    const srcUrl = blobUrl || thumbDataUri;
    const shouldRenderVideo = isFullVideo && blobUrl;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinnedThumb
    }, thumbDataUri && !asSpoiler && !shouldRenderVideo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinnedThumbImage,
      src: srcUrl,
      width: width,
      height: height,
      alt: "",
      draggable: false
    }), shouldRenderVideo && !asSpoiler && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("video", {
      src: blobUrl,
      width: width,
      height: height,
      playsInline: true,
      disablePictureInPicture: true,
      className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinnedThumbImage
    }), thumbDataUri && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_27__["default"], {
      thumbDataUri: srcUrl,
      isVisible: Boolean(asSpoiler),
      width: width,
      height: height
    }));
  }
  if (!shouldRender || !renderingPinnedMessage) return undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('HeaderPinnedMessageWrapper', _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].root, isFullWidth ? _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].fullWidth : _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].mini, className)
  }, (pinnedMessagesCount > 1 || shouldShowLoader) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    round: true,
    size: "smaller",
    color: "translucent",
    ariaLabel: lang('EventLogFilterPinnedMessages'),
    onClick: !shouldShowLoader ? handleAllPinnedClick : undefined
  }, isLoading && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_32__["default"], {
    color: "blue",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].loading, _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinListIcon, !shouldShowLoader && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinListIconHidden)
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_26__["default"], {
    name: "pin-list",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinListIcon, shouldShowLoader && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinListIconHidden)
  })), canUnpin && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    round: true,
    size: "smaller",
    color: "translucent",
    ariaLabel: lang('UnpinMessageAlertTitle'),
    onClick: openUnpinDialog
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_26__["default"], {
    name: "close"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_30__["default"], {
    isOpen: isUnpinDialogOpen,
    onClose: closeUnpinDialog,
    text: lang('PinnedConfirmUnpin'),
    confirmLabel: lang('DialogUnpin'),
    confirmHandler: handleUnpinMessage
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pinnedMessage, noHoverColor && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].noHover),
    onClick: handleClick,
    onMouseDown: handleMouseDown,
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PinnedMessageNavigation__WEBPACK_IMPORTED_MODULE_34__["default"], {
    count: pinnedMessagesCount,
    index: currentPinnedIndex
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_33__["default"], {
    activeKey: renderingPinnedMessage.id,
    name: "slideVertical",
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].pictogramTransition
  }, renderPictogram(mediaThumbnail, mediaBlobUrl, isVideoThumbnail, isSpoiler)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].messageText, mediaThumbnail && _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].withMedia),
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].title,
    dir: lang.isRtl ? 'rtl' : undefined
  }, !topMessageTitle && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_25__["default"], {
    text: pinnedMessagesCount === 1 ? lang('PinnedMessageTitleSingle') : lang('PinnedMessageTitle', {
      index: pinnedMessageNumber
    }, {
      pluralValue: pinnedMessagesCount
    })
  }), topMessageTitle && (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(topMessageTitle)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_33__["default"], {
    activeKey: renderingPinnedMessage.id,
    name: "slideVerticalFade",
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].messageTextTransition
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    dir: "auto",
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].summary
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MessageSummary__WEBPACK_IMPORTED_MODULE_28__["default"], {
    message: renderingPinnedMessage,
    truncateLength: MAX_LENGTH,
    noEmoji: Boolean(mediaThumbnail),
    emojiSize: EMOJI_SIZE
  })))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RippleEffect__WEBPACK_IMPORTED_MODULE_31__["default"], null), inlineButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_29__["default"], {
    size: "tiny",
    className: _HeaderPinnedMessage_module_scss__WEBPACK_IMPORTED_MODULE_35__["default"].inlineButton,
    onClick: handleInlineButtonClick,
    shouldStopPropagation: true,
    onMouseEnter: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV ? markNoHoverColor : undefined,
    onMouseLeave: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV ? unmarkNoHoverColor : undefined
  }, (0,_composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang, inlineButton))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId,
  messageListType
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, chatId);
  const isSynced = global.isSynced;
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const messagesById = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatMessages)(global, chatId);
  const state = {
    chat,
    isSynced
  };
  if (messageListType !== 'thread' || !messagesById) {
    return state;
  }
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && !isSavedDialog && !chat?.isForum) {
    const pinnedMessageId = Number(threadId);
    const message = pinnedMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatMessage)(global, chatId, pinnedMessageId) : undefined;
    const topMessageSender = message ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectForwardedSender)(global, message) : undefined;
    return {
      ...state,
      pinnedMessageIds: pinnedMessageId,
      messagesById,
      canUnpin: false,
      topMessageSender
    };
  }
  const pinnedMessageIds = !isSavedDialog ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectPinnedIds)(global, chatId, threadId) : undefined;
  if (pinnedMessageIds?.length) {
    const firstPinnedMessage = messagesById[pinnedMessageIds[0]];
    const {
      canUnpin = false
    } = firstPinnedMessage && pinnedMessageIds.length === 1 && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectAllowedMessageActionsSlow)(global, firstPinnedMessage, threadId) || {};
    return {
      ...state,
      pinnedMessageIds,
      messagesById,
      canUnpin
    };
  }
  return state;
})(HeaderPinnedMessage)));

/***/ },

/***/ "./src/components/middle/panes/PaidMessageChargePane.module.scss"
/*!***********************************************************************!*\
  !*** ./src/components/middle/panes/PaidMessageChargePane.module.scss ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"xqcWnBH4","message":"CJhqoyif","messageStars":"sZR8zqEk","messageStarIcon":"AKXOpk8S"});

/***/ },

/***/ "./src/components/middle/panes/PaidMessageChargePane.tsx"
/*!***************************************************************!*\
  !*** ./src/components/middle/panes/PaidMessageChargePane.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./PaidMessageChargePane.module.scss */ "./src/components/middle/panes/PaidMessageChargePane.module.scss");








// import useTimeout from '../../../hooks/schedulers/useTimeout';




// import CustomEmoji from '../../common/CustomEmoji';

const PaidMessageChargePane = ({
  chargedPaidMessageStars,
  chat,
  peerId,
  onPaneStateChange
}) => {
  const isOpen = Boolean(chargedPaidMessageStars);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    openChatRefundModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    ref,
    shouldRender
  } = (0,_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_8__["default"])({
    isOpen,
    onStateChange: onPaneStateChange
  });
  const handleRefund = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openChatRefundModal({
      userId: peerId
    });
  });
  if (!shouldRender || !chargedPaidMessageStars) return undefined;
  const peerName = chat ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, chat) : undefined;
  const message = lang('PaneMessagePaidMessageCharge', {
    peer: peerName,
    amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_5__.formatStarsAsIcon)(lang, chargedPaidMessageStars, {
      asFont: true,
      className: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].messageStarIcon,
      containerClassName: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].messageStars
    })
  }, {
    withMarkdown: true,
    withNodes: true
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].message
  }, message), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
    isText: true,
    noForcedUpperCase: true,
    pill: true,
    fluid: true,
    size: "tiny",
    className: _PaidMessageChargePane_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].button,
    onClick: handleRefund
  }, lang('RemoveFeeTitle')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, peerId);
  const peerFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUserFullInfo)(global, peerId);
  const chargedPaidMessageStars = peerFullInfo?.settings?.chargedPaidMessageStars;
  return {
    chargedPaidMessageStars,
    chat
  };
})(PaidMessageChargePane)));

/***/ },

/***/ "./src/components/middle/search/MiddleSearch.async.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/search/MiddleSearch.async.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MiddleSearchAsync = props => {
  const {
    isActive
  } = props;
  const MiddleSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MiddleSearch', !isActive, true);
  return MiddleSearch ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MiddleSearch, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MiddleSearchAsync);

/***/ },

/***/ "./src/components/modals/ModalContainer.tsx"
/*!**************************************************!*\
  !*** ./src/components/modals/ModalContainer.tsx ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_VerificationMonetizationModal_async__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/VerificationMonetizationModal.async */ "./src/components/common/VerificationMonetizationModal.async.tsx");
/* harmony import */ var _main_WebAppsCloseConfirmationModal_async__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../main/WebAppsCloseConfirmationModal.async */ "./src/components/main/WebAppsCloseConfirmationModal.async.tsx");
/* harmony import */ var _aboutAds_AboutAdsModal_async__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./aboutAds/AboutAdsModal.async */ "./src/components/modals/aboutAds/AboutAdsModal.async.tsx");
/* harmony import */ var _ageVerification_AgeVerificationModal_async__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ageVerification/AgeVerificationModal.async */ "./src/components/modals/ageVerification/AgeVerificationModal.async.tsx");
/* harmony import */ var _attachBotInstall_AttachBotInstallModal_async__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./attachBotInstall/AttachBotInstallModal.async */ "./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx");
/* harmony import */ var _boost_BoostModal_async__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./boost/BoostModal.async */ "./src/components/modals/boost/BoostModal.async.tsx");
/* harmony import */ var _chatInvite_ChatInviteModal_async__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./chatInvite/ChatInviteModal.async */ "./src/components/modals/chatInvite/ChatInviteModal.async.tsx");
/* harmony import */ var _chatlist_ChatlistModal_async__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./chatlist/ChatlistModal.async */ "./src/components/modals/chatlist/ChatlistModal.async.tsx");
/* harmony import */ var _collectible_CollectibleInfoModal_async__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./collectible/CollectibleInfoModal.async */ "./src/components/modals/collectible/CollectibleInfoModal.async.tsx");
/* harmony import */ var _credits_CreditsModal_async__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./credits/CreditsModal.async */ "./src/components/modals/credits/CreditsModal.async.tsx");
/* harmony import */ var _deleteAccount_DeleteAccountModal_async__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./deleteAccount/DeleteAccountModal.async */ "./src/components/modals/deleteAccount/DeleteAccountModal.async.tsx");
/* harmony import */ var _emojiStatusAccess_EmojiStatusAccessModal_async__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./emojiStatusAccess/EmojiStatusAccessModal.async */ "./src/components/modals/emojiStatusAccess/EmojiStatusAccessModal.async.tsx");
/* harmony import */ var _frozenAccount_FrozenAccountModal_async__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./frozenAccount/FrozenAccountModal.async */ "./src/components/modals/frozenAccount/FrozenAccountModal.async.tsx");
/* harmony import */ var _gift_GiftModal_async__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./gift/GiftModal.async */ "./src/components/modals/gift/GiftModal.async.tsx");
/* harmony import */ var _gift_info_GiftInfoModal_async__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./gift/info/GiftInfoModal.async */ "./src/components/modals/gift/info/GiftInfoModal.async.tsx");
/* harmony import */ var _gift_recipient_GiftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./gift/recipient/GiftRecipientPicker.async */ "./src/components/modals/gift/recipient/GiftRecipientPicker.async.tsx");
/* harmony import */ var _gift_resale_GiftResalePriceComposerModal_async__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./gift/resale/GiftResalePriceComposerModal.async */ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.async.tsx");
/* harmony import */ var _gift_status_GiftStatusInfoModal_async__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./gift/status/GiftStatusInfoModal.async */ "./src/components/modals/gift/status/GiftStatusInfoModal.async.tsx");
/* harmony import */ var _gift_transfer_GiftTransferModal_async__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./gift/transfer/GiftTransferModal.async */ "./src/components/modals/gift/transfer/GiftTransferModal.async.tsx");
/* harmony import */ var _gift_upgrade_GiftUpgradeModal_async__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./gift/upgrade/GiftUpgradeModal.async */ "./src/components/modals/gift/upgrade/GiftUpgradeModal.async.tsx");
/* harmony import */ var _gift_withdraw_GiftWithdrawModal_async__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./gift/withdraw/GiftWithdrawModal.async */ "./src/components/modals/gift/withdraw/GiftWithdrawModal.async.tsx");
/* harmony import */ var _giftcode_GiftCodeModal_async__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./giftcode/GiftCodeModal.async */ "./src/components/modals/giftcode/GiftCodeModal.async.tsx");
/* harmony import */ var _inviteCode_InviteCodeModal_async__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./inviteCode/InviteCodeModal.async */ "./src/components/modals/inviteCode/InviteCodeModal.async.tsx");
/* harmony import */ var _inviteFriends_InviteFriendsModal_async__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./inviteFriends/InviteFriendsModal.async */ "./src/components/modals/inviteFriends/InviteFriendsModal.async.tsx");
/* harmony import */ var _inviteViaLink_InviteViaLinkModal_async__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./inviteViaLink/InviteViaLinkModal.async */ "./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx");
/* harmony import */ var _locationAccess_LocationAccessModal_async__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./locationAccess/LocationAccessModal.async */ "./src/components/modals/locationAccess/LocationAccessModal.async.tsx");
/* harmony import */ var _map_MapModal_async__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./map/MapModal.async */ "./src/components/modals/map/MapModal.async.tsx");
/* harmony import */ var _subscribtion_CreditLimitModal_async__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./subscribtion/CreditLimitModal.async */ "./src/components/modals/subscribtion/CreditLimitModal.async.tsx");
/* harmony import */ var _subscribtion_PayPackageModal_async__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./subscribtion/PayPackageModal.async */ "./src/components/modals/subscribtion/PayPackageModal.async.tsx");
/* harmony import */ var _oneTimeMedia_OneTimeMediaModal_async__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./oneTimeMedia/OneTimeMediaModal.async */ "./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx");
/* harmony import */ var _paidReaction_PaidReactionModal_async__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./paidReaction/PaidReactionModal.async */ "./src/components/modals/paidReaction/PaidReactionModal.async.tsx");
/* harmony import */ var _preparedMessage_PreparedMessageModal_async__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./preparedMessage/PreparedMessageModal.async */ "./src/components/modals/preparedMessage/PreparedMessageModal.async.tsx");
/* harmony import */ var _priceConfirm_PriceConfirmModal_async__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./priceConfirm/PriceConfirmModal.async */ "./src/components/modals/priceConfirm/PriceConfirmModal.async.tsx");
/* harmony import */ var _reportAd_ReportAdModal_async__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./reportAd/ReportAdModal.async */ "./src/components/modals/reportAd/ReportAdModal.async.tsx");
/* harmony import */ var _reportModal_ReportModal_async__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./reportModal/ReportModal.async */ "./src/components/modals/reportModal/ReportModal.async.tsx");
/* harmony import */ var _sharePreparedMessage_SharePreparedMessageModal_async__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./sharePreparedMessage/SharePreparedMessageModal.async */ "./src/components/modals/sharePreparedMessage/SharePreparedMessageModal.async.tsx");
/* harmony import */ var _stars_chatRefund_ChatRefundModal_async__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./stars/chatRefund/ChatRefundModal.async */ "./src/components/modals/stars/chatRefund/ChatRefundModal.async.tsx");
/* harmony import */ var _stars_gift_StarsGiftModal_async__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./stars/gift/StarsGiftModal.async */ "./src/components/modals/stars/gift/StarsGiftModal.async.tsx");
/* harmony import */ var _stars_StarsBalanceModal_async__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./stars/StarsBalanceModal.async */ "./src/components/modals/stars/StarsBalanceModal.async.tsx");
/* harmony import */ var _stars_StarsPaymentModal_async__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./stars/StarsPaymentModal.async */ "./src/components/modals/stars/StarsPaymentModal.async.tsx");
/* harmony import */ var _stars_subscription_StarsSubscriptionModal_async__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./stars/subscription/StarsSubscriptionModal.async */ "./src/components/modals/stars/subscription/StarsSubscriptionModal.async.tsx");
/* harmony import */ var _stars_transaction_StarsTransactionModal_async__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./stars/transaction/StarsTransactionModal.async */ "./src/components/modals/stars/transaction/StarsTransactionModal.async.tsx");
/* harmony import */ var _suggestedPostApproval_SuggestedPostApprovalModal_async__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./suggestedPostApproval/SuggestedPostApprovalModal.async */ "./src/components/modals/suggestedPostApproval/SuggestedPostApprovalModal.async.tsx");
/* harmony import */ var _suggestedStatus_SuggestedStatusModal_async__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./suggestedStatus/SuggestedStatusModal.async */ "./src/components/modals/suggestedStatus/SuggestedStatusModal.async.tsx");
/* harmony import */ var _suggestMessage_SuggestMessageModal_async__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./suggestMessage/SuggestMessageModal.async */ "./src/components/modals/suggestMessage/SuggestMessageModal.async.tsx");
/* harmony import */ var _urlAuth_UrlAuthModal_async__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ./urlAuth/UrlAuthModal.async */ "./src/components/modals/urlAuth/UrlAuthModal.async.tsx");
/* harmony import */ var _webApp_WebAppModal_async__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ./webApp/WebAppModal.async */ "./src/components/modals/webApp/WebAppModal.async.tsx");





















































// `Pick` used only to provide tab completion

const MODALS = {
  giftCodeModal: _giftcode_GiftCodeModal_async__WEBPACK_IMPORTED_MODULE_25__["default"],
  boostModal: _boost_BoostModal_async__WEBPACK_IMPORTED_MODULE_9__["default"],
  chatlistModal: _chatlist_ChatlistModal_async__WEBPACK_IMPORTED_MODULE_11__["default"],
  urlAuth: _urlAuth_UrlAuthModal_async__WEBPACK_IMPORTED_MODULE_49__["default"],
  oneTimeMediaModal: _oneTimeMedia_OneTimeMediaModal_async__WEBPACK_IMPORTED_MODULE_33__["default"],
  inviteViaLinkModal: _inviteViaLink_InviteViaLinkModal_async__WEBPACK_IMPORTED_MODULE_28__["default"],
  requestedAttachBotInstall: _attachBotInstall_AttachBotInstallModal_async__WEBPACK_IMPORTED_MODULE_8__["default"],
  reportAdModal: _reportAd_ReportAdModal_async__WEBPACK_IMPORTED_MODULE_37__["default"],
  reportModal: _reportModal_ReportModal_async__WEBPACK_IMPORTED_MODULE_38__["default"],
  webApps: _webApp_WebAppModal_async__WEBPACK_IMPORTED_MODULE_50__["default"],
  collectibleInfoModal: _collectible_CollectibleInfoModal_async__WEBPACK_IMPORTED_MODULE_12__["default"],
  mapModal: _map_MapModal_async__WEBPACK_IMPORTED_MODULE_30__["default"],
  starsPayment: _stars_StarsPaymentModal_async__WEBPACK_IMPORTED_MODULE_43__["default"],
  starsBalanceModal: _stars_StarsBalanceModal_async__WEBPACK_IMPORTED_MODULE_42__["default"],
  starsTransactionModal: _stars_transaction_StarsTransactionModal_async__WEBPACK_IMPORTED_MODULE_45__["default"],
  chatInviteModal: _chatInvite_ChatInviteModal_async__WEBPACK_IMPORTED_MODULE_10__["default"],
  creditsModal: _credits_CreditsModal_async__WEBPACK_IMPORTED_MODULE_13__["default"],
  inviteCodeModal: _inviteCode_InviteCodeModal_async__WEBPACK_IMPORTED_MODULE_26__["default"],
  inviteFriendsModal: _inviteFriends_InviteFriendsModal_async__WEBPACK_IMPORTED_MODULE_27__["default"],
  payPackageModal: _subscribtion_PayPackageModal_async__WEBPACK_IMPORTED_MODULE_32__["default"],
  creditLimitModal: _subscribtion_CreditLimitModal_async__WEBPACK_IMPORTED_MODULE_31__["default"],
  paidReactionModal: _paidReaction_PaidReactionModal_async__WEBPACK_IMPORTED_MODULE_34__["default"],
  suggestMessageModal: _suggestMessage_SuggestMessageModal_async__WEBPACK_IMPORTED_MODULE_48__["default"],
  suggestedPostApprovalModal: _suggestedPostApproval_SuggestedPostApprovalModal_async__WEBPACK_IMPORTED_MODULE_46__["default"],
  starsSubscriptionModal: _stars_subscription_StarsSubscriptionModal_async__WEBPACK_IMPORTED_MODULE_44__["default"],
  starsGiftModal: _stars_gift_StarsGiftModal_async__WEBPACK_IMPORTED_MODULE_41__["default"],
  giftModal: _gift_GiftModal_async__WEBPACK_IMPORTED_MODULE_17__["default"],
  isGiftRecipientPickerOpen: _gift_recipient_GiftRecipientPicker_async__WEBPACK_IMPORTED_MODULE_19__["default"],
  isWebAppsCloseConfirmationModalOpen: _main_WebAppsCloseConfirmationModal_async__WEBPACK_IMPORTED_MODULE_5__["default"],
  giftInfoModal: _gift_info_GiftInfoModal_async__WEBPACK_IMPORTED_MODULE_18__["default"],
  giftResalePriceComposerModal: _gift_resale_GiftResalePriceComposerModal_async__WEBPACK_IMPORTED_MODULE_20__["default"],
  suggestedStatusModal: _suggestedStatus_SuggestedStatusModal_async__WEBPACK_IMPORTED_MODULE_47__["default"],
  emojiStatusAccessModal: _emojiStatusAccess_EmojiStatusAccessModal_async__WEBPACK_IMPORTED_MODULE_15__["default"],
  locationAccessModal: _locationAccess_LocationAccessModal_async__WEBPACK_IMPORTED_MODULE_29__["default"],
  aboutAdsModal: _aboutAds_AboutAdsModal_async__WEBPACK_IMPORTED_MODULE_6__["default"],
  giftUpgradeModal: _gift_upgrade_GiftUpgradeModal_async__WEBPACK_IMPORTED_MODULE_23__["default"],
  monetizationVerificationModal: _common_VerificationMonetizationModal_async__WEBPACK_IMPORTED_MODULE_4__["default"],
  giftWithdrawModal: _gift_withdraw_GiftWithdrawModal_async__WEBPACK_IMPORTED_MODULE_24__["default"],
  giftStatusInfoModal: _gift_status_GiftStatusInfoModal_async__WEBPACK_IMPORTED_MODULE_21__["default"],
  preparedMessageModal: _preparedMessage_PreparedMessageModal_async__WEBPACK_IMPORTED_MODULE_35__["default"],
  sharePreparedMessageModal: _sharePreparedMessage_SharePreparedMessageModal_async__WEBPACK_IMPORTED_MODULE_39__["default"],
  giftTransferModal: _gift_transfer_GiftTransferModal_async__WEBPACK_IMPORTED_MODULE_22__["default"],
  chatRefundModal: _stars_chatRefund_ChatRefundModal_async__WEBPACK_IMPORTED_MODULE_40__["default"],
  priceConfirmModal: _priceConfirm_PriceConfirmModal_async__WEBPACK_IMPORTED_MODULE_36__["default"],
  isFrozenAccountModalOpen: _frozenAccount_FrozenAccountModal_async__WEBPACK_IMPORTED_MODULE_16__["default"],
  deleteAccountModal: _deleteAccount_DeleteAccountModal_async__WEBPACK_IMPORTED_MODULE_14__["default"],
  isAgeVerificationModalOpen: _ageVerification_AgeVerificationModal_async__WEBPACK_IMPORTED_MODULE_7__["default"]
};
const MODAL_KEYS = Object.keys(MODALS);
const MODAL_ENTRIES = Object.entries(MODALS);
const ModalContainer = modalProps => {
  return MODAL_ENTRIES.map(([key, ModalComponent]) =>
  /*#__PURE__*/
  // @ts-ignore -- TS does not preserve tuple types in `map` callbacks
  _teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ModalComponent, {
    key: key,
    modal: modalProps[key]
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.pick)((0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global), MODAL_KEYS))(ModalContainer)));

/***/ },

/***/ "./src/components/modals/aboutAds/AboutAdsModal.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/modals/aboutAds/AboutAdsModal.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const AboutAdsModalAsync = props => {
  const {
    modal
  } = props;
  const AboutAdsModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AboutAdsModal', !modal);
  return AboutAdsModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AboutAdsModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AboutAdsModalAsync);

/***/ },

/***/ "./src/components/modals/ageVerification/AgeVerificationModal.async.tsx"
/*!******************************************************************************!*\
  !*** ./src/components/modals/ageVerification/AgeVerificationModal.async.tsx ***!
  \******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");




const AgeVerificationModalAsync = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(props => {
  const {
    modal
  } = props;
  const AgeVerificationModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AgeVerificationModal', !modal);
  return AgeVerificationModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AgeVerificationModal, props) : undefined;
});
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AgeVerificationModalAsync);

/***/ },

/***/ "./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx"
/*!********************************************************************************!*\
  !*** ./src/components/modals/attachBotInstall/AttachBotInstallModal.async.tsx ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const AttachBotInstallModalAsync = props => {
  const {
    modal
  } = props;
  const AttachBotInstallModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AttachBotInstallModal', !modal);
  return AttachBotInstallModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AttachBotInstallModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AttachBotInstallModalAsync);

/***/ },

/***/ "./src/components/modals/boost/BoostModal.async.tsx"
/*!**********************************************************!*\
  !*** ./src/components/modals/boost/BoostModal.async.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const BoostModalAsync = props => {
  const {
    modal
  } = props;
  const BoostModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'BoostModal', !modal);
  return BoostModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(BoostModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BoostModalAsync);

/***/ },

/***/ "./src/components/modals/chatInvite/ChatInviteModal.async.tsx"
/*!********************************************************************!*\
  !*** ./src/components/modals/chatInvite/ChatInviteModal.async.tsx ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ChatInviteModalAsync = props => {
  const {
    modal
  } = props;
  const ChatInviteModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ChatInviteModal', !modal);
  return ChatInviteModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ChatInviteModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatInviteModalAsync);

/***/ },

/***/ "./src/components/modals/chatlist/ChatlistModal.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/modals/chatlist/ChatlistModal.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ChatlistModalAsync = props => {
  const {
    modal
  } = props;
  const ChatlistModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ChatlistModal', !modal);
  return ChatlistModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ChatlistModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatlistModalAsync);

/***/ },

/***/ "./src/components/modals/collectible/CollectibleInfoModal.async.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/modals/collectible/CollectibleInfoModal.async.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const CollectibleInfoModalAsync = props => {
  const {
    modal
  } = props;
  const CollectibleInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CollectibleInfoModal', !modal);
  return CollectibleInfoModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CollectibleInfoModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CollectibleInfoModalAsync);

/***/ },

/***/ "./src/components/modals/credits/CreditsModal.async.tsx"
/*!**************************************************************!*\
  !*** ./src/components/modals/credits/CreditsModal.async.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const CreditsModalAsync = props => {
  const {
    modal
  } = props;
  const CreditsModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CreditsModal', !modal?.isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return CreditsModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CreditsModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CreditsModalAsync);

/***/ },

/***/ "./src/components/modals/deleteAccount/DeleteAccountModal.async.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/modals/deleteAccount/DeleteAccountModal.async.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const DeleteAccountModalAsync = props => {
  const {
    modal
  } = props;
  const DeleteAccountModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'DeleteAccountModal', !modal);
  return DeleteAccountModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(DeleteAccountModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DeleteAccountModalAsync);

/***/ },

/***/ "./src/components/modals/emojiStatusAccess/EmojiStatusAccessModal.async.tsx"
/*!**********************************************************************************!*\
  !*** ./src/components/modals/emojiStatusAccess/EmojiStatusAccessModal.async.tsx ***!
  \**********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const EmojiStatusAccessModalAsync = props => {
  const {
    modal
  } = props;
  const EmojiStatusAccessModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'EmojiStatusAccessModal', !modal);
  return EmojiStatusAccessModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(EmojiStatusAccessModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmojiStatusAccessModalAsync);

/***/ },

/***/ "./src/components/modals/frozenAccount/FrozenAccountModal.async.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/modals/frozenAccount/FrozenAccountModal.async.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const FrozenAccountModalAsync = props => {
  const {
    modal
  } = props;
  const FrozenAccountModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'FrozenAccountModal', modal);
  return FrozenAccountModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(FrozenAccountModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (FrozenAccountModalAsync);

/***/ },

/***/ "./src/components/modals/gift/GiftModal.async.tsx"
/*!********************************************************!*\
  !*** ./src/components/modals/gift/GiftModal.async.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftModalAsync = props => {
  const {
    modal
  } = props;
  const GiftModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'GiftModal', !modal);
  return GiftModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftModalAsync);

/***/ },

/***/ "./src/components/modals/gift/info/GiftInfoModal.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/info/GiftInfoModal.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftInfoModalAsync = props => {
  const {
    modal
  } = props;
  const GiftInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'GiftInfoModal', !modal);
  return GiftInfoModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftInfoModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftInfoModalAsync);

/***/ },

/***/ "./src/components/modals/gift/recipient/GiftRecipientPicker.async.tsx"
/*!****************************************************************************!*\
  !*** ./src/components/modals/gift/recipient/GiftRecipientPicker.async.tsx ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftRecipientPickerAsync = props => {
  const {
    modal
  } = props;
  const GiftRecipientPicker = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'GiftRecipientPicker', !modal);
  return GiftRecipientPicker ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftRecipientPicker, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftRecipientPickerAsync);

/***/ },

/***/ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.async.tsx"
/*!**********************************************************************************!*\
  !*** ./src/components/modals/gift/resale/GiftResalePriceComposerModal.async.tsx ***!
  \**********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftResalePriceComposerModalAsync = props => {
  const {
    modal
  } = props;
  const GiftResalePriceComposerModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'GiftResalePriceComposerModal', !modal);
  return GiftResalePriceComposerModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftResalePriceComposerModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftResalePriceComposerModalAsync);

/***/ },

/***/ "./src/components/modals/gift/status/GiftStatusInfoModal.async.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/status/GiftStatusInfoModal.async.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftStatusInfoModalAsync = props => {
  const {
    modal
  } = props;
  const GiftStatusInfoModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'GiftStatusInfoModal', !modal);
  return GiftStatusInfoModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftStatusInfoModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftStatusInfoModalAsync);

/***/ },

/***/ "./src/components/modals/gift/transfer/GiftTransferModal.async.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/transfer/GiftTransferModal.async.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftTransferModalAsync = props => {
  const {
    modal
  } = props;
  const GiftTransferModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'GiftTransferModal', !modal);
  return GiftTransferModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftTransferModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftTransferModalAsync);

/***/ },

/***/ "./src/components/modals/gift/upgrade/GiftUpgradeModal.async.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/modals/gift/upgrade/GiftUpgradeModal.async.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftUpgradeModalAsync = props => {
  const {
    modal
  } = props;
  const GiftUpgradeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'GiftUpgradeModal', !modal);
  return GiftUpgradeModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftUpgradeModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftUpgradeModalAsync);

/***/ },

/***/ "./src/components/modals/gift/withdraw/GiftWithdrawModal.async.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/withdraw/GiftWithdrawModal.async.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftWithdrawModalAsync = props => {
  const {
    modal
  } = props;
  const GiftWithdrawModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'GiftWithdrawModal', !modal);
  return GiftWithdrawModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftWithdrawModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftWithdrawModalAsync);

/***/ },

/***/ "./src/components/modals/giftcode/GiftCodeModal.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/modals/giftcode/GiftCodeModal.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const GiftCodeModalAsync = props => {
  const {
    modal
  } = props;
  const GiftCodeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'GiftCodeModal', !modal);
  return GiftCodeModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GiftCodeModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GiftCodeModalAsync);

/***/ },

/***/ "./src/components/modals/inviteCode/InviteCodeModal.async.tsx"
/*!********************************************************************!*\
  !*** ./src/components/modals/inviteCode/InviteCodeModal.async.tsx ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const InviteCodeModalAsync = props => {
  const InviteCodeModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'InviteCodeModal');
  return InviteCodeModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(InviteCodeModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InviteCodeModalAsync);

/***/ },

/***/ "./src/components/modals/inviteFriends/InviteFriendsModal.async.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/modals/inviteFriends/InviteFriendsModal.async.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const InviteFriendsModalAsync = props => {
  const {
    modal
  } = props;
  const InviteFriendsModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'InviteFriendsModal', !modal?.isOpen);
  return InviteFriendsModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(InviteFriendsModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InviteFriendsModalAsync);

/***/ },

/***/ "./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/modals/inviteViaLink/InviteViaLinkModal.async.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const InviteViaLinkModalAsync = props => {
  const {
    modal
  } = props;
  const InviteViaLinkModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'InviteViaLinkModal', !modal);
  return InviteViaLinkModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(InviteViaLinkModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InviteViaLinkModalAsync);

/***/ },

/***/ "./src/components/modals/locationAccess/LocationAccessModal.async.tsx"
/*!****************************************************************************!*\
  !*** ./src/components/modals/locationAccess/LocationAccessModal.async.tsx ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const LocationAccessModalAsync = props => {
  const {
    modal
  } = props;
  const LocationAccessModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'LocationAccessModal', !modal);
  return LocationAccessModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(LocationAccessModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (LocationAccessModalAsync);

/***/ },

/***/ "./src/components/modals/map/MapModal.async.tsx"
/*!******************************************************!*\
  !*** ./src/components/modals/map/MapModal.async.tsx ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MapModalAsync = props => {
  const {
    modal
  } = props;
  const MapModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MapModal', !modal);
  return MapModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MapModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MapModalAsync);

/***/ },

/***/ "./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx"
/*!************************************************************************!*\
  !*** ./src/components/modals/oneTimeMedia/OneTimeMediaModal.async.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const OneTimeMediaModalAsync = props => {
  const {
    modal
  } = props;
  const OneTimeMediaModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'OneTimeMediaModal', !modal);
  return OneTimeMediaModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(OneTimeMediaModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (OneTimeMediaModalAsync);

/***/ },

/***/ "./src/components/modals/paidReaction/PaidReactionModal.async.tsx"
/*!************************************************************************!*\
  !*** ./src/components/modals/paidReaction/PaidReactionModal.async.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PaidReactionModalAsync = props => {
  const {
    modal
  } = props;
  const PaidReactionModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'PaidReactionModal', !modal);
  return PaidReactionModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PaidReactionModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PaidReactionModalAsync);

/***/ },

/***/ "./src/components/modals/preparedMessage/PreparedMessageModal.async.tsx"
/*!******************************************************************************!*\
  !*** ./src/components/modals/preparedMessage/PreparedMessageModal.async.tsx ***!
  \******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PreparedMessageModalAsync = props => {
  const {
    modal
  } = props;
  const PreparedMessageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PreparedMessageModal', !modal);
  return PreparedMessageModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PreparedMessageModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PreparedMessageModalAsync);

/***/ },

/***/ "./src/components/modals/priceConfirm/PriceConfirmModal.async.tsx"
/*!************************************************************************!*\
  !*** ./src/components/modals/priceConfirm/PriceConfirmModal.async.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PriceConfirmModalAsync = ({
  modal
}) => {
  const PriceConfirmModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'PriceConfirmModal', !modal);
  return PriceConfirmModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PriceConfirmModal, {
    modal: modal
  }) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PriceConfirmModalAsync);

/***/ },

/***/ "./src/components/modals/reportAd/ReportAdModal.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/modals/reportAd/ReportAdModal.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReportAdModalAsync = props => {
  const {
    modal
  } = props;
  const ReportAdModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReportAdModal', !modal);
  return ReportAdModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReportAdModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReportAdModalAsync);

/***/ },

/***/ "./src/components/modals/reportModal/ReportModal.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/modals/reportModal/ReportModal.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReportModalAsync = props => {
  const {
    modal
  } = props;
  const ReportModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReportModal', !modal);
  return ReportModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReportModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReportModalAsync);

/***/ },

/***/ "./src/components/modals/sharePreparedMessage/SharePreparedMessageModal.async.tsx"
/*!****************************************************************************************!*\
  !*** ./src/components/modals/sharePreparedMessage/SharePreparedMessageModal.async.tsx ***!
  \****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SharePreparedMessageModalAsync = props => {
  const {
    modal
  } = props;
  const SharePreparedMessageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SharePreparedMessageModal', !modal);
  return SharePreparedMessageModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SharePreparedMessageModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SharePreparedMessageModalAsync);

/***/ },

/***/ "./src/components/modals/stars/StarsBalanceModal.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/modals/stars/StarsBalanceModal.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StarsBalanceModalAsync = props => {
  const {
    modal
  } = props;
  const StarsBalanceModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'StarsBalanceModal', !modal);
  return StarsBalanceModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StarsBalanceModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsBalanceModalAsync);

/***/ },

/***/ "./src/components/modals/stars/StarsPaymentModal.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/modals/stars/StarsPaymentModal.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StarPaymentModalAsync = props => {
  const {
    modal
  } = props;
  const StarPaymentModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'StarPaymentModal', !modal);
  return StarPaymentModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StarPaymentModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarPaymentModalAsync);

/***/ },

/***/ "./src/components/modals/stars/chatRefund/ChatRefundModal.async.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/modals/stars/chatRefund/ChatRefundModal.async.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ChatRefundModalAsync = props => {
  const {
    modal
  } = props;
  const ChatRefundModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'ChatRefundModal', !modal);
  return ChatRefundModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ChatRefundModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatRefundModalAsync);

/***/ },

/***/ "./src/components/modals/stars/gift/StarsGiftModal.async.tsx"
/*!*******************************************************************!*\
  !*** ./src/components/modals/stars/gift/StarsGiftModal.async.tsx ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StarsGiftModalAsync = props => {
  const {
    modal
  } = props;
  const StarsGiftModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'StarsGiftModal', !modal);
  return StarsGiftModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StarsGiftModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsGiftModalAsync);

/***/ },

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionModal.async.tsx"
/*!***********************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionModal.async.tsx ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StarsSubscriptionModalAsync = props => {
  const {
    modal
  } = props;
  const StarsSubscriptionModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'StarsSubscriptionModal', !modal);
  return StarsSubscriptionModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StarsSubscriptionModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsSubscriptionModalAsync);

/***/ },

/***/ "./src/components/modals/stars/transaction/StarsTransactionModal.async.tsx"
/*!*********************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionModal.async.tsx ***!
  \*********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StarsTransactionModalAsync = props => {
  const {
    modal
  } = props;
  const StarsTransactionModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Stars, 'StarsTransactionInfoModal', !modal);
  return StarsTransactionModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StarsTransactionModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StarsTransactionModalAsync);

/***/ },

/***/ "./src/components/modals/subscribtion/CreditLimitModal.async.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/modals/subscribtion/CreditLimitModal.async.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const CreditLimitModalAsync = props => {
  const {
    modal
  } = props;
  const CreditLimitModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CreditLimitModal', !modal);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return CreditLimitModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CreditLimitModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CreditLimitModalAsync);

/***/ },

/***/ "./src/components/modals/subscribtion/PayPackageModal.async.tsx"
/*!**********************************************************************!*\
  !*** ./src/components/modals/subscribtion/PayPackageModal.async.tsx ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PayPackageModalAsync = props => {
  const {
    modal
  } = props;
  const PayPackageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PayPackageModal', !modal?.isOpen);

  // eslint-disable-next-line react/jsx-props-no-spreading
  return PayPackageModal ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PayPackageModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PayPackageModalAsync);

/***/ },

/***/ "./src/components/modals/suggestMessage/SuggestMessageModal.async.tsx"
/*!****************************************************************************!*\
  !*** ./src/components/modals/suggestMessage/SuggestMessageModal.async.tsx ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const SuggestMessageModalAsync = props => {
  const {
    modal
  } = props;
  const SuggestMessageModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SuggestMessageModal', !modal);
  return SuggestMessageModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SuggestMessageModal, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SuggestMessageModalAsync);

/***/ },

/***/ "./src/components/modals/suggestedPostApproval/SuggestedPostApprovalModal.async.tsx"
/*!******************************************************************************************!*\
  !*** ./src/components/modals/suggestedPostApproval/SuggestedPostApprovalModal.async.tsx ***!
  \******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const SuggestedPostApprovalModalAsync = props => {
  const {
    modal
  } = props;
  const SuggestedPostApprovalModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SuggestedPostApprovalModal', !modal);
  return SuggestedPostApprovalModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SuggestedPostApprovalModal, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SuggestedPostApprovalModalAsync);

/***/ },

/***/ "./src/components/modals/suggestedStatus/SuggestedStatusModal.async.tsx"
/*!******************************************************************************!*\
  !*** ./src/components/modals/suggestedStatus/SuggestedStatusModal.async.tsx ***!
  \******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SuggestedStatusModalAsync = props => {
  const {
    modal
  } = props;
  const SuggestedStatusModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SuggestedStatusModal', !modal);
  return SuggestedStatusModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SuggestedStatusModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SuggestedStatusModalAsync);

/***/ },

/***/ "./src/components/modals/urlAuth/UrlAuthModal.async.tsx"
/*!**************************************************************!*\
  !*** ./src/components/modals/urlAuth/UrlAuthModal.async.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const UrlAuthModalAsync = props => {
  const {
    modal
  } = props;
  const UrlAuthModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'UrlAuthModal', !modal);
  return UrlAuthModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(UrlAuthModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UrlAuthModalAsync);

/***/ },

/***/ "./src/components/modals/webApp/WebAppModal.async.tsx"
/*!************************************************************!*\
  !*** ./src/components/modals/webApp/WebAppModal.async.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const WebAppModalAsync = props => {
  const {
    modal
  } = props;
  const WebAppModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'WebAppModal', !modal);
  return WebAppModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(WebAppModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (WebAppModalAsync);

/***/ },

/***/ "./src/components/payment/PaymentModal.async.tsx"
/*!*******************************************************!*\
  !*** ./src/components/payment/PaymentModal.async.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PaymentModalAsync = props => {
  const {
    isOpen
  } = props;
  const PaymentModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PaymentModal', !isOpen);
  return PaymentModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PaymentModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PaymentModalAsync);

/***/ },

/***/ "./src/components/payment/ReceiptModal.async.tsx"
/*!*******************************************************!*\
  !*** ./src/components/payment/ReceiptModal.async.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ReceiptModalAsync = props => {
  const {
    isOpen
  } = props;
  const ReceiptModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ReceiptModal', !isOpen);
  return ReceiptModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ReceiptModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReceiptModalAsync);

/***/ },

/***/ "./src/components/right/AddChatMembers.scss"
/*!**************************************************!*\
  !*** ./src/components/right/AddChatMembers.scss ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/right/AddChatMembers.tsx"
/*!*************************************************!*\
  !*** ./src/components/right/AddChatMembers.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../common/pickers/PeerPicker */ "./src/components/common/pickers/PeerPicker.tsx");
/* harmony import */ var _ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../ui/FloatingActionButton */ "./src/components/ui/FloatingActionButton.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _AddChatMembers_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./AddChatMembers.scss */ "./src/components/right/AddChatMembers.scss");

















const AddChatMembers = ({
  isChannel,
  members,
  onNextStep,
  currentUserId,
  localContactIds,
  isLoading,
  searchQuery,
  isSearching,
  localUserIds,
  globalUserIds,
  onClose,
  isActive
}) => {
  const {
    setUserSearchQuery
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [selectedMemberIds, setSelectedMemberIds] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const prevSelectedMemberIds = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_10__["default"])(selectedMemberIds);
  const noPickerScrollRestore = prevSelectedMemberIds === selectedMemberIds;
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_8__["default"])({
    isActive,
    onBack: onClose
  });
  const memberIds = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return members ? members.map(member => member.userId) : [];
  }, [members]);
  const handleFilterChange = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(query => {
    setUserSearchQuery({
      query
    });
  }, [setUserSearchQuery]);
  const displayedIds = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    // No need for expensive global updates on users, so we avoid them
    const usersById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().users.byId;
    const filteredIds = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.filterPeersByQuery)({
      ids: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_6__.unique)([...(localContactIds || []), ...(localUserIds || []), ...(globalUserIds || [])]),
      query: searchQuery,
      type: 'user'
    });
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_7__["default"])(filteredIds.filter(userId => {
      const user = usersById[userId];

      // The user can be added to the chat if the following conditions are met:
      // the user has not yet been added to the current chat
      // AND it is not the current user,
      // AND (it is not found (user from global search) OR it is not a bot OR it is a bot,
      // but the current chat is not a channel AND the appropriate permission is set).
      return !memberIds.includes(userId) && userId !== currentUserId && (!user || !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUserBot)(user) || !isChannel && user.canBeInvitedToGroup);
    }));
  }, [localContactIds, searchQuery, localUserIds, globalUserIds, currentUserId, memberIds, isChannel]);
  const handleNextStep = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (selectedMemberIds.length) {
      setUserSearchQuery({
        query: ''
      });
      onNextStep(selectedMemberIds);
    }
  }, [selectedMemberIds, setUserSearchQuery, onNextStep]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "AddChatMembers"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "AddChatMembers-inner"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_12__["default"], {
    itemIds: displayedIds,
    selectedIds: selectedMemberIds,
    filterValue: searchQuery,
    filterPlaceholder: lang('lng_channel_add_users'),
    searchInputId: "new-members-picker-search",
    isLoading: isSearching,
    onSelectedIdsChange: setSelectedMemberIds,
    onFilterChange: handleFilterChange,
    isSearchable: true,
    withDefaultPadding: true,
    noScrollRestore: noPickerScrollRestore,
    allowMultiple: true,
    withStatus: true,
    itemInputType: "checkbox"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_13__["default"], {
    isShown: Boolean(selectedMemberIds.length),
    disabled: isLoading,
    ariaLabel: lang('lng_channel_add_users'),
    onClick: handleNextStep
  }, isLoading ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_14__["default"], {
    color: "white"
  }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "arrow-right"
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, chatId);
  const {
    userIds: localContactIds
  } = global.contactList || {};
  const {
    newChatMembersProgress
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const {
    currentUserId
  } = global;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat);
  const {
    query: searchQuery,
    fetchingStatus,
    globalUserIds,
    localUserIds
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global).userSearch;
  return {
    isChannel,
    members: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatFullInfo)(global, chatId)?.members,
    currentUserId,
    localContactIds,
    searchQuery,
    isSearching: fetchingStatus,
    isLoading: newChatMembersProgress === _types__WEBPACK_IMPORTED_MODULE_2__.NewChatMembersProgress.Loading,
    globalUserIds,
    localUserIds
  };
})(AddChatMembers)));

/***/ },

/***/ "./src/components/right/CreateTopic.async.tsx"
/*!****************************************************!*\
  !*** ./src/components/right/CreateTopic.async.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const CreateTopicAsync = props => {
  const CreateTopic = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CreateTopic');
  return CreateTopic ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CreateTopic, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CreateTopicAsync);

/***/ },

/***/ "./src/components/right/EditTopic.async.tsx"
/*!**************************************************!*\
  !*** ./src/components/right/EditTopic.async.tsx ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const EditTopicAsync = props => {
  const EditTopic = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'EditTopic');
  return EditTopic ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(EditTopic, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EditTopicAsync);

/***/ },

/***/ "./src/components/right/GifSearch.async.tsx"
/*!**************************************************!*\
  !*** ./src/components/right/GifSearch.async.tsx ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const GifSearchAsync = () => {
  const GifSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'GifSearch');
  return GifSearch ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(GifSearch, null) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GifSearchAsync);

/***/ },

/***/ "./src/components/right/PollResults.async.tsx"
/*!****************************************************!*\
  !*** ./src/components/right/PollResults.async.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const PollResultsAsync = () => {
  const PollResults = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PollResults');
  return PollResults ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PollResults, null) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PollResultsAsync);

/***/ },

/***/ "./src/components/right/Profile.scss"
/*!*******************************************!*\
  !*** ./src/components/right/Profile.scss ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/right/Profile.tsx"
/*!******************************************!*\
  !*** ./src/components/right/Profile.tsx ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_stars__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/helpers/stars */ "./src/global/helpers/stars.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _global_selectors_media__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../global/selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _left_search_helpers_getSenderName__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../left/search/helpers/getSenderName */ "./src/components/left/search/helpers/getSenderName.ts");
/* harmony import */ var _hooks_animations_useViewTransition__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/animations/useViewTransition */ "./src/hooks/animations/useViewTransition.ts");
/* harmony import */ var _hooks_polling_usePeerStoriesPolling__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/polling/usePeerStoriesPolling */ "./src/hooks/polling/usePeerStoriesPolling.ts");
/* harmony import */ var _hooks_useCacheBuster__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useCacheBuster */ "./src/hooks/useCacheBuster.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./hooks/useAsyncRendering */ "./src/components/right/hooks/useAsyncRendering.ts");
/* harmony import */ var _hooks_useProfileState__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./hooks/useProfileState */ "./src/components/right/hooks/useProfileState.ts");
/* harmony import */ var _hooks_useProfileViewportIds__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./hooks/useProfileViewportIds */ "./src/components/right/hooks/useProfileViewportIds.ts");
/* harmony import */ var _hooks_useTransitionFixes__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./hooks/useTransitionFixes */ "./src/components/right/hooks/useTransitionFixes.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_Audio__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../common/Audio */ "./src/components/common/Audio.tsx");
/* harmony import */ var _common_Document__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../common/Document */ "./src/components/common/Document.tsx");
/* harmony import */ var _common_gift_SavedGift__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../common/gift/SavedGift */ "./src/components/common/gift/SavedGift.tsx");
/* harmony import */ var _common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../common/GroupChatInfo */ "./src/components/common/GroupChatInfo.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_Media__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ../common/Media */ "./src/components/common/Media.tsx");
/* harmony import */ var _common_NothingFound__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ../common/NothingFound */ "./src/components/common/NothingFound.tsx");
/* harmony import */ var _common_PreviewMedia__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../common/PreviewMedia */ "./src/components/common/PreviewMedia.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _common_profile_ChatExtra__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ../common/profile/ChatExtra */ "./src/components/common/profile/ChatExtra.tsx");
/* harmony import */ var _common_ProfileInfo__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ../common/ProfileInfo */ "./src/components/common/ProfileInfo.tsx");
/* harmony import */ var _common_WebLink__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ../common/WebLink */ "./src/components/common/WebLink.tsx");
/* harmony import */ var _left_main_ChatList__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ../left/main/ChatList */ "./src/components/left/main/ChatList.tsx");
/* harmony import */ var _story_MediaStory__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ../story/MediaStory */ "./src/components/story/MediaStory.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ../ui/FloatingActionButton */ "./src/components/ui/FloatingActionButton.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _DeleteMemberModal__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ./DeleteMemberModal */ "./src/components/right/DeleteMemberModal.tsx");
/* harmony import */ var _Profile_scss__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ./Profile.scss */ "./src/components/right/Profile.scss");


























































const TABS = [{
  type: 'media',
  key: 'ProfileTabMedia'
}, {
  type: 'documents',
  key: 'ProfileTabFiles'
}, {
  type: 'links',
  key: 'ProfileTabLinks'
}, {
  type: 'audio',
  key: 'ProfileTabMusic'
}];
const HIDDEN_RENDER_DELAY = 1000;
const INTERSECTION_THROTTLE = 500;
const Profile = ({
  chatId,
  isActive,
  threadId,
  profileState,
  theme,
  monoforumChannel,
  isChannel,
  isBot,
  currentUserId,
  messagesById,
  foundIds,
  storyIds,
  pinnedStoryIds,
  archiveStoryIds,
  storyByIds,
  mediaSearchType,
  hasCommonChatsTab,
  hasStoriesTab,
  hasMembersTab,
  hasPreviewMediaTab,
  hasGiftsTab,
  gifts,
  botPreviewMedia,
  areMembersHidden,
  canAddMembers,
  canDeleteMembers,
  commonChatIds,
  members,
  adminMembersById,
  usersById,
  userStatusesById,
  chatsById,
  isRightColumnShown,
  isRestricted,
  activeDownloads,
  isChatProtected,
  nextProfileTab,
  animationLevel,
  shouldWarnAboutSvg,
  similarChannels,
  similarBots,
  isCurrentUserPremium,
  limitSimilarPeers,
  isTopicInfo,
  isSavedDialog,
  forceScrollProfileTab,
  isSynced,
  onProfileStateChange
}) => {
  const {
    setSharedMediaSearchType,
    loadMoreMembers,
    loadCommonChats,
    openChat,
    searchSharedMediaMessages,
    openMediaViewer,
    openAudioPlayer,
    focusMessage,
    setNewChatMembersDialogState,
    loadPeerProfileStories,
    loadStoriesArchive,
    openPremiumModal,
    loadChannelRecommendations,
    loadBotRecommendations,
    loadPreviewMedias,
    loadPeerSavedGifts,
    resetGiftProfileFilter
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const transitionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_27__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_25__["default"])();
  const [deletingUserId, setDeletingUserId] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const profileId = isSavedDialog ? String(threadId) : chatId;
  const isSavedMessages = profileId === currentUserId && !isSavedDialog;
  const tabs = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const arr = [];
    if (isSavedMessages && !isSavedDialog) {
      arr.push({
        type: 'dialogs',
        key: 'ProfileTabSavedDialogs'
      });
    }
    if (hasStoriesTab) {
      arr.push({
        type: 'stories',
        key: 'ProfileTabStories'
      });
    }
    if (hasStoriesTab && isSavedMessages) {
      arr.push({
        type: 'storiesArchive',
        key: 'ProfileTabStoriesArchive'
      });
    }
    if (hasGiftsTab) {
      arr.push({
        type: 'gifts',
        key: 'ProfileTabGifts'
      });
    }
    if (hasMembersTab) {
      arr.push({
        type: 'members',
        key: isChannel ? 'ProfileTabSubscribers' : 'ProfileTabMembers'
      });
    }
    if (hasPreviewMediaTab) {
      arr.push({
        type: 'previewMedia',
        key: 'ProfileTabBotPreview'
      });
    }
    arr.push(...TABS);

    // Voice messages filter currently does not work in forum topics. Return it when it's fixed on the server side.
    if (!isTopicInfo) {
      arr.push({
        type: 'voice',
        key: 'ProfileTabVoice'
      });
    }
    if (hasCommonChatsTab) {
      arr.push({
        type: 'commonChats',
        key: 'ProfileTabSharedGroups'
      });
    }
    if (isChannel && similarChannels?.length) {
      arr.push({
        type: 'similarChannels',
        key: 'ProfileTabSimilarChannels'
      });
    }
    if (isBot && similarBots?.length) {
      arr.push({
        type: 'similarBots',
        key: 'ProfileTabSimilarBots'
      });
    }
    return arr.map(tab => ({
      type: tab.type,
      title: lang(tab.key)
    }));
  }, [isSavedMessages, isSavedDialog, hasStoriesTab, hasGiftsTab, hasMembersTab, hasPreviewMediaTab, isTopicInfo, hasCommonChatsTab, isChannel, isBot, similarChannels?.length, similarBots?.length, lang]);
  const initialTab = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!nextProfileTab) {
      return 0;
    }
    const index = tabs.findIndex(({
      type
    }) => type === nextProfileTab);
    return index === -1 ? 0 : index;
  }, [nextProfileTab, tabs]);
  const [allowAutoScrollToTabs, startAutoScrollToTabsIfNeeded, stopAutoScrollToTabs] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_23__["default"])(false);
  const [activeTab, setActiveTab] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(initialTab);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!nextProfileTab) return;
    const index = tabs.findIndex(({
      type
    }) => type === nextProfileTab);
    if (index === -1) return;
    setActiveTab(index);
  }, [nextProfileTab, tabs]);
  const handleSwitchTab = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(index => {
    startAutoScrollToTabsIfNeeded();
    setActiveTab(index);
  }, []);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasPreviewMediaTab && !botPreviewMedia) {
      loadPreviewMedias({
        botId: chatId
      });
    }
  }, [chatId, botPreviewMedia, hasPreviewMediaTab]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isChannel && !similarChannels && isSynced) {
      loadChannelRecommendations({
        chatId
      });
    }
  }, [chatId, isChannel, similarChannels, isSynced]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isBot && !similarBots && isSynced) {
      loadBotRecommendations({
        userId: chatId
      });
    }
  }, [chatId, isBot, similarBots, isSynced]);
  const [renderingGifts, setRenderingGifts] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(gifts);
  const {
    startViewTransition,
    shouldApplyVtn
  } = (0,_hooks_animations_useViewTransition__WEBPACK_IMPORTED_MODULE_19__.useViewTransition)();
  const giftIds = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => renderingGifts?.map(gift => (0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_6__.getSavedGiftKey)(gift)), [renderingGifts]);
  const renderingActiveTab = activeTab > tabs.length - 1 ? tabs.length - 1 : activeTab;
  const tabType = tabs[renderingActiveTab].type;
  const handleLoadCommonChats = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    loadCommonChats({
      userId: chatId
    });
  }, [chatId]);
  const handleLoadPeerStories = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(({
    offsetId
  }) => {
    loadPeerProfileStories({
      peerId: chatId,
      offsetId
    });
  }, [chatId]);
  const handleLoadStoriesArchive = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(({
    offsetId
  }) => {
    loadStoriesArchive({
      peerId: chatId,
      offsetId
    });
  }, [chatId]);
  const handleLoadGifts = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    loadPeerSavedGifts({
      peerId: chatId
    });
  }, [chatId]);
  const handleLoadMoreMembers = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    loadMoreMembers({
      chatId
    });
  }, [chatId, loadMoreMembers]);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_22__["default"])(([prevGifts]) => {
    if (!gifts || !prevGifts) {
      setRenderingGifts(gifts);
      return;
    }
    const prevGiftIds = prevGifts.map(gift => (0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_6__.getSavedGiftKey)(gift));
    const newGiftIds = gifts.map(gift => (0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_6__.getSavedGiftKey)(gift));
    const hasOrderChanged = prevGiftIds.some((id, index) => id !== newGiftIds[index]);
    if (hasOrderChanged) {
      startViewTransition(() => {
        setRenderingGifts(gifts);
      });
    } else {
      setRenderingGifts(gifts);
    }
  }, [gifts, startViewTransition]);
  const [resultType, viewportIds, getMore, noProfileInfo] = (0,_hooks_useProfileViewportIds__WEBPACK_IMPORTED_MODULE_30__["default"])({
    loadMoreMembers: handleLoadMoreMembers,
    searchMessages: searchSharedMediaMessages,
    loadStories: handleLoadPeerStories,
    loadStoriesArchive: handleLoadStoriesArchive,
    loadMoreGifts: handleLoadGifts,
    loadCommonChats: handleLoadCommonChats,
    tabType,
    mediaSearchType,
    groupChatMembers: members,
    commonChatIds,
    usersById,
    userStatusesById,
    chatsById,
    chatMessages: messagesById,
    foundIds,
    threadId,
    storyIds,
    giftIds,
    pinnedStoryIds,
    archiveStoryIds,
    similarChannels,
    similarBots
  });
  const isFirstTab = isSavedMessages && resultType === 'dialogs' || hasStoriesTab && resultType === 'stories' || resultType === 'members' || !hasMembersTab && resultType === 'media';
  const activeKey = tabs.findIndex(({
    type
  }) => type === resultType);
  (0,_hooks_polling_usePeerStoriesPolling__WEBPACK_IMPORTED_MODULE_20__["default"])(resultType === 'members' ? viewportIds : undefined);
  const handleStopAutoScrollToTabs = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(() => {
    stopAutoScrollToTabs();
  });
  const {
    handleScroll
  } = (0,_hooks_useProfileState__WEBPACK_IMPORTED_MODULE_29__["default"])(containerRef, resultType, profileState, onProfileStateChange, forceScrollProfileTab, allowAutoScrollToTabs, handleStopAutoScrollToTabs);
  const {
    applyTransitionFix,
    releaseTransitionFix
  } = (0,_hooks_useTransitionFixes__WEBPACK_IMPORTED_MODULE_31__["default"])(containerRef);
  const [cacheBuster, resetCacheBuster] = (0,_hooks_useCacheBuster__WEBPACK_IMPORTED_MODULE_21__["default"])();
  const {
    observe: observeIntersectionForMedia
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_24__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE
  });
  const handleTransitionStop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(() => {
    releaseTransitionFix();
    resetCacheBuster();
  });
  const handleNewMemberDialogOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(() => {
    setNewChatMembersDialogState({
      newChatMembersProgress: _types__WEBPACK_IMPORTED_MODULE_3__.NewChatMembersProgress.InProgress
    });
  });

  // Update search type when switching tabs or forum topics
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setSharedMediaSearchType({
      mediaType: tabType
    });
  }, [setSharedMediaSearchType, tabType, threadId]);
  const handleSelectMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(messageId => {
    openMediaViewer({
      chatId: profileId,
      threadId: _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
      messageId,
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.MediaViewerOrigin.SharedMedia
    });
  });
  const handleSelectPreviewMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(index => {
    openMediaViewer({
      standaloneMedia: botPreviewMedia?.flatMap(item => item?.content.photo || item?.content.video).filter(Boolean),
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.MediaViewerOrigin.PreviewMedia,
      mediaIndex: index
    });
  });
  const handlePlayAudio = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(messageId => {
    openAudioPlayer({
      chatId: profileId,
      messageId
    });
  });
  const handleMemberClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(id => {
    openChat({
      id
    });
  });
  const handleMessageFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(message => {
    focusMessage({
      chatId: message.chatId,
      messageId: message.id
    });
  });
  const handleDeleteMembersModalClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(() => {
    setDeletingUserId(undefined);
  });
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_22__["default"])(([prevHasMemberTabs]) => {
    if (prevHasMemberTabs === undefined || activeTab === 0 || prevHasMemberTabs === hasMembersTab) {
      return;
    }
    const newActiveTab = activeTab + (hasMembersTab ? 1 : -1);
    setActiveTab(Math.min(newActiveTab, tabs.length - 1));
  }, [hasMembersTab, activeTab, tabs]);
  const handleResetGiftsFilter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_26__["default"])(() => {
    resetGiftProfileFilter({
      peerId: chatId
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!transitionRef.current || !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__.IS_TOUCH_ENV) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_13__.captureEvents)(transitionRef.current, {
      selectorToPreventScroll: '.Profile',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_13__.SwipeDirection.Left) {
          setActiveTab(Math.min(renderingActiveTab + 1, tabs.length - 1));
          return true;
        } else if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_13__.SwipeDirection.Right) {
          setActiveTab(Math.max(0, renderingActiveTab - 1));
          return true;
        }
        return false;
      }
    });
  }, [renderingActiveTab, tabs.length]);
  let renderingDelay;
  // @optimization Used to unparallelize rendering of message list and profile media
  if (isFirstTab) {
    renderingDelay = !isRightColumnShown ? HIDDEN_RENDER_DELAY : 0;
    // @optimization Used to delay first render of secondary tabs while animating
  } else if (!viewportIds && !botPreviewMedia) {
    renderingDelay = _config__WEBPACK_IMPORTED_MODULE_4__.SLIDE_TRANSITION_DURATION;
  }
  const canRenderContent = (0,_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_28__["default"])([chatId, threadId, resultType, renderingActiveTab], renderingDelay);
  function getMemberContextAction(memberId) {
    return memberId === currentUserId || !canDeleteMembers ? undefined : [{
      title: oldLang('lng_context_remove_from_group'),
      icon: 'stop',
      handler: () => {
        setDeletingUserId(memberId);
      }
    }];
  }
  function renderNothingFoundGiftsWithFilter() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "nothing-found-gifts"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_32__["default"], {
      size: 160,
      tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_16__.LOCAL_TGS_URLS.SearchingDuck,
      nonInteractive: true,
      noLoop: true
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "description"
    }, lang('GiftSearchEmpty')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_50__["default"], {
      className: "date",
      onClick: handleResetGiftsFilter
    }, lang('GiftSearchReset')));
  }
  function renderContent() {
    if (resultType === 'dialogs') {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_left_main_ChatList__WEBPACK_IMPORTED_MODULE_45__["default"], {
        className: "saved-dialogs",
        folderType: "saved",
        isActive: true
      });
    }
    const noContent = !viewportIds && !botPreviewMedia || !canRenderContent || !messagesById;
    const noSpinner = isFirstTab && !canRenderContent;
    const isSpinner = noContent && !noSpinner;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_54__["default"], {
      activeKey: isSpinner ? 0 : 1,
      name: "fade"
    }, renderSpinnerOrContent(noContent, noSpinner));
  }
  function renderSpinnerOrContent(noContent, noSpinner) {
    if (noContent) {
      const forceRenderHiddenMembers = Boolean(resultType === 'members' && areMembersHidden);
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "content empty-list"
      }, !noSpinner && !forceRenderHiddenMembers && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_52__["default"], null), forceRenderHiddenMembers && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_NothingFound__WEBPACK_IMPORTED_MODULE_39__["default"], {
        text: "You have no access to group members list."
      }));
    }
    const isViewportIdsEmpty = viewportIds && !viewportIds?.length;
    if (isViewportIdsEmpty && resultType === 'gifts') {
      return renderNothingFoundGiftsWithFilter();
    }
    if (isViewportIdsEmpty) {
      let text;
      switch (resultType) {
        case 'members':
          text = areMembersHidden ? 'You have no access to group members list.' : 'No members found';
          break;
        case 'commonChats':
          text = oldLang('NoGroupsInCommon');
          break;
        case 'documents':
          text = oldLang('lng_media_file_empty');
          break;
        case 'links':
          text = oldLang('lng_media_link_empty');
          break;
        case 'audio':
          text = oldLang('lng_media_song_empty');
          break;
        case 'voice':
          text = oldLang('lng_media_audio_empty');
          break;
        case 'stories':
          text = oldLang('StoryList.SavedEmptyState.Title');
          break;
        case 'storiesArchive':
          text = oldLang('StoryList.ArchivedEmptyState.Title');
          break;
        default:
          text = oldLang('SharedMedia.EmptyTitle');
      }
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "content empty-list"
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_NothingFound__WEBPACK_IMPORTED_MODULE_39__["default"], {
        text: text
      }));
    }
    if (!messagesById) {
      // A TypeScript assertion, should never be really reached
      return;
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: `content ${resultType}-list`,
      dir: oldLang.isRtl && resultType === 'media' ? 'rtl' : undefined,
      teactFastList: true
    }, resultType === 'media' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Media__WEBPACK_IMPORTED_MODULE_38__["default"], {
      key: id,
      message: messagesById[id],
      isProtected: isChatProtected || messagesById[id].isProtected,
      observeIntersection: observeIntersectionForMedia,
      onClick: handleSelectMedia
    })) : resultType === 'stories' || resultType === 'storiesArchive' ? viewportIds.map((id, i) => storyByIds?.[id] && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_story_MediaStory__WEBPACK_IMPORTED_MODULE_46__["default"], {
      teactOrderKey: i,
      key: `${resultType}_${id}`,
      story: storyByIds[id],
      isArchive: resultType === 'storiesArchive'
    })) : resultType === 'documents' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Document__WEBPACK_IMPORTED_MODULE_34__["default"], {
      key: id,
      document: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageDocument)(messagesById[id]),
      withDate: true,
      smaller: true,
      className: "scroll-item",
      isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsDownloading)(activeDownloads, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageDocument)(messagesById[id])),
      observeIntersection: observeIntersectionForMedia,
      onDateClick: handleMessageFocus,
      message: messagesById[id],
      shouldWarnAboutSvg: shouldWarnAboutSvg
    })) : resultType === 'links' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_WebLink__WEBPACK_IMPORTED_MODULE_44__["default"], {
      key: id,
      message: messagesById[id],
      isProtected: isChatProtected || messagesById[id].isProtected,
      observeIntersection: observeIntersectionForMedia,
      onMessageClick: handleMessageFocus
    })) : resultType === 'audio' ? viewportIds.map(id => messagesById[id] && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Audio__WEBPACK_IMPORTED_MODULE_33__["default"], {
      key: id,
      theme: theme,
      message: messagesById[id],
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.SharedMedia,
      date: messagesById[id].date,
      className: "scroll-item",
      onPlay: handlePlayAudio,
      onDateClick: handleMessageFocus,
      canDownload: !isChatProtected && !messagesById[id].isProtected,
      isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsDownloading)(activeDownloads, messagesById[id].content.audio)
    })) : resultType === 'voice' ? viewportIds.map(id => {
      const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
      const message = messagesById[id];
      if (!message) return undefined;
      const media = (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_9__.selectMessageDownloadableMedia)(global, message);
      return messagesById[id] && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Audio__WEBPACK_IMPORTED_MODULE_33__["default"], {
        key: id,
        theme: theme,
        message: message,
        senderTitle: (0,_left_search_helpers_getSenderName__WEBPACK_IMPORTED_MODULE_18__.getSenderName)(oldLang, message, chatsById, usersById),
        origin: _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.SharedMedia,
        date: message.date,
        className: "scroll-item",
        onPlay: handlePlayAudio,
        onDateClick: handleMessageFocus,
        canDownload: !isChatProtected && !message.isProtected,
        isDownloading: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsDownloading)(activeDownloads, media)
      });
    }) : resultType === 'members' ? viewportIds.map((id, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_51__["default"], {
      key: id,
      teactOrderKey: i,
      className: "chat-item-clickable contact-list-item scroll-item small-icon",
      onClick: () => handleMemberClick(id),
      contextActions: getMemberContextAction(id)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_41__["default"], {
      userId: id,
      adminMember: adminMembersById?.[id],
      forceShowSelf: true,
      withStory: true
    }))) : resultType === 'commonChats' ? viewportIds.map((id, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_51__["default"], {
      key: id,
      teactOrderKey: i,
      className: "chat-item-clickable scroll-item small-icon",
      onClick: () => openChat({
        id
      })
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_36__["default"], {
      chatId: id
    }))) : resultType === 'previewMedia' ? botPreviewMedia.map((media, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PreviewMedia__WEBPACK_IMPORTED_MODULE_40__["default"], {
      key: media.date,
      media: media,
      isProtected: isChatProtected,
      observeIntersection: observeIntersectionForMedia,
      onClick: handleSelectPreviewMedia,
      index: i
    })) : resultType === 'similarChannels' ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      key: resultType
    }, viewportIds.map((channelId, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_51__["default"], {
      key: channelId,
      teactOrderKey: i,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('chat-item-clickable search-result', !isCurrentUserPremium && i === similarChannels.length - 1 && 'blured'),
      onClick: () => openChat({
        id: channelId
      })
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_36__["default"], {
      avatarSize: "large",
      chatId: channelId,
      withFullInfo: true
    }))), !isCurrentUserPremium && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_47__["default"], {
      className: "show-more-channels",
      size: "smaller",
      onClick: () => openPremiumModal()
    }, oldLang('UnlockSimilar'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_37__["default"], {
      name: "unlock-badge"
    })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "more-similar"
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_17__["default"])(oldLang('MoreSimilarText', limitSimilarPeers), ['simple_markdown'])))) : resultType === 'similarBots' ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      key: resultType
    }, viewportIds.map((userId, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_51__["default"], {
      key: userId,
      teactOrderKey: i,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('chat-item-clickable search-result', !isCurrentUserPremium && i === similarBots.length - 1 && 'blured'),
      onClick: () => openChat({
        id: userId
      })
    }, (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_14__.isUserId)(userId) ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_41__["default"], {
      userId: userId,
      avatarSize: "medium"
    }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_36__["default"], {
      chatId: userId,
      avatarSize: "medium"
    }))), !isCurrentUserPremium && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_47__["default"], {
      className: "show-more-bots",
      size: "smaller",
      onClick: () => openPremiumModal()
    }, lang('UnlockMoreSimilarBots'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_37__["default"], {
      name: "unlock-badge"
    })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "more-similar"
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_17__["default"])(lang('MoreSimilarBotsDescription', {
      count: limitSimilarPeers
    }, {
      withNodes: true,
      withMarkdown: true,
      pluralValue: limitSimilarPeers
    }))))) : resultType === 'gifts' ? renderingGifts?.map(gift => {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_gift_SavedGift__WEBPACK_IMPORTED_MODULE_35__["default"], {
        peerId: chatId,
        key: (0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_6__.getSavedGiftKey)(gift),
        style: shouldApplyVtn ? `view-transition-name: vt${(0,_global_helpers_stars__WEBPACK_IMPORTED_MODULE_6__.getSavedGiftKey)(gift)}` : undefined,
        gift: gift,
        observeIntersection: observeIntersectionForMedia
      });
    }) : undefined);
  }
  const activeListSelector = `.shared-media-transition > .Transition_slide-active.${resultType}-list`;
  const itemSelector = `${activeListSelector} > .scroll-item`;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_49__["default"], {
    ref: containerRef,
    className: "Profile custom-scroll",
    itemSelector: itemSelector,
    items: canRenderContent ? viewportIds : undefined,
    cacheBuster: cacheBuster,
    sensitiveArea: _config__WEBPACK_IMPORTED_MODULE_4__.PROFILE_SENSITIVE_AREA,
    preloadBackwards: canRenderContent ? resultType === 'members' ? _config__WEBPACK_IMPORTED_MODULE_4__.MEMBERS_SLICE : _config__WEBPACK_IMPORTED_MODULE_4__.SHARED_MEDIA_SLICE : 0
    // To prevent scroll jumps caused by reordering member list
    ,
    noScrollRestoreOnTop: true,
    noFastList: true,
    onLoadMore: getMore,
    onScroll: handleScroll
  }, !noProfileInfo && !isSavedMessages && renderProfileInfo(monoforumChannel?.id || profileId, isRightColumnShown && canRenderContent, isSavedDialog, Boolean(monoforumChannel)), !isRestricted && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "shared-media"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_54__["default"], {
    ref: transitionRef,
    name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_15__.resolveTransitionName)('slideOptimized', animationLevel, undefined, oldLang.isRtl),
    activeKey: activeKey,
    renderCount: tabs.length,
    shouldRestoreHeight: true,
    className: "shared-media-transition",
    onStart: applyTransitionFix,
    onStop: handleTransitionStop
  }, renderContent()), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TabList__WEBPACK_IMPORTED_MODULE_53__["default"], {
    activeTab: renderingActiveTab,
    tabs: tabs,
    onSwitchTab: handleSwitchTab
  })), canAddMembers && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_FloatingActionButton__WEBPACK_IMPORTED_MODULE_48__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])(!isActive && 'hidden'),
    isShown: canRenderContent,
    onClick: handleNewMemberDialogOpen,
    ariaLabel: oldLang('lng_channel_add_users')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_37__["default"], {
    name: "add-user-filled"
  })), canDeleteMembers && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DeleteMemberModal__WEBPACK_IMPORTED_MODULE_55__["default"], {
    isOpen: Boolean(deletingUserId),
    userId: deletingUserId,
    onClose: handleDeleteMembersModalClose
  }));
};
function renderProfileInfo(profileId, isReady, isSavedDialog, isForMonoforum) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "profile-info"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_ProfileInfo__WEBPACK_IMPORTED_MODULE_43__["default"], {
    peerId: profileId,
    canPlayVideo: isReady,
    isForMonoforum: isForMonoforum
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_profile_ChatExtra__WEBPACK_IMPORTED_MODULE_42__["default"], {
    chatOrUserId: profileId,
    isSavedDialog: isSavedDialog
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId,
  isMobile
}) => {
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, chatId);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const chatFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatFullInfo)(global, chatId);
  const userFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUserFullInfo)(global, chatId);
  const messagesById = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessages)(global, chatId);
  const {
    animationLevel,
    shouldWarnAboutSvg
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_10__.selectSharedSettings)(global);
  const {
    currentType: mediaSearchType,
    resultsByType
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentSharedMediaSearch)(global) || {};
  const {
    foundIds
  } = resultsByType && mediaSearchType && resultsByType[mediaSearchType] || {};
  const isTopicInfo = Boolean(chat?.isForum && threadId && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID);
  const {
    byId: usersById,
    statusesById: userStatusesById
  } = global.users;
  const {
    byId: chatsById
  } = global.chats;
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const isGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatGroup)(chat);
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat);
  const isBot = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserBot)(user);
  const hasMembersTab = !isTopicInfo && !isSavedDialog && (isGroup || isChannel && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatAdmin)(chat)) && !chat?.isMonoforum;
  const members = chatFullInfo?.members;
  const adminMembersById = chatFullInfo?.adminMembersById;
  const areMembersHidden = hasMembersTab && chat && (chat.isForbidden || chatFullInfo && !chatFullInfo.canViewMembers);
  const canAddMembers = hasMembersTab && chat && ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getHasAdminRight)(chat, 'inviteUsers') || !isChannel && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserRightBanned)(chat, 'inviteUsers') || chat.isCreator);
  const canDeleteMembers = hasMembersTab && chat && ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getHasAdminRight)(chat, 'banUsers') || chat.isCreator);
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectActiveDownloads)(global);
  const {
    similarChannelIds
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectSimilarChannelIds)(global, chatId) || {};
  const {
    similarBotsIds
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectSimilarBotsIds)(global, chatId) || {};
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsCurrentUserPremium)(global);
  const peer = user || chat;
  const peerFullInfo = userFullInfo || chatFullInfo;
  const hasCommonChatsTab = user && !user.isSelf && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserBot)(user) && !isSavedDialog && Boolean(userFullInfo?.commonChatsCount);
  const commonChats = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUserCommonChats)(global, chatId);
  const hasPreviewMediaTab = userFullInfo?.botInfo?.hasPreviewMedia;
  const botPreviewMedia = global.users.previewMediaByBotId[chatId];
  const hasStoriesTab = peer && (user?.isSelf || !peer.areStoriesHidden && peerFullInfo?.hasPinnedStories) && !isSavedDialog;
  const peerStories = hasStoriesTab ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeerStories)(global, peer.id) : undefined;
  const storyIds = peerStories?.profileIds;
  const pinnedStoryIds = peerStories?.pinnedIds;
  const storyByIds = peerStories?.byId;
  const archiveStoryIds = peerStories?.archiveIds;
  const hasGiftsTab = Boolean(peerFullInfo?.starGiftCount) && !isSavedDialog;
  const peerGifts = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global).savedGifts.giftsByPeerId[chatId];
  const monoforumChannel = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectMonoforumChannel)(global, chatId);
  const isRestricted = chat && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatRestricted)(global, chat.id);
  return {
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTheme)(global),
    isChannel,
    isBot,
    messagesById,
    foundIds,
    mediaSearchType,
    hasCommonChatsTab,
    hasStoriesTab,
    hasMembersTab,
    hasPreviewMediaTab,
    areMembersHidden,
    canAddMembers,
    canDeleteMembers,
    currentUserId: global.currentUserId,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsRightColumnShown)(global, isMobile),
    isRestricted,
    activeDownloads,
    usersById,
    userStatusesById,
    chatsById,
    storyIds,
    hasGiftsTab,
    gifts: peerGifts?.gifts,
    pinnedStoryIds,
    archiveStoryIds,
    storyByIds,
    isChatProtected: chat?.isProtected,
    nextProfileTab: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global).nextProfileTab,
    forceScrollProfileTab: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global).forceScrollProfileTab,
    animationLevel,
    shouldWarnAboutSvg,
    similarChannels: similarChannelIds,
    similarBots: similarBotsIds,
    botPreviewMedia,
    isCurrentUserPremium,
    isTopicInfo,
    isSavedDialog,
    isSynced: global.isSynced,
    limitSimilarPeers: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_8__.selectPremiumLimit)(global, 'recommendedChannels'),
    ...(hasMembersTab && members && {
      members,
      adminMembersById
    }),
    ...(hasCommonChatsTab && user && {
      commonChatIds: commonChats?.ids
    }),
    monoforumChannel
  };
})(Profile)));

/***/ },

/***/ "./src/components/right/RightColumn.scss"
/*!***********************************************!*\
  !*** ./src/components/right/RightColumn.scss ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/right/RightColumn.tsx"
/*!**********************************************!*\
  !*** ./src/components/right/RightColumn.tsx ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors/sharedState.ts */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _chatAssistant_room_ai_room_ai_wrapper__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../chatAssistant/room-ai/room-ai-wrapper */ "./src/components/chatAssistant/room-ai/room-ai-wrapper.tsx");
/* harmony import */ var _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../chatAssistant/variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useScrollNotch_ts__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useScrollNotch.ts */ "./src/hooks/useScrollNotch.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _AddChatMembers__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./AddChatMembers */ "./src/components/right/AddChatMembers.tsx");
/* harmony import */ var _CreateTopic_async__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./CreateTopic.async */ "./src/components/right/CreateTopic.async.tsx");
/* harmony import */ var _EditTopic_async__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./EditTopic.async */ "./src/components/right/EditTopic.async.tsx");
/* harmony import */ var _GifSearch_async__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./GifSearch.async */ "./src/components/right/GifSearch.async.tsx");
/* harmony import */ var _management_Management_async__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./management/Management.async */ "./src/components/right/management/Management.async.tsx");
/* harmony import */ var _PollResults_async__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./PollResults.async */ "./src/components/right/PollResults.async.tsx");
/* harmony import */ var _Profile__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./Profile */ "./src/components/right/Profile.tsx");
/* harmony import */ var _RightHeader__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./RightHeader */ "./src/components/right/RightHeader.tsx");
/* harmony import */ var _statistics_BoostStatistics__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./statistics/BoostStatistics */ "./src/components/right/statistics/BoostStatistics.tsx");
/* harmony import */ var _statistics_MessageStatistics_async__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./statistics/MessageStatistics.async */ "./src/components/right/statistics/MessageStatistics.async.tsx");
/* harmony import */ var _statistics_MonetizationStatistics__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./statistics/MonetizationStatistics */ "./src/components/right/statistics/MonetizationStatistics.tsx");
/* harmony import */ var _statistics_Statistics_async__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./statistics/Statistics.async */ "./src/components/right/statistics/Statistics.async.tsx");
/* harmony import */ var _statistics_StoryStatistics_async__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./statistics/StoryStatistics.async */ "./src/components/right/statistics/StoryStatistics.async.tsx");
/* harmony import */ var _StickerSearch_async__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./StickerSearch.async */ "./src/components/right/StickerSearch.async.tsx");
/* harmony import */ var _userPortrait_UserPortrait__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./userPortrait/UserPortrait */ "./src/components/right/userPortrait/UserPortrait.tsx");
/* harmony import */ var _RightColumn_scss__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./RightColumn.scss */ "./src/components/right/RightColumn.scss");



































const ANIMATION_DURATION = 450 + _config__WEBPACK_IMPORTED_MODULE_3__.ANIMATION_END_DELAY;
const MAIN_SCREENS_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent).length / 2;
const MANAGEMENT_SCREENS_COUNT = Object.keys(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens).length / 2;
function blurSearchInput() {
  const searchInput = document.querySelector('.RightHeader .SearchInput input');
  if (searchInput) {
    searchInput.blur();
  }
}
const RightColumn = ({
  contentKey,
  chatId,
  threadId,
  isMobile,
  isChatSelected,
  animationLevel,
  shouldSkipHistoryAnimations,
  nextManagementScreen,
  nextProfileTab,
  shouldCloseRightColumn,
  isSavedMessages,
  isSavedDialog,
  userPortraitUserId
}) => {
  const {
    toggleChatInfo,
    toggleChatAIInfo,
    toggleManagement,
    setStickerSearchQuery,
    setGifSearchQuery,
    closePollResults,
    addChatMembers,
    setNewChatMembersDialogState,
    setEditingExportedInvite,
    toggleStatistics,
    toggleMessageStatistics,
    toggleStoryStatistics,
    setOpenedInviteInfo,
    requestNextManagementScreen,
    resetNextProfileTab,
    closeCreateTopicPanel,
    closeEditTopicPanel,
    closeBoostStatistics,
    setShouldCloseRightColumn,
    closeMonetizationStatistics,
    openChatAIWithInfo,
    toggleUserPortrait
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    width: windowWidth
  } = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const [profileState, setProfileState] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(isSavedMessages && !isSavedDialog ? _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.SavedDialogs : _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
  const [managementScreen, setManagementScreen] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
  const [selectedChatMemberId, setSelectedChatMemberId] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isPromotedByCurrentUser, setIsPromotedByCurrentUser] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const isScrolledDown = profileState !== _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile;
  const isOpen = contentKey !== undefined;
  const isProfile = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo;
  const isChatAI = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatAI;
  const isManagement = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management;
  const isStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics;
  const isMessageStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics;
  const isStoryStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics;
  const isBoostStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics;
  const isMonetizationStatistics = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MonetizationStatistics;
  const isStickerSearch = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch;
  const isGifSearch = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch;
  const isPollResults = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults;
  const isAddingChatMembers = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers;
  const isCreatingTopic = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic;
  const isEditingTopic = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic;
  const isUserPortrait = contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.UserPortrait;
  const isOverlaying = windowWidth <= _config__WEBPACK_IMPORTED_MODULE_3__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN;
  const [shouldSkipTransition, setShouldSkipTransition] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isOpen);
  const renderingContentKey = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_11__["default"])(contentKey, true, !isChatSelected) ?? -1;
  (0,_hooks_useScrollNotch_ts__WEBPACK_IMPORTED_MODULE_15__["default"])({
    containerRef,
    selector: ':scope .custom-scroll, :scope .panel-content'
  }, [contentKey, managementScreen, chatId, threadId]);
  const close = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])((shouldScrollUp = true) => {
    switch (contentKey) {
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers:
        setNewChatMembersDialogState({
          newChatMembersProgress: _types__WEBPACK_IMPORTED_MODULE_2__.NewChatMembersProgress.Closed
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo:
        if (isScrolledDown && shouldScrollUp && !isSavedMessages) {
          setProfileState(_types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
          break;
        }
        toggleChatInfo({
          force: false
        }, {
          forceSyncOnIOs: true
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatAI:
        toggleChatAIInfo({
          force: false
        }, {
          forceSyncOnIOs: true
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.UserPortrait:
        toggleUserPortrait({
          force: false
        }, {
          forceSyncOnIOs: true
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management:
        {
          switch (managementScreen) {
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial:
              toggleManagement();
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatPrivacyType:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Discussion:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupPermissions:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupType:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdministrators:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChannelSubscribers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupMembers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Invites:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Reactions:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.JoinRequests:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChannelRemovedUsers:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupUserPermissionsCreate:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupRemovedUsers:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupUserPermissions:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupPermissions);
              setSelectedChatMemberId(undefined);
              setIsPromotedByCurrentUser(undefined);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.NewDiscussionGroup:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Discussion);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdminRights:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatNewAdminRights:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupAddAdmins:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.GroupRecentActions:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.ChatAdministrators);
              break;
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.EditInvite:
            case _types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.InviteInfo:
              setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Invites);
              setOpenedInviteInfo({
                chatId: chatId,
                invite: undefined
              });
              setEditingExportedInvite({
                chatId: chatId,
                invite: undefined
              });
              break;
          }
          break;
        }
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics:
        toggleMessageStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics:
        toggleStoryStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics:
        toggleStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics:
        closeBoostStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MonetizationStatistics:
        closeMonetizationStatistics();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch:
        blurSearchInput();
        setStickerSearchQuery({
          query: undefined
        });
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch:
        {
          blurSearchInput();
          setGifSearchQuery({
            query: undefined
          });
          break;
        }
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults:
        closePollResults();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic:
        closeCreateTopicPanel();
        break;
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic:
        closeEditTopicPanel();
        break;
    }
  });
  const handleSelectChatMember = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])((memberId, isPromoted) => {
    setSelectedChatMemberId(memberId);
    setIsPromotedByCurrentUser(isPromoted);
  });
  const handleAppendingChatMembers = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(memberIds => {
    addChatMembers({
      chatId: chatId,
      memberIds
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isOpen && chatId ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_7__["default"])(close) : undefined, [isOpen, close, chatId]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setTimeout(() => {
      setShouldSkipTransition(!isOpen);
    }, ANIMATION_DURATION);
  }, [isOpen]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (nextManagementScreen) {
      setManagementScreen(nextManagementScreen);
      requestNextManagementScreen(undefined);
    }
  }, [nextManagementScreen]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!nextProfileTab) return;
    resetNextProfileTab();
  }, [nextProfileTab]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldCloseRightColumn) {
      close();
      setShouldCloseRightColumn({
        value: undefined
      });
    }
  }, [shouldCloseRightColumn]);

  // Close Right Column when it transforms into overlayed state on screen resize
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen && isOverlaying) {
      close();
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [isOverlaying]);

  // We need to clear profile state and management screen state, when changing chats
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_14__["default"])(([prevChatId, prevThreadId]) => {
    if (prevChatId !== chatId || prevThreadId !== threadId) {
      setProfileState(isSavedMessages && !isSavedDialog ? _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.SavedDialogs : _types__WEBPACK_IMPORTED_MODULE_2__.ProfileState.Profile);
      setManagementScreen(_types__WEBPACK_IMPORTED_MODULE_2__.ManagementScreens.Initial);
    }
  }, [chatId, threadId, isSavedDialog, isSavedMessages]);
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_12__["default"])({
    isActive: isChatSelected && (contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic || contentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic),
    onBack: () => close(false)
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (renderingContentKey === -1 && chatId && !shouldCloseRightColumn && chatId !== _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_10__.GLOBAL_SUMMARY_CHATID) {
      openChatAIWithInfo({
        chatId
      });
    }
  }, [chatId, renderingContentKey, shouldCloseRightColumn, threadId]);
  function renderContent(isActive) {
    if (renderingContentKey === -1) {
      return undefined;
    }
    switch (renderingContentKey) {
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.AddingMembers:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AddChatMembers__WEBPACK_IMPORTED_MODULE_18__["default"], {
          key: `add_chat_members_${chatId}`,
          chatId: chatId,
          isActive: isOpen && isActive,
          onNextStep: handleAppendingChatMembers,
          onClose: close
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatInfo:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Profile__WEBPACK_IMPORTED_MODULE_24__["default"], {
          key: `profile_${chatId}_${threadId}`,
          chatId: chatId,
          threadId: threadId,
          profileState: profileState,
          isMobile: isMobile,
          isActive: isOpen && isActive,
          onProfileStateChange: setProfileState
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Management:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_management_Management_async__WEBPACK_IMPORTED_MODULE_22__["default"], {
          key: `management_${chatId}_${managementScreen}`,
          chatId: chatId,
          currentScreen: managementScreen,
          isPromotedByCurrentUser: isPromotedByCurrentUser,
          selectedChatMemberId: selectedChatMemberId,
          isActive: isOpen && isActive,
          onScreenSelect: setManagementScreen,
          onChatMemberSelect: handleSelectChatMember,
          onClose: close
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_Statistics_async__WEBPACK_IMPORTED_MODULE_29__["default"], {
          chatId: chatId
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.BoostStatistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_BoostStatistics__WEBPACK_IMPORTED_MODULE_26__["default"], null);
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MonetizationStatistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_MonetizationStatistics__WEBPACK_IMPORTED_MODULE_28__["default"], null);
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_MessageStatistics_async__WEBPACK_IMPORTED_MODULE_27__["default"], {
          chatId: chatId,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_statistics_StoryStatistics_async__WEBPACK_IMPORTED_MODULE_30__["default"], {
          chatId: chatId,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StickerSearch:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StickerSearch_async__WEBPACK_IMPORTED_MODULE_31__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.GifSearch:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_GifSearch_async__WEBPACK_IMPORTED_MODULE_21__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.PollResults:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PollResults_async__WEBPACK_IMPORTED_MODULE_23__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.CreateTopic:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_CreateTopic_async__WEBPACK_IMPORTED_MODULE_19__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.EditTopic:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_EditTopic_async__WEBPACK_IMPORTED_MODULE_20__["default"], {
          onClose: close,
          isActive: isOpen && isActive
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.ChatAI:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_room_ai_room_ai_wrapper__WEBPACK_IMPORTED_MODULE_9__["default"], {
          chatId: chatId,
          threadId: threadId,
          onClose: close
        });
      case _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.UserPortrait:
        return userPortraitUserId && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_userPortrait_UserPortrait__WEBPACK_IMPORTED_MODULE_32__["default"], {
          userId: userPortraitUserId
        });
    }
    return undefined; // Unreachable
  }
  if (chatId === _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_10__.GLOBAL_SUMMARY_CHATID) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "RightColumn-wrapper",
    className: !isChatSelected ? 'is-hidden' : undefined
  }, isOverlaying && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "overlay-backdrop",
    onClick: close
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "RightColumn"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_RightHeader__WEBPACK_IMPORTED_MODULE_25__["default"], {
    chatId: chatId,
    threadId: threadId,
    isColumnOpen: isOpen,
    isProfile: isProfile,
    isChatAI: isChatAI,
    isManagement: isManagement,
    isStatistics: isStatistics,
    isBoostStatistics: isBoostStatistics,
    isMonetizationStatistics: isMonetizationStatistics,
    isMessageStatistics: isMessageStatistics,
    isStoryStatistics: isStoryStatistics,
    isStickerSearch: isStickerSearch,
    isGifSearch: isGifSearch,
    isPollResults: isPollResults,
    isCreatingTopic: isCreatingTopic,
    isEditingTopic: isEditingTopic,
    isAddingChatMembers: isAddingChatMembers,
    isUserPortrait: isUserPortrait,
    profileState: profileState,
    managementScreen: managementScreen,
    onClose: close,
    onScreenSelect: setManagementScreen
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_17__["default"], {
    ref: containerRef,
    name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_8__.resolveTransitionName)('layers', animationLevel, shouldSkipTransition || shouldSkipHistoryAnimations),
    renderCount: MAIN_SCREENS_COUNT + MANAGEMENT_SCREENS_COUNT,
    activeKey: isManagement ? MAIN_SCREENS_COUNT + managementScreen : renderingContentKey,
    shouldCleanup: true,
    cleanupExceptionKey: renderingContentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.MessageStatistics || renderingContentKey === _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.StoryStatistics ? _types__WEBPACK_IMPORTED_MODULE_2__.RightColumnContent.Statistics : undefined
  }, renderContent)));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  isMobile
}) => {
  const {
    chatId,
    threadId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCurrentMessageList)(global) || {};
  const areActiveChatsLoaded = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectAreActiveChatsLoaded)(global);
  const {
    animationLevel
  } = (0,_global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_6__.selectSharedSettings)(global);
  const {
    management,
    shouldSkipHistoryAnimations,
    nextProfileTab,
    shouldCloseRightColumn
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const nextManagementScreen = chatId ? management.byChatId[chatId]?.nextScreen : undefined;
  const isSavedMessages = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsChatWithSelf)(global, chatId) : undefined;
  const isSavedDialog = chatId ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getIsSavedDialog)(chatId, threadId, global.currentUserId) : undefined;
  const {
    userPortraitUserId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  return {
    contentKey: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectRightColumnContentKey)(global, isMobile),
    chatId,
    threadId,
    isChatSelected: Boolean(chatId && areActiveChatsLoaded),
    animationLevel,
    shouldSkipHistoryAnimations,
    nextManagementScreen,
    nextProfileTab,
    shouldCloseRightColumn,
    isSavedMessages,
    isSavedDialog,
    userPortraitUserId
  };
})(RightColumn)));

/***/ },

/***/ "./src/components/right/RightHeader.scss"
/*!***********************************************!*\
  !*** ./src/components/right/RightHeader.scss ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/right/RightHeader.tsx"
/*!**********************************************!*\
  !*** ./src/components/right/RightHeader.tsx ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../chatAssistant/assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _chatAssistant_utils_icons__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../chatAssistant/utils/icons */ "./src/components/chatAssistant/utils/icons.tsx");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useElectronDrag */ "./src/hooks/useElectronDrag.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../ui/MenuSeparator */ "./src/components/ui/MenuSeparator.tsx");
/* harmony import */ var _ui_SearchInput__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../ui/SearchInput */ "./src/components/ui/SearchInput.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _RightHeader_scss__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./RightHeader.scss */ "./src/components/right/RightHeader.scss");






























const COLUMN_ANIMATION_DURATION = 450 + _config__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_END_DELAY;
var HeaderContent = /*#__PURE__*/function (HeaderContent) {
  HeaderContent[HeaderContent["Profile"] = 0] = "Profile";
  HeaderContent[HeaderContent["MemberList"] = 1] = "MemberList";
  HeaderContent[HeaderContent["GiftList"] = 2] = "GiftList";
  HeaderContent[HeaderContent["SharedMedia"] = 3] = "SharedMedia";
  HeaderContent[HeaderContent["StoryList"] = 4] = "StoryList";
  HeaderContent[HeaderContent["Search"] = 5] = "Search";
  HeaderContent[HeaderContent["Statistics"] = 6] = "Statistics";
  HeaderContent[HeaderContent["MessageStatistics"] = 7] = "MessageStatistics";
  HeaderContent[HeaderContent["StoryStatistics"] = 8] = "StoryStatistics";
  HeaderContent[HeaderContent["BoostStatistics"] = 9] = "BoostStatistics";
  HeaderContent[HeaderContent["MonetizationStatistics"] = 10] = "MonetizationStatistics";
  HeaderContent[HeaderContent["Management"] = 11] = "Management";
  HeaderContent[HeaderContent["ManageInitial"] = 12] = "ManageInitial";
  HeaderContent[HeaderContent["ManageChannelSubscribers"] = 13] = "ManageChannelSubscribers";
  HeaderContent[HeaderContent["ManageChatAdministrators"] = 14] = "ManageChatAdministrators";
  HeaderContent[HeaderContent["ManageChatPrivacyType"] = 15] = "ManageChatPrivacyType";
  HeaderContent[HeaderContent["ManageDiscussion"] = 16] = "ManageDiscussion";
  HeaderContent[HeaderContent["ManageGroupPermissions"] = 17] = "ManageGroupPermissions";
  HeaderContent[HeaderContent["ManageGroupRemovedUsers"] = 18] = "ManageGroupRemovedUsers";
  HeaderContent[HeaderContent["ManageChannelRemovedUsers"] = 19] = "ManageChannelRemovedUsers";
  HeaderContent[HeaderContent["ManageGroupUserPermissionsCreate"] = 20] = "ManageGroupUserPermissionsCreate";
  HeaderContent[HeaderContent["ManageGroupUserPermissions"] = 21] = "ManageGroupUserPermissions";
  HeaderContent[HeaderContent["ManageGroupRecentActions"] = 22] = "ManageGroupRecentActions";
  HeaderContent[HeaderContent["ManageGroupAdminRights"] = 23] = "ManageGroupAdminRights";
  HeaderContent[HeaderContent["ManageGroupNewAdminRights"] = 24] = "ManageGroupNewAdminRights";
  HeaderContent[HeaderContent["ManageGroupMembers"] = 25] = "ManageGroupMembers";
  HeaderContent[HeaderContent["ManageGroupAddAdmins"] = 26] = "ManageGroupAddAdmins";
  HeaderContent[HeaderContent["StickerSearch"] = 27] = "StickerSearch";
  HeaderContent[HeaderContent["GifSearch"] = 28] = "GifSearch";
  HeaderContent[HeaderContent["PollResults"] = 29] = "PollResults";
  HeaderContent[HeaderContent["AddingMembers"] = 30] = "AddingMembers";
  HeaderContent[HeaderContent["ManageInvites"] = 31] = "ManageInvites";
  HeaderContent[HeaderContent["ManageEditInvite"] = 32] = "ManageEditInvite";
  HeaderContent[HeaderContent["ManageReactions"] = 33] = "ManageReactions";
  HeaderContent[HeaderContent["ManageInviteInfo"] = 34] = "ManageInviteInfo";
  HeaderContent[HeaderContent["ManageJoinRequests"] = 35] = "ManageJoinRequests";
  HeaderContent[HeaderContent["CreateTopic"] = 36] = "CreateTopic";
  HeaderContent[HeaderContent["EditTopic"] = 37] = "EditTopic";
  HeaderContent[HeaderContent["SavedDialogs"] = 38] = "SavedDialogs";
  HeaderContent[HeaderContent["ChatAI"] = 39] = "ChatAI";
  HeaderContent[HeaderContent["UserPortrait"] = 40] = "UserPortrait";
  HeaderContent[HeaderContent["NewDiscussionGroup"] = 41] = "NewDiscussionGroup";
  return HeaderContent;
}(HeaderContent || {});
const RightHeader = ({
  chatId,
  threadId,
  isColumnOpen,
  isProfile,
  isChatAI,
  isManagement,
  isStatistics,
  isMessageStatistics,
  isStoryStatistics,
  isMonetizationStatistics,
  isBoostStatistics,
  isStickerSearch,
  isGifSearch,
  isPollResults,
  isCreatingTopic,
  isEditingTopic,
  isAddingChatMembers,
  profileState,
  managementScreen,
  canAddContact,
  userId,
  isSelf,
  canManage,
  isChannel,
  stickerSearchQuery,
  gifSearchQuery,
  isEditingInvite,
  canViewStatistics,
  currentInviteInfo,
  shouldSkipHistoryAnimations,
  isBot,
  isInsideTopic,
  isUserPortrait,
  canEditTopic,
  isSavedMessages,
  canEditBot,
  giftProfileFilter,
  canUseGiftFilter,
  canUseGiftAdminFilter,
  realTimeAssistants,
  onClose,
  onScreenSelect
}) => {
  const {
    setStickerSearchQuery,
    setGifSearchQuery,
    toggleManagement,
    openAddContactDialog,
    toggleStatistics,
    setEditingExportedInvite,
    deleteExportedChatInvite,
    openEditTopicPanel,
    updateGiftProfileFilter,
    setSharedSettingOption
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isDeleteDialogOpen, openDeleteDialog, closeDeleteDialog] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const {
    sortType: giftsSortType,
    shouldIncludeUnlimited: shouldIncludeUnlimitedGifts,
    shouldIncludeLimited: shouldIncludeLimitedGifts,
    shouldIncludeUnique: shouldIncludeUniqueGifts,
    shouldIncludeDisplayed: shouldIncludeDisplayedGifts,
    shouldIncludeHidden: shouldIncludeHiddenGifts
  } = giftProfileFilter;
  const foldersChatCount = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_16__.useFolderManagerForChatsCount)();
  const handleEditInviteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    setEditingExportedInvite({
      chatId: chatId,
      invite: currentInviteInfo
    });
    onScreenSelect(_types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.EditInvite);
  });
  const handleDeleteInviteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    deleteExportedChatInvite({
      chatId: chatId,
      link: currentInviteInfo.link
    });
    onScreenSelect(_types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Invites);
    closeDeleteDialog();
  });
  const handleStickerSearchQueryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(query => {
    setStickerSearchQuery({
      query
    });
  });
  const handleGifSearchQueryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(query => {
    setGifSearchQuery({
      query
    });
  });
  const handleAddContact = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    openAddContactDialog({
      userId
    });
  });
  const toggleEditTopic = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    if (!chatId || !threadId) return;
    openEditTopicPanel({
      chatId,
      topicId: Number(threadId)
    });
  });
  const handleToggleManagement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    toggleManagement();
  });
  const handleToggleStatistics = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    toggleStatistics();
  });
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    onClose(!isSavedMessages);
  });
  const realTimeAssistantById = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const chatType = chatId && (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_11__.isUserId)(chatId) ? 'user' : 'chat';
    if (chatId && realTimeAssistants?.[chatId] !== undefined) {
      return realTimeAssistants[chatId];
    } else if (chatType === 'user') {
      return false;
    } else {
      return false;
    }
  }, [chatId, realTimeAssistants]);
  const handleSwitchRealTimeAssistant = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(e => {
    if (!chatId) return;
    e.stopPropagation();
    setSharedSettingOption({
      realTimeAssistants: {
        ...realTimeAssistants,
        [chatId]: !realTimeAssistantById
      }
    });
  });
  const [shouldSkipTransition, setShouldSkipTransition] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!isColumnOpen);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setTimeout(() => {
      setShouldSkipTransition(!isColumnOpen);
    }, COLUMN_ANIMATION_DURATION);
  }, [isColumnOpen]);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_19__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_17__["default"])();
  const contentKey = isProfile ? profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.Profile ? HeaderContent.Profile : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.SharedMedia ? HeaderContent.SharedMedia : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.MemberList ? HeaderContent.MemberList : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.GiftList ? HeaderContent.GiftList : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.StoryList ? HeaderContent.StoryList : profileState === _types__WEBPACK_IMPORTED_MODULE_3__.ProfileState.SavedDialogs ? HeaderContent.SavedDialogs : -1 // Never reached
  : isChatAI ? HeaderContent.ChatAI : isPollResults ? HeaderContent.PollResults : isStickerSearch ? HeaderContent.StickerSearch : isGifSearch ? HeaderContent.GifSearch : isAddingChatMembers ? HeaderContent.AddingMembers : isManagement ? managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Initial ? HeaderContent.ManageInitial : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatPrivacyType ? HeaderContent.ManageChatPrivacyType : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Discussion ? HeaderContent.ManageDiscussion : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChannelSubscribers ? HeaderContent.ManageChannelSubscribers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupPermissions ? HeaderContent.ManageGroupPermissions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatAdministrators ? HeaderContent.ManageChatAdministrators : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupRemovedUsers ? HeaderContent.ManageGroupRemovedUsers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChannelRemovedUsers ? HeaderContent.ManageChannelRemovedUsers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupUserPermissionsCreate ? HeaderContent.ManageGroupUserPermissionsCreate : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupUserPermissions ? HeaderContent.ManageGroupUserPermissions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupRecentActions ? HeaderContent.ManageGroupRecentActions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatAdminRights ? HeaderContent.ManageGroupAdminRights : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.ChatNewAdminRights ? HeaderContent.ManageGroupNewAdminRights : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupMembers ? HeaderContent.ManageGroupMembers : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Invites ? HeaderContent.ManageInvites : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.EditInvite ? HeaderContent.ManageEditInvite : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.GroupAddAdmins ? HeaderContent.ManageGroupAddAdmins : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.Reactions ? HeaderContent.ManageReactions : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.InviteInfo ? HeaderContent.ManageInviteInfo : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.JoinRequests ? HeaderContent.ManageJoinRequests : managementScreen === _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.NewDiscussionGroup ? HeaderContent.NewDiscussionGroup : undefined // Never reached
  : isStatistics ? HeaderContent.Statistics : isMessageStatistics ? HeaderContent.MessageStatistics : isStoryStatistics ? HeaderContent.StoryStatistics : isBoostStatistics ? HeaderContent.BoostStatistics : isCreatingTopic ? HeaderContent.CreateTopic : isEditingTopic ? HeaderContent.EditTopic : isMonetizationStatistics ? HeaderContent.MonetizationStatistics : isUserPortrait ? HeaderContent.UserPortrait : HeaderContent.ChatAI; // When column is closed

  const renderingContentKey = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_13__["default"])(contentKey, true) ?? -1;
  function getHeaderTitle() {
    if (isSavedMessages) {
      return oldLang('SavedMessages');
    }
    if (isInsideTopic) {
      return oldLang('AccDescrTopic');
    }
    if (isChannel) {
      return oldLang('Channel.TitleInfo');
    }
    if (userId) {
      return oldLang(isBot ? 'lng_info_bot_title' : 'lng_info_user_title');
    }
    return oldLang('GroupInfo.Title');
  }
  const PrimaryLinkMenuButton = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
      round: true,
      ripple: !isMobile,
      size: "smaller",
      color: "translucent",
      className: isOpen ? 'active' : '',
      onClick: onTrigger,
      ariaLabel: lang('AccDescrOpenMenu2')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
      name: "more"
    }));
  }, [isMobile, lang]);
  const AISettingMenuButton = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
      round: true,
      ripple: !isMobile,
      size: "smaller",
      color: "translucent",
      className: isOpen ? 'active' : '',
      onClick: onTrigger,
      ariaLabel: ""
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_utils_icons__WEBPACK_IMPORTED_MODULE_9__.AISettingIcon, null));
  }, [isMobile]);
  function renderHeaderContent() {
    if (renderingContentKey === -1) {
      return undefined;
    }
    switch (renderingContentKey) {
      case HeaderContent.PollResults:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('PollResults'));
      case HeaderContent.AddingMembers:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang(isChannel ? 'ChannelAddSubscribers' : 'GroupAddMembers'));
      case HeaderContent.ManageInitial:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Edit'));
      case HeaderContent.ManageChatPrivacyType:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang(isChannel ? 'ChannelTypeHeader' : 'GroupTypeHeader'));
      case HeaderContent.ManageDiscussion:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Discussion'));
      case HeaderContent.ManageChatAdministrators:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('ChannelAdministrators'));
      case HeaderContent.ManageGroupRecentActions:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Group.Info.AdminLog'));
      case HeaderContent.ManageGroupAdminRights:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('EditAdminRights'));
      case HeaderContent.ManageGroupNewAdminRights:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('SetAsAdmin'));
      case HeaderContent.ManageGroupPermissions:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('ChannelPermissions'));
      case HeaderContent.ManageGroupRemovedUsers:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('BlockedUsers'));
      case HeaderContent.ManageChannelRemovedUsers:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('ChannelBlockedUsers'));
      case HeaderContent.ManageGroupUserPermissionsCreate:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('ChannelAddException'));
      case HeaderContent.ManageGroupUserPermissions:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('UserRestrictions'));
      case HeaderContent.ManageInvites:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('lng_group_invite_title'));
      case HeaderContent.ManageEditInvite:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, isEditingInvite ? oldLang('EditLink') : oldLang('NewLink'));
      case HeaderContent.ManageInviteInfo:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('InviteLink')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("section", {
          className: "tools"
        }, currentInviteInfo && !currentInviteInfo.isRevoked && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: oldLang('Edit'),
          onClick: handleEditInviteClick
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          name: "edit"
        })), currentInviteInfo && currentInviteInfo.isRevoked && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
          round: true,
          color: "danger",
          size: "smaller",
          ariaLabel: oldLang('Delete'),
          onClick: openDeleteDialog
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          name: "delete"
        })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_22__["default"], {
          isOpen: isDeleteDialogOpen,
          onClose: closeDeleteDialog,
          title: oldLang('DeleteLink'),
          text: oldLang('DeleteLinkHelp'),
          confirmIsDestructive: true,
          confirmLabel: oldLang('Delete'),
          confirmHandler: handleDeleteInviteClick
        }))));
      case HeaderContent.ManageJoinRequests:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, isChannel ? oldLang('SubscribeRequests') : oldLang('MemberRequests'));
      case HeaderContent.ManageGroupAddAdmins:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Channel.Management.AddModerator'));
      case HeaderContent.StickerSearch:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_26__["default"], {
          value: stickerSearchQuery,
          placeholder: oldLang('SearchStickersHint'),
          autoFocusSearch: true,
          onChange: handleStickerSearchQueryChange
        });
      case HeaderContent.GifSearch:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_26__["default"], {
          value: gifSearchQuery,
          placeholder: oldLang('SearchGifsTitle'),
          autoFocusSearch: true,
          onChange: handleGifSearchQueryChange
        });
      case HeaderContent.Statistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang(isChannel ? 'ChannelStats.Title' : 'GroupStats.Title'));
      case HeaderContent.MessageStatistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Stats.MessageTitle'));
      case HeaderContent.StoryStatistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Stats.StoryTitle'));
      case HeaderContent.BoostStatistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Boosts'));
      case HeaderContent.MonetizationStatistics:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('lng_channel_earn_title'));
      case HeaderContent.SharedMedia:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('SharedMedia'));
      case HeaderContent.ManageChannelSubscribers:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('ChannelSubscribers'));
      case HeaderContent.MemberList:
      case HeaderContent.ManageGroupMembers:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('GroupMembers'));
      case HeaderContent.StoryList:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang(isSelf ? 'Settings.MyStories' : 'PeerInfo.PaneStories'));
      case HeaderContent.SavedDialogs:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "header"
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('SavedMessagesTab')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "subtitle"
        }, oldLang('Chats', foldersChatCount[_config__WEBPACK_IMPORTED_MODULE_4__.SAVED_FOLDER_ID])));
      case HeaderContent.ManageReactions:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Reactions'));
      case HeaderContent.CreateTopic:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('NewTopic'));
      case HeaderContent.EditTopic:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('EditTopic'));
      case HeaderContent.GiftList:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, lang('ProfileTabGifts')), canUseGiftFilter && chatId && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("section", {
          className: "tools"
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_23__["default"], {
          trigger: PrimaryLinkMenuButton,
          positionX: "right",
          autoClose: false
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_24__["default"], {
          icon: giftsSortType === 'byDate' ? 'cash-circle' : 'calendar-filter',
          onClick: () => updateGiftProfileFilter({
            peerId: chatId,
            filter: {
              sortType: giftsSortType === 'byDate' ? 'byValue' : 'byDate'
            }
          })
        }, lang(giftsSortType === 'byDate' ? 'GiftSortByValue' : 'GiftSortByDate')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_25__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_24__["default"], {
          icon: shouldIncludeUnlimitedGifts ? 'check' : 'placeholder',
          onClick: () => updateGiftProfileFilter({
            peerId: chatId,
            filter: {
              shouldIncludeUnlimited: !shouldIncludeUnlimitedGifts
            }
          })
        }, lang('GiftFilterUnlimited')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_24__["default"], {
          icon: shouldIncludeLimitedGifts ? 'check' : 'placeholder',
          onClick: () => updateGiftProfileFilter({
            peerId: chatId,
            filter: {
              shouldIncludeLimited: !shouldIncludeLimitedGifts
            }
          })
        }, lang('GiftFilterLimited')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_24__["default"], {
          icon: shouldIncludeUniqueGifts ? 'check' : 'placeholder',
          onClick: () => updateGiftProfileFilter({
            peerId: chatId,
            filter: {
              shouldIncludeUnique: !shouldIncludeUniqueGifts
            }
          })
        }, lang('GiftFilterUnique')), canUseGiftAdminFilter && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_25__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_24__["default"], {
          icon: shouldIncludeDisplayedGifts ? 'check' : 'placeholder',
          onClick: () => updateGiftProfileFilter({
            peerId: chatId,
            filter: {
              shouldIncludeDisplayed: !shouldIncludeDisplayedGifts
            }
          })
        }, lang('GiftFilterDisplayed')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_24__["default"], {
          icon: shouldIncludeHiddenGifts ? 'check' : 'placeholder',
          onClick: () => updateGiftProfileFilter({
            peerId: chatId,
            filter: {
              shouldIncludeHidden: !shouldIncludeHiddenGifts
            }
          })
        }, lang('GiftFilterHidden'))))));
      case HeaderContent.ChatAI:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "header chat-ai-header w-full flex items-center justify-between"
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "flex items-center gap-2"
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
          className: "rounded-full",
          src: _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_8__,
          alt: "TelyAI"
        }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('TelyAI'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_23__["default"], {
          trigger: AISettingMenuButton,
          positionX: "right",
          autoClose: false
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "p-2"
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_24__["default"], {
          customIcon: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
            className: "mr-[10px] mb-[40px]"
          }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_utils_icons__WEBPACK_IMPORTED_MODULE_9__.RealTimeAIIcon, null)),
          onClick: handleSwitchRealTimeAssistant
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "flex items-center justify-between"
        }, "Real-time Assistant", /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("label", {
          className: "Switcher no-animation",
          title: ""
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("input", {
          type: "checkbox",
          id: "realTimeAssistantById",
          checked: realTimeAssistantById === true,
          disabled: true
        }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
          className: "widget"
        }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: "mt-2 text-[12px] text-[#666666] leading-[15px] ml-[-35px]"
        }, "When enabled, the assistant will monitor ", /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("br", null), " chats in real time to assist you."))))));
      case HeaderContent.UserPortrait:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('Portrait'));
      case HeaderContent.NewDiscussionGroup:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, oldLang('NewGroup'));
      default:
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
          className: "title"
        }, getHeaderTitle()), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("section", {
          className: "tools"
        }, canAddContact && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: oldLang('AddContact'),
          onClick: handleAddContact
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          name: "add-user"
        })), canManage && !isInsideTopic && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: oldLang('Edit'),
          onClick: handleToggleManagement
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          name: "edit"
        })), canEditBot && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: oldLang('Edit'),
          onClick: handleToggleManagement
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          name: "edit"
        })), canEditTopic && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: oldLang('EditTopic'),
          onClick: toggleEditTopic
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          name: "edit"
        })), canViewStatistics && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
          round: true,
          color: "translucent",
          size: "smaller",
          ariaLabel: oldLang('Statistics'),
          onClick: handleToggleStatistics
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          name: "stats"
        }))));
    }
  }
  const isBackButton = isMobile || !isSavedMessages && (contentKey === HeaderContent.SharedMedia || contentKey === HeaderContent.GiftList || contentKey === HeaderContent.MemberList || contentKey === HeaderContent.StoryList || contentKey === HeaderContent.AddingMembers || contentKey === HeaderContent.MessageStatistics || contentKey === HeaderContent.StoryStatistics || isManagement);
  const buttonClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_10__["default"])('animated-close-icon', isBackButton && 'state-back', (shouldSkipTransition || shouldSkipHistoryAnimations) && 'no-transition');
  const headerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  (0,_hooks_useElectronDrag__WEBPACK_IMPORTED_MODULE_14__["default"])(headerRef);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "RightHeader",
    ref: headerRef
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
    className: "close-button",
    round: true,
    color: "translucent",
    size: "smaller",
    onClick: handleClose,
    ariaLabel: isBackButton ? oldLang('Common.Back') : oldLang('Common.Close')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: buttonClassName
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_27__["default"], {
    name: shouldSkipTransition || shouldSkipHistoryAnimations ? 'none' : 'slideFade',
    activeKey: renderingContentKey
  }, renderHeaderContent()));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  isProfile,
  isManagement,
  threadId
}) => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global);
  const {
    query: stickerSearchQuery
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentStickerSearch)(global) || {};
  const {
    query: gifSearchQuery
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentGifSearch)(global) || {};
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId) : undefined;
  const user = isProfile && chatId && (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_11__.isUserId)(chatId) ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, chatId) : undefined;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat);
  const isInsideTopic = chat?.isForum && Boolean(threadId && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID);
  const topic = isInsideTopic ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopic)(global, chatId, threadId) : undefined;
  const canEditTopic = isInsideTopic && topic && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanManageTopic)(chat, topic);
  const isBot = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isUserBot)(user);
  const isSavedMessages = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatWithSelf)(global, chatId) : undefined;
  const canEditBot = isBot && user?.canEditBot;
  const canAddContact = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getCanAddContact)(user);
  const canManage = Boolean(!isManagement && isProfile && chatId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanManage)(global, chatId));
  const isEditingInvite = Boolean(chatId && tabState.management.byChatId[chatId]?.editingInvite);
  const canViewStatistics = !isInsideTopic && chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chatId)?.canViewStatistics : undefined;
  const currentInviteInfo = chatId ? tabState.management.byChatId[chatId]?.inviteInfo?.invite : undefined;
  const giftProfileFilter = tabState.savedGifts.filter;
  const canUseGiftFilter = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanUseGiftProfileFilter)(global, chatId) : false;
  const canUseGiftAdminFilter = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanUseGiftProfileAdminFilter)(global, chatId) : false;
  const {
    realTimeAssistants
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__.selectSharedSettings)(global);
  return {
    canManage,
    canAddContact,
    canViewStatistics,
    isChannel,
    isBot,
    isInsideTopic,
    canEditTopic,
    userId: user?.id,
    isSelf: user?.isSelf,
    stickerSearchQuery,
    gifSearchQuery,
    isEditingInvite,
    currentInviteInfo,
    isSavedMessages,
    shouldSkipHistoryAnimations: tabState.shouldSkipHistoryAnimations,
    canEditBot,
    giftProfileFilter,
    canUseGiftFilter,
    canUseGiftAdminFilter,
    realTimeAssistants
  };
})(RightHeader));

/***/ },

/***/ "./src/components/right/StickerSearch.async.tsx"
/*!******************************************************!*\
  !*** ./src/components/right/StickerSearch.async.tsx ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Loading */ "./src/components/ui/Loading.tsx");




const StickerSearchAsync = () => {
  const StickerSearch = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StickerSearch');
  return StickerSearch ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StickerSearch, null) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StickerSearchAsync);

/***/ },

/***/ "./src/components/right/hooks/useProfileState.ts"
/*!*******************************************************!*\
  !*** ./src/components/right/hooks/useProfileState.ts ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useProfileState)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");






const TRANSITION_DURATION = 300;
const PROGRAMMATIC_SCROLL_TIMEOUT_MS = 350;
const runThrottledForScroll = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_3__.throttle)(cb => cb(), 250, false);
let isScrollingProgrammatically = false;
function useProfileState(containerRef, tabType, profileState, onProfileStateChange, forceScrollProfileTab = false, allowAutoScrollToTabs = false, handleStopAutoScrollToTabs) {
  // Scroll to tabs if needed
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__["default"])(([prevTabType]) => {
    if (prevTabType && prevTabType !== tabType && allowAutoScrollToTabs || tabType && forceScrollProfileTab) {
      const container = containerRef.current;
      const tabsEl = container.querySelector('.TabList');
      handleStopAutoScrollToTabs();
      if (container.scrollTop < tabsEl.offsetTop) {
        onProfileStateChange(getStateFromTabType(tabType));
        isScrollingProgrammatically = true;
        (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_2__["default"])({
          container,
          element: tabsEl,
          position: 'start',
          forceDuration: TRANSITION_DURATION
        });
        setTimeout(() => {
          isScrollingProgrammatically = false;
        }, PROGRAMMATIC_SCROLL_TIMEOUT_MS);
      }
    }
  }, [tabType, onProfileStateChange, containerRef, forceScrollProfileTab, allowAutoScrollToTabs, handleStopAutoScrollToTabs]);

  // Scroll to top
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_4__["default"])(([prevProfileState]) => {
    if (profileState !== _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.Profile || profileState === prevProfileState) {
      return;
    }
    const container = containerRef.current;
    if (!container) {
      return;
    }
    const tabListEl = container.querySelector('.TabList');
    if (!tabListEl || tabListEl.offsetTop > container.scrollTop) {
      return;
    }
    isScrollingProgrammatically = true;
    (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_2__["default"])({
      container,
      element: container.firstElementChild,
      position: 'start',
      maxDistance: container.offsetHeight * 2
    });
    setTimeout(() => {
      isScrollingProgrammatically = false;
    }, PROGRAMMATIC_SCROLL_TIMEOUT_MS);
  }, [profileState, containerRef]);
  const determineProfileState = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    const container = containerRef.current;
    if (!container) {
      return;
    }
    const tabListEl = container.querySelector('.TabList');
    if (!tabListEl) {
      return;
    }
    let state = _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.Profile;
    if (Math.ceil(container.scrollTop) >= tabListEl.offsetTop) {
      state = getStateFromTabType(tabType);
    }
    onProfileStateChange(state);
  });

  // Determine profile state when switching tabs
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isScrollingProgrammatically) {
      return;
    }
    determineProfileState();
  }, [determineProfileState, tabType]);

  // Determine profile state when scrolling
  const handleScroll = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (isScrollingProgrammatically) {
      return;
    }
    runThrottledForScroll(determineProfileState);
  });
  return {
    handleScroll
  };
}
function getStateFromTabType(tabType) {
  switch (tabType) {
    case 'members':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.MemberList;
    case 'gifts':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.GiftList;
    case 'stories':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.StoryList;
    case 'dialogs':
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.SavedDialogs;
    default:
      return _types__WEBPACK_IMPORTED_MODULE_1__.ProfileState.SharedMedia;
  }
}

/***/ },

/***/ "./src/components/right/hooks/useProfileViewportIds.ts"
/*!*************************************************************!*\
  !*** ./src/components/right/hooks/useProfileViewportIds.ts ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useProfileViewportIds)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useInfiniteScroll */ "./src/hooks/useInfiniteScroll.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");






function useProfileViewportIds({
  loadMoreMembers,
  loadCommonChats,
  searchMessages,
  loadStories,
  loadStoriesArchive,
  loadMoreGifts,
  tabType,
  mediaSearchType,
  groupChatMembers,
  commonChatIds,
  usersById,
  userStatusesById,
  chatsById,
  chatMessages,
  foundIds,
  threadId,
  storyIds,
  giftIds,
  pinnedStoryIds,
  archiveStoryIds,
  similarChannels,
  similarBots
}) {
  const resultType = tabType === 'members' || !mediaSearchType ? tabType : mediaSearchType;
  const memberIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!groupChatMembers || !usersById || !userStatusesById) {
      return undefined;
    }
    return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.sortUserIds)(groupChatMembers.map(({
      userId
    }) => userId), usersById, userStatusesById);
  }, [groupChatMembers, usersById, userStatusesById]);
  const chatIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!commonChatIds || !chatsById) {
      return undefined;
    }
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_3__["default"])(commonChatIds, true);
  }, [chatsById, commonChatIds]);
  const [memberViewportIds, getMoreMembers, noProfileInfoForMembers] = useInfiniteScrollForLoadableItems(loadMoreMembers, memberIds);
  const [mediaViewportIds, getMoreMedia, noProfileInfoForMedia] = useInfiniteScrollForSharedMedia('media', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [documentViewportIds, getMoreDocuments, noProfileInfoForDocuments] = useInfiniteScrollForSharedMedia('documents', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [linkViewportIds, getMoreLinks, noProfileInfoForLinks] = useInfiniteScrollForSharedMedia('links', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [audioViewportIds, getMoreAudio, noProfileInfoForAudio] = useInfiniteScrollForSharedMedia('audio', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [voiceViewportIds, getMoreVoices, noProfileInfoForVoices] = useInfiniteScrollForSharedMedia('voice', resultType, searchMessages, chatMessages, foundIds, threadId);
  const [commonChatViewportIds, getMoreCommonChats, noProfileInfoForCommonChats] = useInfiniteScrollForLoadableItems(loadCommonChats, chatIds);
  const sortedStoryIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!storyIds?.length) return storyIds;
    const pinnedStoryIdsSet = new Set(pinnedStoryIds);
    return storyIds.slice().sort((a, b) => {
      const aIsPinned = pinnedStoryIdsSet.has(a);
      const bIsPinned = pinnedStoryIdsSet.has(b);
      if (aIsPinned && !bIsPinned) return -1;
      if (!aIsPinned && bIsPinned) return 1;
      return b - a;
    });
  }, [storyIds, pinnedStoryIds]);
  const [storyViewportIds, getMoreStories, noProfileInfoForStories] = useInfiniteScrollForLoadableItems(loadStories, sortedStoryIds);
  const [archiveStoryViewportIds, getMoreStoriesArchive, noProfileInfoForStoriesArchive] = useInfiniteScrollForLoadableItems(loadStoriesArchive, archiveStoryIds);
  let viewportIds;
  let getMore;
  let noProfileInfo = false;
  switch (resultType) {
    case 'members':
      viewportIds = memberViewportIds;
      getMore = getMoreMembers;
      noProfileInfo = noProfileInfoForMembers;
      break;
    case 'commonChats':
      viewportIds = commonChatViewportIds;
      getMore = getMoreCommonChats;
      noProfileInfo = noProfileInfoForCommonChats;
      break;
    case 'media':
      viewportIds = mediaViewportIds;
      getMore = getMoreMedia;
      noProfileInfo = noProfileInfoForMedia;
      break;
    case 'documents':
      viewportIds = documentViewportIds;
      getMore = getMoreDocuments;
      noProfileInfo = noProfileInfoForDocuments;
      break;
    case 'links':
      viewportIds = linkViewportIds;
      getMore = getMoreLinks;
      noProfileInfo = noProfileInfoForLinks;
      break;
    case 'audio':
      viewportIds = audioViewportIds;
      getMore = getMoreAudio;
      noProfileInfo = noProfileInfoForAudio;
      break;
    case 'voice':
      viewportIds = voiceViewportIds;
      getMore = getMoreVoices;
      noProfileInfo = noProfileInfoForVoices;
      break;
    case 'stories':
      viewportIds = storyViewportIds;
      getMore = getMoreStories;
      noProfileInfo = noProfileInfoForStories;
      break;
    case 'storiesArchive':
      viewportIds = archiveStoryViewportIds;
      getMore = getMoreStoriesArchive;
      noProfileInfo = noProfileInfoForStoriesArchive;
      break;
    case 'similarChannels':
      viewportIds = similarChannels;
      break;
    case 'similarBots':
      viewportIds = similarBots;
      break;
    case 'gifts':
      viewportIds = giftIds;
      getMore = loadMoreGifts;
      break;
    case 'dialogs':
      noProfileInfo = true;
      break;
  }
  return [resultType, viewportIds, getMore, noProfileInfo];
}
function useInfiniteScrollForLoadableItems(handleLoadMore, itemIds) {
  const [viewportIds, getMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__["default"])(handleLoadMore, itemIds, undefined, _config__WEBPACK_IMPORTED_MODULE_1__.MEMBERS_SLICE);
  const isOnTop = !viewportIds || !itemIds || viewportIds[0] === itemIds[0];
  return [viewportIds, getMore, !isOnTop];
}
function useInfiniteScrollForSharedMedia(forSharedMediaType, currentResultType, handleLoadMore, chatMessages, foundIds, threadId) {
  const messageIdsRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    messageIdsRef.current = undefined;
  }, [threadId]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (currentResultType === forSharedMediaType && chatMessages && foundIds) {
      messageIdsRef.current = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageContentIds)(chatMessages, foundIds, forSharedMediaType);
    }
  }, [chatMessages, foundIds, currentResultType, forSharedMediaType]);
  const [viewportIds, getMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_4__["default"])(handleLoadMore, messageIdsRef.current, undefined, forSharedMediaType === 'media' ? _config__WEBPACK_IMPORTED_MODULE_1__.SHARED_MEDIA_SLICE : _config__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_SEARCH_SLICE);
  const isOnTop = !viewportIds || !messageIdsRef.current || viewportIds[0] === messageIdsRef.current[0];
  return [viewportIds, getMore, !isOnTop];
}

/***/ },

/***/ "./src/components/right/hooks/useTransitionFixes.ts"
/*!**********************************************************!*\
  !*** ./src/components/right/hooks/useTransitionFixes.ts ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useTransitionFixes)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");



function useTransitionFixes(containerRef, transitionElSelector = '.Transition.shared-media-transition') {
  // Set `min-height` for shared media container to prevent jumping when switching tabs
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    function setMinHeight() {
      const container = containerRef.current;
      const transitionEl = container.querySelector(transitionElSelector);
      const tabsEl = container.querySelector('.TabList');
      if (transitionEl && tabsEl) {
        const newHeight = container.clientHeight - tabsEl.offsetHeight;
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
          transitionEl.style.minHeight = `${newHeight}px`;
        });
      }
    }
    setMinHeight();
    window.addEventListener('resize', setMinHeight, false);
    return () => {
      window.removeEventListener('resize', setMinHeight, false);
    };
  }, [containerRef, transitionElSelector]);

  // Workaround for scrollable content flickering during animation.
  const applyTransitionFix = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    // This callback is called from `Transition.onStart` which is "mutate" phase
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMeasure)(() => {
      const container = containerRef.current;
      if (container.style.overflowY === 'hidden') return;
      const scrollBarWidth = container.offsetWidth - container.clientWidth;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
        container.style.overflowY = 'hidden';
        container.style.paddingRight = `${scrollBarWidth}px`;
      });
    });
  });
  const releaseTransitionFix = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    const container = containerRef.current;
    container.style.overflowY = 'scroll';
    container.style.paddingRight = '0';
  });
  return {
    applyTransitionFix,
    releaseTransitionFix
  };
}

/***/ },

/***/ "./src/components/right/management/Management.async.tsx"
/*!**************************************************************!*\
  !*** ./src/components/right/management/Management.async.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const ManagementAsync = props => {
  const Management = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Management');
  return Management ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Management, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ManagementAsync);

/***/ },

/***/ "./src/components/right/statistics/BoostStatistics.module.scss"
/*!*********************************************************************!*\
  !*** ./src/components/right/statistics/BoostStatistics.module.scss ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"gk6pIryJ","noResults":"WP4wRUbm","section-header":"LWcgK3OX","sectionHeader":"LWcgK3OX","section":"C8KF95yU","user":"oMy5KOFr","stats":"GOzrl0zF","down":"QuLtxDUV","loadMoreSpinner":"ln5zB7KK","status":"r3zLiaXx","info":"Eo1qQlxx","month":"McSPvm0N","quantity":"s1yf_GJa","floatingBadge":"oSCjRZtx","floatingBadgeButtonColor":"duVpAT_e","floatingBadgeWarning":"DsJMXNNk","floatingBadgeButton":"urrWJVYB","floatingBadgeIcon":"hcA9VPeV","floatingBadgeValue":"hHkCO4Ge","content":"SG00REIA","boostSection":"ETgjBS4d","giveawayButton":"wOCtp5Kk","giveawayIcon":"B9GF4NDB","primaryLink":"GXmXwIbx","copy":"rB0gc1GX","boostInfo":"BhoA3MT6"});

/***/ },

/***/ "./src/components/right/statistics/BoostStatistics.tsx"
/*!*************************************************************!*\
  !*** ./src/components/right/statistics/BoostStatistics.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors/sharedState.ts */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_boostInfo__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/helpers/boostInfo */ "./src/components/common/helpers/boostInfo.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_LinkField__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/LinkField */ "./src/components/common/LinkField.tsx");
/* harmony import */ var _common_PremiumProgress__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/PremiumProgress */ "./src/components/common/PremiumProgress.tsx");
/* harmony import */ var _common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/PrivateChatInfo */ "./src/components/common/PrivateChatInfo.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _StatisticsOverview__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./StatisticsOverview */ "./src/components/right/statistics/StatisticsOverview.tsx");
/* harmony import */ var _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./BoostStatistics.module.scss */ "./src/components/right/statistics/BoostStatistics.module.scss");
/* harmony import */ var _assets_premium_GiftBlueRound_svg__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../assets/premium/GiftBlueRound.svg */ "./src/assets/premium/GiftBlueRound.svg");
/* harmony import */ var _assets_premium_GiftGreenRound_svg__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../assets/premium/GiftGreenRound.svg */ "./src/assets/premium/GiftGreenRound.svg");
/* harmony import */ var _assets_premium_GiftRedRound_svg__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../assets/premium/GiftRedRound.svg */ "./src/assets/premium/GiftRedRound.svg");
/* harmony import */ var _assets_premium_GiftStar_svg__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../../assets/premium/GiftStar.svg */ "./src/assets/premium/GiftStar.svg");





























const GIVEAWAY_IMG_LIST = {
  3: _assets_premium_GiftGreenRound_svg__WEBPACK_IMPORTED_MODULE_25__,
  6: _assets_premium_GiftBlueRound_svg__WEBPACK_IMPORTED_MODULE_24__,
  12: _assets_premium_GiftRedRound_svg__WEBPACK_IMPORTED_MODULE_26__
};
const CUSTOM_PEER_STAR_TEMPLATE = {
  isCustomPeer: true,
  avatarIcon: 'star',
  peerColorId: 1
};
const CUSTOM_PEER_TO_BE_DISTRIBUTED = {
  isCustomPeer: true,
  titleKey: 'BoostingToBeDistributed',
  avatarIcon: 'user',
  withPremiumGradient: true
};
const BoostStatistics = ({
  boostStatistics,
  isGiveawayAvailable,
  chatId,
  giveawayBoostsPerPremium,
  isChannel,
  animationLevel
}) => {
  const {
    openChat,
    loadMoreBoosters,
    closeBoostStatistics,
    openGiveawayModal,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const transitionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isLoaded = boostStatistics?.boostStatus;
  const status = isLoaded ? boostStatistics.boostStatus : undefined;
  const isGiftListEqual = boostStatistics && boostStatistics?.boosts?.count === boostStatistics?.giftedBoosts?.count;
  const shouldDisplayGiftList = !isGiftListEqual && boostStatistics?.giftedBoosts && boostStatistics?.giftedBoosts?.list?.length > 0;
  const {
    currentLevel,
    hasNextLevel,
    boosts,
    levelProgress,
    remainingBoosts
  } = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!status) {
      return {
        currentLevel: 0,
        hasNextLevel: false,
        boosts: 0,
        levelProgress: 0,
        remainingBoosts: 0,
        prepaidGiveaways: []
      };
    }
    return (0,_common_helpers_boostInfo__WEBPACK_IMPORTED_MODULE_10__.getBoostProgressInfo)(status);
  }, [status]);
  const statsOverview = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!status) return undefined;
    return {
      level: currentLevel,
      boosts,
      premiumSubscribers: status.premiumSubscribers,
      remainingBoosts,
      prepaidGiveaways: status.prepaidGiveaways
    };
  }, [status, boosts, currentLevel, remainingBoosts]);
  const tabs = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (shouldDisplayGiftList) {
      return [{
        type: 'boostList',
        title: lang('BoostingBoostsCount', boostStatistics?.boosts?.count, 'i')
      }, {
        type: 'giftedBoostList',
        title: lang('BoostingGiftsCount', boostStatistics?.giftedBoosts?.count, 'i')
      }];
    }
    return [];
  }, [shouldDisplayGiftList, lang, boostStatistics?.boosts?.count, boostStatistics?.giftedBoosts?.count]);
  const initialTab = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return boostStatistics?.boosts && boostStatistics.boosts?.list.length > 0 ? 1 : 0;
  }, [boostStatistics]);
  const [activeTab, setActiveTab] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(initialTab);
  const renderingActiveTab = activeTab > tabs.length - 1 ? tabs.length - 1 : activeTab;
  const tabType = tabs[renderingActiveTab]?.type;
  const activeKey = tabs.findIndex(({
    type
  }) => type === tabType);
  const boostersToLoadCount = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!boostStatistics) return undefined;
    const list = shouldDisplayGiftList ? tabType === 'boostList' ? boostStatistics.boosts : boostStatistics.giftedBoosts : boostStatistics.boosts;
    if (!list?.count) return undefined;
    const loadedBoostsCount = list.list.reduce((total, boost) => {
      return total + (boost.multiplier || 1);
    }, 0);
    const totalCount = list.count;
    const toLoadCount = totalCount - loadedBoostsCount;
    return toLoadCount > 0 ? toLoadCount : undefined;
  }, [shouldDisplayGiftList, boostStatistics, tabType]);
  const renderBoostIcon = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(multiplier => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].quantity
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadge, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButtonColor)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "boost",
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeIcon
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeValue
  }, multiplier))));
  const renderBoostTypeIcon = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(boost => {
    if (!boost.isFromGiveaway && !boost.isGift) {
      return undefined;
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].quantity
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadge, !boost.isFromGiveaway && _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeWarning, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButtonColor, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButton)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
      name: "gift",
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeIcon
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeValue
    }, lang(boost.isFromGiveaway ? 'BoostingGiveaway' : 'BoostingGift'))));
  });
  const handleBoosterClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(userId => {
    if (!userId) {
      showNotification({
        message: lang('BoostingRecipientWillBeSelected')
      });
      return;
    }
    openChat({
      id: userId
    });
    closeBoostStatistics();
  });
  const renderBoostList = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(boost => {
    const hasStars = Boolean(boost?.stars);
    let customPeer;
    if (hasStars) {
      customPeer = {
        ...CUSTOM_PEER_STAR_TEMPLATE,
        title: lang('Stars', boost.stars)
      };
    }
    if (!boost.userId) {
      customPeer = CUSTOM_PEER_TO_BE_DISTRIBUTED;
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].boostInfo, 'chat-item-clickable'),
      onClick: () => handleBoosterClick(boost.userId)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PrivateChatInfo__WEBPACK_IMPORTED_MODULE_16__["default"], {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].user,
      userId: boost.userId,
      customPeer: customPeer,
      status: lang('BoostExpireOn', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateAtTime)(lang, boost.expires * 1000)),
      noEmojiStatus: true,
      forceShowSelf: true,
      noFake: true,
      noVerified: true,
      iconElement: boost.multiplier ? renderBoostIcon(boost.multiplier) : undefined,
      rightElement: renderBoostTypeIcon(boost)
    }));
  });
  const handleGiveawayClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    openGiveawayModal({
      chatId
    });
  });
  const handleLoadMore = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    e.preventDefault();
    loadMoreBoosters({
      isGifts: tabType === 'giftedBoostList'
    });
  });
  const launchPrepaidGiveawayHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(prepaidGiveaway => {
    openGiveawayModal({
      chatId,
      prepaidGiveaway
    });
  });
  function renderContent() {
    let listToRender;
    if (tabType === 'boostList') {
      listToRender = boostStatistics?.boosts?.list;
    } else if (tabType === 'giftedBoostList') {
      listToRender = boostStatistics?.giftedBoosts?.list;
    }
    if (listToRender && !listToRender?.length) {
      return undefined;
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section
    }, listToRender?.map(boost => renderBoostList(boost)));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].root, 'panel-content custom-scroll')
  }, !isLoaded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_18__["default"], null), isLoaded && statsOverview && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PremiumProgress__WEBPACK_IMPORTED_MODULE_15__["default"], {
    leftText: lang('BoostsLevel', currentLevel),
    rightText: hasNextLevel ? lang('BoostsLevel', currentLevel + 1) : undefined,
    progress: levelProgress,
    floatingBadgeText: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_9__.formatInteger)(boosts),
    floatingBadgeIcon: "boost"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StatisticsOverview__WEBPACK_IMPORTED_MODULE_22__["default"], {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].stats,
    statistics: statsOverview,
    type: "boost"
  })), statsOverview.prepaidGiveaways && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h4", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].sectionHeader,
    dir: lang.isRtl ? 'rtl' : undefined
  }, lang('BoostingPreparedGiveaways')), statsOverview?.prepaidGiveaways?.map(prepaidGiveaway => {
    const isStarsGiveaway = 'stars' in prepaidGiveaway;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
      key: prepaidGiveaway.id,
      className: "chat-item-clickable",
      onClick: () => launchPrepaidGiveawayHandler(prepaidGiveaway)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].status, 'status-clickable')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, isStarsGiveaway ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      src: _assets_premium_GiftStar_svg__WEBPACK_IMPORTED_MODULE_27__,
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].giveawayIcon,
      alt: lang('GiftStar')
    }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      src: GIVEAWAY_IMG_LIST[prepaidGiveaway.months] || GIVEAWAY_IMG_LIST[3],
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].giveawayIcon,
      alt: lang('Giveaway')
    })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].info
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", null, isStarsGiveaway ? lang('Giveaway.Stars.Prepaid.Title', prepaidGiveaway.stars) : lang('BoostingTelegramPremiumCountPlural', prepaidGiveaway.quantity)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].month
    }, isStarsGiveaway ? lang('Giveaway.Stars.Prepaid.Desc', prepaidGiveaway.quantity) : lang('PrepaidGiveawayMonths', prepaidGiveaway.months))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].quantity
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadge, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButtonColor, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeButton)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
      name: "boost",
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeIcon
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].floatingBadgeValue,
      dir: lang.isRtl ? 'rtl' : undefined
    }, isStarsGiveaway ? prepaidGiveaway.boosts : prepaidGiveaway.quantity * (giveawayBoostsPerPremium ?? _config__WEBPACK_IMPORTED_MODULE_2__.GIVEAWAY_BOOST_PER_PREMIUM))))));
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "text-muted hint",
    key: "links-hint"
  }, lang('BoostingSelectPaidGiveaway'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section
  }, shouldDisplayGiftList ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].boostSection, _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].content)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_21__["default"], {
    ref: transitionRef,
    name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_8__.resolveTransitionName)('slideOptimized', animationLevel, undefined, lang.isRtl),
    activeKey: activeKey,
    renderCount: tabs.length,
    shouldRestoreHeight: true
  }, renderContent()), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TabList__WEBPACK_IMPORTED_MODULE_20__["default"], {
    activeTab: renderingActiveTab,
    tabs: tabs,
    onSwitchTab: setActiveTab
  })) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h4", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].sectionHeader,
    dir: lang.isRtl ? 'rtl' : undefined
  }, lang('BoostingBoostsCount', boostStatistics?.boosts?.count)), !boostStatistics?.boosts?.list?.length && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].noResults
  }, lang(isChannel ? 'NoBoostersHint' : 'NoBoostersGroupHint')), boostStatistics?.boosts?.list?.map(boost => renderBoostList(boost))), Boolean(boostersToLoadCount) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
    key: "load-more",
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].showMore,
    disabled: boostStatistics?.isLoadingBoosters,
    onClick: handleLoadMore
  }, boostStatistics?.isLoadingBoosters ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_19__["default"], {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].loadMoreSpinner
  }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "down",
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].down
  }), lang('ShowVotes', boostersToLoadCount, 'i'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_LinkField__WEBPACK_IMPORTED_MODULE_14__["default"], {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
    link: status.boostUrl,
    withShare: true,
    title: lang('LinkForBoosting')
  }), isGiveawayAvailable && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_17__["default"], {
    key: "load-more",
    icon: "gift",
    onClick: handleGiveawayClick,
    className: _BoostStatistics_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].giveawayButton
  }, lang('BoostingGetBoostsViaGifts')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "text-muted hint",
    key: "links-hint"
  }, lang(isChannel ? 'BoostingGetMoreBoosts' : 'BoostingGetMoreBoostsGroup')))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const boostStatistics = tabState.boostStatistics;
  const isGiveawayAvailable = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsGiveawayGiftsPurchaseAvailable)(global);
  const chatId = boostStatistics && boostStatistics.chatId;
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId) : undefined;
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat);
  const giveawayBoostsPerPremium = global.appConfig?.giveawayBoostsPerPremium;
  const {
    animationLevel
  } = (0,_global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_5__.selectSharedSettings)(global);
  return {
    boostStatistics,
    isGiveawayAvailable,
    chatId: chatId,
    giveawayBoostsPerPremium,
    isChannel,
    animationLevel
  };
})(BoostStatistics)));

/***/ },

/***/ "./src/components/right/statistics/MessageStatistics.async.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/right/statistics/MessageStatistics.async.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const MessageStatisticsAsync = props => {
  const MessageStatistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MessageStatistics');
  return MessageStatistics ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MessageStatistics, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageStatisticsAsync);

/***/ },

/***/ "./src/components/right/statistics/MonetizationStatistics.module.scss"
/*!****************************************************************************!*\
  !*** ./src/components/right/statistics/MonetizationStatistics.module.scss ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"vBPv6lUS","graph":"EbPbvB1I","hidden":"nsPIlLYL","ready":"s6qyDhkE","section":"cB2IkwY6","topText":"FLOpxZd1","availableReward":"emE6bAD8","rewardValue":"eyDAxGDU","decimalPart":"jkRV_L7b","integer":"xE9kfGi7","decimalUsdPart":"hWMnYdxX","toncoinIcon":"ubDl9CvS","textBottom":"P3qZJJzF"});

/***/ },

/***/ "./src/components/right/statistics/MonetizationStatistics.tsx"
/*!********************************************************************!*\
  !*** ./src/components/right/statistics/MonetizationStatistics.tsx ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_isGraph__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./helpers/isGraph */ "./src/components/right/statistics/helpers/isGraph.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AboutMonetizationModal_async__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/AboutMonetizationModal.async */ "./src/components/common/AboutMonetizationModal.async.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _StatisticsOverview__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./StatisticsOverview */ "./src/components/right/statistics/StatisticsOverview.tsx");
/* harmony import */ var _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./MonetizationStatistics.module.scss */ "./src/components/right/statistics/MonetizationStatistics.module.scss");





















let lovelyChartPromise;
let LovelyChart;
async function ensureLovelyChart() {
  if (!lovelyChartPromise) {
    lovelyChartPromise = __webpack_require__.e(/*! import() */ "src_lib_lovely-chart_LovelyChart_js").then(__webpack_require__.bind(__webpack_require__, /*! ../../../lib/lovely-chart/LovelyChart */ "./src/lib/lovely-chart/LovelyChart.js"));
    LovelyChart = await lovelyChartPromise;
  }
  return lovelyChartPromise;
}
const MONETIZATION_GRAPHS_TITLES = {
  topHoursGraph: 'ChannelStats.Graph.ViewsByHours',
  revenueGraph: 'lng_channel_earn_chart_revenue'
};
const MONETIZATION_GRAPHS = Object.keys(MONETIZATION_GRAPHS_TITLES);
const MonetizationStatistics = ({
  chatId,
  dcId,
  statistics,
  isCreator,
  isChannelRevenueWithdrawalEnabled,
  hasPassword
}) => {
  const {
    loadChannelMonetizationStatistics,
    openMonetizationVerificationModal,
    loadPasswordInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [isReady, setIsReady] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const loadedCharts = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(new Set());
  const errorCharts = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(new Set());
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const [isAboutMonetizationModalOpen, openAboutMonetizationModal, closeAboutMonetizationModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_6__["default"])(false);
  const [isConfirmPasswordDialogOpen, openConfirmPasswordDialogOpen, closeConfirmPasswordDialogOpen] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const availableBalance = statistics?.balances?.availableBalance;
  const isWithdrawalEnabled = statistics?.balances?.isWithdrawalEnabled;
  const canWithdraw = isCreator && isChannelRevenueWithdrawalEnabled && Boolean(availableBalance) && isWithdrawalEnabled;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId) {
      loadChannelMonetizationStatistics({
        peerId: chatId
      });
      loadPasswordInfo();
    }
  }, [chatId, loadChannelMonetizationStatistics]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    (async () => {
      await ensureLovelyChart();
      if (!isReady) {
        setIsReady(true);
        return;
      }
      if (containerRef.current) {
        Array.from(containerRef.current.children).forEach(child => {
          child.innerHTML = '';
          child.classList.add(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].hidden);
        });
      }
      loadedCharts.current.clear();
      errorCharts.current.clear();
      if (!statistics || !containerRef.current) {
        return;
      }
      MONETIZATION_GRAPHS.forEach((name, index) => {
        const graph = statistics[name];
        if (!(0,_helpers_isGraph__WEBPACK_IMPORTED_MODULE_5__.isGraph)(graph)) {
          return;
        }
        const isAsync = graph.graphType === 'async';
        const isError = graph.graphType === 'error';
        if (isAsync || loadedCharts.current.has(name)) {
          return;
        }
        if (isError) {
          loadedCharts.current.add(name);
          errorCharts.current.add(name);
          return;
        }
        LovelyChart.create(containerRef.current.children[index], {
          title: oldLang(MONETIZATION_GRAPHS_TITLES[name]),
          ...graph
        });
        loadedCharts.current.add(name);
        containerRef.current.children[index].classList.remove(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].hidden);
      });
      forceUpdate();
    })();
  }, [isReady, statistics, oldLang, chatId, dcId, forceUpdate]);
  function renderAvailableReward() {
    const [integerTonPart, decimalTonPart] = availableBalance ? availableBalance.toFixed(4).split('.') : [0];
    const [integerUsdPart, decimalUsdPart] = availableBalance && statistics?.usdRate ? (availableBalance * statistics.usdRate).toFixed(2).split('.') : [0];
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].availableReward
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].toncoin
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].toncoinIcon,
      name: "toncoin"
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("b", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].rewardValue
    }, integerTonPart, decimalTonPart ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].decimalPart
    }, ".", decimalTonPart) : undefined)), ' ', /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].integer
    }, "\u2248 $", integerUsdPart, decimalUsdPart ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].decimalUsdPart
    }, ".", decimalUsdPart) : undefined));
  }
  const topText = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const linkText = oldLang('LearnMore');
    return lang('ChannelEarnAbout', {
      link: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_16__["default"], {
        isPrimary: true,
        onClick: openAboutMonetizationModal
      }, linkText, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
        name: "next"
      }))
    }, {
      withNodes: true
    });
  }, [lang, oldLang]);
  const rewardsText = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const linkText = oldLang('LearnMore');
    return lang('MonetizationBalanceZeroInfo', {
      link: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_SafeLink__WEBPACK_IMPORTED_MODULE_13__["default"], {
        url: oldLang('MonetizationProceedsInfoLink'),
        text: linkText
      }, linkText, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
        name: "next"
      }))
    }, {
      withNodes: true
    });
  }, [lang, oldLang]);
  const verificationMonetizationHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (hasPassword) {
      openMonetizationVerificationModal({
        chatId
      });
    } else {
      openConfirmPasswordDialogOpen();
    }
  });
  if (!isReady || !statistics) {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_17__["default"], null);
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].root, 'custom-scroll', isReady && _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].ready)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].section, _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].topText)
  }, topText), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StatisticsOverview__WEBPACK_IMPORTED_MODULE_18__["default"], {
    statistics: statistics,
    isToncoin: true,
    type: "monetization",
    title: oldLang('MonetizationOverview'),
    subtitle: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].textBottom
    }, oldLang('MonetizationProceedsTONInfo'))
  }), !loadedCharts.current.size && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_17__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: containerRef,
    className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].section
  }, MONETIZATION_GRAPHS.filter(Boolean).map(graph => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    key: graph,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].graph, _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].hidden)
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].section
  }, oldLang('lng_channel_earn_balance_title'), renderAvailableReward(), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    size: "smaller",
    type: "button",
    onClick: verificationMonetizationHandler,
    disabled: !canWithdraw
  }, oldLang('MonetizationWithdraw')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MonetizationStatistics_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].textBottom
  }, rewardsText)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AboutMonetizationModal_async__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isOpen: isAboutMonetizationModalOpen,
    onClose: closeAboutMonetizationModal
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_15__["default"], {
    isOnlyConfirm: true,
    isOpen: isConfirmPasswordDialogOpen,
    onClose: closeConfirmPasswordDialogOpen,
    confirmHandler: closeConfirmPasswordDialogOpen,
    confirmLabel: lang('OK')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__["default"])(oldLang('Monetization.Withdraw.Error.Text'), ['br']))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global);
  const {
    settings: {
      byKey: {
        hasPassword
      }
    }
  } = global;
  const monetizationStatistics = tabState.monetizationStatistics;
  const chatId = monetizationStatistics && monetizationStatistics.chatId;
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId) : undefined;
  const dcId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChatFullInfo)(global, chatId)?.statisticsDcId;
  const isCreator = Boolean(chat?.isCreator);
  const statistics = tabState.statistics.monetization;
  const isChannelRevenueWithdrawalEnabled = global.appConfig?.isChannelRevenueWithdrawalEnabled;
  return {
    chatId: chatId,
    dcId,
    statistics,
    isCreator,
    isChannelRevenueWithdrawalEnabled,
    hasPassword
  };
})(MonetizationStatistics)));

/***/ },

/***/ "./src/components/right/statistics/Statistics.async.tsx"
/*!**************************************************************!*\
  !*** ./src/components/right/statistics/Statistics.async.tsx ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const StatisticsAsync = props => {
  const Statistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'Statistics');
  return Statistics ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(Statistics, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StatisticsAsync);

/***/ },

/***/ "./src/components/right/statistics/StoryStatistics.async.tsx"
/*!*******************************************************************!*\
  !*** ./src/components/right/statistics/StoryStatistics.async.tsx ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");




const StoryStatisticsAsync = props => {
  const StoryStatistics = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StoryStatistics');
  return StoryStatistics ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StoryStatistics, props) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_3__["default"], null);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StoryStatisticsAsync);

/***/ },

/***/ "./src/components/right/userPortrait/UserPortraitBasicCard.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/right/userPortrait/UserPortraitBasicCard.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PortraitTagColors: () => (/* binding */ PortraitTagColors),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chatAssistant_store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../chatAssistant/store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _UserPortrait_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./UserPortrait.scss */ "./src/components/right/userPortrait/UserPortrait.scss");
/* harmony import */ var _util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/subscriptionHandler */ "./src/util/subscriptionHandler.ts");

/* eslint-disable max-len */








const PortraitTagColors = ['#E5D9FF', '#CCD6FF', '#B6FFCE', '#FFD9D9', '#FFD9FF'];
const UserPortraitBaseCard = ({
  userId,
  user,
  onClose
}) => {
  const [portraitInfo, setPortraitInfo] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const getPortraitInfo = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(async () => {
    const info = await _chatAssistant_store__WEBPACK_IMPORTED_MODULE_3__.ChataiStores.userPortrait?.getUserPortrait(userId);
    setPortraitInfo(info);
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    getPortraitInfo();
  }, [userId]);
  const handlePortraitClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_6__.checkCredisBalance)()) {
      (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openPayPackageModal();
      return;
    }
    const subscriptionInfo = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().subscriptionInfo;
    if (subscriptionInfo.subscriptionType === 'plus') {
      (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openUserPortrait({
        userId
      });
    } else {
      (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openPayPackageModal();
    }
    onClose();
  });
  function renderBasicInfo() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "border-b-[1px] border-[#F3F3F3] px-[12px] pb-[12px]"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-[20px] font-[700] mb-2"
    }, "Portrait"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-[16px] font-[700] mb-2"
    }, "Basic Description"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex flex-col gap-1"
    }, user?.usernames?.[0]?.username && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "font-[600]"
    }, "Username: "), user?.usernames?.[0]?.username), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "font-[600]"
    }, "Alias/Nickname: "), user?.firstName, " ", user?.lastName), portraitInfo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, portraitInfo.langs && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "font-[600]"
    }, "Language: "), `${portraitInfo.langs?.[0] ? `${portraitInfo.langs?.[0]}(Primary)` : ''} ${portraitInfo.langs?.[1] ? `, ${portraitInfo.langs?.[1]}(Secondary)` : ''}`), portraitInfo?.tags && portraitInfo?.tags?.length > 0 && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "font-[600]"
    }, "Tags: ")), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex flex-row flex-wrap items-center gap-2"
    }, portraitInfo?.tags?.map((tag, index) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex items-center justify-center px-2 rounded-[4px] h-[28px] text-[12px] font-[500] text-black",
      style: `background: ${PortraitTagColors[index]}`
    }, tag)))))));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "w-[24rem]"
  }, renderBasicInfo(), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "h-[42px] flex items-center justify-center text-[var(--color-primary)] text-[14px] font-semibold pt-[0.5rem] cursor-pointer",
    onClick: handlePortraitClick
  }, "View details"));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  userId
}) => {
  const user = userId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectUser)(global, userId) : undefined;
  return {
    user
  };
})(UserPortraitBaseCard)));

/***/ },

/***/ "./src/components/right/userPortrait/UserPortraitBasicCardMenu.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/right/userPortrait/UserPortraitBasicCardMenu.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UserPortraitBasicCardMenu: () => (/* binding */ UserPortraitBasicCardMenu)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useMouseInside__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useMouseInside */ "./src/hooks/useMouseInside.ts");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _UserPortraitBasicCard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./UserPortraitBasicCard */ "./src/components/right/userPortrait/UserPortraitBasicCard.tsx");
function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }





const UserPortraitBasicCardMenu = ({
  menuRef,
  isOpen,
  userId,
  onClose,
  ...menuPositionOptions
}) => {
  const [handleMouseEnter, handleMouseLeave, markMouseInside] = (0,_hooks_useMouseInside__WEBPACK_IMPORTED_MODULE_1__["default"])(isOpen, onClose);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen) {
      markMouseInside();
    }
  }, [isOpen, markMouseInside]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_2__["default"], _extends({
    ref: menuRef,
    isOpen: isOpen
    // eslint-disable-next-line react/jsx-no-bind
    ,
    onClose: onClose,
    onCloseAnimationEnd: onClose,
    className: "PortraitMenu",
    withPortal: true,
    onMouseEnter: handleMouseEnter,
    onMouseLeave: handleMouseLeave,
    noCompact: true
    // eslint-disable-next-line react/jsx-props-no-spreading
  }, menuPositionOptions), isOpen && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_UserPortraitBasicCard__WEBPACK_IMPORTED_MODULE_3__["default"], {
    userId: userId,
    onClose: onClose
  }));
};

/***/ },

/***/ "./src/components/story/StoryViewer.async.tsx"
/*!****************************************************!*\
  !*** ./src/components/story/StoryViewer.async.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");




const StoryViewerAsync = ({
  isOpen
}) => {
  const StoryViewer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StoryViewer', !isOpen);
  return StoryViewer ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StoryViewer, null) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StoryViewerAsync));

/***/ },

/***/ "./src/global/actions/all.ts"
/*!***********************************!*\
  !*** ./src/global/actions/all.ts ***!
  \***********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_initial__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./api/initial */ "./src/global/actions/api/initial.ts");
/* harmony import */ var _api_chats__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./api/chats */ "./src/global/actions/api/chats.ts");
/* harmony import */ var _api_messages__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./api/messages */ "./src/global/actions/api/messages.ts");
/* harmony import */ var _api_symbols__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./api/symbols */ "./src/global/actions/api/symbols.ts");
/* harmony import */ var _api_globalSearch__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./api/globalSearch */ "./src/global/actions/api/globalSearch.ts");
/* harmony import */ var _api_middleSearch__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./api/middleSearch */ "./src/global/actions/api/middleSearch.ts");
/* harmony import */ var _api_management__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./api/management */ "./src/global/actions/api/management.ts");
/* harmony import */ var _api_sync__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./api/sync */ "./src/global/actions/api/sync.ts");
/* harmony import */ var _api_accounts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./api/accounts */ "./src/global/actions/api/accounts.ts");
/* harmony import */ var _api_users__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./api/users */ "./src/global/actions/api/users.ts");
/* harmony import */ var _api_bots__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./api/bots */ "./src/global/actions/api/bots.ts");
/* harmony import */ var _api_settings__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./api/settings */ "./src/global/actions/api/settings.ts");
/* harmony import */ var _api_twoFaSettings__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./api/twoFaSettings */ "./src/global/actions/api/twoFaSettings.ts");
/* harmony import */ var _api_payments__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./api/payments */ "./src/global/actions/api/payments.ts");
/* harmony import */ var _api_stars__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./api/stars */ "./src/global/actions/api/stars.ts");
/* harmony import */ var _api_reactions__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./api/reactions */ "./src/global/actions/api/reactions.ts");
/* harmony import */ var _api_statistics__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./api/statistics */ "./src/global/actions/api/statistics.ts");
/* harmony import */ var _api_stories__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./api/stories */ "./src/global/actions/api/stories.ts");
/* harmony import */ var _ui_initial__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./ui/initial */ "./src/global/actions/ui/initial.ts");
/* harmony import */ var _ui_chats__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./ui/chats */ "./src/global/actions/ui/chats.ts");
/* harmony import */ var _ui_bots__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./ui/bots */ "./src/global/actions/ui/bots.ts");
/* harmony import */ var _ui_messages__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./ui/messages */ "./src/global/actions/ui/messages.ts");
/* harmony import */ var _ui_globalSearch__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./ui/globalSearch */ "./src/global/actions/ui/globalSearch.ts");
/* harmony import */ var _ui_middleSearch__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./ui/middleSearch */ "./src/global/actions/ui/middleSearch.ts");
/* harmony import */ var _ui_stickerSearch__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./ui/stickerSearch */ "./src/global/actions/ui/stickerSearch.ts");
/* harmony import */ var _ui_account__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./ui/account */ "./src/global/actions/ui/account.ts");
/* harmony import */ var _ui_users__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./ui/users */ "./src/global/actions/ui/users.ts");
/* harmony import */ var _ui_settings__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./ui/settings */ "./src/global/actions/ui/settings.ts");
/* harmony import */ var _ui_misc__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./ui/misc */ "./src/global/actions/ui/misc.ts");
/* harmony import */ var _ui_payments__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./ui/payments */ "./src/global/actions/ui/payments.ts");
/* harmony import */ var _ui_calls__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ui/calls */ "./src/global/actions/ui/calls.ts");
/* harmony import */ var _ui_mediaViewer__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./ui/mediaViewer */ "./src/global/actions/ui/mediaViewer.ts");
/* harmony import */ var _ui_passcode__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./ui/passcode */ "./src/global/actions/ui/passcode.ts");
/* harmony import */ var _ui_stars__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./ui/stars */ "./src/global/actions/ui/stars.ts");
/* harmony import */ var _ui_reactions__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./ui/reactions */ "./src/global/actions/ui/reactions.ts");
/* harmony import */ var _ui_stories__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./ui/stories */ "./src/global/actions/ui/stories.ts");
/* harmony import */ var _ui_statistics__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./ui/statistics */ "./src/global/actions/ui/statistics.ts");
/* harmony import */ var _ui_credits__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./ui/credits */ "./src/global/actions/ui/credits.ts");
/* harmony import */ var _apiUpdaters_initial__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./apiUpdaters/initial */ "./src/global/actions/apiUpdaters/initial.ts");
/* harmony import */ var _apiUpdaters_chats__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./apiUpdaters/chats */ "./src/global/actions/apiUpdaters/chats.ts");
/* harmony import */ var _apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./apiUpdaters/messages */ "./src/global/actions/apiUpdaters/messages.ts");
/* harmony import */ var _apiUpdaters_users__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./apiUpdaters/users */ "./src/global/actions/apiUpdaters/users.ts");
/* harmony import */ var _apiUpdaters_symbols__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./apiUpdaters/symbols */ "./src/global/actions/apiUpdaters/symbols.ts");
/* harmony import */ var _apiUpdaters_misc__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./apiUpdaters/misc */ "./src/global/actions/apiUpdaters/misc.ts");
/* harmony import */ var _apiUpdaters_settings__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./apiUpdaters/settings */ "./src/global/actions/apiUpdaters/settings.ts");
/* harmony import */ var _apiUpdaters_twoFaSettings__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./apiUpdaters/twoFaSettings */ "./src/global/actions/apiUpdaters/twoFaSettings.ts");
/* harmony import */ var _apiUpdaters_calls__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./apiUpdaters/calls */ "./src/global/actions/apiUpdaters/calls.ts");
/* harmony import */ var _apiUpdaters_payments__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./apiUpdaters/payments */ "./src/global/actions/apiUpdaters/payments.ts");

















































/***/ },

/***/ "./src/global/actions/api/accounts.ts"
/*!********************************************!*\
  !*** ./src/global/actions/api/accounts.ts ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('reportPeer', async (global, actions, payload) => {
  const {
    chatId,
    reason,
    description,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('reportPeer', {
    peer: chat,
    reason,
    description
  });
  actions.showNotification({
    message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('reportProfilePhoto', async (global, actions, payload) => {
  const {
    chatId,
    reason,
    description,
    photo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  if (!chat || !photo) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('reportProfilePhoto', {
    peer: chat,
    photo,
    reason,
    description
  });
  actions.showNotification({
    message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('loadAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('fetchAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      byHash: result.authorizations,
      orderedHashes: Object.keys(result.authorizations),
      ttlDays: result.ttlDays
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('terminateAuthorization', async (global, actions, payload) => {
  const {
    hash
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('terminateAuthorization', hash);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  const {
    [hash]: removedSessions,
    ...newSessions
  } = global.activeSessions.byHash;
  global = {
    ...global,
    activeSessions: {
      byHash: newSessions,
      orderedHashes: global.activeSessions.orderedHashes.filter(el => el !== hash)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('terminateAllAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('terminateAllAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  const currentSessionHash = global.activeSessions.orderedHashes.find(hash => global.activeSessions.byHash[hash].isCurrent);
  if (!currentSessionHash) {
    return;
  }
  const currentSession = global.activeSessions.byHash[currentSessionHash];
  global = {
    ...global,
    activeSessions: {
      byHash: {
        [currentSessionHash]: currentSession
      },
      orderedHashes: [currentSessionHash]
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('changeSessionSettings', async (global, actions, payload) => {
  const {
    hash,
    areCallsEnabled,
    areSecretChatsEnabled,
    isConfirmed
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('changeSessionSettings', {
    hash,
    areCallsEnabled,
    areSecretChatsEnabled,
    isConfirmed
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      ...global.activeSessions,
      byHash: {
        ...global.activeSessions.byHash,
        [hash]: {
          ...global.activeSessions.byHash[hash],
          ...(areCallsEnabled !== undefined ? {
            areCallsEnabled
          } : undefined),
          ...(areSecretChatsEnabled !== undefined ? {
            areSecretChatsEnabled
          } : undefined),
          ...(isConfirmed && {
            isUnconfirmed: undefined
          })
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('changeSessionTtl', async (global, actions, payload) => {
  const {
    days
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('changeSessionTtl', {
    days
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeSessions: {
      ...global.activeSessions,
      ttlDays: days
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('loadWebAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('fetchWebAuthorizations');
  if (!result) {
    return;
  }
  const {
    webAuthorizations
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeWebSessions: {
      byHash: webAuthorizations,
      orderedHashes: Object.keys(webAuthorizations)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('terminateWebAuthorization', async (global, actions, payload) => {
  const {
    hash
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('terminateWebAuthorization', hash);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  const {
    [hash]: removedSessions,
    ...newSessions
  } = global.activeWebSessions.byHash;
  global = {
    ...global,
    activeWebSessions: {
      byHash: newSessions,
      orderedHashes: global.activeWebSessions.orderedHashes.filter(el => el !== hash)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('terminateAllWebAuthorizations', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('terminateAllWebAuthorizations');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    activeWebSessions: {
      byHash: {},
      orderedHashes: []
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('loadAccountDaysTtl', async (global, actions, payload) => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('fetchAccountTTL');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    settings: {
      ...global.settings,
      accountDaysTtl: result.days
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_3__.addActionHandler)('setAccountTTL', async (global, actions, payload) => {
  const {
    days,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  if (!days) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_2__.callApi)('setAccountTTL', {
    days
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_3__.getGlobal)();
  global = {
    ...global,
    settings: {
      ...global.settings,
      accountDaysTtl: days
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_3__.setGlobal)(global);
  actions.closeDeleteAccountModal({
    tabId
  });
});

/***/ },

/***/ "./src/global/actions/api/bots.ts"
/*!****************************************!*\
  !*** ./src/global/actions/api/bots.ts ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   checkIfOpenOrActivate: () => (/* binding */ checkIfOpenOrActivate),
/* harmony export */   isWepAppOpened: () => (/* binding */ isWepAppOpened)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_PopupManager__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/PopupManager */ "./src/util/PopupManager.ts");
/* harmony import */ var _util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/requestActionTimeout */ "./src/util/requestActionTimeout.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_themeStyle__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../util/themeStyle */ "./src/util/themeStyle.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_bots__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../helpers/bots */ "./src/global/helpers/bots.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_bots__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../reducers/bots */ "./src/global/reducers/bots.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_sharedState__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./chats */ "./src/global/actions/api/chats.ts");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./messages */ "./src/global/actions/api/messages.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");


























const GAMEE_URL = 'https://prizes.gamee.com/';
const TOP_PEERS_REQUEST_COOLDOWN = 60; // 1 min
const runDebouncedForSearch = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_11__.debounce)(cb => cb(), 500, false);
let botFatherId;
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('clickSuggestedMessageButton', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    button,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const {
    buttonType
  } = button;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  switch (buttonType) {
    case 'suggestChanges':
      if (!message) break;
      actions.initDraftFromSuggestedMessage({
        chatId,
        messageId,
        tabId
      });
      break;
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('clickBotInlineButton', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    button,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  switch (button.type) {
    case 'command':
      actions.sendBotCommand({
        command: button.text,
        tabId
      });
      break;
    case 'url':
      {
        const {
          url
        } = button;
        actions.openUrl({
          url,
          tabId
        });
        break;
      }
    case 'copy':
      {
        (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_3__.copyTextToClipboard)(button.copyText);
        actions.showNotification({
          message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_8__.oldTranslate)('ExactTextCopied', button.copyText),
          tabId
        });
        break;
      }
    case 'callback':
      {
        void answerCallbackButton(global, actions, chat, messageId, button.data, undefined, tabId);
        break;
      }
    case 'requestPoll':
      actions.openPollModal({
        isQuiz: button.isQuiz,
        tabId
      });
      break;
    case 'requestPhone':
      {
        const user = global.currentUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, global.currentUserId) : undefined;
        if (!user) {
          return;
        }
        actions.showDialog({
          data: {
            phoneNumber: user.phoneNumber,
            firstName: user.firstName || '',
            lastName: user.lastName || '',
            userId: user.id
          },
          tabId
        });
        break;
      }
    case 'receipt':
      {
        const {
          receiptMessageId
        } = button;
        actions.getReceipt({
          chatId: chat.id,
          messageId: receiptMessageId,
          tabId
        });
        break;
      }
    case 'buy':
      {
        actions.openInvoice({
          type: 'message',
          chatId: chat.id,
          messageId,
          tabId
        });
        break;
      }
    case 'game':
      {
        void answerCallbackButton(global, actions, chat, messageId, undefined, true, tabId);
        break;
      }
    case 'switchBotInline':
      {
        const {
          query,
          isSamePeer
        } = button;
        actions.switchBotInline({
          query,
          isSamePeer,
          messageId,
          tabId
        });
        break;
      }
    case 'userProfile':
      {
        const {
          userId
        } = button;
        actions.openChatWithInfo({
          id: userId,
          tabId
        });
        break;
      }
    case 'simpleWebView':
      {
        const {
          url
        } = button;
        const sender = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSender)(global, message);
        if (!sender) {
          return;
        }
        const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_13__.extractCurrentThemeParams)();
        actions.requestSimpleWebView({
          url,
          botId: sender.id,
          theme,
          buttonText: button.text,
          tabId
        });
        break;
      }
    case 'webView':
      {
        const {
          url
        } = button;
        const sender = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSender)(global, message);
        const botId = message.viaBotId || sender?.id;
        if (!botId) {
          return;
        }
        const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_13__.extractCurrentThemeParams)();
        actions.requestWebView({
          url,
          botId,
          peerId: chat.id,
          theme,
          buttonText: button.text,
          tabId
        });
        break;
      }
    case 'urlAuth':
      {
        const {
          url
        } = button;
        actions.requestBotUrlAuth({
          chatId: chat.id,
          messageId,
          buttonId: button.buttonId,
          url,
          tabId
        });
        break;
      }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('sendBotCommand', (global, actions, payload) => {
  const {
    command,
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const chat = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentChat)(global, tabId);
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  if (!chat || !currentMessageList) {
    return;
  }
  const {
    threadId
  } = currentMessageList;
  actions.resetDraftReplyInfo({
    tabId
  });
  actions.clearWebPagePreview({
    tabId
  });
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatLastMessageId)(global, chat.id);
  void sendBotCommand(chat, command, (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chat.id, threadId)?.replyInfo, (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSendAs)(global, chat.id), lastMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('restartBot', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const {
    currentUserId
  } = global;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentChat)(global, tabId);
  const bot = currentUserId && (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectBot)(global, chatId);
  if (!currentUserId || !chat || !bot) {
    return;
  }
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatLastMessageId)(global, chat.id);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('unblockUser', {
    user: bot
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.removeBlockedUser)(global, bot.id);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  void sendBotCommand(chat, '/start', undefined, (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSendAs)(global, chatId), lastMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('loadTopInlineBots', async global => {
  const {
    lastRequestedAt
  } = global.topInlineBots;
  if (lastRequestedAt && (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_12__.getServerTime)() - lastRequestedAt < TOP_PEERS_REQUEST_COOLDOWN) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchTopInlineBots');
  if (!result) {
    return;
  }
  const {
    ids
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = {
    ...global,
    topInlineBots: {
      ...global.topInlineBots,
      userIds: ids,
      lastRequestedAt: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_12__.getServerTime)()
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('loadTopBotApps', async global => {
  const {
    lastRequestedAt
  } = global.topBotApps;
  if (lastRequestedAt && (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_12__.getServerTime)() - lastRequestedAt < TOP_PEERS_REQUEST_COOLDOWN) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchTopBotApps');
  if (!result) {
    return;
  }
  const {
    ids
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = {
    ...global,
    topBotApps: {
      ...global.topBotApps,
      userIds: ids,
      lastRequestedAt: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_12__.getServerTime)()
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('queryInlineBot', async (global, actions, payload) => {
  const {
    chatId,
    username,
    query,
    offset,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  let inlineBotData = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  if (inlineBotData === false) {
    return;
  }
  if (inlineBotData === undefined) {
    const {
      user: inlineBot,
      chat
    } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchInlineBot', {
      username
    })) || {};
    global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
    if (!inlineBot || !chat) {
      global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.replaceInlineBotSettings)(global, username, false, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
      return;
    }
    inlineBotData = {
      id: inlineBot.id,
      query: '',
      offset: '',
      switchPm: undefined,
      canLoadMore: true,
      results: [],
      cacheTime: 0
    };
    global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.replaceInlineBotSettings)(global, username, inlineBotData, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  }
  if (query === inlineBotData.query && !inlineBotData.canLoadMore) {
    return;
  }
  void runDebouncedForSearch(() => {
    searchInlineBot(global, {
      username,
      inlineBotData,
      chatId,
      query,
      offset
    }, tabId);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('switchBotInline', (global, actions, payload) => {
  const {
    query,
    isSamePeer,
    messageId,
    filter,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  let {
    botId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentChat)(global, tabId);
  if (!chat) {
    return undefined;
  }
  if (!botId && messageId) {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatMessage)(global, chat.id, messageId);
    if (!message) {
      return undefined;
    }
    const sender = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSender)(global, message);
    botId = message.viaBotId || sender?.id;
  }
  if (!botId) {
    return undefined;
  }
  const botSender = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!botSender) {
    return undefined;
  }
  actions.openChatWithDraft({
    text: {
      text: `@${(0,_helpers__WEBPACK_IMPORTED_MODULE_15__.getMainUsername)(botSender)} ${query}`
    },
    chatId: isSamePeer ? chat.id : undefined,
    filter,
    tabId
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('sendInlineBotApiResult', async (global, actions, payload) => {
  const {
    chat,
    id,
    queryId,
    replyInfo,
    sendAs,
    isSilent,
    scheduledAt,
    allowPaidStars
  } = payload;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('sendInlineBotResult', {
    chat,
    resultId: id,
    queryId,
    replyInfo,
    sendAs,
    isSilent,
    scheduleDate: scheduledAt,
    allowPaidStars
  });
  if (allowPaidStars) actions.loadStarStatus();
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('sendInlineBotResult', async (global, actions, payload) => {
  const {
    id,
    queryId,
    isSilent,
    scheduledAt,
    threadId,
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (!id) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  const draftReplyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo);
  actions.resetDraftReplyInfo({
    tabId
  });
  actions.clearWebPagePreview({
    tabId
  });
  const starsForOneMessage = await (0,_messages__WEBPACK_IMPORTED_MODULE_24__.getPeerStarsForMessage)(global, chatId);
  const params = {
    chat,
    id,
    queryId,
    replyInfo,
    sendAs: (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSendAs)(global, chatId),
    isSilent,
    scheduledAt,
    allowPaidStars: starsForOneMessage
  };
  if (!starsForOneMessage) {
    actions.sendInlineBotApiResult(params);
    return;
  }
  actions.sendInlineBotApiResult({
    ...params
  });
  actions.showNotification({
    localId: queryId,
    title: {
      key: 'MessageSentPaidToastTitle',
      variables: {
        count: 1
      },
      options: {
        pluralValue: 1
      }
    },
    message: {
      key: 'MessageSentPaidToastText',
      variables: {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_7__.formatStarsAsText)((0,_util_localization__WEBPACK_IMPORTED_MODULE_6__.getTranslationFn)(), starsForOneMessage)
      }
    },
    icon: 'star',
    shouldUseCustomIcon: true,
    type: 'paidMessage',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('resetInlineBot', (global, actions, payload) => {
  const {
    username,
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  let inlineBotData = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  if (!inlineBotData) {
    return;
  }
  if (!force && Date.now() < inlineBotData.cacheTime) return;
  inlineBotData = {
    id: inlineBotData.id,
    query: '',
    offset: '',
    switchPm: undefined,
    canLoadMore: true,
    results: [],
    cacheTime: 0
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.replaceInlineBotSettings)(global, username, inlineBotData, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('resetAllInlineBots', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  const inlineBots = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).inlineBots.byUsername;
  Object.keys(inlineBots).forEach(username => {
    actions.resetInlineBot({
      username,
      tabId
    });
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('startBot', async (global, actions, payload) => {
  const {
    botId,
    param
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) {
    return;
  }
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUserFullInfo)(global, botId);
  if (!fullInfo) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchFullUser', {
      id: bot.id,
      accessHash: bot.accessHash
    });
    fullInfo = result?.fullInfo;
  }
  if (fullInfo?.isBlocked) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('unblockUser', {
      user: bot
    });
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('startBot', {
    bot,
    startParam: param
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('sharePhoneWithBot', async (global, actions, payload) => {
  const {
    botId
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) {
    return;
  }
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUserFullInfo)(global, botId);
  if (!fullInfo) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchFullUser', {
      id: bot.id,
      accessHash: bot.accessHash
    });
    fullInfo = result?.fullInfo;
  }
  if (fullInfo?.isBlocked) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('unblockUser', {
      user: bot
    });
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, botId);
  const currentUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, global.currentUserId);
  if (!chat) return;
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChatLastMessageId)(global, chat.id);
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('sendMessage', {
    chat,
    contact: {
      mediaType: 'contact',
      firstName: currentUser.firstName || '',
      lastName: currentUser.lastName || '',
      phoneNumber: currentUser.phoneNumber || '',
      userId: currentUser.id
    },
    lastMessageId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('requestSimpleWebView', async (global, actions, payload) => {
  const {
    url,
    botId,
    theme,
    buttonText,
    isFromSideMenu,
    isFromSwitchWebView,
    startParam,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (checkIfOpenOrActivate(global, botId, tabId, url)) return;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'webApp',
        onConfirm: {
          action: 'requestSimpleWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    return;
  }
  const webViewUrl = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestSimpleWebView', {
    url,
    bot,
    theme,
    startParam,
    isFromSideMenu,
    isFromSwitchWebView
  });
  if (!webViewUrl) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  const newActiveApp = {
    requestUrl: url,
    appName: bot.firstName,
    url: webViewUrl,
    botId,
    buttonText
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.addWebAppToOpenList)(global, newActiveApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('requestWebView', async (global, actions, payload) => {
  const {
    url,
    botId,
    peerId,
    theme,
    isSilent,
    buttonText,
    isFromBotMenu,
    startParam,
    isFullscreen,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (checkIfOpenOrActivate(global, botId, tabId, url)) return;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPeer)(global, peerId);
  if (!peer) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'webApp',
        onConfirm: {
          action: 'requestWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    return;
  }
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentMessageList)(global, tabId);
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = currentMessageList || {};
  const draftReplyInfo = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectDraft)(global, chatId, threadId)?.replyInfo : undefined;
  const replyInfo = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo) : undefined;
  const sendAs = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSendAs)(global, chatId) : undefined;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestWebView', {
    url,
    bot,
    peer,
    theme,
    isSilent,
    replyInfo,
    isFromBotMenu,
    startParam,
    sendAs,
    isFullscreen
  });
  if (!result) {
    return;
  }
  const {
    url: webViewUrl,
    queryId,
    isFullScreen
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  const newActiveApp = {
    requestUrl: url,
    url: webViewUrl,
    appName: bot.firstName,
    botId,
    peerId,
    queryId,
    replyInfo,
    buttonText
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.addWebAppToOpenList)(global, newActiveApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  if (isFullScreen && (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_25__.getIsWebAppsFullscreenSupported)()) {
    actions.changeWebAppModalState({
      state: 'fullScreen',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('requestMainWebView', async (global, actions, payload) => {
  const {
    botId,
    peerId,
    theme,
    startParam,
    mode,
    shouldMarkBotTrusted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return;
  }
  if (checkIfOpenOrActivate(global, botId, tabId)) return;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectPeer)(global, peerId);
  if (!peer) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsTrustedBot)(global, botId)) {
    if (shouldMarkBotTrusted) {
      actions.markBotTrusted({
        botId,
        isWriteAllowed: true,
        tabId
      });
    } else {
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
        botTrustRequest: {
          botId,
          type: 'webApp',
          onConfirm: {
            action: 'requestMainWebView',
            payload
          }
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
      return;
    }
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestMainWebView', {
    bot,
    peer,
    theme,
    startParam,
    mode
  });
  if (!result) {
    return;
  }
  const {
    url: webViewUrl,
    queryId,
    isFullscreen
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  const newActiveApp = {
    url: webViewUrl,
    appName: bot.firstName,
    botId,
    peerId,
    queryId,
    buttonText: ''
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.addWebAppToOpenList)(global, newActiveApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  if (isFullscreen && (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_25__.getIsWebAppsFullscreenSupported)()) {
    actions.changeWebAppModalState({
      state: 'fullScreen',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('loadPreviewMedias', async (global, actions, payload) => {
  const {
    botId
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;
  const medias = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchPreviewMedias', {
    bot
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  if (medias) {
    global = {
      ...global,
      users: {
        ...global.users,
        previewMediaByBotId: {
          ...global.users.previewMediaByBotId,
          [botId]: medias
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openWebAppsCloseConfirmationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    isWebAppsCloseConfirmationModalOpen: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeWebAppsCloseConfirmationModal', (global, actions, payload) => {
  const {
    shouldSkipInFuture,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateSharedSettings)(global, {
    shouldSkipWebAppCloseConfirmation: Boolean(shouldSkipInFuture)
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    isWebAppsCloseConfirmationModalOpen: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('requestAppWebView', async (global, actions, payload) => {
  const {
    botId,
    appName,
    startApp,
    mode,
    theme,
    isWriteAllowed,
    isFromConfirm,
    shouldSkipBotTrustRequest,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (checkIfOpenOrActivate(global, botId, tabId, appName)) return;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;

  // Native clients require to install attach bots before using their named mini apps
  const isAttachBotInstalled = Boolean(global.attachMenu.bots[bot.id]);
  if (bot.isAttachBot && !isFromConfirm && !isAttachBotInstalled) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('loadAttachBot', {
      bot
    });
    if (result) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
      const attachBot = result.bot;
      const shouldAskForTos = attachBot.isDisclaimerNeeded || attachBot.isForAttachMenu || attachBot.isForSideMenu;
      if (shouldAskForTos) {
        global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
          requestedAttachBotInstall: {
            bot: attachBot,
            onConfirm: {
              action: 'requestAppWebView',
              payload: {
                ...payload,
                isFromConfirm: true
              }
            }
          }
        }, tabId);
        (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
        return;
      }
    }
  }
  const botApp = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchBotApp', {
    bot,
    appName
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  if (!botApp) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_8__.oldTranslate)('lng_username_app_not_found'),
      tabId
    });
    return;
  }
  const shouldRequestBotTrust = !shouldSkipBotTrustRequest && (botApp.isInactive || !(0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectIsTrustedBot)(global, botId));
  if (shouldRequestBotTrust) {
    payload.shouldSkipBotTrustRequest = true;
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        shouldRequestWriteAccess: botApp.shouldRequestWriteAccess,
        type: 'botApp',
        onConfirm: {
          action: 'requestAppWebView',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    return;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectCurrentChat)(global, tabId);
  const {
    url,
    isFullscreen
  } = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestAppWebView', {
    peer: peer || bot,
    app: botApp,
    startParam: startApp,
    mode,
    isWriteAllowed,
    theme
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  if (!url) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  const peerId = peer ? peer.id : bot.id;
  const newActiveApp = {
    url,
    appName: appName && bot.firstName,
    peerId,
    botId,
    buttonText: ''
  };
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.addWebAppToOpenList)(global, newActiveApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  if (isFullscreen && (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_25__.getIsWebAppsFullscreenSupported)()) {
    actions.changeWebAppModalState({
      state: 'fullScreen',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('prolongWebView', async (global, actions, payload) => {
  const {
    botId,
    peerId,
    isSilent,
    replyInfo,
    queryId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, peerId);
  if (!peer) return;
  const sendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectSendAs)(global, peerId);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('prolongWebView', {
    bot,
    peer,
    isSilent,
    replyInfo,
    queryId,
    sendAs
  });
  if (!result) {
    actions.closeActiveWebApp({
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('sendWebViewData', (global, actions, payload) => {
  const {
    bot,
    data,
    buttonText
  } = payload;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('sendWebViewData', {
    bot,
    data,
    buttonText
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('loadAttachBots', async global => {
  await loadAttachBots(global);
  (0,_util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_10__["default"])({
    action: 'loadAttachBots',
    payload: undefined
  }, _config__WEBPACK_IMPORTED_MODULE_2__.GENERAL_REFETCH_INTERVAL);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('toggleAttachBot', async (global, actions, payload) => {
  const {
    botId,
    isWriteAllowed,
    isEnabled
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('toggleAttachBot', {
    bot,
    isWriteAllowed,
    isEnabled
  });
});
function isWepAppOpened(global, webApp, tabId) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId);
  const openedWebApps = currentTabState.webApps.openedWebApps;
  const key = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_16__.getWebAppKey)(webApp);
  if (!key) return false;
  return openedWebApps[key];
}
function checkIfOpenOrActivate(global, botId, tabId, requestUrl, webAppName) {
  const webAppForCheck = {
    botId,
    requestUrl,
    webAppName
  };
  if (isWepAppOpened(global, webAppForCheck, tabId)) {
    const key = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_16__.getWebAppKey)(webAppForCheck);
    if (key) {
      global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.activateWebAppIfOpen)(global, key, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    }
    return true;
  }
  return false;
}
async function loadAttachBots(global, hash) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('loadAttachBots', {
    hash
  });
  if (!result) {
    return undefined;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = {
    ...global,
    attachMenu: {
      hash: result.hash,
      bots: result.bots
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  return result;
}
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('callAttachBot', (global, actions, payload) => {
  const {
    bot,
    startParam,
    isFromConfirm,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const isFromSideMenu = 'isFromSideMenu' in payload && payload.isFromSideMenu;
  const isFromBotMenu = !bot;
  const shouldDisplayDisclaimer = !isFromBotMenu && !global.attachMenu.bots[bot.id] || bot?.isInactive || bot?.isDisclaimerNeeded;
  if (!isFromConfirm && shouldDisplayDisclaimer) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      requestedAttachBotInstall: {
        bot,
        onConfirm: {
          action: 'callAttachBot',
          payload: {
            ...payload,
            isFromConfirm: true
          }
        }
      }
    }, tabId);
  }
  const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_13__.extractCurrentThemeParams)();
  if (isFromSideMenu) {
    actions.requestSimpleWebView({
      botId: bot.id,
      buttonText: '',
      isFromSideMenu: true,
      startParam,
      theme,
      tabId
    });
  }
  if ('chatId' in payload) {
    const {
      chatId,
      threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
      url
    } = payload;
    actions.openThread({
      chatId,
      threadId,
      tabId
    });
    actions.requestWebView({
      url,
      peerId: chatId,
      botId: isFromBotMenu ? chatId : bot.id,
      theme,
      buttonText: '',
      isFromBotMenu,
      startParam,
      tabId
    });
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('confirmAttachBotInstall', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const {
    requestedAttachBotInstall
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId);
  const {
    bot,
    onConfirm
  } = requestedAttachBotInstall;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    requestedAttachBotInstall: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  const botUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, bot.id);
  if (!botUser) return;
  actions.markBotTrusted({
    botId: bot.id,
    isWriteAllowed,
    tabId
  });
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('toggleAttachBot', {
    bot: botUser,
    isWriteAllowed,
    isEnabled: true
  });
  if (onConfirm) {
    const {
      action,
      payload: actionPayload
    } = onConfirm;
    // @ts-ignore
    actions[action](actionPayload);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('requestBotUrlAuth', async (global, actions, payload) => {
  const {
    chatId,
    buttonId,
    messageId,
    url,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestBotUrlAuth', {
    chat,
    buttonId,
    messageId
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    urlAuth: {
      url,
      button: {
        buttonId,
        messageId,
        chatId: chat.id
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('acceptBotUrlAuth', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId);
  if (!tabState.urlAuth?.button) return;
  const {
    button,
    url
  } = tabState.urlAuth;
  const {
    chatId,
    messageId,
    buttonId
  } = button;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('acceptBotUrlAuth', {
    chat,
    messageId,
    buttonId,
    isWriteAllowed
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('requestLinkUrlAuth', async (global, actions, payload) => {
  const {
    url,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('requestLinkUrlAuth', {
    url
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    urlAuth: {
      url
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('acceptLinkUrlAuth', async (global, actions, payload) => {
  const {
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId);
  if (!tabState.urlAuth?.url) return;
  const {
    url
  } = tabState.urlAuth;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('acceptLinkUrlAuth', {
    url,
    isWriteAllowed
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  handleUrlAuthResult(global, actions, url, result, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeUrlAuthModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
    urlAuth: undefined
  }, tabId);
});
function handleUrlAuthResult(global, actions, url, result, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()]) {
  if (result.type === 'request') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
    const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId);
    if (!tabState.urlAuth) return;
    const {
      domain,
      bot,
      shouldRequestWriteAccess
    } = result;
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_20__.updateTabState)(global, {
      urlAuth: {
        ...tabState.urlAuth,
        request: {
          domain,
          botId: bot.id,
          shouldRequestWriteAccess
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    return;
  }
  const siteUrl = result.type === 'accepted' ? result.url : url;
  window.open(siteUrl, '_blank', 'noopener');
  actions.closeUrlAuthModal({
    tabId
  });
}
async function searchInlineBot(global, {
  username,
  inlineBotData,
  chatId,
  query,
  offset
}, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()]) {
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, inlineBotData.id);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectChat)(global, chatId);
  if (!bot || !chat) {
    return;
  }
  const shouldReplaceSettings = inlineBotData.query !== query;
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.replaceInlineBotsIsLoading)(global, true, tabId);
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.replaceInlineBotSettings)(global, username, {
    ...inlineBotData,
    query,
    ...(shouldReplaceSettings && {
      offset: undefined,
      results: []
    })
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('fetchInlineBotResults', {
    bot,
    chat,
    query,
    offset: shouldReplaceSettings ? undefined : offset
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  const newInlineBotData = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectTabState)(global, tabId).inlineBots.byUsername[username];
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.replaceInlineBotsIsLoading)(global, false, tabId);
  if (!result || !newInlineBotData || query !== newInlineBotData.query) {
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    return;
  }
  const currentIds = new Set((newInlineBotData.results || []).map(data => data.id));
  const newResults = result.results.filter(data => !currentIds.has(data.id));
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_19__.replaceInlineBotSettings)(global, username, {
    ...newInlineBotData,
    help: result.help,
    cacheTime: Date.now() + result.cacheTime * 1000,
    ...(newResults.length && {
      isGallery: result.isGallery
    }),
    ...(result.switchPm && {
      switchPm: result.switchPm
    }),
    ...(result.switchWebview && {
      switchWebview: result.switchWebview
    }),
    canLoadMore: result.results.length > 0 && Boolean(result.nextOffset),
    results: newInlineBotData.offset === '' || newInlineBotData.offset === result.nextOffset ? result.results : (newInlineBotData.results || []).concat(newResults),
    offset: newResults.length ? result.nextOffset : ''
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
}
async function sendBotCommand(chat, command, replyInfo, sendAs, lastMessageId) {
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('sendMessage', {
    chat,
    replyInfo,
    text: command,
    sendAs,
    lastMessageId
  });
}
let gameePopups;
async function answerCallbackButton(global, actions, chat, messageId, data, isGame = false, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()]) {
  const {
    showDialog,
    showNotification,
    openUrl,
    openGame
  } = actions;
  if (isGame) {
    if (!gameePopups) {
      gameePopups = new _util_PopupManager__WEBPACK_IMPORTED_MODULE_9__["default"]('popup,width=800,height=600', () => {
        showNotification({
          message: 'Allow browser to open popup window',
          tabId
        });
      });
    }
    gameePopups.preOpenIfNeeded();
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('answerCallbackButton', {
    chatId: chat.id,
    accessHash: chat.accessHash,
    messageId,
    data,
    isGame
  });
  if (!result) {
    return;
  }
  const {
    message,
    alert: isError,
    url
  } = result;
  if (isError) {
    showDialog({
      data: {
        message: message || 'Error'
      },
      tabId
    });
  } else if (message) {
    showNotification({
      message,
      tabId
    });
  } else if (url) {
    if (isGame) {
      // Workaround for Gamee embedding bug
      if (url.includes(GAMEE_URL)) {
        gameePopups.open(url);
      } else {
        gameePopups.cancelPreOpen();
        openGame({
          url,
          chatId: chat.id,
          messageId,
          tabId
        });
      }
    } else {
      openUrl({
        url,
        tabId
      });
    }
  }
}
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setBotInfo', async (global, actions, payload) => {
  const {
    bot,
    name,
    description: about,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  let {
    langCode
  } = payload;
  if (!langCode) langCode = (0,_selectors_sharedState__WEBPACK_IMPORTED_MODULE_22__.selectSharedSettings)(global).language;
  const {
    currentUserId
  } = global;
  if (!currentUserId || !bot) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_1__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  if (name || about) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('setBotInfo', {
      bot,
      langCode,
      name,
      about
    });
    if (result) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateUser)(global, bot.id, {
        firstName: name
      });
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateUserFullInfo)(global, bot.id, {
        bio: about
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_1__.ManagementProgress.Complete, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('toggleUserEmojiStatusPermission', async (global, actions, payload) => {
  const {
    botId,
    isEnabled,
    isBotAccessEmojiGranted
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectBot)(global, botId);
  if (!botId || !bot) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_14__.callApi)('toggleUserEmojiStatusPermission', {
    bot,
    isEnabled
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateUserFullInfo)(global, botId, {
    isBotCanManageEmojiStatus: isEnabled,
    isBotAccessEmojiGranted
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('toggleUserLocationPermission', (global, actions, payload) => {
  const {
    botId,
    isAccessGranted
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_21__.selectUser)(global, botId);
  if (!bot) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateBotAppPermissions)(global, bot.id, {
    geolocation: isAccessGranted
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('startBotFatherConversation', async (global, actions, payload) => {
  const {
    param,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_5__.getCurrentTabId)()
  } = payload;
  if (!botFatherId) {
    const chat = await (0,_chats__WEBPACK_IMPORTED_MODULE_23__.fetchChatByUsername)(global, _config__WEBPACK_IMPORTED_MODULE_2__.BOT_FATHER_USERNAME);
    if (!chat) {
      return;
    }
    botFatherId = chat.id;
  }
  if (param) {
    actions.startBot({
      botId: botFatherId,
      param
    });
  }
  actions.openChat({
    id: botFatherId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('loadBotFreezeAppeal', async global => {
  const botUrl = global.appConfig?.freezeAppealUrl;
  if (!botUrl) return;
  const botAppealUsername = botUrl ? (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_4__.getUsernameFromDeepLink)(botUrl) : undefined;
  if (!botAppealUsername) return;
  const chat = await (0,_chats__WEBPACK_IMPORTED_MODULE_23__.fetchChatByUsername)(global, botAppealUsername);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = {
    ...global,
    botFreezeAppealId: chat?.id
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});

/***/ },

/***/ "./src/global/actions/api/globalSearch.ts"
/*!************************************************!*\
  !*** ./src/global/actions/api/globalSearch.ts ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers_chats__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../helpers/chats */ "./src/global/helpers/chats.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");












const searchThrottled = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_5__.throttle)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('setGlobalSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectTabState)(global, tabId).globalSearch;
  if (query && !chatId) {
    void searchThrottled(async () => {
      const [searchResult, sponsoredResult] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchChats', {
        query
      }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchSponsoredPeer', {
        query
      })]);
      global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
      const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectCurrentGlobalSearchQuery)(global, tabId);
      if (!searchResult || !currentSearchQuery || query !== currentSearchQuery) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearchFetchingStatus)(global, {
          chats: false
        }, tabId);
        (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
        return;
      }
      const {
        accountResultIds,
        globalResultIds
      } = searchResult;
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearchFetchingStatus)(global, {
        chats: false
      }, tabId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearch)(global, {
        localResults: {
          peerIds: accountResultIds
        },
        globalResults: {
          ...(0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectTabState)(global, tabId).globalSearch.globalResults,
          peerIds: globalResultIds
        },
        sponsoredPeer: sponsoredResult
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('setGlobalSearchDate', (global, actions, payload) => {
  const {
    date,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const maxDate = date ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_1__.timestampPlusDay)(date) : date;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearch)(global, {
    minDate: date,
    maxDate,
    query: '',
    resultsByType: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectTabState)(global, tabId).globalSearch.resultsByType,
      text: {
        totalCount: undefined,
        foundIds: [],
        nextOffsetId: 0
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  actions.searchMessagesGlobal({
    type: 'text',
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('searchMessagesGlobal', (global, actions, payload) => {
  const {
    type,
    context,
    shouldResetResultsByType,
    shouldCheckFetchingMessagesStatus,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  if (shouldCheckFetchingMessagesStatus) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearchFetchingStatus)(global, {
      messages: true
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  }
  const {
    query,
    resultsByType,
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectTabState)(global, tabId).globalSearch;
  const {
    totalCount,
    foundIds,
    nextOffsetId,
    nextOffsetPeerId,
    nextOffsetRate
  } = !shouldResetResultsByType && resultsByType?.[type] || {};

  // Stop loading if we have all the messages or server returned 0
  if (totalCount !== undefined && (!totalCount || foundIds && foundIds.length >= totalCount)) {
    return;
  }
  const chat = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectPeer)(global, chatId) : undefined;
  const offsetPeer = nextOffsetPeerId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectPeer)(global, nextOffsetPeerId) : undefined;
  searchMessagesGlobal(global, {
    query,
    type,
    context,
    shouldResetResultsByType,
    offsetRate: nextOffsetRate,
    offsetId: nextOffsetId,
    offsetPeer,
    peer: chat,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('searchPopularBotApps', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload || {};
  const popularBotApps = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectTabState)(global, tabId).globalSearch.popularBotApps;
  const offset = popularBotApps?.nextOffset;
  if (popularBotApps?.peerIds && !offset) return; // Already fetched all

  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearchFetchingStatus)(global, {
    botApps: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchPopularAppBots', {
    offset
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearchFetchingStatus)(global, {
      botApps: false
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearch)(global, {
    popularBotApps: {
      peerIds: [...(popularBotApps?.peerIds || []), ...result.peerIds],
      nextOffset: result.nextOffset
    }
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearchFetchingStatus)(global, {
    botApps: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('checkSearchPostsFlood', async (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('checkSearchPostsFlood', query);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  if (!result) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearch)(global, {
    searchFlood: result
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
async function searchMessagesGlobal(global, params) {
  const {
    query = '',
    type,
    context,
    offsetRate,
    offsetId,
    offsetPeer,
    peer,
    maxDate,
    minDate,
    shouldResetResultsByType,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
  } = params;
  let result;
  let messageLink;
  if (peer) {
    const inChatResultRequest = (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesInChat', {
      peer,
      query,
      type,
      limit: _config__WEBPACK_IMPORTED_MODULE_0__.GLOBAL_SEARCH_SLICE,
      offsetId,
      minDate,
      maxDate
    });
    const isChat = (0,_helpers_peers__WEBPACK_IMPORTED_MODULE_8__.isApiPeerChat)(peer);
    const topicsRequest = isChat && peer.isForum ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchTopics', {
      chat: peer,
      query,
      limit: _config__WEBPACK_IMPORTED_MODULE_0__.GLOBAL_TOPIC_SEARCH_SLICE
    }) : undefined;
    const [inChatResult, topics] = await Promise.all([inChatResultRequest, topicsRequest]);
    if (inChatResult) {
      const {
        messages,
        totalCount,
        nextOffsetId
      } = inChatResult;
      const {
        topics: localTopics,
        count
      } = topics || {};
      result = {
        topics: localTopics,
        totalTopicsCount: count,
        messages,
        totalCount,
        nextOffsetId
      };
    }
  } else {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesGlobal', {
      query,
      offsetRate,
      offsetId,
      offsetPeer,
      limit: _config__WEBPACK_IMPORTED_MODULE_0__.GLOBAL_SEARCH_SLICE,
      type,
      context,
      maxDate,
      minDate
    });
    if ((0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_2__.isDeepLink)(query)) {
      const link = (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_2__.tryParseDeepLink)(query);
      if (link?.type === 'publicMessageLink') {
        messageLink = await getMessageByPublicLink(global, link);
      } else if (link?.type === 'privateMessageLink') {
        messageLink = await getMessageByPrivateLink(global, link);
      }
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  if (shouldResetResultsByType) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearch)(global, {
      resultsByType: {
        ...((0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectTabState)(global, tabId).globalSearch || {}).resultsByType,
        [type]: undefined
      }
    }, tabId);
  }
  const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectCurrentGlobalSearchQuery)(global, tabId);
  if (!result || query !== '' && query !== currentSearchQuery) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearchFetchingStatus)(global, {
      messages: false
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
    return;
  }
  if (messageLink) {
    result.totalCount = result.messages.unshift(messageLink);
  }
  const {
    messages,
    userStatusesById,
    totalCount,
    nextOffsetRate,
    nextOffsetId,
    nextOffsetPeerId
  } = result;
  if (userStatusesById) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addUserStatuses)(global, userStatusesById);
  }
  if (messages.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addMessages)(global, messages);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearchResults)(global, messages, totalCount, type, nextOffsetRate, nextOffsetId, nextOffsetPeerId, tabId);
  if (result.topics) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateTopics)(global, peer.id, result.totalTopicsCount, result.topics);
  }
  const sortedTopics = result.topics?.map(({
    id
  }) => id).sort((a, b) => b - a);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateGlobalSearch)(global, {
    foundTopicIds: sortedTopics
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
}
async function getMessageByPublicLink(global, link) {
  const {
    username,
    messageId
  } = link;
  const localChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChatByUsername)(global, username);
  if (localChat) {
    return getChatGroupOrChannelMessage(global, localChat, messageId);
  }
  const {
    chat
  } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('getChatByUsername', username)) ?? {};
  if (!chat) {
    return undefined;
  }
  return getChatGroupOrChannelMessage(global, chat, messageId);
}
function getMessageByPrivateLink(global, link) {
  const {
    channelId,
    messageId
  } = link;
  const internalChannelId = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_3__.toChannelId)(channelId);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChat)(global, internalChannelId);
  if (!chat) {
    return undefined;
  }
  return getChatGroupOrChannelMessage(global, chat, messageId);
}
async function getChatGroupOrChannelMessage(global, chat, messageId) {
  if (!(0,_helpers_chats__WEBPACK_IMPORTED_MODULE_7__.isChatGroup)(chat) && !(0,_helpers_chats__WEBPACK_IMPORTED_MODULE_7__.isChatChannel)(chat)) {
    return undefined;
  }
  const localMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_11__.selectChatMessage)(global, chat.id, messageId);
  if (localMessage) {
    return localMessage;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchMessage', {
    chat,
    messageId
  });
  return result === 'MESSAGE_DELETED' ? undefined : result?.message;
}

/***/ },

/***/ "./src/global/actions/api/management.ts"
/*!**********************************************!*\
  !*** ./src/global/actions/api/management.ts ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./chats */ "./src/global/actions/api/chats.ts");









(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('checkPublicLink', async (global, actions, payload) => {
  const {
    username,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }

  // No need to check the username if already in progress
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.progress === _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    isUsernameAvailable: undefined,
    checkedUsername: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const {
    result,
    error
  } = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('checkChatUsername', {
    username
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, result === true ? _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete : _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    isUsernameAvailable: result === true,
    checkedUsername: username,
    error
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  if (result === undefined) {
    actions.openLimitReachedModal({
      limit: 'channelsPublic',
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updatePublicLink', async (global, actions, payload) => {
  const {
    username,
    shouldDisableUsernames,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }
  const chat = await (0,_chats__WEBPACK_IMPORTED_MODULE_8__.ensureIsSuperGroup)(global, actions, chatId, tabId);
  if (!chat) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('setChatUsername', {
    chat,
    username
  });
  if (shouldDisableUsernames) {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('deactivateAllUsernames', {
      chat
    });
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, result ? _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete : _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chat.id, {
    isUsernameAvailable: undefined,
    checkedUsername: undefined,
    error: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updatePrivateLink', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  const chat = chatId && (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!chatId || !chat) {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('updatePrivateLink', {
    chat
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setEditingExportedInvite', (global, actions, payload) => {
  const {
    chatId,
    invite,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    editingInvite: invite
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setOpenedInviteInfo', (global, actions, payload) => {
  const {
    chatId,
    invite,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const update = invite ? {
    inviteInfo: {
      invite
    }
  } : {
    inviteInfo: undefined
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, update, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadExportedChatInvites', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsCurrentUserFrozen)(global)) return;
  const {
    chatId,
    adminId,
    isRevoked,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const admin = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, adminId || global.currentUserId);
  if (!peer || !admin) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchExportedChatInvites', {
    peer,
    admin,
    isRevoked,
    limit
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const {
    invites
  } = result;
  const update = isRevoked ? {
    revokedInvites: invites
  } : {
    invites
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, update, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('editExportedChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    link,
    isRevoked,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('editExportedChatInvite', {
    peer,
    link,
    isRevoked,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title
  });
  if (!result) {
    return;
  }
  const {
    oldInvite,
    newInvite
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const {
    management
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId);
  const invites = (management.byChatId[chatId].invites || []).filter(current => current.link !== oldInvite.link);
  const revokedInvites = [...(management.byChatId[chatId].revokedInvites || [])];
  if (newInvite.isRevoked) {
    revokedInvites.unshift(newInvite);
  } else {
    invites.push(newInvite);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    invites,
    revokedInvites
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('exportChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('exportChatInvite', {
    peer,
    expireDate,
    usageLimit,
    isRequestNeeded,
    title
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const invites = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.byChatId[chatId].invites || [];
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    invites: [...invites, result]
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('deleteExportedChatInvite', async (global, actions, payload) => {
  const {
    chatId,
    link,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('deleteExportedChatInvite', {
    peer,
    link
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const managementState = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.byChatId[chatId];
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    invites: managementState?.invites?.filter(invite => invite.link !== link),
    revokedInvites: managementState?.revokedInvites?.filter(invite => invite.link !== link)
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('deleteRevokedExportedChatInvites', async (global, actions, payload) => {
  const {
    chatId,
    adminId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const admin = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, adminId || global.currentUserId);
  if (!peer || !admin) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('deleteRevokedExportedChatInvites', {
    peer,
    admin
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    revokedInvites: []
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadChatInviteImporters', async (global, actions, payload) => {
  const {
    chatId,
    link,
    offsetDate,
    offsetUserId,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchChatInviteImporters', {
    peer,
    link,
    offsetDate,
    offsetUser,
    limit
  });
  if (!result) {
    return;
  }
  const {
    importers
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const currentInviteInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.byChatId[chatId]?.inviteInfo;
  if (!currentInviteInfo?.invite || currentInviteInfo.invite.link !== link) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    inviteInfo: {
      ...currentInviteInfo,
      importers
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadChatInviteRequesters', async (global, actions, payload) => {
  const {
    chatId,
    link,
    offsetDate,
    offsetUserId,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchChatInviteImporters', {
    peer,
    link,
    offsetDate,
    offsetUser,
    limit,
    isRequested: true
  });
  if (!result) {
    return;
  }
  const {
    importers
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const currentInviteInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).management.byChatId[chatId]?.inviteInfo;
  if (!currentInviteInfo?.invite || currentInviteInfo.invite.link !== link) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    inviteInfo: {
      ...currentInviteInfo,
      requesters: importers
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadChatJoinRequests', async (global, actions, payload) => {
  const {
    chatId,
    offsetDate = 0,
    offsetUserId,
    limit = 0
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const offsetUser = offsetUserId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, offsetUserId) : undefined;
  if (!peer || offsetUserId && !offsetUser) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchChatInviteImporters', {
    peer,
    offsetDate,
    offsetUser,
    limit,
    isRequested: true
  });
  if (!result) {
    return;
  }
  const {
    importers
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
    joinRequests: importers
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('hideChatJoinRequest', async (global, actions, payload) => {
  const {
    chatId,
    userId,
    isApproved
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, userId);
  if (!peer || !user) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('hideChatJoinRequest', {
    peer,
    user,
    isApproved
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const targetChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!targetChat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
    joinRequests: targetChat.joinRequests?.filter(importer => importer.userId !== userId)
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('hideAllChatJoinRequests', async (global, actions, payload) => {
  const {
    chatId,
    isApproved,
    link
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('hideAllChatJoinRequests', {
    peer,
    isApproved,
    link
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const targetChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  if (!targetChat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
    joinRequests: []
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChatFullInfo)(global, chatId, {
    recentRequesterIds: [],
    requestsPending: 0
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('hidePeerSettingsBar', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, peerId);
  if (!user) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('hidePeerSettingsBar', user);
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateUserFullInfo)(global, peerId, {
    settings: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('uploadContactProfilePhoto', async (global, actions, payload) => {
  const {
    userId,
    file,
    isSuggest,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUser)(global, userId);
  if (!user) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('uploadContactProfilePhoto', {
    user,
    file,
    isSuggest
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const {
    id,
    accessHash
  } = user;
  const newUser = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchFullUser', {
    id,
    accessHash
  });
  if (!newUser) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Error, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
    return;
  }
  actions.loadMoreProfilePhotos({
    peerId: userId,
    shouldInvalidateCache: true
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  if (file && !isSuggest) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate('UserInfo.SetCustomPhoto.SuccessPhotoText', (0,_helpers__WEBPACK_IMPORTED_MODULE_4__.getUserFirstOrLastName)(user)),
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('resetManagementError', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateManagement)(global, chatId, {
    error: undefined
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/api/messages.ts"
/*!********************************************!*\
  !*** ./src/global/actions/api/messages.ts ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getPeerStarsForMessage: () => (/* binding */ getPeerStarsForMessage)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_browser_url__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/browser/url */ "./src/util/browser/url.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _components_chatAssistant_utils_chat_api__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../components/chatAssistant/utils/chat-api */ "./src/components/chatAssistant/utils/chat-api.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../apiUpdaters/messages */ "./src/global/actions/apiUpdaters/messages.ts");


























const AUTOLOGIN_TOKEN_KEY = 'autologin_token';
const uploadProgressCallbacks = new Map();
const runDebouncedForMarkRead = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_14__.debounce)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadViewportMessages', (global, actions, payload) => {
  const {
    direction = _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around,
    isBudgetPreload = false,
    shouldForceRender = false,
    onLoaded,
    onError,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  let {
    chatId,
    threadId
  } = payload || {};
  if (!chatId || !threadId) {
    const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
    if (!currentMessageList) {
      onError?.();
      return;
    }
    chatId = currentMessageList.chatId;
    threadId = currentMessageList.threadId;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const isRestricted = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsChatRestricted)(global, chatId);
  // TODO Revise if `isRestricted` check is needed
  if (!chat || isRestricted) {
    onError?.();
    return;
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectViewportIds)(global, chatId, threadId, tabId);
  const listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectListedIds)(global, chatId, threadId);
  if (!viewportIds || !viewportIds.length || direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around) {
    const offsetId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectFocusedMessageId)(global, chatId, tabId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectRealLastReadId)(global, chatId, threadId);
    const isOutlying = Boolean(offsetId && listedIds && !listedIds.includes(offsetId));
    const historyIds = (isOutlying ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : listedIds) || [];
    const {
      newViewportIds,
      areSomeLocal,
      areAllLocal
    } = getViewportSlice(historyIds, offsetId, _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around);
    if (areSomeLocal) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
    }
    if (!areAllLocal) {
      (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_14__.onTickEnd)(() => {
        void loadViewportMessages(global, chat, threadId, offsetId, _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around, isOutlying, isBudgetPreload, onLoaded, tabId);
      });
    } else {
      onLoaded?.();
    }
  } else {
    const offsetId = direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards ? viewportIds[0] : viewportIds[viewportIds.length - 1];

    // Prevent requests with local offsets
    if ((0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_9__.isLocalMessageId)(offsetId)) return;

    // Prevent unnecessary requests in threads
    if (offsetId === threadId && direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) return;
    const isOutlying = Boolean(listedIds && !listedIds.includes(offsetId));
    const historyIds = isOutlying ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : listedIds;
    if (historyIds?.length) {
      const {
        newViewportIds,
        areSomeLocal,
        areAllLocal
      } = getViewportSlice(historyIds, offsetId, direction);
      if (areSomeLocal) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
      }
      (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_14__.onTickEnd)(() => {
        void loadWithBudget(global, actions, areAllLocal, isOutlying, isBudgetPreload, chat, threadId, direction, offsetId, onLoaded, tabId);
      });
    }
    if (isBudgetPreload) {
      return;
    }
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global, {
    forceOnHeavyAnimation: shouldForceRender
  });
});
async function loadWithBudget(global, actions, areAllLocal, isOutlying, isBudgetPreload, chat, threadId, direction, offsetId, onLoaded, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()]) {
  if (!areAllLocal) {
    await loadViewportMessages(global, chat, threadId, offsetId, direction, isOutlying, isBudgetPreload, onLoaded, tabId);
  }
  if (!isBudgetPreload) {
    actions.loadViewportMessages({
      chatId: chat.id,
      threadId,
      direction,
      isBudgetPreload: true,
      onLoaded,
      tabId
    });
  }
}
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadMessage', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    replyOriginForId,
    threadUpdate
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const message = await loadMessage(global, chat, messageId, replyOriginForId);
  if (message && threadUpdate) {
    const {
      lastMessageId,
      isDeleting
    } = threadUpdate;
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateThreadUnreadFromForwardedMessage)(global, message, chatId, lastMessageId, isDeleting);
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadMessagesById', async (global, actions, payload) => {
  const {
    chatId,
    messageIds
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const messages = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchMessagesById', {
    chat,
    messageIds
  });
  if (!messages) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.addChatMessagesById)(global, chatId, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(messages, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('sendMessage', async (global, actions, payload) => {
  const {
    messageList,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const {
    storyId,
    peerId: storyPeerId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentViewedStory)(global, tabId);
  const isStoryReply = Boolean(storyId && storyPeerId);
  if (!messageList && !isStoryReply) {
    return;
  }
  let {
    chatId,
    threadId,
    type
  } = messageList || {};
  if (isStoryReply) {
    chatId = storyPeerId;
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
    type = 'thread';
  }
  payload = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.omit)(payload, ['tabId']);
  if (type === 'scheduled' && !payload.scheduledAt) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
      contentToBeScheduled: payload
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const draft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, chatId, threadId);
  const isForwarding = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).forwardMessages?.messageIds?.length;
  const draftReplyInfo = !isForwarding && !isStoryReply ? draft?.replyInfo : undefined;
  const draftSuggestedPostInfo = !isForwarding && !isStoryReply ? draft?.suggestedPostInfo : undefined;
  const storyReplyInfo = isStoryReply ? {
    type: 'story',
    peerId: storyPeerId,
    storyId: storyId
  } : undefined;
  const messageReplyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectMessageReplyInfo)(global, chatId, threadId, draftReplyInfo);
  const replyInfo = storyReplyInfo || messageReplyInfo;
  const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectThreadInfo)(global, chatId, threadId);
  const lastMessageId = threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatLastMessageId)(global, chatId) : threadInfo?.lastMessageId;
  const messagePriceInStars = await getPeerStarsForMessage(global, chatId);
  const suggestedPostPrice = draftSuggestedPostInfo?.price;
  const suggestedPostCurrency = suggestedPostPrice?.currency || _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE;
  const suggestedPostAmount = suggestedPostPrice?.amount || 0;
  if (suggestedPostAmount && !draftReplyInfo) {
    if (suggestedPostCurrency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE) {
      const currentBalance = global.stars?.balance?.amount || 0;
      if (suggestedPostAmount > currentBalance) {
        actions.openStarsBalanceModal({
          topup: {
            balanceNeeded: suggestedPostAmount
          },
          tabId
        });
        return;
      }
    } else if (suggestedPostCurrency === _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE) {
      const currentTonBalance = global.ton?.balance?.amount || 0;
      if (suggestedPostAmount > currentTonBalance) {
        actions.openStarsBalanceModal({
          currency: _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE,
          tabId
        });
        return;
      }
    }
  }
  const suggestedMessage = draftReplyInfo && draftSuggestedPostInfo ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, draftReplyInfo.replyToMsgId) : undefined;
  let suggestedMedia;
  if (draftSuggestedPostInfo && suggestedMessage?.content) {
    suggestedMedia = suggestedMessage.content;
  }
  const params = {
    ...payload,
    chat,
    replyInfo,
    suggestedPostInfo: draftSuggestedPostInfo,
    suggestedMedia,
    noWebPage: (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectNoWebPage)(global, chatId, threadId),
    sendAs: (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectSendAs)(global, chatId),
    lastMessageId,
    messagePriceInStars,
    isStoryReply,
    isPending: messagePriceInStars ? true : undefined,
    ...(suggestedMessage && {
      isInvertedMedia: suggestedMessage?.isInvertedMedia
    })
  };
  if (!isStoryReply) {
    actions.clearWebPagePreview({
      tabId
    });
  }
  const isSingle = (!payload.attachments || payload.attachments.length <= 1) && !isForwarding;
  const isGrouped = !isSingle && payload.shouldGroupMessages;
  const localMessages = [];
  if (isSingle) {
    const {
      attachments,
      ...restParams
    } = params;
    const sendParams = {
      ...restParams,
      attachment: attachments ? attachments[0] : undefined,
      wasDrafted: Boolean(draft)
    };
    await sendMessageOrReduceLocal(global, sendParams, localMessages);
  } else if (isGrouped) {
    const {
      text,
      entities,
      attachments,
      ...commonParams
    } = params;
    const byType = splitAttachmentsByType(attachments);
    let hasSentCaption = false;
    for (let groupIndex = 0; groupIndex < byType.length; groupIndex++) {
      const group = byType[groupIndex];
      const groupedAttachments = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.split)(group, _config__WEBPACK_IMPORTED_MODULE_2__.MAX_MEDIA_FILES_FOR_ALBUM);
      for (let i = 0; i < groupedAttachments.length; i++) {
        const groupedId = `${Date.now()}${groupIndex}${i}`;
        const isFirst = i === 0 && groupIndex === 0;
        const isLast = i === groupedAttachments.length - 1 && groupIndex === byType.length - 1;
        if (group[0].quick && !group[0].shouldSendAsFile) {
          const [firstAttachment, ...restAttachments] = groupedAttachments[i];
          let sendParams = {
            ...commonParams,
            text: isFirst && !hasSentCaption ? text : undefined,
            entities: isFirst && !hasSentCaption ? entities : undefined,
            attachment: firstAttachment,
            groupedId: restAttachments.length > 0 ? groupedId : undefined,
            wasDrafted: Boolean(draft)
          };
          await sendMessageOrReduceLocal(global, sendParams, localMessages);
          hasSentCaption = true;
          for (const attachment of restAttachments) {
            sendParams = {
              ...commonParams,
              attachment,
              groupedId
            };
            await sendMessageOrReduceLocal(global, sendParams, localMessages);
          }
        } else {
          const firstAttachments = groupedAttachments[i].slice(0, -1);
          const lastAttachment = groupedAttachments[i][groupedAttachments[i].length - 1];
          for (const attachment of firstAttachments) {
            const sendParams = {
              ...commonParams,
              attachment,
              groupedId
            };
            await sendMessageOrReduceLocal(global, sendParams, localMessages);
          }
          const sendParams = {
            ...commonParams,
            text: isLast && !hasSentCaption ? text : undefined,
            entities: isLast && !hasSentCaption ? entities : undefined,
            attachment: lastAttachment,
            groupedId: firstAttachments.length > 0 ? groupedId : undefined,
            wasDrafted: Boolean(draft)
          };
          await sendMessageOrReduceLocal(global, sendParams, localMessages);
          hasSentCaption = true;
        }
      }
    }
  } else {
    const {
      text,
      entities,
      attachments,
      replyInfo: replyToForFirstMessage,
      ...commonParams
    } = params;
    if (text) {
      const sendParams = {
        ...commonParams,
        text,
        entities,
        replyInfo: replyToForFirstMessage,
        wasDrafted: Boolean(draft)
      };
      await sendMessageOrReduceLocal(global, sendParams, localMessages);
    }
    if (attachments) {
      for (const attachment of attachments) {
        const sendParams = {
          ...commonParams,
          attachment
        };
        await sendMessageOrReduceLocal(global, sendParams, localMessages);
      }
    }
  }
  if (isForwarding) {
    const localForwards = await executeForwardMessages(global, params, tabId);
    if (localForwards) {
      localMessages.push(...localForwards);
    }
  }
  if (localMessages?.length) sendMessagesWithNotification(global, localMessages);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('sendMessageWithReplyInfo', async (global, actions, payload) => {
  const {
    messageList,
    replyInfo,
    text
  } = payload;
  const {
    chatId,
    threadId
  } = messageList || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectThreadInfo)(global, chatId, threadId);
  const lastMessageId = threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatLastMessageId)(global, chatId) : threadInfo?.lastMessageId;
  const params = {
    messageList,
    text,
    isSilent: false,
    shouldUpdateStickerSetOrder: true,
    isForwarding: false,
    chat,
    replyInfo: {
      ...replyInfo,
      quoteOffset: -1
    },
    lastMessageId,
    isStoryReply: false,
    wasDrafted: true
  };
  await sendMessageOrReduceLocal(global, params, []);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('sendInviteMessages', async (global, actions, payload) => {
  const {
    chatId,
    userIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatFullInfo)(global, chatId);
  if (!chatFullInfo?.inviteLink) {
    return undefined;
  }
  const userFullNames = [];
  await Promise.all(userIds.map(userId => {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, userId);
    if (!chat) {
      return undefined;
    }
    const userFullName = (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.getUserFullName)((0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUser)(global, userId));
    if (userFullName) {
      userFullNames.push(userFullName);
    }
    return sendMessage(global, {
      chat,
      text: chatFullInfo.inviteLink
    });
  }));
  return actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('Conversation.ShareLinkTooltip.Chat.One', userFullNames.join(', ')),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('editMessage', (global, actions, payload) => {
  const {
    messageList,
    text,
    entities,
    attachments,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  if (!messageList) {
    return;
  }
  let currentMessageKey;
  const progressCallback = attachments ? (progress, messageKey) => {
    if (!uploadProgressCallbacks.has(messageKey)) {
      currentMessageKey = messageKey;
      uploadProgressCallbacks.set(messageKey, progressCallback);
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateUploadByMessageKey)(global, messageKey, progress);
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  } : undefined;
  const {
    chatId,
    threadId,
    type: messageListType
  } = messageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectEditingMessage)(global, chatId, threadId, messageListType);
  if (!chat || !message) {
    return;
  }
  actions.setEditingId({
    messageId: undefined,
    tabId
  });
  (async () => {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('editMessage', {
      chat,
      message,
      attachment: attachments ? attachments[0] : undefined,
      text,
      entities,
      noWebPage: (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectNoWebPage)(global, chatId, threadId)
    }, progressCallback);
    if (progressCallback && currentMessageKey) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateUploadByMessageKey)(global, currentMessageKey, undefined);
      (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
      uploadProgressCallbacks.delete(currentMessageKey);
    }
  })();
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('editTodo', (global, actions, payload) => {
  const {
    chatId,
    todo,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('editTodo', {
    chat,
    message,
    todo
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('cancelUploadMedia', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
  if (!message) return;
  const progressCallback = message && uploadProgressCallbacks.get((0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_9__.getMessageKey)(message));
  if (progressCallback) {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.cancelApiProgress)(progressCallback);
  }
  if ((0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isMessageLocal)(message)) {
    actions.apiUpdate({
      '@type': 'deleteMessages',
      ids: [messageId],
      chatId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('saveDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    text
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!text || !chat) {
    return;
  }
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, chatId, threadId);
  if (chat.isMonoforum && !currentDraft?.replyInfo && !currentDraft?.suggestedPostInfo) {
    return; // Monoforum doesn't support drafts outside threads
  }
  const newDraft = {
    text,
    replyInfo: currentDraft?.replyInfo,
    effectId: currentDraft?.effectId,
    suggestedPostInfo: currentDraft?.suggestedPostInfo
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('saveReplyDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    draft,
    isLocalOnly
  } = payload;
  saveDraft({
    global,
    chatId,
    threadId,
    draft,
    isLocalOnly
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('clearDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    isLocalOnly,
    shouldKeepReply,
    shouldKeepSuggestedPost
  } = payload;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, chatId, threadId);
  if (!currentDraft) {
    return;
  }
  const currentReplyInfo = currentDraft.replyInfo;
  const newDraft = shouldKeepReply && currentReplyInfo || shouldKeepSuggestedPost && currentDraft.suggestedPostInfo ? {
    replyInfo: shouldKeepReply ? currentReplyInfo : undefined,
    suggestedPostInfo: shouldKeepSuggestedPost ? currentDraft.suggestedPostInfo : undefined
  } : undefined;
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('updateDraftReplyInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)(),
    ...update
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, chatId, threadId);
  const updatedReplyInfo = {
    type: 'message',
    ...currentDraft?.replyInfo,
    ...update
  };
  if (!updatedReplyInfo.replyToMsgId) return;
  const newDraft = {
    ...currentDraft,
    replyInfo: updatedReplyInfo,
    suggestedPostInfo: undefined
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('resetDraftReplyInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, chatId, threadId);
  if (chat?.isMonoforum && !currentDraft?.replyInfo && !currentDraft?.suggestedPostInfo) {
    return; // Monoforum doesn't support drafts outside threads
  }
  const newDraft = !currentDraft?.text ? undefined : {
    ...currentDraft,
    replyInfo: undefined
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: Boolean(newDraft)
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('updateDraftSuggestedPostInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)(),
    ...update
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, chatId, threadId);
  const updatedSuggestedPostInfo = {
    ...currentDraft?.suggestedPostInfo,
    ...update
  };
  const newDraft = {
    ...currentDraft,
    suggestedPostInfo: updatedSuggestedPostInfo
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('resetDraftSuggestedPostInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  saveDraft({
    global,
    chatId,
    threadId,
    draft: undefined,
    isLocalOnly: false
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('initDraftFromSuggestedMessage', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
  if (!message) {
    return;
  }
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    threadId
  } = currentMessageList;
  actions.clearDraft({
    chatId,
    threadId,
    isLocalOnly: true
  });
  actions.updateDraftReplyInfo({
    replyToMsgId: messageId,
    monoforumPeerId: (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectSavedDialogIdFromMessage)(global, message),
    tabId
  });
  if (message.suggestedPostInfo) {
    const {
      scheduleDate,
      ...messageSuggestedPost
    } = message.suggestedPostInfo;
    const now = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_15__.getServerTime)();
    const futureMin = global.appConfig?.starsSuggestedPostFutureMin || _config__WEBPACK_IMPORTED_MODULE_2__.STARS_SUGGESTED_POST_FUTURE_MIN;
    const validScheduleDate = scheduleDate && scheduleDate > now + futureMin ? scheduleDate : undefined;
    actions.updateDraftSuggestedPostInfo({
      ...messageSuggestedPost,
      scheduleDate: validScheduleDate,
      tabId
    });
  }
  actions.saveDraft({
    chatId,
    threadId,
    text: message.content.text
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('saveEffectInDraft', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    effectId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, chatId, threadId);
  if (chat?.isMonoforum && !currentDraft?.replyInfo && !currentDraft?.suggestedPostInfo) {
    return; // Monoforum doesn't support drafts outside threads
  }
  const newDraft = {
    ...currentDraft,
    effectId
  };
  saveDraft({
    global,
    chatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('updateInsertingPeerIdMention', (global, actions, payload) => {
  const {
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    insertingPeerIdMention: peerId
  }, tabId);
});
async function saveDraft({
  global,
  chatId,
  threadId,
  draft,
  isLocalOnly,
  noLocalTimeUpdate
}) {
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUser)(global, chatId);
  if (!chat || user && (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isDeletedUser)(user)) return;
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectMessageReplyInfo)(global, chatId, threadId, draft?.replyInfo);
  const newDraft = draft ? {
    ...draft,
    replyInfo,
    date: Math.floor(Date.now() / 1000),
    isLocal: true
  } : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.replaceThreadParam)(global, chatId, threadId, 'draft', newDraft);
  if (!noLocalTimeUpdate) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chatId, {
      draftDate: newDraft?.date
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  if (isLocalOnly) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('saveDraft', {
    chat,
    draft: newDraft
  });
  if (result && newDraft) {
    newDraft.isLocal = false;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.replaceThreadParam)(global, chatId, threadId, 'draft', newDraft);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chatId, {
    draftDate: newDraft?.date
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('toggleMessageWebPage', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    noWebPage
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.replaceThreadParam)(global, chatId, threadId, 'noWebPage', noWebPage);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('pinMessage', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    isUnpin,
    isOneSide,
    isSilent
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('pinMessage', {
    chat,
    messageId,
    isUnpin,
    isOneSide,
    isSilent
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('unpinAllMessages', async (global, actions, payload) => {
  const {
    chatId,
    threadId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('unpinAllMessages', {
    chat,
    threadId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  const pinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectPinnedIds)(global, chatId, threadId);
  pinnedIds?.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, id, {
      isPinned: false
    });
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.replaceThreadParam)(global, chat.id, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'pinnedIds', []);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('deleteMessages', (global, actions, payload) => {
  const {
    messageIds,
    shouldDeleteForAll,
    messageList: payloadMessageList,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  const messageList = payloadMessageList || currentMessageList;
  if (!messageList) {
    return;
  }
  const {
    chatId,
    threadId
  } = messageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const messageIdsToDelete = messageIds.filter(id => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, id);
    return message && !(0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isMessageLocal)(message);
  });

  // Only local messages
  if (!messageIdsToDelete.length && messageIds.length) {
    (0,_apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_24__.deleteMessages)(global, (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isChatChannel)(chat) || (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isChatSuperGroup)(chat) ? chatId : undefined, messageIds, actions);
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('deleteMessages', {
    chat,
    messageIds: messageIdsToDelete,
    shouldDeleteForAll
  });
  const editingId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectEditingId)(global, chatId, threadId);
  if (editingId && messageIds.includes(editingId)) {
    actions.setEditingId({
      messageId: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('resetLocalPaidMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const notifications = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).notifications;
  if (!notifications || !notifications.length) return global;
  notifications.forEach(notification => {
    if (notification.type === 'paidMessage') {
      const action = notification.dismissAction;
      if (action && !Array.isArray(action)) {
        // @ts-ignore
        actions[action.action](action.payload);
      }
      actions.dismissNotification({
        localId: notification.localId,
        tabId
      });
    }
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('deleteParticipantHistory', (global, actions, payload) => {
  const {
    chatId,
    peerId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectPeer)(global, peerId);
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('deleteParticipantHistory', {
    chat,
    peer
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('deleteScheduledMessages', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('deleteScheduledMessages', {
    chat,
    messageIds
  });
  const editingId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectEditingScheduledId)(global, chatId);
  if (editingId && messageIds.includes(editingId)) {
    actions.setEditingId({
      messageId: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('deleteHistory', async (global, actions, payload) => {
  const {
    chatId,
    shouldDeleteForAll,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('deleteHistory', {
    chat,
    shouldDeleteForAll
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  const activeChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (activeChat && activeChat.chatId === chatId) {
    actions.openChat({
      id: undefined,
      tabId
    });
  }

  // Delete chat from folders
  const folders = global.chatFolders.byId;
  Object.values(folders).forEach(folder => {
    if (folder.includedChatIds.includes(chatId) || folder.pinnedChatIds?.includes(chatId)) {
      const newIncludedChatIds = folder.includedChatIds.filter(id => id !== chatId);
      const newPinnedChatIds = folder.pinnedChatIds?.filter(id => id !== chatId);
      const updatedFolder = {
        ...folder,
        includedChatIds: newIncludedChatIds,
        pinnedChatIds: newPinnedChatIds
      };
      (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('editChatFolder', {
        id: folder.id,
        folderUpdate: updatedFolder
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('deleteSavedHistory', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('deleteSavedHistory', {
    chat
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  const activeChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (activeChat && activeChat.threadId === chatId) {
    actions.openChat({
      id: undefined,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('reportMessages', async (global, actions, payload) => {
  const {
    messageIds,
    description = '',
    option = '',
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const response = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('reportMessages', {
    peer: chat,
    messageIds,
    description,
    option
  });
  if (!response) return;
  const {
    result,
    error
  } = response;
  if (error === _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_ID_REQUIRED_ERROR) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('lng_report_please_select_messages'),
      tabId
    });
    actions.closeReportModal({
      tabId
    });
    return;
  }
  if (!result) return;
  if (result.type === 'reported') {
    actions.showNotification({
      message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
      tabId
    });
    actions.closeReportModal({
      tabId
    });
    return;
  }
  if (result.type === 'selectOption') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).reportModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options?.find(o => o.option === option);
    const newSection = {
      title: result.title,
      options: result.options,
      subtitle: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
      reportModal: {
        chatId,
        messageIds,
        description,
        subject: 'message',
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  }
  if (result.type === 'comment') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).reportModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options?.find(o => o.option === option);
    const newSection = {
      isOptional: result.isOptional,
      option: result.option,
      title: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
      reportModal: {
        chatId,
        messageIds,
        description,
        subject: 'message',
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('sendMessageAction', async (global, actions, payload) => {
  const {
    action,
    chatId,
    threadId
  } = payload;
  if (global.connectionState !== 'connectionStateReady') return;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsChatWithSelf)(global, chatId)) return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat || chat.isMonoforum) return;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUser)(global, chatId);
  if (user && ((0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isUserBot)(user) || (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isDeletedUser)(user))) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('sendMessageAction', {
    peer: chat,
    threadId,
    action
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('reportChannelSpam', (global, actions, payload) => {
  const {
    participantId,
    chatId,
    messageIds
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectPeer)(global, participantId);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!peer || !chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('reportChannelSpam', {
    peer,
    chat,
    messageIds
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('markMessageListRead', (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsCurrentUserFrozen)(global)) return undefined;
  const {
    maxId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat || (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    return undefined;
  }
  runDebouncedForMarkRead(() => {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('markMessageListRead', {
      chat,
      threadId,
      maxId
    });
  });
  if (chatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID) {
    global = {
      ...global,
      serviceNotifications: global.serviceNotifications.map(notification => {
        return notification.isUnread && notification.id <= maxId ? {
          ...notification,
          isUnread: false
        } : notification;
      })
    };
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectViewportIds)(global, chatId, threadId, tabId);
  const minId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectFirstUnreadId)(global, chatId, threadId);
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && !chat.isForum) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateThreadInfo)(global, chatId, threadId, {
      lastReadInboxMessageId: maxId
    });
    return global;
  }
  if (!viewportIds || !minId || !chat.unreadCount) {
    return global;
  }
  const readCount = countSortedIds(viewportIds, minId, maxId);
  if (!readCount) {
    return global;
  }
  const topic = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTopic)(global, chatId, threadId);
  if (chat.isForum && topic) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateThreadInfo)(global, chatId, threadId, {
      lastReadInboxMessageId: maxId
    });
    const newTopicUnreadCount = Math.max(0, topic.unreadCount - readCount);
    if (newTopicUnreadCount === 0) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chatId, {
        unreadCount: Math.max(0, chat.unreadCount - 1)
      });
    }
    return (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateTopic)(global, chatId, Number(threadId), {
      unreadCount: newTopicUnreadCount
    });
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chatId, {
    lastReadInboxMessageId: maxId,
    unreadCount: Math.max(0, chat.unreadCount - readCount)
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('markMessagesRead', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)(),
    shouldFetchUnreadReactions
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentChat)(global, tabId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('markMessagesRead', {
    chat,
    messageIds
  }).then(() => {
    if (shouldFetchUnreadReactions) {
      actions.fetchUnreadReactions({
        chatId: chat.id
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadWebPagePreview', async (global, actions, payload) => {
  const {
    text,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const webPagePreview = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchWebPagePreview', {
    text
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    webPagePreviewId: webPagePreview?.id
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  if (!webPagePreview) return;
  actions.apiUpdate({
    '@type': 'updateWebPage',
    webPage: webPagePreview
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('clearWebPagePreview', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    webPagePreviewId: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('sendPollVote', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    options
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('sendPollVote', {
      chat,
      messageId,
      options
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('toggleTodoCompleted', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    completedIds,
    incompletedIds
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
  const currentUserId = global.currentUserId;
  const currentTodo = message?.content.todo;
  if (!currentTodo || !currentUserId || !chat) {
    return;
  }
  const currentCompletions = currentTodo.completions || [];
  const currentCompletionIds = currentCompletions.map(c => c.itemId);
  const newCompletions = [...currentCompletions];
  const now = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_15__.getServerTime)();
  completedIds.forEach(itemId => {
    if (!currentCompletionIds.includes(itemId)) {
      newCompletions.push({
        itemId,
        completedBy: currentUserId,
        completedAt: now
      });
    }
  });
  const finalCompletions = newCompletions.filter(c => !incompletedIds.includes(c.itemId));
  const newContent = {
    ...message.content,
    todo: {
      ...currentTodo,
      completions: finalCompletions
    }
  };
  const messageUpdate = {
    ...message,
    content: newContent
  };
  global = (0,_apiUpdaters_messages__WEBPACK_IMPORTED_MODULE_24__.updateWithLocalMedia)(global, chatId, message.id, messageUpdate);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('toggleTodoCompleted', {
    chat,
    messageId: message.id,
    completedIds,
    incompletedIds
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('appendTodoList', (global, actions, payload) => {
  const {
    chatId,
    items,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('appendTodoList', {
    chat,
    message,
    items
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('cancelPollVote', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('sendPollVote', {
      chat,
      messageId,
      options: []
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('closePoll', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
  const poll = message && (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectPollFromMessage)(global, message);
  if (chat && poll) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('closePoll', {
      chat,
      messageId,
      poll
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadPollOptionResults', async (global, actions, payload) => {
  const {
    chat,
    messageId,
    option,
    offset,
    limit,
    shouldResetVoters,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('loadPollOptionResults', {
    chat,
    messageId,
    option,
    offset,
    limit
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId);
  const {
    pollResults
  } = tabState;
  const {
    voters
  } = tabState.pollResults;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    pollResults: {
      ...pollResults,
      voters: {
        ...voters,
        [option]: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.unique)([...(!shouldResetVoters && voters?.[option] ? voters[option] : []), ...result.votes.map(vote => vote.peerId)])
      },
      offsets: {
        ...(pollResults.offsets ? pollResults.offsets : {}),
        [option]: result.nextOffset || ''
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadExtendedMedia', (global, actions, payload) => {
  const {
    chatId,
    ids
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (chat) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchExtendedMedia', {
      chat,
      ids
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadScheduledHistory', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsCurrentUserFrozen)(global)) return;
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchScheduledHistory', {
    chat
  });
  if (!result) {
    return;
  }
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number).sort((a, b) => b - a);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateScheduledMessages)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.replaceThreadParam)(global, chat.id, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', ids);
  if (!ids.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updatePeerFullInfo)(global, chat.id, {
      hasScheduledMessages: false
    });
  }
  if (chat?.isForum) {
    const scheduledPerThread = {};
    messages.forEach(message => {
      const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectThreadIdFromMessage)(global, message);
      const scheduledInThread = scheduledPerThread[threadId] || [];
      scheduledInThread.push(message.id);
      scheduledPerThread[threadId] = scheduledInThread;
    });
    Object.entries(scheduledPerThread).forEach(([threadId, scheduledIds]) => {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.replaceThreadParam)(global, chat.id, Number(threadId), 'scheduledIds', scheduledIds);
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('sendScheduledMessages', (global, actions, payload) => {
  const {
    chatId,
    id
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('sendScheduledMessages', {
    chat,
    ids: [id]
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('rescheduleMessage', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    scheduledAt
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const message = chat && (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectScheduledMessage)(global, chat.id, messageId);
  if (!chat || !message) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('rescheduleMessage', {
    chat,
    message,
    scheduledAt
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('transcribeAudio', async (global, actions, payload) => {
  const {
    messageId,
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, messageId, {
    transcriptionId: ''
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('transcribeAudio', {
    chat,
    messageId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, messageId, {
    transcriptionId: result,
    isTranscriptionError: !result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('transcribeAudioByOpenai', async (global, actions, payload) => {
  const {
    messageId,
    chatId
  } = payload;
  const {
    telyAiLanguage = 'en'
  } = global.settings.byKey;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, messageId, {
    transcriptionId: ''
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  const voice = message?.content?.voice;
  if (!voice) return;
  const mediaHash = (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.getMediaHash)(voice, 'download');
  if (!mediaHash) return;
  await _util_mediaLoader__WEBPACK_IMPORTED_MODULE_12__.fetch(mediaHash, 0);
  const blobUrl = _util_mediaLoader__WEBPACK_IMPORTED_MODULE_12__.getFromMemory(mediaHash);
  if (!blobUrl) return;
  const response = await fetch(blobUrl);
  const blob = await response.blob();
  const formData = new FormData();
  formData.append('file', blob, 'audio.ogg');
  formData.append('language', telyAiLanguage);
  const result = await (0,_components_chatAssistant_utils_chat_api__WEBPACK_IMPORTED_MODULE_17__.audioToText)(formData);
  const transcriptionId = `${chat?.id}-${messageId}`;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('transcribeAudioByOpenai', {
    transcriptionId,
    transcriptionText: result.text
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, messageId, {
    transcriptionId,
    isTranscriptionError: !result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadCustomEmojis', async (global, actions, payload) => {
  const {
    ids,
    ignoreCache
  } = payload;
  const newCustomEmojiIds = ignoreCache ? ids : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.unique)(ids.filter(documentId => !global.customEmojis.byId[documentId]));
  const customEmoji = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchCustomEmoji', {
    documentId: newCustomEmojiIds
  });
  if (!customEmoji) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      byId: {
        ...global.customEmojis.byId,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(customEmoji, 'id')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('forwardMessages', (global, actions, payload) => {
  const {
    isSilent,
    scheduledAt,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const {
    toChatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).forwardMessages;
  const toChat = toChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, toChatId) : undefined;
  if (!toChat) return;
  executeForwardMessages(global, {
    chat: toChat,
    isSilent,
    scheduledAt
  }, tabId);
});
async function executeForwardMessages(global, sendParams, tabId) {
  const {
    fromChatId,
    messageIds,
    toChatId,
    withMyScore,
    noAuthors,
    noCaptions,
    toThreadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).forwardMessages;
  const {
    messagePriceInStars,
    isSilent,
    scheduledAt
  } = sendParams;
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsCurrentUserPremium)(global);
  const isToMainThread = toThreadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  const fromChat = fromChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, fromChatId) : undefined;
  const toChat = toChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, toChatId) : undefined;
  const messages = fromChatId && messageIds ? messageIds.sort((a, b) => a - b).map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, fromChatId, id)).filter(Boolean) : undefined;
  if (!fromChat || !toChat || !messages || toThreadId && !isToMainThread && !toChat.isForum) {
    return undefined;
  }
  const sendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectSendAs)(global, toChatId);
  const draft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, toChatId, toThreadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatLastMessageId)(global, toChat.id);
  const localMessages = [];
  const [realMessages, serviceMessages] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.partition)(messages, m => !(0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isServiceNotificationMessage)(m));
  const forwardableRealMessages = realMessages.filter(message => (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCanForwardMessage)(global, message));
  if (forwardableRealMessages.length) {
    const messageSlices = global.config?.maxForwardedCount ? (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.splitMessagesForForwarding)(forwardableRealMessages, global.config.maxForwardedCount) : [forwardableRealMessages];
    for (const slice of messageSlices) {
      const forwardParams = {
        fromChat,
        toChat,
        toThreadId,
        messages: slice,
        isSilent,
        scheduledAt,
        sendAs,
        withMyScore,
        noAuthors,
        noCaptions,
        isCurrentUserPremium,
        wasDrafted: Boolean(draft),
        lastMessageId,
        messagePriceInStars
      };
      if (!messagePriceInStars) {
        (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('forwardMessages', forwardParams);
      } else {
        const forwardedLocalMessagesSlice = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('forwardMessagesLocal', forwardParams);
        localMessages.push({
          ...sendParams,
          forwardParams: {
            ...forwardParams,
            forwardedLocalMessagesSlice
          },
          forwardedLocalMessagesSlice
        });
      }
    }
  }
  for (const message of serviceMessages) {
    const {
      text,
      entities
    } = message.content.text || {};
    const {
      sticker
    } = message.content;
    const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectMessageReplyInfo)(global, toChat.id, toThreadId);
    const params = {
      chat: toChat,
      replyInfo,
      text,
      entities,
      sticker,
      isSilent,
      scheduledAt,
      sendAs,
      lastMessageId
    };
    await sendMessageOrReduceLocal(global, params, localMessages);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    forwardMessages: {},
    isShareMessageModalShown: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  return localMessages;
}
async function loadViewportMessages(global, chat, threadId, offsetId, direction, isOutlying = false, isBudgetPreload = false, onLoaded, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()]) {
  const chatId = chat.id;
  let addOffset;
  let sliceSize = _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
  switch (direction) {
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards:
      if (offsetId) {
        addOffset = -1;
        sliceSize += 1;
      } else {
        addOffset = undefined;
      }
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around:
      addOffset = -(Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) + 1);
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards:
      addOffset = -(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE + 1);
      if (offsetId) {
        sliceSize += 1;
      }
      break;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchMessages', {
    chat: (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, realChatId),
    offsetId,
    addOffset,
    limit: sliceSize,
    threadId,
    isSavedDialog
  });
  if (!result) {
    return;
  }
  const {
    messages,
    count
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  const localMessages = chatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID ? global.serviceNotifications.filter(({
    isDeleted
  }) => !isDeleted).map(({
    message
  }) => message) : [];
  const allMessages = [].concat(messages, localMessages);
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(allMessages, 'id');
  const ids = Object.keys(byId).map(Number);
  if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID && !(0,_helpers__WEBPACK_IMPORTED_MODULE_18__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    const threadFirstMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectFirstMessageId)(global, chatId, threadId);
    if ((!ids[0] || threadFirstMessageId === ids[0]) && threadFirstMessageId !== threadId) {
      ids.unshift(Number(threadId));
    }
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.addChatMessagesById)(global, chatId, byId);
  global = isOutlying ? (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateOutlyingLists)(global, chatId, threadId, ids) : (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateListedIds)(global, chatId, threadId, ids);
  let listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectListedIds)(global, chatId, threadId);
  const outlyingList = offsetId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectOutlyingListByMessageId)(global, chatId, threadId, offsetId) : undefined;
  if (isOutlying && listedIds && outlyingList) {
    if (!outlyingList.length || (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.areSortedArraysIntersecting)(listedIds, outlyingList)) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateListedIds)(global, chatId, threadId, outlyingList);
      listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectListedIds)(global, chatId, threadId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.removeOutlyingList)(global, chatId, threadId, outlyingList);
      isOutlying = false;
    }
  }
  if (!isBudgetPreload) {
    const historyIds = isOutlying && outlyingList ? outlyingList : listedIds;
    if (historyIds) {
      const {
        newViewportIds
      } = getViewportSlice(historyIds, offsetId, direction);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.safeReplaceViewportIds)(global, chatId, threadId, newViewportIds, tabId);
    }
  }
  if (count) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateThreadInfo)(global, chat.id, threadId, {
      messagesCount: count
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  onLoaded?.();
}
async function loadMessage(global, chat, messageId, replyOriginForId) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchMessage', {
    chat,
    messageId
  });
  if (!result) {
    return undefined;
  }
  if (result === _api_types__WEBPACK_IMPORTED_MODULE_0__.MESSAGE_DELETED) {
    if (replyOriginForId) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
      const replyMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chat.id, replyOriginForId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chat.id, replyOriginForId, {
        ...replyMessage,
        replyInfo: undefined
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
    }
    return undefined;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chat.id, messageId, result.message);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  return result.message;
}
function findClosestIndex(sourceIds, offsetId) {
  if (offsetId < sourceIds[0]) {
    return 0;
  }
  if (offsetId > sourceIds[sourceIds.length - 1]) {
    return sourceIds.length - 1;
  }
  return sourceIds.findIndex((id, i) => id === offsetId || id < offsetId && sourceIds[i + 1] > offsetId);
}
function getViewportSlice(sourceIds, offsetId, direction) {
  const {
    length
  } = sourceIds;
  const index = offsetId ? findClosestIndex(sourceIds, offsetId) : -1;
  const isBackwards = direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards;
  const isAround = direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around;
  const indexForDirection = isBackwards ? index : index + 1 || length;
  const sliceSize = isAround ? Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) : _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
  const from = indexForDirection - sliceSize;
  const to = indexForDirection + sliceSize - 1;
  const newViewportIds = sourceIds.slice(Math.max(0, from), to + 1);
  let areSomeLocal;
  let areAllLocal;
  switch (direction) {
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards:
      areSomeLocal = indexForDirection >= 0;
      areAllLocal = from >= 0;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards:
      areSomeLocal = indexForDirection < length;
      areAllLocal = to <= length - 1;
      break;
    case _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around:
    default:
      areSomeLocal = newViewportIds.length > 0;
      areAllLocal = newViewportIds.length === _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE;
      break;
  }
  return {
    newViewportIds,
    areSomeLocal,
    areAllLocal
  };
}
async function getPeerStarsForMessage(global, peerId) {
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectPeer)(global, peerId);
  if (!peer) return undefined;
  if ((0,_helpers_peers__WEBPACK_IMPORTED_MODULE_19__.isApiPeerChat)(peer)) {
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsMonoforumAdmin)(global, peerId)) {
      return undefined;
    }
    return peer.paidMessagesStars;
  }
  if (!peer?.paidMessagesStars) return undefined;
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUserFullInfo)(global, peer.id);
  if (fullInfo) {
    return fullInfo.paidMessagesStars;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchPaidMessagesStarsAmount', peer);
  return result;
}
async function sendMessageOrReduceLocal(global, sendParams, localMessages) {
  if (!sendParams.messagePriceInStars) {
    sendMessage(global, sendParams);
  } else {
    const message = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('sendMessageLocal', sendParams);
    if (message) {
      localMessages.push({
        ...sendParams,
        localMessage: message
      });
    }
  }
}
async function sendMessage(global, params) {
  // @optimization
  if (params.replyInfo || _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_IOS) {
    await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_14__.rafPromise)();
  }
  let currentMessageKey;
  const progressCallback = params.attachment ? (progress, messageKey) => {
    if (!uploadProgressCallbacks.has(messageKey)) {
      currentMessageKey = messageKey;
      uploadProgressCallbacks.set(messageKey, progressCallback);
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateUploadByMessageKey)(global, messageKey, progress);
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  } : undefined;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('sendMessage', params, progressCallback);
  if (progressCallback && currentMessageKey) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateUploadByMessageKey)(global, currentMessageKey, undefined);
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
    uploadProgressCallbacks.delete(currentMessageKey);
  }
}
async function sendMessagesWithNotification(global, sendParams) {
  const chat = sendParams[0]?.chat;
  if (!chat || !sendParams.length) return;
  const starsForOneMessage = await getPeerStarsForMessage(global, chat.id);
  if (!starsForOneMessage) {
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.getActions)().sendMessages({
      sendParams
    });
    return;
  }
  const messageIdsForUndo = sendParams.reduce((ids, params) => {
    if (params.localMessage?.id) {
      ids.push(params.localMessage.id);
    } else if (params.forwardedLocalMessagesSlice?.localMessages) {
      const forwardedIds = Object.values(params.forwardedLocalMessagesSlice.localMessages).map(forwardedMessage => forwardedMessage.id).filter(Boolean);
      ids.push(...forwardedIds);
    }
    return ids;
  }, []);
  const localForwards = sendParams[0]?.forwardedLocalMessagesSlice?.localMessages;
  const firstMessage = sendParams[0]?.localMessage || localForwards && Object.values(localForwards)[0];
  if (!firstMessage) return;
  const messagesCount = messageIdsForUndo.length;
  const firstSendParam = sendParams[0];
  let storySendMessage;
  if (sendParams.length === 1 && firstSendParam.isStoryReply) {
    const {
      gif,
      sticker,
      isReaction
    } = firstSendParam;
    if (gif) {
      storySendMessage = {
        key: 'MessageSentPaidToastTitle',
        variables: {
          count: 1
        },
        options: {
          pluralValue: 1
        }
      };
    } else if (sticker) {
      storySendMessage = {
        key: 'StoryTooltipStickerSent'
      };
    } else if (isReaction) {
      storySendMessage = {
        key: 'StoryTooltipReactionSent'
      };
    }
  }
  const titleKey = storySendMessage || {
    key: 'MessageSentPaidToastTitle',
    variables: {
      count: messagesCount
    },
    options: {
      pluralValue: messagesCount
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.getActions)().sendMessages({
    sendParams
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.getActions)().showNotification({
    localId: (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_9__.getMessageKey)(firstMessage),
    title: titleKey,
    message: {
      key: 'MessageSentPaidToastText',
      variables: {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_11__.formatStarsAsText)((0,_util_localization__WEBPACK_IMPORTED_MODULE_10__.getTranslationFn)(), starsForOneMessage * messagesCount)
      }
    },
    icon: 'star',
    shouldUseCustomIcon: true,
    type: 'paidMessage'
  });
}
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('sendMessages', async (global, actions, payload) => {
  const {
    sendParams
  } = payload;
  await Promise.all(sendParams.map(async params => {
    if (params.forwardedLocalMessagesSlice && params.forwardParams) {
      await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_14__.rafPromise)();
      await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('forwardApiMessages', params.forwardParams);
    } else {
      await sendMessage(global, params);
    }
  }));
  if (sendParams.length > 0 && sendParams[0].messagePriceInStars) actions.loadStarStatus();
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadPinnedMessages', async (global, actions, payload) => {
  const {
    chatId,
    threadId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat || (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.getIsSavedDialog)(chatId, threadId, global.currentUserId)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchPinnedMessages', {
    chat,
    threadId
  });
  if (!result) {
    return;
  }
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number).sort((a, b) => b - a);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.safeReplacePinnedIds)(global, chat.id, threadId, ids);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadSeenBy', async (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchSeenBy', {
    chat,
    messageId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, messageId, {
    seenByDates: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('saveDefaultSendAs', (global, actions, payload) => {
  const {
    chatId,
    sendAsId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  const sendAsChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, sendAsId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUser)(global, sendAsId);
  if (!chat || !sendAsChat) {
    return undefined;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('saveDefaultSendAs', {
    sendAs: sendAsChat,
    chat
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatFullInfo)(global, chatId, {
    sendAsId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadSendAs', async (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchSendAs', {
    chat
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chatId, {
      sendAsPeerIds: []
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chatId, {
    sendAsPeerIds: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadSendPaidReactionsAs', async (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchSendAs', {
    chat,
    isForPaidReactions: true
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chatId, {
      sendPaidReactionsAsPeerIds: []
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chatId, {
    sendPaidReactionsAsPeerIds: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadSponsoredMessages', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  if ((0,_helpers_peers__WEBPACK_IMPORTED_MODULE_19__.isApiPeerUser)(peer) && (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsChatBotNotStarted)(global, peer.id)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchSponsoredMessages', {
    peer
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateSponsoredMessage)(global, peerId, result.messages[0]);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('viewSponsored', (global, actions, payload) => {
  const {
    randomId
  } = payload;
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('viewSponsoredMessage', {
    random: randomId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('clickSponsored', (global, actions, payload) => {
  const {
    randomId,
    isMedia,
    isFullscreen
  } = payload;
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('clickSponsoredMessage', {
    random: randomId,
    isMedia,
    isFullscreen
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('reportSponsored', async (global, actions, payload) => {
  const {
    peerId,
    randomId,
    option = '',
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('reportSponsoredMessage', {
    randomId,
    option
  });
  if (!result) return;
  if (result.type === 'premiumRequired') {
    actions.openPremiumModal({
      initialSection: 'no_ads',
      tabId
    });
    actions.closeReportAdModal({
      tabId
    });
    return;
  }
  if (result.type === 'reported' || result.type === 'hidden') {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)(result.type === 'reported' ? 'AdReported' : 'AdHidden'),
      tabId
    });
    actions.closeReportAdModal({
      tabId
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    if (peerId) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.deleteSponsoredMessage)(global, peerId);
    } else {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateGlobalSearch)(global, {
        sponsoredPeer: undefined
      }, tabId);
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
    return;
  }
  if (result.type === 'selectOption') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).reportAdModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options.find(o => o.option === option);
    const newSection = {
      title: result.title,
      options: result.options,
      subtitle: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
      reportAdModal: {
        chatId: peerId,
        randomId,
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('hideSponsored', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsCurrentUserPremium)(global);
  if (!isCurrentUserPremium) {
    actions.openPremiumModal({
      initialSection: 'no_ads',
      tabId
    });
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('toggleSponsoredMessages', {
    enabled: false
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateUserFullInfo)(global, global.currentUserId, {
    areAdsEnabled: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('AdHidden'),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('fetchUnreadMentions', async (global, actions, payload) => {
  const {
    chatId,
    offsetId
  } = payload;
  await fetchUnreadMentions(global, chatId, offsetId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('approveSuggestedPost', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    scheduleDate,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
  const isAdmin = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsMonoforumAdmin)(global, chatId);
  if (!isAdmin && message?.suggestedPostInfo?.price?.amount) {
    const neededAmount = message.suggestedPostInfo.price.amount;
    const isCurrencyStars = message.suggestedPostInfo.price.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE;
    if (isCurrencyStars) {
      const currentBalance = global.stars?.balance?.amount || 0;
      if (neededAmount > currentBalance) {
        actions.openStarsBalanceModal({
          topup: {
            balanceNeeded: neededAmount
          },
          tabId
        });
        return;
      }
    } else {
      const currentTonBalance = global.ton?.balance?.amount || 0;
      if (neededAmount > currentTonBalance) {
        actions.openStarsBalanceModal({
          currency: _config__WEBPACK_IMPORTED_MODULE_2__.TON_CURRENCY_CODE,
          tabId
        });
        return;
      }
    }
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('toggleSuggestedPostApproval', {
    chat,
    messageId,
    reject: false,
    scheduleDate
  });
  if (!result) return;
  actions.showNotification({
    message: {
      key: 'SuggestedPostApproved'
    },
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('rejectSuggestedPost', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    rejectComment,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('toggleSuggestedPostApproval', {
    chat,
    messageId,
    reject: true,
    rejectComment
  });
  if (!result) return;
  actions.showNotification({
    message: {
      key: 'SuggestedPostRejectedNotification'
    },
    tabId
  });
});
async function fetchUnreadMentions(global, chatId, offsetId) {
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchUnreadMentions', {
    chat,
    offsetId
  });
  if (!result) return;
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.addUnreadMentions)(global, chatId, chat, ids);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('markMentionsRead', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.removeUnreadMentions)(global, chatId, chat, messageIds, true);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  actions.markMessagesRead({
    messageIds,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('focusNextMention', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  let chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentChat)(global, tabId);
  if (!chat) return;
  if (!chat.unreadMentions) {
    await fetchUnreadMentions(global, chat.id);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
    const previousChatId = chat.id;
    chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentChat)(global, tabId);
    if (!chat?.unreadMentions || previousChatId !== chat.id) return;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId: chat.unreadMentions[0],
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('readAllMentions', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return undefined;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('readAllMentions', {
    chat,
    threadId: threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID ? undefined : threadId
  });
  if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
    return (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChat)(global, chat.id, {
      unreadMentionsCount: undefined,
      unreadMentions: undefined
    });
  }

  // TODO[Forums]: Support mentions in threads
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('openUrl', (global, actions, payload) => {
  const {
    url,
    shouldSkipModal,
    ignoreDeepLinks,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const urlWithProtocol = (0,_util_browser_url__WEBPACK_IMPORTED_MODULE_3__.ensureProtocol)(url);
  const parsedUrl = new URL(urlWithProtocol);
  const isMixedScript = (0,_util_browser_url__WEBPACK_IMPORTED_MODULE_3__.isMixedScriptUrl)(urlWithProtocol);
  if (!ignoreDeepLinks && (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_6__.isDeepLink)(urlWithProtocol)) {
    actions.closeStoryViewer({
      tabId
    });
    actions.closePaymentModal({
      tabId
    });
    actions.openTelegramLink({
      url,
      tabId
    });
    return;
  }
  const {
    appConfig,
    config
  } = global;
  if (appConfig) {
    if (config?.autologinToken && appConfig.autologinDomains.includes(parsedUrl.hostname)) {
      parsedUrl.searchParams.set(AUTOLOGIN_TOKEN_KEY, config.autologinToken);
      window.open(parsedUrl.href, '_blank', 'noopener');
      return;
    }
    if (appConfig.urlAuthDomains.includes(parsedUrl.hostname)) {
      actions.closeStoryViewer({
        tabId
      });
      actions.requestLinkUrlAuth({
        url,
        tabId
      });
      return;
    }
  }
  const shouldDisplayModal = !urlWithProtocol.match(_config__WEBPACK_IMPORTED_MODULE_2__.RE_TELEGRAM_LINK) && !shouldSkipModal;
  if (shouldDisplayModal) {
    actions.toggleSafeLinkModal({
      url: isMixedScript ? parsedUrl.toString() : urlWithProtocol,
      tabId
    });
  } else {
    window.open(parsedUrl, '_blank', 'noopener');
  }
});
async function checkIfVoiceMessagesAllowed(global, user, chatId) {
  let fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUserFullInfo)(global, chatId);
  if (!fullInfo) {
    const {
      accessHash
    } = user;
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchFullUser', {
      id: chatId,
      accessHash
    });
    fullInfo = result?.fullInfo;
  }
  return Boolean(!fullInfo?.noVoiceMessages);
}
function moveReplyToNewDraft(global, threadId, replyInfo, toChatId) {
  const currentDraft = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, toChatId, threadId);
  if (!replyInfo.replyToMsgId) return;
  const newDraft = {
    ...currentDraft,
    replyInfo
  };
  saveDraft({
    global,
    chatId: toChatId,
    threadId,
    draft: newDraft,
    isLocalOnly: true,
    noLocalTimeUpdate: true
  });
}
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('openChatOrTopicWithReplyInDraft', (global, actions, payload) => {
  const {
    chatId: toChatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId);
  const replyingInfo = tabState.replyingMessage;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    isShareMessageModalShown: false,
    replyingMessage: {}
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentChat)(global, tabId);
  const currentThreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectCurrentMessageList)(global, tabId)?.threadId;
  if (!currentChat || !currentThreadId) return;
  const threadId = topicId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  const currentChatId = currentChat.id;
  const newReplyInfo = {
    type: 'message',
    replyToMsgId: replyingInfo.messageId,
    replyToTopId: replyingInfo.toThreadId,
    replyToPeerId: currentChatId,
    monoforumPeerId: replyingInfo.toThreadId,
    quoteText: replyingInfo.quoteText,
    quoteOffset: replyingInfo.quoteOffset
  };
  const currentReplyInfo = replyingInfo.messageId ? newReplyInfo : (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectDraft)(global, currentChatId, currentThreadId)?.replyInfo;
  if (!currentReplyInfo) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectReplyCanBeSentToChat)(global, toChatId, currentChatId, currentReplyInfo)) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('Chat.SendNotAllowedText'),
      tabId
    });
    return;
  }
  if (!currentReplyInfo.replyToPeerId && toChatId === currentChat.id) return;
  const getPeerId = () => {
    if (!currentReplyInfo?.replyToPeerId) return currentChatId;
    return currentReplyInfo.replyToPeerId === toChatId ? undefined : currentReplyInfo.replyToPeerId;
  };
  const replyToPeerId = getPeerId();
  const newReply = {
    ...currentReplyInfo,
    replyToPeerId,
    type: 'message'
  };
  moveReplyToNewDraft(global, threadId, newReply, toChatId);
  actions.openThread({
    chatId: toChatId,
    threadId,
    tabId
  });
  actions.closeMediaViewer({
    tabId
  });
  actions.exitMessageSelectMode({
    tabId
  });
  actions.clearDraft({
    chatId: currentChatId,
    threadId: currentThreadId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('setForwardChatOrTopic', async (global, actions, payload) => {
  const {
    chatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUser)(global, chatId);
  const isSelectForwardsContainVoiceMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectForwardsContainVoiceMessages)(global, tabId);
  if (isSelectForwardsContainVoiceMessages && user && !(await checkIfVoiceMessagesAllowed(global, user, chatId))) {
    actions.showDialog({
      data: {
        message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('VoiceMessagesRestrictedByPrivacy', (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.getUserFullName)(user))
      },
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectForwardsCanBeSentToChat)(global, chatId, tabId)) {
    actions.showAllowedMessageTypesNotification({
      chatId,
      tabId
    });
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).forwardMessages,
      toChatId: chatId,
      toThreadId: topicId
    },
    isShareMessageModalShown: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  actions.openThread({
    chatId,
    threadId: topicId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    tabId
  });
  actions.closeMediaViewer({
    tabId
  });
  actions.exitMessageSelectMode({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('forwardToSavedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).forwardMessages,
      toChatId: global.currentUserId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
  actions.exitMessageSelectMode({
    tabId
  });
  actions.forwardMessages({
    isSilent: true,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('forwardStory', (global, actions, payload) => {
  const {
    toChatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload || {};
  const {
    fromChatId,
    storyId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTabState)(global, tabId).forwardMessages;
  const fromChat = fromChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, fromChatId) : undefined;
  const toChat = toChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, toChatId) : undefined;
  const story = fromChatId && storyId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectPeerStory)(global, fromChatId, storyId) : undefined;
  if (!fromChat || !toChat || !story || 'isDeleted' in story) {
    return;
  }
  const lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatLastMessageId)(global, toChatId);
  const {
    text,
    entities
  } = story.content.text || {};
  void sendMessage(global, {
    chat: toChat,
    text,
    entities,
    story,
    lastMessageId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    forwardMessages: {},
    isShareMessageModalShown: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('requestMessageTranslation', (global, actions, payload) => {
  const {
    chatId,
    id,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectTranslationLanguage)(global),
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateRequestedMessageTranslation)(global, chatId, id, toLanguageCode, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.replaceSettings)(global, {
    translationLanguage: toLanguageCode
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('showOriginalMessage', (global, actions, payload) => {
  const {
    chatId,
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.removeRequestedMessageTranslation)(global, chatId, id, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('markMessagesTranslationPending', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectLanguageCode)(global)
  } = payload;
  messageIds.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateMessageTranslation)(global, chatId, id, toLanguageCode, {
      isPending: true
    });
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('translateMessages', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectLanguageCode)(global)
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return undefined;
  actions.markMessagesTranslationPending({
    chatId,
    messageIds,
    toLanguageCode
  });
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('translateText', {
    chat,
    messageIds,
    toLanguageCode
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('translateMessagesByTencent', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    toLanguageCode = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectLanguageCode)(global)
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return undefined;
  actions.markMessagesTranslationPending({
    chatId,
    messageIds,
    toLanguageCode
  });
  const texts = messageIds.map(messageId => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChatMessage)(global, chatId, messageId);
    // eslint-disable-next-line @typescript-eslint/no-non-null-asserted-optional-chain
    return message?.content.text;
  });
  const {
    currentUserId
  } = global;
  const userName = (0,_helpers__WEBPACK_IMPORTED_MODULE_18__.getUserFullName)((0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUser)(global, currentUserId));
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('translateTextByTencent', {
    chat,
    messageIds,
    text: texts,
    toLanguageCode,
    userId: currentUserId,
    userName: userName
  });
  return global;
});

// https://github.com/telegramdesktop/tdesktop/blob/11906297d82b6ff57b277da5251d2e6eb3d8b6d0/Telegram/SourceFiles/api/api_views.cpp#L22
const SEND_VIEWS_TIMEOUT = 1000;
let viewsIncrementTimeout;
let idsToIncrementViews = {};
function incrementViews() {
  if (viewsIncrementTimeout) {
    clearTimeout(viewsIncrementTimeout);
    viewsIncrementTimeout = undefined;
  }
  const {
    loadMessageViews
  } = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getActions)();
  Object.entries(idsToIncrementViews).forEach(([chatId, ids]) => {
    loadMessageViews({
      chatId,
      ids: Array.from(ids),
      shouldIncrement: true
    });
  });
  idsToIncrementViews = {};
}
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('scheduleForViewsIncrement', (global, actions, payload) => {
  const {
    ids,
    chatId
  } = payload;
  if (!viewsIncrementTimeout) {
    setTimeout(incrementViews, SEND_VIEWS_TIMEOUT);
  }
  if (!idsToIncrementViews[chatId]) {
    idsToIncrementViews[chatId] = new Set();
  }
  ids.forEach(id => {
    idsToIncrementViews[chatId].add(id);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadMessageViews', async (global, actions, payload) => {
  const {
    chatId,
    ids,
    shouldIncrement
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectIsCurrentUserFrozen)(global)) return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchMessageViews', {
    chat,
    ids,
    shouldIncrement
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  result.viewsInfo.forEach(update => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, update.id, {
      viewsCount: update.views,
      forwardsCount: update.forwards
    }, true);
    if (update.threadInfo) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateThreadInfo)(global, chatId, update.id, update.threadInfo);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadFactChecks', async (global, actions, payload) => {
  const {
    chatId,
    ids
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchFactChecks', {
    chat,
    ids
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  result.forEach((factCheck, i) => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, ids[i], {
      factCheck
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadPaidReactionPrivacy', () => {
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchPaidReactionPrivacy');
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadOutboxReadDate', async (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return;
  try {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchOutboxReadDate', {
      chat,
      messageId
    });
    if (result?.date) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, messageId, {
        readDate: result.date
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
    }
  } catch (error) {
    const {
      message
    } = error;
    if (message === 'USER_PRIVACY_RESTRICTED' || message === 'YOUR_PRIVACY_RESTRICTED') {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
      const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUser)(global, chatId);
      if (!user) return;
      const userStatus = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUserStatus)(global, chatId);
      if (!userStatus) return;
      const updateStatus = message === 'USER_PRIVACY_RESTRICTED' ? {
        isReadDateRestricted: true
      } : {
        isReadDateRestrictedByMe: true
      };
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.replaceUserStatuses)(global, {
        [chatId]: {
          ...userStatus,
          ...updateStatus
        }
      });
      // Need to reset `readDate` to `undefined` after click on "Show my Read Time" button
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateChatMessage)(global, chatId, messageId, {
        readDate: undefined
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('loadQuickReplies', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchQuickReplies');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateQuickReplyMessages)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.buildCollectionByKey)(result.messages, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_21__.updateQuickReplies)(global, result.quickReplies);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('sendQuickReply', (global, actions, payload) => {
  const {
    chatId,
    quickReplyId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) return global;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('sendQuickReply', {
    chat,
    shortcutId: quickReplyId
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('copyMessageLink', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    shouldIncludeThread,
    shouldIncludeGrouped,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, chatId);
  if (!chat) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('ErrorOccurred'),
      tabId
    });
    return;
  }
  const showErrorOccurredNotification = () => actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('ErrorOccurred'),
    tabId
  });
  if (!(0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isChatChannel)(chat) && !(0,_helpers__WEBPACK_IMPORTED_MODULE_18__.isChatSuperGroup)(chat)) {
    showErrorOccurredNotification();
    return;
  }
  const showLinkCopiedNotification = () => actions.showNotification({
    message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_13__.oldTranslate)('LinkCopied'),
    tabId
  });
  const callApiExportMessageLinkPromise = (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('exportMessageLink', {
    chat,
    id: messageId,
    shouldIncludeThread,
    shouldIncludeGrouped
  });
  await (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_5__.copyTextToClipboardFromPromise)(callApiExportMessageLinkPromise, showLinkCopiedNotification, showErrorOccurredNotification);
});
const MESSAGES_TO_REPORT_DELIVERY = new Map();
let reportDeliveryTimeout;
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('reportMessageDelivery', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const currentIds = MESSAGES_TO_REPORT_DELIVERY.get(chatId) || [];
  currentIds.push(messageId);
  MESSAGES_TO_REPORT_DELIVERY.set(chatId, currentIds);
  if (!reportDeliveryTimeout) {
    // Slightly unsafe in the multitab environment, but there is no better way to do it now.
    // Not critical if user manages to close the tab in a show window before the report is sent.
    reportDeliveryTimeout = window.setTimeout(() => {
      reportDeliveryTimeout = undefined;
      MESSAGES_TO_REPORT_DELIVERY.forEach((messageIds, cId) => {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectChat)(global, cId);
        if (!chat) return;
        (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('reportMessagesDelivery', {
          chat,
          messageIds
        });
      });
      MESSAGES_TO_REPORT_DELIVERY.clear();
    }, 500);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('openPreparedInlineMessageModal', async (global, actions, payload) => {
  const {
    botId,
    messageId,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const bot = (0,_selectors__WEBPACK_IMPORTED_MODULE_23__.selectUser)(global, botId);
  if (!bot) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_16__.callApi)('fetchPreparedInlineMessage', {
    bot,
    id: messageId
  });
  if (!result) {
    actions.sendWebAppEvent({
      webAppKey,
      event: {
        eventType: 'prepared_message_failed',
        eventData: {
          error: 'MESSAGE_EXPIRED'
        }
      },
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    preparedMessageModal: {
      message: result,
      webAppKey,
      botId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_20__.addActionHandler)('openSharePreparedMessageModal', (global, actions, payload) => {
  const {
    webAppKey,
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_7__.getCurrentTabId)()
  } = payload;
  const supportedFilters = message.peerTypes?.filter(type => type !== 'self');
  global = (0,_index__WEBPACK_IMPORTED_MODULE_20__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_22__.updateTabState)(global, {
    sharePreparedMessageModal: {
      webAppKey,
      filter: supportedFilters,
      message
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_20__.setGlobal)(global);
});
function countSortedIds(ids, from, to) {
  // If ids are outside viewport, we cannot get correct count
  if (ids.length === 0 || from < ids[0] || to > ids[ids.length - 1]) return undefined;
  let count = 0;
  for (let i = 0, l = ids.length; i < l; i++) {
    if (ids[i] >= from && ids[i] <= to) {
      count++;
    }
    if (ids[i] >= to) {
      break;
    }
  }
  return count;
}
function splitAttachmentsByType(attachments) {
  return attachments.reduce((acc, attachment, index, arr) => {
    if (index === 0) {
      acc.push([attachment]);
      return acc;
    }
    const type = getAttachmentType(attachment);
    const previousType = getAttachmentType(arr[index - 1]);
    if (type === previousType) {
      acc[acc.length - 1].push(attachment);
    } else {
      acc.push([attachment]);
    }
    return acc;
  }, []);
}
function getAttachmentType(attachment) {
  const {
    shouldSendAsFile,
    mimeType
  } = attachment;
  if (_config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_AUDIO_CONTENT_TYPES.has(mimeType)) return 'audio';
  if (shouldSendAsFile) return 'file';
  if (mimeType === _config__WEBPACK_IMPORTED_MODULE_2__.GIF_MIME_TYPE) return 'gif';
  if (_config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_PHOTO_CONTENT_TYPES.has(mimeType) || _config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_VIDEO_CONTENT_TYPES.has(mimeType)) return 'media';
  if (attachment.voice) return 'voice';
  return 'file';
}

/***/ },

/***/ "./src/global/actions/api/middleSearch.ts"
/*!************************************************!*\
  !*** ./src/global/actions/api/middleSearch.ts ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_searchResultKey__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/keys/searchResultKey */ "./src/util/keys/searchResultKey.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const MEDIA_PRELOAD_OFFSET = 9;
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('performMiddleSearch', async (global, actions, payload) => {
  const {
    query,
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  if (!chatId) return;
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const peer = realChatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, realChatId) : undefined;
  let currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMiddleSearch)(global, tabId);
  if (!peer) {
    return;
  }
  if (!currentSearch) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearch)(global, realChatId, threadId, {}, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  }
  currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMiddleSearch)(global, tabId);
  const {
    results,
    savedTag,
    type,
    isHashtag
  } = currentSearch;
  const shouldReuseParams = results?.query === query;
  const offsetId = shouldReuseParams ? results?.nextOffsetId : undefined;
  const offsetRate = shouldReuseParams ? results?.nextOffsetRate : undefined;
  const offsetPeerId = shouldReuseParams ? results?.nextOffsetPeerId : undefined;
  const offsetPeer = shouldReuseParams && offsetPeerId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, offsetPeerId) : undefined;
  const shouldHaveQuery = isHashtag || !savedTag;
  if (shouldHaveQuery && !query) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearch)(global, realChatId, threadId, {
      fetchingQuery: undefined
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearch)(global, realChatId, threadId, {
    fetchingQuery: query
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  let result;
  if (type === 'chat') {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesInChat', {
      peer,
      type: 'text',
      query: isHashtag ? `#${query}` : query,
      threadId,
      limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_SEARCH_SLICE,
      offsetId,
      isSavedDialog,
      savedTag
    });
  }
  if (type === 'myChats') {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesGlobal', {
      type: 'text',
      query: isHashtag ? `#${query}` : query,
      limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_SEARCH_SLICE,
      offsetId,
      offsetRate,
      offsetPeer
    });
  }
  if (type === 'channels') {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchPublicPosts', {
      hashtag: query,
      limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_SEARCH_SLICE,
      offsetId,
      offsetPeer,
      offsetRate
    });
  }
  if (!result) {
    return;
  }
  const {
    userStatusesById,
    messages,
    totalCount,
    nextOffsetId,
    nextOffsetRate,
    nextOffsetPeerId
  } = result;
  const newFoundIds = messages.map(_util_keys_searchResultKey__WEBPACK_IMPORTED_MODULE_5__.getSearchResultKey);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMiddleSearch)(global, tabId);
  const hasTagChanged = currentSearch?.savedTag && !(0,_helpers__WEBPACK_IMPORTED_MODULE_7__.isSameReaction)(savedTag, currentSearch.savedTag);
  const hasSearchChanged = currentSearch?.fetchingQuery !== query;
  if (!currentSearch || hasSearchChanged || hasTagChanged) {
    return;
  }
  const resultChatId = isSavedDialog ? currentUserId : peer.id;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUserStatuses)(global, userStatusesById);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addMessages)(global, messages);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearch)(global, resultChatId, threadId, {
    fetchingQuery: undefined
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateMiddleSearchResults)(global, resultChatId, threadId, {
    foundIds: newFoundIds,
    totalCount,
    nextOffsetId,
    nextOffsetRate,
    nextOffsetPeerId,
    query: query || ''
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchHashtag', (global, actions, payload) => {
  const {
    hashtag,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const messageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId);
  if (!messageList) {
    return;
  }
  const cleanQuery = hashtag.replace(/^#/, '');
  actions.updateMiddleSearch({
    chatId: messageList.chatId,
    threadId: messageList.threadId,
    update: {
      isHashtag: true,
      requestedQuery: cleanQuery
    },
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchSharedMediaMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return;
  }
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, realChatId);
  const currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentSharedMediaSearch)(global, tabId);
  if (!peer || !currentSearch) {
    return;
  }
  const {
    currentType: type,
    resultsByType
  } = currentSearch;
  const currentResults = type && resultsByType && resultsByType[type];
  const offsetId = currentResults?.nextOffsetId;
  if (!type) {
    return;
  }
  void searchSharedMedia(global, peer, threadId, type, offsetId, undefined, isSavedDialog, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchChatMediaMessages', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    currentMediaMessageId,
    limit,
    direction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (!chatId || !threadId || !currentMediaMessageId) {
    return;
  }
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, realChatId);
  if (!chat) {
    return;
  }
  let currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentChatMediaSearch)(global, tabId);
  if (!currentSearch) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.initializeChatMediaSearchResults)(global, chatId, threadId, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentChatMediaSearch)(global, tabId);
    if (!currentSearch) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  }
  void searchChatMedia(global, chat, threadId, currentMediaMessageId, currentSearch, direction, isSavedDialog, limit, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('searchMessagesByDate', async (global, actions, payload) => {
  const {
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
  if (!chat) {
    return;
  }
  const messageId = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('findFirstMessageIdAfterDate', {
    chat,
    timestamp
  });
  if (!messageId) {
    return;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId,
    tabId
  });
});
async function searchSharedMedia(global, peer, threadId, type, offsetId, isBudgetPreload = false, isSavedDialog, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()]) {
  const resultChatId = isSavedDialog ? global.currentUserId : peer.id;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesInChat', {
    peer,
    type,
    limit: _config__WEBPACK_IMPORTED_MODULE_2__.SHARED_MEDIA_SLICE * 2,
    threadId,
    offsetId,
    isSavedDialog
  });
  if (!result) {
    return;
  }
  const {
    userStatusesById,
    messages,
    totalCount,
    nextOffsetId
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(messages, 'id');
  const newFoundIds = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  const currentSearch = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentSharedMediaSearch)(global, tabId);
  if (!currentSearch) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUserStatuses)(global, userStatusesById);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChatMessagesById)(global, resultChatId, byId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateSharedMediaSearchResults)(global, resultChatId, threadId, type, newFoundIds, totalCount, nextOffsetId, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  if (!isBudgetPreload) {
    void searchSharedMedia(global, peer, threadId, type, nextOffsetId, true, isSavedDialog, tabId);
  }
}
function selectCurrentChatMediaSearchSegment(params, currentMediaMessageId) {
  if ((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.isInsideSortedArrayRange)(currentMediaMessageId, params.currentSegment.foundIds)) {
    return params.currentSegment;
  }
  const index = params.segments.findIndex(segment => (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.isInsideSortedArrayRange)(currentMediaMessageId, segment.foundIds));
  if (index === -1) {
    if (params.currentSegment && params.currentSegment.foundIds.length) {
      params.segments.push(params.currentSegment);
    }
    return undefined;
  }
  const result = params.segments.splice(index, 1)[0];
  params.segments.push(params.currentSegment);
  return result;
}
function calcChatMediaSearchAddOffset(direction, limit) {
  if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) return 0;
  if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards) return -(limit + 1);
  return -(Math.round(limit / 2) + 1);
}
function calcChatMediaSearchOffsetId(direction, currentMessageId, segment) {
  if (!segment) return currentMessageId;
  if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) return segment.foundIds[0];
  if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards) return segment.foundIds[segment.foundIds.length - 1];
  return currentMessageId;
}
function calcLoadMoreDirection(currentMessageId, currentSegment) {
  if (!currentSegment) return _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around;
  const currentSegmentFoundIdsCount = currentSegment.foundIds.length;
  const idIndexInSegment = currentSegment.foundIds.indexOf(currentMessageId);
  if (idIndexInSegment === -1) return _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Around;
  if (currentSegment.loadingState.areAllItemsLoadedBackwards && currentSegment.loadingState.areAllItemsLoadedForwards) {
    return undefined;
  }
  const halfMediaCount = Math.floor(currentSegmentFoundIdsCount / 2);
  const preloadOffset = MEDIA_PRELOAD_OFFSET > halfMediaCount ? 0 : MEDIA_PRELOAD_OFFSET;
  const lastMediaIndex = currentSegmentFoundIdsCount - 1;
  if (idIndexInSegment <= preloadOffset) {
    if (currentSegment.loadingState.areAllItemsLoadedBackwards) return undefined;
    return _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards;
  }
  if (idIndexInSegment >= lastMediaIndex - preloadOffset) {
    if (currentSegment.loadingState.areAllItemsLoadedForwards) return undefined;
    return _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards;
  }
  return undefined;
}
function calcLoadingState(direction, limit, newFoundIdsCount, currentSegment) {
  let areAllItemsLoadedForwards = Boolean(currentSegment?.loadingState.areAllItemsLoadedForwards);
  let areAllItemsLoadedBackwards = Boolean(currentSegment?.loadingState.areAllItemsLoadedBackwards);
  if (newFoundIdsCount < limit) {
    if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Forwards) {
      areAllItemsLoadedForwards = true;
    } else if (direction === _types__WEBPACK_IMPORTED_MODULE_1__.LoadMoreDirection.Backwards) {
      areAllItemsLoadedBackwards = true;
    }
  }
  return {
    areAllItemsLoadedForwards,
    areAllItemsLoadedBackwards
  };
}
async function searchChatMedia(global, peer, threadId, currentMediaMessageId, chatMediaSearchParams, direction, isSavedDialog, limit = _config__WEBPACK_IMPORTED_MODULE_2__.CHAT_MEDIA_SLICE, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()]) {
  const {
    isSynced
  } = global;
  if (!isSynced || chatMediaSearchParams.isLoading) {
    return;
  }
  let currentSegment = selectCurrentChatMediaSearchSegment(chatMediaSearchParams, currentMediaMessageId);
  if (direction === undefined) {
    direction = calcLoadMoreDirection(currentMediaMessageId, currentSegment);
  }
  if (direction === undefined) {
    return;
  }
  const offsetId = calcChatMediaSearchOffsetId(direction, currentMediaMessageId, currentSegment);
  const addOffset = calcChatMediaSearchAddOffset(direction, limit);
  const resultChatId = isSavedDialog ? global.currentUserId : peer.id;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.setChatMediaSearchLoading)(global, resultChatId, threadId, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchMessagesInChat', {
    peer,
    type: 'media',
    limit,
    threadId,
    offsetId,
    isSavedDialog,
    addOffset
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.setChatMediaSearchLoading)(global, resultChatId, threadId, false, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    return;
  }
  const {
    messages,
    userStatusesById
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(messages, 'id');
  const newFoundIds = Object.keys(byId).map(Number);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addUserStatuses)(global, userStatusesById);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.addChatMessagesById)(global, resultChatId, byId);
  const loadingState = calcLoadingState(direction, limit, newFoundIds.length, currentSegment);
  const filteredIds = (0,_helpers__WEBPACK_IMPORTED_MODULE_7__.getChatMediaMessageIds)(byId, newFoundIds, false);
  currentSegment = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.mergeWithChatMediaSearchSegment)(filteredIds, loadingState, currentSegment);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.updateChatMediaSearchResults)(global, resultChatId, threadId, currentSegment, chatMediaSearchParams, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_9__.setChatMediaSearchLoading)(global, resultChatId, threadId, false, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
}

/***/ },

/***/ "./src/global/actions/api/payments.ts"
/*!********************************************!*\
  !*** ./src/global/actions/api/payments.ts ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_payments_stripe__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/payments/stripe */ "./src/util/payments/stripe.ts");
/* harmony import */ var _util_requestQuery__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/requestQuery */ "./src/util/requestQuery.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_themeStyle__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/themeStyle */ "./src/util/themeStyle.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_payments__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");















const LOCAL_BOOST_COOLDOWN = 86400; // 24 hours

(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('validateRequestedInfo', (global, actions, payload) => {
  const {
    requestInfo,
    saveInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentInputInvoice)(global, tabId);
  if (!inputInvoice) {
    return;
  }
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  validateRequestedInfo(global, requestInputInvoice, requestInfo, saveInfo, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openInvoice', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    ...inputInvoice
  } = payload;
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isPaymentFormLoading: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_7__.extractCurrentThemeParams)();
  const form = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPaymentForm', requestInputInvoice, theme);
  if (!form) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isPaymentFormLoading: false
  }, tabId);
  if ('error' in form) {
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    handlePaymentFormError(form.error, tabId);
    return;
  }
  if (form.type === 'regular') {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      inputInvoice: payload,
      form,
      isPaymentModalOpen: true,
      isExtendedMedia: payload.isExtendedMedia,
      status: undefined
    }, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  }
  if (form.type === 'stars') {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      starsPayment: {
        inputInvoice,
        form,
        status: 'pending'
      }
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendStarGift', (global, actions, payload) => {
  const {
    gift,
    peerId,
    message,
    shouldHideName,
    shouldUpgrade,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = {
    type: 'stargift',
    peerId,
    giftId: gift.id,
    message,
    shouldHideName,
    shouldUpgrade: shouldUpgrade || undefined
  };
  payInputStarInvoice(global, inputInvoice, gift.stars, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('buyStarGift', (global, actions, payload) => {
  const {
    slug,
    peerId,
    price,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = {
    type: 'stargiftResale',
    slug,
    peerId,
    currency: price.currency
  };
  payInputStarInvoice(global, inputInvoice, price.amount, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendPremiumGiftByStars', (global, actions, payload) => {
  const {
    userId,
    months,
    amount,
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const inputInvoice = {
    type: 'premiumGiftStars',
    userId,
    months,
    message
  };
  payInputStarInvoice(global, inputInvoice, amount, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('getReceipt', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = chatId && (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!messageId || !chat) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getReceipt', chat, messageId);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (result.receipt.type === 'stars') {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.openStarsTransactionFromReceipt)(global, result.receipt, tabId);
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setReceipt)(global, result.receipt, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('clearPaymentError', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
      error: undefined
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('clearReceipt', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
      receipt: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendCredentialsInfo', (global, actions, payload) => {
  const {
    credentials,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const {
    nativeProvider
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment.form;
  const {
    data
  } = credentials;
  if (nativeProvider === 'stripe') {
    const publishableKey = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectProviderPublishableKey)(global, tabId);
    if (!publishableKey) {
      return;
    }
    void sendStripeCredentials(global, data, publishableKey, tabId);
  } else if (nativeProvider === 'smartglocal') {
    const publicToken = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectProviderPublicToken)(global, tabId);
    if (!publicToken) {
      return;
    }
    void sendSmartGlocalCredentials(global, data, publicToken, tabId);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendPaymentForm', async (global, actions, payload) => {
  const {
    shippingOptionId,
    saveCredentials,
    savedCredentialId,
    tipAmount,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const requestInfoId = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPaymentRequestId)(global, tabId);
  const paymentState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment;
  const {
    form,
    temporaryPassword,
    inputInvoice
  } = paymentState;
  if (!inputInvoice || !form) {
    return;
  }
  const {
    nativeProvider,
    formId
  } = form;
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
    status: 'pending'
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const credentials = {
    save: saveCredentials,
    data: nativeProvider === 'stripe' ? (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectStripeCredentials)(global, tabId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectSmartGlocalCredentials)(global, tabId)
  };
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('sendPaymentForm', {
    inputInvoice: requestInputInvoice,
    formId,
    credentials,
    requestedInfoId: requestInfoId,
    shippingOptionId,
    savedCredentialId,
    temporaryPassword: temporaryPassword?.value,
    tipAmount
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
    status: 'paid'
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.closeInvoice)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.apiUpdate({
    '@type': 'updatePaymentStateCompleted',
    paymentState,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('sendStarPaymentForm', async (global, actions, payload) => {
  const {
    directInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const starPayment = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectStarsPayment)(global, tabId);
  const inputInvoice = starPayment?.inputInvoice || directInfo?.inputInvoice;
  if (!inputInvoice) return;
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  const formId = starPayment.form?.formId || starPayment.subscriptionInfo?.subscriptionFormId || directInfo?.formId;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateStarsPayment)(global, {
    status: 'pending'
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('sendStarPaymentForm', {
    inputInvoice: requestInputInvoice,
    formId
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateStarsPayment)(global, {
      status: 'failed'
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    actions.closeStarsPaymentModal({
      tabId
    });
    actions.closeGiftModal({
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateStarsPayment)(global, {
    status: 'paid'
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.closeStarsPaymentModal({
    tabId
  });
  if ('channelId' in result) {
    actions.openChat({
      id: result.channelId,
      tabId
    });
  }
  actions.apiUpdate({
    '@type': 'updateStarPaymentStateCompleted',
    paymentState: directInfo ? {
      inputInvoice
    } : starPayment,
    tabId
  });
  actions.loadStarStatus();
});
async function sendStripeCredentials(global, data, publishableKey, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()]) {
  const query = (0,_util_requestQuery__WEBPACK_IMPORTED_MODULE_5__.buildQueryString)({
    'card[number]': data.cardNumber,
    'card[exp_month]': data.expiryMonth,
    'card[exp_year]': data.expiryYear,
    'card[cvc]': data.cvv,
    'card[address_zip]': data.zip,
    'card[address_country]': data.country
  });
  const response = await fetch(`https://api.stripe.com/v1/tokens${query}`, {
    method: 'POST',
    credentials: 'same-origin',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      Authorization: `Bearer ${publishableKey}`
    }
  });
  const result = await response.json();
  if (result.error) {
    const error = (0,_util_payments_stripe__WEBPACK_IMPORTED_MODULE_4__.getStripeError)(result.error);
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      payment: {
        ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
        status: 'failed',
        error: {
          ...error
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setStripeCardInfo)(global, {
    type: result.type,
    id: result.id
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
async function sendSmartGlocalCredentials(global, data, publicToken, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()]) {
  const params = {
    card: {
      number: data.cardNumber.replace(/\D+/g, ''),
      expiration_month: data.expiryMonth,
      expiration_year: data.expiryYear,
      security_code: data.cvv.replace(/\D+/g, '')
    }
  };
  const tokenizeUrl = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment.form?.nativeParams.tokenizeUrl;
  let url;
  if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG_PAYMENT_SMART_GLOCAL) {
    url = 'https://tgb-playground.smart-glocal.com/cds/v1/tokenize/card';
  } else {
    url = 'https://tgb.smart-glocal.com/cds/v1/tokenize/card';
  }
  if (tokenizeUrl?.startsWith('https://') && tokenizeUrl.endsWith('.smart-glocal.com/cds/v1/tokenize/card')) {
    url = tokenizeUrl;
  }
  const response = await fetch(url, {
    method: 'POST',
    headers: {
      Accept: 'application/json',
      'Content-Type': 'application/json',
      'X-PUBLIC-TOKEN': publicToken
    },
    body: JSON.stringify(params)
  });
  const result = await response.json();
  if (result.status !== 'ok') {
    // TODO      getStripeError(result.error);
    const error = {
      descriptionKey: {
        key: 'ErrorUnexpected'
      }
    };
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      payment: {
        ...(0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).payment,
        status: 'failed',
        error: {
          ...error
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setSmartGlocalCardInfo)(global, {
    type: 'card',
    token: result.data.token
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('setSmartGlocalCardInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    type,
    token
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setSmartGlocalCardInfo)(global, {
    type,
    token
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('setPaymentStep', (global, actions, payload) => {
  const {
    step,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, step ?? _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('closePremiumModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.premiumModal) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    premiumModal: {
      promo: tabState.premiumModal.promo,
      // Cache promo
      isOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openPremiumModal', async (global, actions, payload) => {
  const {
    initialSection,
    fromUserId,
    isSuccess,
    isGift,
    monthsAmount,
    toUserId,
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  actions.loadPremiumStickers();
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchPremiumPromo');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    premiumModal: {
      promo: result.promo,
      initialSection,
      isOpen: true,
      fromUserId,
      toUserId,
      isGift,
      monthsAmount,
      isSuccess,
      gift
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  actions.closeReactionPicker({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openGiveawayModal', async (global, actions, payload) => {
  const {
    chatId,
    prepaidGiveaway,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPremiumGiftCodeOptions', {
    chat
  });
  const starOptions = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarsGiveawayOptions');
  if (!result || !starOptions) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giveawayModal: {
      chatId,
      gifts: result,
      isOpen: true,
      prepaidGiveaway,
      starOptions
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openGiftModal', async (global, actions, payload) => {
  const {
    forUserId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return;
  }
  const gifts = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPremiumGiftCodeOptions', {});
  if (!gifts) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftModal: {
      forPeerId: forUserId,
      gifts
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openStarsGiftModal', async (global, actions, payload) => {
  const {
    forUserId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return;
  }
  const starsGiftOptions = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getStarsGiftOptions', {});
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    starsGiftModal: {
      isOpen: true,
      forUserId,
      starsGiftOptions
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('validatePaymentPassword', async (global, actions, payload) => {
  const {
    password,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchTemporaryPaymentPassword', password);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      error: {
        messageKey: {
          key: 'ErrorUnexpected'
        },
        field: 'password'
      }
    }, tabId);
  } else if ('error' in result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      error: {
        messageKey: result.messageKey,
        field: 'password'
      }
    }, tabId);
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePayment)(global, {
      temporaryPassword: result,
      step: _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
async function validateRequestedInfo(global, inputInvoice, requestInfo, shouldSave, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()]) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('validateRequestedInfo', {
    inputInvoice,
    requestInfo,
    shouldSave
  });
  if (!result) {
    return;
  }
  const {
    id,
    shippingOptions
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setRequestInfoId)(global, id, tabId);
  if (shippingOptions?.length) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateShippingOptions)(global, shippingOptions, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Shipping, tabId);
  } else {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.Checkout, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openBoostModal', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat || !((0,_helpers__WEBPACK_IMPORTED_MODULE_9__.isChatChannel)(chat) || (0,_helpers__WEBPACK_IMPORTED_MODULE_9__.isChatSuperGroup)(chat))) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      chatId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostStatus', {
    chat
  });
  if (!result) {
    actions.closeBoostModal({
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      chatId,
      boostStatus: result
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const myBoosts = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchMyBoosts');
  if (!myBoosts) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostModal) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostModal: {
      ...tabState.boostModal,
      myBoosts: myBoosts.boosts
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openBoostStatistics', async (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      chatId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const [boostListResult, boostListGiftResult, boostStatusResult] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat,
    isGifts: true
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostStatus', {
    chat
  })]);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!boostListResult || !boostListGiftResult || !boostStatusResult) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostStatistics: undefined
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      chatId,
      boostStatus: boostStatusResult,
      nextOffset: boostListResult.nextOffset,
      boosts: {
        count: boostListResult.count,
        list: boostListResult.boostList
      },
      giftedBoosts: {
        count: boostListGiftResult?.count,
        list: boostListGiftResult?.boostList
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openMonetizationStatistics', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    monetizationStatistics: {
      chatId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadMoreBoosters', async (global, actions, payload) => {
  const {
    isGifts,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  let tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostStatistics) return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, tabState.boostStatistics.chatId);
  if (!chat) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      ...tabState.boostStatistics,
      isLoadingBoosters: true
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchBoostList', {
    chat,
    offset: tabState.boostStatistics.nextOffset,
    isGifts
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (!tabState.boostStatistics) return;
  const updatedBoostList = (isGifts ? tabState.boostStatistics.giftedBoosts?.list || [] : tabState.boostStatistics.boosts?.list || []).concat(result.boostList);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    boostStatistics: {
      ...tabState.boostStatistics,
      nextOffset: result.nextOffset,
      isLoadingBoosters: false,
      [isGifts ? 'giftedBoosts' : 'boosts']: {
        count: result.count,
        list: updatedBoostList
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('applyBoost', async (global, actions, payload) => {
  const {
    chatId,
    slots,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const oldChatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatFullInfo)(global, chatId);
  const oldBoostsApplied = oldChatFullInfo?.boostsApplied || 0;
  const appliedBoostsCount = slots.length;
  let tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  const oldStatus = tabState.boostModal?.boostStatus;
  if (oldStatus) {
    const boostsPerLevel = oldStatus.nextLevelBoosts ? oldStatus.nextLevelBoosts - oldStatus.currentLevelBoosts : 1;
    const newBoosts = oldStatus.boosts + appliedBoostsCount;
    const isLevelUp = oldStatus.nextLevelBoosts && newBoosts >= oldStatus.nextLevelBoosts;
    const newCurrentLevelBoosts = isLevelUp ? oldStatus.nextLevelBoosts : oldStatus.currentLevelBoosts;
    const newNextLevelBoosts = isLevelUp ? oldStatus.nextLevelBoosts + boostsPerLevel : oldStatus.nextLevelBoosts;
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        boostStatus: {
          ...oldStatus,
          level: isLevelUp ? oldStatus.level + 1 : oldStatus.level,
          currentLevelBoosts: newCurrentLevelBoosts,
          nextLevelBoosts: newNextLevelBoosts,
          hasMyBoost: true,
          boosts: newBoosts
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  const oldMyBoosts = tabState.boostModal?.myBoosts;
  if (oldMyBoosts) {
    const unixNow = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_6__.getServerTime)();
    const newMyBoosts = oldMyBoosts.map(boost => {
      if (slots.includes(boost.slot)) {
        return {
          ...boost,
          chatId,
          date: unixNow,
          cooldownUntil: unixNow + LOCAL_BOOST_COOLDOWN // Will be refetched below
        };
      }
      return boost;
    });
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        myBoosts: newMyBoosts
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('applyBoost', {
    slots,
    chat
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  if (!result) {
    // Rollback local changes
    const boostModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).boostModal;
    if (boostModal) {
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
        boostModal: {
          ...boostModal,
          boostStatus: oldStatus,
          myBoosts: oldMyBoosts
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    }
    return;
  }
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId);
  if (oldChatFullInfo) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateChatFullInfo)(global, chatId, {
      boostsApplied: oldBoostsApplied + slots.length
    });
  }
  if (tabState.boostModal) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      boostModal: {
        ...tabState.boostModal,
        myBoosts: result.boosts
      }
    }, tabId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('checkGiftCode', async (global, actions, payload) => {
  const {
    slug,
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('checkGiftCode', {
    slug
  });
  if (!result) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('lng_gift_link_expired'),
      tabId
    });
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftCodeModal: {
      slug,
      info: result.code,
      message
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('applyGiftCode', async (global, actions, payload) => {
  const {
    slug,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('applyGiftCode', {
    slug
  });
  if (!result) {
    return;
  }
  actions.requestConfetti({
    withStars: true,
    tabId
  });
  actions.closeGiftCodeModal({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('launchPrepaidGiveaway', async (global, actions, payload) => {
  const {
    chatId,
    giveawayId,
    paymentPurpose,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const additionalChannels = paymentPurpose?.additionalChannelIds?.map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, id)).filter(Boolean);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('launchPrepaidGiveaway', {
    chat,
    giveawayId,
    paymentPurpose: {
      type: 'giveaway',
      chat,
      areWinnersVisible: paymentPurpose?.areWinnersVisible,
      additionalChannels,
      countries: paymentPurpose?.countries,
      prizeDescription: paymentPurpose.prizeDescription,
      untilDate: paymentPurpose.untilDate,
      currency: paymentPurpose.currency,
      amount: paymentPurpose.amount
    }
  });
  if (!result) {
    return;
  }
  actions.openBoostStatistics({
    chatId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('launchPrepaidStarsGiveaway', async (global, actions, payload) => {
  const {
    chatId,
    giveawayId,
    paymentPurpose,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, chatId);
  if (!chat) return;
  const additionalChannels = paymentPurpose?.additionalChannelIds?.map(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, id)).filter(Boolean);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('launchPrepaidGiveaway', {
    chat,
    giveawayId,
    paymentPurpose: {
      type: 'starsgiveaway',
      chat,
      areWinnersVisible: paymentPurpose?.areWinnersVisible,
      additionalChannels,
      countries: paymentPurpose?.countries,
      prizeDescription: paymentPurpose.prizeDescription,
      untilDate: paymentPurpose.untilDate,
      currency: paymentPurpose.currency,
      amount: paymentPurpose.amount,
      stars: paymentPurpose.stars,
      users: paymentPurpose.users
    }
  });
  if (!result) {
    return;
  }
  actions.openBoostStatistics({
    chatId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('upgradeGift', (global, actions, payload) => {
  const {
    gift,
    shouldKeepOriginalDetails,
    upgradeStars,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const requestSavedGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputSavedStarGift)(global, gift);
  if (!requestSavedGift) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isWaitingForStarGiftUpgrade: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  actions.closeGiftUpgradeModal({
    tabId
  });
  actions.closeGiftInfoModal({
    tabId
  });
  if (!upgradeStars) {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('upgradeStarGift', {
      inputSavedGift: requestSavedGift,
      shouldKeepOriginalDetails: shouldKeepOriginalDetails || undefined
    });
    return;
  }
  const invoice = {
    type: 'stargiftUpgrade',
    inputSavedGift: gift,
    shouldKeepOriginalDetails: shouldKeepOriginalDetails || undefined
  };
  payInputStarInvoice(global, invoice, upgradeStars, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('transferGift', (global, actions, payload) => {
  const {
    gift,
    recipientId,
    transferStars,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, recipientId);
  const requestSavedGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputSavedStarGift)(global, gift);
  if (!peer || !requestSavedGift) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isWaitingForStarGiftTransfer: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  actions.closeGiftTransferModal({
    tabId
  });
  actions.closeGiftInfoModal({
    tabId
  });
  if (!transferStars) {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('transferStarGift', {
      inputSavedGift: requestSavedGift,
      toPeer: peer
    });
    return;
  }
  const invoice = {
    type: 'stargiftTransfer',
    inputSavedGift: gift,
    recipientId
  };
  payInputStarInvoice(global, invoice, transferStars, tabId);
});
async function payInputStarInvoice(global, inputInvoice, price, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()]) {
  const actions = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getActions)();
  const isTon = inputInvoice.type === 'stargiftResale' && inputInvoice.currency === 'TON';
  const balance = isTon ? global.ton?.balance : global.stars?.balance;
  if (balance === undefined) return;
  if (balance.amount < price) {
    actions.openStarsBalanceModal({
      currency: isTon ? 'TON' : 'XTR',
      tabId
    });
    return;
  }
  const requestInputInvoice = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputInvoice)(global, inputInvoice);
  if (!requestInputInvoice) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isPaymentFormLoading: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_7__.extractCurrentThemeParams)();
  const form = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('getPaymentForm', requestInputInvoice, theme);
  if (!form) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    isPaymentFormLoading: false
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  if ('error' in form) {
    handlePaymentFormError(form.error, tabId);
    return;
  }
  const formPrice = form.invoice.totalAmount;
  if (formPrice !== price) {
    const isTon = inputInvoice.type === 'stargiftResale' && inputInvoice.currency === 'TON';
    actions.openPriceConfirmModal({
      originalAmount: price,
      newAmount: formPrice,
      currency: isTon ? 'TON' : 'XTR',
      directInfo: {
        inputInvoice,
        formId: form.formId
      },
      tabId
    });
    return;
  }
  actions.sendStarPaymentForm({
    directInfo: {
      inputInvoice,
      formId: form.formId
    },
    tabId
  });
}
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openUniqueGiftBySlug', async (global, actions, payload) => {
  const {
    slug,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const gift = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchUniqueStarGift', {
    slug
  });
  if (!gift) {
    actions.showNotification({
      message: {
        key: 'GiftWasNotFound'
      },
      tabId
    });
    return;
  }
  actions.openGiftInfoModal({
    gift,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('processStarGiftWithdrawal', async (global, actions, payload) => {
  const {
    gift,
    password,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  let giftWithdrawModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).giftWithdrawModal;
  if (!giftWithdrawModal) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    giftWithdrawModal: {
      ...giftWithdrawModal,
      isLoading: true,
      errorKey: undefined
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  const inputGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_10__.getRequestInputSavedStarGift)(global, gift);
  if (!inputGift) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchStarGiftWithdrawalUrl', {
    inputGift,
    password
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  giftWithdrawModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).giftWithdrawModal;
  if (!giftWithdrawModal) return;
  if ('error' in result) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
      giftWithdrawModal: {
        ...giftWithdrawModal,
        isLoading: false,
        errorKey: result.messageKey
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
    return;
  }
  actions.openUrl({
    url: result.url,
    shouldSkipModal: true,
    tabId
  });
  actions.closeGiftWithdrawModal({
    tabId
  });
});
function handlePaymentFormError(error, tabId) {
  if (error === 'SLUG_INVALID') {
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.getActions)().showNotification({
      message: {
        key: 'PaymentInvoiceNotFound'
      },
      tabId
    });
    return;
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.getActions)().showDialog({
    data: {
      message: error,
      hasErrorKey: true
    },
    tabId
  });
}

/***/ },

/***/ "./src/global/actions/api/reactions.ts"
/*!*********************************************!*\
  !*** ./src/global/actions/api/reactions.ts ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/requestActionTimeout */ "./src/util/requestActionTimeout.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");














const INTERACTION_RANDOM_OFFSET = 40;
let interactionLocalId = 0;
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadAvailableReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchAvailableReactions');
  if (!result) {
    return;
  }

  // Preload animations
  result.forEach(availableReaction => {
    if (availableReaction.aroundAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch(`sticker${availableReaction.aroundAnimation.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.centerIcon) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch(`sticker${availableReaction.centerIcon.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.appearAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch(`sticker${availableReaction.appearAnimation.id}`, _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
    if (availableReaction.selectAnimation) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.fetch((0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getDocumentMediaHash)(availableReaction.selectAnimation, 'full'), _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.BlobUrl);
    }
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      availableReactions: result
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  (0,_util_requestActionTimeout__WEBPACK_IMPORTED_MODULE_6__["default"])({
    action: 'loadAvailableReactions',
    payload: undefined
  }, _config__WEBPACK_IMPORTED_MODULE_1__.GENERAL_REFETCH_INTERVAL);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadAvailableEffects', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchAvailableEffects');
  if (!result) {
    return;
  }
  const {
    effects,
    emojis,
    stickers
  } = result;
  const reactions = [];
  const effectById = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(effects, 'id');
  for (const effect of effects) {
    if (effect.effectAnimationId) {
      const reaction = {
        type: 'emoji',
        emoticon: effect.emoticon
      };
      reactions.push(reaction);
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    availableEffectById: effectById,
    stickers: {
      ...global.stickers,
      effect: {
        stickers,
        emojis
      }
    },
    reactions: {
      ...global.reactions,
      effectReactions: reactions
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('interactWithAnimatedEmoji', (global, actions, payload) => {
  const {
    emoji,
    x,
    y,
    startSize,
    isReversed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const activeEmojiInteraction = {
    id: interactionLocalId++,
    animatedEffect: emoji,
    x: (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.subtractXForEmojiInteraction)(global, x) + Math.random() * INTERACTION_RANDOM_OFFSET - INTERACTION_RANDOM_OFFSET / 2,
    y: y + Math.random() * INTERACTION_RANDOM_OFFSET - INTERACTION_RANDOM_OFFSET / 2,
    startSize,
    isReversed
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: [...((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).activeEmojiInteractions || []), activeEmojiInteraction]
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendEmojiInteraction', (global, actions, payload) => {
  const {
    messageId,
    chatId,
    emoji,
    interactions
  } = payload;
  if (global.connectionState !== 'connectionStateReady') return;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat || !emoji || (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId)) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendEmojiInteraction', {
    chat,
    messageId,
    emoticon: emoji,
    timestamps: interactions
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendDefaultReaction', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const reaction = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectDefaultReaction)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!reaction || !message || (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isMessageLocal)(message)) return;
  actions.toggleReaction({
    chatId,
    messageId,
    reaction,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('toggleReaction', async (global, actions, payload) => {
  const {
    chatId,
    reaction,
    shouldAddToRecent,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  let {
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  let message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const isInSaved = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId);
  const isInDocumentGroup = Boolean(message.groupedId) && !message.isInAlbum;
  const documentGroupFirstMessageId = isInDocumentGroup ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectMessageIdsByGroupId)(global, chatId, message.groupedId)[0] : undefined;
  message = isInDocumentGroup ? (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, documentGroupFirstMessageId) || message : message;
  messageId = message?.id || messageId;
  const userReactions = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getUserReactions)(message);
  const hasReaction = userReactions.some(userReaction => (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(userReaction, reaction));
  const newUserReactions = hasReaction ? userReactions.filter(userReaction => !(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(userReaction, reaction)) : [...userReactions, reaction];
  const limit = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectMaxUserReactions)(global);
  const [paidReactions, regularReactions] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.partition)(newUserReactions, r => r.type === 'paid');
  const trimmedRegularReactions = regularReactions.slice(-limit);
  const localReactions = [...paidReactions, ...trimmedRegularReactions];
  const messageKey = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message);
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) {
    if (hasReaction) {
      actions.stopActiveReaction({
        containerId: messageKey,
        reaction,
        tabId
      });
    } else {
      actions.startActiveReaction({
        containerId: messageKey,
        reaction,
        tabId
      });
    }
  }
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.addMessageReaction)(global, message, localReactions);
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  try {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendReaction', {
      chat,
      messageId,
      reactions: trimmedRegularReactions,
      shouldAddToRecent
    });
    if (isInSaved) {
      actions.loadSavedReactionTags();
    }
  } catch (error) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.addMessageReaction)(global, message, userReactions);
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('addLocalPaidReaction', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    count,
    shouldIgnoreDefaultPrivacy = false,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const defaultPrivacy = global.settings.paidReactionPrivacy;
  const isPrivate = !shouldIgnoreDefaultPrivacy ? defaultPrivacy?.type === 'anonymous' : payload.isPrivate;
  const peerId = !shouldIgnoreDefaultPrivacy ? defaultPrivacy?.type === 'peer' ? defaultPrivacy.peerId : undefined : payload.peerId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const currentReactions = message.reactions?.results || [];
  const newReactions = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.addPaidReaction)(currentReactions, count, isPrivate, peerId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateChatMessage)(global, message.chatId, message.id, {
    reactions: {
      ...currentReactions,
      results: newReactions
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  const messageKey = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message);
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) {
    actions.startActiveReaction({
      containerId: messageKey,
      reaction: {
        type: 'paid'
      },
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendPaidReaction', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    forcedAmount,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const paidReaction = message.reactions?.results?.find(r => r.reaction.type === 'paid');
  const count = forcedAmount || paidReaction?.localAmount || 0;
  if (!count) {
    return;
  }
  actions.resetLocalPaidReactions({
    chatId,
    messageId
  });
  try {
    await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendPaidReaction', {
      chat,
      messageId,
      count,
      isPrivate: paidReaction?.localIsPrivate,
      peerId: paidReaction?.localPeerId
    });
  } catch (error) {
    if (error.message === 'BALANCE_TOO_LOW') {
      actions.openStarsBalanceModal({
        originReaction: {
          chatId,
          messageId,
          amount: count
        },
        tabId
      });
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('startActiveReaction', (global, actions, payload) => {
  const {
    containerId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) return undefined;
  const currentActiveReactions = tabState.activeReactions[containerId] || [];
  if (currentActiveReactions.some(active => (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(active, reaction))) {
    return undefined;
  }
  const newActiveReactions = currentActiveReactions.concat(reaction);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeReactions: {
      ...tabState.activeReactions,
      [containerId]: newActiveReactions
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('stopActiveReaction', (global, actions, payload) => {
  const {
    containerId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  const currentActiveReactions = tabState.activeReactions[containerId] || [];
  // Remove all reactions if reaction is not specified
  const newMessageActiveReactions = reaction ? currentActiveReactions.filter(active => !(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.isSameReaction)(active, reaction)) : [];
  const newActiveReactions = newMessageActiveReactions.length ? {
    ...tabState.activeReactions,
    [containerId]: newMessageActiveReactions
  } : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.omit)(tabState.activeReactions, [containerId]);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeReactions: newActiveReactions
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('setDefaultReaction', async (global, actions, payload) => {
  const {
    reaction
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('setDefaultReaction', {
    reaction
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  if (!global.config) {
    actions.loadConfig(); // Refetch new config, if it is somehow not loaded
    return;
  }
  global = {
    ...global,
    config: {
      ...global.config,
      defaultReaction: reaction
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('stopActiveEmojiInteraction', (global, actions, payload) => {
  const {
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId).activeEmojiInteractions?.filter(active => active.id !== id)
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadReactors', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsCurrentUserFrozen)(global)) return;
  const {
    chatId,
    messageId,
    reaction
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chatId, messageId);
  if (!chat || !message) {
    return;
  }
  const offset = message.reactors?.nextOffset;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchMessageReactionsList', {
    reaction,
    chat,
    messageId,
    offset
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateChatMessage)(global, chatId, messageId, {
    reactors: result
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadMessageReactions', (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsCurrentUserFrozen)(global)) return;
  const {
    ids,
    chatId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat || global.connectionState !== 'connectionStateReady') {
    return;
  }
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchMessageReactions', {
    ids,
    chat
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('sendWatchingEmojiInteraction', (global, actions, payload) => {
  const {
    chatId,
    emoticon,
    x,
    y,
    startSize,
    isReversed,
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectTabState)(global, tabId);
  if (!chat || !tabState.activeEmojiInteractions?.some(interaction => interaction.id === id) || (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectIsChatWithSelf)(global, chatId)) {
    return undefined;
  }
  if (global.connectionState === 'connectionStateReady') {
    (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('sendWatchingEmojiInteraction', {
      chat,
      emoticon
    });
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_12__.updateTabState)(global, {
    activeEmojiInteractions: tabState.activeEmojiInteractions.map(activeEmojiInteraction => {
      if (activeEmojiInteraction.id === id) {
        return {
          ...activeEmojiInteraction,
          x: (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.subtractXForEmojiInteraction)(global, x),
          y,
          startSize,
          isReversed
        };
      }
      return activeEmojiInteraction;
    })
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('fetchUnreadReactions', async (global, actions, payload) => {
  const {
    chatId,
    offsetId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchUnreadReactions', {
    chat,
    offsetId,
    addOffset: offsetId ? -1 : undefined
  });

  // Server side bug, when server returns unread reactions count > 0 for deleted messages
  if (!result || !result.messages.length) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: 0
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
    return;
  }
  const {
    messages
  } = result;
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByKey)(messages, 'id');
  const ids = Object.keys(byId).map(Number);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.addChatMessagesById)(global, chat.id, byId);
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chatId, {
    unreadReactions: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.unique)([...(chat.unreadReactions || []), ...ids]).sort((a, b) => b - a)
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('animateUnreadReaction', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentChat)(global, tabId);
  if (!chat) return undefined;
  if (!chat.unreadReactionsCount) {
    return (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
      unreadReactions: []
    });
  }
  const unreadReactionsCount = Math.max(chat.unreadReactionsCount - messageIds.length, 0);
  const unreadReactions = (chat.unreadReactions || []).filter(id => !messageIds.includes(id));
  global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
    unreadReactions,
    unreadReactionsCount
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
  actions.markMessagesRead({
    messageIds,
    shouldFetchUnreadReactions: true,
    tabId
  });
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectPerformanceSettingsValue)(global, 'reactionEffects')) return undefined;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  messageIds.forEach(id => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChatMessage)(global, chat.id, id);
    if (!message) return;
    const {
      reaction,
      isOwn,
      isUnread
    } = message.reactions?.recentReactions?.[0] ?? {};
    if (reaction && isUnread && !isOwn) {
      const messageKey = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message);
      actions.startActiveReaction({
        containerId: messageKey,
        reaction,
        tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
      });
    }
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('focusNextReaction', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectCurrentChat)(global, tabId);
  if (!chat?.unreadReactions) {
    if (chat?.unreadReactionsCount) {
      return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updateChat)(global, chat.id, {
        unreadReactionsCount: 0
      });
    }
    return undefined;
  }
  actions.focusMessage({
    chatId: chat.id,
    messageId: chat.unreadReactions[0],
    tabId,
    scrollTargetPosition: 'end'
  });
  actions.markMessagesRead({
    messageIds: [chat.unreadReactions[0]],
    tabId
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('readAllReactions', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_13__.selectChat)(global, chatId);
  if (!chat) return undefined;
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('readAllReactions', {
    chat,
    threadId: threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID ? undefined : threadId
  });
  if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
    return (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_11__.updateUnreadReactions)(global, chat.id, {
      unreadReactionsCount: undefined,
      unreadReactions: undefined
    });
  }

  // TODO[Forums]: Support unread reactions in threads
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadTopReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchTopReactions', {
    hash: global.reactions.hash.topReactions
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      topReactions: result.reactions,
      hash: {
        ...global.reactions.hash,
        topReactions: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadRecentReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchRecentReactions', {
    hash: global.reactions.hash.recentReactions
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      recentReactions: result.reactions,
      hash: {
        ...global.reactions.hash,
        recentReactions: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('clearRecentReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('clearRecentReactions');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      recentReactions: []
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadDefaultTagReactions', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchDefaultTagReactions', {
    hash: global.reactions.hash.defaultTags
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  global = {
    ...global,
    reactions: {
      ...global.reactions,
      defaultTags: result.reactions,
      hash: {
        ...global.reactions.hash,
        defaultTags: result.hash
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('loadSavedReactionTags', async global => {
  const {
    hash
  } = global.savedReactionTags || {};
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('fetchSavedReactionTags', {
    hash
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  const tagsByKey = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.buildCollectionByCallback)(result.tags, tag => [(0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getReactionKey)(tag.reaction), tag]);
  global = {
    ...global,
    savedReactionTags: {
      hash: result.hash,
      byKey: tagsByKey
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_9__.addActionHandler)('editSavedReactionTag', async (global, actions, payload) => {
  const {
    reaction,
    title
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('updateSavedReactionTag', {
    reaction,
    title
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_9__.getGlobal)();
  const tagsByKey = global.savedReactionTags?.byKey;
  if (!tagsByKey) return;
  const key = (0,_helpers__WEBPACK_IMPORTED_MODULE_8__.getReactionKey)(reaction);
  const tag = tagsByKey[key];
  const newTag = {
    ...tag,
    title
  };
  global = {
    ...global,
    savedReactionTags: {
      ...global.savedReactionTags,
      byKey: {
        ...tagsByKey,
        [key]: newTag
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_9__.setGlobal)(global);
});

/***/ },

/***/ "./src/global/actions/api/stars.ts"
/*!*****************************************!*\
  !*** ./src/global/actions/api/stars.ts ***!
  \*****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers_payments__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");









(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadStarStatus', async global => {
  const currentStarsStatus = global.stars;
  const needsTopupOptions = !currentStarsStatus?.topupOptions;
  const [starsStatus, tonStatus, topupOptions] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStarsStatus'), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStarsStatus', {
    isTon: true
  }), needsTopupOptions ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStarsTopupOptions') : undefined]);
  if (!(starsStatus || tonStatus) || needsTopupOptions && !topupOptions) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  if (starsStatus && starsStatus.balance.currency === _config__WEBPACK_IMPORTED_MODULE_0__.STARS_CURRENCY_CODE) {
    global = {
      ...global,
      stars: {
        ...currentStarsStatus,
        balance: starsStatus.balance,
        topupOptions: topupOptions || currentStarsStatus.topupOptions,
        history: {
          all: undefined,
          inbound: undefined,
          outbound: undefined
        },
        subscriptions: undefined
      }
    };
    if (starsStatus.history) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.appendStarsTransactions)(global, 'all', starsStatus.history, starsStatus.nextHistoryOffset);
    }
    if (starsStatus.subscriptions) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.appendStarsSubscriptions)(global, starsStatus.subscriptions, starsStatus.nextSubscriptionOffset);
    }
  }
  if (tonStatus?.balance.currency === _config__WEBPACK_IMPORTED_MODULE_0__.TON_CURRENCY_CODE) {
    global = {
      ...global,
      ton: {
        ...tonStatus,
        balance: tonStatus.balance,
        history: {
          all: undefined,
          inbound: undefined,
          outbound: undefined
        }
      }
    };
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateStarsBalance)(global, tonStatus.balance);
    if (tonStatus.history) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.appendStarsTransactions)(global, 'all', tonStatus.history, tonStatus.nextHistoryOffset, true);
    }
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadStarsTransactions', async (global, actions, payload) => {
  const {
    type,
    isTon
  } = payload;
  const history = isTon ? global.ton?.history[type] : global.stars?.history[type];
  const offset = history?.nextOffset;
  if (history && !offset) return; // Already loaded all

  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStarsTransactions', {
    isInbound: type === 'inbound',
    isOutbound: type === 'outbound',
    offset: offset || '',
    isTon
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateStarsBalance)(global, result.balance);
  if (result.history) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.appendStarsTransactions)(global, type, result.history, result.nextOffset, isTon);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadStarGifts', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStarGifts');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(result.gifts, 'id');
  const idsByCategoryName = {
    all: [],
    stock: [],
    limited: [],
    resale: []
  };
  const allStarGiftIds = Object.keys(byId);
  const allStarGifts = Object.values(byId);
  const limitedStarGiftIds = allStarGifts.map(gift => gift.isLimited ? gift.id : undefined).filter(Boolean);
  const stockedStarGiftIds = allStarGifts.map(gift => gift.availabilityRemains || !gift.availabilityTotal ? gift.id : undefined).filter(Boolean);
  const resaleStarGiftIds = allStarGifts.map(gift => gift.availabilityResale ? gift.id : undefined).filter(Boolean);
  idsByCategoryName.all = allStarGiftIds;
  idsByCategoryName.limited = limitedStarGiftIds;
  idsByCategoryName.stock = stockedStarGiftIds;
  idsByCategoryName.resale = resaleStarGiftIds;
  allStarGifts.forEach(gift => {
    const starsCategory = gift.stars;
    if (!idsByCategoryName[starsCategory]) {
      idsByCategoryName[starsCategory] = [];
    }
    idsByCategoryName[starsCategory].push(gift.id);
  });
  global = {
    ...global,
    starGifts: {
      byId,
      idsByCategory: idsByCategoryName
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updateResaleGiftsFilter', (global, actions, payload) => {
  const {
    filter,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    resaleGifts: {
      ...tabState.resaleGifts,
      filter
    }
  }, tabId);
  if (tabState.resaleGifts.giftId) {
    actions.loadResaleGifts({
      giftId: tabState.resaleGifts.giftId,
      shouldRefresh: true,
      tabId
    });
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadResaleGifts', async (global, actions, payload) => {
  const {
    giftId,
    shouldRefresh,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  let tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  if (tabState.resaleGifts.isLoading || tabState.resaleGifts.isAllLoaded && !shouldRefresh) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    resaleGifts: {
      ...tabState.resaleGifts,
      isLoading: true,
      ...(shouldRefresh && {
        count: 0,
        nextOffset: undefined,
        isAllLoaded: false
      })
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const nextOffset = tabState.resaleGifts.nextOffset;
  const attributesHash = tabState.resaleGifts.attributesHash;
  const filter = tabState.resaleGifts.filter;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchResaleGifts', {
    giftId,
    offset: nextOffset,
    limit: _config__WEBPACK_IMPORTED_MODULE_0__.RESALE_GIFTS_LIMIT,
    attributesHash,
    filter
  });
  if (!result) {
    return;
  }
  ;
  const {
    chats,
    users
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const currentGifts = tabState.resaleGifts.gifts;
  const newGifts = !shouldRefresh ? currentGifts.concat(result.gifts) : result.gifts;
  const currentUpdateIteration = tabState.resaleGifts.updateIteration;
  const shouldUpdateIteration = tabState.resaleGifts.giftId !== giftId || shouldRefresh;
  const updateIteration = shouldUpdateIteration ? currentUpdateIteration + 1 : currentUpdateIteration;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    resaleGifts: {
      ...tabState.resaleGifts,
      giftId,
      count: result.count || tabState.resaleGifts.count,
      gifts: newGifts,
      attributes: result.attributes || tabState.resaleGifts.attributes,
      counters: result.counters || tabState.resaleGifts.counters,
      attributesHash: result.attributesHash,
      nextOffset: result.nextOffset,
      isLoading: false,
      isAllLoaded: !result.nextOffset,
      updateIteration
    }
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(chats, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('resetResaleGifts', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    resaleGifts: {
      updateIteration: tabState.resaleGifts.updateIteration + 1,
      filter: _config__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_RESALE_GIFTS_FILTER_OPTIONS,
      count: 0,
      gifts: []
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadPeerSavedGifts', async (global, actions, payload) => {
  const {
    peerId,
    shouldRefresh,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  if (!peer) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const currentGifts = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerSavedGifts)(global, peerId, tabId);
  const localNextOffset = currentGifts?.nextOffset;
  if (!shouldRefresh && currentGifts && !localNextOffset) return; // Already loaded all

  const fetchingFilter = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectGiftProfileFilter)(global, peerId, tabId);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchSavedStarGifts', {
    peer,
    offset: !shouldRefresh ? localNextOffset : '',
    filter: fetchingFilter
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const currentFilter = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectGiftProfileFilter)(global, peerId, tabId);
  if (!result || currentFilter !== fetchingFilter) {
    return;
  }
  const newGifts = currentGifts && !shouldRefresh ? currentGifts.gifts.concat(result.gifts) : result.gifts;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.replacePeerSavedGifts)(global, peerId, newGifts, result.nextOffset, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('reloadPeerSavedGifts', (global, actions, payload) => {
  const {
    peerId
  } = payload;
  Object.values(global.byTabId).forEach(tabState => {
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerSavedGifts)(global, peerId, tabState.id)) {
      actions.loadPeerSavedGifts({
        peerId,
        shouldRefresh: true,
        tabId: tabState.id
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('loadStarsSubscriptions', async global => {
  const subscriptions = global.stars?.subscriptions;
  const offset = subscriptions?.nextOffset;
  if (subscriptions && !offset) return; // Already loaded all

  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateStarsSubscriptionLoading)(global, true);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStarsSubscriptions', {
    offset: offset || ''
  });
  if (!result || result.balance.currency !== _config__WEBPACK_IMPORTED_MODULE_0__.STARS_CURRENCY_CODE) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateStarsBalance)(global, result.balance);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.appendStarsSubscriptions)(global, result.subscriptions, result.nextOffset);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('changeStarsSubscription', async (global, actions, payload) => {
  const {
    peerId,
    id,
    isCancelled
  } = payload;
  const peer = peerId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId) : undefined;
  if (peerId && !peer) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('changeStarsSubscription', {
    peer,
    subscriptionId: id,
    isCancelled
  });
  actions.loadStarStatus();
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('fulfillStarsSubscription', async (global, actions, payload) => {
  const {
    peerId,
    id
  } = payload;
  const peer = peerId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId) : undefined;
  if (peerId && !peer) return;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fulfillStarsSubscription', {
    peer,
    subscriptionId: id
  });
  actions.loadStarStatus();
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('changeGiftVisibility', async (global, actions, payload) => {
  const {
    gift,
    shouldUnsave,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peerId = gift.type === 'user' ? global.currentUserId : gift.chatId;
  const requestInputGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.getRequestInputSavedStarGift)(global, gift);
  if (!requestInputGift) return;
  const oldGifts = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).savedGifts.giftsByPeerId[peerId];
  if (oldGifts?.gifts?.length) {
    const newGifts = oldGifts.gifts.map(g => {
      if (g.inputGift && (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.areInputSavedGiftsEqual)(g.inputGift, gift)) {
        return {
          ...g,
          isUnsaved: shouldUnsave
        };
      }
      return g;
    });
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.replacePeerSavedGifts)(global, peerId, newGifts, oldGifts.nextOffset, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('saveStarGift', {
    inputGift: requestInputGift,
    shouldUnsave
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.replacePeerSavedGifts)(global, peerId, oldGifts.gifts, oldGifts.nextOffset, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
    return;
  }

  // Reload gift list to avoid issues with pagination
  Object.values(global.byTabId).forEach(tabState => {
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerSavedGifts)(global, peerId, tabId)) {
      actions.loadPeerSavedGifts({
        peerId,
        shouldRefresh: true,
        tabId: tabState.id
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('convertGiftToStars', async (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const requestInputGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.getRequestInputSavedStarGift)(global, gift);
  if (!requestInputGift) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('convertStarGift', {
    inputSavedGift: requestInputGift
  });
  if (!result) {
    return;
  }
  const peerId = gift.type === 'user' ? global.currentUserId : gift.chatId;
  Object.values(global.byTabId).forEach(tabState => {
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerSavedGifts)(global, peerId, tabState.id)) {
      actions.loadPeerSavedGifts({
        peerId,
        shouldRefresh: true,
        tabId: tabState.id
      });
    }
  });
  actions.openStarsBalanceModal({
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openGiftUpgradeModal', async (global, actions, payload) => {
  const {
    giftId,
    gift,
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const samples = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('fetchStarGiftUpgradePreview', {
    giftId
  });
  if (!samples) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    giftUpgradeModal: {
      recipientId: peerId,
      gift,
      sampleAttributes: samples
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('toggleSavedGiftPinned', async (global, actions, payload) => {
  const {
    gift,
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  if (!peer) return;
  const savedGifts = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerSavedGifts)(global, peerId, tabId);
  if (!savedGifts) return;
  const pinLimit = global.appConfig?.savedGiftPinLimit;
  const currentPinnedGifts = savedGifts.gifts.filter(g => g.isPinned);
  const newPinnedGifts = gift.isPinned ? currentPinnedGifts.filter(g => g.gift.slug !== gift.gift.slug) : [...currentPinnedGifts, gift];
  const trimmedPinnedGifts = pinLimit ? newPinnedGifts.slice(-pinLimit) : newPinnedGifts;
  const inputSavedGifts = trimmedPinnedGifts.map(g => (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.getRequestInputSavedStarGift)(global, g.inputGift)).filter(Boolean);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('toggleSavedGiftPinned', {
    inputSavedGifts,
    peer
  });
  if (!result) return;
  Object.values(global.byTabId).forEach(tabState => {
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerSavedGifts)(global, peerId, tabState.id)) {
      actions.loadPeerSavedGifts({
        peerId,
        shouldRefresh: true,
        tabId: tabState.id
      });
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updateStarGiftPrice', async (global, actions, payload) => {
  const {
    gift,
    price
  } = payload;
  const requestSavedGift = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.getRequestInputSavedStarGift)(global, gift);
  if (!requestSavedGift) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_3__.callApi)('updateStarGiftPrice', {
    inputSavedGift: requestSavedGift,
    price
  });
  if (!result) return;
  actions.reloadPeerSavedGifts({
    peerId: global.currentUserId
  });
});

/***/ },

/***/ "./src/global/actions/api/statistics.ts"
/*!**********************************************!*\
  !*** ./src/global/actions/api/statistics.ts ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadStatistics', async (global, actions, payload) => {
  const {
    chatId,
    isGroup,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)(isGroup ? 'fetchGroupStatistics' : 'fetchChannelStatistics', {
    chat,
    dcId: fullInfo.statisticsDcId
  });
  if (!result) {
    return;
  }
  const {
    stats
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStatistics)(global, chatId, stats, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (stats.type === 'channel') {
    const messageInteractions = stats.recentPosts.filter(post => post.type === 'message');
    const storyInteractions = stats.recentPosts.filter(post => post.type === 'story');
    if (messageInteractions.length > 0) {
      actions.loadMessagesById({
        chatId,
        messageIds: messageInteractions.map(interaction => interaction.msgId)
      });
    }
    if (storyInteractions.length > 0) {
      actions.loadPeerStoriesByIds({
        peerId: chatId,
        storyIds: storyInteractions.map(interaction => interaction.storyId)
      });
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadChannelMonetizationStatistics', async (global, actions, payload) => {
  const {
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId);
  const chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, peerId);
  if (!peer) {
    return;
  }
  const dcId = chatFullInfo?.statisticsDcId;
  const stats = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchChannelMonetizationStatistics', {
    peer,
    dcId
  });
  if (!stats) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateChannelMonetizationStatistics)(global, stats, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadMessageStatistics', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  let result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchMessageStatistics', {
    chat,
    messageId,
    dcId
  });
  if (!result) {
    result = {};
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  const {
    viewsCount,
    forwardsCount,
    reactions
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessages)(global, chatId)[messageId] || {};
  result.viewsCount = viewsCount;
  result.forwardsCount = forwardsCount;
  result.reactionsCount = reactions?.results ? reactions?.results.reduce((acc, reaction) => acc + reaction.count, 0) : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateMessageStatistics)(global, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  actions.loadMessagePublicForwards({
    chatId,
    messageId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadMessagePublicForwards', async (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const stats = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).statistics.currentMessage || {};
  if (stats?.publicForwards && !stats.nextOffset) return;
  const publicForwards = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchMessagePublicForwards', {
    chat,
    messageId,
    dcId,
    offset: stats.nextOffset
  });
  const {
    forwards,
    nextOffset,
    count
  } = publicForwards || {};
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateMessageStatistics)(global, {
    ...stats,
    publicForwards: count || forwards?.length,
    publicForwardsData: (stats.publicForwardsData || []).concat(forwards || []),
    nextOffset
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadStatisticsAsyncGraph', async (global, actions, payload) => {
  const {
    chatId,
    token,
    name,
    isPercentage,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchStatisticsAsyncGraph', {
    token,
    dcId,
    isPercentage
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStatisticsGraph)(global, chatId, name, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadStoryStatistics', async (global, actions, payload) => {
  const {
    chatId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  let result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchStoryStatistics', {
    chat,
    storyId,
    dcId
  });
  if (!result) {
    result = {};
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerStory)(global, chatId, storyId);
  const {
    forwardsCount = 0,
    viewsCount = 0,
    reactionsCount = 0
  } = story && 'views' in story && story.views ? story.views : {};
  result.viewsCount = viewsCount;
  result.forwardsCount = forwardsCount;
  result.reactionsCount = reactionsCount;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStoryStatistics)(global, result, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  actions.loadStoryPublicForwards({
    chatId,
    storyId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadStoryPublicForwards', async (global, actions, payload) => {
  const {
    chatId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, chatId);
  if (!chat || !fullInfo) {
    return;
  }
  const dcId = fullInfo.statisticsDcId;
  const stats = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).statistics.currentStory || {};
  if (stats?.publicForwards && !stats.nextOffset) return;
  const {
    publicForwards,
    count,
    nextOffset
  } = (await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchStoryPublicForwards', {
    chat,
    storyId,
    dcId,
    offset: stats.nextOffset
  })) || {};
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStoryStatistics)(global, {
    ...stats,
    publicForwards: count || publicForwards?.length,
    publicForwardsData: (stats.publicForwardsData || []).concat(publicForwards || []),
    nextOffset
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('processMonetizationRevenueWithdrawalUrl', async (global, actions, payload) => {
  const {
    peerId,
    currentPassword,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateVerifyMonetizationModal)(global, {
    isLoading: true
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchMonetizationRevenueWithdrawalUrl', {
    peer,
    currentPassword
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateVerifyMonetizationModal)(global, {
    isLoading: false,
    errorKey: 'error' in result ? result.messageKey : undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if ('url' in result) {
    actions.openUrl({
      url: result.url,
      shouldSkipModal: true,
      tabId,
      ignoreDeepLinks: true
    });
    actions.closeMonetizationVerificationModal({
      tabId
    });
  }
});

/***/ },

/***/ "./src/global/actions/api/stories.ts"
/*!*******************************************!*\
  !*** ./src/global/actions/api/stories.ts ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");










const INFINITE_LOOP_MARKER = 100;
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadAllStories', async global => {
  let i = 0;
  while (global.stories.hasNext) {
    if (i++ >= INFINITE_LOOP_MARKER) {
      if (_config__WEBPACK_IMPORTED_MODULE_0__.DEBUG) {
        // eslint-disable-next-line no-console
        console.error('`actions/loadAllStories`: Infinite loop detected');
      }
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    const {
      stateHash,
      hasNext
    } = global.stories;
    if (stateHash && !hasNext) {
      return;
    }
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchAllStories', {
      isFirstRequest: !stateHash,
      stateHash
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global.stories.stateHash = result.state;
    if ('peerStories' in result) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeersWithStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStealthMode)(global, result.stealthMode);
      global.stories.hasNext = result.hasMore;
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadAllHiddenStories', async global => {
  let i = 0;
  while (global.stories.hasNextInArchive) {
    if (i++ >= INFINITE_LOOP_MARKER) {
      if (_config__WEBPACK_IMPORTED_MODULE_0__.DEBUG) {
        // eslint-disable-next-line no-console
        console.error('`actions/loadAllHiddenStories`: Infinite loop detected');
      }
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    const {
      archiveStateHash,
      hasNextInArchive
    } = global.stories;
    if (archiveStateHash && !hasNextInArchive) {
      return;
    }
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchAllStories', {
      isFirstRequest: !archiveStateHash,
      stateHash: archiveStateHash,
      isHidden: true
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global.stories.archiveStateHash = result.state;
    if ('peerStories' in result) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeersWithStories)(global, result.peerStories);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStealthMode)(global, result.stealthMode);
      global.stories.hasNextInArchive = result.hasMore;
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadPeerSkippedStories', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || !peerStories) {
    return;
  }
  const skippedStoryIds = Object.values(peerStories.byId).reduce((acc, story) => {
    if (!('content' in story)) {
      acc.push(story.id);
    }
    return acc;
  }, []);
  if (skippedStoryIds.length === 0) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStoriesByIds', {
    peer,
    ids: skippedStoryIds
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories, result.pinnedIds);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('viewStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  if (!peer || !story || !('content' in story)) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateLastViewedStoryForPeer)(global, peerId, storyId, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const serverTime = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_3__.getServerTime)();
  if (story.expireDate < serverTime && story.isInProfile) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('viewStory', {
      peer,
      storyId
    });
  }
  const isUnread = (global.stories.byPeerId[peerId].lastReadId || 0) < story.id;
  if (!isUnread) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('markStoryRead', {
    peer,
    storyId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateLastReadStoryForPeer)(global, peerId, storyId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('deleteStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('deleteStory', {
    peer,
    storyId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.removePeerStory)(global, peerId, storyId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('toggleStoryInProfile', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    isInProfile
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  const currentIsPinned = story && 'content' in story ? story.isInProfile : undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStory)(global, peerId, storyId, {
    isInProfile
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerProfileStory)(global, peerId, storyId, isInProfile);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('toggleStoryInProfile', {
    peer,
    storyId,
    isInProfile
  });
  if (!result?.length) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStory)(global, peerId, storyId, {
      isInProfile: currentIsPinned
    });
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerProfileStory)(global, peerId, storyId, currentIsPinned);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('toggleStoryPinnedToTop', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || !peerStories) {
    return;
  }
  const oldPinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPinnedStories)(global, peerId)?.map(s => s.id) || [];
  const isRemoving = oldPinnedIds.includes(storyId);
  const newPinnedIds = isRemoving ? oldPinnedIds.filter(id => id !== storyId) : [...oldPinnedIds, storyId];
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = {
    ...global,
    stories: {
      ...global.stories,
      byPeerId: {
        ...global.stories.byPeerId,
        [peerId]: {
          ...peerStories,
          pinnedIds: newPinnedIds.sort((a, b) => b - a)
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('toggleStoryPinnedToTop', {
    peer,
    storyIds: newPinnedIds
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = {
      ...global,
      stories: {
        ...global.stories,
        byPeerId: {
          ...global.stories.byPeerId,
          [peerId]: {
            ...peerStories,
            pinnedIds: oldPinnedIds
          }
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadPeerStories', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStories', {
    peer
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories);
  if (result.lastReadStoryId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateLastReadStoryForPeer)(global, peerId, result.lastReadStoryId);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadPeerProfileStories', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId,
    offsetId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  let peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || peerStories?.isFullyLoaded) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerProfileStories', {
    peer,
    offsetId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories, result.pinnedIds);
  peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (Object.values(result.stories).length === 0 || peerStories?.profileIds?.length && peerStories?.profileIds.length >= result.count) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesFullyLoaded)(global, peerId, true);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoriesArchive', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId,
    offsetId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  let peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (!peer || peerStories?.isArchiveFullyLoaded) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoriesArchive', {
    peer,
    offsetId
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories, undefined, true);
  peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStories)(global, peerId);
  if (Object.values(result.stories).length === 0 || peerStories?.archiveIds?.length && peerStories?.archiveIds.length >= result.count) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesFullyLoaded)(global, peerId, true, true);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadPeerStoriesByIds', async (global, actions, payload) => {
  const {
    peerId,
    storyIds
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStoriesByIds', {
    peer,
    ids: storyIds
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addStoriesForPeer)(global, peerId, result.stories);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoryViews', async (global, actions, payload) => {
  const {
    peerId,
    storyId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoriesViews', {
    peer,
    storyIds: [storyId]
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoryViews)(global, peerId, storyId, result.views);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoryViewList', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    offset,
    areReactionsFirst,
    areJustContacts,
    query,
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStoryViewsLoading)(global, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoryViewList', {
    peer,
    storyId,
    offset,
    areReactionsFirst,
    areJustContacts,
    limit,
    query
  });
  if (!result) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStoryViewsLoading)(global, false, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateStoryViews)(global, storyId, result.views, result.nextOffset, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('reportStory', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    description = '',
    option = '',
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const response = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('reportStory', {
    peer,
    storyId,
    description,
    option
  });
  if (!response) return;
  const {
    result,
    error
  } = response;
  if (error === _config__WEBPACK_IMPORTED_MODULE_0__.MESSAGE_ID_REQUIRED_ERROR) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate)('lng_report_please_select_messages'),
      tabId
    });
    actions.closeReportModal({
      tabId
    });
    return;
  }
  if (!result) return;
  if (result.type === 'reported') {
    actions.showNotification({
      message: result ? (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate)('ReportPeer.AlertSuccess') : 'An error occurred while submitting your report. Please, try again later.',
      tabId
    });
    actions.closeReportModal({
      tabId
    });
    return;
  }
  if (result.type === 'selectOption') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId).reportModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options?.find(o => o.option === option);
    const newSection = {
      title: result.title,
      options: result.options,
      subtitle: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
      reportModal: {
        messageIds: [storyId],
        subject: 'story',
        peerId,
        description,
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
  if (result.type === 'comment') {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
    const oldSections = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectTabState)(global, tabId).reportModal?.sections;
    const selectedOption = oldSections?.[oldSections.length - 1]?.options?.find(o => o.option === option);
    const newSection = {
      isOptional: result.isOptional,
      option: result.option,
      title: selectedOption?.text
    };
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
      reportModal: {
        messageIds: [storyId],
        description,
        peerId,
        subject: 'story',
        sections: oldSections ? [...oldSections, newSection] : [newSection]
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('editStoryPrivacy', (global, actions, payload) => {
  const {
    peerId,
    storyId,
    privacy
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const allowedIds = [...privacy.allowUserIds, ...privacy.allowChatIds];
  const blockedIds = [...privacy.blockUserIds, ...privacy.blockChatIds];
  const inputPrivacy = (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.buildApiInputPrivacyRules)(global, {
    visibility: privacy.visibility,
    isUnspecified: privacy.isUnspecified,
    allowedIds,
    blockedIds,
    botsPrivacy: 'none'
  });
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('editStoryPrivacy', {
    peer,
    id: storyId,
    privacy: inputPrivacy
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('toggleStoriesHidden', async (global, actions, payload) => {
  const {
    peerId,
    isHidden
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('toggleStoriesHidden', {
    peer,
    isHidden
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesHidden)(global, peerId, isHidden);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('loadStoriesMaxIds', async (global, actions, payload) => {
  const {
    peerIds
  } = payload;
  const peers = peerIds.map(peerId => (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId)).filter(Boolean);
  if (!peers.length) return;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoriesMaxIds', {
    peers
  });
  if (!result) return;
  const peerIdsToLoad = [];
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  result.forEach((maxId, i) => {
    const peer = peers[i];
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeer)(global, peer.id, {
      maxStoryId: maxId,
      hasStories: maxId !== 0
    });
    if (maxId !== 0) {
      peerIdsToLoad.push(peer.id);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  peerIdsToLoad?.forEach(peerId => actions.loadPeerStories({
    peerId
  }));
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('sendStoryReaction', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    containerId,
    reaction,
    shouldAddToRecent,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeer)(global, peerId);
  if (!peer) return;
  const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectPeerStory)(global, peerId, storyId);
  if (!story || !('content' in story)) return;
  const previousReaction = story.sentReaction;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateSentStoryReaction)(global, peerId, storyId, reaction);
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
  if (reaction) {
    actions.startActiveReaction({
      containerId,
      reaction,
      tabId
    });
  } else {
    actions.stopActiveReaction({
      containerId,
      tabId
    });
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('sendStoryReaction', {
    peer,
    storyId,
    reaction,
    shouldAddToRecent
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
  if (!result) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateSentStoryReaction)(global, peerId, storyId, previousReaction);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('activateStealthMode', (global, actions, payload) => {
  const {
    isForPast = true,
    isForFuture = true
  } = payload || {};
  (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('activateStealthMode', {
    isForPast: isForPast || true,
    isForFuture: isForFuture || true
  });
});

/***/ },

/***/ "./src/global/actions/api/symbols.ts"
/*!*******************************************!*\
  !*** ./src/global/actions/api/symbols.ts ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_searchWords__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/searchWords */ "./src/util/searchWords.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_limits__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../selectors/limits */ "./src/global/selectors/limits.ts");













const ADDED_SETS_THROTTLE = 200;
const ADDED_SETS_THROTTLE_CHUNK = 10;
const searchThrottled = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.throttle)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickerSets', async (global, actions) => {
  const [addedStickers, addedCustomEmojis] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickerSets', {
    hash: global.stickers.added.hash
  }), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchCustomEmojiSets', {
    hash: global.customEmojis.added.hash
  })]);
  if (!addedCustomEmojis || !addedStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'added', addedStickers.hash, addedStickers.sets);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateCustomEmojiSets)(global, addedCustomEmojis.hash, addedCustomEmojis.sets);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  actions.loadCustomEmojis({
    ids: global.recentCustomEmojis
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadAddedStickers', async (global, actions) => {
  const {
    added: {
      setIds: addedSetIds = []
    },
    setsById: cached
  } = global.stickers;
  const {
    added: {
      setIds: customEmojiSetIds = []
    }
  } = global.customEmojis;
  const setIdsToLoad = [...addedSetIds, ...customEmojiSetIds];
  if (!setIdsToLoad.length) {
    return;
  }
  for (let i = 0; i < setIdsToLoad.length; i++) {
    const id = setIdsToLoad[i];
    if (cached[id]?.stickers) {
      continue; // Already loaded
    }
    actions.loadStickers({
      stickerSetInfo: {
        id,
        accessHash: cached[id].accessHash
      }
    });
    if (i % ADDED_SETS_THROTTLE_CHUNK === 0 && i > 0) {
      await (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.pause)(ADDED_SETS_THROTTLE);
    }
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadRecentStickers', global => {
  const {
    hash
  } = global.stickers.recent || {};
  void loadRecentStickers(global, hash);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFavoriteStickers', async global => {
  const {
    hash
  } = global.stickers.favorite || {};
  const favoriteStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFavoriteStickers', {
    hash
  });
  if (!favoriteStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      favorite: favoriteStickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPremiumStickers', async global => {
  const {
    hash
  } = global.stickers.premium || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserFrozen)(global)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
    emoji: '',
    hash
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      premium: {
        hash: result.hash,
        stickers: result.stickers
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadGreetingStickers', async global => {
  const {
    hash
  } = global.stickers.greeting || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserFrozen)(global)) {
    return;
  }
  const greeting = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
    emoji: '',
    hash
  });
  if (!greeting) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      greeting: {
        hash: greeting.hash,
        stickers: greeting.stickers.filter(sticker => sticker.emoji === '')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFeaturedStickers', async global => {
  const {
    hash
  } = global.stickers.featured || {};
  const featuredStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFeaturedStickers', {
    hash
  });
  if (!featuredStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'featured', featuredStickers.hash, featuredStickers.sets);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadPremiumGifts', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchPremiumGifts');
  if (!stickerSet) {
    return;
  }
  const {
    set,
    stickers
  } = stickerSet;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    premiumGifts: {
      ...set,
      stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadTonGifts', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchTonGifts');
  if (!stickerSet) {
    return;
  }
  const {
    set,
    stickers
  } = stickerSet;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    tonGifts: {
      ...set,
      stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadDefaultTopicIcons', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchDefaultTopicIcons');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  const fullSet = {
    ...set,
    stickers
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, fullSet.id, fullSet);
  global = {
    ...global,
    defaultTopicIconsId: fullSet.id
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadDefaultStatusIcons', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchDefaultStatusEmojis');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  const fullSet = {
    ...set,
    stickers
  };
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, fullSet.id, fullSet);
  global = {
    ...global,
    defaultStatusIconsId: fullSet.id
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadUserCollectibleStatuses', async (global, actions) => {
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const {
    hash
  } = global.collectibleEmojiStatuses || {};
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchCollectibleEmojiStatuses', {
    hash
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    collectibleEmojiStatuses: {
      hash: result.hash,
      statuses: result.statuses
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const documentIds = result.statuses.map(({
    documentId
  }) => documentId);
  actions.loadCustomEmojis({
    ids: documentIds
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickers', (global, actions, payload) => {
  const {
    stickerSetInfo
  } = payload;
  const cachedSet = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo);
  if (cachedSet && cachedSet.count === cachedSet?.stickers?.length) return; // Already fully loaded
  void loadStickers(global, actions, stickerSetInfo);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadAnimatedEmojis', async global => {
  const [emojis, effects] = await Promise.all([(0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchAnimatedEmojis'), (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchAnimatedEmojiEffects')]);
  if (!emojis || !effects) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.replaceAnimatedEmojis)(global, {
    ...emojis.set,
    stickers: emojis.stickers
  });
  global = {
    ...global,
    animatedEmojiEffects: {
      ...effects.set,
      stickers: effects.stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadBirthdayNumbersStickers', async global => {
  const emojis = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickers', {
    stickerSetInfo: {
      shortName: _config__WEBPACK_IMPORTED_MODULE_0__.BIRTHDAY_NUMBERS_SET
    }
  });
  if (!emojis) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    birthdayNumbers: {
      ...emojis.set,
      stickers: emojis.stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadRestrictedEmojiStickers', async global => {
  const emojis = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickers', {
    stickerSetInfo: {
      shortName: _config__WEBPACK_IMPORTED_MODULE_0__.RESTRICTED_EMOJI_SET
    }
  });
  if (!emojis) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    restrictedEmoji: {
      ...emojis.set,
      stickers: emojis.stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadGenericEmojiEffects', async global => {
  const stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchGenericEmojiEffects');
  if (!stickerSet) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const {
    set,
    stickers
  } = stickerSet;
  global = {
    ...global,
    genericEmojiEffects: {
      ...set,
      stickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadSavedGifs', async global => {
  const {
    hash
  } = global.gifs.saved;
  const savedGifs = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchSavedGifs', {
    hash
  });
  if (!savedGifs) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    gifs: {
      ...global.gifs,
      saved: savedGifs
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('saveGif', async (global, actions, payload) => {
  const {
    gif,
    shouldUnsave,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const length = global.gifs.saved.gifs?.length;
  const limit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectCurrentLimit)(global, 'savedGifs');
  const premiumLimit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectPremiumLimit)(global, 'savedGifs');
  const isPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserPremium)(global);
  if (!shouldUnsave && length && length >= limit) {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifs', limit.toString()),
      message: isPremium ? _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifsSubtitlePremium') : _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteGifsSubtitle', premiumLimit.toString()),
      ...(!isPremium && {
        action: {
          action: 'openPremiumModal',
          payload: {
            tabId
          }
        }
      }),
      className: 'bold-link',
      tabId
    });
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('saveGif', {
    gif,
    shouldUnsave
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const gifs = global.gifs.saved.gifs?.filter(({
    id
  }) => id !== gif.id) || [];
  const newGifs = shouldUnsave ? gifs : [gif, ...gifs];
  global = {
    ...global,
    gifs: {
      ...global.gifs,
      saved: {
        ...global.gifs.saved,
        gifs: newGifs
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('faveSticker', (global, actions, payload) => {
  const {
    sticker,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const current = global.stickers.favorite.stickers.length;
  const limit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectCurrentLimit)(global, 'stickersFaved');
  const premiumLimit = (0,_selectors_limits__WEBPACK_IMPORTED_MODULE_11__.selectPremiumLimit)(global, 'stickersFaved');
  const isPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsCurrentUserPremium)(global);
  if (current >= limit) {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickers', limit.toString()),
      message: isPremium ? _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickersSubtitlePremium') : _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LimitReachedFavoriteStickersSubtitle', premiumLimit.toString()),
      ...(!isPremium && {
        action: {
          action: 'openPremiumModal',
          payload: {
            tabId
          }
        }
      }),
      className: 'bold-link',
      tabId
    });
  }
  if (sticker) {
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('faveSticker', {
      sticker
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('unfaveSticker', (global, actions, payload) => {
  const {
    sticker
  } = payload;
  if (sticker) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();

    // Remove sticker preemptively to get instant feedback when user removes sticker
    // from favorites while in Sticker Picker
    global = {
      ...global,
      stickers: {
        ...global.stickers,
        favorite: {
          ...global.stickers.favorite,
          stickers: global.stickers.favorite.stickers.filter(({
            id
          }) => id !== sticker.id)
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('faveSticker', {
      sticker,
      unfave: true
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('removeRecentSticker', async (global, actions, payload) => {
  const {
    sticker
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('removeRecentSticker', {
    sticker
  });
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  loadRecentStickers(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearRecentStickers', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('clearRecentStickers');
  if (!result) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      recent: {
        stickers: []
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('toggleStickerSet', (global, actions, payload) => {
  const {
    stickerSetId
  } = payload;
  const stickerSet = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetId);
  if (!stickerSet) {
    return;
  }
  const {
    accessHash,
    installedDate,
    isArchived
  } = stickerSet;
  const isInstalled = !isArchived && Boolean(installedDate);
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)(!isInstalled ? 'installStickerSet' : 'uninstallStickerSet', {
    stickerSetId,
    accessHash
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadEmojiKeywords', async (global, actions, payload) => {
  const {
    language
  } = payload;
  let currentEmojiKeywords = global.emojiKeywords[language];
  if (currentEmojiKeywords?.isLoading) {
    return;
  }
  global = {
    ...global,
    emojiKeywords: {
      ...global.emojiKeywords,
      [language]: {
        ...currentEmojiKeywords,
        isLoading: true
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  const emojiKeywords = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchEmojiKeywords', {
    language,
    fromVersion: currentEmojiKeywords ? currentEmojiKeywords.version : 0
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  currentEmojiKeywords = global.emojiKeywords[language];
  if (!emojiKeywords) {
    global = {
      ...global,
      emojiKeywords: {
        ...global.emojiKeywords,
        [language]: {
          ...currentEmojiKeywords,
          isLoading: false
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    return;
  }
  global = {
    ...global,
    emojiKeywords: {
      ...global.emojiKeywords,
      [language]: {
        isLoading: false,
        version: emojiKeywords.version,
        keywords: {
          ...currentEmojiKeywords?.keywords,
          ...emojiKeywords.keywords
        }
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
async function loadRecentStickers(global, hash) {
  const recentStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchRecentStickers', {
    hash
  });
  if (!recentStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    stickers: {
      ...global.stickers,
      recent: recentStickers
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}
async function loadStickers(global, actions, stickerSetInfo) {
  let stickerSet;
  try {
    stickerSet = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickers', {
      stickerSetInfo
    });
  } catch (error) {
    if (error.message === 'STICKERSET_INVALID') {
      Object.values(global.byTabId).forEach(({
        id: tabId
      }) => {
        actions.showNotification({
          message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate)('StickerPack.ErrorNotFound'),
          tabId
        });
        if ('shortName' in stickerSetInfo && (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).openedStickerSetShortName === stickerSetInfo.shortName) {
          global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
            openedStickerSetShortName: undefined
          }, tabId);
          (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
        }
      });
      return;
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (!stickerSet) {
    // TODO handle this case when sticker cache is implemented
    return;
  }
  const {
    set,
    stickers,
    packs
  } = stickerSet;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSet)(global, set.id, {
    ...set,
    stickers,
    packs
  });
  const currentEmoji = global.stickers.forEmoji.emoji;
  if (currentEmoji && packs[currentEmoji]) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.rebuildStickersForEmoji)(global);
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('setStickerSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (query) {
    void searchThrottled(async () => {
      const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchStickers', {
        query
      });
      if (!result) {
        return;
      }
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      const {
        setsById,
        added
      } = global.stickers;
      const resultIds = result.sets.map(({
        id
      }) => id);
      if (added.setIds) {
        added.setIds.forEach(id => {
          if (!resultIds.includes(id)) {
            const {
              title
            } = setsById[id] || {};
            if (title && (0,_util_searchWords__WEBPACK_IMPORTED_MODULE_5__["default"])(title, query)) {
              resultIds.unshift(id);
            }
          }
        });
      }
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSets)(global, 'search', result.hash, result.sets);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickerSearch)(global, result.hash, resultIds, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('setGifSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (typeof query === 'string') {
    void searchThrottled(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      searchGifs(global, query, global.config?.gifSearchUsername, undefined, tabId);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('searchMoreGifs', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    query,
    offset
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).gifSearch;
  if (typeof query === 'string') {
    void searchThrottled(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      searchGifs(global, query, global.config?.gifSearchUsername, offset, tabId);
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadStickersForEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  const {
    hash
  } = global.stickers.forEmoji;
  void searchThrottled(async () => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = {
      ...global,
      stickers: {
        ...global.stickers,
        forEmoji: {
          ...global.stickers.forEmoji,
          emoji
        }
      }
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchStickersForEmoji', {
      emoji,
      hash
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    if (!result || global.stickers.forEmoji.emoji !== emoji) {
      return;
    }
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateStickersForEmoji)(global, emoji, result.stickers, result.hash);
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearStickersForEmoji', global => {
  return {
    ...global,
    stickers: {
      ...global.stickers,
      forEmoji: {}
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadCustomEmojiForEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateCustomEmojiForEmoji)(global, emoji);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('clearCustomEmojiForEmoji', global => {
  return {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      forEmoji: {}
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadFeaturedEmojiStickers', async global => {
  const featuredStickers = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchFeaturedEmojiStickers');
  if (!featuredStickers) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      featuredIds: featuredStickers.sets.map(({
        id
      }) => id),
      byId: {
        ...global.customEmojis.byId,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(featuredStickers.sets.flatMap(set => set.stickers || []), 'id')
      }
    },
    stickers: {
      ...global.stickers,
      setsById: {
        ...global.stickers.setsById,
        ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(featuredStickers.sets, 'id')
      }
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('openStickerSet', async (global, actions, payload) => {
  const {
    stickerSetInfo,
    shouldIgnoreCache,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  if (shouldIgnoreCache || !(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo)) {
    await loadStickers(global, actions, stickerSetInfo);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  const set = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectStickerSet)(global, stickerSetInfo);
  if (!set?.shortName) {
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
    openedStickerSetShortName: set.shortName
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('loadRecentEmojiStatuses', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('fetchRecentEmojiStatuses');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateRecentStatusCustomEmojis)(global, result.hash, result.emojiStatuses);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
});
async function searchGifs(global, query, botUsername, offset, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()]) {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_6__.callApi)('searchGifs', {
    query,
    offset,
    username: botUsername
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateGifSearch)(global, !offset, result.gifs, result.nextOffset, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
}

/***/ },

/***/ "./src/global/actions/api/sync.ts"
/*!****************************************!*\
  !*** ./src/global/actions/api/sync.ts ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teactn */ "./src/lib/teact/teactn.tsx");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const RELEASE_STATUS_TIMEOUT = 15000; // 15 sec;

let releaseStatusTimeout;
(0,_index__WEBPACK_IMPORTED_MODULE_7__.addActionHandler)('sync', (global, actions) => {
  if (_config__WEBPACK_IMPORTED_MODULE_2__.DEBUG) {
    // eslint-disable-next-line no-console
    console.log('>>> START SYNC');
  }
  if (releaseStatusTimeout) {
    clearTimeout(releaseStatusTimeout);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  global = {
    ...global,
    isSyncing: true
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);

  // Workaround for `isSyncing = true` sometimes getting stuck for some reason
  releaseStatusTimeout = window.setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    global = {
      ...global,
      isSyncing: false
    };
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    releaseStatusTimeout = undefined;
  }, RELEASE_STATUS_TIMEOUT);
  const {
    loadAllChats,
    preloadTopChatMessages
  } = actions;
  (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_3__.init)();
  loadAllChats({
    listType: 'active',
    whenFirstBatchDone: async () => {
      await loadAndReplaceMessages(global, actions);
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      global = {
        ...global,
        isSyncing: false,
        isSynced: true,
        isFetchingDifference: false
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
      if (_config__WEBPACK_IMPORTED_MODULE_2__.DEBUG) {
        // eslint-disable-next-line no-console
        console.log('>>> FINISH SYNC');
      }
      loadAllChats({
        listType: 'archived'
      });
      preloadTopChatMessages();
    }
  });
});
async function loadAndReplaceMessages(global, actions) {
  let areMessagesLoaded = false;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  let wasReset = false;

  // Memoize drafts
  const draftChatIds = Object.keys(global.messages.byChatId);
  const draftsByChatId = draftChatIds.reduce((acc, chatId) => {
    acc[chatId] = Object.keys(global.messages.byChatId[chatId].threadsById).reduce((acc2, threadId) => {
      acc2[Number(threadId)] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.omitUndefined)({
        draft: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectDraft)(global, chatId, Number(threadId)),
        editingId: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectEditingId)(global, chatId, Number(threadId)),
        editingDraft: (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectEditingDraft)(global, chatId, Number(threadId))
      });
      return acc2;
    }, {});
    return acc;
  }, {});

  // Memoize last messages
  const lastMessages = Object.entries(global.chats.lastMessageIds.all || {}).map(([chatId, messageId]) => (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, chatId, Number(messageId))).filter(Boolean);
  const savedLastMessages = Object.values(global.chats.lastMessageIds.saved || {}).map(messageId => (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, global.currentUserId, Number(messageId))).filter(Boolean);
  for (const {
    id: tabId
  } of Object.values(global.byTabId)) {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
    const {
      chatId: currentChatId,
      threadId: currentThreadId
    } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
    const activeThreadId = currentThreadId || _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID;
    const threadInfo = currentChatId && currentThreadId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectThreadInfo)(global, currentChatId, currentThreadId) : undefined;
    const currentChat = currentChatId ? global.chats.byId[currentChatId] : undefined;
    if (currentChatId && currentChat) {
      const [result, resultDiscussion] = await Promise.all([loadTopMessages(global, currentChatId, activeThreadId), activeThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID && !(0,_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(currentChat.id, activeThreadId, global.currentUserId) ? (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchDiscussionMessage', {
        chat: currentChat,
        messageId: Number(activeThreadId)
      }) : undefined]);
      global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
      const {
        chatId: newCurrentChatId
      } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
      if (result && newCurrentChatId === currentChatId) {
        const currentChatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessages)(global, currentChatId);
        const localMessages = currentChatId === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID ? global.serviceNotifications.filter(({
          isDeleted
        }) => !isDeleted).map(({
          message
        }) => message) : [];
        const topics = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTopics)(global, currentChatId);
        const topicLastMessages = topics ? Object.values(topics).map(({
          lastMessageId
        }) => currentChatMessages[lastMessageId]).filter(Boolean) : [];
        const resultMessageIds = result.messages.map(({
          id
        }) => id);
        const messagesThreadInfos = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.pick)(global.messages.byChatId[currentChatId].threadsById, resultMessageIds);
        const isDiscussionStartLoaded = !result.messages.length || result.messages.some(({
          id
        }) => id === resultDiscussion?.firstMessageId);
        const threadStartMessages = isDiscussionStartLoaded && resultDiscussion?.topMessages || [];
        const allMessages = threadStartMessages.concat(result.messages, localMessages);
        const allMessagesWithTopicLastMessages = allMessages.concat(topicLastMessages);
        const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(allMessagesWithTopicLastMessages, 'id');
        const listedIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)(allMessages.map(({
          id
        }) => id));
        if (!wasReset) {
          global = {
            ...global,
            messages: {
              ...global.messages,
              byChatId: {}
            }
          };
          Object.values(global.byTabId).forEach(({
            id: otherTabId
          }) => {
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
              tabThreads: {}
            }, otherTabId);
          });
          wasReset = true;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addChatMessagesById)(global, currentChatId, byId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateListedIds)(global, currentChatId, activeThreadId, listedIds);
        Object.entries(messagesThreadInfos).forEach(([id, thread]) => {
          if (!thread?.threadInfo) return;
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThreadInfo)(global, currentChatId, id, thread.threadInfo);
        });
        if (threadInfo && !threadInfo.isCommentsInfo && activeThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThreadInfo)(global, currentChatId, activeThreadId, {
            ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.pick)(threadInfo, ['fromChannelId', 'fromMessageId'])
          });
        }
        Object.values(global.byTabId).forEach(({
          id: otherTabId
        }) => {
          const {
            chatId: otherChatId,
            threadId: otherThreadId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, otherTabId) || {};
          if (otherChatId === currentChatId && otherThreadId === activeThreadId) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.safeReplaceViewportIds)(global, currentChatId, activeThreadId, listedIds, otherTabId);
          }
        });
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.chats, 'id'));
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.users, 'id'));
        areMessagesLoaded = true;
      }
    }
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
    if (currentChat?.isForum) {
      actions.loadTopics({
        chatId: currentChatId,
        force: true
      });
      if (currentThreadId && currentThreadId !== _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID) {
        actions.loadTopicById({
          chatId: currentChatId,
          topicId: Number(currentThreadId),
          shouldCloseChatOnError: true
        });
      }
    }
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_7__.getGlobal)();
  if (!areMessagesLoaded) {
    global = {
      ...global,
      messages: {
        ...global.messages,
        byChatId: {}
      }
    };
    Object.values(global.byTabId).forEach(({
      id: otherTabId
    }) => {
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
        tabThreads: {}
      }, otherTabId);
    });
  }

  // Restore drafts
  Object.keys(draftsByChatId).forEach(chatId => {
    const threads = draftsByChatId[chatId];
    Object.keys(threads).forEach(threadId => {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.updateThread)(global, chatId, Number(threadId), draftsByChatId[chatId][Number(threadId)]);
    });
  });

  // Restore last messages
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addMessages)(global, lastMessages);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_8__.addMessages)(global, savedLastMessages);
  (0,_index__WEBPACK_IMPORTED_MODULE_7__.setGlobal)(global);
  Object.values(global.byTabId).forEach(({
    id: tabId
  }) => {
    const {
      chatId: audioChatId,
      messageId: audioMessageId
    } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId).audioPlayer;
    if (audioChatId && audioMessageId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessage)(global, audioChatId, audioMessageId)) {
      actions.closeAudioPlayer({
        tabId
      });
    }
  });
}
function loadTopMessages(global, chatId, threadId) {
  const currentUserId = global.currentUserId;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(chatId, threadId, currentUserId);
  const realChatId = isSavedDialog ? String(threadId) : chatId;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, realChatId);
  return (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_5__.callApi)('fetchMessages', {
    chat,
    threadId,
    offsetId: !isSavedDialog ? chat.lastReadInboxMessageId : undefined,
    addOffset: -(Math.round(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE / 2) + 1),
    limit: _config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_LIST_SLICE,
    isSavedDialog
  });
}
let previousGlobal;
// RAF can be unreliable when device goes into sleep mode, so sync logic is handled outside any component
(0,_lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__.addCallback)(global => {
  const {
    connectionState,
    authState,
    isSynced
  } = global;
  const {
    isMasterTab
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global);
  if (!isMasterTab || isSynced || previousGlobal?.connectionState === connectionState && previousGlobal?.authState === authState) {
    previousGlobal = global;
    return;
  }
  if (connectionState === 'connectionStateReady' && authState === 'authorizationStateReady') {
    (0,_index__WEBPACK_IMPORTED_MODULE_7__.getActions)().sync();
  }
  previousGlobal = global;
});

/***/ },

/***/ "./src/global/actions/api/twoFaSettings.ts"
/*!*************************************************!*\
  !*** ./src/global/actions/api/twoFaSettings.ts ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('loadPasswordInfo', async global => {
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('getPasswordInfo');
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.replaceSettings)(global, {
    hasPassword: result.hasPassword
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    hint: result.hint
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('checkPassword', async (global, actions, payload) => {
  const {
    currentPassword,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: true,
    errorKey: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('checkPassword', currentPassword);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('clearPassword', async (global, actions, payload) => {
  const {
    currentPassword,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: true,
    errorKey: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('clearPassword', currentPassword);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updatePassword', async (global, actions, payload) => {
  const {
    currentPassword,
    password,
    hint,
    email,
    onSuccess
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: true,
    errorKey: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('updatePassword', currentPassword, password, hint, email);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: false
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateRecoveryEmail', async (global, actions, payload) => {
  const {
    currentPassword,
    email,
    onSuccess,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: true,
    errorKey: undefined
  });
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    recoveryEmail: email
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  const isSuccess = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('updateRecoveryEmail', currentPassword, email);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    isLoading: false,
    waitingEmailCodeLength: undefined
  });
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    recoveryEmail: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  if (isSuccess) {
    onSuccess();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('provideTwoFaEmailCode', (global, actions, payload) => {
  const {
    code
  } = payload;
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('provideRecoveryEmailCode', code);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('clearTwoFaError', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateTwoFaSettings)(global, {
    errorKey: undefined
  });
});

/***/ },

/***/ "./src/global/actions/api/users.ts"
/*!*****************************************!*\
  !*** ./src/global/actions/api/users.ts ***!
  \*****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _components_chatAssistant_store__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../components/chatAssistant/store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");















const PROFILE_PHOTOS_FIRST_LOAD_LIMIT = 10;
const TOP_PEERS_REQUEST_COOLDOWN = 60; // 1 min
const runThrottledForSearch = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_6__.throttle)(cb => cb(), 500, false);
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadFullUser', async (global, actions, payload) => {
  const {
    userId,
    withPhotos
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const {
    id,
    accessHash
  } = user;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchFullUser', {
    id,
    accessHash
  });
  if (!result?.user) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  const fullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUserFullInfo)(global, userId);
  const {
    user: newUser,
    fullInfo: newFullInfo
  } = result;
  const profilePhotos = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPeerPhotos)(global, userId);
  const hasChangedAvatar = user.avatarPhotoId !== newUser.avatarPhotoId;
  const hasChangedProfilePhoto = fullInfo?.profilePhoto?.id !== newFullInfo?.profilePhoto?.id;
  const hasChangedFallbackPhoto = fullInfo?.fallbackPhoto?.id !== newFullInfo?.fallbackPhoto?.id;
  const hasChangedPersonalPhoto = fullInfo?.personalPhoto?.id !== newFullInfo?.personalPhoto?.id;
  const hasChangedPhoto = hasChangedAvatar || hasChangedProfilePhoto || hasChangedFallbackPhoto || hasChangedPersonalPhoto;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUser)(global, userId, result.user);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUserFullInfo)(global, userId, result.fullInfo);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateChats)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(result.chats, 'id'));
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  if (withPhotos || profilePhotos?.count && hasChangedPhoto) {
    actions.loadMoreProfilePhotos({
      peerId: userId,
      shouldInvalidateCache: true
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadUser', async (global, actions, payload) => {
  const {
    userId
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchUsers', {
    users: [user]
  });
  if (!result) {
    return;
  }
  const {
    users,
    userStatusesById
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUsers)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.buildCollectionByKey)(users, 'id'));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.replaceUserStatuses)(global, {
    ...global.users.statusesById,
    ...userStatusesById
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadTopUsers', async global => {
  const {
    topPeers: {
      lastRequestedAt
    }
  } = global;
  if (!(!lastRequestedAt || (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)() - lastRequestedAt > TOP_PEERS_REQUEST_COOLDOWN)) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchTopUsers');
  if (!result) {
    return;
  }
  const {
    ids
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = {
    ...global,
    topPeers: {
      ...global.topPeers,
      userIds: ids,
      lastRequestedAt: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)()
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadContactList', async global => {
  const contactList = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchContactList');
  if (!contactList) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.addUserStatuses)(global, contactList.userStatusesById);

  // Sort contact list by Last Name (or First Name), with latin names being placed first
  const getCompareString = user => user.lastName || user.firstName || '';
  const collator = new Intl.Collator('en-US');
  const sortedUsers = contactList.users.sort((a, b) => collator.compare(getCompareString(a), getCompareString(b))).filter(user => !user.isSelf);

  // add contacts to db
  sortedUsers.forEach(user => {
    _components_chatAssistant_store__WEBPACK_IMPORTED_MODULE_10__.ChataiStores.contact?.addContact({
      id: user.id,
      name: `${user?.firstName || ''} ${user?.lastName || ''}`,
      phoneNumber: user.phoneNumber
    });
    _components_chatAssistant_store__WEBPACK_IMPORTED_MODULE_10__.ChataiStores.user?.addUser({
      id: user.id,
      name: `${user?.firstName || ''} ${user?.lastName || ''}`,
      phoneNumber: user.phoneNumber
    });
  });
  global = {
    ...global,
    contactList: {
      userIds: sortedUsers.map(user => user.id)
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadCurrentUser', () => {
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchCurrentUser');
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadCommonChats', async (global, actions, payload) => {
  const {
    userId
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsCurrentUserFrozen)(global)) {
    return;
  }
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, userId);
  const commonChats = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUserCommonChats)(global, userId);
  if (!user || (0,_helpers__WEBPACK_IMPORTED_MODULE_9__.isUserBot)(user) || commonChats?.isFullyLoaded) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchCommonChats', user, commonChats?.maxId);
  if (!result) {
    return;
  }
  const {
    chatIds,
    count
  } = result;
  const ids = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)((commonChats?.ids || []).concat(chatIds));
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUserCommonChats)(global, user.id, {
    maxId: chatIds.length ? chatIds[chatIds.length - 1] : undefined,
    ids,
    isFullyLoaded: ids.length >= count
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('toggleNoPaidMessagesException', async (global, actions, payload) => {
  const {
    userId,
    shouldRefundCharged
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('toggleNoPaidMessagesException', {
    user,
    shouldRefundCharged
  });
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUserFullInfo)(global, userId, {
    settings: undefined
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openChatRefundModal', async (global, actions, payload) => {
  const {
    userId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const starsAmount = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchPaidMessagesRevenue', {
    user
  });
  if (starsAmount === undefined) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    chatRefundModal: {
      userId,
      starsToRefund: starsAmount
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('updateContact', async (global, actions, payload) => {
  const {
    userId,
    isMuted = false,
    firstName,
    lastName,
    shouldSharePhoneNumber,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  actions.updateChatMutedState({
    chatId: userId,
    isMuted
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.InProgress, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  let result;
  if (!user.isContact && user.phoneNumber) {
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('importContact', {
      phone: user.phoneNumber,
      firstName,
      lastName
    });
  } else {
    const {
      id,
      accessHash
    } = user;
    result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('updateContact', {
      id,
      accessHash,
      phoneNumber: '',
      firstName,
      lastName,
      shouldSharePhoneNumber
    });
  }
  if (result) {
    actions.loadPeerSettings({
      peerId: userId
    });
    actions.loadPeerStories({
      peerId: userId
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUser)(global, user.id, {
      firstName,
      lastName
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateManagementProgress)(global, _types__WEBPACK_IMPORTED_MODULE_0__.ManagementProgress.Complete, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.closeNewContactDialog)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('deleteContact', async (global, actions, payload) => {
  const {
    userId
  } = payload;
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, userId);
  if (!user) {
    return;
  }
  const {
    id,
    accessHash
  } = user;
  await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('deleteContact', {
    id,
    accessHash
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadMoreProfilePhotos', async (global, actions, payload) => {
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsCurrentUserFrozen)(global)) return;
  const {
    peerId,
    shouldInvalidateCache,
    isPreload
  } = payload;
  const isPrivate = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_2__.isUserId)(peerId);
  const user = isPrivate ? (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, peerId) : undefined;
  const chat = !isPrivate ? (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChat)(global, peerId) : undefined;
  const peer = user || chat;
  if (chat && (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsChatRestricted)(global, peerId)) {
    return;
  }
  const profilePhotos = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPeerPhotos)(global, peerId);
  if (!peer?.avatarPhotoId) {
    return;
  }
  if (profilePhotos && !shouldInvalidateCache && (isPreload || !profilePhotos.nextOffset)) return;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePeerPhotosIsLoading)(global, peerId, true);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  let userFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUserFullInfo)(global, peerId);
  let chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectChatFullInfo)(global, peerId);
  if (user && !userFullInfo) {
    const {
      id,
      accessHash
    } = user;
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchFullUser', {
      id,
      accessHash
    });
    if (!result?.user) {
      return;
    }
    userFullInfo = result.fullInfo;
  }
  if (chat && !chatFullInfo) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchFullChat', chat);
    if (!result?.fullInfo) {
      return;
    }
    chatFullInfo = result.fullInfo;
  }
  const peerFullInfo = userFullInfo || chatFullInfo;
  if (!peerFullInfo) return;
  const offset = profilePhotos?.nextOffset;
  const limit = !offset || isPreload || shouldInvalidateCache ? PROFILE_PHOTOS_FIRST_LOAD_LIMIT : undefined;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchProfilePhotos', {
    peer,
    offset,
    limit
  });
  if (!result || !result.photos) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  const {
    photos,
    count,
    nextOffsetId
  } = result;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updatePeerPhotos)(global, peerId, {
    newPhotos: photos,
    count,
    nextOffset: nextOffsetId,
    fullInfo: peerFullInfo,
    shouldInvalidateCache
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('setUserSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (!query) return;
  void runThrottledForSearch(async () => {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('searchChats', {
      query
    });
    global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
    const currentSearchQuery = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectTabState)(global, tabId).userSearch.query;
    if (!result || !currentSearchQuery || query !== currentSearchQuery) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUserSearchFetchingStatus)(global, false, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
      return;
    }
    const {
      accountResultIds,
      globalResultIds
    } = result;
    const localUserIds = accountResultIds.filter(_util_entities_ids__WEBPACK_IMPORTED_MODULE_2__.isUserId);
    const globalUserIds = globalResultIds.filter(_util_entities_ids__WEBPACK_IMPORTED_MODULE_2__.isUserId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUserSearchFetchingStatus)(global, false, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUserSearch)(global, {
      localUserIds,
      globalUserIds
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('importContact', async (global, actions, payload) => {
  const {
    phoneNumber: phone,
    firstName,
    lastName,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('importContact', {
    phone,
    firstName,
    lastName
  });
  if (!result) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_5__.oldTranslate('Contacts.PhoneNumber.NotRegistred'),
      tabId
    });
    return;
  }
  actions.openChat({
    id: result,
    tabId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.closeNewContactDialog)(global, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('reportSpam', (global, actions, payload) => {
  const {
    chatId
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectPeer)(global, chatId);
  if (!peer) {
    return;
  }
  void (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('reportSpam', peer);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('setEmojiStatus', async (global, actions, payload) => {
  const {
    emojiStatus,
    referrerWebAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsCurrentUserPremium)(global);
  if (!isCurrentUserPremium) {
    if (referrerWebAppKey) {
      actions.sendWebAppEvent({
        webAppKey: referrerWebAppKey,
        event: {
          eventType: 'emoji_status_failed',
          eventData: {
            error: 'USER_DECLINED'
          }
        },
        tabId
      });
    }
    actions.openPremiumModal({
      initialSection: 'emoji_status',
      tabId
    });
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('updateEmojiStatus', emojiStatus);
  if (referrerWebAppKey) {
    if (!result) {
      actions.sendWebAppEvent({
        webAppKey: referrerWebAppKey,
        event: {
          eventType: 'emoji_status_failed',
          eventData: {
            error: 'SERVER_ERROR'
          }
        },
        tabId
      });
      return;
    }
    actions.sendWebAppEvent({
      webAppKey: referrerWebAppKey,
      event: {
        eventType: 'emoji_status_set'
      },
      tabId
    });
    actions.showNotification({
      message: {
        key: 'BotSuggestedStatusUpdated'
      },
      customEmojiIconId: emojiStatus.documentId,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('saveCloseFriends', async (global, actions, payload) => {
  const {
    userIds
  } = payload;
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('saveCloseFriends', userIds);
  if (!result) {
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global.contactList?.userIds.forEach(userId => {
    const {
      isCloseFriend
    } = global.users.byId[userId] || {};
    if (isCloseFriend && !userIds.includes(userId)) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUser)(global, userId, {
        isCloseFriend: undefined
      });
    }
  });
  userIds.forEach(userId => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUser)(global, userId, {
      isCloseFriend: true
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('openSuggestedStatusModal', async (global, actions, payload) => {
  const {
    customEmojiId,
    duration,
    botId,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const customEmoji = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchCustomEmoji', {
    documentId: [customEmojiId]
  });
  if (!customEmoji?.[0]) {
    if (webAppKey) {
      actions.sendWebAppEvent({
        webAppKey,
        event: {
          eventType: 'emoji_status_failed',
          eventData: {
            error: 'SUGGESTED_EMOJI_INVALID'
          }
        },
        tabId
      });
    }
    return;
  }
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_13__.updateTabState)(global, {
    suggestedStatusModal: {
      customEmojiId,
      duration,
      webAppKey,
      botId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('loadPeerSettings', async (global, actions, payload) => {
  const {
    peerId
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectIsCurrentUserFrozen)(global)) return;
  const userFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUserFullInfo)(global, peerId);
  if (!userFullInfo) {
    actions.loadFullUser({
      userId: peerId
    });
    return;
  }
  const user = (0,_selectors__WEBPACK_IMPORTED_MODULE_14__.selectUser)(global, peerId);
  if (!user) {
    return;
  }
  const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_8__.callApi)('fetchPeerSettings', user);
  if (!result) return;
  const {
    settings
  } = result;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_11__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_12__.updateUserFullInfo)(global, peerId, {
    settings
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_11__.addActionHandler)('markBotVerificationInfoShown', (global, actions, payload) => {
  const {
    peerId
  } = payload;
  const currentPeerIds = global.settings.botVerificationShownPeerIds;
  const newPeerIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)([peerId, ...currentPeerIds]).slice(0, _config__WEBPACK_IMPORTED_MODULE_1__.BOT_VERIFICATION_PEERS_LIMIT);
  global = {
    ...global,
    settings: {
      ...global.settings,
      botVerificationShownPeerIds: newPeerIds
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_11__.setGlobal)(global);
});

/***/ },

/***/ "./src/global/actions/apiUpdaters/calls.ts"
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/calls.ts ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.tsx");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_calls__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers/calls */ "./src/global/reducers/calls.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_calls__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors/calls */ "./src/global/selectors/calls.ts");
/* harmony import */ var _ui_calls__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/calls */ "./src/global/actions/ui/calls.ts");












(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateGroupCall':
      {
        if (update.call.connectionState === 'discarded') {
          if (global.groupCalls.activeGroupCallId) {
            if ('leaveGroupCall' in actions) actions.leaveGroupCall({
              shouldRemove: true,
              tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
            });
            return undefined;
          } else {
            return (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.removeGroupCall)(global, update.call.id);
          }
        }
        const groupCall = (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectGroupCall)(global, update.call.id);
        const chatId = groupCall?.chatId;
        if (chatId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
            isCallNotEmpty: groupCall.participantsCount > 0 || Boolean(groupCall.participants?.length)
          });
        }
        return (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCall)(global, update.call.id, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(update.call, ['connectionState']), undefined, update.call.participantsCount);
      }
    case 'updateGroupCallChatId':
      {
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_9__.selectChat)(global, update.chatId);
        if (chat) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChatFullInfo)(global, update.chatId, {
            groupCallId: update.call.id
          });
        }
        return global;
      }
    case 'updateGroupCallParticipants':
      {
        const {
          groupCallId,
          participants,
          nextOffset
        } = update;
        const {
          currentUserId
        } = global;

        // `secret-sauce` should disconnect if the participant is us but from another device
        global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
        participants.forEach(participant => {
          if (participant.id) {
            global = (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCallParticipant)(global, groupCallId, participant.id, participant, Boolean(nextOffset) || currentUserId === participant.id);
          }
        });
        if (nextOffset) {
          global = (0,_reducers_calls__WEBPACK_IMPORTED_MODULE_7__.updateGroupCall)(global, groupCallId, {
            nextOffset
          });
        }
        const groupCall = (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectGroupCall)(global, groupCallId);
        const chatId = groupCall?.chatId;
        if (chatId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.updateChat)(global, chatId, {
            isCallNotEmpty: groupCall.participantsCount > 0 || Boolean(groupCall.participants?.length)
          });
        }
        return global;
      }
    case 'updatePhoneCall':
      {
        if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.ARE_CALLS_SUPPORTED) return undefined;
        const {
          phoneCall,
          currentUserId
        } = global;
        const {
          call
        } = update;
        if (phoneCall) {
          if (call.state === 'discarded') {
            actions.playGroupCallSound({
              sound: 'end'
            });
            if ('hangUp' in actions) actions.hangUp({
              tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
            });
            return {
              ...global,
              ...(call.needRating && {
                ratingPhoneCall: call
              })
            };
          }
          return undefined;
        }
        const isOutgoing = call?.adminId === currentUserId;
        if (!isOutgoing && call.state === 'requested') {
          (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_4__.onTickEnd)(() => {
            global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
            const user = (0,_selectors_calls__WEBPACK_IMPORTED_MODULE_10__.selectPhoneCallUser)(global);
            if (!user) return;
            (0,_util_notifications__WEBPACK_IMPORTED_MODULE_3__.notifyAboutCall)({
              call,
              user
            });
          });
          (0,_ui_calls__WEBPACK_IMPORTED_MODULE_11__.initializeSounds)();
          void (0,_ui_calls__WEBPACK_IMPORTED_MODULE_11__.checkNavigatorUserMediaPermissions)(global, actions, call.isVideo, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)());
          global = {
            ...global,
            phoneCall: call
          };
          return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_8__.updateTabState)(global, {
            isCallPanelVisible: false
          }, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)());
        }
      }
  }
  return undefined;
});

/***/ },

/***/ "./src/global/actions/apiUpdaters/chats.ts"
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/chats.ts ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.tsx");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");











const TYPING_STATUS_CLEAR_DELAY = 6000; // 6 seconds
const INVALIDATE_FULL_CHAT_FIELDS = new Set(['boostLevel', 'isForum', 'isLinkedInDiscussion', 'fakeType', 'restrictionReasons', 'isJoinToSend', 'isJoinRequest', 'type']);
(0,_index__WEBPACK_IMPORTED_MODULE_6__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateChat':
      {
        const localChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.id);
        const {
          isForum: prevIsForum,
          lastReadOutboxMessageId
        } = localChat || {};
        if (update.chat.lastReadOutboxMessageId && lastReadOutboxMessageId && update.chat.lastReadOutboxMessageId < lastReadOutboxMessageId) {
          update = {
            ...update,
            chat: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(update.chat, ['lastReadInboxMessageId'])
          };
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.id, update.chat);
        if (localChat?.areStoriesHidden !== update.chat.areStoriesHidden) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updatePeerStoriesHidden)(global, update.id, update.chat.areStoriesHidden || false);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        const updatedChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.id);
        if (!update.noTopChatsRequest && !(0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectIsChatListed)(global, update.id) && !updatedChat?.isNotJoined) {
          // Reload top chats to update chat listing
          actions.loadTopChats();
        }
        if (update.chat.id) {
          (0,_util_notifications__WEBPACK_IMPORTED_MODULE_4__.closeMessageNotifications)({
            chatId: update.chat.id,
            lastReadInboxMessageId: update.chat.lastReadInboxMessageId
          });
        }
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const {
            chatId: currentChatId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCurrentMessageList)(global, tabId) || {};
          const chatUpdate = update;
          // The property `isForum` was changed in another client
          if (currentChatId === chatUpdate.id && 'isForum' in chatUpdate.chat && prevIsForum !== chatUpdate.chat.isForum) {
            if (prevIsForum) {
              actions.closeForumPanel({
                tabId
              });
            }
            actions.openChat({
              id: currentChatId,
              tabId
            });
          }
        });
        if (localChat) {
          const chatUpdate = update.chat;
          const changedFields = Object.keys(chatUpdate).filter(key => localChat[key] !== chatUpdate[key]);
          if (changedFields.some(key => INVALIDATE_FULL_CHAT_FIELDS.has(key))) {
            actions.invalidateFullInfo({
              peerId: update.id
            });
          }
        }
        return undefined;
      }
    case 'updateChatJoin':
      {
        const listType = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatListType)(global, update.id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.id);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.id, {
          isNotJoined: false
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        if (chat) {
          actions.requestChatUpdate({
            chatId: chat.id
          });
        }
        actions.loadFullChat({
          chatId: update.id,
          force: true
        });
        if (!listType) {
          return undefined;
        }
        global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addChatListIds)(global, listType, [update.id]);
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        return undefined;
      }
    case 'updateChatLeave':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.leaveChat)(global, update.id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.id);
        if (chat && (0,_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat)) {
          const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatMessages)(global, update.id);
          if (chatMessages) {
            const localMessageIds = Object.keys(chatMessages).map(Number).filter(_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_3__.isLocalMessageId);
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.deleteChatMessages)(global, chat.id, localMessageIds);
          }
        }
        return global;
      }
    case 'updateChatInbox':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.id, update.chat);
      }
    case 'updateChatTypingStatus':
      {
        const {
          id,
          threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
          typingStatus
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replaceThreadParam)(global, id, threadId, 'typingStatus', typingStatus);
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        setTimeout(() => {
          global = (0,_index__WEBPACK_IMPORTED_MODULE_6__.getGlobal)();
          const currentTypingStatus = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectThreadParam)(global, id, threadId, 'typingStatus');
          if (typingStatus && currentTypingStatus && typingStatus.timestamp === currentTypingStatus.timestamp) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replaceThreadParam)(global, id, threadId, 'typingStatus', undefined);
            (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
          }
        }, TYPING_STATUS_CLEAR_DELAY);
        return undefined;
      }
    case 'newMessage':
      {
        const {
          message
        } = update;
        const isOur = message.senderId ? message.senderId === global.currentUserId : message.isOutgoing;
        if (isOur && !message.isFromScheduled) {
          return undefined;
        }
        const isLocal = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_3__.isLocalMessageId)(message.id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, update.chatId);
        if (!chat) {
          return undefined;
        }
        const hasMention = Boolean(update.message.id && update.message.hasUnreadMention);
        if (!isLocal || chat.id === _config__WEBPACK_IMPORTED_MODULE_1__.SERVICE_NOTIFICATIONS_USER_ID) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.chatId, {
            unreadCount: chat.unreadCount ? chat.unreadCount + 1 : 1
          });
          if (hasMention) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.addUnreadMentions)(global, update.chatId, chat, [update.message.id], true);
          }
          const topic = chat.isForum ? (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTopicFromMessage)(global, message) : undefined;
          if (topic) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateTopic)(global, update.chatId, topic.id, {
              unreadCount: topic.unreadCount ? topic.unreadCount + 1 : 1
            });
          }
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        (0,_util_notifications__WEBPACK_IMPORTED_MODULE_4__.notifyAboutMessage)({
          chat,
          message
        });
        return undefined;
      }
    case 'updateCommonBoxMessages':
    case 'updateChannelMessages':
      {
        const {
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          const chatId = 'channelId' in update ? update.channelId : (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectCommonBoxChatId)(global, id);
          const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
          if (messageUpdate.reactions && chat?.unreadReactionsCount && !(0,_helpers__WEBPACK_IMPORTED_MODULE_5__.checkIfHasUnreadReactions)(global, messageUpdate.reactions)) {
            global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_8__.updateUnreadReactions)(global, chatId, {
              unreadReactionsCount: Math.max(chat.unreadReactionsCount - 1, 0) || undefined,
              unreadReactions: chat.unreadReactions?.filter(i => i !== id)
            });
          }
          if (!messageUpdate.hasUnreadMention && chat?.unreadMentionsCount) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.removeUnreadMentions)(global, chatId, chat, [id], true);
          }
        });
        return global;
      }
    case 'updateChatFullInfo':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatFullInfo)(global, update.id, update.fullInfo);
      }
    case 'updatePinnedChatIds':
      {
        const {
          ids,
          folderId
        } = update;
        const listType = folderId === _config__WEBPACK_IMPORTED_MODULE_1__.ARCHIVED_FOLDER_ID ? 'archived' : 'active';
        if (!ids) {
          actions.loadPinnedDialogs({
            listType
          });
          return global;
        }
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              [listType]: ids.length ? ids : undefined
            }
          }
        };
      }
    case 'updatePinnedSavedDialogIds':
      {
        const {
          ids
        } = update;
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              saved: ids.length ? ids : undefined
            }
          }
        };
      }
    case 'updateChatPinned':
      {
        const {
          id,
          isPinned
        } = update;
        const listType = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatListType)(global, id);
        if (!listType) {
          return undefined;
        }
        const {
          [listType]: orderedPinnedIds
        } = global.chats.orderedPinnedIds;
        let newOrderedPinnedIds = orderedPinnedIds || [];
        if (!isPinned) {
          newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => pinnedId !== id);
        } else if (!newOrderedPinnedIds.includes(id)) {
          // When moving pinned chats to archive, active ordered pinned ids don't get updated
          // (to preserve chat pinned state when it returns from archive)
          // If user already has max pinned chats, we should check for orderedIds
          // that don't point to listed chats
          if (listType === 'active' && newOrderedPinnedIds.length >= _config__WEBPACK_IMPORTED_MODULE_1__.MAX_ACTIVE_PINNED_CHATS) {
            const listIds = global.chats.listIds.active;
            newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => listIds && listIds.includes(pinnedId));
          }
          newOrderedPinnedIds = [id, ...newOrderedPinnedIds];
        }
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              [listType]: newOrderedPinnedIds.length ? newOrderedPinnedIds : undefined
            }
          }
        };
      }
    case 'updateSavedDialogPinned':
      {
        const {
          id,
          isPinned
        } = update;
        const {
          saved: orderedPinnedIds
        } = global.chats.orderedPinnedIds;
        let newOrderedPinnedIds = orderedPinnedIds || [];
        if (!isPinned) {
          newOrderedPinnedIds = newOrderedPinnedIds.filter(pinnedId => pinnedId !== id);
        } else if (!newOrderedPinnedIds.includes(id)) {
          newOrderedPinnedIds = [id, ...newOrderedPinnedIds];
        }
        return {
          ...global,
          chats: {
            ...global.chats,
            orderedPinnedIds: {
              ...global.chats.orderedPinnedIds,
              saved: newOrderedPinnedIds.length ? newOrderedPinnedIds : undefined
            }
          }
        };
      }
    case 'updateChatListType':
      {
        const {
          id,
          folderId
        } = update;
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatListType)(global, id, folderId);
      }
    case 'updateChatFolder':
      {
        const {
          id,
          folder
        } = update;
        const {
          byId: chatFoldersById,
          orderedIds
        } = global.chatFolders;
        const isDeleted = folder === undefined;
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTabState)(global, tabId);
          const isFolderActive = Object.values(chatFoldersById)[tabState.activeChatFolder - 1]?.id === id;
          if (isFolderActive) {
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_9__.updateTabState)(global, {
              activeChatFolder: 0
            }, tabId);
          }
        });
        const newChatFoldersById = !isDeleted ? {
          ...chatFoldersById,
          [id]: folder
        } : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(chatFoldersById, [id]);
        const newOrderedIds = !isDeleted ? orderedIds?.includes(id) ? orderedIds : [...(orderedIds || []), id] : orderedIds?.filter(orderedId => orderedId !== id);
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            byId: newChatFoldersById,
            orderedIds: newOrderedIds,
            invites: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(global.chatFolders.invites, [id])
          }
        };
      }
    case 'updateChatFoldersOrder':
      {
        const {
          orderedIds
        } = update;
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            orderedIds
          }
        };
      }
    case 'updateRecommendedChatFolders':
      {
        const {
          folders
        } = update;
        return {
          ...global,
          chatFolders: {
            ...global.chatFolders,
            recommended: folders
          }
        };
      }
    case 'updateChatMembers':
      {
        const targetChatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChatFullInfo)(global, update.id);
        const {
          replacedMembers,
          addedMember,
          deletedMemberId
        } = update;
        if (!targetChatFullInfo) {
          return undefined;
        }
        let shouldUpdate = false;
        let members = targetChatFullInfo?.members ? [...targetChatFullInfo.members] : [];
        if (replacedMembers) {
          members = replacedMembers;
          shouldUpdate = true;
        } else if (addedMember) {
          if (!members.length || !members.some(m => m.userId === addedMember.userId)) {
            members.push(addedMember);
            shouldUpdate = true;
          }
        } else if (members.length && deletedMemberId) {
          const deleteIndex = members.findIndex(m => m.userId === deletedMemberId);
          if (deleteIndex > -1) {
            members.slice(deleteIndex, 1);
            shouldUpdate = true;
          }
        }
        if (shouldUpdate) {
          const adminMembers = members.filter(({
            isOwner,
            isAdmin
          }) => isOwner || isAdmin);
          // TODO Kicked members?

          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, update.id, {
            membersCount: members.length
          });
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatFullInfo)(global, update.id, {
            members,
            adminMembersById: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.buildCollectionByKey)(adminMembers, 'userId')
          });
          return global;
        }
        return undefined;
      }
    case 'draftMessage':
      {
        const {
          chatId,
          threadId,
          draft
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replaceThreadParam)(global, chatId, threadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'draft', draft);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, chatId, {
          draftDate: draft?.date
        });
        return global;
      }
    case 'updatePendingJoinRequests':
      {
        const {
          chatId,
          requestsPending,
          recentRequesterIds
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChatFullInfo)(global, chatId, {
          requestsPending,
          recentRequesterIds
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        actions.loadChatJoinRequests({
          chatId
        });
        return undefined;
      }
    case 'updatePinnedTopic':
      {
        const {
          chatId,
          topicId,
          isPinned
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) {
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateTopic)(global, chatId, topicId, {
          isPinned
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        return undefined;
      }
    case 'updatePinnedTopicsOrder':
      {
        const {
          chatId,
          order
        } = update;
        const chat = global.chats.byId[chatId];
        if (!chat) return undefined;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replacePinnedTopicIds)(global, chatId, order);
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        return undefined;
      }
    case 'updateTopic':
      {
        const {
          chatId,
          topicId
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        actions.loadTopicById({
          chatId,
          topicId
        });
        return undefined;
      }
    case 'updateTopics':
      {
        const {
          chatId
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        actions.loadTopics({
          chatId,
          force: true
        });
        return undefined;
      }
    case 'updateViewForumAsMessages':
      {
        const {
          chatId,
          isEnabled
        } = update;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectChat)(global, chatId);
        if (!chat?.isForum) return undefined;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, chatId, {
          isForumAsMessages: isEnabled
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        break;
      }
    case 'updateNewProfilePhoto':
      {
        const {
          peerId,
          photo
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, peerId, {
          avatarPhotoId: photo.id
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        actions.loadMoreProfilePhotos({
          peerId,
          shouldInvalidateCache: true
        });
        break;
      }
    case 'updateDeleteProfilePhoto':
      {
        const {
          peerId,
          photoId
        } = update;
        const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_10__.selectPeer)(global, peerId);
        if (!peer) {
          return undefined;
        }
        if (!photoId || peer.avatarPhotoId === photoId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.updateChat)(global, peerId, {
            avatarPhotoId: undefined
          });
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.replacePeerPhotos)(global, peerId, undefined);
        } else {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_7__.deletePeerPhoto)(global, peerId, photoId);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_6__.setGlobal)(global);
        actions.loadMoreProfilePhotos({
          peerId,
          shouldInvalidateCache: true
        });
        break;
      }
  }
  return undefined;
});

/***/ },

/***/ "./src/global/actions/apiUpdaters/messages.ts"
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/messages.ts ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   deleteMessages: () => (/* binding */ deleteMessages),
/* harmony export */   deleteParticipantHistory: () => (/* binding */ deleteParticipantHistory),
/* harmony export */   deleteThread: () => (/* binding */ deleteThread),
/* harmony export */   updateWithLocalMedia: () => (/* binding */ updateWithLocalMedia)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_areDeepEqual__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/areDeepEqual */ "./src/util/areDeepEqual.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_notifications__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/notifications */ "./src/util/notifications.tsx");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_replies__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_reactions__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../reducers/reactions */ "./src/global/reducers/reactions.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");

















const ANIMATION_DELAY = 350;
const SNAP_ANIMATION_DELAY = 1000;
const VIDEO_PROCESSING_NOTIFICATION_DELAY = 1000;
let lastVideoProcessingNotificationTime = 0;
(0,_index__WEBPACK_IMPORTED_MODULE_12__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'newMessage':
      {
        const {
          chatId,
          id,
          message,
          shouldForceReply,
          wasDrafted,
          poll,
          webPage
        } = update;
        global = updateWithLocalMedia(global, chatId, id, message);
        global = updateListedAndViewportIds(global, actions, message);
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);
        const replyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_11__.getMessageReplyInfo)(newMessage);
        const storyReplyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_11__.getStoryReplyInfo)(newMessage);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
        if (chat?.isForum && replyInfo?.isForumTopic && !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTopicFromMessage)(global, newMessage) && replyInfo.replyToMsgId) {
          actions.loadTopicById({
            chatId,
            topicId: replyInfo.replyToMsgId
          });
        }
        const isLocal = (0,_helpers__WEBPACK_IMPORTED_MODULE_10__.isMessageLocal)(message);
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          // Force update for last message on drafted messages to prevent flickering
          if (isLocal && wasDrafted) {
            global = updateChatLastMessage(global, chatId, newMessage);
          }
          const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, newMessage);
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMediaLoadingState)(global, newMessage, chatId, threadId, tabId);
          if ((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsMessageInCurrentMessageList)(global, chatId, message, tabId)) {
            if (isLocal && message.isOutgoing && !message.content?.action && !storyReplyInfo?.storyId && !message.content?.storyData) {
              const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId);
              if (currentMessageList) {
                // We do not use `actions.focusLastMessage` as it may be set with a delay (see below)
                actions.focusMessage({
                  chatId,
                  threadId: currentMessageList.threadId,
                  messageId: message.id,
                  noHighlight: true,
                  isResizingContainer: true,
                  tabId
                });
              }
            }

            // @perf Wait until scroll animation finishes or simply rely on delivery status update
            // (which is itself delayed)
            if (!isLocal) {
              setTimeout(() => {
                global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
                if (shouldForceReply) {
                  actions.updateDraftReplyInfo({
                    replyToMsgId: id,
                    tabId
                  });
                }
                global = updateChatLastMessage(global, chatId, newMessage);
                (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
              }, ANIMATION_DELAY);
            }
          } else {
            global = updateChatLastMessage(global, chatId, newMessage);
          }
        });
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceWebPage)(global, webPage.id, webPage);
        }
        if (message.reportDeliveryUntilDate && message.reportDeliveryUntilDate > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_9__.getServerTime)()) {
          actions.reportMessageDelivery({
            chatId,
            messageId: id
          });
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);

        // Reload dialogs if chat is not present in the list
        if (!isLocal && !chat?.isNotJoined && !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatListed)(global, chatId)) {
          actions.loadTopChats();
        }
        if (!isLocal && (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatWithSelf)(global, chatId)) {
          const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSavedDialogIdFromMessage)(global, newMessage);
          if (savedDialogId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatListed)(global, savedDialogId, 'saved')) {
            actions.requestSavedDialogUpdate({
              chatId: savedDialogId
            });
          }
        }
        break;
      }
    case 'updateChatLastMessage':
      {
        const {
          id,
          lastMessage
        } = update;
        global = updateChatLastMessage(global, id, lastMessage, true);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.addMessages)(global, [lastMessage]);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateStartEmojiInteraction':
      {
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const {
            chatId: currentChatId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
          if (currentChatId !== update.id) return;
          const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, currentChatId, update.messageId);
          if (!message) return;

          // Workaround for a weird behavior when interaction is received after watching reaction
          if ((0,_helpers__WEBPACK_IMPORTED_MODULE_10__.getMessageText)(message)?.text !== update.emoji) return;
          const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
          global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
            activeEmojiInteractions: [...(tabState.activeEmojiInteractions || []), {
              id: Math.random(),
              animatedEffect: update.emoji,
              messageId: update.messageId
            }]
          }, tabId);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'newScheduledMessage':
      {
        const {
          chatId,
          id,
          message,
          poll,
          webPage
        } = update;
        global = updateWithLocalMedia(global, chatId, id, message, true);
        const scheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)([...scheduledIds, id]));
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, message);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)([...threadScheduledIds, id]));
        }
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceWebPage)(global, webPage.id, webPage);
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePeerFullInfo)(global, chatId, {
          hasScheduledMessages: true
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateScheduledMessage':
      {
        const {
          chatId,
          id,
          message,
          poll,
          webPage,
          isFromNew
        } = update;
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledMessage)(global, chatId, id);
        if (!currentMessage) {
          if (isFromNew) {
            actions.apiUpdate({
              '@type': 'newScheduledMessage',
              id: update.id,
              chatId: update.chatId,
              message: update.message,
              poll: update.poll,
              webPage: update.webPage
            });
          }
          return;
        }
        global = updateWithLocalMedia(global, chatId, id, message, true);
        const ids = Object.keys((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatScheduledMessages)(global, chatId) || {}).map(Number).sort((a, b) => b - a);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', ids);
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, currentMessage);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', threadScheduledIds.sort((a, b) => b - a));
        }
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceWebPage)(global, webPage.id, webPage);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateMessage':
      {
        const {
          chatId,
          id,
          message,
          poll,
          webPage,
          isFromNew,
          shouldForceReply
        } = update;
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);
        if (!currentMessage) {
          if (isFromNew) {
            actions.apiUpdate({
              '@type': 'newMessage',
              id: update.id,
              chatId: update.chatId,
              message: update.message,
              poll: update.poll,
              webPage: update.webPage,
              shouldForceReply
            });
          }
          return;
        }
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
        global = updateWithLocalMedia(global, chatId, id, message);
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);
        if (message.reactions && chat) {
          global = updateReactions(global, actions, chatId, id, message.reactions, chat, newMessage.isOutgoing, currentMessage);
        }
        if (message.content?.text?.text !== currentMessage?.content?.text?.text) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.clearMessageTranslation)(global, chatId, id);
        }
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceWebPage)(global, webPage.id, webPage);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateQuickReplyMessage':
      {
        const {
          id,
          message,
          poll,
          webPage
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateQuickReplyMessage)(global, id, message);
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePoll)(global, poll.id, poll);
        }
        if (webPage) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceWebPage)(global, webPage.id, webPage);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'deleteQuickReplyMessages':
      {
        const {
          messageIds
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteQuickReplyMessages)(global, messageIds);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateQuickReplies':
      {
        const {
          quickReplies
        } = update;
        const byId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.buildCollectionByKey)(quickReplies, 'id');
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateQuickReplies)(global, byId);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'deleteQuickReply':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteQuickReply)(global, update.quickReplyId);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateVideoProcessingPending':
      {
        const {
          chatId,
          localId,
          newScheduledMessageId
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteChatMessages)(global, chatId, [localId]);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePeerFullInfo)(global, chatId, {
          hasScheduledMessages: true
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId);
          if (currentMessageList?.chatId !== chatId) return;
          const now = Date.now();
          if (now - lastVideoProcessingNotificationTime < VIDEO_PROCESSING_NOTIFICATION_DELAY) {
            return;
          }
          lastVideoProcessingNotificationTime = now;
          actions.showNotification({
            message: {
              key: 'VideoConversionText'
            },
            title: {
              key: 'VideoConversionTitle'
            },
            tabId
          });
          actions.focusMessage({
            chatId,
            messageId: newScheduledMessageId,
            messageListType: 'scheduled',
            tabId
          });
        });
        break;
      }
    case 'updateMessageSendSucceeded':
      {
        const {
          chatId,
          localId,
          message,
          poll
        } = update;
        global = updateListedAndViewportIds(global, actions, message);
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, localId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteChatMessages)(global, chatId, [localId]);

        // Edge case for "Send When Online"
        if (message.isScheduled) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteChatScheduledMessages)(global, chatId, [localId]);
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, message.id, {
          ...currentMessage,
          ...message,
          previousLocalId: localId,
          isDeleting: undefined
        });
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePoll)(global, poll.id, poll);
        }
        global = {
          ...global,
          fileUploads: {
            byMessageKey: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.omit)(global.fileUploads.byMessageKey, [(0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_6__.getMessageKey)(message)])
          }
        };
        const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, message.id);
        global = updateChatLastMessage(global, chatId, newMessage);
        const thread = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadByMessage)(global, message);
        // For some reason Telegram requires to manually mark outgoing thread messages read
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const {
            chatId: currentChatId,
            threadId: currentThreadId
          } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
          if (currentChatId !== chatId || (thread?.threadInfo?.threadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) !== currentThreadId) {
            return;
          }
          actions.markMessageListRead({
            maxId: message.id,
            tabId
          });
        });
        if (thread?.threadInfo?.threadId) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, thread.threadInfo.threadId, 'threadInfo', {
            ...thread.threadInfo,
            lastMessageId: message.id,
            lastReadInboxMessageId: message.id
          });
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChat)(global, chatId, {
          lastReadInboxMessageId: message.id
        });
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
        // Reload dialogs if chat is not present in the list
        if (!chat?.isNotJoined && !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatListed)(global, chatId)) {
          actions.loadTopChats();
        }
        if ((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatWithSelf)(global, chatId)) {
          const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSavedDialogIdFromMessage)(global, newMessage);
          if (savedDialogId && !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatListed)(global, savedDialogId, 'saved')) {
            actions.requestSavedDialogUpdate({
              chatId: savedDialogId
            });
          }
        }

        // 
        Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../../components/chatAssistant/room-storage */ "./src/components/chatAssistant/room-storage/index.tsx")).then(RoomStorage => {
          RoomStorage.default.incrementMessageCount(chatId);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateScheduledMessageSendSucceeded':
      {
        const {
          chatId,
          localId,
          message,
          poll
        } = update;
        const scheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', [...scheduledIds, message.id]);
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, message);
        if (threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          const threadScheduledIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledIds)(global, chatId, threadId) || [];
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, threadId, 'scheduledIds', [...threadScheduledIds, message.id]);
        }
        const currentMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledMessage)(global, chatId, localId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteChatScheduledMessages)(global, chatId, [localId]);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateScheduledMessage)(global, chatId, message.id, {
          ...currentMessage,
          ...message,
          previousLocalId: localId,
          isDeleting: undefined
        });
        if (poll) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePoll)(global, poll.id, poll);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updatePinnedIds':
      {
        const {
          chatId,
          isPinned,
          messageIds
        } = update;
        const messages = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.pickTruthy)((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessages)(global, chatId), messageIds);
        const updatePerThread = {
          [_api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID]: messageIds
        };
        Object.values(messages).forEach(message => {
          const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, message);
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, message.id, {
            isPinned
          });
          if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) return;
          const currentUpdatedInThread = updatePerThread[threadId] || [];
          currentUpdatedInThread.push(message.id);
          updatePerThread[threadId] = currentUpdatedInThread;
        });
        Object.entries(updatePerThread).forEach(([threadId, ids]) => {
          const pinnedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectPinnedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) || [];
          const newPinnedIds = isPinned ? (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)(pinnedIds.concat(ids)).sort((a, b) => b - a) : pinnedIds.filter(id => !ids.includes(id));
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, Number(threadId), 'pinnedIds', newPinnedIds);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateThreadInfo':
      {
        const {
          threadInfo
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateThreadInfos)(global, [threadInfo]);
        const {
          chatId,
          threadId
        } = threadInfo;
        if (!chatId || !threadId) return;
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
        const currentThreadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadInfo)(global, chatId, threadId);
        const topic = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTopic)(global, chatId, threadId);
        if (chat?.isForum) {
          if (!topic || topic.lastMessageId !== currentThreadInfo?.lastReadInboxMessageId) {
            actions.loadTopicById({
              chatId,
              topicId: Number(threadId)
            });
          } else {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateTopic)(global, chatId, Number(threadId), {
              unreadCount: 0
            });
          }
        }

        // Update reply thread last read message id if already read in main thread
        if (!chat?.isForum) {
          const lastReadInboxMessageId = chat?.lastReadInboxMessageId;
          const lastReadInboxMessageIdInThread = threadInfo.lastReadInboxMessageId || lastReadInboxMessageId;
          if (lastReadInboxMessageId && lastReadInboxMessageIdInThread) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateThreadInfo)(global, chatId, threadId, {
              lastReadInboxMessageId: Math.max(lastReadInboxMessageIdInThread, lastReadInboxMessageId)
            });
          }
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'resetMessages':
      {
        const {
          id: chatId
        } = update;
        const messagesById = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessages)(global, chatId);
        if (messagesById && !(0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_3__.isUserId)(chatId)) {
          const tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)();
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteChatMessages)(global, chatId, Object.keys(messagesById).map(Number));
          (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
          actions.loadFullChat({
            chatId,
            force: true
          });
          actions.loadViewportMessages({
            chatId,
            threadId: _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
            tabId
          });
        }
        break;
      }
    case 'deleteMessages':
      {
        const {
          ids,
          chatId
        } = update;
        deleteMessages(global, chatId, ids, actions);
        break;
      }
    case 'deleteScheduledMessages':
      {
        const {
          ids,
          newIds,
          chatId
        } = update;
        const hadVideoProcessing = ids?.some(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledMessage)(global, chatId, id)?.isVideoProcessingPending);
        const processedVideoId = newIds?.find(id => {
          const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);
          return message?.content.video;
        });
        if (hadVideoProcessing && processedVideoId) {
          Object.values(global.byTabId).forEach(({
            id: tabId
          }) => {
            actions.showNotification({
              message: {
                key: 'VideoConversionDone'
              },
              actionText: {
                key: 'VideoConversionView'
              },
              action: {
                action: 'focusMessage',
                payload: {
                  chatId,
                  messageId: processedVideoId,
                  tabId
                }
              },
              tabId
            });
          });
        }
        deleteScheduledMessages(chatId, ids, actions, global);
        break;
      }
    case 'deleteHistory':
      {
        const {
          chatId
        } = update;
        const chatMessages = global.messages.byChatId[chatId];
        if (chatId === _config__WEBPACK_IMPORTED_MODULE_1__.SERVICE_NOTIFICATIONS_USER_ID) {
          global = {
            ...global,
            serviceNotifications: global.serviceNotifications.map(notification => ({
              ...notification,
              isDeleted: true
            }))
          };
          (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        }
        if (chatMessages) {
          const ids = Object.keys(chatMessages.byId).map(Number);
          global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
          deleteMessages(global, chatId, ids, actions);
        } else {
          actions.requestChatUpdate({
            chatId
          });
        }
        global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.removeChatFromChatLists)(global, chatId);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'deleteSavedHistory':
      {
        const {
          chatId
        } = update;
        const currentUserId = global.currentUserId;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.removeChatFromChatLists)(global, chatId, 'saved');
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
        deleteThread(global, currentUserId, chatId, actions);
        break;
      }
    case 'deleteParticipantHistory':
      {
        const {
          chatId,
          peerId
        } = update;
        global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
        deleteParticipantHistory(global, chatId, peerId, actions);
        break;
      }
    case 'updateCommonBoxMessages':
      {
        const {
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          const chatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCommonBoxChatId)(global, id);
          if (chatId) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, id, messageUpdate);
          }
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateChannelMessages':
      {
        const {
          channelId,
          ids,
          messageUpdate
        } = update;
        ids.forEach(id => {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, channelId, id, messageUpdate);
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateMessagePoll':
      {
        const {
          pollId,
          pollUpdate
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePoll)(global, pollId, pollUpdate);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateMessagePollVote':
      {
        const {
          pollId,
          peerId,
          options
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updatePollVote)(global, pollId, peerId, options);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateServiceNotification':
      {
        const {
          message
        } = update;
        if ((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsServiceChatReady)(global)) {
          actions.createServiceNotification({
            message
          });
        }
        break;
      }
    case 'updateMessageReactions':
      {
        const {
          chatId,
          id,
          reactions
        } = update;
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, update.chatId);
        if (!chat || !message) return;
        global = updateReactions(global, actions, chatId, id, reactions, chat, message.isOutgoing, message);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateMessageExtendedMedia':
      {
        const {
          chatId,
          id,
          extendedMedia,
          isBought
        } = update;
        const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);
        const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, update.chatId);
        if (!chat || !message) return;
        if (message.content.invoice) {
          const media = extendedMedia[0];
          if ('mediaType' in media && media.mediaType === 'extendedMediaPreview') {
            if (!message.content.invoice) return;
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, id, {
              content: {
                ...message.content,
                invoice: {
                  ...message.content.invoice,
                  extendedMedia: media
                }
              }
            });
            (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
          } else {
            const content = media;
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, id, {
              content: {
                ...content
              }
            });
            (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
          }
        }
        if (message.content.paidMedia) {
          const paidMediaUpdate = isBought ? {
            isBought,
            extendedMedia
          } : {
            extendedMedia: extendedMedia,
            isBought: undefined
          };
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, id, {
            content: {
              ...message.content,
              paidMedia: {
                ...message.content.paidMedia,
                ...paidMediaUpdate
              }
            }
          });
          (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        }
        break;
      }
    case 'updateTranscribedAudio':
      {
        const {
          transcriptionId,
          text,
          isPending
        } = update;
        global = {
          ...global,
          transcriptions: {
            ...global.transcriptions,
            [transcriptionId]: {
              ...(global.transcriptions[transcriptionId] || {}),
              transcriptionId,
              text,
              isPending
            }
          }
        };
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateMessageSendFailed':
      {
        const {
          chatId,
          localId,
          error
        } = update;
        if (error.match(/CHAT_SEND_.+?FORBIDDEN/)) {
          Object.values(global.byTabId).forEach(({
            id: tabId
          }) => {
            actions.showAllowedMessageTypesNotification({
              chatId,
              tabId
            });
          });
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, localId, {
          sendingState: 'messageSendingStateFailed'
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'updateMessageTranslations':
      {
        const {
          chatId,
          messageIds,
          toLanguageCode,
          translations
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateMessageTranslations)(global, chatId, messageIds, toLanguageCode, translations);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
        break;
      }
    case 'failedMessageTranslations':
      {
        const {
          chatId,
          messageIds,
          toLanguageCode
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateMessageTranslations)(global, chatId, messageIds, toLanguageCode, []);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
      }
  }
});
function updateReactions(global, actions, chatId, id, reactions, chat, isOutgoing, message) {
  const currentReactions = message?.reactions;

  // `updateMessageReactions` happens with an interval, so we try to avoid redundant global state updates
  if (currentReactions && (0,_util_areDeepEqual__WEBPACK_IMPORTED_MODULE_2__.areDeepEqual)(reactions, currentReactions)) {
    return global;
  }
  const localPaidReaction = currentReactions?.results.find(r => r.localAmount);
  // Save local count on update, but reset if we sent reaction
  if (localPaidReaction?.localAmount) {
    const {
      localIsPrivate: isPrivate,
      localAmount,
      localPeerId
    } = localPaidReaction;
    reactions.results = (0,_helpers__WEBPACK_IMPORTED_MODULE_10__.addPaidReaction)(reactions.results, localAmount, isPrivate, localPeerId);
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, id, {
    reactions
  });
  if (!isOutgoing) {
    return global;
  }
  const {
    reaction,
    isOwn,
    isUnread
  } = reactions.recentReactions?.[0] ?? {};
  const reactionEffectsEnabled = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectPerformanceSettingsValue)(global, 'reactionEffects');
  if (reactionEffectsEnabled && message && reaction && isUnread && !isOwn) {
    const messageKey = (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_6__.getMessageKey)(message);
    // Start reaction only in master tab
    actions.startActiveReaction({
      containerId: messageKey,
      reaction,
      tabId: (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_4__.getCurrentTabId)()
    });
  }
  const hasUnreadReactionsForMessageInChat = chat.unreadReactions?.includes(id);
  const hasUnreadReactionsInNewReactions = (0,_helpers__WEBPACK_IMPORTED_MODULE_10__.checkIfHasUnreadReactions)(global, reactions);

  // Only notify about added reactions, not removed ones
  if (hasUnreadReactionsInNewReactions && !hasUnreadReactionsForMessageInChat) {
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_14__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: (chat?.unreadReactionsCount || 0) + 1,
      unreadReactions: [...(chat?.unreadReactions || []), id].sort((a, b) => b - a)
    });
    const newMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);
    if (!chat || !newMessage) return global;
    (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_8__.onTickEnd)(() => {
      (0,_util_notifications__WEBPACK_IMPORTED_MODULE_7__.notifyAboutMessage)({
        chat,
        message: newMessage,
        isReaction: true
      });
    });
  }
  if (!hasUnreadReactionsInNewReactions && hasUnreadReactionsForMessageInChat) {
    global = (0,_reducers_reactions__WEBPACK_IMPORTED_MODULE_14__.updateUnreadReactions)(global, chatId, {
      unreadReactionsCount: (chat?.unreadReactionsCount || 1) - 1,
      unreadReactions: chat?.unreadReactions?.filter(i => i !== id)
    });
  }
  return global;
}
function updateWithLocalMedia(global, chatId, id, messageUpdate, isScheduled = false) {
  const currentMessage = isScheduled ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectScheduledMessage)(global, chatId, id) : (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);

  // Preserve locally uploaded media.
  if (currentMessage && messageUpdate.content && !(0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_6__.isLocalMessageId)(id)) {
    const {
      photo,
      video,
      sticker,
      document
    } = (0,_helpers__WEBPACK_IMPORTED_MODULE_10__.getMessageContent)(currentMessage);
    if (photo && messageUpdate.content.photo) {
      var _messageUpdate$conten, _messageUpdate$conten2;
      (_messageUpdate$conten = messageUpdate.content.photo).blobUrl ?? (_messageUpdate$conten.blobUrl = photo.blobUrl);
      (_messageUpdate$conten2 = messageUpdate.content.photo).thumbnail ?? (_messageUpdate$conten2.thumbnail = photo.thumbnail);
    } else if (video && messageUpdate.content.video) {
      var _messageUpdate$conten3;
      (_messageUpdate$conten3 = messageUpdate.content.video).blobUrl ?? (_messageUpdate$conten3.blobUrl = video.blobUrl);
    } else if (sticker && messageUpdate.content.sticker) {
      var _messageUpdate$conten4;
      (_messageUpdate$conten4 = messageUpdate.content.sticker).isPreloadedGlobally ?? (_messageUpdate$conten4.isPreloadedGlobally = sticker.isPreloadedGlobally);
    } else if (document && messageUpdate.content.document) {
      var _messageUpdate$conten5;
      (_messageUpdate$conten5 = messageUpdate.content.document).previewBlobUrl ?? (_messageUpdate$conten5.previewBlobUrl = document.previewBlobUrl);
    }
  }
  const newMessage = currentMessage ? {
    ...currentMessage,
    ...messageUpdate
  } : messageUpdate;
  return isScheduled ? (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateScheduledMessage)(global, chatId, id, newMessage) : (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, id, newMessage);
}
function updateThreadUnread(global, actions, message, isDeleting) {
  const {
    chatId
  } = message;
  const replyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_11__.getMessageReplyInfo)(message);
  const {
    threadInfo
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadByMessage)(global, message) || {};
  if (!threadInfo && replyInfo?.replyToMsgId) {
    const originMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, replyInfo.replyToMsgId);
    if (originMessage) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateThreadUnreadFromForwardedMessage)(global, originMessage, chatId, message.id, isDeleting);
    } else {
      actions.loadMessage({
        chatId,
        messageId: replyInfo.replyToMsgId,
        threadUpdate: {
          isDeleting,
          lastMessageId: message.id
        }
      });
    }
  }
  return global;
}
function updateListedAndViewportIds(global, actions, message) {
  const {
    id,
    chatId
  } = message;
  const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSavedDialogIdFromMessage)(global, message);
  const {
    threadInfo
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadByMessage)(global, message) || {};
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
  const isUnreadChatNotLoaded = chat?.unreadCount && !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectListedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
  global = updateThreadUnread(global, actions, message);
  const {
    threadId
  } = threadInfo ?? {
    threadId: savedDialogId
  };
  if (threadId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateListedIds)(global, chatId, threadId, [id]);
    Object.values(global.byTabId).forEach(({
      id: tabId
    }) => {
      if ((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsViewportNewest)(global, chatId, threadId, tabId)) {
        // Always keep the first unread message in the viewport list
        const firstUnreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectFirstUnreadId)(global, chatId, threadId);
        const candidateGlobal = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.addViewportId)(global, chatId, threadId, id, tabId);
        const newViewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectViewportIds)(candidateGlobal, chatId, threadId, tabId);
        if (!firstUnreadId || newViewportIds.includes(firstUnreadId)) {
          global = candidateGlobal;
        }
      }
    });
    if (threadInfo) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, threadId, 'threadInfo', {
        ...threadInfo,
        lastMessageId: message.id
      });
      if (!(0,_helpers__WEBPACK_IMPORTED_MODULE_10__.isMessageLocal)(message) && !(0,_helpers__WEBPACK_IMPORTED_MODULE_10__.isActionMessage)(message)) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateThreadInfo)(global, chatId, threadId, {
          messagesCount: (threadInfo.messagesCount || 0) + 1
        });
      }
    }
  }
  if (isUnreadChatNotLoaded) {
    return global;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateListedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, [id]);
  Object.values(global.byTabId).forEach(({
    id: tabId
  }) => {
    if ((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsViewportNewest)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, tabId)) {
      // Always keep the first unread message in the viewport list
      const firstUnreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectFirstUnreadId)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
      const candidateGlobal = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.addViewportId)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, id, tabId);
      const newViewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectViewportIds)(candidateGlobal, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, tabId);
      if (!firstUnreadId || newViewportIds.includes(firstUnreadId)) {
        global = candidateGlobal;
      }
    }
  });
  return global;
}
function updateChatLastMessage(global, chatId, message, force = false) {
  const {
    chats
  } = global;
  const chat = chats.byId[chatId];
  const currentLastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatLastMessageId)(global, chatId);
  const topic = chat?.isForum ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTopicFromMessage)(global, message) : undefined;
  if (topic) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateTopic)(global, chatId, topic.id, {
      lastMessageId: message.id
    });
  }
  const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, message);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateThreadInfo)(global, chatId, threadId, {
    lastMessageId: message.id
  });
  const savedDialogId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSavedDialogIdFromMessage)(global, message);
  if (savedDialogId) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatLastMessageId)(global, savedDialogId, message.id, 'saved');
  }
  if (currentLastMessageId && !force) {
    const isSameOrNewer = currentLastMessageId === message.id || currentLastMessageId === message.previousLocalId || message.id > currentLastMessageId;
    if (!isSameOrNewer) {
      return global;
    }
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatLastMessageId)(global, chatId, message.id);
  return global;
}
function findLastMessage(global, chatId, threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
  const byId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessages)(global, chatId);
  const listedIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectListedIds)(global, chatId, threadId);
  if (!byId || !listedIds) {
    return undefined;
  }
  let i = listedIds.length;
  while (i--) {
    const message = byId[listedIds[i]];
    if (message && !message.isDeleting) {
      return message;
    }
  }
  return undefined;
}
function deleteParticipantHistory(global, chatId, peerId, actions) {
  const byId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessages)(global, chatId);
  const messageIds = Object.values(byId).filter(message => {
    return message.senderId === peerId;
  }).map(message => message.id);
  if (!messageIds.length) {
    return;
  }
  deleteMessages(global, chatId, messageIds, actions);
}
function deleteThread(global, chatId, threadId, actions) {
  const byId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessages)(global, chatId);
  if (!byId) {
    return;
  }
  const messageIds = Object.values(byId).filter(message => {
    const messageThreadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, message);
    return messageThreadId === threadId;
  }).map(message => message.id);
  if (!messageIds.length) {
    return;
  }
  deleteMessages(global, chatId, messageIds, actions);
}
function deleteMessages(global, chatId, ids, actions) {
  // Channel update

  if (chatId) {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
    if (!chat) return;
    const threadIdsToUpdate = new Set();
    threadIdsToUpdate.add(_api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
    ids.forEach(id => {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, chatId, id, {
        isDeleting: true
      });
      if ((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTopic)(global, chatId, id)) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteTopic)(global, chatId, id);
      }
      const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id);
      if (!message) {
        return;
      }
      if (message.content.action?.type === 'chatEditPhoto' && message.content.action.photo) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deletePeerPhoto)(global, chatId, message.content.action.photo.id, true);
      }
      global = updateThreadUnread(global, actions, message, true);
      const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, message);
      if (threadId) {
        threadIdsToUpdate.add(threadId);
      }
    });
    actions.requestChatUpdate({
      chatId
    });
    const idsSet = new Set(ids);
    threadIdsToUpdate.forEach(threadId => {
      const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadInfo)(global, chatId, threadId);
      if (!threadInfo?.lastMessageId || !idsSet.has(threadInfo.lastMessageId)) return;
      const newLastMessage = findLastMessage(global, chatId, threadId);
      if (!newLastMessage) {
        if (chat.isForum && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
          actions.loadTopicById({
            chatId,
            topicId: Number(threadId)
          });
        }
        return;
      }
      if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
        global = updateChatLastMessage(global, chatId, newLastMessage, true);
      }
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateThreadInfo)(global, chatId, threadId, {
        lastMessageId: newLastMessage.id
      });
      if (chat.isForum) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateTopic)(global, chatId, Number(threadId), {
          lastMessageId: newLastMessage.id
        });
      }
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
    const isAnimatingAsSnap = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCanAnimateSnapEffect)(global);
    setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
      // Prevent local deletion of sent messages in case of desync
      const stillDeletedIds = ids.filter(id => (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, id)?.isDeleting);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteChatMessages)(global, chatId, stillDeletedIds);
      (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
    }, isAnimatingAsSnap ? SNAP_ANIMATION_DELAY : ANIMATION_DELAY);
    return;
  }

  // Common box update

  const chatIdsToUpdate = [];
  ids.forEach(id => {
    const commonBoxChatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCommonBoxChatId)(global, id);
    if (commonBoxChatId) {
      chatIdsToUpdate.push(commonBoxChatId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatMessage)(global, commonBoxChatId, id, {
        isDeleting: true
      });
      const newLastMessage = findLastMessage(global, commonBoxChatId);
      if (newLastMessage) {
        global = updateChatLastMessage(global, commonBoxChatId, newLastMessage, true);
      }
      const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, commonBoxChatId, id);
      if ((0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatWithSelf)(global, commonBoxChatId) && message) {
        const threadId = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectThreadIdFromMessage)(global, message);
        if ((0,_helpers__WEBPACK_IMPORTED_MODULE_10__.getIsSavedDialog)(commonBoxChatId, threadId, global.currentUserId)) {
          const newLastSavedDialogMessage = findLastMessage(global, commonBoxChatId, threadId);
          actions.requestSavedDialogUpdate({
            chatId: String(threadId)
          });
          if (newLastSavedDialogMessage) {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateChatLastMessageId)(global, commonBoxChatId, newLastSavedDialogMessage.id, 'saved');
          }
        }
      }
      if (message?.content.action?.type === 'chatEditPhoto' && message.content.action.photo) {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deletePeerPhoto)(global, commonBoxChatId, message.content.action.photo.id, true);
      }
      const isAnimatingAsSnap = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCanAnimateSnapEffect)(global);
      setTimeout(() => {
        global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteChatMessages)(global, commonBoxChatId, [id]);
        (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
      }, isAnimatingAsSnap ? SNAP_ANIMATION_DELAY : ANIMATION_DELAY);
    }
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)(chatIdsToUpdate).forEach(id => {
    actions.requestChatUpdate({
      chatId: id
    });
  });
}
function deleteScheduledMessages(chatId, ids, actions, global) {
  ids.forEach(id => {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.updateScheduledMessage)(global, chatId, id, {
      isDeleting: true
    });
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  const isAnimatingAsSnap = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCanAnimateSnapEffect)(global);
  setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_12__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.deleteChatScheduledMessages)(global, chatId, ids);
    const scheduledMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatScheduledMessages)(global, chatId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_13__.replaceThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID, 'scheduledIds', Object.keys(scheduledMessages || {}).map(Number));
    (0,_index__WEBPACK_IMPORTED_MODULE_12__.setGlobal)(global);
  }, isAnimatingAsSnap ? SNAP_ANIMATION_DELAY : ANIMATION_DELAY);
}

/***/ },

/***/ "./src/global/actions/apiUpdaters/misc.ts"
/*!************************************************!*\
  !*** ./src/global/actions/apiUpdaters/misc.ts ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");








(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateEntities':
      {
        const {
          users,
          chats,
          threadInfos,
          polls,
          webPages
        } = update;
        if (users) global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addUsers)(global, users);
        if (chats) global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addChats)(global, chats);
        if (threadInfos) global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateThreadInfos)(global, threadInfos);
        if (polls) {
          polls.forEach(poll => {
            global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updatePoll)(global, poll.id, poll);
          });
        }
        if (webPages) {
          webPages.forEach(webPage => {
            if (webPage.webpageType === 'full') {
              global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateFullWebPage)(global, webPage.id, webPage);
            } else {
              global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.replaceWebPage)(global, webPage.id, webPage);
            }
          });
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
        break;
      }
    case 'updatePeerBlocked':
      if (update.isBlocked) {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addBlockedUser)(global, update.id);
      } else if (update.isBlockedFromStories) {
        return global; // Unsupported
      } else {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.removeBlockedUser)(global, update.id);
      }
    case 'updateResetContactList':
      global = {
        ...global,
        contactList: {
          userIds: []
        }
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateConfig':
      actions.loadConfig();
      break;
    case 'updateNewAuthorization':
      {
        // Load more info about this session
        actions.loadAuthorizations();
        break;
      }
    case 'updateFavoriteStickers':
      actions.loadFavoriteStickers();
      break;
    case 'updateRecentStickers':
      actions.loadRecentStickers();
      break;
    case 'updateRecentReactions':
      actions.loadRecentReactions();
      break;
    case 'updateRecentEmojiStatuses':
      actions.loadRecentEmojiStatuses();
      break;
    case 'updateSavedReactionTags':
      actions.loadSavedReactionTags();
      break;
    case 'updateMoveStickerSetToTop':
      {
        const oldOrder = update.isCustomEmoji ? global.customEmojis.added.setIds : global.stickers.added.setIds;
        if (!oldOrder?.some(id => id === update.id)) return global;
        const newOrder = [update.id, ...oldOrder.filter(id => id !== update.id)];
        actions.reorderStickerSets({
          order: newOrder,
          isCustomEmoji: update.isCustomEmoji
        });
        break;
      }
    case 'updateStickerSets':
      actions.loadStickerSets();
      break;
    case 'updateStickerSetsOrder':
      {
        // Filter out invalid set IDs, which may be sent by the server
        const order = update.order.filter(setId => Boolean(global.stickers.setsById[setId]));
        actions.reorderStickerSets({
          order,
          isCustomEmoji: update.isCustomEmoji
        });
        break;
      }
    case 'updateSavedGifs':
      actions.loadSavedGifs();
      break;
    case 'updatePrivacy':
      global = {
        ...global,
        settings: {
          ...global.settings,
          privacy: {
            ...global.settings.privacy,
            [update.key]: update.rules
          }
        }
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updatePaymentVerificationNeeded':
      Object.values(global.byTabId).forEach(({
        id: tabId
      }) => {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.setConfirmPaymentUrl)(global, update.url, tabId);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.setPaymentStep)(global, _types__WEBPACK_IMPORTED_MODULE_0__.PaymentStep.ConfirmPayment, tabId);
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateWebViewResultSent':
      Object.values(global.byTabId).forEach(tabState => {
        Object.entries(tabState.webApps.openedWebApps).forEach(([webAppKey, webApp]) => {
          if (webApp.queryId === update.queryId) {
            actions.resetDraftReplyInfo({
              tabId: tabState.id
            });
            actions.closeWebApp({
              key: webAppKey,
              tabId: tabState.id
            });
          }
        });
      });
      break;
    case 'updateWebPage':
      {
        const {
          webPage
        } = update;
        if (webPage.webpageType === 'full') {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateFullWebPage)(global, webPage.id, webPage);
        } else {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.replaceWebPage)(global, webPage.id, webPage);
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
        break;
      }
    case 'updateStory':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.addStoriesForPeer)(global, update.peerId, {
        [update.story.id]: update.story
      });
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updatePeersWithStories)(global, {
        [update.peerId]: (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeerStories)(global, update.peerId)
      });
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'deleteStory':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.removePeerStory)(global, update.peerId, update.storyId);
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateReadStories':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateLastReadStoryForPeer)(global, update.peerId, update.lastReadId);
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateSentStoryReaction':
      {
        const {
          peerId,
          storyId,
          reaction
        } = update;
        const story = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeerStory)(global, peerId, storyId);
        if (!story) return global;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updatePeerStory)(global, peerId, storyId, {
          sentReaction: reaction
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
        break;
      }
    case 'updateStealthMode':
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateStealthMode)(global, update.stealthMode);
      (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      break;
    case 'updateAttachMenuBots':
      actions.loadAttachBots();
      break;
    case 'updatePremiumFloodWait':
      {
        actions.processPremiumFloodWait({
          isUpload: update.isUpload
        });
        break;
      }
    case 'updatePaidReactionPrivacy':
      {
        global = {
          ...global,
          settings: {
            ...global.settings,
            paidReactionPrivacy: update.private
          }
        };
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
        break;
      }
    case 'updateLangPackTooLong':
      {
        (0,_util_localization__WEBPACK_IMPORTED_MODULE_2__.requestLangPackDifference)(update.langCode);
        break;
      }
    case 'updateLangPack':
      {
        (0,_util_localization__WEBPACK_IMPORTED_MODULE_2__.applyLangPackDifference)(update.version, update.strings, update.keysToRemove);
        break;
      }
    case 'newMessage':
      {
        const action = update.message.content?.action;
        if (!update.message.isOutgoing && update.message.chatId !== _config__WEBPACK_IMPORTED_MODULE_1__.SERVICE_NOTIFICATIONS_USER_ID) return undefined;
        if (action?.type !== 'starGiftUnique') return undefined;
        const actionStarGift = action.gift;
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId);
          if (tabState.isWaitingForStarGiftUpgrade) {
            actions.openUniqueGiftBySlug({
              slug: actionStarGift.slug,
              tabId
            });
            actions.showNotification({
              title: {
                key: 'GiftUpgradedTitle'
              },
              message: {
                key: 'GiftUpgradedDescription'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
              isWaitingForStarGiftUpgrade: undefined
            }, tabId);
          }
          if (tabState.isWaitingForStarGiftTransfer) {
            const chatId = update.message.chatId;
            const receiver = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectPeer)(global, chatId) : undefined;
            if (receiver) {
              actions.focusMessage({
                chatId: receiver.id,
                messageId: update.message.id,
                tabId
              });
              actions.showNotification({
                message: {
                  key: 'GiftTransferSuccessMessage',
                  variables: {
                    gift: {
                      key: 'GiftUnique',
                      variables: {
                        title: actionStarGift.title,
                        number: actionStarGift.number
                      }
                    },
                    peer: (0,_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)((0,_util_localization__WEBPACK_IMPORTED_MODULE_2__.getTranslationFn)(), receiver)
                  }
                },
                tabId
              });
            }
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
              isWaitingForStarGiftTransfer: undefined
            }, tabId);
          }
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
      }
  }
  return undefined;
});

/***/ },

/***/ "./src/global/actions/apiUpdaters/payments.ts"
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/payments.ts ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");






(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updatePaymentStateCompleted':
      {
        const {
          paymentState,
          tabId
        } = update;
        const form = paymentState.form;
        const {
          invoice
        } = form;
        const {
          totalAmount,
          currency
        } = invoice;
        const inputInvoice = paymentState.inputInvoice;
        if (inputInvoice?.type === 'stars') {
          actions.closeStarsBalanceModal({
            tabId
          });
          actions.showNotification({
            message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsAcquiredInfo', inputInvoice.stars),
            title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsAcquired'),
            icon: 'star',
            tabId
          });
          actions.requestConfetti({
            withStars: true,
            tabId
          });
        } else if (inputInvoice?.type === 'giftcode') {
          const giftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).giftModal;
          if (giftModalState && inputInvoice?.userIds[0] === giftModalState.forPeerId) {
            actions.showNotification({
              message: {
                key: 'GiftSent'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
          }
        } else {
          actions.showNotification({
            tabId,
            message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('PaymentInfoHint', [(0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_0__.formatCurrencyAsString)(totalAmount, currency, _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.getTranslationFn().code), form.title])
          });
        }
        (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
        break;
      }
    case 'updateStarPaymentStateCompleted':
      {
        const {
          paymentState,
          tabId
        } = update;
        const {
          inputInvoice,
          subscriptionInfo,
          form
        } = paymentState;
        if (inputInvoice?.type === 'chatInviteSubscription' && subscriptionInfo) {
          const amount = subscriptionInfo.subscriptionPricing.amount;
          actions.showNotification({
            tabId,
            title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsSubscriptionCompleted'),
            message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsSubscriptionCompletedText', [amount, subscriptionInfo.title], undefined, amount),
            icon: 'star'
          });
        }
        if (form?.invoice.subscriptionPeriod) {
          const amount = form.invoice.totalAmount;
          actions.showNotification({
            tabId,
            title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsSubscriptionCompleted'),
            message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_1__.oldTranslate('StarsSubscriptionCompletedText', [amount, form.title], undefined, amount),
            icon: 'star'
          });
        }
        if (inputInvoice?.type === 'giftcode') {
          if (!inputInvoice.userIds) {
            return;
          }
          const giftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).giftModal;
          if (giftModalState && inputInvoice.userIds[0] === giftModalState.forPeerId) {
            actions.showNotification({
              message: {
                key: 'StarsGiftCompleted'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
          }
        }
        if (inputInvoice?.type === 'premiumGiftStars') {
          const giftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).giftModal;
          if (giftModalState && inputInvoice.userId === giftModalState.forPeerId) {
            actions.showNotification({
              message: {
                key: 'StarsGiftCompleted'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
          }
        }
        if (inputInvoice?.type === 'starsgift') {
          if (!inputInvoice.userId) {
            return;
          }
          const starsModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).starsGiftModal;
          if (starsModalState?.isOpen && inputInvoice.userId === starsModalState.forUserId) {
            global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
              starsGiftModal: {
                ...starsModalState,
                isCompleted: true
              }
            }, tabId);
          }
        }
        if (inputInvoice?.type === 'stargift') {
          if (!inputInvoice.peerId) {
            return;
          }
          const starGiftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).giftModal;
          if (starGiftModalState && inputInvoice.peerId === starGiftModalState.forPeerId) {
            actions.showNotification({
              message: {
                key: 'StarsGiftCompleted'
              },
              tabId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftModal({
              tabId
            });
          }
        }
        if (inputInvoice?.type === 'stargiftResale') {
          const starGiftModalState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).giftInfoModal;
          if (starGiftModalState) {
            actions.showNotification({
              message: {
                key: 'StarsGiftBought'
              },
              tabId
            });
            if (starGiftModalState.peerId) {
              actions.reloadPeerSavedGifts({
                peerId: starGiftModalState.peerId
              });
            }
            actions.reloadPeerSavedGifts({
              peerId: inputInvoice.peerId
            });
            actions.requestConfetti({
              withStars: true,
              tabId
            });
            actions.closeGiftInfoModal({
              tabId
            });
          }
        }
        break;
      }
    case 'updateStarsBalance':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStarsBalance)(global, update.balance);
        (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
        actions.loadStarStatus();
        break;
      }
  }
});

/***/ },

/***/ "./src/global/actions/apiUpdaters/settings.ts"
/*!****************************************************!*\
  !*** ./src/global/actions/apiUpdaters/settings.ts ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");


(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateDefaultNotifySettings':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateNotifyDefaults)(global, update.peerType, update.settings);
      }
    case 'updateChatNotifySettings':
      {
        const {
          chatId,
          settings
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.addNotifyException)(global, chatId, settings);
        (0,_index__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
        break;
      }
    case 'updateTopicNotifySettings':
      {
        const {
          chatId,
          topicId,
          settings
        } = update;
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateTopic)(global, chatId, topicId, {
          notifySettings: settings
        });
        (0,_index__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
        break;
      }
  }
  return undefined;
});

/***/ },

/***/ "./src/global/actions/apiUpdaters/symbols.ts"
/*!***************************************************!*\
  !*** ./src/global/actions/apiUpdaters/symbols.ts ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");


(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateStickerSet':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_1__.updateStickerSet)(global, update.id, update.stickerSet);
      }
  }
  return undefined;
});

/***/ },

/***/ "./src/global/actions/apiUpdaters/twoFaSettings.ts"
/*!*********************************************************!*\
  !*** ./src/global/actions/apiUpdaters/twoFaSettings.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");

(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'updateTwoFaStateWaitCode':
      {
        return {
          ...global,
          twoFaSettings: {
            ...global.twoFaSettings,
            isLoading: false,
            waitingEmailCodeLength: update.length
          }
        };
      }
    case 'updateTwoFaError':
      {
        return {
          ...global,
          twoFaSettings: {
            ...global.twoFaSettings,
            errorKey: update.messageKey
          }
        };
      }
  }
  return undefined;
});

/***/ },

/***/ "./src/global/actions/apiUpdaters/users.ts"
/*!*************************************************!*\
  !*** ./src/global/actions/apiUpdaters/users.ts ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _lib_teact_heavyAnimation__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/heavyAnimation */ "./src/lib/teact/heavyAnimation.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");




const updateStatusesOnFullyIdle = (0,_lib_teact_heavyAnimation__WEBPACK_IMPORTED_MODULE_0__.throttleWithFullyIdle)(flushStatusUpdates);
let pendingStatusUpdates = {};
function flushStatusUpdates() {
  let global = (0,_index__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.replaceUserStatuses)(global, {
    ...global.users.statusesById,
    ...pendingStatusUpdates
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
  pendingStatusUpdates = {};
}
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('apiUpdate', (global, actions, update) => {
  switch (update['@type']) {
    case 'deleteContact':
      {
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.deleteContact)(global, update.id);
      }
    case 'updateUser':
      {
        Object.values(global.byTabId).forEach(({
          id: tabId
        }) => {
          if ((0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsChatWithSelf)(global, update.id) && update.user.isPremium !== (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserPremium)(global)) {
            if (update.user.isPremium && global.byTabId[tabId].premiumModal) {
              actions.openPremiumModal({
                isSuccess: true,
                tabId
              });
            }

            // Reset translation cache cause premium provides additional formatting
            global = {
              ...global,
              translations: {
                byChatId: {}
              }
            };
          }
        });
        const localUser = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, update.id);
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUser)(global, update.id, update.user);
        if (update.fullInfo) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, update.id, update.fullInfo);
        }
        if (localUser?.areStoriesHidden !== update.user.areStoriesHidden) {
          global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updatePeerStoriesHidden)(global, update.id, update.user.areStoriesHidden || false);
        }
        return global;
      }
    case 'updateRequestUserUpdate':
      {
        actions.loadFullUser({
          userId: update.id
        });
        break;
      }
    case 'updateUserEmojiStatus':
      {
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUser)(global, update.userId, {
          emojiStatus: update.emojiStatus
        });
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateChat)(global, update.userId, {
          emojiStatus: update.emojiStatus
        });
        return global;
      }
    case 'updateUserStatus':
      {
        // Status updates come very often so we throttle them
        pendingStatusUpdates[update.userId] = update.status;
        updateStatusesOnFullyIdle();
        return undefined;
      }
    case 'updateUserFullInfo':
      {
        const {
          id,
          fullInfo
        } = update;
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, id, fullInfo);
      }
    case 'updateBotMenuButton':
      {
        const {
          botId,
          button
        } = update;
        const targetUserFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, botId);
        if (!targetUserFullInfo?.botInfo) {
          return undefined;
        }
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, botId, {
          botInfo: {
            ...targetUserFullInfo.botInfo,
            menuButton: button
          }
        });
      }
    case 'updateBotCommands':
      {
        const {
          botId,
          commands
        } = update;
        const targetUserFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, botId);
        if (!targetUserFullInfo?.botInfo) {
          return undefined;
        }
        return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, botId, {
          botInfo: {
            ...targetUserFullInfo.botInfo,
            commands
          }
        });
      }
    case 'updatePeerSettings':
      {
        const {
          id,
          settings
        } = update;
        const targetUserFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserFullInfo)(global, id);
        if (!targetUserFullInfo?.botInfo) {
          actions.loadFullUser({
            userId: id
          });
          return undefined;
        }
        global = (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateUserFullInfo)(global, id, {
          settings
        });
        return global;
      }
  }
  return undefined;
});

/***/ },

/***/ "./src/global/actions/ui/account.ts"
/*!******************************************!*\
  !*** ./src/global/actions/ui/account.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../.. */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");




(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openFrozenAccountModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    isFrozenAccountModalOpen: true
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeFrozenAccountModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    isFrozenAccountModalOpen: false
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openDeleteAccountModal', (global, actions, payload) => {
  const {
    days,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  if (!days) return;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    ...(0,_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global, tabId),
    deleteAccountModal: {
      selfDestructAccountDays: days
    }
  }, tabId);
  (0,___WEBPACK_IMPORTED_MODULE_1__.setGlobal)(global);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeDeleteAccountModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    deleteAccountModal: undefined
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openAgeVerificationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    isAgeVerificationModalOpen: true
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeAgeVerificationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    isAgeVerificationModalOpen: false
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/bots.ts"
/*!***************************************!*\
  !*** ./src/global/actions/ui/bots.ts ***!
  \***************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_bots__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/bots */ "./src/global/reducers/bots.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors/sharedState */ "./src/global/selectors/sharedState.ts");








(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openWebAppTab', (global, actions, payload) => {
  const {
    webApp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!webApp) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.addWebAppToOpenList)(global, webApp, true, true, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateWebApp', (global, actions, payload) => {
  const {
    key,
    update,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.updateWebApp)(global, key, update, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeActiveWebApp', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.removeActiveWebAppFromOpenList)(global, tabId);
  if (!(0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.hasOpenedWebApps)(global, tabId)) return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.replaceIsWebAppModalOpen)(global, false, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openMoreAppsTab', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    webApps: {
      ...tabState.webApps,
      activeWebAppKey: undefined,
      isMoreAppsTabActive: true
    }
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeMoreAppsTab', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId);
  const openedWebApps = tabState.webApps.openedWebApps;
  const openedWebAppsKeys = Object.keys(openedWebApps);
  const openedWebAppsCount = openedWebAppsKeys.length;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    webApps: {
      ...tabState.webApps,
      isMoreAppsTabActive: false,
      activeWebAppKey: openedWebAppsCount ? openedWebAppsKeys[openedWebAppsCount - 1] : undefined,
      isModalOpen: openedWebAppsCount > 0
    }
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeWebApp', (global, actions, payload) => {
  const {
    key,
    skipClosingConfirmation,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.removeWebAppFromOpenList)(global, key, skipClosingConfirmation, tabId);
  if (!(0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.hasOpenedWebApps)(global, tabId)) return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.replaceIsWebAppModalOpen)(global, false, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeWebAppModal', (global, actions, payload) => {
  const {
    shouldSkipConfirmation,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const shouldShowConfirmation = !shouldSkipConfirmation && !(0,_selectors_sharedState__WEBPACK_IMPORTED_MODULE_7__.selectSharedSettings)(global).shouldSkipWebAppCloseConfirmation && (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.hasOpenedMoreThanOneWebApps)(global, tabId);
  if (shouldShowConfirmation) {
    actions.openWebAppsCloseConfirmationModal({
      tabId
    });
    return global;
  }
  global = (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.clearOpenedWebApps)(global, tabId);
  if (!(0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.hasOpenedWebApps)(global, tabId)) return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.replaceIsWebAppModalOpen)(global, false, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('changeWebAppModalState', (global, actions, payload) => {
  const {
    state,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.replaceWebAppModalState)(global, state, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateMiniAppCachedPosition', (global, actions, payload) => {
  const {
    position
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateSharedSettings)(global, {
    miniAppsCachedPosition: position
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateMiniAppCachedSize', (global, actions, payload) => {
  const {
    size
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateSharedSettings)(global, {
    miniAppsCachedSize: size
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setWebAppPaymentSlug', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const activeWebApp = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectActiveWebApp)(global, tabId);
  if (!activeWebApp?.url) return undefined;
  const key = (0,_helpers__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(activeWebApp);
  return (0,_reducers_bots__WEBPACK_IMPORTED_MODULE_4__.updateWebApp)(global, key, {
    slug: payload.slug
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('cancelBotTrustRequest', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    botTrustRequest: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('markBotTrusted', (global, actions, payload) => {
  const {
    botId,
    isWriteAllowed,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const {
    trustedBotIds
  } = global;
  const newTrustedBotIds = new Set(trustedBotIds);
  newTrustedBotIds.add(botId);
  global = {
    ...global,
    trustedBotIds: Array.from(newTrustedBotIds)
  };
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global, tabId);
  if (tabState.botTrustRequest?.onConfirm) {
    const {
      action,
      payload: callbackPayload
    } = tabState.botTrustRequest.onConfirm;
    // @ts-expect-error -- No idea how to type this properly
    actions[action]({
      ...callbackPayload,
      isWriteAllowed
    });
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    botTrustRequest: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('sendWebAppEvent', (global, actions, payload) => {
  const {
    event,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const webApp = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectWebApp)(global, webAppKey, tabId);
  if (!webApp) return global;
  const newPlannedEvents = webApp.plannedEvents ? [...webApp.plannedEvents, event] : [event];
  actions.updateWebApp({
    key: webAppKey,
    update: {
      plannedEvents: newPlannedEvents
    },
    tabId
  });
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('cancelAttachBotInstall', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    requestedAttachBotInstall: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('requestAttachBotInChat', (global, actions, payload) => {
  const {
    bot,
    filter,
    startParam,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  const currentChatId = (0,_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global, tabId)?.chatId;
  const supportedFilters = bot.attachMenuPeerTypes?.filter(type => type !== 'self' && filter.includes(type));
  if (!supportedFilters?.length) {
    actions.callAttachBot({
      chatId: currentChatId || bot.id,
      bot,
      startParam,
      tabId
    });
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    requestedAttachBotInChat: {
      bot,
      filter: supportedFilters,
      startParam
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('cancelAttachBotInChat', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    requestedAttachBotInChat: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openEmojiStatusAccessModal', (global, actions, payload) => {
  const {
    bot,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!bot || !webAppKey) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    emojiStatusAccessModal: {
      bot,
      webAppKey
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeEmojiStatusAccessModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    emojiStatusAccessModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openLocationAccessModal', (global, actions, payload) => {
  const {
    bot,
    webAppKey,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (!bot || !webAppKey) return;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    locationAccessModal: {
      bot,
      webAppKey
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeLocationAccessModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_5__.updateTabState)(global, {
    locationAccessModal: undefined
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/chats.ts"
/*!****************************************!*\
  !*** ./src/global/actions/ui/chats.ts ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");








(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    type = 'thread',
    shouldReplaceHistory = false,
    shouldReplaceLast = false,
    noForumTopicPanel,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId);
  if (tabState.premiumModal?.promo && tabState.premiumModal?.isOpen) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
      premiumModal: {
        ...tabState.premiumModal,
        isOpen: false
      }
    }, tabId);
  }
  actions.hideEffectInComposer({
    tabId
  });
  actions.closeStoryViewer({
    tabId
  });
  actions.closeStarsBalanceModal({
    tabId
  });
  actions.closeStarsTransactionModal({
    tabId
  });
  actions.closeGiftInfoModal({
    tabId
  });
  if (!currentMessageList || currentMessageList.chatId !== chatId || currentMessageList.threadId !== threadId || currentMessageList.type !== type) {
    if (chatId) {
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [], tabId);
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
        activeReactions: {},
        shouldPreventComposerAnimation: true
      }, tabId);
      global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.closeMiddleSearch)(global, chatId, threadId, tabId);
    }
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.exitMessageSelectMode)(global, tabId);
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
      isStatisticsShown: false,
      monetizationStatistics: undefined,
      boostStatistics: undefined,
      contentToBeScheduled: undefined,
      ...(chatId !== (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).forwardMessages.toChatId && {
        forwardMessages: {},
        isShareMessageModalShown: false
      })
    }, tabId);
  }
  if (chatId) {
    const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
    if (chat?.isForum && !noForumTopicPanel) {
      actions.openForumPanel({
        chatId,
        tabId
      });
    } else if (chatId !== (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).forumPanelChatId) {
      actions.closeForumPanel({
        tabId
      });
    }
  }
  actions.updatePageTitle({
    tabId
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateCurrentMessageList)(global, chatId, threadId, type, shouldReplaceHistory, shouldReplaceLast, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openChatInNewTab', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID
  } = payload;
  const hashUrl = (0,_util_routing__WEBPACK_IMPORTED_MODULE_3__.createMessageHashUrl)(chatId, 'thread', threadId);
  if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_ELECTRON) {
    window.electron.openNewWindow(hashUrl);
  } else {
    window.open(hashUrl, '_blank');
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openPreviousChat', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  actions.updatePageTitle({
    tabId
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateCurrentMessageList)(global, undefined, undefined, undefined, undefined, undefined, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openChatWithInfo', (global, actions, payload) => {
  const {
    profileTab,
    forceScrollProfileTab = false,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId),
    isChatInfoShown: true,
    isChatAIShown: false,
    chatAISelectedMessages: undefined,
    nextProfileTab: profileTab,
    forceScrollProfileTab
  }, tabId);
  global = {
    ...global,
    lastIsChatInfoShown: true
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
  actions.openChat({
    ...payload,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openThreadWithInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId),
    isChatInfoShown: true,
    isChatAIShown: false,
    chatAISelectedMessages: undefined
  }, tabId);
  global = {
    ...global,
    lastIsChatInfoShown: true
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
  actions.openThread({
    ...payload,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openChatAIWithInfo', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    selectedMessages
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId),
    isChatAIShown: true,
    isUserPortraitShown: false,
    isChatInfoShown: false,
    chatAISelectedMessages: selectedMessages
  }, tabId);
  global = {
    ...global,
    lastIsChatInfoShown: true
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('clearChatAISelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    chatAISelectedMessages: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openUserPortrait', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)(),
    userId,
    chatId
  } = payload || {};
  const {
    chatId: currentChatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  if (chatId && chatId !== currentChatId) {
    actions.openChat({
      id: chatId,
      tabId
    });
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId),
    isUserPortraitShown: true,
    userPortraitUserId: userId
  }, tabId);
  global = {
    ...global
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_4__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openChatWithDraft', (global, actions, payload) => {
  const {
    chatId,
    text,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    files,
    filter,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  if (chatId) {
    actions.openThread({
      chatId,
      threadId,
      tabId
    });
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    requestedDraft: {
      chatId,
      text,
      files,
      filter
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('resetChatCreation', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    chatCreation: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('setNewChatMembersDialogState', (global, actions, payload) => {
  const {
    newChatMembersProgress,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    newChatMembersProgress
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openNextChat', (global, actions, payload) => {
  const {
    targetIndexDelta,
    orderedIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    actions.openChat({
      id: orderedIds[0],
      tabId
    });
    return;
  }
  const position = orderedIds.indexOf(chatId);
  if (position === -1) {
    return;
  }
  const nextId = orderedIds[position + targetIndexDelta];
  actions.openChat({
    id: nextId,
    shouldReplaceHistory: true,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('closeDeleteChatFolderModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    deleteFolderDialogModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('closeChatlistModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    chatlistModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('requestChatTranslation', (global, actions, payload) => {
  const {
    chatId,
    toLanguageCode,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_5__.updateRequestedChatTranslation)(global, chatId, toLanguageCode, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('closeChatInviteModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    chatInviteModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openCreditsModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    creditsModal: {
      isOpen: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('closeCreditsModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    creditsModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openInviteFriendsModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    inviteFriendsModal: {
      isOpen: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('closeInviteFriendsModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    inviteFriendsModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('openInviteCodeModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    inviteCodeModal: {
      isOpen: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_4__.addActionHandler)('closeInviteCodeModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    inviteCodeModal: undefined
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/credits.ts"
/*!******************************************!*\
  !*** ./src/global/actions/ui/credits.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");

(0,_index__WEBPACK_IMPORTED_MODULE_0__.addActionHandler)('updateSubscriptionInfo', (global, actions, payload) => {
  const {
    subscriptionType,
    creditBalance,
    createdAt,
    subscriptionExpiresAt,
    isExpirated
  } = payload;

  // Update global credits state
  global = {
    ...global,
    subscriptionInfo: {
      subscriptionType,
      creditBalance,
      createdAt,
      subscriptionExpiresAt,
      isExpirated
    }
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  return global;
});

/***/ },

/***/ "./src/global/actions/ui/globalSearch.ts"
/*!***********************************************!*\
  !*** ./src/global/actions/ui/globalSearch.ts ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





const MAX_RECENTLY_FOUND_IDS = 10;
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setGlobalSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    currentContent
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global, tabId).globalSearch;
  const fetchingStatus = query && currentContent !== _types__WEBPACK_IMPORTED_MODULE_0__.GlobalSearchContent.BotApps && currentContent !== _types__WEBPACK_IMPORTED_MODULE_0__.GlobalSearchContent.PublicPosts ? {
    chats: !chatId,
    messages: true
  } : undefined;
  actions.checkSearchPostsFlood({
    query,
    tabId
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateGlobalSearch)(global, {
    globalResults: {},
    localResults: {},
    resultsByType: undefined,
    fetchingStatus,
    query
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setGlobalSearchClosing', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)(),
    isClosing
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateGlobalSearch)(global, {
    isClosing
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('addRecentlyFoundChatId', (global, actions, payload) => {
  const {
    id
  } = payload;
  const {
    recentlyFoundChatIds
  } = global;
  if (!recentlyFoundChatIds) {
    return {
      ...global,
      recentlyFoundChatIds: [id]
    };
  }
  const newRecentIds = recentlyFoundChatIds.filter(chatId => chatId !== id);
  newRecentIds.unshift(id);
  if (newRecentIds.length > MAX_RECENTLY_FOUND_IDS) {
    newRecentIds.pop();
  }
  return {
    ...global,
    recentlyFoundChatIds: newRecentIds
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('clearRecentlyFoundChats', global => {
  return {
    ...global,
    recentlyFoundChatIds: undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setGlobalSearchContent', (global, actions, payload) => {
  const {
    content,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateGlobalSearchContent)(global, content, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setGlobalSearchChatId', (global, actions, payload) => {
  const {
    id,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateGlobalSearch)(global, {
    chatId: id,
    query: undefined,
    resultsByType: undefined
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/mediaViewer.ts"
/*!**********************************************!*\
  !*** ./src/global/actions/ui/mediaViewer.ts ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _helpers_replies__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_media__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../selectors/media */ "./src/global/selectors/media.ts");









(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openMediaViewer', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    messageId,
    timestamp,
    mediaIndex,
    isAvatarView,
    isSponsoredMessage,
    origin,
    withDynamicLoading,
    standaloneMedia,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...tabState.mediaViewer,
      chatId,
      threadId,
      messageId,
      mediaIndex: mediaIndex || 0,
      isAvatarView,
      isSponsoredMessage,
      origin,
      standaloneMedia,
      isHidden: false,
      withDynamicLoading,
      timestamp
    },
    forwardMessages: {},
    isShareMessageModalShown: false
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeMediaViewer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload || {};
  const {
    volume,
    isMuted,
    playbackRate,
    isHidden
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      volume,
      isMuted,
      isHidden,
      playbackRate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openMediaFromTimestamp', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    threadId,
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatMessage)(global, chatId, messageId);
  if (!message) return;
  const replyInfo = (0,_helpers_replies__WEBPACK_IMPORTED_MODULE_4__.getMessageReplyInfo)(message);
  const replyMessage = (0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectReplyMessage)(global, message);
  const messageMedia = (0,_selectors_media__WEBPACK_IMPORTED_MODULE_8__.selectTimestampableMedia)(global, message);
  const maxMessageDuration = messageMedia?.duration;
  if (maxMessageDuration) {
    if (maxMessageDuration <= timestamp) return;
    if (messageMedia.mediaType === 'video') {
      actions.openMediaViewer({
        chatId,
        messageId,
        threadId,
        origin: _types__WEBPACK_IMPORTED_MODULE_1__.MediaViewerOrigin.Inline,
        timestamp,
        tabId
      });
      return;
    }
    actions.openAudioPlayer({
      chatId,
      messageId,
      threadId,
      origin: _types__WEBPACK_IMPORTED_MODULE_1__.AudioOrigin.Inline,
      timestamp,
      tabId
    });
    return;
  }
  const replyMessageMedia = replyMessage ? (0,_selectors_media__WEBPACK_IMPORTED_MODULE_8__.selectTimestampableMedia)(global, replyMessage) : undefined;
  const maxReplyMessageDuration = replyMessageMedia?.duration;
  if (!maxReplyMessageDuration || maxReplyMessageDuration <= timestamp) return;
  if (replyMessageMedia.mediaType === 'video') {
    actions.openMediaViewer({
      chatId: replyMessage.chatId,
      messageId: replyMessage.id,
      threadId: replyInfo?.replyToTopId,
      origin: _types__WEBPACK_IMPORTED_MODULE_1__.MediaViewerOrigin.Inline,
      timestamp,
      tabId
    });
    return;
  }
  actions.openAudioPlayer({
    chatId: replyMessage.chatId,
    messageId: replyMessage.id,
    threadId: replyInfo?.replyToTopId,
    origin: _types__WEBPACK_IMPORTED_MODULE_1__.AudioOrigin.Inline,
    timestamp,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updateLastPlaybackTimestamp', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    timestamp
  } = payload;
  const currentChatPlaybacks = global.messages.playbackByChatId[chatId]?.byId || {};
  if (!timestamp) {
    return {
      ...global,
      messages: {
        ...global.messages,
        playbackByChatId: {
          ...global.messages.playbackByChatId,
          [chatId]: {
            byId: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.omit)(currentChatPlaybacks, [messageId])
          }
        }
      }
    };
  }
  return {
    ...global,
    messages: {
      ...global.messages,
      playbackByChatId: {
        ...global.messages.playbackByChatId,
        [chatId]: {
          byId: {
            ...currentChatPlaybacks,
            [messageId]: timestamp
          }
        }
      }
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setMediaViewerVolume', (global, actions, payload) => {
  const {
    volume,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer,
      volume,
      isMuted: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setMediaViewerPlaybackRate', (global, actions, payload) => {
  const {
    playbackRate,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  global = {
    ...global,
    mediaViewer: {
      ...global.mediaViewer,
      lastPlaybackRate: playbackRate
    }
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer,
      playbackRate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setMediaViewerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setMediaViewerHidden', (global, actions, payload) => {
  const {
    isHidden,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_6__.updateTabState)(global, {
    mediaViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global, tabId).mediaViewer,
      isHidden
    }
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/messages.ts"
/*!*******************************************!*\
  !*** ./src/global/actions/ui/messages.ts ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_animateScroll__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/animateScroll */ "./src/util/animateScroll.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _versionNotification_txt__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../versionNotification.txt */ "./src/versionNotification.txt");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_messageSummary__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../helpers/messageSummary */ "./src/global/helpers/messageSummary.ts");
/* harmony import */ var _helpers_meta__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../helpers/meta */ "./src/global/helpers/meta.ts");
/* harmony import */ var _helpers_peers__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _helpers_renderMessageSummaryHtml__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../helpers/renderMessageSummaryHtml */ "./src/global/helpers/renderMessageSummaryHtml.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_media__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _api_messages__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../api/messages */ "./src/global/actions/api/messages.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");

























const FOCUS_DURATION = 1500;
const FOCUS_NO_HIGHLIGHT_DURATION = _config__WEBPACK_IMPORTED_MODULE_2__.SCROLL_MAX_DURATION + _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_END_DELAY;
const POLL_RESULT_OPEN_DELAY_MS = 450;
const VERSION_NOTIFICATION_DURATION = 1000 * 60 * 60 * 24 * 3; // 3 days
const SERVICE_NOTIFICATIONS_MAX_AMOUNT = 1e3;
let blurTimeout;
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setScrollOffset', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    scrollOffset,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceThreadParam)(global, chatId, threadId, 'lastScrollOffset', scrollOffset);
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceTabThreadParam)(global, chatId, threadId, 'scrollOffset', scrollOffset, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setEditingId', (global, actions, payload) => {
  const {
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId,
    type
  } = currentMessageList;
  const paramName = type === 'scheduled' ? 'editingScheduledId' : 'editingId';
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceThreadParam)(global, chatId, threadId, paramName, messageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setEditingDraft', (global, actions, payload) => {
  const {
    text,
    chatId,
    threadId,
    type
  } = payload;
  const paramName = type === 'scheduled' ? 'editingScheduledDraft' : 'editingDraft';
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceThreadParam)(global, chatId, threadId, paramName, text);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('editLastMessage', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessages)(global, chatId);
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectViewportIds)(global, chatId, threadId, tabId);
  if (!chatMessages || !viewportIds) {
    return undefined;
  }
  const lastOwnEditableMessageId = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.findLast)(viewportIds, id => {
    return Boolean(chatMessages[id] && (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectAllowedMessageActionsSlow)(global, chatMessages[id], threadId).canEdit);
  });
  if (!lastOwnEditableMessageId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceThreadParam)(global, chatId, threadId, 'editingId', lastOwnEditableMessageId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('replyToNextMessage', (global, actions, payload) => {
  const {
    targetIndexDelta,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return;
  }
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessages)(global, chatId);
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectViewportIds)(global, chatId, threadId, tabId);
  if (!chatMessages || !viewportIds) {
    return;
  }
  const replyInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectDraft)(global, chatId, threadId)?.replyInfo;
  const isLatest = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsViewportNewest)(global, chatId, threadId, tabId);
  let messageId;
  if (!isLatest || !replyInfo?.replyToMsgId) {
    if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
      messageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, chatId);
    } else {
      const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectThreadInfo)(global, chatId, threadId);
      messageId = threadInfo?.lastMessageId;
    }
  } else {
    const chatMessageKeys = Object.keys(chatMessages);
    const indexOfCurrent = chatMessageKeys.indexOf(replyInfo.replyToMsgId.toString());
    const newIndex = indexOfCurrent + targetIndexDelta;
    messageId = newIndex <= chatMessageKeys.length + 1 && newIndex >= 0 ? Number(chatMessageKeys[newIndex]) : undefined;
  }
  actions.updateDraftReplyInfo({
    replyToMsgId: messageId,
    replyToPeerId: undefined,
    quoteText: undefined,
    tabId
  });
  actions.focusMessage({
    chatId,
    threadId,
    messageId: messageId,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openAudioPlayer', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    messageId,
    origin,
    volume,
    playbackRate,
    isMuted,
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      chatId,
      threadId,
      messageId,
      timestamp,
      origin: origin ?? tabState.audioPlayer.origin,
      volume: volume ?? tabState.audioPlayer.volume,
      playbackRate: playbackRate || tabState.audioPlayer.playbackRate || global.audioPlayer.lastPlaybackRate,
      isPlaybackRateActive: tabState.audioPlayer.isPlaybackRateActive === undefined ? global.audioPlayer.isLastPlaybackRateActive : tabState.audioPlayer.isPlaybackRateActive,
      isMuted: isMuted || tabState.audioPlayer.isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setAudioPlayerVolume', (global, actions, payload) => {
  const {
    volume,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).audioPlayer,
      volume,
      isMuted: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setAudioPlayerPlaybackRate', (global, actions, payload) => {
  const {
    playbackRate,
    isPlaybackRateActive,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = {
    ...global,
    audioPlayer: {
      ...global.audioPlayer,
      lastPlaybackRate: playbackRate,
      isLastPlaybackRateActive: isPlaybackRateActive
    }
  };
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).audioPlayer,
      playbackRate,
      isPlaybackRateActive
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setAudioPlayerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).audioPlayer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setAudioPlayerOrigin', (global, actions, payload) => {
  const {
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).audioPlayer,
      origin
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeAudioPlayer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    audioPlayer: {
      volume: tabState.audioPlayer.volume,
      playbackRate: tabState.audioPlayer.playbackRate,
      isPlaybackRateActive: tabState.audioPlayer.isPlaybackRateActive,
      isMuted: tabState.audioPlayer.isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPollResults', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const shouldOpenInstantly = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectIsRightColumnShown)(global, (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_23__.getIsMobile)(), tabId);
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!shouldOpenInstantly) {
    window.setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
      global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
        pollResults: {
          chatId,
          messageId,
          voters: {}
        }
      }, tabId);
      (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    }, POLL_RESULT_OPEN_DELAY_MS);
  } else if (chatId !== tabState.pollResults.chatId || messageId !== tabState.pollResults.messageId) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      pollResults: {
        chatId,
        messageId,
        voters: {}
      }
    }, tabId);
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePollResults', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    pollResults: {}
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('focusLastMessage', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId,
    type
  } = currentMessageList;
  const isSavedDialog = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  let lastMessageId;
  if (threadId === _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID) {
    if (type === 'pinned') {
      const pinnedMessageIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectPinnedIds)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID);
      if (!pinnedMessageIds?.length) {
        return;
      }
      lastMessageId = pinnedMessageIds[pinnedMessageIds.length - 1];
    } else {
      lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, chatId);
    }
  } else if (isSavedDialog) {
    lastMessageId = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, String(threadId), 'saved');
  } else {
    const threadInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectThreadInfo)(global, chatId, threadId);
    lastMessageId = threadInfo?.lastMessageId;
  }
  if (!lastMessageId) {
    return;
  }
  actions.focusMessage({
    chatId,
    threadId,
    messageListType: type,
    messageId: lastMessageId,
    noHighlight: true,
    noForumTopicPanel: true,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('focusNextReply', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return undefined;
  }
  const {
    chatId,
    threadId
  } = currentMessageList;
  const replyStack = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectReplyStack)(global, chatId, threadId, tabId);
  if (!replyStack || replyStack.length === 0) {
    actions.focusLastMessage({
      tabId
    });
  } else {
    const messageId = replyStack.pop();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [...replyStack], tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    actions.focusMessage({
      chatId,
      threadId,
      messageId: messageId,
      tabId,
      noForumTopicPanel: true
    });
  }
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('focusMessage', (global, actions, payload) => {
  const {
    chatId,
    threadId = _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID,
    messageListType = 'thread',
    noHighlight,
    groupedId,
    groupedChatId,
    replyMessageId,
    isResizingContainer,
    shouldReplaceHistory,
    noForumTopicPanel,
    quote,
    quoteOffset,
    scrollTargetPosition,
    timestamp,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  let {
    messageId
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  if (!chat) {
    actions.showNotification({
      message: (0,_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_8__.oldTranslate)('Conversation.ErrorInaccessibleMessage'),
      tabId
    });
    return undefined;
  }
  const onMessageReady = timestamp ? () => actions.openMediaFromTimestamp({
    chatId,
    threadId,
    messageId,
    timestamp,
    tabId
  }) : undefined;
  if (groupedId !== undefined) {
    const ids = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectForwardedMessageIdsByGroupId)(global, groupedChatId, groupedId);
    if (ids?.length) {
      [messageId] = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.compact)(ids);
    }
  }
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  const shouldSwitchChat = !currentMessageList || chatId !== currentMessageList.chatId || threadId !== currentMessageList.threadId || messageListType !== currentMessageList.type;
  if (blurTimeout) {
    clearTimeout(blurTimeout);
    blurTimeout = undefined;
  }
  blurTimeout = window.setTimeout(() => {
    global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusedMessage)({
      global
    }, tabId);
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusDirection)(global, undefined, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  }, noHighlight ? FOCUS_NO_HIGHLIGHT_DURATION : FOCUS_DURATION);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusedMessage)({
    global,
    chatId,
    messageId,
    threadId,
    noHighlight,
    isResizingContainer,
    quote,
    quoteOffset,
    scrollTargetPosition
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusDirection)(global, undefined, tabId);
  if (replyMessageId) {
    const replyStack = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectReplyStack)(global, chatId, threadId, tabId) || [];
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceTabThreadParam)(global, chatId, threadId, 'replyStack', [...replyStack, replyMessageId], tabId);
  }
  if (shouldSwitchChat) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusDirection)(global, _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Static, tabId);
  }
  const viewportIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectViewportIds)(global, chatId, threadId, tabId);
  if (viewportIds && viewportIds.includes(messageId)) {
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global, {
      forceOnHeavyAnimation: true
    });
    actions.openThread({
      chatId,
      threadId,
      type: messageListType,
      shouldReplaceHistory,
      noForumTopicPanel,
      tabId
    });
    onMessageReady?.();
    return undefined;
  }
  if (shouldSwitchChat) {
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.replaceTabThreadParam)(global, chatId, threadId, 'viewportIds', undefined, tabId);
  }
  if (viewportIds && !shouldSwitchChat) {
    const direction = messageId > viewportIds[0] ? _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Down : _types__WEBPACK_IMPORTED_MODULE_1__.FocusDirection.Up;
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.updateFocusDirection)(global, direction, tabId);
  }
  if ((0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_3__.isAnimatingScroll)()) {
    (0,_util_animateScroll__WEBPACK_IMPORTED_MODULE_3__.cancelScrollBlockingAnimation)();
  }
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global, {
    forceOnHeavyAnimation: true
  });
  actions.openThread({
    chatId,
    threadId,
    type: messageListType,
    shouldReplaceHistory,
    noForumTopicPanel,
    tabId
  });
  actions.loadViewportMessages({
    chatId,
    threadId,
    tabId,
    shouldForceRender: true,
    onLoaded: onMessageReady
  });
  return undefined;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setShouldPreventComposerAnimation', (global, actions, payload) => {
  const {
    shouldPreventComposerAnimation,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    shouldPreventComposerAnimation
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openReplyMenu', (global, actions, payload) => {
  const {
    fromChatId,
    messageId,
    quoteText,
    quoteOffset,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    replyingMessage: {
      fromChatId,
      messageId,
      quoteText,
      quoteOffset
    },
    isShareMessageModalShown: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openForwardMenu', (global, actions, payload) => {
  const {
    fromChatId,
    messageIds,
    storyId,
    groupedId,
    withMyScore,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  let groupedMessageIds;
  if (groupedId) {
    groupedMessageIds = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectMessageIdsByGroupId)(global, fromChatId, groupedId);
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      fromChatId,
      messageIds: groupedMessageIds || messageIds,
      storyId,
      withMyScore
    },
    isShareMessageModalShown: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('changeRecipient', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).forwardMessages,
      toChatId: undefined,
      noAuthors: false,
      noCaptions: false
    },
    isShareMessageModalShown: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setForwardNoAuthors', (global, actions, payload) => {
  const {
    noAuthors,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      ...tabState.forwardMessages,
      noAuthors,
      // `noCaptions` cannot be true when `noAuthors` is false
      noCaptions: noAuthors && tabState.forwardMessages.noCaptions
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setForwardNoCaptions', (global, actions, payload) => {
  const {
    noCaptions,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).forwardMessages,
      noCaptions,
      noAuthors: noCaptions // On other clients `noAuthors` updates together with `noCaptions`
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('setForwardCopyForward', (global, actions, payload) => {
  const {
    copyForward,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    forwardMessages: {
      ...tabState.forwardMessages,
      copyForward
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('exitForwardMode', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    isShareMessageModalShown: false,
    forwardMessages: {},
    replyingMessage: {}
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openForwardMenuForSelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId: fromChatId,
    messageIds
  } = tabState.selectedMessages;
  const forwardableMessageIds = messageIds.filter(id => {
    const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessage)(global, fromChatId, id);
    return message && (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCanForwardMessage)(global, message);
  });
  if (!forwardableMessageIds.length) {
    return;
  }
  actions.openForwardMenu({
    fromChatId,
    messageIds: forwardableMessageIds,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('cancelMediaDownload', (global, actions, payload) => {
  const {
    media,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const hash = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMediaHash)(media, 'download');
  if (!hash) return undefined;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.cancelMessageMediaDownload)(global, [hash], tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('cancelMediaHashDownloads', (global, actions, payload) => {
  const {
    mediaHashes,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.cancelMessageMediaDownload)(global, mediaHashes, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('downloadMedia', (global, actions, payload) => {
  const {
    media,
    originMessage,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const hash = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMediaHash)(media, 'download');
  if (!hash) return undefined;
  const size = 'size' in media ? media.size : 0;
  const metadata = {
    size,
    format: (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMediaFormat)(media, 'download'),
    filename: (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMediaFilename)(media),
    originChatId: originMessage?.chatId,
    originMessageId: originMessage?.id
  };
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.addActiveMediaDownload)(global, hash, metadata, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('downloadSelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId,
    messageIds
  } = tabState.selectedMessages;
  const {
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId) || {};
  const chatMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessages)(global, chatId);
  if (!chatMessages || !threadId) return;
  const messages = messageIds.map(id => chatMessages[id]).filter(message => (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectAllowedMessageActionsSlow)(global, message, threadId).canDownload);
  messages.forEach(message => {
    const media = (0,_selectors_media__WEBPACK_IMPORTED_MODULE_21__.selectMessageDownloadableMedia)(global, message);
    if (!media) return;
    actions.downloadMedia({
      media,
      originMessage: message,
      tabId
    });
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('enterMessageSelectMode', (global, actions, payload) => {
  const {
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const openChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentChat)(global, tabId);
  if (!openChat) {
    return global;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.enterMessageSelectMode)(global, openChat.id, messageId, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('toggleMessageSelection', (global, actions, payload) => {
  const {
    messageId,
    groupedId,
    childMessageIds,
    withShift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global, tabId);
  if (!currentMessageList) {
    return;
  }
  const {
    chatId,
    threadId,
    type: messageListType
  } = currentMessageList;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.toggleMessageSelection)(global, chatId, threadId, messageListType, messageId, groupedId, childMessageIds, withShift, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  if (global.shouldShowContextMenuHint) {
    actions.disableContextMenuHint();
    actions.showNotification({
      // eslint-disable-next-line @stylistic/max-len
      message: `To **edit** or **reply**, close this menu. Then ${_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV ? 'long tap' : 'right click'} on a message.`,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('disableContextMenuHint', global => {
  if (!global.shouldShowContextMenuHint) {
    return undefined;
  }
  return {
    ...global,
    shouldShowContextMenuHint: false
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('exitMessageSelectMode', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_18__.exitMessageSelectMode)(global, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPollModal', (global, actions, payload) => {
  const {
    isQuiz,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    pollModal: {
      isOpen: true,
      isQuiz
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePollModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    pollModal: {
      isOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openTodoListModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    forNewTask,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    todoListModal: {
      chatId,
      messageId,
      forNewTask
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_14__.addTabStateResetterAction)('closeTodoListModal', 'todoListModal');
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('checkVersionNotification', (global, actions) => {
  if (_config__WEBPACK_IMPORTED_MODULE_2__.RELEASE_DATETIME && Date.now() > Number(_config__WEBPACK_IMPORTED_MODULE_2__.RELEASE_DATETIME) + VERSION_NOTIFICATION_DURATION) {
    return;
  }
  const currentVersion = "0.0.30".split('.').slice(0, 2).join('.');
  const {
    serviceNotifications
  } = global;
  if (serviceNotifications.find(({
    version
  }) => version === currentVersion)) {
    return;
  }
  const message = {
    chatId: _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID,
    date: (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_10__.getServerTime)(),
    content: {
      text: (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_9__["default"])(_versionNotification_txt__WEBPACK_IMPORTED_MODULE_11__, true)
    },
    isOutgoing: false
  };
  actions.createServiceNotification({
    message: message,
    version: currentVersion
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('createServiceNotification', (global, actions, payload) => {
  const {
    message,
    version
  } = payload;
  const {
    serviceNotifications
  } = global;
  const maxId = Math.max((0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatLastMessageId)(global, _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID) || 0, ...serviceNotifications.map(({
    id
  }) => id));
  const fractionalPart = (serviceNotifications.length + 1) / SERVICE_NOTIFICATIONS_MAX_AMOUNT;
  // The fractional ID is made of the largest integer ID and an incremented fractional part
  const id = Math.floor(maxId) + fractionalPart;
  message.previousLocalId = message.id;
  message.id = id;
  const serviceNotification = {
    id,
    message,
    version,
    isUnread: true
  };
  global = {
    ...global,
    serviceNotifications: [...serviceNotifications.slice(-SERVICE_NOTIFICATIONS_MAX_AMOUNT), serviceNotification]
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
  actions.apiUpdate({
    '@type': 'newMessage',
    id: message.id,
    chatId: message.chatId,
    message
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openReactorListModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reactorModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeReactorListModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reactorModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openSeenByModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    seenByModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeSeenByModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    seenByModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPrivacySettingsNoticeModal', (global, actions, payload) => {
  const {
    chatId,
    isReadDate,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    privacySettingsNoticeModal: {
      chatId,
      isReadDate
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePrivacySettingsNoticeModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    privacySettingsNoticeModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openChatLanguageModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const activeLanguage = messageId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectRequestedMessageTranslationLanguage)(global, chatId, messageId, tabId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectRequestedChatTranslationLanguage)(global, chatId, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    chatLanguageModal: {
      chatId,
      messageId,
      activeLanguage
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeChatLanguageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    chatLanguageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('copySelectedMessages', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.selectedMessages) {
    return;
  }
  const {
    chatId,
    messageIds
  } = tabState.selectedMessages;
  copyTextForMessages(global, chatId, messageIds);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('copyMessagesByIds', (global, actions, payload) => {
  const {
    messageIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentChat)(global, tabId);
  if (!messageIds || messageIds.length === 0 || !chat) {
    return;
  }
  copyTextForMessages(global, chat.id, messageIds);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openOneTimeMediaModal', (global, actions, payload) => {
  const {
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    oneTimeMediaModal: {
      message
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeOneTimeMediaModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    oneTimeMediaModal: undefined
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeReportAdModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reportAdModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeReportModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reportModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPreviousReportAdModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const reportAdModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).reportAdModal;
  if (!reportAdModal) {
    return undefined;
  }
  if (reportAdModal.sections.length === 1) {
    actions.closeReportAdModal({
      tabId
    });
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reportAdModal: {
      ...reportAdModal,
      sections: reportAdModal.sections.slice(0, -1)
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPreviousReportModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const reportModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId).reportModal;
  if (!reportModal) {
    return undefined;
  }
  if (reportModal.sections.length === 1) {
    actions.closeReportModal({
      tabId
    });
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    reportModal: {
      ...reportModal,
      sections: reportModal.sections.slice(0, -1)
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openPaidReactionModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    paidReactionModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePaidReactionModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    paidReactionModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openSuggestMessageModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    suggestMessageModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeSuggestMessageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    suggestMessageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openSuggestedPostApprovalModal', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    suggestedPostApprovalModal: {
      chatId,
      messageId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeSuggestedPostApprovalModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    suggestedPostApprovalModal: undefined
  }, tabId);
});
function copyTextForMessages(global, chatId, messageIds) {
  const {
    type: messageListType,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectCurrentMessageList)(global) || {};
  const lang = _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_8__.oldTranslate;
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChat)(global, chatId);
  const chatMessages = messageListType === 'scheduled' ? (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatScheduledMessages)(global, chatId) : (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectChatMessages)(global, chatId);
  if (!chat || !chatMessages || !threadId) return;
  const messages = messageIds.map(id => chatMessages[id]).filter(message => (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectAllowedMessageActionsSlow)(global, message, threadId).canCopy).sort((message1, message2) => message1.id - message2.id);
  const resultHtml = [];
  const resultText = [];
  messages.forEach(message => {
    const sender = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.isChatChannel)(chat) ? chat : (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectSender)(global, message);
    const senderTitle = `> ${sender ? (0,_helpers_peers__WEBPACK_IMPORTED_MODULE_15__.getPeerTitle)(lang, sender) : message.forwardInfo?.hiddenUserName || ''}:`;
    const statefulContent = (0,_helpers__WEBPACK_IMPORTED_MODULE_12__.getMessageStatefulContent)(global, message);
    resultHtml.push(senderTitle);
    resultHtml.push(`${(0,_helpers_renderMessageSummaryHtml__WEBPACK_IMPORTED_MODULE_16__.renderMessageSummaryHtml)(lang, message)}\n`);
    resultText.push(senderTitle);
    resultText.push(`${(0,_helpers_messageSummary__WEBPACK_IMPORTED_MODULE_13__.getMessageSummaryText)(lang, message, statefulContent, false, 0, true)}\n`);
  });
  (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_5__.copyHtmlToClipboard)(resultHtml.join('\n'), resultText.join('\n'));
}
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openDeleteMessageModal', (global, actions, payload) => {
  const {
    chatId,
    messageIds,
    isSchedule,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload;
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    deleteMessageModal: {
      chatId,
      messageIds,
      isSchedule
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeDeleteMessageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    deleteMessageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openRoomAttachmentsModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    isRoomAttachmentsModalOpen: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeRoomAttachmentsModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    isRoomAttachmentsModalOpen: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('openAboutAdsModal', (global, actions, payload) => {
  const {
    randomId,
    additionalInfo,
    canReport,
    sponsorInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    aboutAdsModal: {
      randomId,
      canReport,
      additionalInfo,
      sponsorInfo
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeAboutAdsModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    aboutAdsModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closePreparedInlineMessageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    preparedMessageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('closeSharePreparedMessageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    sharePreparedMessageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_17__.addActionHandler)('updateSharePreparedMessageModalSendArgs', async (global, actions, payload) => {
  const {
    args,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_6__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_20__.selectTabState)(global, tabId);
  if (!tabState.sharePreparedMessageModal) {
    return;
  }
  if (!args) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
      sharePreparedMessageModal: {
        ...tabState.sharePreparedMessageModal,
        pendingSendArgs: undefined
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
    return;
  }
  const starsForSendMessage = await (0,_api_messages__WEBPACK_IMPORTED_MODULE_22__.getPeerStarsForMessage)(global, args.peerId);
  global = (0,_index__WEBPACK_IMPORTED_MODULE_17__.getGlobal)();
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_19__.updateTabState)(global, {
    sharePreparedMessageModal: {
      ...tabState.sharePreparedMessageModal,
      pendingSendArgs: {
        peerId: args.peerId,
        threadId: args.threadId,
        starsForSendMessage
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_17__.setGlobal)(global);
});

/***/ },

/***/ "./src/global/actions/ui/middleSearch.ts"
/*!***********************************************!*\
  !*** ./src/global/actions/ui/middleSearch.ts ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");





(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openMiddleSearch', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateMiddleSearch)(global, chatId, threadId, {}, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeMiddleSearch', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.closeMiddleSearch)(global, chatId, threadId, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateMiddleSearch', (global, actions, payload) => {
  const {
    update,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  let chatId;
  let threadId;
  if (payload.chatId) {
    chatId = payload.chatId;
    threadId = payload.threadId || _api_types__WEBPACK_IMPORTED_MODULE_0__.MAIN_THREAD_ID;
  } else {
    const currentMessageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId);
    if (!currentMessageList) {
      return undefined;
    }
    chatId = currentMessageList.chatId;
    threadId = currentMessageList.threadId;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateMiddleSearch)(global, chatId, threadId, update, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('resetMiddleSearch', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.resetMiddleSearch)(global, chatId, threadId, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setSharedMediaSearchType', (global, actions, payload) => {
  const {
    mediaType,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    chatId,
    threadId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId || !threadId) {
    return undefined;
  }
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateSharedMediaSearchType)(global, chatId, threadId, mediaType, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/misc.ts"
/*!***************************************!*\
  !*** ./src/global/actions/ui/misc.ts ***!
  \***************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   APP_VERSION_URL: () => (/* binding */ APP_VERSION_URL)
/* harmony export */ });
/* harmony import */ var _lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teactn */ "./src/lib/teact/teactn.tsx");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_generateUniqueId__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/generateUniqueId */ "./src/util/generateUniqueId.ts");
/* harmony import */ var _util_getIsAppUpdateNeeded__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/getIsAppUpdateNeeded */ "./src/util/getIsAppUpdateNeeded.ts");
/* harmony import */ var _util_getReadableErrorText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/getReadableErrorText */ "./src/util/getReadableErrorText.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_localization__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/localization */ "./src/util/localization/index.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _util_updateIcon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/updateIcon */ "./src/util/updateIcon.ts");
/* harmony import */ var _util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/updatePageTitle */ "./src/util/updatePageTitle.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _selectors_sharedState__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");



















const APP_VERSION_URL = 'version.txt';
const FLOOD_PREMIUM_WAIT_NOTIFICATION_DURATION = 6000;
const MAX_STORED_EMOJIS = 8 * 4; // Represents four rows of recent emojis

(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleChatInfo', (global, actions, payload) => {
  const {
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const isChatInfoShown = force !== undefined ? force : !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).isChatInfoShown;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isChatInfoShown
  }, tabId);
  global = {
    ...global,
    lastIsChatInfoShown: isChatInfoShown
  };
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleChatAIInfo', (global, actions, payload) => {
  const {
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const isChatAIShown = force !== undefined ? force : !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).isChatAIShown;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isChatAIShown
  }, tabId);
  global = {
    ...global
  };
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleUserPortrait', (global, actions, payload) => {
  const {
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const isUserPortraitShown = force !== undefined ? force : !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).isUserPortraitShown;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isUserPortraitShown
  }, tabId);
  global = {
    ...global
  };
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setLeftColumnWidth', (global, actions, payload) => {
  const {
    leftColumnWidth
  } = payload;
  return {
    ...global,
    leftColumnWidth
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('resetLeftColumnWidth', global => {
  return {
    ...global,
    leftColumnWidth: undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleManagement', (global, actions, payload) => {
  const {
    force,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: force !== undefined ? force : !(tabState.management.byChatId[chatId] || {}).isActive
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('requestNextManagementScreen', (global, actions, payload) => {
  const {
    screen,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: true,
          nextScreen: screen
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeManagement', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    management: {
      byChatId: {
        ...tabState.management.byChatId,
        [chatId]: {
          ...tabState.management.byChatId[chatId],
          isActive: false
        }
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (!(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_18__.getIsMobile)() && !(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_18__.getIsTablet)()) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isLeftColumnShown: (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).messageLists.length === 0
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('resetNextProfileTab', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const {
    chatId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId) || {};
  if (!chatId) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    nextProfileTab: undefined,
    forceScrollProfileTab: false
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isStatisticsShown: !tabState.isStatisticsShown,
    statistics: {
      ...tabState.statistics,
      currentMessageId: undefined,
      currentStoryId: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleMessageStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)(),
    messageId
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    statistics: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).statistics,
      currentMessageId: messageId,
      currentMessage: undefined,
      currentStoryId: undefined,
      currentStory: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleStoryStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)(),
    storyId
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    statistics: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).statistics,
      currentStoryId: storyId,
      currentMessageId: undefined,
      currentMessage: undefined,
      currentStory: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleLeftColumn', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isLeftColumnShown: !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).isLeftColumnShown
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('addRecentEmoji', (global, actions, payload) => {
  const {
    emoji
  } = payload;
  const {
    recentEmojis
  } = global;
  if (!recentEmojis) {
    return {
      ...global,
      recentEmojis: [emoji]
    };
  }
  const newEmojis = recentEmojis.filter(e => e !== emoji);
  newEmojis.unshift(emoji);
  if (newEmojis.length > MAX_STORED_EMOJIS) {
    newEmojis.pop();
  }
  return {
    ...global,
    recentEmojis: newEmojis
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('addRecentSticker', (global, actions, payload) => {
  const {
    sticker
  } = payload;
  const {
    recent
  } = global.stickers;
  if (!recent) {
    return {
      ...global,
      stickers: {
        ...global.stickers,
        recent: {
          hash: '0',
          stickers: [sticker]
        }
      }
    };
  }
  const newStickers = recent.stickers.filter(s => s.id !== sticker.id);
  newStickers.unshift(sticker);
  return {
    ...global,
    stickers: {
      ...global.stickers,
      recent: {
        ...recent,
        stickers: newStickers
      }
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('addRecentCustomEmoji', (global, actions, payload) => {
  const {
    documentId
  } = payload;
  const {
    recentCustomEmojis
  } = global;
  if (!recentCustomEmojis) {
    return {
      ...global,
      recentCustomEmojis: [documentId]
    };
  }
  const newEmojis = recentCustomEmojis.filter(id => id !== documentId);
  newEmojis.unshift(documentId);
  if (newEmojis.length > MAX_STORED_EMOJIS) {
    newEmojis.pop();
  }
  return {
    ...global,
    recentCustomEmojis: newEmojis
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('clearRecentCustomEmoji', global => {
  return {
    ...global,
    recentCustomEmojis: []
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('reorderStickerSets', (global, actions, payload) => {
  const {
    order,
    isCustomEmoji
  } = payload;
  return {
    ...global,
    stickers: {
      ...global.stickers,
      added: {
        setIds: !isCustomEmoji ? order : global.stickers.added.setIds
      }
    },
    customEmojis: {
      ...global.customEmojis,
      added: {
        setIds: isCustomEmoji ? order : global.customEmojis.added.setIds
      }
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('showNotification', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)(),
    ...notification
  } = payload;
  const hasLocalId = notification.localId;
  notification.localId || (notification.localId = (0,_util_generateUniqueId__WEBPACK_IMPORTED_MODULE_5__["default"])());
  const newNotifications = [...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).notifications];
  const existingNotificationIndex = newNotifications.findIndex(n => hasLocalId ? n.localId === notification.localId : n.message === notification.message);
  if (existingNotificationIndex !== -1) {
    newNotifications.splice(existingNotificationIndex, 1);
  }
  newNotifications.push(notification);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    notifications: newNotifications
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('showAllowedMessageTypesNotification', (global, actions, payload) => {
  const {
    chatId,
    messageListType,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const paidMessagesStars = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectPeerPaidMessagesStars)(global, chatId);
  if (paidMessagesStars && messageListType === 'scheduled') {
    actions.showNotification({
      message: {
        key: 'DescriptionScheduledPaidMessagesNotAllowed'
      },
      tabId
    });
    return;
  }
  const chat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
  if (!chat) return;
  const chatFullInfo = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatFullInfo)(global, chatId);
  const isSavedMessages = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatWithSelf)(global, chatId) : undefined;
  const isChatWithBot = chatId ? (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsChatWithBot)(global, chat) : undefined;
  const {
    canSendPlainText,
    canSendPhotos,
    canSendVideos,
    canSendDocuments,
    canSendAudios,
    canSendStickers,
    canSendRoundVideos,
    canSendVoices
  } = (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getAllowedAttachmentOptions)(chat, chatFullInfo, isChatWithBot, isSavedMessages);
  const allowedContent = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.compact)([canSendPlainText ? 'Chat.SendAllowedContentTypeText' : undefined, canSendPhotos ? 'Chat.SendAllowedContentTypePhoto' : undefined, canSendVideos ? 'Chat.SendAllowedContentTypeVideo' : undefined, canSendVoices ? 'Chat.SendAllowedContentTypeVoiceMessage' : undefined, canSendRoundVideos ? 'Chat.SendAllowedContentTypeVideoMessage' : undefined, canSendDocuments ? 'Chat.SendAllowedContentTypeFile' : undefined, canSendAudios ? 'Chat.SendAllowedContentTypeMusic' : undefined, canSendStickers ? 'Chat.SendAllowedContentTypeSticker' : undefined]).map(l => _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate(l));
  if (!allowedContent.length) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate('Chat.SendNotAllowedText'),
      tabId
    });
    return;
  }
  const lastDelimiter = _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate('AutoDownloadSettings.LastDelimeter');
  const allowedContentString = allowedContent.join(', ').replace(/,([^,]*)$/, `${lastDelimiter}$1`);
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate('Chat.SendAllowedContentText', allowedContentString),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('dismissNotification', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const newNotifications = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).notifications.filter(({
    localId
  }) => localId !== payload.localId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    notifications: newNotifications
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('showDialog', (global, actions, payload) => {
  const {
    data,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;

  // Filter out errors that we don't want to show to the user
  if ('message' in data && data.hasErrorKey && !(0,_util_getReadableErrorText__WEBPACK_IMPORTED_MODULE_7__["default"])(data)) {
    return global;
  }
  const newDialogs = [...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).dialogs];
  if ('message' in data) {
    const existingErrorIndex = newDialogs.findIndex(err => err.message === data.message);
    if (existingErrorIndex !== -1) {
      newDialogs.splice(existingErrorIndex, 1);
    }
  }
  newDialogs.push(data);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    dialogs: newDialogs
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('dismissDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const newDialogs = [...(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId).dialogs];
  newDialogs.pop();
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    dialogs: newDialogs
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('toggleSafeLinkModal', (global, actions, payload) => {
  const {
    url: safeLinkModalUrl,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    safeLinkModalUrl
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openHistoryCalendar', (global, actions, payload) => {
  const {
    selectedAt,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    historyCalendarSelectedAt: selectedAt
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeHistoryCalendar', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    historyCalendarSelectedAt: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openGame', (global, actions, payload) => {
  const {
    url,
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChatMessage)(global, chatId, messageId);
  if (!message) return;
  const botId = message.viaBotId || (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectSender)(global, message)?.id;
  if (!botId) return;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsTrustedBot)(global, botId)) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
      botTrustRequest: {
        botId,
        type: 'game',
        onConfirm: {
          action: 'openGame',
          payload
        }
      }
    }, tabId);
    (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    return;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedGame: {
      url,
      chatId,
      messageId
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeGame', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedGame: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('requestConfetti', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)(),
    ...rest
  } = payload;
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCanAnimateInterface)(global)) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    confetti: {
      lastConfettiTime: Date.now(),
      ...rest
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('requestWave', (global, actions, payload) => {
  const {
    startX,
    startY,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_WAVE_TRANSFORM_SUPPORTED || !(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCanAnimateInterface)(global)) return undefined;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, tabId);
  const currentLastTime = tabState.wave?.lastWaveTime || 0;
  if (Date.now() - currentLastTime < _config__WEBPACK_IMPORTED_MODULE_1__.ANIMATION_WAVE_MIN_INTERVAL) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    wave: {
      lastWaveTime: Date.now(),
      startX,
      startY
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updateAttachmentSettings', (global, actions, payload) => {
  return {
    ...global,
    attachmentSettings: {
      ...global.attachmentSettings,
      ...payload
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('requestEffectInComposer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    shouldPlayEffectInComposer: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('hideEffectInComposer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    shouldPlayEffectInComposer: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setPaidMessageAutoApprove', global => {
  global = {
    ...global,
    settings: {
      ...global.settings,
      byKey: {
        ...global.settings.byKey,
        shouldPaidMessageAutoApprove: true
      }
    }
  };
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setReactionEffect', (global, actions, payload) => {
  const {
    chatId,
    threadId,
    reaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  const emoticon = reaction?.type === 'emoji' && reaction.emoticon;
  if (!emoticon) return;
  const effect = Object.values(global.availableEffectById).find(currentEffect => currentEffect.effectAnimationId && currentEffect.emoticon === emoticon);
  const effectId = effect?.id;
  const isCurrentUserPremium = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectIsCurrentUserPremium)(global);
  if (effect?.isPremium && !isCurrentUserPremium) {
    actions.openPremiumModal({
      initialSection: 'effects',
      tabId
    });
    return;
  }
  if (!effectId) return;
  actions.requestEffectInComposer({
    tabId
  });
  actions.saveEffectInDraft({
    chatId,
    threadId,
    effectId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openLimitReachedModal', (global, actions, payload) => {
  const {
    limit,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    limitReachedModal: {
      limit
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeLimitReachedModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    limitReachedModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeStickerSetModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedStickerSetShortName: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openCustomEmojiSets', (global, actions, payload) => {
  const {
    setIds,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedCustomEmojiSetIds: setIds
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeCustomEmojiSets', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    openedCustomEmojiSetIds: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updateLastRenderedCustomEmojis', (global, actions, payload) => {
  const {
    ids
  } = payload;
  const {
    lastRendered
  } = global.customEmojis;
  return {
    ...global,
    customEmojis: {
      ...global.customEmojis,
      lastRendered: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_8__.unique)([...lastRendered, ...ids]).slice(0, _config__WEBPACK_IMPORTED_MODULE_1__.GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT)
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openCreateTopicPanel', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;

  // Topic panel can be opened only if there is a selected chat
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
  if (!currentChat) actions.openChat({
    id: chatId,
    tabId
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    createTopicPanel: {
      chatId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeCreateTopicPanel', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    createTopicPanel: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openEditTopicPanel', (global, actions, payload) => {
  const {
    chatId,
    topicId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;

  // Topic panel can be opened only if there is a selected chat
  const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentChat)(global, tabId);
  if (!currentChat) actions.openChat({
    id: chatId,
    tabId
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    editTopicPanel: {
      chatId,
      topicId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeEditTopicPanel', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    editTopicPanel: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updateArchiveSettings', (global, actions, payload) => {
  const {
    archiveSettings
  } = global;
  const {
    isHidden = archiveSettings.isHidden,
    isMinimized = archiveSettings.isMinimized
  } = payload;
  return {
    ...global,
    archiveSettings: {
      isHidden,
      isMinimized
    }
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openMapModal', (global, actions, payload) => {
  const {
    geoPoint,
    zoom,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    mapModal: {
      point: geoPoint,
      zoom
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeMapModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    mapModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('checkAppVersion', global => {
  fetch(`${APP_VERSION_URL}?${Date.now()}`).then(response => response.text()).then(version => {
    version = version.trim();
    if ((0,_util_getIsAppUpdateNeeded__WEBPACK_IMPORTED_MODULE_6__["default"])(version, "0.0.30")) {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      global = {
        ...global,
        isAppUpdateAvailable: true
      };
      (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
    }
  }).catch(err => {
    if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG) {
      // eslint-disable-next-line no-console
      console.error('[checkAppVersion failed] ', err);
    }
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setIsElectronUpdateAvailable', (global, action, payload) => {
  global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
  global = {
    ...global,
    isElectronUpdateAvailable: Boolean(payload.isAvailable)
  };
  (0,_index__WEBPACK_IMPORTED_MODULE_14__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('afterHangUp', global => {
  if (!(0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()).multitabNextAction) return;
  (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.reestablishMasterToSelf)();
});
let notificationInterval;
const NOTIFICATION_INTERVAL = 500;
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('onTabFocusChange', (global, actions, payload) => {
  const {
    isBlurred,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  if (isBlurred) {
    if (notificationInterval) clearInterval(notificationInterval);
    notificationInterval = window.setInterval(() => {
      actions.updatePageTitle({
        tabId
      });
    }, NOTIFICATION_INTERVAL);
  } else {
    clearInterval(notificationInterval);
    notificationInterval = undefined;
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    isBlurred
  }, tabId);
  return {
    ...global,
    initialUnreadNotifications: isBlurred ? (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_4__.getAllNotificationsCount)() : undefined
  };
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('updatePageTitle', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  const {
    canDisplayChatInTitle
  } = (0,_selectors_sharedState__WEBPACK_IMPORTED_MODULE_17__.selectSharedSettings)(global);
  const currentUserId = global.currentUserId;
  const isTestServer = global.config?.isTestServer;
  const prefix = isTestServer ? '[T] ' : '';
  if (document.title.includes(_config__WEBPACK_IMPORTED_MODULE_1__.INACTIVE_MARKER)) {
    (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_11__["default"])(false);
    (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitleInstant)(`${prefix}${_config__WEBPACK_IMPORTED_MODULE_1__.PAGE_TITLE} ${_config__WEBPACK_IMPORTED_MODULE_1__.INACTIVE_MARKER}`);
    return;
  }
  if (global.initialUnreadNotifications && Math.round(Date.now() / 1000) % 2 === 0) {
    const notificationCount = (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_4__.getAllNotificationsCount)();
    const newUnread = notificationCount - global.initialUnreadNotifications;
    if (newUnread > 0) {
      (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitleInstant)(`${prefix}${newUnread} notification${newUnread > 1 ? 's' : ''}`);
      (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_11__["default"])(true);
      return;
    }
  }
  (0,_util_updateIcon__WEBPACK_IMPORTED_MODULE_11__["default"])(false);
  const messageList = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectCurrentMessageList)(global, tabId);
  if (messageList && canDisplayChatInTitle && !global.passcode.isScreenLocked) {
    const {
      chatId,
      threadId
    } = messageList;
    const currentChat = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectChat)(global, chatId);
    if (currentChat) {
      const title = (0,_helpers__WEBPACK_IMPORTED_MODULE_13__.getChatTitle)(_util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate, currentChat, chatId === currentUserId);
      const topic = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTopic)(global, chatId, threadId);
      if (currentChat.isForum && topic) {
        (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitle)(`${prefix}${title}  ${topic.title}`);
        return;
      }
      (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitle)(`${prefix}${title}`);
      return;
    }
  }
  (0,_util_updatePageTitle__WEBPACK_IMPORTED_MODULE_12__.setPageTitleInstant)(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_ELECTRON ? '' : `${prefix}${_config__WEBPACK_IMPORTED_MODULE_1__.PAGE_TITLE}`);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeInviteViaLinkModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload ?? {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    inviteViaLinkModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeCollectibleInfoModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload ?? {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    collectibleInfoModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('setShouldCloseRightColumn', (global, actions, payload) => {
  const {
    value,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    shouldCloseRightColumn: value
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('refreshLangPackFromCache', (global, actions, payload) => {
  (0,_util_localization__WEBPACK_IMPORTED_MODULE_9__.refreshFromCache)(payload.langCode);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('processPremiumFloodWait', (global, actions, payload) => {
  const {
    isUpload
  } = payload;
  const {
    bandwidthPremiumDownloadSpeedup,
    bandwidthPremiumUploadSpeedup,
    bandwidthPremiumNotifyPeriod
  } = global.appConfig || {};
  const {
    lastPremiumBandwithNotificationDate: lastNotifiedAt
  } = global.settings;
  if (!bandwidthPremiumDownloadSpeedup || !bandwidthPremiumUploadSpeedup || !bandwidthPremiumNotifyPeriod) {
    return undefined;
  }
  if (lastNotifiedAt && Date.now() < lastNotifiedAt + bandwidthPremiumNotifyPeriod * 1000) return undefined;
  const unblurredTabIds = Object.values(global.byTabId).filter(l => !l.isBlurred).map(l => l.id);
  unblurredTabIds.forEach(tabId => {
    actions.showNotification({
      title: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate(isUpload ? 'UploadSpeedLimited' : 'DownloadSpeedLimited'),
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_10__.oldTranslate(isUpload ? 'UploadSpeedLimitedMessage' : 'DownloadSpeedLimitedMessage', isUpload ? bandwidthPremiumUploadSpeedup : bandwidthPremiumDownloadSpeedup),
      duration: FLOOD_PREMIUM_WAIT_NOTIFICATION_DURATION,
      tabId
    });
  });
  return {
    ...global,
    settings: {
      ...global.settings,
      lastPremiumBandwithNotificationDate: Date.now()
    }
  };
});
let prevIsScreenLocked;
let prevBlurredTabsCount = 0;
let onlineTimeout;
const ONLINE_TIMEOUT = 100;
(0,_lib_teact_teactn__WEBPACK_IMPORTED_MODULE_0__.addCallback)(global => {
  const {
    updatePageTitle,
    updateIsOnline
  } = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getActions)();
  const isLockedUpdated = global.passcode.isScreenLocked !== prevIsScreenLocked;
  const blurredTabsCount = Object.values(global.byTabId).filter(l => l.isBlurred).length;
  const isMasterTab = (0,_selectors__WEBPACK_IMPORTED_MODULE_16__.selectTabState)(global, (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()).isMasterTab;
  if (isLockedUpdated) {
    updatePageTitle();
  }
  if (blurredTabsCount !== prevBlurredTabsCount && isMasterTab) {
    if (onlineTimeout) clearTimeout(onlineTimeout);
    onlineTimeout = window.setTimeout(() => {
      global = (0,_index__WEBPACK_IMPORTED_MODULE_14__.getGlobal)();
      const newBlurredTabsCount = Object.values(global.byTabId).filter(l => l.isBlurred).length;
      updateIsOnline({
        isOnline: newBlurredTabsCount !== (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getAllMultitabTokens)().length
      });
    }, ONLINE_TIMEOUT);
  }
  prevIsScreenLocked = global.passcode.isScreenLocked;
  prevBlurredTabsCount = blurredTabsCount;
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closePayPackageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    payPackageModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openPayPackageModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    payPackageModal: {
      isOpen: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('closeCreditLimitModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    creditLimitModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_14__.addActionHandler)('openCreditLimitModal', (global, actions, payload) => {
  const {
    title,
    message,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_3__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_15__.updateTabState)(global, {
    creditLimitModal: {
      isOpen: true,
      title,
      message
    }
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/passcode.ts"
/*!*******************************************!*\
  !*** ./src/global/actions/ui/passcode.ts ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_passcode__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/passcode */ "./src/util/passcode.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _util_sessions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/sessions */ "./src/util/sessions.ts");
/* harmony import */ var _cache__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../cache */ "./src/global/cache.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _initialState__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../initialState */ "./src/global/initialState.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");











let noLockOnUnload = false;
(0,_util_schedulers__WEBPACK_IMPORTED_MODULE_5__.onBeforeUnload)(() => {
  const global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  if (!global.isInited) return;
  if (global.passcode.hasPasscode && !noLockOnUnload && Object.keys(global.byTabId).length === 1) {
    (0,_util_sessions__WEBPACK_IMPORTED_MODULE_6__.clearStoredSession)();
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('setPasscode', async (global, actions, payload) => {
  const {
    passcode,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.getCurrentTabId)()
  } = payload;
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    isLoading: true
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  await (0,_util_passcode__WEBPACK_IMPORTED_MODULE_4__.setupPasscode)(passcode);
  const sessionJson = JSON.stringify({
    ...(0,_util_sessions__WEBPACK_IMPORTED_MODULE_6__.loadStoredSession)(),
    userId: global.currentUserId
  });
  global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  const globalJson = (0,_cache__WEBPACK_IMPORTED_MODULE_7__.serializeGlobal)((0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    hasPasscode: true,
    error: undefined,
    isLoading: false
  }));
  try {
    await (0,_util_passcode__WEBPACK_IMPORTED_MODULE_4__.encryptSession)(sessionJson, globalJson);
    (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.signalPasscodeHash)();
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
      hasPasscode: true,
      error: undefined,
      isLoading: false
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    (0,_cache__WEBPACK_IMPORTED_MODULE_7__.forceUpdateCache)(true);
  } catch (err) {
    (0,_util_passcode__WEBPACK_IMPORTED_MODULE_4__.forgetPasscode)();
    global = (0,_index__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
      isLoading: false
    });
    (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
    actions.showNotification({
      message: 'Failed to set passcode',
      tabId
    });
    actions.openSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_0__.SettingsScreens.PasscodeDisabled,
      tabId
    });
  }
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('clearPasscode', global => {
  void (0,_util_passcode__WEBPACK_IMPORTED_MODULE_4__.clearEncryptedSession)();
  localStorage.removeItem(_config__WEBPACK_IMPORTED_MODULE_1__.IS_SCREEN_LOCKED_CACHE_KEY);
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.clearPasscodeSettings)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('unlockScreen', (global, actions, payload) => {
  const beforeTabStates = Object.values(global.byTabId);
  const {
    sessionJson,
    globalJson
  } = payload;
  const session = JSON.parse(sessionJson);
  (0,_util_sessions__WEBPACK_IMPORTED_MODULE_6__.storeSession)(session);
  const previousGlobal = global;
  global = JSON.parse(globalJson);
  global.byTabId = previousGlobal.byTabId;
  (0,_cache__WEBPACK_IMPORTED_MODULE_7__.migrateCache)(global, (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_3__.cloneDeep)(_initialState__WEBPACK_IMPORTED_MODULE_9__.INITIAL_GLOBAL_STATE));
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    isScreenLocked: false,
    error: undefined,
    invalidAttemptsCount: 0
  });
  (0,_index__WEBPACK_IMPORTED_MODULE_8__.setGlobal)(global);
  (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_2__.signalPasscodeHash)();
  beforeTabStates.forEach(({
    id: tabId,
    isMasterTab
  }) => actions.init({
    tabId,
    isMasterTab
  }));
  actions.initApi();
});
const MAX_INVALID_ATTEMPTS = 5;
const TIMEOUT_RESET_INVALID_ATTEMPTS_MS = 1000 * 15; // 180000; // 3 minutes

(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('logInvalidUnlockAttempt', global => {
  const invalidAttemptsCount = (global.passcode?.invalidAttemptsCount ?? 0) + 1;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    invalidAttemptsCount,
    timeoutUntil: invalidAttemptsCount >= MAX_INVALID_ATTEMPTS ? Date.now() + TIMEOUT_RESET_INVALID_ATTEMPTS_MS : undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('resetInvalidUnlockAttempts', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    invalidAttemptsCount: 0,
    timeoutUntil: undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('setPasscodeError', (global, actions, payload) => {
  const {
    error
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    error
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('clearPasscodeError', global => {
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_10__.updatePasscodeSettings)(global, {
    error: undefined
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_8__.addActionHandler)('skipLockOnUnload', () => {
  noLockOnUnload = true;
});

/***/ },

/***/ "./src/global/actions/ui/payments.ts"
/*!*******************************************!*\
  !*** ./src/global/actions/ui/payments.ts ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");






(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closePaymentModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const payment = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).payment;
  const status = payment.status || 'cancelled';
  const starsBalanceModal = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).starsBalanceModal;
  actions.processOriginStarsPayment({
    originData: starsBalanceModal,
    status,
    tabId
  });
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.clearPayment)(global, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updatePayment)(global, {
    status
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('resetPaymentStatus', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updatePayment)(global, {
    status: undefined
  }, tabId);
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateStarsPayment)(global, {
    status: undefined
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('addPaymentError', (global, actions, payload) => {
  const {
    error,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    payment: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId).payment,
      status: 'failed',
      error
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeGiveawayModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    giveawayModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeGiftCodeModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    giftCodeModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('updateGiftProfileFilter', (global, actions, payload) => {
  const {
    filter,
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId);
  const prevFilter = tabState.savedGifts.filter;
  let updatedFilter = {
    ...prevFilter,
    ...filter
  };
  if (!updatedFilter.shouldIncludeUnlimited && !updatedFilter.shouldIncludeLimited && !updatedFilter.shouldIncludeUnique) {
    updatedFilter = {
      ...prevFilter,
      shouldIncludeUnlimited: true,
      shouldIncludeLimited: true,
      shouldIncludeUnique: true,
      ...filter
    };
  }
  if (!updatedFilter.shouldIncludeDisplayed && !updatedFilter.shouldIncludeHidden) {
    updatedFilter = {
      ...prevFilter,
      shouldIncludeDisplayed: true,
      shouldIncludeHidden: true,
      ...filter
    };
  }
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    savedGifts: {
      ...tabState.savedGifts,
      giftsByPeerId: {
        [peerId]: tabState.savedGifts.giftsByPeerId[peerId]
      },
      filter: updatedFilter
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  actions.loadPeerSavedGifts({
    peerId,
    shouldRefresh: true,
    tabId: tabState.id
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('resetGiftProfileFilter', (global, actions, payload) => {
  const {
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    savedGifts: {
      ...tabState.savedGifts,
      giftsByPeerId: {
        [peerId]: tabState.savedGifts.giftsByPeerId[peerId]
      },
      filter: {
        ..._config__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_GIFT_PROFILE_FILTER_OPTIONS
      }
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_2__.setGlobal)(global);
  actions.loadPeerSavedGifts({
    peerId,
    shouldRefresh: true,
    tabId: tabState.id
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openPaymentMessageConfirmDialogOpen', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    isPaymentMessageConfirmDialogOpen: true
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closePaymentMessageConfirmDialogOpen', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    isPaymentMessageConfirmDialogOpen: false
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openPriceConfirmModal', (global, actions, payload) => {
  const {
    originalAmount,
    newAmount,
    currency,
    directInfo,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    priceConfirmModal: {
      originalAmount,
      newAmount,
      currency,
      directInfo
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closePriceConfirmModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    priceConfirmModal: undefined
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/reactions.ts"
/*!********************************************!*\
  !*** ./src/global/actions/ui/reactions.ts ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");






(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('processOpenChatOrThread', (global, actions, payload) => {
  const {
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if (chatId) {
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
      reactionPicker: {
        chatId,
        messageId: undefined,
        position: undefined
      }
    }, tabId);
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openMessageReactionPicker', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    position,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: {
      chatId,
      messageId,
      position
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openStoryReactionPicker', (global, actions, payload) => {
  const {
    peerId,
    storyId,
    position,
    sendAsMessage,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: {
      storyPeerId: peerId,
      storyId,
      sendAsMessage,
      position
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openEffectPicker', (global, actions, payload) => {
  const {
    position,
    chatId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: {
      position,
      chatId,
      isForEffects: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeReactionPicker', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    reactionPicker: {
      ...tabState.reactionPicker,
      messageId: undefined,
      position: undefined,
      storyId: undefined,
      storyPeerId: undefined,
      isForEffects: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('resetLocalPaidReactions', (global, actions, payload) => {
  const {
    chatId,
    messageId
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChatMessage)(global, chatId, messageId);
  if (!message) {
    return undefined;
  }
  const {
    reactions
  } = message;
  if (!reactions) {
    return undefined;
  }
  const updatedResults = reactions.results.map(reaction => {
    if (reaction.localAmount) {
      if (!reaction.count) return undefined;
      return {
        ...reaction,
        localAmount: undefined,
        localPreviousChosenOrder: undefined,
        chosenOrder: reaction.localPreviousChosenOrder
      };
    }
    return reaction;
  }).filter(Boolean);
  Object.values(global.byTabId).forEach(({
    id: tabId
  }) => {
    actions.dismissNotification({
      localId: (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_1__.getMessageKey)(message),
      tabId
    });
  });
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateChatMessage)(global, chatId, messageId, {
    reactions: {
      ...reactions,
      results: updatedResults
    }
  });
});

/***/ },

/***/ "./src/global/actions/ui/stars.ts"
/*!****************************************!*\
  !*** ./src/global/actions/ui/stars.ts ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _helpers_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../helpers/meta */ "./src/global/helpers/meta.ts");
/* harmony import */ var _helpers_payments__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");









(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('processOriginStarsPayment', (global, actions, payload) => {
  const {
    originData,
    status,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    originStarsPayment,
    originReaction,
    originGift,
    topup
  } = originData || {};
  if (!originStarsPayment && !originReaction && !originGift && !topup) {
    return undefined;
  }
  actions.closeStarsBalanceModal({
    tabId
  });
  if (status !== 'paid') {
    return undefined;
  }

  // Re-open previous payment modal
  if (originStarsPayment) {
    global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
      starsPayment: originStarsPayment
    }, tabId);
  }
  if (originReaction) {
    actions.sendPaidReaction({
      chatId: originReaction.chatId,
      messageId: originReaction.messageId,
      forcedAmount: originReaction.amount,
      tabId
    });
  }
  if (originGift) {
    actions.sendStarGift({
      ...originGift,
      tabId
    });
  }
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openGiftRecipientPicker', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    isGiftRecipientPickerOpen: true
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeGiftRecipientPicker', 'isGiftRecipientPickerOpen');
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStarsGiftingPickerModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    starsGiftingPickerModal: {
      isOpen: true
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeStarsGiftingPickerModal', 'starsGiftingPickerModal');
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openPrizeStarsTransactionFromGiveaway', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessage)(global, chatId, messageId);
  if (!message) return undefined;
  const transaction = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.getPrizeStarsTransactionFromGiveaway)(message);
  if (!transaction) return undefined;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.openStarsTransactionModal)(global, transaction, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStarsBalanceModal', (global, actions, payload) => {
  const {
    originStarsPayment,
    originReaction,
    originGift,
    topup,
    shouldIgnoreBalance,
    currency = _config__WEBPACK_IMPORTED_MODULE_0__.STARS_CURRENCY_CODE,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const starBalance = global.stars?.balance;
  if (!shouldIgnoreBalance && starBalance && topup && topup.balanceNeeded <= starBalance.amount) {
    actions.showNotification({
      message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate('StarsTopupLinkEnough'),
      actionText: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_2__.oldTranslate('StarsTopupLinkTopupAnyway'),
      action: {
        action: 'openStarsBalanceModal',
        payload: {
          topup,
          shouldIgnoreBalance: true,
          tabId
        }
      },
      icon: 'star',
      tabId
    });
    return undefined;
  }
  global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.clearStarPayment)(global, tabId);

  // Always refresh status on opening
  actions.loadStarStatus();
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    starsBalanceModal: {
      originStarsPayment,
      originReaction,
      originGift,
      topup,
      currency
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeStarsBalanceModal', 'starsBalanceModal');
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeStarsPaymentModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const starsPayment = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectStarsPayment)(global, tabId);
  let status = starsPayment?.status;
  if (!status || status === 'pending') {
    status = 'cancelled';
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    starsPayment: {
      status
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStarsTransactionModal', (global, actions, payload) => {
  const {
    transaction,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.openStarsTransactionModal)(global, transaction, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStarsTransactionFromGift', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessage)(global, chatId, messageId);
  if (!message) return undefined;
  const transaction = (0,_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.getStarsTransactionFromGift)(message);
  if (!transaction) return undefined;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.openStarsTransactionModal)(global, transaction, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeStarsTransactionModal', 'starsTransactionModal');
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStarsSubscriptionModal', (global, actions, payload) => {
  const {
    subscription,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    starsSubscriptionModal: {
      subscription
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeStarsSubscriptionModal', 'starsSubscriptionModal');
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeGiftModal', 'giftModal');
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeStarsGiftModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    starsGiftModal: {
      isOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openGiftInfoModalFromMessage', (global, actions, payload) => {
  const {
    chatId,
    messageId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const message = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessage)(global, chatId, messageId);
  if (!message || !message.content.action) return;
  const action = message.content.action;
  if (action.type !== 'starGift' && action.type !== 'starGiftUnique') return;
  const starGift = action.type === 'starGift' ? action : undefined;
  const uniqueGift = action.type === 'starGiftUnique' ? action : undefined;
  const giftReceiverId = action.peerId || (message.isOutgoing ? message.chatId : global.currentUserId);
  const inputGift = action.savedId ? {
    type: 'chat',
    chatId,
    savedId: action.savedId
  } : {
    type: 'user',
    messageId
  };
  const fromId = action.fromId || (message.isOutgoing ? global.currentUserId : message.chatId);
  const gift = {
    date: message.date,
    gift: action.gift,
    message: starGift?.message,
    starsToConvert: starGift?.starsToConvert,
    isNameHidden: starGift?.isNameHidden,
    isUnsaved: !action.isSaved,
    fromId,
    messageId: message.id,
    isConverted: starGift?.isConverted,
    upgradeMsgId: starGift?.upgradeMsgId,
    canUpgrade: starGift?.canUpgrade,
    alreadyPaidUpgradeStars: starGift?.alreadyPaidUpgradeStars,
    inputGift,
    canExportAt: uniqueGift?.canExportAt,
    savedId: action.savedId,
    transferStars: uniqueGift?.transferStars
  };
  actions.openGiftInfoModal({
    peerId: giftReceiverId,
    gift,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openGiftInfoModal', (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peerId = 'peerId' in payload ? payload.peerId : undefined;
  const recipientId = 'recipientId' in payload ? payload.recipientId : undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    giftInfoModal: {
      peerId,
      gift,
      recipientId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openGiftResalePriceComposerModal', (global, actions, payload) => {
  const {
    gift,
    peerId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    giftResalePriceComposerModal: {
      peerId,
      gift
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeGiftInfoModal', 'giftInfoModal');
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeGiftResalePriceComposerModal', 'giftResalePriceComposerModal');
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeGiftUpgradeModal', 'giftUpgradeModal');
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openGiftWithdrawModal', (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    giftWithdrawModal: {
      gift
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeGiftWithdrawModal', 'giftWithdrawModal');
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openGiftStatusInfoModal', (global, actions, payload) => {
  const {
    emojiStatus,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    giftStatusInfoModal: {
      emojiStatus
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeGiftStatusInfoModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    giftStatusInfoModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('clearGiftWithdrawError', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const giftWithdrawModal = tabState?.giftWithdrawModal;
  if (!giftWithdrawModal) return undefined;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    giftWithdrawModal: {
      ...giftWithdrawModal,
      errorKey: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openGiftTransferModal', (global, actions, payload) => {
  const {
    gift,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    giftTransferModal: {
      gift
    }
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_3__.addTabStateResetterAction)('closeGiftTransferModal', 'giftTransferModal');

/***/ },

/***/ "./src/global/actions/ui/statistics.ts"
/*!*********************************************!*\
  !*** ./src/global/actions/ui/statistics.ts ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../.. */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");




(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('openMonetizationVerificationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)(),
    chatId
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    monetizationVerificationModal: {
      chatId
    }
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeMonetizationVerificationModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    monetizationVerificationModal: undefined
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('clearMonetizationVerificationError', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_2__.updateVerifyMonetizationModal)(global, {
    errorKey: undefined
  }, tabId);
});
(0,___WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('closeMonetizationStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    monetizationStatistics: undefined
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/stickerSearch.ts"
/*!************************************************!*\
  !*** ./src/global/actions/ui/stickerSearch.ts ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");



(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setStickerSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    stickerSearch: {
      query,
      resultIds: undefined
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_1__.addActionHandler)('setGifSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_2__.updateTabState)(global, {
    gifSearch: {
      query,
      offset: undefined,
      // offsetId: undefined,
      results: undefined
    }
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/stories.ts"
/*!******************************************!*\
  !*** ./src/global/actions/ui/stories.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/oldLangProvider */ "./src/util/oldLangProvider.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _api_chats__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../api/chats */ "./src/global/actions/api/chats.ts");
/* harmony import */ var _api_messages__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../api/messages */ "./src/global/actions/api/messages.ts");











(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStoryViewer', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    isPrivate,
    isArchive,
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStories)(global, peerId);
  if (storyId && (!peerStories || !peerStories.byId[storyId])) {
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchPeerStoriesByIds', {
      peer,
      ids: [storyId]
    });
    if (!result) {
      return;
    }
    global = (0,_index__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
    global = (0,_reducers__WEBPACK_IMPORTED_MODULE_6__.addStoriesForPeer)(global, peerId, result.stories);
  }
  const storyList = tabState.storyViewer.storyList || (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectStoryListForViewer)(global, peerId, storyId, isSingleStory, isSinglePeer, isPrivate, isArchive);
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId,
      storyId: storyId || (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerFirstUnreadStoryId)(global, peerId) || (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerFirstStoryId)(global, peerId),
      isSinglePeer,
      isPrivate,
      isArchive,
      isSingleStory,
      viewModal: undefined,
      origin,
      storyList
    }
  }, tabId);
  (0,_index__WEBPACK_IMPORTED_MODULE_5__.setGlobal)(global);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStoryViewerByUsername', async (global, actions, payload) => {
  const {
    username,
    storyId,
    origin,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const chat = await (0,_api_chats__WEBPACK_IMPORTED_MODULE_9__.fetchChatByUsername)(global, username);
  if (!chat) {
    return;
  }
  actions.openStoryViewer({
    peerId: chat.id,
    storyId,
    isSinglePeer: true,
    isSingleStory: true,
    origin,
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeStoryViewer', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const {
    isMuted,
    isRibbonShown,
    isArchivedRibbonShown,
    storyId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).storyViewer;
  if (!storyId) return global;
  global = (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      isMuted,
      isRibbonShown,
      isArchivedRibbonShown,
      lastViewedByPeerId: undefined,
      storyList: undefined
    }
  }, tabId);
  return global;
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('setStoryViewerMuted', (global, actions, payload) => {
  const {
    isMuted,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).storyViewer,
      isMuted
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('toggleStoryRibbon', (global, actions, payload) => {
  const {
    isShown,
    isArchived,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const orderedIds = global.stories.orderedPeerIds[isArchived ? 'archived' : 'active'];
  if (!orderedIds?.length) {
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId).storyViewer,
      [isArchived ? 'isArchivedRibbonShown' : 'isRibbonShown']: isShown
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openPreviousStory', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    storyList
  } = tabState.storyViewer;
  if (isSingleStory || !storyList) {
    actions.closeStoryViewer({
      tabId
    });
    return undefined;
  }
  if (!peerId || !storyId) {
    return undefined;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStories)(global, peerId);
  if (!peerStories || !peer) {
    return undefined;
  }
  const {
    peerIds: orderedPeerIds,
    storyIdsByPeerId
  } = storyList;
  const peerStoryIds = storyIdsByPeerId[peerId] ?? [];
  const currentStoryIndex = peerStoryIds.indexOf(storyId);
  let previousStoryIndex;
  let previousPeerId;
  if (currentStoryIndex > 0) {
    previousStoryIndex = currentStoryIndex - 1;
    previousPeerId = peerId;
  } else {
    const previousPeerIdIndex = orderedPeerIds.indexOf(peerId) - 1;
    if (isSinglePeer || previousPeerIdIndex < 0) {
      return undefined;
    }
    previousPeerId = orderedPeerIds[previousPeerIdIndex];
    previousStoryIndex = (storyIdsByPeerId?.[previousPeerId]?.length || 1) - 1;
  }
  const previousStoryId = storyIdsByPeerId?.[previousPeerId]?.[previousStoryIndex];
  if (!previousStoryId) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId: previousPeerId,
      storyId: previousStoryId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openNextStory', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const {
    peerId,
    storyId,
    isSinglePeer,
    isSingleStory,
    storyList
  } = tabState.storyViewer;
  if (isSingleStory || !storyList) {
    actions.closeStoryViewer({
      tabId
    });
    return undefined;
  }
  if (!peerId || !storyId) {
    return undefined;
  }
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  const peerStories = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStories)(global, peerId);
  if (!peerStories || !peer) {
    return undefined;
  }
  const {
    peerIds: orderedPeerIds,
    storyIdsByPeerId
  } = storyList;
  const peerStoryIds = storyIdsByPeerId[peerId] ?? [];
  const currentStoryIndex = peerStoryIds.indexOf(storyId);
  let nextStoryIndex;
  let nextPeerId;
  if (currentStoryIndex < peerStoryIds.length - 1) {
    nextStoryIndex = currentStoryIndex + 1;
    nextPeerId = peerId;
  } else {
    const nextPeerIdIndex = orderedPeerIds.indexOf(peerId) + 1;
    if (isSinglePeer || nextPeerIdIndex > orderedPeerIds.length - 1) {
      actions.closeStoryViewer({
        tabId
      });
      return undefined;
    }
    nextPeerId = orderedPeerIds[nextPeerIdIndex];
    nextStoryIndex = 0;
  }
  const nextStoryId = storyIdsByPeerId?.[nextPeerId]?.[nextStoryIndex];
  if (!nextStoryId) {
    return undefined;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      peerId: nextPeerId,
      storyId: nextStoryId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStoryViewModal', (global, actions, payload) => {
  const {
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        storyId,
        nextOffset: '',
        isLoading: true
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeStoryViewModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(tabState.storyViewer, ['viewModal'])
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('copyStoryLink', async (global, actions, payload) => {
  const {
    peerId,
    storyId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const peer = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, peerId);
  if (!peer) {
    return;
  }
  const link = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_4__.callApi)('fetchStoryLink', {
    peer,
    storyId
  });
  if (!link) {
    return;
  }
  (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_0__.copyTextToClipboard)(link);
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('LinkCopied'),
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('sendMessage', async (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const {
    storyId,
    peerId: storyPeerId
  } = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentViewedStory)(global, tabId);
  const isStoryReply = Boolean(storyId && storyPeerId);
  if (!isStoryReply) {
    return;
  }
  const messagePriceInStars = await (0,_api_messages__WEBPACK_IMPORTED_MODULE_10__.getPeerStarsForMessage)(global, storyPeerId);
  if (messagePriceInStars === undefined) return;
  const {
    gif,
    sticker,
    isReaction
  } = payload;
  let message;
  if (gif) {
    message = 'Story.Tooltip.GifSent';
  } else if (sticker) {
    message = 'Story.Tooltip.StickerSent';
  } else if (isReaction) {
    message = 'Story.Tooltip.ReactionSent';
  } else {
    message = 'Story.Tooltip.MessageSent';
  }
  actions.showNotification({
    message: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate(message),
    actionText: _util_oldLangProvider__WEBPACK_IMPORTED_MODULE_3__.oldTranslate('Story.ToastViewInChat'),
    action: [{
      action: 'closeStoryViewer',
      payload: undefined
    }, {
      action: 'openChat',
      payload: {
        id: storyPeerId
      }
    }],
    tabId
  });
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('openStoryPrivacyEditor', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      isPrivacyModalOpen: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeStoryPrivacyEditor', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      isPrivacyModalOpen: false
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('toggleStealthModal', (global, actions, payload) => {
  const {
    isOpen,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      isStealthModalOpen: isOpen
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('clearStoryViews', (global, actions, payload) => {
  const {
    isLoading,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  if (!tabState.storyViewer.viewModal) return global;
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        ...tabState.storyViewer.viewModal,
        views: undefined,
        isLoading,
        nextOffset: ''
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('updateStoryView', (global, actions, payload) => {
  const {
    userId,
    isUserBlocked,
    areStoriesBlocked,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload;
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global, tabId);
  const {
    viewModal
  } = tabState.storyViewer;
  if (!viewModal?.storyId) return undefined;
  const updatedViews = viewModal?.views?.map(view => {
    if (view.peerId === userId) {
      return {
        ...view,
        isUserBlocked: isUserBlocked || undefined,
        areStoriesBlocked: areStoriesBlocked || undefined
      };
    }
    return view;
  });
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    storyViewer: {
      ...tabState.storyViewer,
      viewModal: {
        ...viewModal,
        views: updatedViews
      }
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeBoostModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    boostModal: undefined
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_5__.addActionHandler)('closeBoostStatistics', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_1__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_7__.updateTabState)(global, {
    boostStatistics: undefined
  }, tabId);
});

/***/ },

/***/ "./src/global/actions/ui/users.ts"
/*!****************************************!*\
  !*** ./src/global/actions/ui/users.ts ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _helpers_meta__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../helpers/meta */ "./src/global/helpers/meta.ts");
/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../index */ "./src/global/index.ts");
/* harmony import */ var _reducers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../reducers */ "./src/global/reducers/index.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../selectors */ "./src/global/selectors/index.ts");






(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('setUserSearchQuery', (global, actions, payload) => {
  const {
    query,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.updateUserSearch)(global, {
    globalUserIds: undefined,
    localUserIds: undefined,
    fetchingStatus: Boolean(query),
    query
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openAddContactDialog', (global, actions, payload) => {
  const {
    userId,
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload;
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    newContact: {
      userId
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('openNewContactDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  if ((0,_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsCurrentUserFrozen)(global)) {
    actions.openFrozenAccountModal({
      tabId
    });
    return global;
  }
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    newContact: {
      isByPhoneNumber: true
    }
  }, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeNewContactDialog', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers__WEBPACK_IMPORTED_MODULE_3__.closeNewContactDialog)(global, tabId);
});
(0,_index__WEBPACK_IMPORTED_MODULE_2__.addActionHandler)('closeSuggestedStatusModal', (global, actions, payload) => {
  const {
    tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
  } = payload || {};
  return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_4__.updateTabState)(global, {
    suggestedStatusModal: undefined
  }, tabId);
});
(0,_helpers_meta__WEBPACK_IMPORTED_MODULE_1__.addTabStateResetterAction)('closeChatRefundModal', 'chatRefundModal');

/***/ },

/***/ "./src/global/helpers/meta.ts"
/*!************************************!*\
  !*** ./src/global/helpers/meta.ts ***!
  \************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   addTabStateResetterAction: () => (/* binding */ addTabStateResetterAction)
/* harmony export */ });
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _reducers_tabs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../reducers/tabs */ "./src/global/reducers/tabs.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! .. */ "./src/global/index.ts");



function addTabStateResetterAction(name, key) {
  // @ts-ignore
  (0,___WEBPACK_IMPORTED_MODULE_2__.addActionHandler)(name, (global, actions, payload) => {
    const {
      tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()
    } = payload || {};
    return (0,_reducers_tabs__WEBPACK_IMPORTED_MODULE_1__.updateTabState)(global, {
      [key]: undefined
    }, tabId);
  });
}

/***/ },

/***/ "./src/global/helpers/renderMessageSummaryHtml.ts"
/*!********************************************************!*\
  !*** ./src/global/helpers/renderMessageSummaryHtml.ts ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   renderMessageSummaryHtml: () => (/* binding */ renderMessageSummaryHtml)
/* harmony export */ });
/* harmony import */ var _components_common_helpers_renderMessageText__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../components/common/helpers/renderMessageText */ "./src/components/common/helpers/renderMessageText.ts");
/* harmony import */ var ___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! .. */ "./src/global/index.ts");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./messages */ "./src/global/helpers/messages.ts");
/* harmony import */ var _messageSummary__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./messageSummary */ "./src/global/helpers/messageSummary.ts");




function renderMessageSummaryHtml(lang, message) {
  const global = (0,___WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const emoji = (0,_messageSummary__WEBPACK_IMPORTED_MODULE_3__.getMessageSummaryEmoji)(message);
  const emojiWithSpace = emoji ? `${emoji} ` : '';
  const text = (0,_components_common_helpers_renderMessageText__WEBPACK_IMPORTED_MODULE_0__.renderMessageText)({
    message,
    shouldRenderAsHtml: true
  })?.join('');
  const statefulContent = (0,_messages__WEBPACK_IMPORTED_MODULE_2__.getMessageStatefulContent)(global, message);
  const description = (0,_messageSummary__WEBPACK_IMPORTED_MODULE_3__.getMessageSummaryDescription)(lang, message, statefulContent, text, true);
  return `${emojiWithSpace}${description}`;
}

/***/ },

/***/ "./src/global/reducers/bots.ts"
/*!*************************************!*\
  !*** ./src/global/reducers/bots.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   activateWebAppIfOpen: () => (/* binding */ activateWebAppIfOpen),
/* harmony export */   addWebAppToOpenList: () => (/* binding */ addWebAppToOpenList),
/* harmony export */   clearOpenedWebApps: () => (/* binding */ clearOpenedWebApps),
/* harmony export */   hasOpenedMoreThanOneWebApps: () => (/* binding */ hasOpenedMoreThanOneWebApps),
/* harmony export */   hasOpenedWebApps: () => (/* binding */ hasOpenedWebApps),
/* harmony export */   removeActiveWebAppFromOpenList: () => (/* binding */ removeActiveWebAppFromOpenList),
/* harmony export */   removeWebAppFromOpenList: () => (/* binding */ removeWebAppFromOpenList),
/* harmony export */   replaceInlineBotSettings: () => (/* binding */ replaceInlineBotSettings),
/* harmony export */   replaceInlineBotsIsLoading: () => (/* binding */ replaceInlineBotsIsLoading),
/* harmony export */   replaceIsWebAppModalOpen: () => (/* binding */ replaceIsWebAppModalOpen),
/* harmony export */   replaceWebAppModalState: () => (/* binding */ replaceWebAppModalState),
/* harmony export */   updateWebApp: () => (/* binding */ updateWebApp)
/* harmony export */ });
/* harmony import */ var _util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/establishMultitabRole */ "./src/util/establishMultitabRole.ts");
/* harmony import */ var _helpers_bots__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../helpers/bots */ "./src/global/helpers/bots.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./tabs */ "./src/global/reducers/tabs.ts");




function replaceInlineBotSettings(global, username, inlineBotSettings, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    inlineBots: {
      ...tabState.inlineBots,
      byUsername: {
        ...tabState.inlineBots.byUsername,
        [username]: inlineBotSettings
      }
    }
  }, tabId);
}
function replaceInlineBotsIsLoading(global, isLoading, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    inlineBots: {
      ...(0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId).inlineBots,
      isLoading
    }
  }, tabId);
}
function updateWebApp(global, key, webAppUpdate, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const openedWebApps = currentTabState.webApps.openedWebApps;
  const originalWebApp = openedWebApps[key];
  if (!originalWebApp) return global;
  const updatedValue = {
    ...originalWebApp,
    ...webAppUpdate
  };
  const updatedWebAppKey = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(updatedValue);
  if (!updatedWebAppKey) return global;
  global = (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      openedWebApps: {
        ...openedWebApps,
        [updatedWebAppKey]: updatedValue
      }
    }
  }, tabId);
  return global;
}
function activateWebAppIfOpen(global, webAppKey, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const openedWebApps = currentTabState.webApps.openedWebApps;
  if (!openedWebApps[webAppKey]) {
    return global;
  }
  global = (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      isMoreAppsTabActive: false,
      activeWebAppKey: webAppKey,
      modalState: 'maximized'
    }
  }, tabId);
  return global;
}
function addWebAppToOpenList(global, webApp, makeActive = true, openModalIfNotOpen = true, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const key = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(webApp);
  if (!key) return global;
  const newOpenedKeys = [...currentTabState.webApps.openedOrderedKeys];
  if (!newOpenedKeys.includes(key)) newOpenedKeys.push(key);
  const newSessionKeys = [...currentTabState.webApps.sessionKeys];
  if (!newSessionKeys.includes(key)) newSessionKeys.push(key);
  const openedWebApps = currentTabState.webApps.openedWebApps;
  global = (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      ...(makeActive && {
        activeWebAppKey: key
      }),
      isMoreAppsTabActive: false,
      isModalOpen: openModalIfNotOpen,
      modalState: 'maximized',
      openedWebApps: {
        ...openedWebApps,
        [key]: webApp
      },
      openedOrderedKeys: newOpenedKeys,
      sessionKeys: newSessionKeys
    }
  }, tabId);
  return global;
}
function removeActiveWebAppFromOpenList(global, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const activeWebAppKey = currentTabState.webApps.activeWebAppKey;
  if (!activeWebAppKey) return global;
  return removeWebAppFromOpenList(global, activeWebAppKey, false, tabId);
}
function removeWebAppFromOpenList(global, key, skipClosingConfirmation, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const {
    openedWebApps,
    openedOrderedKeys,
    activeWebAppKey
  } = currentTabState.webApps;
  const webApp = openedWebApps[key];
  if (!webApp) return global;
  if (!skipClosingConfirmation && webApp.shouldConfirmClosing) {
    return updateWebApp(global, key, {
      isCloseModalOpen: true
    }, tabId);
  }
  const updatedOpenedWebApps = {
    ...openedWebApps
  };
  const removingWebAppKey = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(webApp);
  let newOpenedKeys = openedOrderedKeys;
  if (removingWebAppKey) {
    delete updatedOpenedWebApps[removingWebAppKey];
    newOpenedKeys = openedOrderedKeys.filter(k => k !== removingWebAppKey);
  }
  const isRemovedAppActive = activeWebAppKey === (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(webApp);
  const openedWebAppsKeys = Object.keys(updatedOpenedWebApps);
  const openedWebAppsCount = openedWebAppsKeys.length;
  global = (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      ...(isRemovedAppActive && {
        activeWebAppKey: openedWebAppsCount ? openedWebAppsKeys[openedWebAppsCount - 1] : undefined
      }),
      openedWebApps: updatedOpenedWebApps,
      openedOrderedKeys: newOpenedKeys,
      ...(!openedWebAppsCount && {
        sessionKeys: []
      })
    }
  }, tabId);
  return global;
}
function clearOpenedWebApps(global, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  const webAppsNotAllowedToClose = Object.fromEntries(Object.entries(currentTabState.webApps.openedWebApps).filter(([, webApp]) => webApp.shouldConfirmClosing));
  const webAppsNotAllowedToCloseValues = Object.values(webAppsNotAllowedToClose);
  const hasNotAllowedToCloseApps = webAppsNotAllowedToCloseValues.length > 0;
  if (!hasNotAllowedToCloseApps) {
    return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
      webApps: {
        ...currentTabState.webApps,
        activeWebAppKey: undefined,
        openedWebApps: {},
        openedOrderedKeys: [],
        sessionKeys: []
      }
    }, tabId);
  }
  const currentActiveWebApp = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectActiveWebApp)(global, tabId);
  const newActiveWebApp = currentActiveWebApp?.shouldConfirmClosing ? currentActiveWebApp : webAppsNotAllowedToCloseValues[0];
  const newActiveWebAppKey = (0,_helpers_bots__WEBPACK_IMPORTED_MODULE_1__.getWebAppKey)(newActiveWebApp);
  if (newActiveWebAppKey) {
    webAppsNotAllowedToClose[newActiveWebAppKey] = {
      ...newActiveWebApp,
      isCloseModalOpen: true
    };
  }
  const newOpenedKeys = currentTabState.webApps.openedOrderedKeys.filter(k => webAppsNotAllowedToClose[k]);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      activeWebAppKey: newActiveWebAppKey,
      isMoreAppsTabActive: false,
      openedWebApps: webAppsNotAllowedToClose,
      openedOrderedKeys: newOpenedKeys
    }
  }, tabId);
}
function hasOpenedWebApps(global, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  return Object.keys((0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId).webApps.openedWebApps).length > 0;
}
function hasOpenedMoreThanOneWebApps(global, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  return Object.keys((0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId).webApps.openedWebApps).length > 1;
}
function replaceWebAppModalState(global, modalState, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      modalState
    }
  }, tabId);
}
function replaceIsWebAppModalOpen(global, value, ...[tabId = (0,_util_establishMultitabRole__WEBPACK_IMPORTED_MODULE_0__.getCurrentTabId)()]) {
  const currentTabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global, tabId);
  return (0,_tabs__WEBPACK_IMPORTED_MODULE_3__.updateTabState)(global, {
    webApps: {
      ...currentTabState.webApps,
      isModalOpen: value
    }
  }, tabId);
}

/***/ },

/***/ "./src/global/reducers/reactions.ts"
/*!******************************************!*\
  !*** ./src/global/reducers/reactions.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   addMessageReaction: () => (/* binding */ addMessageReaction),
/* harmony export */   subtractXForEmojiInteraction: () => (/* binding */ subtractXForEmojiInteraction),
/* harmony export */   updateUnreadReactions: () => (/* binding */ updateUnreadReactions)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _util_windowSize__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/windowSize */ "./src/util/windowSize.ts");
/* harmony import */ var _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../components/middle/helpers/calculateMiddleFooterTransforms */ "./src/components/middle/helpers/calculateMiddleFooterTransforms.ts");
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chats__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./chats */ "./src/global/reducers/chats.ts");
/* harmony import */ var _messages__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./messages */ "./src/global/reducers/messages.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");








function getLeftColumnWidth(windowWidth) {
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN) {
    return Math.min(Math.max(windowWidth * 0.25, _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.MIN_LEFT_COLUMN_WIDTH), windowWidth * 0.33);
  }
  if (windowWidth > _config__WEBPACK_IMPORTED_MODULE_0__.MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN) {
    return Math.min(Math.max(windowWidth * 0.33, _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.MIN_LEFT_COLUMN_WIDTH), windowWidth * 0.4);
  }
  return _components_middle_helpers_calculateMiddleFooterTransforms__WEBPACK_IMPORTED_MODULE_2__.SIDE_COLUMN_MAX_WIDTH;
}
function subtractXForEmojiInteraction(global, x) {
  const tabState = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  return x - (tabState.isLeftColumnShown && !(0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__.getIsMobile)() ? global.leftColumnWidth || getLeftColumnWidth(_util_windowSize__WEBPACK_IMPORTED_MODULE_1__["default"].get().width) : 0);
}
function addMessageReaction(global, message, userReactions) {
  const isInSavedMessages = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsChatWithSelf)(global, message.chatId);
  const currentReactions = message.reactions || {
    results: [],
    areTags: isInSavedMessages
  };
  const currentSendAs = (0,_selectors__WEBPACK_IMPORTED_MODULE_4__.selectSendAs)(global, message.chatId);

  // Update UI without waiting for server response
  const results = (0,_helpers__WEBPACK_IMPORTED_MODULE_3__.updateReactionCount)(currentReactions.results, userReactions);
  let {
    recentReactions = []
  } = currentReactions;
  if (recentReactions.length) {
    recentReactions = recentReactions.filter(({
      isOwn,
      peerId
    }) => !isOwn && peerId !== global.currentUserId);
  }
  userReactions.forEach(reaction => {
    const {
      currentUserId
    } = global;
    if (reaction.type === 'paid') return;
    recentReactions.unshift({
      peerId: currentSendAs?.id || currentUserId,
      reaction,
      addedDate: Math.floor(Date.now() / 1000),
      isOwn: true
    });
  });
  return (0,_messages__WEBPACK_IMPORTED_MODULE_6__.updateChatMessage)(global, message.chatId, message.id, {
    reactions: {
      ...currentReactions,
      results,
      recentReactions
    }
  });
}
function updateUnreadReactions(global, chatId, update) {
  return (0,_chats__WEBPACK_IMPORTED_MODULE_5__.updateChat)(global, chatId, update, true);
}

/***/ },

/***/ "./src/hooks/useCacheBuster.ts"
/*!*************************************!*\
  !*** ./src/hooks/useCacheBuster.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");

const useCacheBuster = () => {
  const [cacheBuster, setCacheBuster] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const updateCacheBuster = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setCacheBuster(current => current + 1);
  }, []);
  return [cacheBuster, updateCacheBuster];
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useCacheBuster);

/***/ },

/***/ "./src/hooks/useConnectionStatus.ts"
/*!******************************************!*\
  !*** ./src/hooks/useConnectionStatus.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ConnectionStatus: () => (/* binding */ ConnectionStatus),
/* harmony export */   "default": () => (/* binding */ useConnectionStatus)
/* harmony export */ });
/* harmony import */ var _window_useBrowserOnline__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./window/useBrowserOnline */ "./src/hooks/window/useBrowserOnline.ts");
/* harmony import */ var _useFlag__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useFlag */ "./src/hooks/useFlag.ts");


let ConnectionStatus = /*#__PURE__*/function (ConnectionStatus) {
  ConnectionStatus[ConnectionStatus["waitingForNetwork"] = 0] = "waitingForNetwork";
  ConnectionStatus[ConnectionStatus["syncing"] = 1] = "syncing";
  ConnectionStatus[ConnectionStatus["online"] = 2] = "online";
  ConnectionStatus[ConnectionStatus["offline"] = 3] = "offline";
  return ConnectionStatus;
}({});
function useConnectionStatus(lang, connectionState, isSyncing, hasMiddleHeader, isMinimized, isDisabled) {
  let status;
  const [connectionStatusOpen, openConnectionStatus, closeConnectionStatus] = (0,_useFlag__WEBPACK_IMPORTED_MODULE_1__["default"])();
  const isBrowserOnline = (0,_window_useBrowserOnline__WEBPACK_IMPORTED_MODULE_0__["default"])();
  if (!isBrowserOnline) {
    status = ConnectionStatus.offline;
    openConnectionStatus();
  } else if (connectionState === 'connectionStateConnecting') {
    status = ConnectionStatus.waitingForNetwork;
    openConnectionStatus();
  } else if (isSyncing) {
    status = ConnectionStatus.syncing;
  } else {
    status = ConnectionStatus.online;
    closeConnectionStatus();
  }
  let position;
  if (status === ConnectionStatus.online || isDisabled) {
    position = 'none';
  } else if (hasMiddleHeader) {
    position = 'middleHeader';
  } else if (isMinimized) {
    position = 'minimized';
  } else {
    position = 'overlay';
  }
  let text;
  if (status === ConnectionStatus.waitingForNetwork || status === ConnectionStatus.offline) {
    text = lang('WaitingForNetwork');
  } else if (status === ConnectionStatus.syncing) {
    text = lang('Updating');
  }
  if (position === 'middleHeader') {
    text = text.toLowerCase().replace(/\.+$/, '');
  }
  return {
    connectionStatus: status,
    connectionStatusPosition: position,
    connectionStatusText: text,
    connectionStatusOpen,
    openConnectionStatus,
    closeConnectionStatus
  };
}

/***/ },

/***/ "./src/hooks/useMessageMediaMetadata.ts"
/*!**********************************************!*\
  !*** ./src/hooks/useMessageMediaMetadata.ts ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_imageResize__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/imageResize */ "./src/util/imageResize.ts");
/* harmony import */ var _util_mediaSession__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/mediaSession */ "./src/util/mediaSession.ts");
/* harmony import */ var _components_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../components/common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _useAsync__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./useAsync */ "./src/hooks/useAsync.ts");
/* harmony import */ var _useMedia__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../assets/telegram-logo-filled.svg */ "./src/assets/telegram-logo-filled.svg");










const LOGO_DIMENSIONS = {
  width: 200,
  height: 200
};
const MINIMAL_SIZE = 115; // spec says 100, but on Chrome 93 it's not showing

// TODO Add support for video in future
const useMessageMediaMetadata = (message, sender, chat) => {
  const lang = (0,_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const {
    audio,
    voice
  } = message ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(message) : {};
  const title = audio ? audio.title || audio.fileName : voice ? 'Voice message' : '';
  const artist = audio?.performer || sender && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, sender);
  const album = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getChatTitle)(lang, chat) || 'Telegram';
  const audioCoverHash = audio && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getAudioHasCover)(audio) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMediaHash)(audio, 'pictogram');
  const avatarHash = sender && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getChatAvatarHash)(sender, 'big');
  const hash = audio && audioCoverHash || voice && avatarHash;
  const media = (0,_useMedia__WEBPACK_IMPORTED_MODULE_7__["default"])(hash);
  const size = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return getCoverSize(audio, voice, media);
  }, [audio, media, voice]);
  const {
    result: url
  } = (0,_useAsync__WEBPACK_IMPORTED_MODULE_6__["default"])(() => makeGoodArtwork(media, size), [media, size], _assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_9__);
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_4__.buildMediaMetadata)({
      title,
      artist,
      album,
      artwork: [{
        src: url
      }]
    });
  }, [album, artist, title, url]);
};
function makeGoodArtwork(url, size) {
  if (!url) return Promise.resolve(_assets_telegram_logo_filled_svg__WEBPACK_IMPORTED_MODULE_9__);
  if (!size) return (0,_util_imageResize__WEBPACK_IMPORTED_MODULE_3__.resizeImage)(url, MINIMAL_SIZE, MINIMAL_SIZE);
  const min = Math.min(size.width, size.height);
  if (min < MINIMAL_SIZE) {
    const ratio = MINIMAL_SIZE / min;
    return (0,_util_imageResize__WEBPACK_IMPORTED_MODULE_3__.scaleImage)(url, ratio);
  }
  return Promise.resolve(url);
}
function getCoverSize(audio, voice, url) {
  if (!url) return LOGO_DIMENSIONS;
  if (audio) {
    if (!audio.thumbnailSizes?.length) return undefined;
    const preferred = audio.thumbnailSizes.find(size => size.type === 'm');
    return preferred || audio.thumbnailSizes[0]; // Sometimes `m` is not present
  }
  if (voice) {
    return _components_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.AVATAR_FULL_DIMENSIONS;
  }
  return undefined;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useMessageMediaMetadata);

/***/ },

/***/ "./src/hooks/useNativeCopySelectedMessages.ts"
/*!****************************************************!*\
  !*** ./src/hooks/useNativeCopySelectedMessages.ts ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_getMessageIdsForSelectedText__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/getMessageIdsForSelectedText */ "./src/util/getMessageIdsForSelectedText.ts");
/* harmony import */ var _useHotkeys__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");




const useNativeCopySelectedMessages = copyMessagesByIds => {
  const handleCopy = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(e => {
    const messageIds = (0,_util_getMessageIdsForSelectedText__WEBPACK_IMPORTED_MODULE_1__["default"])();
    if (messageIds && messageIds.length > 1) {
      e.preventDefault();
      copyMessagesByIds({
        messageIds
      });
    }
  });
  (0,_useHotkeys__WEBPACK_IMPORTED_MODULE_2__.useHotkeys)((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => ({
    'Mod+C': handleCopy
  }), []));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useNativeCopySelectedMessages);

/***/ },

/***/ "./src/hooks/usePreventPinchZoomGesture.ts"
/*!*************************************************!*\
  !*** ./src/hooks/usePreventPinchZoomGesture.ts ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePreventPinchZoomGesture)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");


const metaViewport = document.querySelector('meta[name="viewport"]');
const defaultViewportContent = metaViewport?.getAttribute('content') || '';
const allowedZoomViewportContent = 'width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover';
function usePreventPinchZoomGesture(isDisabled = false) {
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_TOUCH_ENV) {
      return undefined;
    }
    if (isDisabled) {
      // Clean viewport content from values values that disable the ability to zoom a webpage
      // https://web.dev/meta-viewport/
      metaViewport?.setAttribute('content', allowedZoomViewportContent);
      return undefined;
    }
    metaViewport?.setAttribute('content', defaultViewportContent);

    // Since iOS 10 `user-scaleable=no` is disabled in Safari for iOS,
    // this is only applicable for the browser and does not apply to the PWA mode.
    // https://newbedev.com/how-do-you-disable-viewport-zooming-on-mobile-safari
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_IOS && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_PWA) {
      document.addEventListener('gesturestart', preventEvent);
    }
    return () => {
      metaViewport?.setAttribute('content', 'width=device-width, initial-scale=1, shrink-to-fit=no');
      if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_IOS && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_PWA) {
        document.removeEventListener('gesturestart', preventEvent);
      }
    };
  }, [isDisabled]);
}
function preventEvent(e) {
  e.preventDefault();
}

/***/ },

/***/ "./src/hooks/useResize.ts"
/*!********************************!*\
  !*** ./src/hooks/useResize.ts ***!
  \********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useResize: () => (/* binding */ useResize)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _useFlag__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");




function useResize(elementRef, onResize, onReset, initialWidth, cssPropertyName) {
  const [isActive, markIsActive, unmarkIsActive] = (0,_useFlag__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const [initialMouseX, setInitialMouseX] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [initialElementWidth, setInitialElementWidth] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const setElementStyle = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(width => {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      if (!elementRef.current) {
        return;
      }
      const widthPx = width ? `${width}px` : '';
      elementRef.current.style.width = widthPx;
      if (cssPropertyName) {
        elementRef.current.style.setProperty(cssPropertyName, widthPx);
      }
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!elementRef.current || !initialWidth) {
      return;
    }
    setElementStyle(initialWidth);
  }, [cssPropertyName, elementRef, initialWidth, setElementStyle]);
  function handleMouseUp() {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      document.body.classList.remove('cursor-ew-resize');
    });
  }
  function initResize(e) {
    e.preventDefault();
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      document.body.classList.add('cursor-ew-resize');
    });
    setInitialMouseX(e.clientX);
    setInitialElementWidth(elementRef.current.offsetWidth);
    markIsActive();
  }
  function resetResize(e) {
    e.preventDefault();
    setElementStyle(undefined);
    onReset();
  }
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isActive) return undefined;
    const handleMouseMove = e => {
      const newWidth = Math.ceil(initialElementWidth + e.clientX - initialMouseX);
      setElementStyle(newWidth);
    };
    function stopDrag() {
      cleanup();
      onResize(elementRef.current.offsetWidth);
    }
    function cleanup() {
      handleMouseUp();
      document.removeEventListener('mousemove', handleMouseMove, false);
      document.removeEventListener('mouseup', stopDrag, false);
      document.removeEventListener('blur', stopDrag, false);
      unmarkIsActive();
    }
    document.addEventListener('mousemove', handleMouseMove, false);
    document.addEventListener('mouseup', stopDrag, false);
    document.addEventListener('blur', stopDrag, false);
    return cleanup;
  }, [initialElementWidth, initialMouseX, elementRef, onResize, isActive, unmarkIsActive, setElementStyle]);
  return {
    initResize,
    resetResize,
    handleMouseUp
  };
}

/***/ },

/***/ "./src/hooks/window/useBrowserOnline.ts"
/*!**********************************************!*\
  !*** ./src/hooks/window/useBrowserOnline.ts ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useBrowserOnline)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");

function useBrowserOnline() {
  const [isOnline, setIsOnline] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(window.navigator.onLine);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    function handleChange() {
      setIsOnline(window.navigator.onLine);
    }
    window.addEventListener('online', handleChange);
    window.addEventListener('offline', handleChange);
    return () => {
      window.removeEventListener('offline', handleChange);
      window.removeEventListener('online', handleChange);
    };
  }, []);
  return isOnline;
}

/***/ },

/***/ "./src/util/PopupManager.ts"
/*!**********************************!*\
  !*** ./src/util/PopupManager.ts ***!
  \**********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PopupManager)
/* harmony export */ });
/* harmony import */ var _browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }

const SHOULD_PRE_OPEN = _browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_IOS || _browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_ANDROID;
class PopupManager {
  constructor(features, onFail) {
    this.features = features;
    this.onFail = onFail;
    _defineProperty(this, "preOpened", void 0);
  }
  preOpenIfNeeded() {
    if (!SHOULD_PRE_OPEN) return;
    this.preOpened = window.open('about:blank', undefined, this.features);
    if (this.preOpened) {
      this.preOpened.blur();
    } else {
      this.onFail?.();
    }
  }
  open(url) {
    if (this.preOpened) {
      this.preOpened.location.href = url;
      this.preOpened.focus();
      this.preOpened = undefined;
      return;
    }
    if (!SHOULD_PRE_OPEN) {
      const popup = window.open(url, undefined, this.features);
      if (popup) {
        popup.focus();
      } else {
        this.onFail?.();
      }
    }
  }
  cancelPreOpen() {
    this.preOpened?.close();
    this.preOpened = undefined;
  }
}

/***/ },

/***/ "./src/util/getIsAppUpdateNeeded.ts"
/*!******************************************!*\
  !*** ./src/util/getIsAppUpdateNeeded.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ getIsAppUpdateNeeded)
/* harmony export */ });
const APP_VERSION_REGEX = /^\d+\.\d+(\.\d+)?$/;
function getIsAppUpdateNeeded(remoteVersion, appVersion, isStrict) {
  const sanitizedRemoteVersion = remoteVersion.trim();
  if (!APP_VERSION_REGEX.test(sanitizedRemoteVersion)) {
    return false;
  }
  if (isStrict) {
    return sanitizedRemoteVersion.localeCompare(appVersion, undefined, {
      numeric: true,
      sensitivity: 'base'
    }) === 1;
  }
  return sanitizedRemoteVersion !== appVersion;
}

/***/ },

/***/ "./src/util/payments/stripe.ts"
/*!*************************************!*\
  !*** ./src/util/payments/stripe.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getStripeError: () => (/* binding */ getStripeError)
/* harmony export */ });
const STRIPE_ERRORS = {
  missing_payment_information: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  invalid_number: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  number: {
    field: 'cardNumber',
    message: 'Incorrect card number'
  },
  exp_year: {
    field: 'expiry',
    message: 'Incorrect year'
  },
  exp_month: {
    field: 'expiry',
    message: 'Incorrect month'
  },
  invalid_expiry_year: {
    field: 'expiry',
    message: 'Incorrect year'
  },
  invalid_expiry_month: {
    field: 'expiry',
    message: 'Incorrect month'
  },
  cvc: {
    field: 'cvv',
    message: 'Incorrect CVV'
  },
  invalid_cvc: {
    field: 'cvv',
    message: 'Incorrect CVV'
  }
};
function getStripeError(error) {
  const {
    message: description,
    code,
    param
  } = error;
  const {
    field,
    message
  } = param ? STRIPE_ERRORS[param] : STRIPE_ERRORS[code];
  return {
    field,
    message,
    description
  };
}

/***/ },

/***/ "./src/util/requestQuery.ts"
/*!**********************************!*\
  !*** ./src/util/requestQuery.ts ***!
  \**********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   buildQueryString: () => (/* binding */ buildQueryString)
/* harmony export */ });
function buildQueryString(data) {
  const query = Object.keys(data).map(k => `${k}=${data[k]}`).join('&');
  return query.length > 0 ? `?${query}` : '';
}

/***/ },

/***/ "./src/util/updateIcon.ts"
/*!********************************!*\
  !*** ./src/util/updateIcon.ts ***!
  \********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ updateIcon)
/* harmony export */ });
function updateIcon(asUnread) {
  document.querySelectorAll('link[rel="icon"], link[rel="alternate icon"]').forEach(link => {
    if (asUnread) {
      if (!link.href.includes('favicon-unread')) {
        link.href = link.href.replace('favicon', 'favicon-unread');
      }
    } else {
      link.href = link.href.replace('favicon-unread', 'favicon');
    }
  });
}

/***/ },

/***/ "./src/util/updatePageTitle.ts"
/*!*************************************!*\
  !*** ./src/util/updatePageTitle.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   setPageTitle: () => (/* binding */ setPageTitle),
/* harmony export */   setPageTitleInstant: () => (/* binding */ setPageTitleInstant)
/* harmony export */ });
/* harmony import */ var _browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _schedulers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./schedulers */ "./src/util/schedulers.ts");


const UPDATE_DEBOUNCE_MS = 200;

// For some reason setting `document.title` to the same value
// causes increment of Chrome Dev Tools > Performance Monitor > DOM Nodes counter
function setPageTitleInstant(nextTitle) {
  if (_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_ELECTRON) {
    window.electron.setWindowTitle(nextTitle);
    return;
  }
  if (document.title !== nextTitle) {
    document.title = nextTitle;
  }
}

// Synchronous page title update has conflicts with History API in Chrome
const setPageTitle = (0,_schedulers__WEBPACK_IMPORTED_MODULE_1__.debounce)(setPageTitleInstant, UPDATE_DEBOUNCE_MS, false);

/***/ },

/***/ "./src/versionNotification.txt"
/*!*************************************!*\
  !*** ./src/versionNotification.txt ***!
  \*************************************/
(module) {

module.exports = "**Telegram Web A Digest**\n\nMany new features and useful optimizations have been added in recent months. Here is a brief overview of what's been happening in Web A since August.\n\n**September  November**\n\n__General__\n[Reply Revolution](https://telegram.org/blog/reply-revolution#reply-revolution) the app learned to quote specific parts of any message, making your responses 100% precise.\nAlso, [Quote Formatting](https://telegram.org/blog/reply-revolution#quote-formatting)have arrived.\n\n__Channels__\nChannels added [boosts](https://telegram.org/blog/channel-stories#stories-for-channels)and [giveaways.](https://telegram.org/blog/giveaways#free-telegram-premium)\nUsers also got an option to reassign their boosts between channels.\n\n__Stories__\nNumerous improvements have been made to the animations flow, ensuring the stories bar expands more smoothly. Additionally, a package of optimizations has been added to enhance the performance of stories on mobile devices.\nStories have been introduced for [channels,](https://telegram.org/blog/channel-stories#stories-for-channels)and the story viewer has been updated with new gestures to expand and reply.\n\n__Settings__\n The app has added an option, 'Who can find me by phone number,' along with a setting under 'Privacy and Security' to manage the visibility of your bio.\n\n__Extra__\nSome further improvements have been made to the Mini Apps area.\nNew security notifications have been added to the chat list to alert you when your account is logged into from a new device.\nNew design for code blocks formatting.\n\n**December  February**\n\n__General__\n[Saved Messages 2.0](https://telegram.org/blog/new-saved-messages-and-9-more#saved-messages-2-0) including tags, My Notes, Replies and forwards from hidden authors.\n[One-Time Voice Messages](https://telegram.org/blog/new-saved-messages-and-9-more#one-time-voice-and-video-messages)including both listening and recording. Added support for viewing One-Time Video Messages.\n[Read-Time in Private Chats](https://telegram.org/blog/new-saved-messages-and-9-more#read-time-in-private-chats)\nYou can now replace media when editing messages.\nThe app learned to [preserve the selected mode](https://telegram.org/blog/similar-channels#improvements-for-topics)for topics in groups.\nWhenever you create a small group, Web A suggests a name for it based on users' name you have added.\n\n__Channels__\nAdded [custom channel reactions.](https://telegram.org/blog/similar-channels#custom-reactions-for-channels)\nImplemented [channel stories stats.](https://telegram.org/blog/similar-channels#story-stats-for-channels)\nChannel emoji statuses.\n[Similar Channels.](https://telegram.org/blog/similar-channels#similar-channels)\n\n__Groups__\n[9 new features for groups.](https://telegram.org/blog/february2024)\n\n __Bots__\nEdit your bots info right from their profile.\n\n__Stories__\nAdded support for [forwarded stories](https://telegram.org/blog/posts-in-stories-and-more#view-reposts-and-more)and [channel posts in stories.](https://telegram.org/blog/posts-in-stories-and-more#share-posts-in-stories)\n\n__Extra__\nGiveaway Improvements: displaying winners list and additional prizes.\n\n**March**\n\n__Channels__\nAdmins will soon be able to launch giveaways in their channels.\n\n__Extra__\nAdded support for Emoji v15.1.\nSome design enhancements for shared contacts, links preview and more.\n";

/***/ }

}]);
//# sourceMappingURL=BundleMain.f454b7d91c9082265dd6.js.map