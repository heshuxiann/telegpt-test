"use strict";(self.webpackChunktelegram_t=self.webpackChunktelegram_t||[]).push([[2859],{12859:(t,e,a)=>{a.d(e,{Hc:()=>M,JD:()=>w,cw:()=>v,ow:()=>T,re:()=>P,sN:()=>x});var s=a(66644),d=a(96454),i=a(85982),o=a(14487),n=a(87894),r=a(6e4),c=a(41733),l=a(24021),h=a(90709),u=a(13439),I=a(80840),p=a(32989),m=a(29807),g=a(71331),f=a(42347);const b="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";let C,V,y;function v(){return w(),Promise.all(Object.values(y).map((t=>{const e=t.src;return t.src=b,t.muted=!0,t.volume=1e-4,t.play().then((()=>{t.pause(),t.volume=1,t.currentTime=0,t.muted=!1,(0,s.Uz)((()=>{t.src=e}))}))})))}function w(){if(y)return;const t=new Audio("./voicechat_join.mp3"),e=new Audio("./voicechat_connecting.mp3");e.loop=!0;const a=new Audio("./voicechat_leave.mp3"),s=new Audio("./voicechat_onallowtalk.mp3"),d=new Audio("./call_busy.mp3"),i=new Audio("./call_connect.mp3"),o=new Audio("./call_end.mp3"),n=new Audio("./call_incoming.mp3");n.loop=!0;const r=new Audio("./call_ringing.mp3");r.loop=!0,y={join:t,allowTalk:s,leave:a,connecting:e,incoming:n,end:o,connect:i,busy:d,ringing:r}}async function F(t,e){if((0,m.trm)(t))return;const a=await(0,l.px)("getGroupCall",{call:e});if(!a)return;t=(0,u.mS)();const s=(0,g.Ip)(t,e.id);return t=(0,I.h9)(t,e.id,(0,n.cJ)(a.groupCall,["connectionState"]),void 0,s?.isLoaded?void 0:a.groupCall.participantsCount),(0,u.UF)(t),a.groupCall}function A(t,e){return(0,l.px)("fetchGroupCallParticipants",{call:t,offset:e})}(0,u.aJ)("toggleGroupCallPanel",((t,e,a)=>{const{force:s,tabId:d=(0,o.g0)()}=a||{};return(0,p.w)(t,{isCallPanelVisible:"force"in(a||{})?s:!(0,m.nTw)(t,d).isCallPanelVisible},d)})),(0,u.aJ)("subscribeToGroupCallUpdates",(async(t,e,a)=>{if((0,m.trm)(t))return;const{subscribed:s,id:d}=a,i=(0,g.Ip)(t,d);i&&(s&&(await F(t,i),t=(0,u.mS)(),await A(i)),await(0,l.px)("toggleGroupCallStartSubscription",{subscribed:s,call:i}))})),(0,u.aJ)("createGroupCall",(async(t,e,a)=>{const{chatId:s,tabId:d=(0,o.g0)()}=a,i=(0,m.hds)(t,s);if(!i)return;const n=await(0,l.px)("createGroupCall",{peer:i});n&&(t=(0,u.mS)(),t=(0,I.h9)(t,n.id,{...n,chatId:s}),(0,u.UF)(t),e.requestMasterAndJoinGroupCall({id:n.id,accessHash:n.accessHash,tabId:d}))})),(0,u.aJ)("createGroupCallInviteLink",(async(t,e,a)=>{const{tabId:s=(0,o.g0)()}=a||{},d=(0,g.iT)(t);if(!d||!d.chatId)return;const n=(0,m.hds)(t,d.chatId);if(!n)return;const r=Boolean((0,h.Kl)(n));let c=(0,m.AWZ)(t,n.id)?.inviteLink;r&&(c=await(0,l.px)("exportGroupCallInvite",{call:d,canSelfUnmute:!1})),c&&((0,i.eM)(c),e.showNotification({message:{key:"LinkCopied"},tabId:s}))})),(0,u.aJ)("joinVoiceChatByLink",(async(t,e,a)=>{const{username:s,inviteHash:d,tabId:i=(0,o.g0)()}=a,n=await(0,f.A$)(t,s);if(!n)return void e.showNotification({message:r.yE("NoUsernameFound"),tabId:i});t=(0,u.mS)();const c=await(0,f.ad)(t,e,n);c?.groupCall&&e.requestMasterAndJoinGroupCall({id:c.groupCall.id,accessHash:c.groupCall.accessHash,inviteHash:d,tabId:i})})),(0,u.aJ)("requestMasterAndJoinGroupCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"joinGroupCall",payload:a,tabId:a.tabId||(0,o.g0)()})})),(0,u.aJ)("requestMasterAndAcceptCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"acceptCall",payload:void 0,tabId:a?.tabId||(0,o.g0)()})})),(0,u.aJ)("joinGroupCall",(async(t,e,a)=>{const{chatId:s,id:i,accessHash:n,inviteHash:r,tabId:l=(0,o.g0)()}=a;if(!d.OL)return void e.showNotification({message:"Sorry, your browser doesn't support group calls",tabId:l});if(t.phoneCall)return void e.toggleGroupCallPanel({tabId:l});!function(){const t=new(window.AudioContext||window.webkitAudioContext);C=new Audio,V=t,C.srcObject=S(t),(0,c.A)(C)}(),w(),P(t=(0,u.mS)(),e,!0,l);const{groupCalls:{activeGroupCallId:h}}=t;let p=i?(0,g.Ip)(t,i):(0,g.mD)(t,s);if(p&&p.id===h)e.toggleGroupCallPanel({tabId:l});else if(h)"leaveGroupCall"in e&&e.leaveGroupCall({rejoin:a,tabId:l});else if(p&&h===p.id)e.toggleGroupCallPanel({tabId:l});else{if(p||i&&n||!s)!p&&i&&n&&(p=await F(t,{id:i,accessHash:n}));else{const a=(0,m.hds)(t,s);if(!a)return;await(0,f.ad)(t,e,a),t=(0,u.mS)(),p=(0,g.mD)(t,s)}p&&(t=(0,u.mS)(),t=(0,I.h9)(t,p.id,{...p,inviteHash:r},void 0,p.participantsCount+1),t={...t,groupCalls:{...t.groupCalls,activeGroupCallId:p.id}},(0,u.UF)(t),e.toggleGroupCallPanel({force:!1,tabId:l}))}})),(0,u.aJ)("playGroupCallSound",((t,e,a)=>{const{sound:s}=a;y[s]&&("connecting"!==s&&y.connecting.pause(),"incoming"!==s&&y.incoming.pause(),"ringing"!==s&&y.ringing.pause(),(0,c.A)(y[s]))})),(0,u.aJ)("loadMoreGroupCallParticipants",(t=>{const e=(0,g.iT)(t);e&&A(e,e.nextOffset)})),(0,u.aJ)("requestMasterAndRequestCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"requestCall",payload:a,tabId:a.tabId||(0,o.g0)()})})),(0,u.aJ)("requestCall",((t,e,a)=>{const{userId:s,isVideo:d,tabId:i=(0,o.g0)()}=a;t.phoneCall?e.toggleGroupCallPanel({tabId:i}):(0,m.mBe)(t,s)&&(w(),P(t=(0,u.mS)(),e,d,i),t=(0,u.mS)(),t={...t,phoneCall:{id:"",state:"requesting",participantId:s,isVideo:d,adminId:t.currentUserId}},(0,u.UF)(t),e.toggleGroupCallPanel({force:!1,tabId:i}))}));const S=t=>{const e=t.createOscillator(),a=e.connect(t.createMediaStreamDestination());return e.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])};function x(){return C}function M(){return V}function T(){C?.pause(),V=void 0,C=void 0}function P(t,e,a,...[s=(0,o.g0)()]){a?navigator.mediaDevices.getUserMedia({video:!0}).then((t=>{0===t.getVideoTracks().length?e.showNotification({message:r.yE("Call.Camera.Error"),tabId:s}):(t.getTracks().forEach((t=>t.stop())),U(0,e,s))})).catch((()=>{e.showNotification({message:r.yE("Call.Camera.Error"),tabId:s})})):U(0,e,s)}function U(t,e,...[a=(0,o.g0)()]){navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{0===t.getAudioTracks().length?e.showNotification({message:r.yE("RequestAcces.Error.HaveNotAccess.Call"),tabId:a}):t.getTracks().forEach((t=>t.stop()))})).catch((()=>{e.showNotification({message:r.yE("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})}))}},42347:(t,e,a)=>{a.d(e,{A$:()=>R,Jm:()=>L,ad:()=>k});var s=a(23174),d=a(89925),i=a(31481),o=a(85982),n=a(55148),r=a(46275),c=a(14487),l=a(49763),h=a(87894),u=a(60343),I=a(6e4),p=a(37836),m=a(59852),g=a(24021),f=a(90709),b=a(13439),C=a(17872),V=a(80840),y=a(32989),v=a(29807),w=a(71331),F=a(64520),A=a(20919),S=a(30708);const x=new Set(["FILTERS_TOO_MUCH","CHATLISTS_TOO_MUCH","INVITES_TOO_MUCH"]),M=(0,p.nF)((t=>t()),3e3,!0),T=(0,p.sg)((t=>t()),500,!1,!0);function P(t,e){(0,g.px)("abortChatRequests",{chatId:t,threadId:e})}function U(t,e,a,...[s=(0,c.g0)()]){const d=(0,v.Xf0)(t,s),i=d?.chatId,o=d?.threadId;if(i&&(i!==e||o!==a)){const[a,d]=Object.values(t.byTabId).reduce((([e,a],{id:d})=>{if(d===s||e&&a)return[e,a];const n=(0,v.Xf0)(t,d),r=n?.chatId===i;return[e||r,a||r&&n?.threadId===o]}),[i===e,!1]);(!a||!d)&&P(i,a?o:void 0)}}async function J(t,e,a){let d=(0,b.mS)(),o=(0,v.xzS)(d)?.id;const n=a?{}:(0,v.$TA)(d,t),r=n.nextOffsetPeerId?(0,v.PVB)(d,n.nextOffsetPeerId):void 0,c=n.nextOffsetDate,l=n.nextOffsetId,u=!(a||r||c||l),I="active"===t&&u,p=(0,v.trm)(d),m="saved"===t?await(0,g.px)("fetchSavedChats",{limit:i.uCr,offsetDate:c,offsetId:l,offsetPeer:r,withPinned:u&&!p}):await(0,g.px)("fetchChats",{limit:i.uCr,offsetDate:c,offsetId:l,offsetPeer:r,archived:"archived"===t,withPinned:u&&!p,lastLocalServiceMessageId:o});if(!m)return;const{chatIds:f}=m;d=(0,b.mS)(),o=(0,v.xzS)(d)?.id;const V=(0,h.dU)(m.chats,"id");d=(0,C.CKT)(d,(0,h.dU)(m.users,"id")),d=(0,C.h7P)(d,V),d=u?(0,C.hOQ)(d,t,f):(0,C.ec2)(d,t,f),I?(d=(0,C.wWy)(d,m.userStatusesById),d=(0,C.GEE)(d,m.notifyExceptionById)):(d=(0,C.d2X)(d,m.userStatusesById),d=(0,C.DeY)(d,m.notifyExceptionById)),d=(0,C.qwk)(d,t,m),d=(0,C.tTf)(d,m.messages),d=(0,C.XUr)(d,m.lastMessageByChatId,t),a||(d=(0,C.tPq)(d,t,m.nextOffsetId,m.nextOffsetPeerId,m.nextOffsetDate)),(e?m.chatIds:Object.keys(m.draftsById)).forEach((t=>{const e=m.draftsById[t],a=(0,v.$jd)(d,t,s.l3);(e||a)&&((0,v.GA4)(d,t,s.l3)?.isLocal||(d=(0,C.eww)(d,t,s.l3,"draft",e)))})),0!==f.length&&f.length!==m.totalChatCount||d.chats.isFullyLoaded[t]||(d={...d,chats:{...d.chats,isFullyLoaded:{...d.chats.isFullyLoaded,[t]:!0}}}),(0,b.UF)(d)}async function k(t,e,a){if((0,v.trm)(t))return;const s=await(0,g.px)("fetchFullChat",a);if(!s)return;const{chats:d,userStatusesById:i,fullInfo:o,groupCall:n,membersCount:r,isForumAsMessages:c}=s;if(t=(0,b.mS)(),t=(0,C.h7P)(t,(0,h.dU)(d,"id")),i&&(t=(0,C.d2X)(t,i)),n){const e=(0,w.Ip)(t,n.id);t=(0,V.h9)(t,n.id,(0,h.cJ)(n,["connectionState","isLoaded"]),void 0,e?void 0:n.participantsCount)}void 0!==r&&(t=(0,C.wix)(t,a.id,{membersCount:r})),a.isForum&&(t=(0,C.wix)(t,a.id,{isForumAsMessages:c})),t=(0,C.iW2)(t,a.id,o),(0,b.UF)(t);const l=o.stickerSet,u=l&&(0,v.ycM)(t,l);l&&!u&&e.loadStickers({stickerSetInfo:{id:l.id,accessHash:l.accessHash}});const I=o.emojiSet,p=I&&(0,v.ycM)(t,I);return I&&!p&&e.loadStickers({stickerSetInfo:{id:I.id,accessHash:I.accessHash}}),s}async function R(t,e,a){t=(0,b.mS)();const s=a?void 0:(0,v.qn$)(t,e);if(s&&!s.isMin)return s;const{chat:d,user:i}=await(0,g.px)("getChatByUsername",e,a)||{};return d?(t=(0,b.mS)(),t=(0,C.wix)(t,d.id,d),i&&(t=(0,C.TKu)(t,i.id,i)),(0,b.UF)(t),d):void 0}async function B(t,e,a,...[s=(0,c.g0)()]){const d=await R(t,a);if(!d)return;t=(0,b.mS)();const i=(0,v.mBe)(t,d.id);if(!i)return;if(!(0,f.tv)(i))return;const o=await(0,g.px)("loadAttachBot",{bot:i});if(t=(0,b.mS)(),o)return(0,b.UF)(t),o.bot;e.showNotification({message:I.yE("WebApp.AddToAttachmentUnavailableError"),tabId:s})}async function E(t,e,a,d,...[i=(0,c.g0)()]){const{isCurrentChat:o,threadId:n,messageId:r,startParam:l,referrer:h,startAttach:u,attach:I,text:p,timestamp:m}=d;if(r){let s=!1;if(a.isForum&&!n){let d=(0,v.pSx)(t,a.id)?.[r];if(!d){const t=await(0,g.px)("fetchTopicById",{chat:a,topicId:r});d=t?.topic}d&&(e.openThread({chatId:a.id,threadId:d.id,tabId:i}),s=!0)}s||e.focusMessage({chatId:a.id,threadId:n,messageId:r,timestamp:m,tabId:i})}else o||e.openThread({chatId:a.id,threadId:n??s.l3,tabId:i});l&&!h&&e.startBot({botId:a.id,param:l}),I&&H(t=(0,b.mS)(),e,a.id,I,u,i),p&&e.openChatWithDraft({chatId:a.id,text:{text:p},tabId:i}),r&&m&&e.openMediaFromTimestamp({chatId:a.id,threadId:n,messageId:r,timestamp:m,tabId:i})}async function H(t,e,a,s,d,...[i=(0,c.g0)()]){t=(0,b.mS)();const o=await B(t,e,s,i);o&&e.callAttachBot({bot:o,chatId:a,..."string"==typeof d&&{startParam:d},tabId:i})}async function L(t,e,a,...[s=(0,c.g0)()]){const d=(0,v.hds)(t,a);if(!d||!(0,f.yn)(d))return d;const i=await async function(t,e,a,...[s=(0,c.g0)()]){try{return await(0,g.px)("migrateChat",a)}catch(t){return void("CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:s}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:s}))}}(0,e,d,s);return i?(e.loadFullChat({chatId:i.id}),e.openChat({id:i.id,tabId:s}),i):void 0}(0,b.aJ)("preloadTopChatMessages",(async(t,e)=>{const a=new Set;for(let d=0;d<i.irO;d++){await(0,p.v7)(100),t=(0,b.mS)();const d=Object.values(t.byTabId).map((({id:e})=>(0,v.Xf0)(t,e)?.chatId)).filter(Boolean),o=(0,l.YA)(i.DSF),n=o?.find((t=>!d.includes(t)&&!a.has(t)));if(!n)return;a.add(n),e.loadViewportMessages({chatId:n,threadId:s.l3,tabId:(0,c.g0)()})}})),(0,b.aJ)("openChat",((t,e,a)=>{const{id:d,type:o,noForumTopicPanel:n,shouldReplaceHistory:r,shouldReplaceLast:l,tabId:h=(0,c.g0)()}=a;if(e.processOpenChatOrThread({chatId:d,type:o,threadId:s.l3,noForumTopicPanel:n,shouldReplaceHistory:r,shouldReplaceLast:l,tabId:h}),U(t,d,s.l3,h),!d||d===i.Xab)return;const u=(0,v.hds)(t,d);u?.hasUnreadMark&&e.markChatRead({id:d});const I=!(0,v.ZZX)(t,d);if(u)I&&!u.isMin&&e.requestChatUpdate({chatId:d});else if((0,v.nZ4)(t,d))(0,g.px)("fetchChat",{type:"self"});else{const e=(0,v.mBe)(t,d);e&&(0,g.px)("fetchChat",{type:"user",user:e})}})),(0,b.aJ)("openSavedDialog",((t,e,a)=>{const{chatId:s,tabId:d=(0,c.g0)(),...i}=a;e.openThread({chatId:t.currentUserId,threadId:s,tabId:d,...i})})),(0,b.aJ)("openThread",(async(t,e,a)=>{const{type:d,isComments:i,noForumTopicPanel:o,shouldReplaceHistory:n,shouldReplaceLast:r,focusMessageId:l,tabId:u=(0,c.g0)()}=a;let p,m,V,{chatId:w}=a;if(i){const{originChannelId:t,originMessageId:e}=a;m=t,V=e}else{m=a.chatId,p=a.threadId,V=p;const c=(0,v.hds)(t,m);if(p===s.l3)return void e.openChat({id:w,type:d,noForumTopicPanel:o,shouldReplaceHistory:n,shouldReplaceLast:r,tabId:u});if(c?.isForum||w&&(0,f.cG)(w,p,t.currentUserId))return void e.processOpenChatOrThread({chatId:w,type:d,threadId:p,isComments:i,noForumTopicPanel:o,shouldReplaceHistory:n,shouldReplaceLast:r,tabId:u})}const F=(0,v.hds)(t,m),A=(0,v.Vw0)(t,m,V),S=(0,v.$jd)(t,m,V);if(!F)return;if(U(t,m,V,u),w&&A?.threadId&&(i||S?.listedIds?.length&&S.listedIds.includes(Number(A.threadId))))return t=(0,y.w)(t,{loadingThread:void 0},u),(0,b.UF)(t),void e.processOpenChatOrThread({chatId:w,type:d,threadId:A.threadId,isComments:i,noForumTopicPanel:o,shouldReplaceHistory:n,shouldReplaceLast:r,tabId:u});let{loadingThread:x}=(0,v.nTw)(t,u);x&&P(x.loadingChatId,x.loadingMessageId),t=(0,y.w)(t,{loadingThread:{loadingChatId:m,loadingMessageId:Number(V)}},u),(0,b.UF)(t);const M=()=>{const t=(0,b.mS)();i||(0,v.Xf0)(t,u)?.chatId!==m||(0,v.Xf0)(t,u)?.threadId!==V||e.openPreviousChat({tabId:u})};i||e.processOpenChatOrThread({chatId:w,type:d,threadId:p,tabId:u,isComments:i,noForumTopicPanel:o,shouldReplaceHistory:n,shouldReplaceLast:r});const T=(0,v.trm)(t)?void 0:await(0,g.px)("fetchDiscussionMessage",{chat:(0,v.hds)(t,m),messageId:Number(V)});if(t=(0,b.mS)(),x=(0,v.nTw)(t,u).loadingThread,x?.loadingChatId===m&&x?.loadingMessageId===V){if(!T)return t=(0,y.w)(t,{loadingThread:void 0},u),(0,b.UF)(t),e.showNotification({message:I.yE(i?"ChannelPostDeleted":"lng_message_not_found"),tabId:u}),void M();p??(p=T.threadId),w??(w=T.chatId),w?(t=(0,b.mS)(),t=(0,C.KcS)(t,T.messages),i&&(t=(0,C.eAk)(t,m,V,{threadId:p}),t=(0,C.eAk)(t,w,p,{isCommentsInfo:!1,threadId:p,chatId:w,fromChannelId:m,fromMessageId:V,...A&&(0,h.Up)(A,["messagesCount","lastMessageId","lastReadInboxMessageId","recentReplierIds"])})),t=(0,C.e49)(t,w,p,{firstMessageId:T.firstMessageId}),(0,b.UF)(t),l&&e.focusMessage({chatId:w,threadId:p,messageId:l,tabId:u}),e.loadViewportMessages({chatId:w,threadId:p,tabId:u,onError:()=>{t=(0,b.mS)(),t=(0,y.w)(t,{loadingThread:void 0},u),(0,b.UF)(t),e.showNotification({message:I.yE("Group.ErrorAccessDenied"),tabId:u})},onLoaded:()=>{t=(0,b.mS)(),x=(0,v.nTw)(t,u).loadingThread,x?.loadingChatId===m&&x?.loadingMessageId===V&&(t=(0,y.w)(t,{loadingThread:void 0},u),(0,b.UF)(t),e.processOpenChatOrThread({chatId:w,type:d,threadId:p,tabId:u,isComments:i,noForumTopicPanel:o,shouldReplaceHistory:n,shouldReplaceLast:r}))}})):M()}else M()})),(0,b.aJ)("openLinkedChat",(async(t,e,a)=>{const{id:s,tabId:d=(0,c.g0)()}=a,i=(0,v.hds)(t,s);if(!i)return;const o=await(0,g.px)("fetchFullChat",i);o?.fullInfo?.linkedChatId&&e.openChat({id:o.fullInfo.linkedChatId,tabId:d})})),(0,b.aJ)("openSupportChat",(async(t,e,a)=>{const{tabId:s=(0,c.g0)()}=a||{},d=(0,v.ke9)(t);if(d)return void e.openChat({id:d.id,shouldReplaceHistory:!0,tabId:s});e.openChat({id:i.Xab,shouldReplaceHistory:!0,tabId:s});const o=await(0,g.px)("fetchChat",{type:"support"});o&&e.openChat({id:o.chatId,shouldReplaceHistory:!0,tabId:s})})),(0,b.aJ)("loadAllChats",(async(t,e,a)=>{const{whenFirstBatchDone:s}=a,d=a.listType;let o=!1,n=0;for(;!t.chats.isFullyLoaded[d];){if(n++>=100)return void(i.Oig&&console.error("`actions/loadAllChats`: Infinite loop detected"));if("connectionStateReady"!==(t=(0,b.mS)()).connectionState||"authorizationStateReady"!==t.authState)return;await J(d,!0),o||(await(s?.()),o=!0),t=(0,b.mS)()}})),(0,b.aJ)("loadFullChat",((t,e,a)=>{const{chatId:s,force:d,withPhotos:i}=a,o=(0,v.hds)(t,s);if(!o)return;const n=async()=>{await k(t,e,o),i&&e.loadMoreProfilePhotos({peerId:s,shouldInvalidateCache:!0})};d?n():T(n)})),(0,b.aJ)("loadTopChats",(()=>{M((()=>{J("active",void 0,!0),J("archived",void 0,!0)}))})),(0,b.aJ)("requestChatUpdate",((t,e,a)=>{const{chatId:s}=a,d=(0,v.hds)(t,s);d&&(0,g.px)("requestChatUpdate",{chat:d,...s===i.zv8&&{lastLocalMessage:(0,v.xzS)(t)?.message}})})),(0,b.aJ)("requestSavedDialogUpdate",(async(t,e,a)=>{const{chatId:s}=a,d=(0,v.hds)(t,s);if(!d)return;const i=await(0,g.px)("fetchMessages",{chat:d,isSavedDialog:!0,limit:1});i&&(t=(0,b.mS)(),t=(0,C.KcS)(t,i.messages),i.messages.length?(t=(0,C.yKC)(t,s,i.messages[0].id,"saved"),t=(0,C.ec2)(t,"saved",[s]),(0,b.UF)(t)):(t=(0,C.SJu)(t,s,"saved"),(0,b.UF)(t),Object.values(t.byTabId).forEach((({id:a})=>{const d=(0,v.Xf0)(t,a);if(!d)return;const{chatId:i,threadId:o}=d;(0,v.nZ4)(t,i)&&o===s&&e.openChat({id:void 0,tabId:a})}))))})),(0,b.aJ)("updateChatMutedState",((t,e,a)=>{const{chatId:s,isMuted:d}=a;let{mutedUntil:o}=a;if((0,v.trm)(t))return void e.openFrozenAccountModal({tabId:(0,c.g0)()});const n=(0,v.hds)(t,s);n&&(d&&!o&&(o=i.fRl),(0,g.px)("updateChatNotifySettings",{chat:n,settings:{mutedUntil:o}}))})),(0,b.aJ)("updateChatSilentPosting",((t,e,a)=>{const{chatId:s,isEnabled:d}=a,i=(0,v.hds)(t,s);i&&(0,g.px)("updateChatNotifySettings",{chat:i,settings:{isSilentPosting:d}})})),(0,b.aJ)("updateTopicMutedState",((t,e,a)=>{const{chatId:s,topicId:d,isMuted:i,mutedUntil:o}=a,n=(0,v.hds)(t,s);n&&(0,g.px)("updateTopicMutedState",{chat:n,topicId:d,isMuted:i,mutedUntil:o})})),(0,b.aJ)("createChannel",(async(t,e,a)=>{const{title:s,about:i,photo:o,memberIds:n,tabId:r=(0,c.g0)()}=a,l=n.map((e=>(0,v.mBe)(t,e))).filter(Boolean);let h,u;t=(0,y.w)(t,{chatCreation:{progress:d.n7.InProgress}},r),(0,b.UF)(t);try{const t=await(0,g.px)("createChannel",{title:s,about:i,users:l});h=t?.channel,u=t?.missingUsers}catch(a){t=(0,b.mS)(),t=(0,y.w)(t,{chatCreation:{progress:d.n7.Error}},r),(0,b.UF)(t),"CHANNELS_TOO_MUCH"===a.message?e.openLimitReachedModal({limit:"channels",tabId:r}):e.showDialog({data:{...a,hasErrorKey:!0},tabId:r})}if(!h)return;const{id:I,accessHash:p}=h;t=(0,b.mS)(),t=(0,C.wix)(t,I,h),t=(0,y.w)(t,{chatCreation:{...(0,v.nTw)(t,r).chatCreation,progress:h?d.n7.Complete:d.n7.Error}},r),(0,b.UF)(t),e.openChat({id:I,shouldReplaceHistory:!0,tabId:r}),u&&(t=(0,b.mS)(),t=(0,C.hQe)(t,I,u,r),(0,b.UF)(t)),I&&p&&o&&await(0,g.px)("editChatPhoto",{chatId:I,accessHash:p,photo:o})})),(0,b.aJ)("joinChannel",(async(t,e,a)=>{const{chatId:s,tabId:d=(0,c.g0)()}=a,i=(0,v.hds)(t,s);if(!i)return;const{id:o,accessHash:n}=i;if(o&&n)try{await(0,g.px)("joinChannel",{channelId:o,accessHash:n})}catch(t){"CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:d}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:d})}})),(0,b.aJ)("deleteChatUser",((t,e,a)=>{const{chatId:s,userId:d,shouldRevokeHistory:i,tabId:o=(0,c.g0)()}=a,n=(0,v.hds)(t,s),r=(0,v.mBe)(t,d);n&&r&&(t=(0,C.CX_)(t,s),(0,b.UF)(t),(0,v.Xf0)(t,o)?.chatId===s&&e.openChat({id:void 0,tabId:o}),(0,g.px)("deleteChatUser",{chat:n,user:r,shouldRevokeHistory:i}))})),(0,b.aJ)("deleteChat",((t,e,a)=>{const{chatId:s,tabId:d=(0,c.g0)()}=a,i=(0,v.hds)(t,s);i&&(t=(0,C.CX_)(t,s),(0,b.UF)(t),(0,v.Xf0)(t,d)?.chatId===s&&e.openChat({id:void 0,tabId:d}),(0,g.px)("deleteChat",{chatId:i.id}))})),(0,b.aJ)("leaveChannel",(async(t,e,a)=>{const{chatId:s,tabId:d=(0,c.g0)()}=a,i=(0,v.hds)(t,s);if(!i)return;t=(0,C.CX_)(t,s),(0,b.UF)(t),(0,v.Xf0)(t,d)?.chatId===s&&e.openChat({id:void 0,tabId:d});const{id:o,accessHash:n}=i;if(o&&n){await(0,g.px)("leaveChannel",{channelId:o,accessHash:n}),t=(0,b.mS)();const e=(0,v.zeq)(t,s),a=Object.keys(e).map(Number).filter(u.iL);t=(0,C.AH0)(t,s,a),(0,b.UF)(t)}})),(0,b.aJ)("deleteChannel",((t,e,a)=>{const{chatId:s,tabId:d=(0,c.g0)()}=a,i=(0,v.hds)(t,s);if(!i)return;t=(0,C.CX_)(t,s),(0,b.UF)(t),(0,v.Xf0)(t,d)?.chatId===s&&e.openChat({id:void 0,tabId:d});const{id:o,accessHash:n}=i;o&&n&&(0,g.px)("deleteChannel",{channelId:o,accessHash:n})})),(0,b.aJ)("createGroupChat",(async(t,e,a)=>{const{title:s,memberIds:i,photo:o,tabId:n=(0,c.g0)()}=a,r=i.map((e=>(0,v.mBe)(t,e))).filter(Boolean);t=(0,y.w)(t,{chatCreation:{progress:d.n7.InProgress}},n),(0,b.UF)(t);try{const{chat:a,missingUsers:i}=await(0,g.px)("createGroupChat",{title:s,users:r})??{};if(!a)return;const{id:c}=a;t=(0,b.mS)(),t=(0,C.wix)(t,c,a),t=(0,y.w)(t,{chatCreation:{...(0,v.nTw)(t,n).chatCreation,progress:a?d.n7.Complete:d.n7.Error}},n),(0,b.UF)(t),e.openChat({id:c,shouldReplaceHistory:!0,tabId:n}),i&&(t=(0,b.mS)(),t=(0,C.hQe)(t,c,i,n),(0,b.UF)(t)),c&&o&&await(0,g.px)("editChatPhoto",{chatId:c,photo:o})}catch(e){"USERS_TOO_FEW"===e.message&&(t=(0,b.mS)(),t=(0,y.w)(t,{chatCreation:{...(0,v.nTw)(t,n).chatCreation,progress:d.n7.Error,error:"CreateGroupError"}},n),(0,b.UF)(t))}})),(0,b.aJ)("toggleChatPinned",((t,e,a)=>{const{id:s,folderId:d,tabId:o=(0,c.g0)()}=a;if((0,v.trm)(t))return void e.openFrozenAccountModal({tabId:o});const n=(0,v.hds)(t,s);if(!n)return;const r=(0,F.d)(t,"dialogFolderPinned");if(d){const e=(0,v.$aQ)(t,d);if(e){const a=!(0,v.D3D)(t,s,d),{pinnedChatIds:i,includedChatIds:o}=e,n=a?[s,...i||[]]:(i||[]).filter((t=>t!==s)),r=[s,...o];(0,g.px)("editChatFolder",{id:d,folderUpdate:{...e,pinnedChatIds:n,includedChatIds:r}})}}else{const a=(0,v.P4G)(t,s),d=(0,v.D3D)(t,s,"archived"===a?i._E9:void 0),c=t.chats.orderedPinnedIds["archived"===a?"archived":"active"];if((c?.length||0)>=r&&!d)return void e.openLimitReachedModal({limit:"dialogFolderPinned",tabId:o});(0,g.px)("toggleChatPinned",{chat:n,shouldBePinned:!d})}})),(0,b.aJ)("toggleChatArchived",((t,e,a)=>{const{id:s}=a;if((0,v.trm)(t))return void e.openFrozenAccountModal({tabId:(0,c.g0)()});const d=(0,v.hds)(t,s);d&&(0,g.px)("toggleChatArchived",{chat:d,folderId:(0,f.TJ)(d)?0:i._E9})})),(0,b.aJ)("toggleSavedDialogPinned",((t,e,a)=>{const{id:s,tabId:d=(0,c.g0)()}=a;if((0,v.trm)(t))return void e.openFrozenAccountModal({tabId:d});const o=(0,v.hds)(t,s);if(!o)return;const n=(0,F.d)(t,"savedDialogsPinned"),r=(0,v.D3D)(t,s,i.pX9),l=t.chats.orderedPinnedIds.saved;(l?.length||0)>=n&&!r?e.openLimitReachedModal({limit:"savedDialogsPinned",tabId:d}):(0,g.px)("toggleSavedDialogPinned",{chat:o,shouldBePinned:!r})})),(0,b.aJ)("loadChatFolders",(async t=>{const e=await(0,g.px)("fetchChatFolders");if(e&&(t=(0,b.mS)(),t={...t,chatFolders:{...t.chatFolders,...e}},(0,b.UF)(t)),e?.byId&&Object.keys(e?.byId).length>0){const t=await(A.zs.folder?.getAllFolders());t?.forEach((async t=>{Object.keys(e?.byId).indexOf(t?.id+"")<0&&await(A.zs.folder?.deleteFolder(t?.title))})),Object.keys(e?.byId)?.forEach((async a=>{const s=e?.byId[Number(a)],d=t?.findIndex((t=>t?.title===s.title?.text));d&&d<0&&await(A.zs.folder?.addFolder({id:Number(a),title:s?.title?.text,includedChatIds:s?.includedChatIds,excludedChatIds:s?.excludedChatIds,from:"user"}))}))}const{aiChatFolders:a}=(0,S.l)(t);if(!0===a){const a=await(A.zs.aIChatFolders?.getAllAIChatFolders()),s=await(A.zs.general?.get(A.HM)),d=await(A.zs.general?.get(A.al));if(a&&a?.length>0){t=(0,b.mS)();let o=e?.orderedIds??[];o.splice(3,0,i.j7l),o.push(i.LFk),o.push(i.Sab),t={...t,chatFolders:{...t.chatFolders,orderedIds:o,aiChatFolders:{activePresetTag:s,activeAITag:d,list:a}}},(0,b.UF)(t)}}else t=(0,b.mS)(),t={...t,chatFolders:{...t.chatFolders,orderedIds:(e?.orderedIds??[]).filter((t=>t!==i.LFk&&t!==i.Sab)),aiChatFolders:{activePresetTag:[],activeAITag:[],list:[]}}},(0,b.UF)(t)})),(0,b.aJ)("loadRecommendedChatFolders",(async t=>{const e=await(0,g.px)("fetchRecommendedChatFolders");e&&(t=(0,b.mS)(),t={...t,chatFolders:{...t.chatFolders,recommended:e}},(0,b.UF)(t))})),(0,b.aJ)("editChatFolders",((t,e,a)=>{const{chatId:s,idsToRemove:d,idsToAdd:i,tabId:o=(0,c.g0)()}=a,n=(0,F.d)(t,"dialogFiltersChats");i.some((e=>(0,v.$aQ)(t,e).includedChatIds.length>=n))?e.openLimitReachedModal({limit:"dialogFiltersChats",tabId:o}):(d.forEach((async e=>{const a=(0,v.$aQ)(t,e);a&&await(0,g.px)("editChatFolder",{id:e,folderUpdate:{...a,pinnedChatIds:a.pinnedChatIds?.filter((t=>t!==s)),includedChatIds:a.includedChatIds.filter((t=>t!==s))}})})),i.forEach((async e=>{const a=(0,v.$aQ)(t,e);a&&await(0,g.px)("editChatFolder",{id:e,folderUpdate:{...a,includedChatIds:a.includedChatIds.concat(s)}})})))})),(0,b.aJ)("editChatFolder",((t,e,a)=>{const{id:s,folderUpdate:d,from:i="user"}=a,o=(0,v.$aQ)(t,s);o&&((0,g.px)("editChatFolder",{id:s,folderUpdate:{id:s,emoticon:o.emoticon,pinnedChatIds:o.pinnedChatIds,...d}}),A.zs.folder?.addFolder({id:s,title:d?.title?.text,includedChatIds:d?.includedChatIds,excludedChatIds:d?.excludedChatIds,from:i}))})),(0,b.aJ)("addChatFolder",(async(t,e,a)=>{const{folder:s,tabId:d=(0,c.g0)(),from:o="user"}=a,{orderedIds:n,byId:r}=t.chatFolders,l=(0,F.d)(t,"dialogFilters");if(Object.keys(r).length>=l)return void e.openLimitReachedModal({limit:"dialogFilters",tabId:d});const h=Math.max(...n||[],i._E9),{id:u,description:I,...p}=s,m=h+1,f={id:m,...p};if(await(0,g.px)("editChatFolder",{id:m,folderUpdate:f}),e.apiUpdate({"@type":"updateChatFolder",id:m,folder:f}),await(A.zs.folder?.addFolder({id:m,title:f?.title?.text,includedChatIds:f?.includedChatIds,excludedChatIds:f?.excludedChatIds,from:o})),e.requestNextSettingsScreen({foldersAction:{type:"setFolderId",payload:h+1},tabId:d}),!I)return;t=(0,b.mS)();const{recommended:C}=t.chatFolders;C&&(t={...t,chatFolders:{...t.chatFolders,recommended:C.filter((({id:t})=>t!==u))}},(0,b.UF)(t))})),(0,b.aJ)("sortChatFolders",(async(t,e,a)=>{const{folderIds:s}=a;await(0,g.px)("sortChatFolders",s)&&(t=(0,b.mS)(),t={...t,chatFolders:{...t.chatFolders,orderedIds:s}},(0,b.UF)(t))})),(0,b.aJ)("deleteChatFolder",(async(t,e,a)=>{const{id:s}=a,d=(0,v.$aQ)(t,s);d&&(await(0,g.px)("deleteChatFolder",s),await(A.zs.folder?.deleteFolder(d.title.text)))})),(0,b.aJ)("markChatUnread",((t,e,a)=>{const{id:s}=a;if((0,v.trm)(t))return void e.openFrozenAccountModal({tabId:(0,c.g0)()});const d=(0,v.hds)(t,s);d&&(0,g.px)("toggleDialogUnread",{chat:d,hasUnreadMark:!d.hasUnreadMark})})),(0,b.aJ)("markChatMessagesRead",(async(t,e,a)=>{if((0,v.trm)(t))return;const{id:d}=a;if((0,v.trm)(t))return void e.openFrozenAccountModal({tabId:(0,c.g0)()});const i=(0,v.hds)(t,d);if(!i)return;if(!i.isForum)return await(0,g.px)("markMessageListRead",{chat:i,threadId:s.l3}),e.readAllMentions({chatId:d}),e.readAllReactions({chatId:d}),void(i.hasUnreadMark&&e.markChatRead({id:d}));let o,n=!0,r=0;for(;n;){const t=await(0,g.px)("fetchTopics",{chat:i,offsetDate:o?.date,offsetTopicId:o?.id,offsetId:o?.lastMessageId,limit:100});if(!t?.topics?.length)return;t.topics.forEach((t=>{(t.unreadCount||t.unreadMentionsCount||t.unreadReactionsCount)&&e.markTopicRead({chatId:d,topicId:t.id})})),o=t.topics[t.topics.length-1],r+=t.topics.length,t.count<=r&&(n=!1)}})),(0,b.aJ)("markChatRead",((t,e,a)=>{const{id:s}=a,d=(0,v.hds)(t,s);d&&(0,g.px)("toggleDialogUnread",{chat:d,hasUnreadMark:!d.hasUnreadMark})})),(0,b.aJ)("markTopicRead",((t,e,a)=>{if((0,v.trm)(t))return;const{chatId:s,topicId:d}=a,i=(0,v.hds)(t,s);if(!i)return;const o=(0,v.S0q)(t,s,d),n=o?.lastMessageId;n&&((0,g.px)("markMessageListRead",{chat:i,threadId:d,maxId:n}),e.readAllMentions({chatId:s,threadId:d}),e.readAllReactions({chatId:s,threadId:d}),t=(0,b.mS)(),t=(0,C.TwA)(t,s,d,{unreadCount:0}),t=(0,C.eAk)(t,s,d,{lastReadInboxMessageId:n}),(0,b.UF)(t))})),(0,b.aJ)("checkChatInvite",(async(t,e,a)=>{const{hash:s,tabId:d=(0,c.g0)()}=a,i=await(0,g.px)("checkChatInvite",s);if(i){if(t=(0,b.mS)(),i.users&&(t=(0,C.g18)(t,(0,h.dU)(i.users,"id"))),i.chat)return t=(0,C.Nl5)(t,(0,h.dU)([i.chat],"id")),(0,b.UF)(t),void e.openChat({id:i.chat.id,tabId:d});if(i.invite.subscriptionFormId)return t=(0,y.w)(t,{starsPayment:{inputInvoice:{type:"chatInviteSubscription",hash:s},subscriptionInfo:i.invite,status:"pending"}},d),void(0,b.UF)(t);t=(0,y.w)(t,{chatInviteModal:{hash:s,inviteInfo:i.invite}},d),(0,b.UF)(t)}})),(0,b.aJ)("openChatByPhoneNumber",(async(t,e,a)=>{const{phoneNumber:s,startAttach:d,attach:o,text:n,tabId:r=(0,c.g0)()}=a;e.openChat({id:i.Xab,tabId:r});const l=await async function(t,e){t=(0,b.mS)();const a=(0,v.gTO)(t,e);if(a&&!a.isMin)return(0,v.hds)(t,a.id);const{chat:s,user:d}=await(0,g.px)("getChatByPhoneNumber",e)||{};return s?(t=(0,b.mS)(),t=(0,C.wix)(t,s.id,s),d&&(t=(0,C.TKu)(t,d.id,d)),(0,b.UF)(t),s):void 0}(t,s);if(!l)return e.openPreviousChat({tabId:r}),void e.showNotification({message:I.yE("lng_username_by_phone_not_found").replace("{phone}",s),tabId:r});n?e.openChatWithDraft({chatId:l.id,text:{text:n},tabId:r}):e.openChat({id:l.id,tabId:r}),o&&H(t=(0,b.mS)(),e,l.id,o,d,r)})),(0,b.aJ)("openTelegramLink",(async(t,e,a)=>{const{url:s,shouldIgnoreCache:d,tabId:o=(0,c.g0)()}=a,{openChatByPhoneNumber:l,checkChatInvite:h,openStickerSet:u,openChatWithDraft:I,joinVoiceChatByLink:p,openInvoice:m,checkChatlistInvite:f,openChatByUsername:C,openStoryViewerByUsername:V,checkGiftCode:y}=e;if((0,r.zq)(s)&&((0,n._)(s)||s.match(i.bnE)))return;const w=new URL(s.toLowerCase().startsWith("http")?s:`https://${s}`);if(i.G38.has(w.hostname)&&"/"===w.pathname)return void window.open(w.toString(),"_blank","noopener");const F=(i.G38.has(w.hostname)?"t.me":w.hostname).split(".");if(F.length>3)return;const A=w.pathname.replace(/^\/?s\//,""),S=3===F.length?`${F[0]}/${A}`:A,[x,M,T]=S.split("/").filter(Boolean).map((t=>decodeURI(t))),P=Object.fromEntries(w.searchParams);let U;"joinchat"===x&&(U=M);const J="s"===M&&(Number(T)||void 0);if(x.match(/^\+([0-9]+)(\?|$)/))return void l({phoneNumber:x.substr(1,x.length-1),startAttach:P.startattach,attach:P.attach,text:P.text,tabId:o});if(J)return void V({username:x,storyId:J,tabId:o});if((x.startsWith(" ")||x.startsWith("+"))&&(U=x.substr(1,x.length-1)),U)return void h({hash:U,tabId:o});if("addstickers"===x||"addemoji"===x)return void u({stickerSetInfo:{shortName:M},shouldIgnoreCache:d,tabId:o});if("share"===x)return void I({text:(0,n.E)(P.url,P.text),tabId:o});if("addlist"===x)return void f({slug:M,tabId:o});if("giftcode"===x)return void y({slug:M,tabId:o});const k=M||void 0,B=T?Number(T):void 0,E=P.comment?Number(P.comment):void 0,H=await async function(t,e,a){if(!e||!a)return!1;t=(0,b.mS)();const s=await R(t,e);t=(0,b.mS)();const d=s&&(0,v.mBe)(t,s.id),i=d&&await(0,g.px)("fetchBotApp",{bot:d,appName:a});return Boolean(i)}(t,x,M),L=x&&!M||Number.isInteger(Number(M))||H;P.hasOwnProperty("voicechat")||P.hasOwnProperty("livestream")?p({username:x,inviteHash:P.voicechat||P.livestream,tabId:o}):x.startsWith("$")?m({type:"slug",slug:x.substring(1),tabId:o}):"invoice"===x?m({type:"slug",slug:M,tabId:o}):L?C({username:x,messageId:B||Number(k),threadId:B?Number(k):void 0,commentId:E,startParam:P.start,startAttach:P.startattach,attach:P.attach,startApp:P.startapp,mode:P.mode,originalParts:[x,M,T],tabId:o}):e.openUrl({url:s,shouldSkipModal:!0,tabId:o,ignoreDeepLinks:!0})})),(0,b.aJ)("processBoostParameters",(async(t,e,a)=>{const{usernameOrId:s,isPrivate:d,tabId:i=(0,c.g0)()}=a;let o;if(d){if(o=(0,v.hds)(t,s),!o)return void e.showNotification({message:{key:"PrivateChannelInaccessible"},tabId:i})}else if(o=await R(t,s),!o)return void e.showNotification({message:{key:"NoUsernameFound"},tabId:i});(0,f.WX)(o)||(0,f.Vs)(o)?e.openBoostModal({chatId:o.id,tabId:i}):e.openChat({id:o.id,tabId:i})})),(0,b.aJ)("acceptChatInvite",(async(t,e,a)=>{const{hash:s,tabId:d=(0,c.g0)()}=a,i=await(0,g.px)("importChatInvite",{hash:s});i&&e.openChat({id:i.id,tabId:d})})),(0,b.aJ)("openChatByUsername",(async(t,e,a)=>{const{username:s,messageId:d,commentId:o,startParam:n,startAttach:r,attach:l,threadId:h,originalParts:u,startApp:I,mode:p,text:g,onChatChanged:f,choose:C,ref:V,timestamp:y,tabId:w=(0,c.g0)()}=a,F=(0,v.meB)(t,w),A=u?.[1],S=A&&!Number(A)&&!u?.[2];if(!o){if(void 0===r&&d&&!n&&!V&&F?.usernames?.some((t=>t.username===s)))return void e.focusMessage({chatId:F.id,threadId:h,messageId:d,timestamp:y,tabId:w});if(void 0!==r&&C)return void e.processAttachBotParameters({username:s,filter:C,startParam:r||I,tabId:w});if(void 0!==I&&!A){const a=(0,m.A)(),d=await R(t,s);t=(0,b.mS)();const i=d&&(0,v.mBe)(t,d.id);if(!d||!F||!i?.hasMainMiniApp)return;return void e.requestMainWebView({botId:d.id,peerId:F.id,theme:a,startParam:I,mode:p,tabId:w})}if(!S)return await async function(t,e,a,...[s=(0,c.g0)()]){const{username:d,threadId:o,channelPostId:n,startParam:r,ref:l,startAttach:h,attach:u,text:I,timestamp:p}=a,m=(0,v.meB)(t,s);if(void 0!==h&&!u){const a=await B(t,e,d,s);if(!a)return;return void e.callAttachBot({bot:a,chatId:m?.id||a.id,startParam:h,tabId:s})}const g=m?.usernames?.some((t=>t.username===d));g||e.openChat({id:i.Xab,tabId:s});const f=t.appConfig?.starRefStartPrefixes;let b=l;if(r&&f?.length){const t=f.find((t=>r.startsWith(t)));t&&(b=r.slice(t.length))}const C=await R(t,d,b);C?E(t,e,C,{isCurrentChat:g,threadId:o,messageId:n,startParam:r,referrer:b,startAttach:h,attach:u,text:I,timestamp:p},s):g||(e.openPreviousChat({tabId:s}),e.showNotification({message:"User does not exist",tabId:s}))}(t,e,{username:s,threadId:h,channelPostId:d,startParam:n,ref:V,startAttach:r,attach:l,text:g,timestamp:y},w),void(f&&e[f.action](f.payload))}const x=(0,v.qn$)(t,s);if(o&&d&&x)return e.openThread({isComments:!0,originChannelId:x.id,originMessageId:d,tabId:w,focusMessageId:o}),void(y&&e.openMediaFromTimestamp({chatId:x.id,messageId:o,timestamp:y,tabId:w}));S||e.openChat({id:i.Xab,tabId:w});const M=await R(t,s);if(M)if(S&&M){const t=(0,m.A)();e.requestAppWebView({appName:A,botId:M.id,tabId:w,startApp:I,mode:p,theme:t})}else d&&(e.openThread({isComments:!0,originChannelId:M.id,originMessageId:d,tabId:w,focusMessageId:o}),y&&e.openMediaFromTimestamp({chatId:M.id,messageId:o||d,timestamp:y,tabId:w}),f&&e[f.action](f.payload))})),(0,b.aJ)("openPrivateChannel",((t,e,a)=>{const{id:s,commentId:d,messageId:i,threadId:o,timestamp:n,tabId:r=(0,c.g0)()}=a,l=(0,v.hds)(t,s);l?d||i||o?(n&&e.openMediaFromTimestamp({chatId:s,messageId:d||i,timestamp:n,tabId:r}),d&&i?e.openThread({isComments:!0,originChannelId:s,originMessageId:i,tabId:r,focusMessageId:d}):E(t,e,l,{messageId:i,threadId:o,timestamp:n},r)):e.openChat({id:s,tabId:r}):e.showNotification({message:{key:"PrivateChannelInaccessible"},tabId:r})})),(0,b.aJ)("togglePreHistoryHidden",(async(t,e,a)=>{const{chatId:s,isEnabled:d,tabId:i=(0,c.g0)()}=a,o=await L(t,e,s,i);o&&(t=(0,b.mS)(),t=(0,C.ltr)(t,o.id,{isPreHistoryHidden:d}),(0,b.UF)(t),(0,g.px)("togglePreHistoryHidden",{chat:o,isEnabled:d}))})),(0,b.aJ)("updateChatDefaultBannedRights",((t,e,a)=>{const{chatId:s,bannedRights:d}=a,i=(0,v.hds)(t,s);i&&(0,g.px)("updateChatDefaultBannedRights",{chat:i,bannedRights:d})})),(0,b.aJ)("updateChatMemberBannedRights",(async(t,e,a)=>{const{chatId:s,userId:d,bannedRights:i,tabId:o=(0,c.g0)()}=a,n=(0,v.mBe)(t,d);if(!n)return;const r=await L(t,e,s,o);if(!r)return;await(0,g.px)("updateChatMemberBannedRights",{chat:r,user:n,bannedRights:i}),t=(0,b.mS)();const l=(0,v.AWZ)(t,r.id);if(!l)return;const{members:h,kickedMembers:u}=l,I=Boolean(i.viewMessages),p=!Object.keys(i).length;t=(0,C.ltr)(t,r.id,{...h&&I&&{members:h.filter((t=>t.userId!==d))},...h&&!I&&{members:h.map((t=>t.userId===d?{...t,bannedRights:i}:t))},...p&&u&&{kickedMembers:u.filter((t=>t.userId!==d))}}),(0,b.UF)(t)})),(0,b.aJ)("updateChatAdmin",(async(t,e,a)=>{if((0,v.trm)(t))return;const{chatId:s,userId:d,adminRights:i,customTitle:o,tabId:n=(0,c.g0)()}=a,r=(0,v.mBe)(t,d);if(!r)return;const l=await L(t,e,s,n);if(!l)return;await(0,g.px)("updateChatAdmin",{chat:l,user:r,adminRights:i,customTitle:o});const h=await(0,g.px)("fetchFullChat",l);if(!h?.fullInfo)return;const{adminMembersById:u}=h.fullInfo,I=!Object.keys(i).length;let p;if(u)if(I){const{[d]:t,...e}=u;p=e}else p={...u,[d]:{...u[d],adminRights:i,customTitle:o}};p&&(t=(0,b.mS)(),t=(0,C.ltr)(t,l.id,{adminMembersById:p}),(0,b.UF)(t))})),(0,b.aJ)("updateChat",(async(t,e,a)=>{const{chatId:s,title:i,about:o,photo:n,tabId:r=(0,c.g0)()}=a,l=(0,v.hds)(t,s),h=(0,v.AWZ)(t,s);l&&(t=(0,b.mS)(),t=(0,C.G42)(t,d.TD.InProgress,r),(0,b.UF)(t),await Promise.all([l.title!==i?(0,g.px)("updateChatTitle",l,i):void 0,h?.about!==o?(0,g.px)("updateChatAbout",l,o):void 0,n?(0,g.px)("editChatPhoto",{chatId:s,accessHash:l.accessHash,photo:n}):void 0]),t=(0,b.mS)(),t=(0,C.G42)(t,d.TD.Complete,r),(0,b.UF)(t),n&&e.loadFullChat({chatId:s,withPhotos:!0}))})),(0,b.aJ)("updateChatPhoto",(async(t,e,a)=>{const{photo:s,chatId:d}=a,i=(0,v.hds)(t,d);i&&(await(0,g.px)("editChatPhoto",{chatId:d,accessHash:i.accessHash,photo:s}),e.loadFullChat({chatId:d,withPhotos:!0}))})),(0,b.aJ)("deleteChatPhoto",(async(t,e,a)=>{const{photo:s,chatId:d}=a,i=(0,v.hds)(t,d);if(!i)return;let o;o=s.id===i.avatarPhotoId?await(0,g.px)("editChatPhoto",{chatId:d,accessHash:i.accessHash}):await(0,g.px)("deleteProfilePhotos",[s]),o&&(t=(0,b.mS)(),t=(0,C.sol)(t,d,s.id),(0,b.UF)(t),e.loadFullChat({chatId:d,withPhotos:!0}))})),(0,b.aJ)("toggleSignatures",((t,e,a)=>{const{chatId:s,areProfilesEnabled:d,areSignaturesEnabled:i}=a,o=(0,v.hds)(t,s);o&&(0,g.px)("toggleSignatures",{chat:o,areProfilesEnabled:d,areSignaturesEnabled:i})})),(0,b.aJ)("loadGroupsForDiscussion",(async t=>{const e=await(0,g.px)("fetchGroupsForDiscussion");if(!e)return;const a=e.reduce(((t,e)=>(e&&!e.isForum&&(t[e.id]=e),t)),{});t=(0,b.mS)(),t={...t,chats:{...t.chats,forDiscussionIds:Object.keys(a)}},(0,b.UF)(t)})),(0,b.aJ)("linkDiscussionGroup",(async(t,e,a)=>{if((0,v.trm)(t))return;const{channelId:s,chatId:d,tabId:i=(0,c.g0)()}=a||{},o=(0,v.hds)(t,s);if(!o)return;const n=await L(t,e,d,i);if(!n)return;let r=(0,v.AWZ)(t,n.id);if(!r){const t=await(0,g.px)("fetchFullChat",n);if(!t)return;r=t.fullInfo}r.isPreHistoryHidden&&(t=(0,b.mS)(),t=(0,C.ltr)(t,n.id,{isPreHistoryHidden:!1}),(0,b.UF)(t),await(0,g.px)("togglePreHistoryHidden",{chat:n,isEnabled:!1})),(0,g.px)("setDiscussionGroup",{channel:o,chat:n})})),(0,b.aJ)("unlinkDiscussionGroup",(async(t,e,a)=>{const{channelId:s}=a,d=(0,v.hds)(t,s);if(!d)return;const i=(0,v.AWZ)(t,s);let o;i?.linkedChatId&&(o=(0,v.hds)(t,i.linkedChatId)),await(0,g.px)("setDiscussionGroup",{channel:d}),o&&k(t=(0,b.mS)(),e,o)})),(0,b.aJ)("setActiveChatFolder",((t,e,a)=>{const{activeChatFolder:s,tabId:d=(0,c.g0)()}=a;if(!(s+1>(0,F.d)(t,"dialogFilters")))return(0,y.w)(t,{activeChatFolder:s},d);e.openLimitReachedModal({limit:"dialogFilters",tabId:d})})),(0,b.aJ)("resetOpenChatWithDraft",((t,e,a)=>{const{tabId:s=(0,c.g0)()}=a||{};return(0,y.w)(t,{requestedDraft:void 0},s)})),(0,b.aJ)("loadMoreMembers",(async(t,e,a)=>{if((0,v.trm)(t))return;const{tabId:s=(0,c.g0)()}=a||{},{chatId:d}=(0,v.Xf0)(t,s)||{},i=d?(0,v.hds)(t,d):void 0;if(!i||(0,f.yn)(i))return;const o=(0,v.AWZ)(t,i.id)?.members?.length;if(void 0!==o&&void 0!==i.membersCount&&o>=i.membersCount)return;const n=await(0,g.px)("fetchMembers",{chat:i,offset:o});if(!n)return;const{members:r,userStatusesById:l}=n;r&&r.length&&(t=(0,b.mS)(),t=(0,C.d2X)(t,l),t=(0,C.t_k)(t,i,r),(0,b.UF)(t))})),(0,b.aJ)("addChatMembers",(async(t,e,a)=>{const{chatId:s,memberIds:i,tabId:o=(0,c.g0)()}=a,n=(0,v.hds)(t,s),r=i.map((e=>(0,v.mBe)(t,e))).filter(Boolean);if(!n||!r.length)return;e.setNewChatMembersDialogState({newChatMembersProgress:d.D7.Loading,tabId:o});const l=await(0,g.px)("addChatMembers",n,r);l&&(t=(0,b.mS)(),t=(0,C.hQe)(t,s,l,o),(0,b.UF)(t)),e.setNewChatMembersDialogState({newChatMembersProgress:d.D7.Closed,tabId:o}),k(t=(0,b.mS)(),e,n)})),(0,b.aJ)("deleteChatMember",(async(t,e,a)=>{const{chatId:s,userId:d}=a,i=(0,v.hds)(t,s),o=(0,v.mBe)(t,d);i&&o&&(await(0,g.px)("deleteChatMember",i,o),k(t=(0,b.mS)(),e,i))})),(0,b.aJ)("toggleIsProtected",((t,e,a)=>{const{chatId:s,isProtected:d}=a,i=(0,v.hds)(t,s);i&&(0,g.px)("toggleIsProtected",{chat:i,isProtected:d})})),(0,b.aJ)("setChatEnabledReactions",(async(t,e,a)=>{const{chatId:s,enabledReactions:d,reactionsLimit:i}=a,o=(0,v.hds)(t,s);o&&(await(0,g.px)("setChatEnabledReactions",{chat:o,enabledReactions:d,reactionsLimit:i}),k(t=(0,b.mS)(),e,o))})),(0,b.aJ)("fetchChat",((t,e,a)=>{const{chatId:s}=a;if(!(0,v.hds)(t,s))if((0,v.nZ4)(t,s))(0,g.px)("fetchChat",{type:"self"});else{const e=(0,v.mBe)(t,s);e&&(0,g.px)("fetchChat",{type:"user",user:e})}})),(0,b.aJ)("toggleJoinToSend",(async(t,e,a)=>{const{chatId:s,isEnabled:d}=a,i=(0,v.hds)(t,s);i&&((0,f.Vs)(i)||(0,f.WX)(i))&&await(0,g.px)("toggleJoinToSend",i,d)})),(0,b.aJ)("toggleJoinRequest",(async(t,e,a)=>{const{chatId:s,isEnabled:d}=a,i=(0,v.hds)(t,s);i&&((0,f.Vs)(i)||(0,f.WX)(i))&&await(0,g.px)("toggleJoinRequest",i,d)})),(0,b.aJ)("openForumPanel",((t,e,a)=>{const{chatId:s,tabId:d=(0,c.g0)()}=a;return e.toggleStoryRibbon({isShown:!1,tabId:d}),e.toggleStoryRibbon({isShown:!1,isArchived:!0,tabId:d}),(0,y.w)(t,{forumPanelChatId:s},d)})),(0,b.aJ)("closeForumPanel",((t,e,a)=>{const{tabId:s=(0,c.g0)()}=a||{};return(0,y.w)(t,{forumPanelChatId:void 0},s)})),(0,b.aJ)("processAttachBotParameters",(async(t,e,a)=>{const{username:s,filter:d,startParam:i,tabId:o=(0,c.g0)()}=a,n=await B(t,e,s,o);if(!n)return;if(!Boolean(d))return void e.callAttachBot({isFromSideMenu:!0,bot:n,startParam:i,tabId:o});t=(0,b.mS)();const{attachMenu:{bots:r}}=t;if(!r[n.id])return t=(0,y.w)(t,{requestedAttachBotInstall:{bot:n,onConfirm:{action:"requestAttachBotInChat",payload:{bot:n,filter:d,startParam:i}}}},o),void(0,b.UF)(t);e.requestAttachBotInChat({bot:n,filter:d,startParam:i,tabId:o})})),(0,b.aJ)("loadTopics",(async(t,e,a)=>{if((0,v.trm)(t))return;const{chatId:s,force:d}=a;if((0,v.trm)(t))return;const o=(0,v.hds)(t,s);if(!o)return;const n=(0,v.xyP)(t,s);if(!d&&n?.listedTopicIds&&n.listedTopicIds.length===n.totalCount)return;const r=d?void 0:n?.listedTopicIds?.reduce(((e,a)=>{const d=(0,v.S0q)(t,s,a),i=(0,v.S0q)(t,s,e);return d&&(!i||d.lastMessageId<i.lastMessageId)?a:e})),{id:c,date:l,lastMessageId:h}=r&&(0,v.S0q)(t,s,r)||{},u=await(0,g.px)("fetchTopics",{chat:o,offsetTopicId:c,offsetId:h,offsetDate:l,limit:c?i.iIc:i.qj6});u&&(t=(0,b.mS)(),t=(0,C.KcS)(t,u.messages),t=(0,C.mIA)(t,s,u.count,u.topics),t=(0,C.Y4o)(t,s,u.topics.map((t=>t.id))),Object.entries(u.draftsById||{}).forEach((([e,a])=>{t=(0,C.eww)(t,s,Number(e),"draft",a)})),Object.entries(u.readInboxMessageIdByTopicId||{}).forEach((([e,a])=>{t=(0,C.eAk)(t,s,Number(e),{lastReadInboxMessageId:a})})),(0,b.UF)(t))})),(0,b.aJ)("loadTopicById",(async(t,e,a)=>{const{chatId:s,topicId:d}=a,i=(0,v.hds)(t,s);if(!i)return;const o=await(0,g.px)("fetchTopicById",{chat:i,topicId:d});if(o)t=(0,b.mS)(),t=(0,C.KcS)(t,o.messages),t=(0,C.TwA)(t,s,d,o.topic),(0,b.UF)(t);else if("tabId"in a&&a.shouldCloseChatOnError){const{tabId:t=(0,c.g0)()}=a;e.openChat({id:void 0,tabId:t})}})),(0,b.aJ)("toggleForum",(async(t,e,a)=>{const{chatId:s,isEnabled:d,tabId:i=(0,c.g0)()}=a,o=await L(t,e,s,i);if(!o)return;let n;try{n=await(0,g.px)("toggleForum",{chat:o,isEnabled:d})}catch(t){"FLOOD"===t.message?e.showNotification({message:I.yE("FloodWait"),tabId:i}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:i})}n&&(t=(0,b.mS)(),t=(0,C.wix)(t,o.id,{isForum:d}),(0,b.UF)(t),d?e.openForumPanel({chatId:o.id,tabId:i}):e.closeForumPanel({tabId:i}))})),(0,b.aJ)("toggleParticipantsHidden",(async(t,e,a)=>{const{chatId:s,isEnabled:d}=a,i=(0,v.hds)(t,s);if(!i)return;const o=(0,v.AWZ)(t,i.id)?.areParticipantsHidden;t=(0,C.ltr)(t,s,{areParticipantsHidden:d}),(0,b.UF)(t),await(0,g.px)("toggleParticipantsHidden",{chat:i,isEnabled:d})||void 0===o||(t=(0,b.mS)(),t=(0,C.ltr)(t,s,{areParticipantsHidden:o}),(0,b.UF)(t))})),(0,b.aJ)("createTopic",(async(t,e,a)=>{const{chatId:s,title:d,iconColor:i,iconEmojiId:o,tabId:n=(0,c.g0)()}=a,r=(0,v.hds)(t,s);if(!r)return;(0,v.nTw)(t,n).createTopicPanel&&(t=(0,y.w)(t,{createTopicPanel:{chatId:s,isLoading:!0}},n),(0,b.UF)(t));const l=await(0,g.px)("createTopic",{chat:r,title:d,iconColor:i,iconEmojiId:o});l&&e.openThread({chatId:s,threadId:l,shouldReplaceHistory:!0,tabId:n}),e.closeCreateTopicPanel({tabId:n})})),(0,b.aJ)("deleteTopic",(async(t,e,a)=>{const{chatId:s,topicId:d}=a,i=(0,v.hds)(t,s);i&&(await(0,g.px)("deleteTopic",{chat:i,topicId:d}),t=(0,b.mS)(),t=(0,C.do9)(t,s,d),(0,b.UF)(t))})),(0,b.aJ)("editTopic",(async(t,e,a)=>{const{chatId:s,topicId:d,tabId:i=(0,c.g0)(),...o}=a,n=(0,v.hds)(t,s),r=(0,v.S0q)(t,s,d);n&&r&&((0,v.nTw)(t,i).editTopicPanel&&(t=(0,y.w)(t,{editTopicPanel:{chatId:s,topicId:d,isLoading:!0}},i),(0,b.UF)(t)),await(0,g.px)("editTopic",{chat:n,topicId:d,...o})&&(t=(0,b.mS)(),t=(0,C.TwA)(t,s,d,o),(0,b.UF)(t),e.closeEditTopicPanel({tabId:i})))})),(0,b.aJ)("toggleTopicPinned",((t,e,a)=>{const{chatId:s,topicId:d,isPinned:i,tabId:o=(0,c.g0)()}=a,{topicsPinnedLimit:n}=t.appConfig||{},r=(0,v.hds)(t,s),l=(0,v.pSx)(t,s);r&&l&&n&&(i&&Object.values(l).filter((t=>t.isPinned)).length>=n?e.showNotification({message:I.yE("LimitReachedPinnedTopics",n,"i"),tabId:o}):(0,g.px)("togglePinnedTopic",{chat:r,topicId:d,isPinned:i}))})),(0,b.aJ)("checkChatlistInvite",(async(t,e,a)=>{const{slug:s,tabId:d=(0,c.g0)()}=a,i=await(0,g.px)("checkChatlistInvite",{slug:s});i?(t=(0,b.mS)(),t=(0,y.w)(t,{chatlistModal:{invite:i.invite}},d),(0,b.UF)(t)):e.showNotification({message:I.yE("lng_group_invite_bad_link"),tabId:d})})),(0,b.aJ)("joinChatlistInvite",(async(t,e,a)=>{const{invite:s,peerIds:d,tabId:i=(0,c.g0)()}=a,o=d.map((e=>(0,v.hds)(t,e))).filter(Boolean),n=o.filter((t=>t.isNotJoined)).length,r="folderId"in s?(0,v.$aQ)(t,s.folderId):void 0,l="title"in s?s.title:r?.title;try{if(!await(0,g.px)("joinChatlistInvite",{slug:s.slug,peers:o}))return;if(r)return void e.showNotification({title:{key:"FolderLinkNotificationUpdatedTitle",variables:{title:l.text}},message:{key:"FolderLinkNotificationUpdatedSubtitle",variables:{count:n},options:{pluralValue:n}},tabId:i});e.showNotification({title:{key:"FolderLinkNotificationAddedTitle",variables:{title:l.text}},message:{key:"FolderLinkNotificationAddedSubtitle",variables:{count:n},options:{pluralValue:n}},tabId:i})}catch(t){"CHATLISTS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"chatlistJoined",tabId:i}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:i})}})),(0,b.aJ)("leaveChatlist",(async(t,e,a)=>{const{folderId:s,peerIds:d,tabId:i=(0,c.g0)()}=a,o=(0,v.$aQ)(t,s),n=d?.map((e=>(0,v.hds)(t,e))).filter(Boolean)||[];await(0,g.px)("leaveChatlist",{folderId:s,peers:n})&&o&&e.showNotification({title:{key:"FolderLinkNotificationDeletedTitle",variables:{title:o.title.text}},message:{key:"FolderLinkNotificationDeletedSubtitle",variables:{count:n.length},options:{pluralValue:n.length}},tabId:i})})),(0,b.aJ)("loadChatlistInvites",(async(t,e,a)=>{const{folderId:s}=a,d=await(0,g.px)("fetchChatlistInvites",{folderId:s});d&&(t=(0,b.mS)(),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:d.invites}}},(0,b.UF)(t))})),(0,b.aJ)("createChatlistInvite",(async(t,e,a)=>{const{folderId:s,tabId:i=(0,c.g0)()}=a,o=(0,v.$aQ)(t,s);if(!o)return;let n;t=(0,y.w)(t,{shareFolderScreen:{...(0,v.nTw)(t,i).shareFolderScreen,isLoading:!0}},i),(0,b.UF)(t);try{n=await(0,g.px)("createChalistInvite",{folderId:s,peers:o.includedChatIds.concat(o.pinnedChatIds||[]).map((e=>(0,v.hds)(t,e)||(0,v.mBe)(t,e))).filter(Boolean)})}catch(t){x.has(t.message)?(e.openLimitReachedModal({limit:"chatlistInvites",tabId:i}),e.requestNextSettingsScreen({screen:d.VS.Folders,tabId:i})):e.showDialog({data:{...t,hasErrorKey:!0},tabId:i})}if(!n||!n.invite)return;const{shareFolderScreen:r}=(0,v.nTw)(t,i);r&&(t=(0,b.mS)(),t={...t,chatFolders:{...t.chatFolders,byId:{...t.chatFolders.byId,[s]:{...t.chatFolders.byId[s],...n.filter}},invites:{...t.chatFolders.invites,[s]:[...t.chatFolders.invites[s]||[],n.invite]}}},t=(0,y.w)(t,{shareFolderScreen:{...r,url:n.invite.url,isLoading:!1}},i),(0,b.UF)(t))})),(0,b.aJ)("editChatlistInvite",(async(t,e,a)=>{const{folderId:s,peerIds:d,url:i,tabId:o=(0,c.g0)()}=a,n=i.split("/").pop();if(!n)return;const r=d.map((e=>(0,v.hds)(t,e)||(0,v.mBe)(t,e))).filter(Boolean);t=(0,y.w)(t,{shareFolderScreen:{...(0,v.nTw)(t,o).shareFolderScreen,isLoading:!0}},o),(0,b.UF)(t);try{const e=await(0,g.px)("editChatlistInvite",{folderId:s,slug:n,peers:r});if(!e)return;t=(0,b.mS)(),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:t.chatFolders.invites[s]?.map((t=>t.url===i?e:t))}}},(0,b.UF)(t)}catch(t){e.showDialog({data:{...t,hasErrorKey:!0},tabId:o})}finally{t=(0,b.mS)(),t=(0,y.w)(t,{shareFolderScreen:{...(0,v.nTw)(t,o).shareFolderScreen,isLoading:!1}},o),(0,b.UF)(t)}})),(0,b.aJ)("deleteChatlistInvite",(async(t,e,a)=>{const{folderId:s,url:d}=a,i=d.split("/").pop();i&&await(0,g.px)("deleteChatlistInvite",{folderId:s,slug:i})&&(t=(0,b.mS)(),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:t.chatFolders.invites[s]?.filter((t=>t.url!==d))}}},(0,b.UF)(t))})),(0,b.aJ)("openDeleteChatFolderModal",(async(t,e,a)=>{const{folderId:s,isConfirmedForChatlist:d,tabId:i=(0,c.g0)()}=a,o=(0,v.$aQ)(t,s);if(o){if(o.isChatList&&(!o.hasMyInvites||d)){const e=(0,l.YA)(s),a=await(0,g.px)("fetchLeaveChatlistSuggestions",{folderId:s});return t=(0,b.mS)(),t=(0,y.w)(t,{chatlistModal:{removal:{folderId:s,suggestedPeerIds:(0,h.Am)([...a||[],...e||[]])}}},i),void(0,b.UF)(t)}t=(0,y.w)(t,{deleteFolderDialogModal:s},i),(0,b.UF)(t)}})),(0,b.aJ)("updateChatDetectedLanguage",((t,e,a)=>{const{chatId:s,detectedLanguage:d}=a;return t=(0,b.mS)(),(0,C.wix)(t,s,{detectedLanguage:d},void 0,!0)})),(0,b.aJ)("togglePeerTranslations",(async(t,e,a)=>{const{chatId:s,isEnabled:d}=a,i=(0,v.hds)(t,s);i&&void 0!==await(0,g.px)("togglePeerTranslations",{chat:i,isEnabled:d})&&(t=(0,b.mS)(),t=(0,C.zTz)(t,s,{isTranslationDisabled:!d||void 0}),(0,b.UF)(t))})),(0,b.aJ)("setViewForumAsMessages",((t,e,a)=>{const{chatId:s,isEnabled:d}=a,i=(0,v.hds)(t,s);i?.isForum&&i.isForumAsMessages!==d&&(t=(0,C.wix)(t,s,{isForumAsMessages:d||void 0}),(0,b.UF)(t),(0,g.px)("setViewForumAsMessages",{chat:i,isEnabled:d}))})),(0,b.aJ)("loadChannelRecommendations",(async(t,e,a)=>{if((0,v.trm)(t))return;const{chatId:s}=a,d=s?(0,v.hds)(t,s):void 0;if(s&&!d)return;if(!s&&(0,v.dg4)(t,i.rBM))return;const o=await(0,g.px)("fetchChannelRecommendations",{chat:d});if(!o)return;const{similarChannels:n,count:r}=o,c=(0,h.dU)(n,"id");t=(0,b.mS)(),t=(0,C.czZ)(t,s||i.rBM,Object.keys(c),r),(0,b.UF)(t)})),(0,b.aJ)("loadBotRecommendations",(async(t,e,a)=>{if((0,v.trm)(t))return;const{userId:s}=a,d=(0,v.hds)(t,s);if(!d)return;const i=await(0,g.px)("fetchBotsRecommendations",{user:d});if(!i)return;const{similarBots:o,count:n}=i,r=(0,h.dU)(o,"id");t=(0,b.mS)(),t=(0,C.g18)(t,r),t=(0,C.tNY)(t,s,Object.keys(r),n),(0,b.UF)(t)})),(0,b.aJ)("toggleChannelRecommendations",((t,e,a)=>{const{chatId:s}=a;(0,v.hds)(t,s)&&(t=(0,C.Cbr)(t,s),(0,b.UF)(t))})),(0,b.aJ)("updatePaidMessagesPrice",(async(t,e,a)=>{const{chatId:s,paidMessagesStars:i,tabId:o=(0,c.g0)()}=a,n=s?(0,v.hds)(t,s):void 0;n&&(t=(0,C.G42)(t,d.TD.InProgress,o),(0,b.UF)(t),await(0,g.px)("updatePaidMessagesPrice",{chat:n,paidMessagesStars:i})&&(t=(0,b.mS)(),t=(0,C.G42)(t,d.TD.Complete,o),t=(0,C.wix)(t,s,{paidMessagesStars:i}),(0,b.UF)(t)))})),(0,b.aJ)("resolveBusinessChatLink",(async(t,e,a)=>{const{slug:s,tabId:d=(0,c.g0)()}=a,i=await(0,g.px)("resolveBusinessChatLink",{slug:s});if(!i)return void e.showNotification({message:I.yE("BusinessLink.ErrorExpired"),tabId:d});const{chatLink:o}=i;e.openChatWithDraft({chatId:o.chatId,text:o.text,tabId:d})})),(0,b.aJ)("requestCollectibleInfo",(async(t,e,a)=>{const{type:s,collectible:d,peerId:i,tabId:n=(0,c.g0)()}=a;let r;if("phone"===s&&(r={phone:d}),"username"===s&&(r={username:d}),!r)return;const l=await(0,g.px)("fetchCollectionInfo",r);l?(t=(0,b.mS)(),t=(0,y.w)(t,{collectibleInfoModal:{...l,type:s,collectible:d,peerId:i}},n),(0,b.UF)(t)):(0,o.eM)(d)}))},80840:(t,e,a)=>{a.d(e,{R6:()=>c,c5:()=>l,h9:()=>n,um:()=>r});var s=a(87894),d=a(29807),i=a(71331),o=a(16350);function n(t,e,a,d,i){const o=Object.values({...t.groupCalls.byId[e]?.participants,...a.participants}).filter((({isLeft:t})=>!t)).reduce(((t,e)=>(t[e.id]=e,t)),{});return{...t,groupCalls:{...t.groupCalls,byId:{...t.groupCalls.byId,[e]:{...t.groupCalls.byId[e],...(0,s.cJ)(a,["participantsCount"]),...d&&{participantsCount:t.groupCalls.byId[e].participantsCount+d},...void 0!==i&&{participantsCount:i},participants:o}}}}}function r(t,e){const a=(0,i.Ip)(t,e);return a&&a.chatId&&(0,d.hds)(t,a.chatId)&&(t=(0,o.lt)(t,a.chatId,{groupCallId:void 0})),{...t,groupCalls:{...t.groupCalls,byId:{...(0,s.cJ)(t.groupCalls.byId,[e.toString()])}}}}function c(t,e,a){return t.groupCalls.activeGroupCallId?n(t,t.groupCalls.activeGroupCallId,e,void 0,a):t}function l(t,e,a,s,d=!1){const o=(0,i.Ip)(t,e);return o?n(t,e,{participants:{...o.participants,[a]:{...o.participants[a],...s}}},s.isLeft?d?0:-1:o.participants[a]||d?0:1):t}}}]);
//# sourceMappingURL=2859.e8d547bfb015cb36dbec.js.map