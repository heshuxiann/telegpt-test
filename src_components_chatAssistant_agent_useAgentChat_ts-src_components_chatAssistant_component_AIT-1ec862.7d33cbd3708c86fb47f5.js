"use strict";
(self["webpackChunkTelyAI"] = self["webpackChunkTelyAI"] || []).push([["src_components_chatAssistant_agent_useAgentChat_ts-src_components_chatAssistant_component_AIT-1ec862"],{

/***/ "./src/assets/map-pin.svg"
/*!********************************!*\
  !*** ./src/assets/map-pin.svg ***!
  \********************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "map-pin.899635f6fe777c28998a.svg";

/***/ },

/***/ "./src/assets/premium/GiftBlueRound.svg"
/*!**********************************************!*\
  !*** ./src/assets/premium/GiftBlueRound.svg ***!
  \**********************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "GiftBlueRound.90e369f0f350cdfb20d4.svg";

/***/ },

/***/ "./src/assets/premium/GiftGreenRound.svg"
/*!***********************************************!*\
  !*** ./src/assets/premium/GiftGreenRound.svg ***!
  \***********************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "GiftGreenRound.f66f0acd5d3dda1c7baf.svg";

/***/ },

/***/ "./src/assets/premium/GiftRedRound.svg"
/*!*********************************************!*\
  !*** ./src/assets/premium/GiftRedRound.svg ***!
  \*********************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "GiftRedRound.a86b78b0b99e07f69a70.svg";

/***/ },

/***/ "./src/assets/premium/GiftStar.svg"
/*!*****************************************!*\
  !*** ./src/assets/premium/GiftStar.svg ***!
  \*****************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "GiftStar.59a3e3598fdbab13b181.svg";

/***/ },

/***/ "./src/components/calls/group/GroupCallTopPane.scss"
/*!**********************************************************!*\
  !*** ./src/components/calls/group/GroupCallTopPane.scss ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/calls/group/GroupCallTopPane.tsx"
/*!*********************************************************!*\
  !*** ./src/components/calls/group/GroupCallTopPane.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_calls__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors/calls */ "./src/global/selectors/calls.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _middle_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../middle/hooks/useHeaderPane */ "./src/components/middle/hooks/useHeaderPane.tsx");
/* harmony import */ var _common_AvatarList__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/AvatarList */ "./src/components/common/AvatarList.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _GroupCallTopPane_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./GroupCallTopPane.scss */ "./src/components/calls/group/GroupCallTopPane.scss");












const PREVIEW_AVATARS_COUNT = 3;
const GroupCallTopPane = ({
  chatId,
  isActive,
  className,
  groupCall,
  onPaneStateChange
}) => {
  const {
    requestMasterAndJoinGroupCall
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const handleJoinGroupCall = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    requestMasterAndJoinGroupCall({
      chatId
    });
  }, [requestMasterAndJoinGroupCall, chatId]);
  const participants = groupCall?.participants;
  const fetchedParticipants = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!participants) {
      return [];
    }

    // No need for expensive global updates on users and chats, so we avoid them
    const usersById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().users.byId;
    const chatsById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().chats.byId;
    return Object.values(participants).slice(0, PREVIEW_AVATARS_COUNT).map(({
      id
    }) => usersById[id] || chatsById[id]).filter(Boolean);
  }, [participants]);
  const renderingParticipantCount = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(groupCall?.participantsCount, true);
  const renderingFetchedParticipants = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(fetchedParticipants, true);
  const isRendering = Boolean(groupCall && isActive);
  const {
    ref,
    shouldRender
  } = (0,_middle_hooks_useHeaderPane__WEBPACK_IMPORTED_MODULE_7__["default"])({
    isOpen: isRendering,
    onStateChange: onPaneStateChange
  });
  if (!shouldRender) return undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('GroupCallTopPane', className),
    onClick: handleJoinGroupCall
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "title"
  }, lang('VoipGroupVoiceChat')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "participants"
  }, lang('Participants', renderingParticipantCount ?? 0, 'i'))), Boolean(renderingFetchedParticipants?.length) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AvatarList__WEBPACK_IMPORTED_MODULE_8__["default"], {
    size: "small",
    peers: renderingFetchedParticipants,
    className: "avatars"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
    round: true,
    className: "join"
  }, lang('VoipChatJoin')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId);
  const groupCall = (0,_global_selectors_calls__WEBPACK_IMPORTED_MODULE_3__.selectChatGroupCall)(global, chatId);
  const activeGroupCallId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global).isMasterTab ? global.groupCalls.activeGroupCallId : undefined;
  return {
    groupCall,
    isActive: activeGroupCallId !== groupCall?.id && Boolean(groupCall ? groupCall.participantsCount > 0 && groupCall.isLoaded : chat && chat.isCallNotEmpty && chat.isCallActive)
  };
})(GroupCallTopPane)));

/***/ },

/***/ "./src/components/chatAssistant/ErrorBoundary.tsx"
/*!********************************************************!*\
  !*** ./src/components/chatAssistant/ErrorBoundary.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* eslint-disable no-null/no-null */


class ErrorBoundary extends react__WEBPACK_IMPORTED_MODULE_0__.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasError: false
    };
  }
  static getDerivedStateFromError() {
    return {
      hasError: true
    };
  }
  componentDidCatch(error, errorInfo) {
    // eslint-disable-next-line no-console
    console.error('Error caught by ErrorBoundary:', error, errorInfo);
  }
  render() {
    const {
      hasError
    } = this.state;
    const {
      children
    } = this.props;
    if (hasError) {
      return null; // 直接跳过这个组件
    }
    return children;
  }
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ErrorBoundary);

/***/ },

/***/ "./src/components/chatAssistant/agent/stream-events.ts"
/*!*************************************************************!*\
  !*** ./src/components/chatAssistant/agent/stream-events.ts ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AgentPhase: () => (/* binding */ AgentPhase),
/* harmony export */   EventType: () => (/* binding */ EventType),
/* harmony export */   createCitationEvent: () => (/* binding */ createCitationEvent),
/* harmony export */   createDoneEvent: () => (/* binding */ createDoneEvent),
/* harmony export */   createErrorEvent: () => (/* binding */ createErrorEvent),
/* harmony export */   createEvent: () => (/* binding */ createEvent),
/* harmony export */   createPhaseChangeEvent: () => (/* binding */ createPhaseChangeEvent),
/* harmony export */   createTextEvent: () => (/* binding */ createTextEvent),
/* harmony export */   createToolEndEvent: () => (/* binding */ createToolEndEvent),
/* harmony export */   createToolStartEvent: () => (/* binding */ createToolStartEvent),
/* harmony export */   serializeEvent: () => (/* binding */ serializeEvent)
/* harmony export */ });
/**
 * Agent 流式响应事件定义
 *
 * 所有事件都遵循统一格式: { type, phase, data }
 */

// ==================== 阶段定义 ====================

let AgentPhase = /*#__PURE__*/function (AgentPhase) {
  AgentPhase["THINKING"] = "thinking";
  // 思考阶段：分析问题，决定工具调用
  AgentPhase["TOOL_CALLING"] = "tool_calling";
  // 工具调用阶段：执行工具获取数据
  AgentPhase["GENERATING"] = "generating";
  // 生成阶段：生成回答内容
  AgentPhase["COMPLETED"] = "completed";
  // 完成阶段：所有处理完成
  AgentPhase["ERROR"] = "error"; // 错误阶段：发生错误
  return AgentPhase;
}({});

// ==================== 事件类型定义 ====================

let EventType = /*#__PURE__*/function (EventType) {
  EventType["PHASE_CHANGE"] = "phase_change";
  // 阶段变更
  EventType["THINKING"] = "thinking";
  // 思考过程（可选）
  EventType["TOOL_START"] = "tool_start";
  // 工具调用开始
  EventType["TOOL_END"] = "tool_end";
  // 工具调用结束
  EventType["TEXT"] = "text";
  // 文本内容
  EventType["CITATION"] = "citation";
  // 引用信息
  EventType["STRUCTURED"] = "structured";
  // 结构化数据
  EventType["DONE"] = "done";
  // 完成
  EventType["ERROR"] = "error"; // 错误
  return EventType;
}({});

// ==================== 事件数据类型 ====================

// ==================== 配置选项 ====================

// ==================== 辅助函数 ====================

/**
 * 创建事件对象
 */
function createEvent(type, phase, data) {
  return {
    type,
    phase,
    data
  };
}

/**
 * 序列化事件为 JSON 字符串（一行）
 */
function serializeEvent(event) {
  return JSON.stringify(event) + '\n';
}

/**
 * 阶段变更事件辅助函数
 */
function createPhaseChangeEvent(phase, message) {
  return {
    type: EventType.PHASE_CHANGE,
    phase,
    data: {
      message
    }
  };
}

/**
 * 工具调用开始事件
 */
function createToolStartEvent(toolName, toolDescription, params) {
  return {
    type: EventType.TOOL_START,
    phase: AgentPhase.TOOL_CALLING,
    data: {
      toolName,
      toolDescription,
      params
    }
  };
}

/**
 * 工具调用结束事件
 */
function createToolEndEvent(toolName, success, summary, error) {
  return {
    type: EventType.TOOL_END,
    phase: AgentPhase.TOOL_CALLING,
    data: {
      toolName,
      success,
      summary,
      error
    }
  };
}

/**
 * 文本内容事件
 */
function createTextEvent(content) {
  return {
    type: EventType.TEXT,
    phase: AgentPhase.GENERATING,
    data: {
      content
    }
  };
}

/**
 * 引用信息事件
 */
function createCitationEvent(index, messageId, content, senderName, timestamp, chatId, senderId) {
  return {
    type: EventType.CITATION,
    phase: AgentPhase.GENERATING,
    data: {
      index,
      messageId,
      content,
      senderName,
      senderId,
      timestamp,
      chatId
    }
  };
}

/**
 * 完成事件
 */
function createDoneEvent(finishReason, stats) {
  return {
    type: EventType.DONE,
    phase: AgentPhase.COMPLETED,
    data: {
      finishReason,
      stats
    }
  };
}

/**
 * 错误事件
 */
function createErrorEvent(code, message, recoverable = false) {
  return {
    type: EventType.ERROR,
    phase: AgentPhase.ERROR,
    data: {
      code,
      message,
      recoverable
    }
  };
}

/***/ },

/***/ "./src/components/chatAssistant/agent/stream-parser.ts"
/*!*************************************************************!*\
  !*** ./src/components/chatAssistant/agent/stream-parser.ts ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AgentStreamParser: () => (/* binding */ AgentStreamParser)
/* harmony export */ });
/* harmony import */ var _stream_events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./stream-events */ "./src/components/chatAssistant/agent/stream-events.ts");
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
/* eslint-disable no-null/no-null */
/**
 * Agent 流式响应解析器
 * 处理服务端返回的事件流，按照 AGENT_STREAM_FORMAT.md 规范解析事件
 */


class AgentStreamParser {
  // 用于处理不完整的行

  constructor(callbacks) {
    _defineProperty(this, "currentPhase", null);
    _defineProperty(this, "fullText", '');
    _defineProperty(this, "citations", []);
    _defineProperty(this, "callbacks", {});
    _defineProperty(this, "buffer", '');
    if (callbacks) {
      this.callbacks = callbacks;
    }
  }

  /**
   * 注册事件回调
   */
  on(eventName, callback) {
    this.callbacks[eventName] = callback;
  }

  /**
   * 处理流式数据块
   */
  handleChunk(chunk) {
    this.buffer += chunk;
    const lines = this.buffer.split('\n');

    // 保留最后一行（可能不完整）
    this.buffer = lines.pop() || '';

    // 处理完整的行
    lines.forEach(line => this.handleLine(line));
  }

  /**
   * 处理单行事件
   */
  handleLine(line) {
    const trimmed = line.trim();
    if (!trimmed) return;
    try {
      // 处理 SSE 格式：移除 "data: " 前缀
      let jsonStr = trimmed;
      if (jsonStr.startsWith('data: ')) {
        jsonStr = jsonStr.slice(6); // 移除 "data: " 前缀（6个字符）
      }
      const event = JSON.parse(jsonStr);

      // 更新当前阶段
      if (event.phase !== this.currentPhase) {
        this.currentPhase = event.phase;
        this.callbacks.onPhaseChange?.(event.phase);
      }

      // 触发通用事件回调
      this.callbacks.onEvent?.(event);

      // 根据事件类型分发
      this.dispatchEvent(event);
    } catch (error) {
      // eslint-disable-next-line no-console
      console.error('[AgentStreamParser] Failed to parse event:', line, error);
    }
  }

  /**
   * 分发事件到具体的处理器
   */
  dispatchEvent(event) {
    switch (event.type) {
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.PHASE_CHANGE:
        this.handlePhaseChange(event);
        break;
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.THINKING:
        this.handleThinking(event);
        break;
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.TOOL_START:
        this.handleToolStart(event);
        break;
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.TOOL_END:
        this.handleToolEnd(event);
        break;
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.TEXT:
        this.handleText(event);
        break;
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.CITATION:
        this.handleCitation(event);
        break;
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.STRUCTURED:
        this.handleStructured(event);
        break;
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.DONE:
        this.handleDone(event);
        break;
      case _stream_events__WEBPACK_IMPORTED_MODULE_0__.EventType.ERROR:
        this.handleError(event);
        break;
      default:
        // eslint-disable-next-line no-console
        console.warn('[AgentStreamParser] Unknown event type:', event.type);
    }
  }
  handlePhaseChange(event) {
    this.callbacks.onPhaseMessage?.(event.data.message);
  }
  handleThinking(event) {
    this.callbacks.onThinking?.(event.data.content);
  }
  handleToolStart(event) {
    this.callbacks.onToolStart?.(event.data);
  }
  handleToolEnd(event) {
    this.callbacks.onToolEnd?.(event.data);
  }
  handleText(event) {
    this.fullText += event.data.content;
    this.callbacks.onText?.(event.data.content, this.fullText);
  }
  handleCitation(event) {
    this.citations.push(event.data);
    this.callbacks.onCitation?.(event.data);
  }
  handleStructured(event) {
    this.callbacks.onStructured?.(event.data);
  }
  handleDone(event) {
    this.callbacks.onDone?.(event.data, {
      fullText: this.fullText,
      citations: this.citations
    });
  }
  handleError(event) {
    this.callbacks.onError?.(event.data);
  }

  /**
   * 处理剩余缓冲区（流结束时调用）
   */
  flush() {
    if (this.buffer.trim()) {
      this.handleLine(this.buffer);
      this.buffer = '';
    }
  }

  /**
   * 重置解析器状态
   */
  reset() {
    this.currentPhase = null;
    this.fullText = '';
    this.citations = [];
    this.buffer = '';
  }

  /**
   * 获取当前解析结果
   */
  getResult() {
    return {
      fullText: this.fullText,
      citations: this.citations,
      phase: this.currentPhase
    };
  }
}

/***/ },

/***/ "./src/components/chatAssistant/agent/useAgentChat.ts"
/*!************************************************************!*\
  !*** ./src/components/chatAssistant/agent/useAgentChat.ts ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useAgentChat: () => (/* binding */ useAgentChat)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _messages_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../messages/types */ "./src/components/chatAssistant/messages/types.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _utils_chat_api__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/chat-api */ "./src/components/chatAssistant/utils/chat-api.ts");
/* harmony import */ var _utils_telegpt_fetch__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/telegpt-fetch */ "./src/components/chatAssistant/utils/telegpt-fetch.ts");
/* harmony import */ var _stream_events__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./stream-events */ "./src/components/chatAssistant/agent/stream-events.ts");
/* harmony import */ var _stream_parser__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./stream-parser */ "./src/components/chatAssistant/agent/stream-parser.ts");
/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./utils */ "./src/components/chatAssistant/agent/utils.ts");
/* eslint-disable no-null/no-null */
/**
 * useAgentChat Hook
 */









function useAgentChat(options) {
  const {
    chatId,
    selectedMessages,
    maxIterations = 10,
    onError,
    onFinish,
    showThinking = false,
    showToolCalls = true,
    detailedCitations = true
  } = options;
  const [messages, setMessages] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [status, setStatus] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('ready');
  const [currentPhase, setCurrentPhase] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
  const [toolCalls, setToolCalls] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const abortControllerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const parserRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const currentAssistantMessageRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)('');
  const citationsRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)([]);
  const messagesRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(messages);
  const chatIdRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(chatId);

  // 同步 messagesRef 和 messages 状态
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    messagesRef.current = messages;
  }, [messages]);

  // 同步 chatIdRef 和 chatId
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    chatIdRef.current = chatId;
  }, [chatId]);
  const isStreaming = status === 'streaming';

  /**
   * 停止当前流式请求
   */
  const stop = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
      abortControllerRef.current = null;
    }
    setStatus('ready');
    setCurrentPhase(null);
  }, []);

  /**
   * 发送消息到 Agent API
   */
  const sendMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async messagesToSend => {
    // 使用 ref 获取最新的 chatId，避免闭包陷阱
    const currentChatId = chatIdRef.current;
    if (!currentChatId) {
      const error = new Error('chatId is required');
      onError?.(error);
      return;
    }

    // 重置状态
    currentAssistantMessageRef.current = '';
    citationsRef.current = [];
    setToolCalls([]);
    setStatus('streaming');

    // 创建新的 AbortController
    abortControllerRef.current = new AbortController();
    const {
      userId
    } = (0,_utils_chat_api__WEBPACK_IMPORTED_MODULE_3__.getCurrentUserInfo)();

    // 获取 deviceId（从 localStorage 或生成新的）
    const deviceId = (0,_utils__WEBPACK_IMPORTED_MODULE_7__.getDeviceId)();
    try {
      // 创建流式解析器
      const parser = new _stream_parser__WEBPACK_IMPORTED_MODULE_6__.AgentStreamParser({
        onPhaseChange: phase => {
          setCurrentPhase(phase);
        },
        onPhaseMessage: message => {
          // eslint-disable-next-line no-console
          console.log('[Agent] Phase:', message);
        },
        onThinking: content => {
          if (showThinking) {
            // eslint-disable-next-line no-console
            console.log('[Agent] Thinking:', content);
          }
        },
        onToolStart: tool => {
          if (showToolCalls) {
            setToolCalls(prev => [...prev, {
              toolName: tool.toolName,
              toolDescription: tool.toolDescription,
              params: tool.params,
              status: 'pending'
            }]);
          }
          // TODO: 引入封装的相关工具
        },
        onToolEnd: tool => {
          if (showToolCalls) {
            setToolCalls(prev => {
              const index = prev.findIndex(t => t.toolName === tool.toolName && t.status === 'pending');
              if (index === -1) return prev;
              const newToolCalls = [...prev];
              newToolCalls[index] = {
                ...newToolCalls[index],
                status: tool.success ? 'success' : 'failed',
                summary: tool.summary,
                error: tool.error
              };
              return newToolCalls;
            });
          }
        },
        onText: (chunk, fullText) => {
          currentAssistantMessageRef.current = fullText;

          // 更新消息列表中的最后一条助手消息
          setMessages(prev => {
            const lastMessage = prev[prev.length - 1];
            if (lastMessage && lastMessage.role === 'assistant') {
              return [...prev.slice(0, -1), {
                ...lastMessage,
                content: fullText
              }];
            }
            // 如果没有助手消息，创建新的
            return [...prev, {
              id: `assistant_${Date.now()}`,
              role: 'assistant',
              content: fullText,
              createdAt: new Date(),
              type: _messages_types__WEBPACK_IMPORTED_MODULE_1__.AIMessageType.Default,
              timestamp: Date.now()
            }];
          });
        },
        onCitation: citation => {
          if (detailedCitations) {
            citationsRef.current.push(citation);
            // eslint-disable-next-line no-console
            console.log('[Agent] Citation:', citation);
            // TODO: 在 UI 中显示引用
          }
        },
        onStructured: data => {
          // eslint-disable-next-line no-console
          console.log('[Agent] Structured data:', data);
        },
        onDone: (doneData, result) => {
          setStatus('ready');
          setCurrentPhase(_stream_events__WEBPACK_IMPORTED_MODULE_5__.AgentPhase.COMPLETED);
          onFinish?.(result);
        },
        onError: error => {
          setStatus('error');
          setCurrentPhase(_stream_events__WEBPACK_IMPORTED_MODULE_5__.AgentPhase.ERROR);
          onError?.(new Error(error.message));
        }
      });
      parserRef.current = parser;

      // 过滤掉 teleai-system 消息，并限制最多 20 条
      const filteredMessages = messagesToSend.filter(msg => msg.role !== 'teleai-system').slice(-20); // 取最后 20 条

      // 构建请求体 - 符合 AgentExecuteParams 类型
      const requestBody = {
        userId: userId,
        deviceId,
        messages: filteredMessages.map(msg => ({
          role: msg.role,
          content: msg.content
        })),
        chatId: currentChatId,
        selectedMessages,
        maxIterations,
        streaming: true,
        options: {
          showThinking,
          showToolCalls,
          detailedCitations
        }
      };

      // 发送请求
      const response = await fetch(`${_config__WEBPACK_IMPORTED_MODULE_2__.SERVER_API_URL}/chat`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'user-id': userId,
          'device-id': deviceId,
          ...(0,_utils_telegpt_fetch__WEBPACK_IMPORTED_MODULE_4__.getApihHeaders)()
        },
        body: JSON.stringify(requestBody),
        signal: abortControllerRef.current.signal
      });
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      if (!response.body) {
        throw new Error('Response body is empty');
      }

      // 读取流式响应
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      while (true) {
        const {
          done,
          value
        } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value, {
          stream: true
        });
        parser.handleChunk(chunk);
      }

      // 处理剩余缓冲区
      parser.flush();
    } catch (error) {
      if (error.name === 'AbortError') {
        // eslint-disable-next-line no-console
        console.log('[Agent] Request aborted');
        setStatus('ready');
      } else {
        // eslint-disable-next-line no-console
        console.error('[Agent] Error:', error);
        setStatus('error');
        onError?.(error);
      }
    } finally {
      abortControllerRef.current = null;
      parserRef.current = null;
    }
  }, [selectedMessages, maxIterations, showThinking, showToolCalls, detailedCitations, onError, onFinish]);

  /**
   * 添加新消息并发送
   */
  const append = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async message => {
    // 使用 ref 获取最新的 messages，避免闭包陷阱
    const newMessages = [...messagesRef.current, message];
    setMessages(newMessages);
    await sendMessage(newMessages);
  }, [sendMessage]);

  /**
   * 重新发送最后一条用户消息
   */
  const reload = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async () => {
    // 使用 ref 获取最新的 messages
    const currentMessages = messagesRef.current;
    if (currentMessages.length === 0) return;

    // 找到最后一条用户消息
    let lastUserMessageIndex = -1;
    for (let i = currentMessages.length - 1; i >= 0; i--) {
      if (currentMessages[i].role === 'user') {
        lastUserMessageIndex = i;
        break;
      }
    }
    if (lastUserMessageIndex === -1) return;

    // 重新发送从开始到最后一条用户消息的所有消息
    const messagesToSend = currentMessages.slice(0, lastUserMessageIndex + 1);
    setMessages(messagesToSend);
    await sendMessage(messagesToSend);
  }, [sendMessage]);

  // 清理
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return () => {
      if (abortControllerRef.current) {
        abortControllerRef.current.abort();
      }
    };
  }, []);
  return {
    messages,
    status,
    currentPhase,
    isStreaming,
    toolCalls,
    setMessages,
    append,
    stop,
    reload
  };
}

/***/ },

/***/ "./src/components/chatAssistant/assets/actions.png"
/*!*********************************************************!*\
  !*** ./src/components/chatAssistant/assets/actions.png ***!
  \*********************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "actions.c226eff441fdabe1f4ee.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/ai-translate.png"
/*!**************************************************************!*\
  !*** ./src/components/chatAssistant/assets/ai-translate.png ***!
  \**************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "ai-translate.0aa5d916daa46257d410.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/calendar.png"
/*!**********************************************************!*\
  !*** ./src/components/chatAssistant/assets/calendar.png ***!
  \**********************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "calendar.44ba2c1ed5c080e9dfa9.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/check.png"
/*!*******************************************************!*\
  !*** ./src/components/chatAssistant/assets/check.png ***!
  \*******************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "check.0abcdabedcbc8ca0f4e8.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/danger.png"
/*!********************************************************!*\
  !*** ./src/components/chatAssistant/assets/danger.png ***!
  \********************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "danger.7dcfa39ea30ab887338e.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/default-avatar.png"
/*!****************************************************************!*\
  !*** ./src/components/chatAssistant/assets/default-avatar.png ***!
  \****************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "default-avatar.37bfde946e6829d2e5a8.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/google-meet.png"
/*!*************************************************************!*\
  !*** ./src/components/chatAssistant/assets/google-meet.png ***!
  \*************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "google-meet.e4ce31c66f07075d2a36.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/google.png"
/*!********************************************************!*\
  !*** ./src/components/chatAssistant/assets/google.png ***!
  \********************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "google.5f147c0a9dbb2590b20d.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/input/grammar-input.png"
/*!*********************************************************************!*\
  !*** ./src/components/chatAssistant/assets/input/grammar-input.png ***!
  \*********************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "grammar-input.b24d0a66de8feb3fd0d9.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/input/translate-input.png"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/assets/input/translate-input.png ***!
  \***********************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "translate-input.7f1d086cf5144ce01b3a.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/invite/invite-gift.png"
/*!********************************************************************!*\
  !*** ./src/components/chatAssistant/assets/invite/invite-gift.png ***!
  \********************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "invite-gift.2242e9ca8f589dfd32ec.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/message.png"
/*!*********************************************************!*\
  !*** ./src/components/chatAssistant/assets/message.png ***!
  \*********************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "message.772cf7cc443d60210a5e.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/summary-introduce/actions.png"
/*!***************************************************************************!*\
  !*** ./src/components/chatAssistant/assets/summary-introduce/actions.png ***!
  \***************************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "actions.c00bd19afbf93bdda994.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/summary-introduce/schedule-meeting.png"
/*!************************************************************************************!*\
  !*** ./src/components/chatAssistant/assets/summary-introduce/schedule-meeting.png ***!
  \************************************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "schedule-meeting.84e2b3273614570bd641.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/summary-introduce/summarize.png"
/*!*****************************************************************************!*\
  !*** ./src/components/chatAssistant/assets/summary-introduce/summarize.png ***!
  \*****************************************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "summarize.9cfdcaba3ebe53c6ba08.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/user.png"
/*!******************************************************!*\
  !*** ./src/components/chatAssistant/assets/user.png ***!
  \******************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "user.530eba74eb794d4f10aa.png";

/***/ },

/***/ "./src/components/chatAssistant/assets/write.png"
/*!*******************************************************!*\
  !*** ./src/components/chatAssistant/assets/write.png ***!
  \*******************************************************/
(module, __unused_webpack_exports, __webpack_require__) {

module.exports = __webpack_require__.p + "write.9996af8c0d2aa6dd43cf.png";

/***/ },

/***/ "./src/components/chatAssistant/code-block.tsx"
/*!*****************************************************!*\
  !*** ./src/components/chatAssistant/code-block.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CodeBlock: () => (/* binding */ CodeBlock)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }
/* eslint-disable react/jsx-props-no-spreading */
/* eslint-disable max-len */
/* eslint-disable react/react-in-jsx-scope */

function CodeBlock({
  node,
  inline,
  className,
  children,
  ...props
}) {
  if (!inline) {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "not-prose flex flex-col"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("pre", _extends({}, props, {
      className: "text-sm w-full overflow-x-auto dark:bg-zinc-900 p-4 border border-zinc-200 dark:border-zinc-700 rounded-xl dark:text-zinc-50 text-zinc-900"
    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("code", {
      className: "whitespace-pre-wrap break-words"
    }, children)));
  } else {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("code", _extends({
      className: `${className} text-sm bg-zinc-100 dark:bg-zinc-800 py-0.5 px-1 rounded-md`
    }, props), children);
  }
}

/***/ },

/***/ "./src/components/chatAssistant/component/AITextarea.tsx"
/*!***************************************************************!*\
  !*** ./src/components/chatAssistant/component/AITextarea.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AITextarea: () => (/* binding */ AITextarea)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/util */ "./src/components/chatAssistant/utils/util.ts");
function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }
/* eslint-disable @stylistic/max-len */


const AITextarea = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(({
  className,
  ...props
}, ref) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement("textarea", _extends({
    className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_1__.cn)('flex min-h-[45px] w-full border-box border border-input bg-white text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:bg-black dark:placeholder:text-[#888888]', className),
    ref: ref
  }, props));
});
AITextarea.displayName = 'Textarea';


/***/ },

/***/ "./src/components/chatAssistant/component/ChatAvatar.tsx"
/*!***************************************************************!*\
  !*** ./src/components/chatAssistant/component/ChatAvatar.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");






const ChatAvatar = ({
  chatId,
  classNames,
  size,
  style
}) => {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  let peer;
  if ((0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_3__.isUserId)(chatId)) {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectUser)(global, chatId);
  } else {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId);
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_Avatar__WEBPACK_IMPORTED_MODULE_5__["default"], {
    style: style,
    key: chatId,
    className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_4__.cn)(classNames, 'overlay-avatar inline-block cursor-pointer'),
    size: size,
    peer: peer
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatAvatar);

/***/ },

/***/ "./src/components/chatAssistant/component/InviteButton.scss"
/*!******************************************************************!*\
  !*** ./src/components/chatAssistant/component/InviteButton.scss ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/InviteButton.teact.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/component/InviteButton.teact.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _InviteButton_scss__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./InviteButton.scss */ "./src/components/chatAssistant/component/InviteButton.scss");
/* harmony import */ var _assets_invite_invite_gift_png__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../assets/invite/invite-gift.png */ "./src/components/chatAssistant/assets/invite/invite-gift.png");






const InviteButton = () => {
  const handleInviteFriendsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openInviteFriendsModal();
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "invite-button",
    onClick: handleInviteFriendsClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: "w-[20px] h-[20px]",
    src: _assets_invite_invite_gift_png__WEBPACK_IMPORTED_MODULE_4__,
    alt: ""
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[12px] font-medium"
  }, "Invite"));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(InviteButton));

/***/ },

/***/ "./src/components/chatAssistant/component/button.tsx"
/*!***********************************************************!*\
  !*** ./src/components/chatAssistant/component/button.tsx ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Button: () => (/* binding */ Button)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* eslint-disable react/jsx-props-no-spreading */
/* eslint-disable max-len */


const Button = ({
  className,
  disabled,
  onClick,
  children: content
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0__.createElement("button", {
    className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_1__.cn)('w-[40px] h-[40px] p-[5px] border-none rounded-full box-border flex items-center justify-center hover:bg-[var(--color-interactive-element-hover)]', className),
    onClick: onClick,
    disabled: disabled
  }, content);
};


/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/GrammarTool.tsx"
/*!******************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/GrammarTool.tsx ***!
  \******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _tabs_FormalTab__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./tabs/FormalTab */ "./src/components/chatAssistant/component/input-grammar/tabs/FormalTab.tsx");
/* harmony import */ var _tabs_FriendlyTab__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./tabs/FriendlyTab */ "./src/components/chatAssistant/component/input-grammar/tabs/FriendlyTab.tsx");
/* harmony import */ var _tabs_ImproveTab__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./tabs/ImproveTab */ "./src/components/chatAssistant/component/input-grammar/tabs/ImproveTab.tsx");
/* harmony import */ var _tabs_RephraseTab__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./tabs/RephraseTab */ "./src/components/chatAssistant/component/input-grammar/tabs/RephraseTab.tsx");
/* harmony import */ var _tabs_ShortenTab__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./tabs/ShortenTab */ "./src/components/chatAssistant/component/input-grammar/tabs/ShortenTab.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* eslint-disable react/jsx-props-no-spreading */
/* eslint-disable max-len */









const TABS = [{
  id: 0,
  title: 'Improve'
}, {
  id: 1,
  title: 'Rephrase'
}, {
  id: 2,
  title: 'Shorten'
}, {
  id: 3,
  title: 'Friendly'
}, {
  id: 4,
  title: 'Formal'
}];
const GrammarTool = props => {
  const {
    getHtml,
    setHtml,
    onClose
  } = props;
  const html = getHtml();
  const text = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_1__["default"])(html).text;
  ;
  const [selectedTabIndex, setSelectedTabIndex] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);

  // 跟踪已经挂载过的tab，避免重复请求
  const mountedTabsRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(new Set([0]));
  const handleSwitchTab = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(newIndex => {
    setSelectedTabIndex(newIndex);
    // 记录已访问的tab
    if (!mountedTabsRef.current.has(newIndex)) {
      mountedTabsRef.current.add(newIndex);
    }
  });
  const shouldMount = index => mountedTabsRef.current.has(index);
  const isVisible = index => selectedTabIndex === index;
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "px-[20px] py-[13px]"
  }, shouldMount(0) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    style: isVisible(0) ? undefined : `display: none`
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_tabs_ImproveTab__WEBPACK_IMPORTED_MODULE_5__["default"], {
    text: text,
    setHtml: setHtml,
    onClose: onClose
  })), shouldMount(1) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    style: isVisible(1) ? undefined : `display: none`
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_tabs_RephraseTab__WEBPACK_IMPORTED_MODULE_6__["default"], {
    text: text,
    setHtml: setHtml,
    onClose: onClose
  })), shouldMount(2) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    style: isVisible(2) ? undefined : `display: none`
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_tabs_ShortenTab__WEBPACK_IMPORTED_MODULE_7__["default"], {
    text: text,
    setHtml: setHtml,
    onClose: onClose
  })), shouldMount(3) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    style: isVisible(3) ? undefined : `display: none`
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_tabs_FriendlyTab__WEBPACK_IMPORTED_MODULE_4__["default"], {
    text: text,
    setHtml: setHtml,
    onClose: onClose
  })), shouldMount(4) && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    style: isVisible(4) ? undefined : `display: none`
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_tabs_FormalTab__WEBPACK_IMPORTED_MODULE_3__["default"], {
    text: text,
    setHtml: setHtml,
    onClose: onClose
  }))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TabList__WEBPACK_IMPORTED_MODULE_2__["default"], {
    activeTab: selectedTabIndex,
    tabs: TABS,
    onSwitchTab: handleSwitchTab
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GrammarTool);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/GrammarToolWrapper.scss"
/*!**************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/GrammarToolWrapper.scss ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/GrammarToolWrapper.tsx"
/*!*************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/GrammarToolWrapper.tsx ***!
  \*************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/subscriptionHandler */ "./src/util/subscriptionHandler.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useVirtualBackdrop__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useVirtualBackdrop */ "./src/hooks/useVirtualBackdrop.ts");
/* harmony import */ var _GrammarTool__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./GrammarTool */ "./src/components/chatAssistant/component/input-grammar/GrammarTool.tsx");
/* harmony import */ var _GrammarToolWrapper_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./GrammarToolWrapper.scss */ "./src/components/chatAssistant/component/input-grammar/GrammarToolWrapper.scss");
/* harmony import */ var _assets_input_grammar_input_png__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../assets/input/grammar-input.png */ "./src/components/chatAssistant/assets/input/grammar-input.png");










const GrammarToolWrapper = props => {
  const [isGrammarToolOpen, openGrammarTool, closeGrammarTool] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const containerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    getHtml,
    setHtml
  } = props;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isGrammarToolOpen ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_2__["default"])(closeGrammarTool) : undefined, [isGrammarToolOpen, closeGrammarTool]);
  (0,_hooks_useVirtualBackdrop__WEBPACK_IMPORTED_MODULE_6__["default"])(isGrammarToolOpen, containerRef, closeGrammarTool, undefined, undefined);
  const handleToggleMenu = () => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_4__.checkCredisBalance)()) {
      (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openPayPackageModal();
      return;
    }
    if (isGrammarToolOpen) {
      closeGrammarTool();
    } else {
      const {
        text
      } = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_3__["default"])(getHtml());
      if (text.trim() === '') return;
      openGrammarTool();
    }
  };
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "input-ai-actions flex-shrink-0 mr-[8px]",
    ref: containerRef
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    className: "Button input-ai-actions-button",
    onClick: handleToggleMenu
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: _assets_input_grammar_input_png__WEBPACK_IMPORTED_MODULE_9__,
    alt: "Chat AI Logo"
  })), isGrammarToolOpen && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "grammar-tool-wrapper open"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_GrammarTool__WEBPACK_IMPORTED_MODULE_7__["default"], {
    getHtml: getHtml,
    setHtml: setHtml,
    onClose: closeGrammarTool
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GrammarToolWrapper);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/InputErrorTooltip.tsx"
/*!************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/InputErrorTooltip.tsx ***!
  \************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/popover/index.js");
/* eslint-disable max-len */
/* eslint-disable no-null/no-null */



const TooltipContent = ({
  replacement,
  errorIndex,
  handleFixError
}) => {
  // eslint-disable-next-line @typescript-eslint/no-shadow
  const handleClick = () => {
    handleFixError(errorIndex);
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, "ReplaceMent"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "max-w-[min(30vw,400px)] px-[12px] py-[10px] rounded-[8px] cursor-pointer hover:bg-[var(--color-primary)] hover:text-white",
    onClick: handleClick
  }, replacement));
};
const InputErrorTooltip = props => {
  const {
    top,
    left,
    width,
    height,
    replacement,
    generalErrorType,
    errorIndex,
    handleFixError
  } = props;
  const triggerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "absolute pointer-events-none",
    style: {
      left: `${left}px`,
      top: `${top}px`,
      width: `${width}px`,
      height: `${height}px`
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    placement: "top",
    content: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(TooltipContent, {
      replacement: replacement,
      errorIndex: errorIndex,
      handleFixError: handleFixError
    })
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    ref: triggerRef,
    className: `absolute bottom-[-2px] h-[6px] w-full border-b-[2px] pointer-events-auto ${generalErrorType.toLocaleLowerCase() === 'typos' ? 'border-red-500/60' : 'border-[#FFD633]'}`
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (/*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(InputErrorTooltip));

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/InputGrammar.scss"
/*!********************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/InputGrammar.scss ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/InputGrammar.tsx"
/*!*******************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/InputGrammar.tsx ***!
  \*******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/button/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/modal/index.js");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../icons */ "./src/components/chatAssistant/icons.tsx");
/* harmony import */ var _useGrammarChecker__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./useGrammarChecker */ "./src/components/chatAssistant/component/input-grammar/useGrammarChecker.ts");
/* harmony import */ var _InputErrorTooltip__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./InputErrorTooltip */ "./src/components/chatAssistant/component/input-grammar/InputErrorTooltip.tsx");
/* harmony import */ var _tabs_HighlightedTextReact__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./tabs/HighlightedTextReact */ "./src/components/chatAssistant/component/input-grammar/tabs/HighlightedTextReact.tsx");
/* harmony import */ var _InputGrammar_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./InputGrammar.scss */ "./src/components/chatAssistant/component/input-grammar/InputGrammar.scss");
/* eslint-disable no-null/no-null */
/* eslint-disable @typescript-eslint/naming-convention */
/* eslint-disable max-len */
/* eslint-disable @typescript-eslint/no-use-before-define */







const InputGrammar = props => {
  const {
    inputRef,
    getHtml,
    setHtml
  } = props;
  // const [errorMarkers, setErrorMarkers] = useState<ErrorMarker[]>([]);
  const [errorsModalVisible, setErrorsModalVisible] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [errorsModalPosition, setErrorsModalPosition] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({
    left: 0,
    top: 0
  });
  const {
    corrections,
    spalingLoading,
    errorMarkers,
    fixError,
    fixAllErrors
  } = (0,_useGrammarChecker__WEBPACK_IMPORTED_MODULE_4__.useGrammarChecker)(inputRef, getHtml, setHtml, {});
  const showErrorModal = () => {
    if (inputRef && inputRef.current) {
      const inputReact = inputRef.current.getBoundingClientRect();
      const {
        left,
        top
      } = inputReact;
      setErrorsModalPosition({
        left,
        top: top - 240
      });
      setErrorsModalVisible(true);
    }
  };
  const closeErrorModal = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setErrorsModalVisible(false);
  }, []);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "absolute left-0 top-0 pointer-events-auto"
  }, errorMarkers.map((item, index) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_InputErrorTooltip__WEBPACK_IMPORTED_MODULE_5__["default"], {
      left: item.left,
      top: item.top,
      width: item.width,
      height: item.height,
      replacement: item.replacement,
      errorIndex: index,
      generalErrorType: item.general_error_type,
      handleFixError: fixError
    });
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "sapling-badge-container"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "sapling-status-container"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "sapling-badge-errors"
  }, errorMarkers.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "sapling-badge-errors-count",
    onClick: showErrorModal
  }, errorMarkers.length)), spalingLoading && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "sapling-badge-spinner"
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_2__["default"], {
    className: "sapling-errors-modal",
    closable: false,
    footer: null,
    open: errorsModalVisible,
    onCancel: closeErrorModal,
    destroyOnHidden: true,
    style: {
      top: errorsModalPosition.top,
      left: errorsModalPosition.left
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ErrorsReview, {
    errorRanges: corrections,
    handleFixError: fixError,
    handleFixAllErrors: fixAllErrors,
    onClose: closeErrorModal
  })));
};
const ErrorsReview = ({
  errorRanges,
  onClose,
  handleFixAllErrors,
  handleFixError
}) => {
  const [currentErrorIndex, setCurrentErrorIndex] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [currentErrorRange, setCurrentErrorRange] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(errorRanges[0]);
  const [currentError, setCurrentError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [currentSentence, setCurrentSentence] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const curRange = errorRanges[currentErrorIndex];
    if (curRange) {
      setCurrentErrorRange(curRange);
      setCurrentError([{
        description: curRange.description,
        offset: curRange.start - curRange.sentence_start,
        length: curRange.end - curRange.start,
        originalText: curRange.original_text,
        remove_segment: false,
        suggestions: [curRange.replacement]
      }]);
      setCurrentSentence(curRange.sentence);
    }
  }, [currentErrorIndex, errorRanges]);
  const handleClickPrev = () => {
    if (currentErrorIndex > 0) {
      setCurrentErrorIndex(currentErrorIndex - 1);
    }
  };
  const handleClickNext = () => {
    if (currentErrorIndex < errorRanges.length - 1) {
      setCurrentErrorIndex(currentErrorIndex + 1);
    }
  };
  const handleAccept = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    handleFixError(currentErrorIndex);
    if (errorRanges.length === 1) {
      onClose();
    }
    if (currentErrorIndex === errorRanges.length - 1) {
      onClose();
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [currentErrorIndex, currentErrorRange]);
  const handleAcceptAll = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    handleFixAllErrors();
    onClose();
  }, [handleFixAllErrors, onClose]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-[190px] flex flex-col overflow-hidden"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row items-center justify-between"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", {
    className: "text-[var(--color-text)]"
  }, "Review suggestions"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-[26px] rounded-[6px] overflow-hidden flex flex-row"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[21px] bg-[#F1F1F1] cursor-pointer",
    onClick: handleClickPrev
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_3__.LeftOutlined, null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[5px] text-[#979797]"
  }, currentErrorIndex + 1, "/", errorRanges.length), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[21px] bg-[#F1F1F1] cursor-pointer",
    onClick: handleClickNext
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_3__.RightOutlined, null)))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex-1 overflow-hidden flex flex-col"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[8px] h-[8px] rounded-full bg-[#FF9900]"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px] text-[#959595]"
  }, "Improve your text")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex-1 overflow-auto"
  }, currentError ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_tabs_HighlightedTextReact__WEBPACK_IMPORTED_MODULE_6__["default"], {
    text: currentSentence,
    errors: currentError
  }) : undefined)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row items-center justify-between  pt-[10px] border-t-[1px] border-black/10"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[#7D40FF] border-[1px] border-[#7D40FF] rounded-[6px] px-[8px] py-[5px]",
    onClick: handleAcceptAll
  }, "Accept all (", errorRanges.length, ")"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    color: "purple",
    variant: "solid",
    onClick: handleAccept
  }, "Accept"))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InputGrammar);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/InputGrammarWrapper.tsx"
/*!**************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/InputGrammarWrapper.tsx ***!
  \**************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _injectComponent__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../injectComponent */ "./src/components/chatAssistant/injectComponent.tsx");
/* harmony import */ var _InputGrammar__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./InputGrammar */ "./src/components/chatAssistant/component/input-grammar/InputGrammar.tsx");



const InputGrammarWrapper = props => {
  const {
    inputRef,
    getHtml,
    setHtml
  } = props;
  const containerRef = (0,_injectComponent__WEBPACK_IMPORTED_MODULE_1__.injectComponent)({
    component: _InputGrammar__WEBPACK_IMPORTED_MODULE_2__["default"],
    props: {
      inputRef,
      getHtml,
      setHtml
    }
  });
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "absolute left-0 top-0 w-full h-full pointer-events-none",
    ref: containerRef
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InputGrammarWrapper);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.scss"
/*!*******************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.scss ***!
  \*******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.tsx"
/*!******************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.tsx ***!
  \******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _SkeletonScreen_scss__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SkeletonScreen.scss */ "./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.scss");


const SkeletonScreen = () => {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "skeleton-wrapper"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "skeleton-text skeleton-line"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "skeleton-text skeleton-line"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "skeleton-text skeleton-line"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SkeletonScreen);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/tabs/FormalTab.tsx"
/*!*********************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/tabs/FormalTab.tsx ***!
  \*********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _utils_grammarly__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/grammarly */ "./src/components/chatAssistant/utils/grammarly.ts");
/* harmony import */ var _Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Skeleton/SkeletonScreen */ "./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.tsx");
/* harmony import */ var _HighlightedText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./HighlightedText */ "./src/components/chatAssistant/component/input-grammar/tabs/HighlightedText.tsx");
/* eslint-disable react-hooks-static-deps/exhaustive-deps */
/* eslint-disable max-len */




const FormalTab = props => {
  const {
    text,
    setHtml,
    onClose
  } = props;
  const [loading, setLoading] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [grammarlyResult, setGrammarlyResult] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  function handleImprove() {
    (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.grammarlyFormal)(text).then(result => {
      if (result.data.errors) {
        setGrammarlyResult(result.data.errors);
        setLoading(false);
      } else {
        throw new Error('No errors found in the text');
      }
    }).catch(err => {
      // eslint-disable-next-line no-console
      console.error('Error checking grammar:', err);
      setLoading(false);
      setGrammarlyResult([]);
    });
  }
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    handleImprove();
  }, [text]);
  const handleAccept = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (grammarlyResult) {
      const newText = (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.getCorrectedText)(text, grammarlyResult);
      setHtml(newText);
      onClose();
    }
  }, [grammarlyResult]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h2", {
    className: "grammar-tool-tab-content-title"
  }, "Use professional wording"), loading ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__["default"], null) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HighlightedText__WEBPACK_IMPORTED_MODULE_3__["default"], {
    text: text,
    errors: grammarlyResult
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    color: "default",
    className: "border-[#D9D9D9] border-[1px] px-[8px] py-[4px] rounded-[6px]",
    onClick: handleAccept
  }, "Accept")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (FormalTab);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/tabs/FriendlyTab.tsx"
/*!***********************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/tabs/FriendlyTab.tsx ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _utils_grammarly__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/grammarly */ "./src/components/chatAssistant/utils/grammarly.ts");
/* harmony import */ var _Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Skeleton/SkeletonScreen */ "./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.tsx");
/* harmony import */ var _HighlightedText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./HighlightedText */ "./src/components/chatAssistant/component/input-grammar/tabs/HighlightedText.tsx");
/* eslint-disable react-hooks-static-deps/exhaustive-deps */
/* eslint-disable max-len */




const FriendlyTab = props => {
  const {
    text,
    setHtml,
    onClose
  } = props;
  const [loading, setLoading] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [grammarlyResult, setGrammarlyResult] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  function handleImprove() {
    (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.grammarlyFriendly)(text).then(result => {
      if (result.data.errors) {
        setGrammarlyResult(result.data.errors);
        setLoading(false);
      } else {
        throw new Error('No errors found in the text');
      }
    }).catch(err => {
      // eslint-disable-next-line no-console
      console.error('Error checking grammar:', err);
      setLoading(false);
      setGrammarlyResult([]);
    });
  }
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    handleImprove();
  }, [text]);
  const handleAccept = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (grammarlyResult) {
      const newText = (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.getCorrectedText)(text, grammarlyResult);
      setHtml(newText);
      onClose();
    }
  }, [grammarlyResult]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h2", {
    className: "grammar-tool-tab-content-title"
  }, "Use more personal language"), loading ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__["default"], null) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HighlightedText__WEBPACK_IMPORTED_MODULE_3__["default"], {
    text: text,
    errors: grammarlyResult
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    color: "default",
    className: "border-[#D9D9D9] border-[1px] px-[8px] py-[4px] rounded-[6px]",
    onClick: handleAccept
  }, "Accept")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (FriendlyTab);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/tabs/HighlightedText.tsx"
/*!***************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/tabs/HighlightedText.tsx ***!
  \***************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* eslint-disable react/no-array-index-key */

const HighlightedText = ({
  text,
  errors
}) => {
  if (!errors.length) return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, text));

  // 将原文拆分成高亮块和普通块
  const fragments = [];
  let lastIndex = 0;
  errors.sort((a, b) => a.offset - b.offset).forEach((error, index) => {
    const {
      offset,
      length,
      suggestions
    } = error;

    // 添加错误前的正常文本
    if (offset > lastIndex) {
      fragments.push(/*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        key: `normal-${index}`,
        className: "text-[var(--color-text)]"
      }, text.slice(lastIndex, offset)));
    }

    // 添加错误词 + 建议
    const original = text.slice(offset, offset + length);
    const suggestion = suggestions[0] || '';
    fragments.push(/*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      key: `error-${index}`,
      className: "bg-black/15 line-through mr-[4px] text-[var(--color-text)]"
    }, original));
    fragments.push(/*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      key: `suggestion-${index}`,
      className: "bg-[#8C42F033] mr-[4px] text-[#8C42F0]"
    }, suggestion));
    lastIndex = offset + length;
  });

  // 添加最后剩余的文本
  if (lastIndex < text.length) {
    fragments.push(/*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      key: "end",
      className: "text-[var(--color-text)]"
    }, text.slice(lastIndex)));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, fragments);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (HighlightedText);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/tabs/HighlightedTextReact.tsx"
/*!********************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/tabs/HighlightedTextReact.tsx ***!
  \********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* eslint-disable react/no-array-index-key */

const HighlightedTextReact = ({
  text,
  errors
}) => {
  if (!errors.length) return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, text));

  // 将原文拆分成高亮块和普通块
  const fragments = [];
  let lastIndex = 0;
  errors.sort((a, b) => a.offset - b.offset).forEach((error, index) => {
    const {
      offset,
      length,
      suggestions
    } = error;

    // 添加错误前的正常文本
    if (offset > lastIndex) {
      fragments.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
        key: `normal-${index}`,
        className: "text-[var(--color-text)]"
      }, text.slice(lastIndex, offset)));
    }

    // 添加错误词 + 建议
    const original = text.slice(offset, offset + length);
    const suggestion = suggestions[0] || '';
    fragments.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      key: `error-${index}`,
      className: "bg-black/15 line-through mr-[4px] text-[var(--color-text)]"
    }, original));
    fragments.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      key: `suggestion-${index}`,
      className: "bg-[#8C42F033] mr-[4px] text-[#8C42F0]"
    }, suggestion));
    lastIndex = offset + length;
  });

  // 添加最后剩余的文本
  if (lastIndex < text.length) {
    fragments.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      key: "end",
      className: "text-[var(--color-text)]"
    }, text.slice(lastIndex)));
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", null, fragments);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (HighlightedTextReact);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/tabs/ImproveTab.tsx"
/*!**********************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/tabs/ImproveTab.tsx ***!
  \**********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _utils_grammarly__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/grammarly */ "./src/components/chatAssistant/utils/grammarly.ts");
/* harmony import */ var _Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Skeleton/SkeletonScreen */ "./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.tsx");
/* harmony import */ var _HighlightedText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./HighlightedText */ "./src/components/chatAssistant/component/input-grammar/tabs/HighlightedText.tsx");
/* eslint-disable react-hooks-static-deps/exhaustive-deps */
/* eslint-disable max-len */




const ImproveTab = props => {
  const {
    text,
    setHtml,
    onClose
  } = props;
  const [loading, setLoading] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [grammarlyResult, setGrammarlyResult] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  function handleImprove() {
    (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.grammarlyCheck)(text).then(result => {
      if (result.data.errors) {
        setGrammarlyResult(result.data.errors);
        setLoading(false);
      } else {
        throw new Error('No errors found in the text');
      }
    }).catch(err => {
      // eslint-disable-next-line no-console
      console.error('Error checking grammar:', err);
      setLoading(false);
      setGrammarlyResult([]);
    });
  }
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    handleImprove();
  }, [text]);
  const handleAccept = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (grammarlyResult) {
      const newText = (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.getCorrectedText)(text, grammarlyResult);
      setHtml(newText);
      onClose();
    }
  }, [grammarlyResult]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h2", {
    className: "grammar-tool-tab-content-title"
  }, "Fix grammar errors"), loading ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__["default"], null) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HighlightedText__WEBPACK_IMPORTED_MODULE_3__["default"], {
    text: text,
    errors: grammarlyResult
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    color: "default",
    className: "border-[#D9D9D9] border-[1px] px-[8px] py-[4px] rounded-[6px]",
    onClick: handleAccept
  }, "Accept")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ImproveTab);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/tabs/RephraseTab.tsx"
/*!***********************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/tabs/RephraseTab.tsx ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _utils_grammarly__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/grammarly */ "./src/components/chatAssistant/utils/grammarly.ts");
/* harmony import */ var _Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Skeleton/SkeletonScreen */ "./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.tsx");
/* harmony import */ var _HighlightedText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./HighlightedText */ "./src/components/chatAssistant/component/input-grammar/tabs/HighlightedText.tsx");
/* eslint-disable react-hooks-static-deps/exhaustive-deps */
/* eslint-disable max-len */




const RephraseTab = props => {
  const {
    text,
    setHtml,
    onClose
  } = props;
  const [loading, setLoading] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [grammarlyResult, setGrammarlyResult] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  function handleImprove() {
    (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.grammarlyRephrase)(text).then(result => {
      if (result.data.errors) {
        setGrammarlyResult(result.data.errors);
        setLoading(false);
      } else {
        throw new Error('No errors found in the text');
      }
    }).catch(err => {
      // eslint-disable-next-line no-console
      console.error('Error checking grammar:', err);
      setLoading(false);
      setGrammarlyResult([]);
    });
  }
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    handleImprove();
  }, [text]);
  const handleAccept = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (grammarlyResult) {
      const newText = (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.getCorrectedText)(text, grammarlyResult);
      setHtml(newText);
      onClose();
    }
  }, [grammarlyResult]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h2", {
    className: "grammar-tool-tab-content-title"
  }, "Enhance clarity and fluency"), loading ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__["default"], null) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HighlightedText__WEBPACK_IMPORTED_MODULE_3__["default"], {
    text: text,
    errors: grammarlyResult
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    color: "default",
    className: "border-[#D9D9D9] border-[1px] px-[8px] py-[4px] rounded-[6px]",
    onClick: handleAccept
  }, "Accept")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RephraseTab);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/tabs/ShortenTab.tsx"
/*!**********************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/tabs/ShortenTab.tsx ***!
  \**********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _utils_grammarly__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/grammarly */ "./src/components/chatAssistant/utils/grammarly.ts");
/* harmony import */ var _Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Skeleton/SkeletonScreen */ "./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.tsx");
/* harmony import */ var _HighlightedText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./HighlightedText */ "./src/components/chatAssistant/component/input-grammar/tabs/HighlightedText.tsx");
/* eslint-disable react-hooks-static-deps/exhaustive-deps */
/* eslint-disable max-len */




const ShortenTab = props => {
  const {
    text,
    setHtml,
    onClose
  } = props;
  const [loading, setLoading] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [grammarlyResult, setGrammarlyResult] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  function handleImprove() {
    (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.grammarlyShorten)(text).then(result => {
      if (result.data.errors) {
        setGrammarlyResult(result.data.errors);
        setLoading(false);
      } else {
        throw new Error('No errors found in the text');
      }
    }).catch(err => {
      // eslint-disable-next-line no-console
      console.error('Error checking grammar:', err);
      setLoading(false);
      setGrammarlyResult([]);
    });
  }
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    handleImprove();
  }, [text]);
  const handleAccept = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (grammarlyResult) {
      const newText = (0,_utils_grammarly__WEBPACK_IMPORTED_MODULE_1__.getCorrectedText)(text, grammarlyResult);
      setHtml(newText);
      onClose();
    }
  }, [grammarlyResult]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h2", {
    className: "grammar-tool-tab-content-title"
  }, "Condense wordy sections"), loading ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Skeleton_SkeletonScreen__WEBPACK_IMPORTED_MODULE_2__["default"], null) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HighlightedText__WEBPACK_IMPORTED_MODULE_3__["default"], {
    text: text,
    errors: grammarlyResult
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    color: "default",
    className: "border-[#D9D9D9] border-[1px] px-[8px] py-[4px] rounded-[6px]",
    onClick: handleAccept
  }, "Accept")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ShortenTab);

/***/ },

/***/ "./src/components/chatAssistant/component/input-grammar/useGrammarChecker.ts"
/*!***********************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-grammar/useGrammarChecker.ts ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useGrammarChecker: () => (/* binding */ useGrammarChecker)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var diff_match_patch__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! diff-match-patch */ "./node_modules/diff-match-patch/index.js");
/* harmony import */ var diff_match_patch__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(diff_match_patch__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var lodash_debounce__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lodash.debounce */ "./node_modules/lodash.debounce/index.js");
/* harmony import */ var lodash_debounce__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(lodash_debounce__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _utils_grammar__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/grammar */ "./src/components/chatAssistant/utils/grammar.ts");
/* eslint-disable no-null/no-null */






const dmp = new diff_match_patch__WEBPACK_IMPORTED_MODULE_1__.diff_match_patch();
function getTextNodes(node) {
  const walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null);
  const textNodes = [];
  while (walker.nextNode()) textNodes.push(walker.currentNode);
  return textNodes;
}
function getNodeForIndex(textNodes, index) {
  let remaining = index;
  for (const node of textNodes) {
    if (node.nodeType !== Node.TEXT_NODE) continue;
    const textLength = node.length;
    if (remaining <= textLength) {
      return {
        node,
        offset: remaining
      };
    }
    remaining -= textLength;
  }
  return {
    node: null,
    offset: 0
  };
}
function getUnderlineOffset(rect, containerRect, editableDiv) {
  const computed = getComputedStyle(editableDiv);
  const lineHeight = parseFloat(computed.lineHeight || '16');
  return {
    left: rect.left - containerRect.left,
    top: rect.top - containerRect.top,
    width: rect.width,
    height: lineHeight
  };
}
function pruneInvalidRanges(text, corrections) {
  return corrections.filter(({
    start,
    end,
    original_text
  }) => {
    if (end > text.length) return false;
    const span = text.slice(start, end);
    return span === original_text && /\S/.test(span);
  });
}
function updateErrorOffsetsWithInvalidateInner(oldText, newText, corrections) {
  const diffs = dmp.diff_main(oldText, newText);
  dmp.diff_cleanupSemantic(diffs);
  const newErrors = [];
  let oldCursor = 0;
  for (const err of corrections) {
    const start = err.start;
    const end = err.end;
    let valid = true;
    let offset = 0;
    oldCursor = 0;
    for (const [op, text] of diffs) {
      const len = text.length;
      if (op === 0) {
        oldCursor += len;
      } else if (op === -1) {
        // deletion
        if (oldCursor + len <= start) {
          offset -= len;
          oldCursor += len;
        } else if (oldCursor < end) {
          valid = false;
          break;
        }
      } else if (op === 1) {
        // insertion
        if (oldCursor <= start) {
          offset += len;
        } else if (oldCursor < end) {
          valid = false;
          break;
        }
      }
    }
    if (valid) {
      newErrors.push({
        ...err,
        start: start + offset,
        end: end + offset
      });
    }
  }
  return newErrors;
}
function useGrammarChecker(inputRef, getHtml, setHtml, {
  delay = 1000
}) {
  const [errorRanges, setErrorRanges] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [spalingLoading, setSpalingLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [errorMarkers, setErrorMarkers] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const lastTextRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)('');
  const lastCheckTimeRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(Date.now());
  const highLightErrors = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    const textarea = inputRef.current;
    if (!textarea) return;
    const textContent = textarea.textContent || '';
    const textNodes = getTextNodes(textarea);
    if (!textNodes) return;
    setErrorMarkers([]);
    const validRanges = pruneInvalidRanges(textContent, errorRanges);
    const markers = [];
    for (const item of validRanges) {
      const {
        start,
        end,
        replacement,
        general_error_type
      } = item;
      const {
        node: startNode,
        offset: startOffset
      } = getNodeForIndex(textNodes, start);
      const {
        node: endNode,
        offset: endOffset
      } = getNodeForIndex(textNodes, end);
      if (!startNode || !endNode) continue;
      const range = document.createRange();
      range.setStart(startNode, startOffset);
      range.setEnd(endNode, endOffset);
      const rects = range.getClientRects();
      const textareaRect = textarea.getBoundingClientRect();
      for (const rect of rects) {
        markers.push({
          ...getUnderlineOffset(rect, textareaRect, textarea),
          start,
          end,
          replacement,
          general_error_type
        });
      }
    }
    setErrorMarkers(markers);
  }, [errorRanges, inputRef]);
  const checkTextInput = async () => {
    const text = inputRef.current?.innerText || '';
    setSpalingLoading(true);
    const corrections = await _utils_grammar__WEBPACK_IMPORTED_MODULE_4__.sapling.check(text);
    lastTextRef.current = text;
    lastCheckTimeRef.current = Date.now();
    const updatedErrors = updateErrorOffsetsWithInvalidateInner(lastTextRef.current, text, corrections);
    setErrorRanges(updatedErrors);
    if (updatedErrors.length === 0) {
      setErrorMarkers([]);
    }
    setSpalingLoading(false);
  };
  const inputNlpRuleCheck = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(lodash_debounce__WEBPACK_IMPORTED_MODULE_2___default()(checkTextInput, delay, {
    leading: false,
    trailing: true
  })).current;
  const hightLightDebounceFunc = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => lodash_debounce__WEBPACK_IMPORTED_MODULE_2___default()(highLightErrors, delay, {
    leading: false,
    trailing: true
  }), [highLightErrors, delay]);
  const inputHtml = getHtml();
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (inputRef.current) {
      const {
        text
      } = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_3__["default"])(inputHtml);
      if (text.trim().length === 0) {
        setErrorRanges([]);
        setErrorMarkers([]);
        return;
      }
      inputNlpRuleCheck();
    }
  }, [inputHtml, inputNlpRuleCheck, inputRef]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const handleResize = () => {
      hightLightDebounceFunc();
    };
    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [hightLightDebounceFunc]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    highLightErrors();
  }, [errorRanges, highLightErrors]);
  const fixError = index => {
    const correction = errorRanges[index];
    const el = inputRef.current;
    if (!correction || !el || !correction.replacement) return;
    const {
      start,
      end,
      replacement
    } = correction;
    const fullText = el.innerText || '';
    const newText = fullText.slice(0, start) + replacement + fullText.slice(end);
    el.innerText = newText;

    // 更新 errorRanges：剔除当前项，重新计算剩余项的位置
    const newErrors = [];
    const offsetChange = replacement.length - (end - start);
    for (let i = 0; i < errorRanges.length; i++) {
      if (i === index) continue;
      const err = errorRanges[i];
      if (err.start >= end) {
        newErrors.push({
          ...err,
          start: err.start + offsetChange,
          end: err.end + offsetChange
        });
      } else {
        newErrors.push(err);
      }
    }
    setErrorRanges(newErrors);
    lastTextRef.current = newText;
    setHtml(newText);
  };
  // ✅ 替换所有错误
  const fixAllErrors = () => {
    const el = inputRef.current;
    if (!el || errorRanges.length === 0) return;
    let fullText = el.innerText || '';
    const sorted = [...errorRanges].sort((a, b) => a.start - b.start);
    let offset = 0;
    for (const {
      start,
      end,
      replacement
    } of sorted) {
      if (!replacement) continue;
      const realStart = start + offset;
      const realEnd = end + offset;
      fullText = fullText.slice(0, realStart) + replacement + fullText.slice(realEnd);
      offset += replacement.length - (end - start);
    }
    el.innerText = fullText;
    lastTextRef.current = fullText;
    setHtml(fullText);
    setErrorRanges([]);
    setErrorMarkers([]);
    inputNlpRuleCheck();
  };
  return {
    corrections: errorRanges,
    spalingLoading,
    errorMarkers,
    fixError,
    fixAllErrors
  };
}

/***/ },

/***/ "./src/components/chatAssistant/component/input-translate/input-language-modal.tsx"
/*!*****************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-translate/input-language-modal.tsx ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_InputText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../ui/InputText */ "./src/components/ui/InputText.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _input_language_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./input-language.module.scss */ "./src/components/chatAssistant/component/input-translate/input-language.module.scss");










const InputLanguageModal = ({
  isOpen,
  inputTranslateOptions,
  closeInputLanguageModal,
  updateRoomInputTranslateOptions
}) => {
  const [search, setSearch] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])((langCode, translatedName) => {
    inputTranslateOptions.translateLanguage = langCode;
    inputTranslateOptions.translateLanguageName = translatedName;
    updateRoomInputTranslateOptions(inputTranslateOptions);
    updateRoomInputTranslateOptions(inputTranslateOptions);
    closeInputLanguageModal();
  });
  const handleSearch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(e => {
    setSearch(e.target.value);
  });
  const translateLanguages = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => _config__WEBPACK_IMPORTED_MODULE_1__.SUPPORTED_TRANSLATION_LANGUAGES.map(langCode => {
    const translatedNames = new Intl.DisplayNames([inputTranslateOptions.translateLanguage || 'en'], {
      type: 'language'
    });
    const translatedName = translatedNames.of(langCode);
    const originalNames = new Intl.DisplayNames([langCode], {
      type: 'language'
    });
    const originalName = originalNames.of(langCode);
    return {
      langCode,
      translatedName,
      originalName
    };
  }), [inputTranslateOptions]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) setSearch('');
  }, [isOpen]);
  const filteredDisplayedLanguages = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!search.trim()) {
      return translateLanguages;
    }
    return translateLanguages.filter(({
      langCode,
      translatedName,
      originalName
    }) => translatedName.toLowerCase().includes(search.toLowerCase()) || originalName.toLowerCase().includes(search.toLowerCase()) || langCode.toLowerCase().includes(search.toLowerCase()));
  }, [translateLanguages, search]);
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Modal__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: _input_language_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root,
    isSlim: true,
    isOpen: isOpen,
    title: "Language",
    hasCloseButton: true,
    onClose: closeInputLanguageModal
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_InputText__WEBPACK_IMPORTED_MODULE_6__["default"], {
    key: "search",
    value: search,
    onChange: handleSearch,
    placeholder: lang('Search')
    // teactExperimentControlled
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_input_language_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].languages, 'custom-scroll')
  }, filteredDisplayedLanguages.map(({
    langCode,
    originalName,
    translatedName
  }) => /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
    key: langCode,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_input_language_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].listItem, 'no-icon'),
    secondaryIcon: inputTranslateOptions.translateLanguage === langCode ? 'check' : undefined,
    disabled: inputTranslateOptions.translateLanguage === langCode,
    multiline: true,
    narrow: true,
    allowDisabledClick: true,
    onClick: () => handleSelect(langCode, originalName)
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('title', _input_language_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].title)
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_3__["default"])(originalName, ['highlight'], {
    highlight: search
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('subtitle', _input_language_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].subtitle)
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_3__["default"])(translatedName, ['highlight'], {
    highlight: search
  }))))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InputLanguageModal);

/***/ },

/***/ "./src/components/chatAssistant/component/input-translate/input-language.module.scss"
/*!*******************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-translate/input-language.module.scss ***!
  \*******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"LFiEK79A","list-item":"_VgXA3ZV","listItem":"_VgXA3ZV","title":"RITxpjRP","subtitle":"TsAsFkJP","languages":"WPdg2YHh"});

/***/ },

/***/ "./src/components/chatAssistant/component/input-translate/input-translate-open-tip.tsx"
/*!*********************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-translate/input-translate-open-tip.tsx ***!
  \*********************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _input_translate_tip_scss__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./input-translate-tip.scss */ "./src/components/chatAssistant/component/input-translate/input-translate-tip.scss");


const InputTranslateOpenTip = () => {
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "input-translate-open-tip"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, "Real-time input translation is on. Tap Turn off anytime."), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "input-translate-tip-arrow"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InputTranslateOpenTip);

/***/ },

/***/ "./src/components/chatAssistant/component/input-translate/input-translate-tip.scss"
/*!*****************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-translate/input-translate-tip.scss ***!
  \*****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/input-translate/input-translate-tip.tsx"
/*!****************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-translate/input-translate-tip.tsx ***!
  \****************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _utils_room_input_translate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/room-input-translate */ "./src/components/chatAssistant/utils/room-input-translate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _input_translate_tip_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./input-translate-tip.scss */ "./src/components/chatAssistant/component/input-translate/input-translate-tip.scss");







const InputTranslateTip = ({
  chatId,
  inputTranslateOptions,
  translatedName,
  detectedLanguage,
  onCLose
}) => {
  const handleOpenInputTranslation = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    (0,_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_3__.updateRoomInputTranslateOptions)(chatId, {
      ...inputTranslateOptions,
      autoTranslate: true,
      translateLanguage: detectedLanguage,
      translateLanguageName: translatedName
    });
    onCLose(true);
  });
  const handleClose = e => {
    e.preventDefault();
    e.stopPropagation();
    onCLose(false);
  };
  const handleStopPropagation = e => {
    e.preventDefault();
    e.stopPropagation();
  };
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "input-translate-tip",
    onClick: handleStopPropagation
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-transform-none"
  }, `This chat is in ${translatedName}. Turn on real-time input translation?`), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center gap-[8px] justify-end mt-[12px]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    size: "tiny",
    className: "!h-[32px] w-[88px] normal-case !bg-white/50 !text-black !m-0",
    onClick: handleClose
  }, "No need"), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    size: "tiny",
    className: "!h-[32px] w-[88px] normal-case !bg-white !text-black !m-0",
    onClick: handleOpenInputTranslation
  }, "Turn on")), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "input-translate-tip-arrow"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId);
  const detectedLanguage = chat?.detectedLanguage;
  const language = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectLanguageCode)(global);
  const translatedNames = new Intl.DisplayNames([language], {
    type: 'language'
  });
  const translatedName = detectedLanguage ? translatedNames.of(detectedLanguage) : undefined;
  const inputTranslateOptions = global.roomInputTranslateOptions[chatId] || {
    translateLanguage: chat?.detectedLanguage || 'en',
    translateLanguageName: translatedName || 'English',
    autoTranslate: false
  };
  return {
    translatedName,
    detectedLanguage,
    inputTranslateOptions
  };
})(InputTranslateTip)));

/***/ },

/***/ "./src/components/chatAssistant/component/input-translate/input-translate.scss"
/*!*************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-translate/input-translate.scss ***!
  \*************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/input-translate/input-translate.tsx"
/*!************************************************************************************!*\
  !*** ./src/components/chatAssistant/component/input-translate/input-translate.tsx ***!
  \************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _utils_room_input_translate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/room-input-translate */ "./src/components/chatAssistant/utils/room-input-translate.ts");
/* harmony import */ var _input_language_modal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./input-language-modal */ "./src/components/chatAssistant/component/input-translate/input-language-modal.tsx");
/* harmony import */ var _input_translate_open_tip__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./input-translate-open-tip */ "./src/components/chatAssistant/component/input-translate/input-translate-open-tip.tsx");
/* harmony import */ var _input_translate_tip__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./input-translate-tip */ "./src/components/chatAssistant/component/input-translate/input-translate-tip.tsx");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _left_main_hooks_useTranslateTip__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../left/main/hooks/useTranslateTip */ "./src/components/left/main/hooks/useTranslateTip.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_Switcher__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../ui/Switcher */ "./src/components/ui/Switcher.tsx");
/* harmony import */ var _input_translate_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./input-translate.scss */ "./src/components/chatAssistant/component/input-translate/input-translate.scss");
/* harmony import */ var _assets_input_translate_input_png__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../assets/input/translate-input.png */ "./src/components/chatAssistant/assets/input/translate-input.png");















const InputTranslate = ({
  chatId,
  detectedLanguageName,
  inputTranslateOptions,
  theme
}) => {
  const [inputLanguageModalOpen, openInputLanguageModal, closeInputLanguageModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [languageMenuOpen, openLanguageMenu, closeLanguageMenu] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [tooltipOpen, openTooltip, closeTooltip] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const {
    inputTranslateTipOpen,
    closeInputTranslateTip
  } = (0,_left_main_hooks_useTranslateTip__WEBPACK_IMPORTED_MODULE_9__.useTranslateTip)({
    chatId
  });
  const updateRoomInputTranslateConfig = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(options => {
    (0,_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_4__.updateRoomInputTranslateOptions)(chatId, options);
  }, [chatId]);
  const handleAutoTranslateChange = e => {
    updateRoomInputTranslateConfig({
      ...inputTranslateOptions,
      autoTranslate: e.currentTarget.checked
    });
  };
  const handleCloseTooltip = showTurnoffTip => {
    closeInputTranslateTip();
    if (showTurnoffTip) {
      openTooltip();
      setTimeout(() => {
        closeTooltip();
      }, 5000);
    }
  };
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "input-ai-actions relative"
  }, inputTranslateOptions?.autoTranslate ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    className: "Button input-ai-actions-button",
    onClick: openLanguageMenu
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[var(--color-text-secondary)] text-[14px] font-bold"
  }, inputTranslateOptions.translateLanguage.toUpperCase())) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    className: "Button input-ai-actions-button",
    onClick: () => {
      openLanguageMenu();
    }
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: _assets_input_translate_input_png__WEBPACK_IMPORTED_MODULE_14__,
    alt: "Chat AI Logo"
  })), tooltipOpen && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_input_translate_open_tip__WEBPACK_IMPORTED_MODULE_6__["default"], null), inputTranslateTipOpen && /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_input_translate_tip__WEBPACK_IMPORTED_MODULE_7__["default"], {
    chatId: chatId,
    onCLose: handleCloseTooltip
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_11__["default"], {
    noCloseOnBackdrop: false,
    isOpen: languageMenuOpen,
    onClose: closeLanguageMenu,
    className: "input-language-menu",
    positionX: 'right',
    positionY: 'bottom'
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "bg-[var(--color-background)] w-[375px]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "text-[18px] font-semibold text-[var(--color-text)] py-[16px] px-[24px] flex justify-between items-center"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, "Translation Settings"), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_10__["default"], {
    name: "close",
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_3__["default"])('color:#6A7282;font-size:20px;cursor:pointer;'),
    onClick: closeLanguageMenu
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "py-[20px] px-[24px] border-[var(--color-background-secondary)] border-t-[1px] border-b-[1px] flex flex-col gap-[12px]"
  }, detectedLanguageName ? /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "text-[14px]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[#4A5565] dark:text-white"
  }, "TelyAI Detected Language in this chat is in "), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[#007AFF] font-bold dark:text-white"
  }, detectedLanguageName)) : /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "text-[14px]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[#4A5565] dark:text-white"
  }, "No language detected in this chat.")), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "w-full flex items-center justify-between px-[16px] py-[18px] rounded-[12px] bg-[#F7F7F7] dark:bg-[var(--color-chat-hover)]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "text-[16px] text-[var(--color-text)]"
  }, "Auto Translation"), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Switcher__WEBPACK_IMPORTED_MODULE_12__["default"], {
    label: "",
    checked: inputTranslateOptions?.autoTranslate,
    noAnimation: true,
    onChange: handleAutoTranslateChange
  })), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "w-full flex items-center justify-between px-[16px] py-[18px] rounded-[12px] bg-[#F7F7F7] dark:bg-[var(--color-chat-hover)]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "text-[16px] text-[var(--color-text)]"
  }, "Language Setting"), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[16px] font-semibold text-[var(--color-text)]"
  }, inputTranslateOptions.translateLanguageName), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center justify-center ml-auto",
    onClick: openInputLanguageModal
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_10__["default"], {
    name: "arrow-right",
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_3__["default"])(`font-size:20px;color:${theme === 'dark' ? '#fff' : '#007AFF'};`)
  }))))))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_input_language_modal__WEBPACK_IMPORTED_MODULE_5__["default"], {
    inputTranslateOptions: inputTranslateOptions,
    isOpen: inputLanguageModalOpen,
    closeInputLanguageModal: closeInputLanguageModal,
    updateRoomInputTranslateOptions: updateRoomInputTranslateConfig
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId);
  const detectedLanguage = chat?.detectedLanguage;
  const language = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectLanguageCode)(global);
  const translatedNames = new Intl.DisplayNames([language], {
    type: 'language'
  });
  const translatedName = detectedLanguage ? translatedNames.of(detectedLanguage) : undefined;
  const inputTranslateOptions = global.roomInputTranslateOptions[chatId] || {
    translateLanguage: chat?.detectedLanguage || 'en',
    translateLanguageName: translatedName || 'English',
    autoTranslate: false
  };
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTheme)(global);
  return {
    detectedLanguage: chat?.detectedLanguage,
    detectedLanguageName: translatedName,
    inputTranslateOptions,
    theme
  };
})(InputTranslate)));

/***/ },

/***/ "./src/components/chatAssistant/component/message-gpt-menu.scss"
/*!**********************************************************************!*\
  !*** ./src/components/chatAssistant/component/message-gpt-menu.scss ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/component/message-gpt-menu.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/chatAssistant/component/message-gpt-menu.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/subscriptionHandler */ "./src/util/subscriptionHandler.ts");
/* harmony import */ var _utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../utils/ai-analyse-message */ "./src/components/chatAssistant/utils/ai-analyse-message.ts");
/* harmony import */ var _utils_chat_api__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../utils/chat-api */ "./src/components/chatAssistant/utils/chat-api.ts");
/* harmony import */ var _utils_google_api__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../utils/google-api */ "./src/components/chatAssistant/utils/google-api.ts");
/* harmony import */ var _utils_google_auth__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../utils/google-auth */ "./src/components/chatAssistant/utils/google-auth.ts");
/* harmony import */ var _utils_icons__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../utils/icons */ "./src/components/chatAssistant/utils/icons.tsx");
/* harmony import */ var _utils_knowledge_match__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../utils/knowledge-match */ "./src/components/chatAssistant/utils/knowledge-match.ts");
/* harmony import */ var _utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../utils/schedule-meeting */ "./src/components/chatAssistant/utils/schedule-meeting.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _message_gpt_menu_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./message-gpt-menu.scss */ "./src/components/chatAssistant/component/message-gpt-menu.scss");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");



















const menuItemClass = '!w-[20px] !h-[20px] text-[16px] cursor-pointer flex items-center justify-center !p-0 !text-[var(--color-text)]';
const MessageGptMenu = ({
  message,
  position,
  canScheduleMeeting,
  canAISummarize,
  canSmartReply,
  canTranslate,
  canShowOriginal,
  subscriptionType,
  senderName
}) => {
  const canSerenaAI = canScheduleMeeting || canAISummarize || canSmartReply || canTranslate;
  const [isSchedulingMeeting, setIsSchedulingMeeting] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    openPayPackageModal,
    updateDraftReplyInfo,
    openChatAIWithInfo,
    requestMessageTranslation,
    showOriginalMessage
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleScheduleMeeting = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(async () => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_6__.checkCredisBalance)()) {
      openPayPackageModal();
      return;
    }
    if (!subscriptionType || subscriptionType === 'free' || subscriptionType === 'basic') {
      openPayPackageModal();
      return;
    }
    if (isSchedulingMeeting) return;
    const chatId = message.chatId;
    if (_utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_13__["default"].get(chatId)) {
      return;
    }
    setIsSchedulingMeeting(true);
    const targetUserId = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chatId) ? undefined : message.senderId;
    const auth = (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_10__.getAuthState)();
    const startMeeting = () => {
      const scheduleMeeting = _utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_13__["default"].create({
        chatId,
        targetUserId
      });
      scheduleMeeting.handleTargetMessage(message);
      // Reset the flag after a delay to prevent rapid clicks
      setTimeout(() => setIsSchedulingMeeting(false), 2000);
    };
    if (!auth || !(await (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_10__.isTokenValid)(auth))) {
      (0,_utils_google_api__WEBPACK_IMPORTED_MODULE_9__.createAuthConfirmModal)({
        onOk: startMeeting,
        onCancel: () => setIsSchedulingMeeting(false)
      });
    } else {
      startMeeting();
    }
  });
  const handleSmartReply = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(async () => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_6__.checkCredisBalance)()) {
      openPayPackageModal();
      return;
    }
    if (message.content.text?.text) {
      updateDraftReplyInfo({
        replyToMsgId: message.id,
        replyToPeerId: undefined,
        quoteText: undefined,
        quoteOffset: undefined
      });
      const bestMatch = await (0,_utils_knowledge_match__WEBPACK_IMPORTED_MODULE_12__.getBestKnowledgeMatch)(message.content.text.text);
      if (bestMatch && bestMatch.score > 0.8) {
        _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit('update-input-text', bestMatch.answer);
      } else {
        _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit('update-input-spiner', true);
        (0,_utils_chat_api__WEBPACK_IMPORTED_MODULE_8__.autoReply)({
          message: message.content.text?.text,
          message_id: message.id
        }).then(res => {
          _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit('update-input-text', res.data.reply);
        }).catch(() => {
          _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit('update-input-spiner', false);
        });
      }
    }
  });
  const handleSummarize = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_6__.checkCredisBalance)()) {
      openPayPackageModal();
      return;
    }
    const {
      photo,
      document,
      webPage,
      voice,
      audio,
      text,
      video
    } = message.content;
    const isUrl = (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__.checkIsUrl)(text?.text);
    openChatAIWithInfo({
      chatId: message.chatId
    });
    if (photo) {
      (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__.photoSummary)(message);
    } else if (webPage && !text?.text || isUrl) {
      (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__.webPageSummary)(message);
    } else if (document) {
      (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__.documentSummary)(message);
    } else if (voice) {
      (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__.voiceToAudioSummary)(message);
    } else if (audio) {
      (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__.audioSummary)(message);
    } else if (video) {
      (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__.videoSummary)(message);
    }
  });
  const handleAskAi = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_6__.checkCredisBalance)()) {
      openPayPackageModal();
      return;
    }

    // 构建选中消息数组
    const selectedMessages = [{
      messageId: String(message.id),
      content: message.content.text?.text || '',
      senderId: message.senderId || message.chatId,
      senderName: senderName || 'Unknown',
      timestamp: message.date * 1000 // 转换为毫秒
    }];
    openChatAIWithInfo({
      chatId: message.chatId,
      selectedMessages
    });
  });
  const handleTranslate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_6__.checkCredisBalance)()) {
      openPayPackageModal();
      return;
    }
    requestMessageTranslation({
      chatId: message.chatId,
      id: message.id
    });
  });
  const handleShowOriginal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    showOriginalMessage({
      chatId: message.chatId,
      id: message.id
    });
  });
  if (!canSerenaAI) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: `message-gpt-menu z-100 ${position === 'top' ? 'top-[-32px]' : 'bottom-[-32px]'}`
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-gpt-menu-inner"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    color: "translucent",
    size: "tiny",
    ariaLabel: "Ask TelyAI",
    className: menuItemClass,
    onClick: handleAskAi
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: "w-[20px] h-[20px] mt-[-4px]",
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_16__,
    alt: ""
  })), canTranslate && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    color: "translucent",
    size: "tiny",
    ariaLabel: "Translate",
    className: menuItemClass,
    onClick: handleTranslate
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_utils_icons__WEBPACK_IMPORTED_MODULE_11__.AITranslateIcon, {
    size: 16
  })), canShowOriginal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    color: "translucent",
    size: "tiny",
    ariaLabel: "Show original",
    className: menuItemClass,
    onClick: handleShowOriginal
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_utils_icons__WEBPACK_IMPORTED_MODULE_11__.AITranslateIcon, {
    size: 16
  })), canScheduleMeeting && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    color: "translucent",
    size: "tiny",
    ariaLabel: "Schedule meeting",
    className: menuItemClass,
    onClick: handleScheduleMeeting
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_utils_icons__WEBPACK_IMPORTED_MODULE_11__.MeetingIcon, {
    size: 16
  })), canAISummarize && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    color: "translucent",
    size: "tiny",
    ariaLabel: "Summarize",
    className: menuItemClass,
    onClick: handleSummarize
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_utils_icons__WEBPACK_IMPORTED_MODULE_11__.SummarizeIcon, {
    size: 16
  })), canSmartReply && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    color: "translucent",
    size: "tiny",
    ariaLabel: "Smart Reply",
    className: menuItemClass,
    onClick: handleSmartReply
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_utils_icons__WEBPACK_IMPORTED_MODULE_11__.AIReplyIcon, {
    size: 16
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  message,
  messageListType,
  detectedLanguage
}) => {
  const {
    subscriptionInfo
  } = global;
  const {
    subscriptionType
  } = subscriptionInfo;
  const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isOwnMessage)(message);
  const hasTextContent = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.hasMessageText)(message);
  const canAISummarize = (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_7__.canSummarize)(message);
  const isPinned = messageListType === 'pinned';
  const isScheduled = messageListType === 'scheduled';
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, message.chatId);
  const isPrivate = chat && (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chat.id);
  const chatFullInfo = !isPrivate ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatFullInfo)(global, message.chatId) : undefined;
  const {
    threadId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global) || {};
  const {
    canReplyGlobally
  } = threadId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectAllowedMessageActionsSlow)(global, message, threadId) || {};
  const canSendText = chat && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUserRightBanned)(chat, 'sendPlain', chatFullInfo);
  const translationRequestLanguage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectRequestedMessageTranslationLanguage)(global, message.chatId, message.id);
  const hasTranslation = translationRequestLanguage ? Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectMessageTranslations)(global, message.chatId, translationRequestLanguage)[message.id]?.text) : undefined;
  const isChatTranslated = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectRequestedChatTranslationLanguage)(global, message.chatId);
  const canTranslate = !hasTranslation && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanTranslateMessage)(global, message, detectedLanguage);
  const canShowOriginal = hasTranslation && !isChatTranslated;

  // 获取发送者名称
  const sender = message.senderId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, message.senderId) : undefined;
  const senderName = sender ? `${sender.firstName || ''} ${sender.lastName || ''}`.trim() : undefined;
  return {
    message,
    canScheduleMeeting: !isOwn && hasTextContent,
    canAISummarize,
    canSmartReply: !isOwn && !isPinned && !isScheduled && canReplyGlobally && canSendText && hasTextContent,
    canTranslate,
    canShowOriginal,
    subscriptionType,
    senderName
  };
})(MessageGptMenu)));

/***/ },

/***/ "./src/components/chatAssistant/global-summary/DrawerContext.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/DrawerContext.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   DrawerKey: () => (/* binding */ DrawerKey),
/* harmony export */   useDrawerStore: () => (/* binding */ useDrawerStore)
/* harmony export */ });
/* harmony import */ var zustand__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zustand */ "./node_modules/zustand/esm/react.mjs");
// useDrawerStore.ts

let DrawerKey = /*#__PURE__*/function (DrawerKey) {
  DrawerKey["PersonalizeSettings"] = "PersonalizeSettings";
  DrawerKey["OriginalMessages"] = "OriginalMessages";
  DrawerKey["CustomizationPrompt"] = "CustomizationPrompt";
  DrawerKey["ChatPicker"] = "ChatPicker";
  DrawerKey["AddTopicPanel"] = "AddTopicPanel";
  return DrawerKey;
}({});
const useDrawerStore = (0,zustand__WEBPACK_IMPORTED_MODULE_0__.create)(set => ({
  isOpen: false,
  drawerKey: undefined,
  drawerParams: undefined,
  openDrawer: (drawerKey, drawerParams) => set(() => ({
    isOpen: true,
    drawerKey,
    drawerParams
  })),
  closeDrawer: () => set(() => ({
    isOpen: false,
    drawerKey: undefined,
    drawerParams: undefined
  }))
}));

/***/ },

/***/ "./src/components/chatAssistant/global-summary/chat-serana.teact.tsx"
/*!***************************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/chat-serana.teact.tsx ***!
  \***************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hook_useGlobalSummaryBadge__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../hook/useGlobalSummaryBadge */ "./src/components/chatAssistant/hook/useGlobalSummaryBadge.tsx");
/* harmony import */ var _room_storage__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../room-storage */ "./src/components/chatAssistant/room-storage/index.tsx");
/* harmony import */ var _variables__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_ShowTransition__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/ShowTransition */ "./src/components/ui/ShowTransition.tsx");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* eslint-disable max-len */










const ChatSerena = props => {
  const {
    isSelected,
    // frozenNotificationHeight,
    // archiveHeight,
    // unconfirmedSessionHeight,
    offsetTop
  } = props;
  // const offsetTop = frozenNotificationHeight + archiveHeight + unconfirmedSessionHeight;
  const {
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const chatClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('Chat chat-item-clickable', isSelected && 'selected');
  const unreadCount = (0,_hook_useGlobalSummaryBadge__WEBPACK_IMPORTED_MODULE_4__.useGlobalSummaryBadge)();
  const handleClick = () => {
    openChat({
      id: _variables__WEBPACK_IMPORTED_MODULE_6__.GLOBAL_SUMMARY_CHATID
    });
    _room_storage__WEBPACK_IMPORTED_MODULE_5__["default"].updateRoomAIData(_variables__WEBPACK_IMPORTED_MODULE_6__.GLOBAL_SUMMARY_CHATID, 'unreadCount', 0);
  };
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_7__["default"], {
    className: chatClassName,
    key: _variables__WEBPACK_IMPORTED_MODULE_6__.GLOBAL_SUMMARY_CHATID,
    style: `top: ${offsetTop}px`
    // eslint-disable-next-line react/jsx-no-bind
    ,
    onClick: handleClick,
    withPortalForMenu: true
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: "w-[54px] h-[54px] rounded-full mr-[12px]",
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_9__,
    alt: "TelyAI"
  }), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info-row"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title FullNameTitle-module__root"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    dir: "auto",
    role: "button",
    className: "fullName FullNameTitle-module__fullName"
  }, "TelyAI"))), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "subtitle"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "last-message shared-canvas-container",
    dir: "ltr"
  }, "Chat Summary"), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ShowTransition__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isCustom: true,
    className: "ChatBadge-transition",
    isOpen: unreadCount > 0
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "ChatBadge unread"
  }, unreadCount)))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    chatId: currentChatId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectCurrentMessageList)(global) || {};
  const isSelected = _variables__WEBPACK_IMPORTED_MODULE_6__.GLOBAL_SUMMARY_CHATID === currentChatId;
  return {
    isSelected
  };
})(ChatSerena)));

/***/ },

/***/ "./src/components/chatAssistant/global-summary/summary-utils.ts"
/*!**********************************************************************!*\
  !*** ./src/components/chatAssistant/global-summary/summary-utils.ts ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   createGlobalIntroduceMessage: () => (/* binding */ createGlobalIntroduceMessage),
/* harmony export */   createIntroduceActionsMessage: () => (/* binding */ createIntroduceActionsMessage),
/* harmony export */   createIntroduceMeetingMessage: () => (/* binding */ createIntroduceMeetingMessage),
/* harmony export */   createIntroduceSummaryMessage: () => (/* binding */ createIntroduceSummaryMessage),
/* harmony export */   createIntroduceTranslationMessage: () => (/* binding */ createIntroduceTranslationMessage)
/* harmony export */ });
/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! uuid */ "./node_modules/uuid/dist/esm-browser/v4.js");
/* harmony import */ var _messages_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../messages/types */ "./src/components/chatAssistant/messages/types.ts");


const createIntroduceMeetingMessage = () => {
  return {
    timestamp: new Date().getTime(),
    content: '',
    id: (0,uuid__WEBPACK_IMPORTED_MODULE_0__["default"])(),
    createdAt: new Date(),
    role: 'teleai-system',
    type: _messages_types__WEBPACK_IMPORTED_MODULE_1__.AIMessageType.MeetingIntroduce
  };
};
const createIntroduceSummaryMessage = () => {
  return {
    timestamp: new Date().getTime(),
    content: '',
    id: (0,uuid__WEBPACK_IMPORTED_MODULE_0__["default"])(),
    createdAt: new Date(),
    role: 'teleai-system',
    type: _messages_types__WEBPACK_IMPORTED_MODULE_1__.AIMessageType.SummaryIntroduce
  };
};
const createIntroduceTranslationMessage = () => {
  return {
    timestamp: new Date().getTime(),
    content: '',
    id: (0,uuid__WEBPACK_IMPORTED_MODULE_0__["default"])(),
    createdAt: new Date(),
    role: 'teleai-system',
    type: _messages_types__WEBPACK_IMPORTED_MODULE_1__.AIMessageType.TranslationIntroduce
  };
};
const createIntroduceActionsMessage = () => {
  return {
    timestamp: new Date().getTime(),
    content: '',
    id: (0,uuid__WEBPACK_IMPORTED_MODULE_0__["default"])(),
    createdAt: new Date(),
    role: 'teleai-system',
    type: _messages_types__WEBPACK_IMPORTED_MODULE_1__.AIMessageType.ActionsIntroduce
  };
};
const createGlobalIntroduceMessage = () => {
  return {
    timestamp: new Date().getTime(),
    content: '',
    id: 'intro-message-global-summary',
    // 使用固定的特殊 ID
    createdAt: new Date(),
    role: 'teleai-system',
    type: _messages_types__WEBPACK_IMPORTED_MODULE_1__.AIMessageType.GlobalIntroduce
  };
};

/***/ },

/***/ "./src/components/chatAssistant/hook/use-messages.tsx"
/*!************************************************************!*\
  !*** ./src/components/chatAssistant/hook/use-messages.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useMessages: () => (/* binding */ useMessages)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./use-scroll-to-bottom */ "./src/components/chatAssistant/hook/use-scroll-to-bottom.tsx");


function scrollUntilStable({
  container,
  scrollToBottom,
  maxAttempts = 30,
  interval = 50
}) {
  let lastScrollHeight = container.scrollHeight;
  let attempts = 0;
  const tick = () => {
    const current = container.scrollHeight;
    if (current !== lastScrollHeight) {
      scrollToBottom('instant');
      lastScrollHeight = current;
      attempts = 0; // reset
    } else {
      attempts++;
    }
    if (attempts < maxAttempts) {
      requestAnimationFrame(() => setTimeout(tick, interval));
    }
  };
  tick();
}
function useMessages({
  chatId,
  status
}) {
  const {
    containerRef,
    endRef,
    isAtBottom,
    scrollToBottom,
    onViewportEnter,
    onViewportLeave
  } = (0,_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_1__.useScrollToBottom)();
  const hasScrollToBottom = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const [hasSentMessage, setHasSentMessage] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (status === 'submitted') {
      setHasSentMessage(true);
    }
  }, [status]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!hasScrollToBottom.current && containerRef.current) {
      scrollUntilStable({
        container: containerRef.current,
        scrollToBottom
      });
      hasScrollToBottom.current = true;
    }
  }, [containerRef, scrollToBottom]);
  return {
    containerRef,
    endRef,
    isAtBottom,
    scrollToBottom,
    onViewportEnter,
    onViewportLeave,
    hasSentMessage
  };
}

/***/ },

/***/ "./src/components/chatAssistant/hook/use-scroll-to-bottom.tsx"
/*!********************************************************************!*\
  !*** ./src/components/chatAssistant/hook/use-scroll-to-bottom.tsx ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useScrollToBottom: () => (/* binding */ useScrollToBottom)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var swr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! swr */ "./node_modules/swr/dist/index/index.mjs");
/* eslint-disable max-len */
/* eslint-disable no-null/no-null */


function useScrollToBottom() {
  const containerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const endRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const {
    data: isScrollLock = false,
    mutate: setIsScrollLock
  } = (0,swr__WEBPACK_IMPORTED_MODULE_1__["default"])('messages:is-scroll-lock', null, {
    fallbackData: false
  });
  const {
    data: isAtBottom = false,
    mutate: setIsAtBottom
  } = (0,swr__WEBPACK_IMPORTED_MODULE_1__["default"])('messages:is-at-bottom', null, {
    fallbackData: false
  });
  const {
    data: scrollBehavior = false,
    mutate: setScrollBehavior
  } = (0,swr__WEBPACK_IMPORTED_MODULE_1__["default"])('messages:should-scroll', null, {
    fallbackData: false
  });
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (scrollBehavior && !isScrollLock) {
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          endRef.current?.scrollIntoView({
            behavior: scrollBehavior
          });
          setScrollBehavior(false);
        });
      });
    }
  }, [setScrollBehavior, scrollBehavior, isScrollLock]);
  const scrollToBottom = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((scrollBehavior = 'smooth') => {
    setIsScrollLock(false);
    setScrollBehavior(scrollBehavior);
  }, [setIsScrollLock, setScrollBehavior]);
  const scrollLocked = () => {
    setIsScrollLock(true);
  };
  const scrollUnLocked = () => {
    setIsScrollLock(false);
  };
  function onViewportEnter() {
    setIsAtBottom(true);
  }
  function onViewportLeave() {
    setIsAtBottom(false);
  }
  return {
    containerRef,
    endRef,
    isAtBottom,
    isScrollLock,
    scrollToBottom,
    onViewportEnter,
    onViewportLeave,
    scrollLocked,
    scrollUnLocked
  };
}

/***/ },

/***/ "./src/components/chatAssistant/hook/useEventBusTeact.ts"
/*!***************************************************************!*\
  !*** ./src/components/chatAssistant/hook/useEventBusTeact.ts ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   emitEventTeact: () => (/* binding */ emitEventTeact),
/* harmony export */   useEventListenerTeact: () => (/* binding */ useEventListenerTeact)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");


function useEventListenerTeact(event, handler, deps = []) {
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__["default"].on(event, handler);
    return () => _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__["default"].off(event, handler);
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, deps);
}
function emitEventTeact(event, payload) {
  _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__["default"].emit(event, payload);
}

/***/ },

/***/ "./src/components/chatAssistant/hook/useGlobalSummaryBadge.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/chatAssistant/hook/useGlobalSummaryBadge.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useGlobalSummaryBadge: () => (/* binding */ useGlobalSummaryBadge)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _variables__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");




function useGlobalSummaryBadge() {
  const [unreadCount, setUnreadCount] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const updateUnreadCount = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(param => {
    if (param.chatId === _variables__WEBPACK_IMPORTED_MODULE_2__.GLOBAL_SUMMARY_CHATID) {
      setUnreadCount(param.count);
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const roomAIData = localStorage.getItem('room-ai-data');
    const count = roomAIData ? JSON.parse(roomAIData)?.[_variables__WEBPACK_IMPORTED_MODULE_2__.GLOBAL_SUMMARY_CHATID]?.unreadCount || 0 : 0;
    setUnreadCount(count);
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__["default"].on(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__.Actions.UpdateRoomAIUnreadCount, updateUnreadCount);
    return () => {
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__["default"].off(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_1__.Actions.UpdateRoomAIUnreadCount, updateUnreadCount);
    };
  }, []);
  return unreadCount;
}

/***/ },

/***/ "./src/components/chatAssistant/hook/useMessageGptMenuHandlers.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/chatAssistant/hook/useMessageGptMenuHandlers.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");

const useMessageGptMenuHandlers = elementRef => {
  const [isGptMenuOpen, setIsGptMenuOpen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [gptMenuPosition, setGptMenuPosition] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('bottom');
  const [isScrolling, setIsScrolling] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    // eslint-disable-next-line no-null/no-null
    let scrollTimeout = null;
    const onScroll = () => {
      setIsScrolling(true);
      if (scrollTimeout) window.clearTimeout(scrollTimeout);
      scrollTimeout = window.setTimeout(() => {
        setIsScrolling(false);
      }, 200);
    };
    window.addEventListener('scroll', onScroll, true); // 监听冒泡阶段的滚动事件

    return () => {
      window.removeEventListener('scroll', onScroll, true);
      if (scrollTimeout) window.clearTimeout(scrollTimeout);
    };
  }, []);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const el = elementRef?.current;
    if (!el) return undefined;
    const handleMouseEnter = () => {
      if (isScrolling) return;
      const rect = el.getBoundingClientRect();
      const distanceToBottom = window.innerHeight - rect.bottom;
      if (distanceToBottom < 150) {
        setGptMenuPosition('top');
      } else {
        setGptMenuPosition('bottom');
      }
      setIsGptMenuOpen(true);
    };
    const handleMouseLeave = () => setIsGptMenuOpen(false);
    el.addEventListener('mouseenter', handleMouseEnter);
    el.addEventListener('mouseleave', handleMouseLeave);
    return () => {
      el.removeEventListener('mouseenter', handleMouseEnter);
      el.removeEventListener('mouseleave', handleMouseLeave);
    };
  }, [elementRef, isScrolling]);
  return {
    isGptMenuOpen,
    gptMenuPosition
  };
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useMessageGptMenuHandlers);

/***/ },

/***/ "./src/components/chatAssistant/hook/usePerformanceMonitor.ts"
/*!********************************************************************!*\
  !*** ./src/components/chatAssistant/hook/usePerformanceMonitor.ts ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   clearPerformanceMetrics: () => (/* binding */ clearPerformanceMetrics),
/* harmony export */   getPerformanceMetrics: () => (/* binding */ getPerformanceMetrics),
/* harmony export */   printPerformanceReport: () => (/* binding */ printPerformanceReport),
/* harmony export */   usePerformanceMonitor: () => (/* binding */ usePerformanceMonitor)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* eslint-disable no-console */

const performanceMetrics = new Map();

/**
 * 性能监控 Hook
 * 用于检测组件渲染性能问题
 *
 * @param componentName - 组件名称
 * @param options - 配置选项
 * @param options.enabled - 是否启用监控（默认仅在开发环境启用）
 * @param options.logThreshold - 渲染次数超过此值时打印警告（默认 50）
 * @param options.slowRenderThreshold - 渲染时间超过此值（ms）时打印警告（默认 16）
 *
 * @example
 * function MyComponent() {
 *   usePerformanceMonitor('MyComponent', { logThreshold: 30 });
 *   // ...
 * }
 */
function usePerformanceMonitor(componentName, options = {}) {
  const {
    enabled = "development" === 'development',
    logThreshold = 50,
    slowRenderThreshold = 16 // 60fps = 16.67ms per frame
  } = options;
  const renderStartTime = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(performance.now());
  const renderCount = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
  if (!enabled) return;

  // 记录渲染开始时间
  renderStartTime.current = performance.now();
  renderCount.current += 1;
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    // 计算渲染时间
    const renderTime = performance.now() - renderStartTime.current;

    // 获取或创建性能指标
    const metrics = performanceMetrics.get(componentName) || {
      componentName,
      renderCount: 0,
      lastRenderTime: 0,
      averageRenderTime: 0,
      maxRenderTime: 0
    };

    // 更新指标
    metrics.renderCount = renderCount.current;
    metrics.lastRenderTime = renderTime;
    metrics.maxRenderTime = Math.max(metrics.maxRenderTime, renderTime);
    metrics.averageRenderTime = (metrics.averageRenderTime * (metrics.renderCount - 1) + renderTime) / metrics.renderCount;
    performanceMetrics.set(componentName, metrics);

    // 检测渲染次数过多
    if (renderCount.current % logThreshold === 0) {
      console.warn(`[Performance Warning] ${componentName} 已渲染 ${renderCount.current} 次`, {
        averageRenderTime: `${metrics.averageRenderTime.toFixed(2)}ms`,
        maxRenderTime: `${metrics.maxRenderTime.toFixed(2)}ms`,
        lastRenderTime: `${renderTime.toFixed(2)}ms`
      });
    }

    // 检测慢渲染
    if (renderTime > slowRenderThreshold) {
      console.warn(`[Performance Warning] ${componentName} 渲染缓慢: ${renderTime.toFixed(2)}ms (第 ${renderCount.current} 次渲染)`);
    }
  });
}

/**
 * 获取所有性能指标
 */
function getPerformanceMetrics() {
  return performanceMetrics;
}

/**
 * 打印性能报告
 */
function printPerformanceReport() {
  console.group('📊 性能监控报告');
  const sortedMetrics = Array.from(performanceMetrics.entries()).sort((a, b) => b[1].renderCount - a[1].renderCount);
  sortedMetrics.forEach(([name, metrics]) => {
    console.log(`\n🔹 ${name}:`);
    console.log(`  渲染次数: ${metrics.renderCount}`);
    console.log(`  平均渲染时间: ${metrics.averageRenderTime.toFixed(2)}ms`);
    console.log(`  最大渲染时间: ${metrics.maxRenderTime.toFixed(2)}ms`);
    console.log(`  最近渲染时间: ${metrics.lastRenderTime.toFixed(2)}ms`);

    // 标记性能问题
    if (metrics.renderCount > 100) {
      console.warn(`  ⚠️ 渲染次数过多，可能存在不必要的重渲染`);
    }
    if (metrics.averageRenderTime > 16) {
      console.warn(`  ⚠️ 平均渲染时间较长，可能影响用户体验`);
    }
  });
  console.groupEnd();
}

/**
 * 清除性能指标
 */
function clearPerformanceMetrics() {
  performanceMetrics.clear();
  console.log('✅ 性能指标已清除');
}

// 在浏览器控制台中暴露全局函数
if (typeof window !== 'undefined') {
  window.__printPerformanceReport = printPerformanceReport;
  window.__clearPerformanceMetrics = clearPerformanceMetrics;
  window.__getPerformanceMetrics = getPerformanceMetrics;
  console.log('💡 性能监控工具已加载。使用以下命令：\n' + '  __printPerformanceReport() - 打印性能报告\n' + '  __clearPerformanceMetrics() - 清除性能指标\n' + '  __getPerformanceMetrics() - 获取所有指标');
}

/***/ },

/***/ "./src/components/chatAssistant/hook/useSpeechPlayer.ts"
/*!**************************************************************!*\
  !*** ./src/components/chatAssistant/hook/useSpeechPlayer.ts ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useSpeechPlayer: () => (/* binding */ useSpeechPlayer)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* eslint-disable no-null/no-null */

let activeId = null;
const listeners = {};
function useSpeechPlayer(id) {
  const [isSpeaking, setIsSpeaking] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const localUtteranceRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);

  // 注册播放状态监听
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    listeners[id] = playing => setIsSpeaking(playing);
    return () => {
      delete listeners[id];
    };
  }, [id]);
  const speak = (text, options = {}) => {
    // 先取消全局语音
    if (speechSynthesis.speaking || speechSynthesis.pending) {
      speechSynthesis.cancel();
    }
    const utterance = new SpeechSynthesisUtterance(text);
    Object.assign(utterance, options);
    activeId = id;
    localUtteranceRef.current = utterance;
    utterance.onend = () => {
      if (activeId === id) {
        listeners[id]?.(false);
        activeId = null;
      }
    };
    utterance.onerror = () => {
      if (activeId === id) {
        listeners[id]?.(false);
        activeId = null;
      }
    };

    // 设置本组件为 speaking，其它都设为 false
    Object.entries(listeners).forEach(([key, fn]) => fn(key === id));
    speechSynthesis.speak(utterance);
  };
  const stop = () => {
    if (activeId === id && (speechSynthesis.speaking || speechSynthesis.pending)) {
      speechSynthesis.cancel();
      listeners[id]?.(false);
      activeId = null;
    }
  };
  return {
    isSpeaking,
    speak,
    stop
  };
}

/***/ },

/***/ "./src/components/chatAssistant/icons.tsx"
/*!************************************************!*\
  !*** ./src/components/chatAssistant/icons.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ArrowRightIcon: () => (/* binding */ ArrowRightIcon),
/* harmony export */   ArrowUpIcon: () => (/* binding */ ArrowUpIcon),
/* harmony export */   AttachmentIcon: () => (/* binding */ AttachmentIcon),
/* harmony export */   BotIcon: () => (/* binding */ BotIcon),
/* harmony export */   BoxIcon: () => (/* binding */ BoxIcon),
/* harmony export */   CheckCircleFillIcon: () => (/* binding */ CheckCircleFillIcon),
/* harmony export */   CheckedSquare: () => (/* binding */ CheckedSquare),
/* harmony export */   ChevronDownIcon: () => (/* binding */ ChevronDownIcon),
/* harmony export */   ClockRewind: () => (/* binding */ ClockRewind),
/* harmony export */   CloseIcon: () => (/* binding */ CloseIcon),
/* harmony export */   CodeIcon: () => (/* binding */ CodeIcon),
/* harmony export */   CopyIcon: () => (/* binding */ CopyIcon),
/* harmony export */   CrossIcon: () => (/* binding */ CrossIcon),
/* harmony export */   CrossSmallIcon: () => (/* binding */ CrossSmallIcon),
/* harmony export */   DeleteIcon: () => (/* binding */ DeleteIcon),
/* harmony export */   DeltaIcon: () => (/* binding */ DeltaIcon),
/* harmony export */   DownloadIcon: () => (/* binding */ DownloadIcon),
/* harmony export */   EyeIcon: () => (/* binding */ EyeIcon),
/* harmony export */   FileIcon: () => (/* binding */ FileIcon),
/* harmony export */   FullscreenIcon: () => (/* binding */ FullscreenIcon),
/* harmony export */   GPSIcon: () => (/* binding */ GPSIcon),
/* harmony export */   GitIcon: () => (/* binding */ GitIcon),
/* harmony export */   GlobeIcon: () => (/* binding */ GlobeIcon),
/* harmony export */   HomeIcon: () => (/* binding */ HomeIcon),
/* harmony export */   ImageIcon: () => (/* binding */ ImageIcon),
/* harmony export */   InfoIcon: () => (/* binding */ InfoIcon),
/* harmony export */   InvoiceIcon: () => (/* binding */ InvoiceIcon),
/* harmony export */   LanguageIcon: () => (/* binding */ LanguageIcon),
/* harmony export */   LeftOutlined: () => (/* binding */ LeftOutlined),
/* harmony export */   LineChartIcon: () => (/* binding */ LineChartIcon),
/* harmony export */   LoaderIcon: () => (/* binding */ LoaderIcon),
/* harmony export */   LoadingIcon: () => (/* binding */ LoadingIcon),
/* harmony export */   LockIcon: () => (/* binding */ LockIcon),
/* harmony export */   LogoAnthropic: () => (/* binding */ LogoAnthropic),
/* harmony export */   LogoGoogle: () => (/* binding */ LogoGoogle),
/* harmony export */   LogoOpenAI: () => (/* binding */ LogoOpenAI),
/* harmony export */   LogsIcon: () => (/* binding */ LogsIcon),
/* harmony export */   MenuIcon: () => (/* binding */ MenuIcon),
/* harmony export */   MessageIcon: () => (/* binding */ MessageIcon),
/* harmony export */   MessageShareIcon: () => (/* binding */ MessageShareIcon),
/* harmony export */   MoreHorizontalIcon: () => (/* binding */ MoreHorizontalIcon),
/* harmony export */   MoreIcon: () => (/* binding */ MoreIcon),
/* harmony export */   PaperclipIcon: () => (/* binding */ PaperclipIcon),
/* harmony export */   PenIcon: () => (/* binding */ PenIcon),
/* harmony export */   PencilEditIcon: () => (/* binding */ PencilEditIcon),
/* harmony export */   PlayIcon: () => (/* binding */ PlayIcon),
/* harmony export */   PlusIcon: () => (/* binding */ PlusIcon),
/* harmony export */   PythonIcon: () => (/* binding */ PythonIcon),
/* harmony export */   RedoIcon: () => (/* binding */ RedoIcon),
/* harmony export */   RetryIcon: () => (/* binding */ RetryIcon),
/* harmony export */   RightOutlined: () => (/* binding */ RightOutlined),
/* harmony export */   RouteIcon: () => (/* binding */ RouteIcon),
/* harmony export */   SendIcon: () => (/* binding */ SendIcon),
/* harmony export */   SettingIcon: () => (/* binding */ SettingIcon),
/* harmony export */   ShareIcon: () => (/* binding */ ShareIcon),
/* harmony export */   SidebarLeftIcon: () => (/* binding */ SidebarLeftIcon),
/* harmony export */   StopIcon: () => (/* binding */ StopIcon),
/* harmony export */   SummarizeIcon: () => (/* binding */ SummarizeIcon),
/* harmony export */   TerminalIcon: () => (/* binding */ TerminalIcon),
/* harmony export */   TerminalWindowIcon: () => (/* binding */ TerminalWindowIcon),
/* harmony export */   ThumbDownIcon: () => (/* binding */ ThumbDownIcon),
/* harmony export */   ThumbUpIcon: () => (/* binding */ ThumbUpIcon),
/* harmony export */   TrashIcon: () => (/* binding */ TrashIcon),
/* harmony export */   UncheckedSquare: () => (/* binding */ UncheckedSquare),
/* harmony export */   UndoIcon: () => (/* binding */ UndoIcon),
/* harmony export */   UploadIcon: () => (/* binding */ UploadIcon),
/* harmony export */   UserIcon: () => (/* binding */ UserIcon),
/* harmony export */   VercelIcon: () => (/* binding */ VercelIcon),
/* harmony export */   VoiceIcon: () => (/* binding */ VoiceIcon),
/* harmony export */   VoiceingIcon: () => (/* binding */ VoiceingIcon)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);

const BotIcon = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: "16",
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: "16",
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M8.75 2.79933C9.19835 2.53997 9.5 2.05521 9.5 1.5C9.5 0.671573 8.82843 0 8 0C7.17157 0 6.5 0.671573 6.5 1.5C6.5 2.05521 6.80165 2.53997 7.25 2.79933V5H7C4.027 5 1.55904 7.16229 1.08296 10H0V13H1V14.5V16H2.5H13.5H15V14.5V13H16V10H14.917C14.441 7.16229 11.973 5 9 5H8.75V2.79933ZM7 6.5C4.51472 6.5 2.5 8.51472 2.5 11V14.5H13.5V11C13.5 8.51472 11.4853 6.5 9 6.5H7ZM7.25 11.25C7.25 12.2165 6.4665 13 5.5 13C4.5335 13 3.75 12.2165 3.75 11.25C3.75 10.2835 4.5335 9.5 5.5 9.5C6.4665 9.5 7.25 10.2835 7.25 11.25ZM10.5 13C11.4665 13 12.25 12.2165 12.25 11.25C12.25 10.2835 11.4665 9.5 10.5 9.5C9.5335 9.5 8.75 10.2835 8.75 11.25C8.75 12.2165 9.5335 13 10.5 13Z",
    fill: "currentColor"
  }));
};
const UserIcon = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    "data-testid": "geist-icon",
    height: "16",
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: "16",
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M7.75 0C5.95507 0 4.5 1.45507 4.5 3.25V3.75C4.5 5.54493 5.95507 7 7.75 7H8.25C10.0449 7 11.5 5.54493 11.5 3.75V3.25C11.5 1.45507 10.0449 0 8.25 0H7.75ZM6 3.25C6 2.2835 6.7835 1.5 7.75 1.5H8.25C9.2165 1.5 10 2.2835 10 3.25V3.75C10 4.7165 9.2165 5.5 8.25 5.5H7.75C6.7835 5.5 6 4.7165 6 3.75V3.25ZM2.5 14.5V13.1709C3.31958 11.5377 4.99308 10.5 6.82945 10.5H9.17055C11.0069 10.5 12.6804 11.5377 13.5 13.1709V14.5H2.5ZM6.82945 9C4.35483 9 2.10604 10.4388 1.06903 12.6857L1 12.8353V13V15.25V16H1.75H14.25H15V15.25V13V12.8353L14.931 12.6857C13.894 10.4388 11.6452 9 9.17055 9H6.82945Z",
    fill: "currentColor"
  }));
};
const AttachmentIcon = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: "16",
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: "16",
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M14.5 6.5V13.5C14.5 14.8807 13.3807 16 12 16H4C2.61929 16 1.5 14.8807 1.5 13.5V1.5V0H3H8H9.08579C9.351 0 9.60536 0.105357 9.79289 0.292893L14.2071 4.70711C14.3946 4.89464 14.5 5.149 14.5 5.41421V6.5ZM13 6.5V13.5C13 14.0523 12.5523 14.5 12 14.5H4C3.44772 14.5 3 14.0523 3 13.5V1.5H8V5V6.5H9.5H13ZM9.5 2.12132V5H12.3787L9.5 2.12132Z",
    fill: "currentColor"
  }));
};
const VercelIcon = ({
  size = 17
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M8 1L16 15H0L8 1Z",
    fill: "currentColor"
  }));
};
const GitIcon = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: "16",
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: "16",
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("g", {
    clipPath: "url(#clip0_872_3147)"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M8 0C3.58 0 0 3.57879 0 7.99729C0 11.5361 2.29 14.5251 5.47 15.5847C5.87 15.6547 6.02 15.4148 6.02 15.2049C6.02 15.0149 6.01 14.3851 6.01 13.7154C4 14.0852 3.48 13.2255 3.32 12.7757C3.23 12.5458 2.84 11.836 2.5 11.6461C2.22 11.4961 1.82 11.1262 2.49 11.1162C3.12 11.1062 3.57 11.696 3.72 11.936C4.44 13.1455 5.59 12.8057 6.05 12.5957C6.12 12.0759 6.33 11.726 6.56 11.5261C4.78 11.3262 2.92 10.6364 2.92 7.57743C2.92 6.70773 3.23 5.98797 3.74 5.42816C3.66 5.22823 3.38 4.40851 3.82 3.30888C3.82 3.30888 4.49 3.09895 6.02 4.1286C6.66 3.94866 7.34 3.85869 8.02 3.85869C8.7 3.85869 9.38 3.94866 10.02 4.1286C11.55 3.08895 12.22 3.30888 12.22 3.30888C12.66 4.40851 12.38 5.22823 12.3 5.42816C12.81 5.98797 13.12 6.69773 13.12 7.57743C13.12 10.6464 11.25 11.3262 9.47 11.5261C9.76 11.776 10.01 12.2558 10.01 13.0056C10.01 14.0752 10 14.9349 10 15.2049C10 15.4148 10.15 15.6647 10.55 15.5847C12.1381 15.0488 13.5182 14.0284 14.4958 12.6673C15.4735 11.3062 15.9996 9.67293 16 7.99729C16 3.57879 12.42 0 8 0Z",
    fill: "currentColor"
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("defs", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("clipPath", {
    id: "clip0_872_3147"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("rect", {
    width: "16",
    height: "16",
    fill: "white"
  }))));
};
const BoxIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M8 0.154663L8.34601 0.334591L14.596 3.58459L15 3.79466V4.25V11.75V12.2053L14.596 12.4154L8.34601 15.6654L8 15.8453L7.65399 15.6654L1.40399 12.4154L1 12.2053V11.75V4.25V3.79466L1.40399 3.58459L7.65399 0.334591L8 0.154663ZM2.5 11.2947V5.44058L7.25 7.81559V13.7647L2.5 11.2947ZM8.75 13.7647L13.5 11.2947V5.44056L8.75 7.81556V13.7647ZM8 1.84534L12.5766 4.22519L7.99998 6.51352L3.42335 4.2252L8 1.84534Z",
    fill: "currentColor"
  }));
};
const HomeIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M12.5 6.56062L8.00001 2.06062L3.50001 6.56062V13.5L6.00001 13.5V11C6.00001 9.89539 6.89544 8.99996 8.00001 8.99996C9.10458 8.99996 10 9.89539 10 11V13.5L12.5 13.5V6.56062ZM13.78 5.71933L8.70711 0.646409C8.31659 0.255886 7.68342 0.255883 7.2929 0.646409L2.21987 5.71944C2.21974 5.71957 2.21961 5.7197 2.21949 5.71982L0.469676 7.46963L-0.0606537 7.99996L1.00001 9.06062L1.53034 8.53029L2.00001 8.06062V14.25V15H2.75001L6.00001 15H7.50001H8.50001H10L13.25 15H14V14.25V8.06062L14.4697 8.53029L15 9.06062L16.0607 7.99996L15.5303 7.46963L13.7806 5.71993C13.7804 5.71973 13.7802 5.71953 13.78 5.71933ZM8.50001 11V13.5H7.50001V11C7.50001 10.7238 7.72386 10.5 8.00001 10.5C8.27615 10.5 8.50001 10.7238 8.50001 11Z",
    fill: "currentColor"
  }));
};
const GPSIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M1 6L15 1L10 15L7.65955 8.91482C7.55797 8.65073 7.34927 8.44203 7.08518 8.34045L1 6Z",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "bevel",
    fill: "transparent"
  }));
};
const InvoiceIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M13 15.1L12 14.5L10.1524 15.8857C10.0621 15.9534 9.93791 15.9534 9.8476 15.8857L8 14.5L6.14377 15.8922C6.05761 15.9568 5.94008 15.9601 5.85047 15.9003L3.75 14.5L3 15L2.83257 15.1116L1.83633 15.7758L1.68656 15.8756C1.60682 15.9288 1.5 15.8716 1.5 15.7758V15.5958V14.3985V14.1972V1.5V0H3H8H9.08579C9.351 0 9.60536 0.105357 9.79289 0.292893L14.2071 4.70711C14.3946 4.89464 14.5 5.149 14.5 5.41421V6.5V14.2507V14.411V15.5881V15.7881C14.5 15.8813 14.3982 15.9389 14.3183 15.891L14.1468 15.7881L13.1375 15.1825L13 15.1ZM12.3787 5L9.5 2.12132V5H12.3787ZM8 1.5V5V6.5H9.5H13V13.3507L12.7717 13.2138L11.9069 12.6948L11.1 13.3L10 14.125L8.9 13.3L8 12.625L7.1 13.3L5.94902 14.1632L4.58205 13.2519L3.75 12.6972L3 13.1972V1.5H8Z",
    fill: "currentColor"
  }));
};
const LogoOpenAI = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M14.9449 6.54871C15.3128 5.45919 15.1861 4.26567 14.5978 3.27464C13.7131 1.75461 11.9345 0.972595 10.1974 1.3406C9.42464 0.481584 8.3144 -0.00692594 7.15045 7.42132e-05C5.37487 -0.00392587 3.79946 1.1241 3.2532 2.79113C2.11256 3.02164 1.12799 3.72615 0.551837 4.72468C-0.339497 6.24071 -0.1363 8.15175 1.05451 9.45178C0.686626 10.5413 0.813308 11.7348 1.40162 12.7258C2.28637 14.2459 4.06498 15.0279 5.80204 14.6599C6.5743 15.5189 7.68504 16.0074 8.849 15.9999C10.6256 16.0044 12.2015 14.8754 12.7478 13.2069C13.8884 12.9764 14.873 12.2718 15.4491 11.2733C16.3394 9.75728 16.1357 7.84774 14.9454 6.54771L14.9449 6.54871ZM8.85001 14.9544C8.13907 14.9554 7.45043 14.7099 6.90468 14.2604C6.92951 14.2474 6.97259 14.2239 7.00046 14.2069L10.2293 12.3668C10.3945 12.2743 10.4959 12.1008 10.4949 11.9133V7.42173L11.8595 8.19925C11.8742 8.20625 11.8838 8.22025 11.8858 8.23625V11.9558C11.8838 13.6099 10.5263 14.9509 8.85001 14.9544ZM2.32133 12.2028C1.9651 11.5958 1.8369 10.8843 1.95902 10.1938C1.98284 10.2078 2.02489 10.2333 2.05479 10.2503L5.28366 12.0903C5.44733 12.1848 5.65003 12.1848 5.81421 12.0903L9.75604 9.84429V11.3993C9.75705 11.4153 9.74945 11.4308 9.73678 11.4408L6.47295 13.3004C5.01915 14.1264 3.1625 13.6354 2.32184 12.2028H2.32133ZM1.47155 5.24819C1.82626 4.64017 2.38619 4.17516 3.05305 3.93366C3.05305 3.96116 3.05152 4.00966 3.05152 4.04366V7.72424C3.05051 7.91124 3.15186 8.08475 3.31654 8.17725L7.25838 10.4228L5.89376 11.2003C5.88008 11.2093 5.86285 11.2108 5.84765 11.2043L2.58331 9.34327C1.13255 8.51426 0.63494 6.68272 1.47104 5.24869L1.47155 5.24819ZM12.6834 7.82274L8.74157 5.57669L10.1062 4.79968C10.1199 4.79068 10.1371 4.78918 10.1523 4.79568L13.4166 6.65522C14.8699 7.48373 15.3681 9.31827 14.5284 10.7523C14.1732 11.3593 13.6138 11.8243 12.9474 12.0663V8.27575C12.9489 8.08875 12.8481 7.91574 12.6839 7.82274H12.6834ZM14.0414 5.8057C14.0176 5.7912 13.9756 5.7662 13.9457 5.7492L10.7168 3.90916C10.5531 3.81466 10.3504 3.81466 10.1863 3.90916L6.24442 6.15521V4.60017C6.2434 4.58417 6.251 4.56867 6.26367 4.55867L9.52751 2.70063C10.9813 1.87311 12.84 2.36563 13.6781 3.80066C14.0323 4.40667 14.1605 5.11618 14.0404 5.8057H14.0414ZM5.50257 8.57726L4.13744 7.79974C4.12275 7.79274 4.11312 7.77874 4.11109 7.76274V4.04316C4.11211 2.38713 5.47368 1.0451 7.15197 1.0461C7.86189 1.0461 8.54902 1.2921 9.09476 1.74011C9.06993 1.75311 9.02737 1.77661 8.99899 1.79361L5.77012 3.63365C5.60493 3.72615 5.50358 3.89916 5.50459 4.08666L5.50257 8.57626V8.57726ZM6.24391 7.00022L7.99972 5.9997L9.75553 6.99972V9.00027L7.99972 10.0003L6.24391 9.00027V7.00022Z",
    fill: "currentColor"
  }));
};
const LogoGoogle = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    "data-testid": "geist-icon",
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M8.15991 6.54543V9.64362H12.4654C12.2763 10.64 11.709 11.4837 10.8581 12.0509L13.4544 14.0655C14.9671 12.6692 15.8399 10.6182 15.8399 8.18188C15.8399 7.61461 15.789 7.06911 15.6944 6.54552L8.15991 6.54543Z",
    fill: "#4285F4"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M3.6764 9.52268L3.09083 9.97093L1.01807 11.5855C2.33443 14.1963 5.03241 16 8.15966 16C10.3196 16 12.1305 15.2873 13.4542 14.0655L10.8578 12.0509C10.1451 12.5309 9.23598 12.8219 8.15966 12.8219C6.07967 12.8219 4.31245 11.4182 3.67967 9.5273L3.6764 9.52268Z",
    fill: "#34A853"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M1.01803 4.41455C0.472607 5.49087 0.159912 6.70543 0.159912 7.99995C0.159912 9.29447 0.472607 10.509 1.01803 11.5854C1.01803 11.5926 3.6799 9.51991 3.6799 9.51991C3.5199 9.03991 3.42532 8.53085 3.42532 7.99987C3.42532 7.46889 3.5199 6.95983 3.6799 6.47983L1.01803 4.41455Z",
    fill: "#FBBC05"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M8.15982 3.18545C9.33802 3.18545 10.3853 3.59271 11.2216 4.37818L13.5125 2.0873C12.1234 0.792777 10.3199 0 8.15982 0C5.03257 0 2.33443 1.79636 1.01807 4.41455L3.67985 6.48001C4.31254 4.58908 6.07983 3.18545 8.15982 3.18545Z",
    fill: "#EA4335"
  }));
};
const LogoAnthropic = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    xmlnsXlink: "http://www.w3.org/1999/xlink",
    x: "0px",
    y: "0px",
    viewBox: "0 0 92.2 65",
    style: {
      color: 'currentcolor',
      fill: 'currentcolor'
    },
    width: "18px",
    height: "18px"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M66.5,0H52.4l25.7,65h14.1L66.5,0z M25.7,0L0,65h14.4l5.3-13.6h26.9L51.8,65h14.4L40.5,0C40.5,0,25.7,0,25.7,0zM24.3,39.3l8.8-22.8l8.8,22.8H24.3z"
  }));
};
const RouteIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M7.53033 0.719661L7 0.189331L5.93934 1.24999L6.46967 1.78032L6.68934 1.99999H3.375C1.51104 1.99999 0 3.51103 0 5.37499C0 7.23895 1.51104 8.74999 3.375 8.74999H12.625C13.6605 8.74999 14.5 9.58946 14.5 10.625C14.5 11.6605 13.6605 12.5 12.625 12.5H4.88555C4.56698 11.4857 3.61941 10.75 2.5 10.75C1.11929 10.75 0 11.8693 0 13.25C0 14.6307 1.11929 15.75 2.5 15.75C3.61941 15.75 4.56698 15.0143 4.88555 14H12.625C14.489 14 16 12.489 16 10.625C16 8.76103 14.489 7.24999 12.625 7.24999H3.375C2.33947 7.24999 1.5 6.41052 1.5 5.37499C1.5 4.33946 2.33947 3.49999 3.375 3.49999H6.68934L6.46967 3.71966L5.93934 4.24999L7 5.31065L7.53033 4.78032L8.85355 3.4571C9.24408 3.06657 9.24408 2.43341 8.85355 2.04288L7.53033 0.719661ZM2.5 14.25C3.05228 14.25 3.5 13.8023 3.5 13.25C3.5 12.6977 3.05228 12.25 2.5 12.25C1.94772 12.25 1.5 12.6977 1.5 13.25C1.5 13.8023 1.94772 14.25 2.5 14.25ZM14.5 2.74999C14.5 3.30228 14.0523 3.74999 13.5 3.74999C12.9477 3.74999 12.5 3.30228 12.5 2.74999C12.5 2.19771 12.9477 1.74999 13.5 1.74999C14.0523 1.74999 14.5 2.19771 14.5 2.74999ZM16 2.74999C16 4.1307 14.8807 5.24999 13.5 5.24999C12.1193 5.24999 11 4.1307 11 2.74999C11 1.36928 12.1193 0.249991 13.5 0.249991C14.8807 0.249991 16 1.36928 16 2.74999Z",
    fill: "currentColor"
  }));
};
const FileIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M14.5 13.5V6.5V5.41421C14.5 5.149 14.3946 4.89464 14.2071 4.70711L9.79289 0.292893C9.60536 0.105357 9.351 0 9.08579 0H8H3H1.5V1.5V13.5C1.5 14.8807 2.61929 16 4 16H12C13.3807 16 14.5 14.8807 14.5 13.5ZM13 13.5V6.5H9.5H8V5V1.5H3V13.5C3 14.0523 3.44772 14.5 4 14.5H12C12.5523 14.5 13 14.0523 13 13.5ZM9.5 5V2.12132L12.3787 5H9.5ZM5.13 5.00062H4.505V6.25062H5.13H6H6.625V5.00062H6H5.13ZM4.505 8H5.13H11H11.625V9.25H11H5.13H4.505V8ZM5.13 11H4.505V12.25H5.13H11H11.625V11H11H5.13Z",
    fill: "currentColor"
  }));
};
const LoaderIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("g", {
    clipPath: "url(#clip0_2393_1490)"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M8 0V4",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.5",
    d: "M8 16V12",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.9",
    d: "M3.29773 1.52783L5.64887 4.7639",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.1",
    d: "M12.7023 1.52783L10.3511 4.7639",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.4",
    d: "M12.7023 14.472L10.3511 11.236",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.6",
    d: "M3.29773 14.472L5.64887 11.236",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.2",
    d: "M15.6085 5.52783L11.8043 6.7639",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.7",
    d: "M0.391602 10.472L4.19583 9.23598",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.3",
    d: "M15.6085 10.4722L11.8043 9.2361",
    stroke: "currentColor",
    strokeWidth: "1.5"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    opacity: "0.8",
    d: "M0.391602 5.52783L4.19583 6.7639",
    stroke: "currentColor",
    strokeWidth: "1.5"
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("defs", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("clipPath", {
    id: "clip0_2393_1490"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("rect", {
    width: "16",
    height: "16",
    fill: "white"
  }))));
};
const UploadIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    "data-testid": "geist-icon",
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M1.5 4.875C1.5 3.01104 3.01104 1.5 4.875 1.5C6.20018 1.5 7.34838 2.26364 7.901 3.37829C8.1902 3.96162 8.79547 4.5 9.60112 4.5H12.25C13.4926 4.5 14.5 5.50736 14.5 6.75C14.5 7.42688 14.202 8.03329 13.7276 8.44689L13.1622 8.93972L14.1479 10.0704L14.7133 9.57758C15.5006 8.89123 16 7.8785 16 6.75C16 4.67893 14.3211 3 12.25 3H9.60112C9.51183 3 9.35322 2.93049 9.2449 2.71201C8.44888 1.1064 6.79184 0 4.875 0C2.18261 0 0 2.18261 0 4.875V6.40385C0 7.69502 0.598275 8.84699 1.52982 9.59656L2.11415 10.0667L3.0545 8.89808L2.47018 8.42791C1.87727 7.95083 1.5 7.22166 1.5 6.40385V4.875ZM7.29289 7.39645C7.68342 7.00592 8.31658 7.00592 8.70711 7.39645L11.7803 10.4697L12.3107 11L11.25 12.0607L10.7197 11.5303L8.75 9.56066V15.25V16H7.25V15.25V9.56066L5.28033 11.5303L4.75 12.0607L3.68934 11L4.21967 10.4697L7.29289 7.39645Z",
    fill: "currentColor"
  }));
};
const MenuIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M1 2H1.75H14.25H15V3.5H14.25H1.75H1V2ZM1 12.5H1.75H14.25H15V14H14.25H1.75H1V12.5ZM1.75 7.25H1V8.75H1.75H14.25H15V7.25H14.25H1.75Z",
    fill: "currentColor"
  }));
};
const PencilEditIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M11.75 0.189331L12.2803 0.719661L15.2803 3.71966L15.8107 4.24999L15.2803 4.78032L5.15901 14.9016C4.45575 15.6049 3.50192 16 2.50736 16H0.75H0V15.25V13.4926C0 12.4981 0.395088 11.5442 1.09835 10.841L11.2197 0.719661L11.75 0.189331ZM11.75 2.31065L9.81066 4.24999L11.75 6.18933L13.6893 4.24999L11.75 2.31065ZM2.15901 11.9016L8.75 5.31065L10.6893 7.24999L4.09835 13.841C3.67639 14.2629 3.1041 14.5 2.50736 14.5H1.5V13.4926C1.5 12.8959 1.73705 12.3236 2.15901 11.9016ZM9 16H16V14.5H9V16Z",
    fill: "currentColor"
  }));
};
const CheckedSquare = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M15 16H1C0.447715 16 0 15.5523 0 15V1C0 0.447715 0.447716 0 1 0L15 8.17435e-06C15.5523 8.47532e-06 16 0.447724 16 1.00001V15C16 15.5523 15.5523 16 15 16ZM11.7803 6.28033L12.3107 5.75L11.25 4.68934L10.7197 5.21967L6.5 9.43935L5.28033 8.21967L4.75001 7.68934L3.68934 8.74999L4.21967 9.28033L5.96967 11.0303C6.11032 11.171 6.30109 11.25 6.5 11.25C6.69891 11.25 6.88968 11.171 7.03033 11.0303L11.7803 6.28033Z",
    fill: "currentColor"
  }));
};
const UncheckedSquare = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("rect", {
    x: "1",
    y: "1",
    width: "14",
    height: "14",
    stroke: "currentColor",
    strokeWidth: "1.5",
    fill: "none"
  }));
};
const MoreIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg",
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("circle", {
    cx: "4.5",
    cy: "11.5",
    r: "1.5",
    fill: "black"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("circle", {
    cx: "11.5",
    cy: "11.5",
    r: "1.5",
    fill: "black"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M20 11.5C20 12.3284 19.3284 13 18.5 13C17.6716 13 17 12.3284 17 11.5C17 10.6716 17.6716 10 18.5 10C19.3284 10 20 10.6716 20 11.5Z",
    fill: "black"
  }));
};
const TrashIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M6.75 2.75C6.75 2.05964 7.30964 1.5 8 1.5C8.69036 1.5 9.25 2.05964 9.25 2.75V3H6.75V2.75ZM5.25 3V2.75C5.25 1.23122 6.48122 0 8 0C9.51878 0 10.75 1.23122 10.75 2.75V3H12.9201H14.25H15V4.5H14.25H13.8846L13.1776 13.6917C13.0774 14.9942 11.9913 16 10.6849 16H5.31508C4.00874 16 2.92263 14.9942 2.82244 13.6917L2.11538 4.5H1.75H1V3H1.75H3.07988H5.25ZM4.31802 13.5767L3.61982 4.5H12.3802L11.682 13.5767C11.6419 14.0977 11.2075 14.5 10.6849 14.5H5.31508C4.79254 14.5 4.3581 14.0977 4.31802 13.5767Z",
    fill: "currentColor"
  }));
};
const InfoIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8ZM6.25002 7H7.00002H7.75C8.30229 7 8.75 7.44772 8.75 8V11.5V12.25H7.25V11.5V8.5H7.00002H6.25002V7ZM8 6C8.55229 6 9 5.55228 9 5C9 4.44772 8.55229 4 8 4C7.44772 4 7 4.44772 7 5C7 5.55228 7.44772 6 8 6Z",
    fill: "currentColor"
  }));
};
const ArrowUpIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M8.70711 1.39644C8.31659 1.00592 7.68342 1.00592 7.2929 1.39644L2.21968 6.46966L1.68935 6.99999L2.75001 8.06065L3.28034 7.53032L7.25001 3.56065V14.25V15H8.75001V14.25V3.56065L12.7197 7.53032L13.25 8.06065L14.3107 6.99999L13.7803 6.46966L8.70711 1.39644Z",
    fill: "currentColor"
  }));
};
const StopIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M3 3H13V13H3V3Z",
    fill: "currentColor"
  }));
};
const PaperclipIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    },
    className: "-rotate-45"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10.8591 1.70735C10.3257 1.70735 9.81417 1.91925 9.437 2.29643L3.19455 8.53886C2.56246 9.17095 2.20735 10.0282 2.20735 10.9222C2.20735 11.8161 2.56246 12.6734 3.19455 13.3055C3.82665 13.9376 4.68395 14.2927 5.57786 14.2927C6.47178 14.2927 7.32908 13.9376 7.96117 13.3055L14.2036 7.06304L14.7038 6.56287L15.7041 7.56321L15.204 8.06337L8.96151 14.3058C8.06411 15.2032 6.84698 15.7074 5.57786 15.7074C4.30875 15.7074 3.09162 15.2032 2.19422 14.3058C1.29682 13.4084 0.792664 12.1913 0.792664 10.9222C0.792664 9.65305 1.29682 8.43592 2.19422 7.53852L8.43666 1.29609C9.07914 0.653606 9.95054 0.292664 10.8591 0.292664C11.7678 0.292664 12.6392 0.653606 13.2816 1.29609C13.9241 1.93857 14.2851 2.80997 14.2851 3.71857C14.2851 4.62718 13.9241 5.49858 13.2816 6.14106L13.2814 6.14133L7.0324 12.3835C7.03231 12.3836 7.03222 12.3837 7.03213 12.3838C6.64459 12.7712 6.11905 12.9888 5.57107 12.9888C5.02297 12.9888 4.49731 12.7711 4.10974 12.3835C3.72217 11.9959 3.50444 11.4703 3.50444 10.9222C3.50444 10.3741 3.72217 9.8484 4.10974 9.46084L4.11004 9.46054L9.877 3.70039L10.3775 3.20051L11.3772 4.20144L10.8767 4.70131L5.11008 10.4612C5.11005 10.4612 5.11003 10.4612 5.11 10.4613C4.98779 10.5835 4.91913 10.7493 4.91913 10.9222C4.91913 11.0951 4.98782 11.2609 5.11008 11.3832C5.23234 11.5054 5.39817 11.5741 5.57107 11.5741C5.74398 11.5741 5.9098 11.5054 6.03206 11.3832L6.03233 11.3829L12.2813 5.14072C12.2814 5.14063 12.2815 5.14054 12.2816 5.14045C12.6586 4.7633 12.8704 4.25185 12.8704 3.71857C12.8704 3.18516 12.6585 2.6736 12.2813 2.29643C11.9041 1.91925 11.3926 1.70735 10.8591 1.70735Z",
    fill: "currentColor"
  }));
};
const MoreHorizontalIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M4 8C4 8.82843 3.32843 9.5 2.5 9.5C1.67157 9.5 1 8.82843 1 8C1 7.17157 1.67157 6.5 2.5 6.5C3.32843 6.5 4 7.17157 4 8ZM9.5 8C9.5 8.82843 8.82843 9.5 8 9.5C7.17157 9.5 6.5 8.82843 6.5 8C6.5 7.17157 7.17157 6.5 8 6.5C8.82843 6.5 9.5 7.17157 9.5 8ZM13.5 9.5C14.3284 9.5 15 8.82843 15 8C15 7.17157 14.3284 6.5 13.5 6.5C12.6716 6.5 12 7.17157 12 8C12 8.82843 12.6716 9.5 13.5 9.5Z",
    fill: "currentColor"
  }));
};
const MessageIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M2.8914 10.4028L2.98327 10.6318C3.22909 11.2445 3.5 12.1045 3.5 13C3.5 13.3588 3.4564 13.7131 3.38773 14.0495C3.69637 13.9446 4.01409 13.8159 4.32918 13.6584C4.87888 13.3835 5.33961 13.0611 5.70994 12.7521L6.22471 12.3226L6.88809 12.4196C7.24851 12.4724 7.61994 12.5 8 12.5C11.7843 12.5 14.5 9.85569 14.5 7C14.5 4.14431 11.7843 1.5 8 1.5C4.21574 1.5 1.5 4.14431 1.5 7C1.5 8.18175 1.94229 9.29322 2.73103 10.2153L2.8914 10.4028ZM2.8135 15.7653C1.76096 16 1 16 1 16C1 16 1.43322 15.3097 1.72937 14.4367C1.88317 13.9834 2 13.4808 2 13C2 12.3826 1.80733 11.7292 1.59114 11.1903C0.591845 10.0221 0 8.57152 0 7C0 3.13401 3.58172 0 8 0C12.4183 0 16 3.13401 16 7C16 10.866 12.4183 14 8 14C7.54721 14 7.10321 13.9671 6.67094 13.9038C6.22579 14.2753 5.66881 14.6656 5 15C4.23366 15.3832 3.46733 15.6195 2.8135 15.7653Z",
    fill: "currentColor"
  }));
};
const CrossIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M12.4697 13.5303L13 14.0607L14.0607 13L13.5303 12.4697L9.06065 7.99999L13.5303 3.53032L14.0607 2.99999L13 1.93933L12.4697 2.46966L7.99999 6.93933L3.53032 2.46966L2.99999 1.93933L1.93933 2.99999L2.46966 3.53032L6.93933 7.99999L2.46966 12.4697L1.93933 13L2.99999 14.0607L3.53032 13.5303L7.99999 9.06065L12.4697 13.5303Z",
  fill: "currentColor"
}));
const CrossSmallIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M9.96966 11.0303L10.5 11.5607L11.5607 10.5L11.0303 9.96966L9.06065 7.99999L11.0303 6.03032L11.5607 5.49999L10.5 4.43933L9.96966 4.96966L7.99999 6.93933L6.03032 4.96966L5.49999 4.43933L4.43933 5.49999L4.96966 6.03032L6.93933 7.99999L4.96966 9.96966L4.43933 10.5L5.49999 11.5607L6.03032 11.0303L7.99999 9.06065L9.96966 11.0303Z",
  fill: "currentColor"
}));
const UndoIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M13.5 8C13.5 4.96643 11.0257 2.5 7.96452 2.5C5.42843 2.5 3.29365 4.19393 2.63724 6.5H5.25H6V8H5.25H0.75C0.335787 8 0 7.66421 0 7.25V2.75V2H1.5V2.75V5.23347C2.57851 2.74164 5.06835 1 7.96452 1C11.8461 1 15 4.13001 15 8C15 11.87 11.8461 15 7.96452 15C5.62368 15 3.54872 13.8617 2.27046 12.1122L1.828 11.5066L3.03915 10.6217L3.48161 11.2273C4.48831 12.6051 6.12055 13.5 7.96452 13.5C11.0257 13.5 13.5 11.0336 13.5 8Z",
  fill: "currentColor"
}));
const RedoIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M2.5 8C2.5 4.96643 4.97431 2.5 8.03548 2.5C10.5716 2.5 12.7064 4.19393 13.3628 6.5H10.75H10V8H10.75H15.25C15.6642 8 16 7.66421 16 7.25V2.75V2H14.5V2.75V5.23347C13.4215 2.74164 10.9316 1 8.03548 1C4.1539 1 1 4.13001 1 8C1 11.87 4.1539 15 8.03548 15C10.3763 15 12.4513 13.8617 13.7295 12.1122L14.172 11.5066L12.9609 10.6217L12.5184 11.2273C11.5117 12.6051 9.87945 13.5 8.03548 13.5C4.97431 13.5 2.5 11.0336 2.5 8Z",
  fill: "currentColor"
}));
const DeltaIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M2.67705 15H1L1.75 13.5L6.16147 4.67705L6.15836 4.67082L6.16667 4.66667L7.16147 2.67705L8 1L8.83853 2.67705L14.25 13.5L15 15H13.3229H2.67705ZM7 6.3541L10.5729 13.5H3.42705L7 6.3541Z",
  fill: "currentColor"
}));
const PenIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M8.75 0.189331L9.28033 0.719661L15.2803 6.71966L15.8107 7.24999L15.2803 7.78032L13.7374 9.32322C13.1911 9.8696 12.3733 9.97916 11.718 9.65188L9.54863 13.5568C8.71088 15.0648 7.12143 16 5.39639 16H0.75H0V15.25V10.6036C0 8.87856 0.935237 7.28911 2.4432 6.45136L6.34811 4.28196C6.02084 3.62674 6.13039 2.80894 6.67678 2.26255L8.21967 0.719661L8.75 0.189331ZM7.3697 5.43035L10.5696 8.63029L8.2374 12.8283C7.6642 13.8601 6.57668 14.5 5.39639 14.5H2.56066L5.53033 11.5303L4.46967 10.4697L1.5 13.4393V10.6036C1.5 9.42331 2.1399 8.33579 3.17166 7.76259L7.3697 5.43035ZM12.6768 8.26256C12.5791 8.36019 12.4209 8.36019 12.3232 8.26255L12.0303 7.96966L8.03033 3.96966L7.73744 3.67677C7.63981 3.57914 7.63981 3.42085 7.73744 3.32321L8.75 2.31065L13.6893 7.24999L12.6768 8.26256Z",
  fill: "currentColor"
}));
const SummarizeIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M1.75 12H1V10.5H1.75H5.25H6V12H5.25H1.75ZM1.75 7.75H1V6.25H1.75H4.25H5V7.75H4.25H1.75ZM1.75 3.5H1V2H1.75H7.25H8V3.5H7.25H1.75ZM12.5303 14.7803C12.2374 15.0732 11.7626 15.0732 11.4697 14.7803L9.21967 12.5303L8.68934 12L9.75 10.9393L10.2803 11.4697L11.25 12.4393V2.75V2H12.75V2.75V12.4393L13.7197 11.4697L14.25 10.9393L15.3107 12L14.7803 12.5303L12.5303 14.7803Z",
  fill: "currentColor"
}));
const SidebarLeftIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M6.245 2.5H14.5V12.5C14.5 13.0523 14.0523 13.5 13.5 13.5H6.245V2.5ZM4.995 2.5H1.5V12.5C1.5 13.0523 1.94772 13.5 2.5 13.5H4.995V2.5ZM0 1H1.5H14.5H16V2.5V12.5C16 13.8807 14.8807 15 13.5 15H2.5C1.11929 15 0 13.8807 0 12.5V2.5V1Z",
  fill: "currentColor"
}));
const PlusIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M8.75 1.75V1H7.25V1.75V6.75H2.25H1.5V8.25H2.25H7.25V13.25V14H8.75V13.25V8.25H13.75H14.5V6.75H13.75H8.75V1.75Z",
  fill: "currentColor"
}));
const CopyIcon = ({
  size = 24
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  viewBox: "0 0 24 24",
  width: size,
  fill: "none"
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  d: "M0 4C0 1.79086 1.79086 0 4 0H20C22.2091 0 24 1.79086 24 4V20C24 22.2091 22.2091 24 20 24H4C1.79086 24 0 22.2091 0 20V4Z"
}), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  d: "M9.60016 14.3991C9.60016 12.137 9.60016 11.0051 10.3033 10.3027C11.0056 9.59961 12.1375 9.59961 14.3997 9.59961H15.1996C17.4618 9.59961 18.5937 9.59961 19.296 10.3027C19.9992 11.0051 19.9992 12.137 19.9992 14.3991V15.1991C19.9992 17.4612 19.9992 18.5931 19.296 19.2955C18.5937 19.9986 17.4618 19.9986 15.1996 19.9986H14.3997C12.1375 19.9986 11.0056 19.9986 10.3033 19.2955C9.60016 18.5931 9.60016 17.4612 9.60016 15.1991V14.3991Z",
  stroke: "currentColor",
  strokeWidth: "1.5",
  strokeLinecap: "round",
  strokeLinejoin: "round"
}), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  d: "M15.9988 9.59946C15.9964 7.23409 15.9612 6.00861 15.2725 5.16949C15.1396 5.00762 14.9912 4.85919 14.8294 4.72633C13.943 4 12.6296 4 9.99942 4C7.37007 4 6.055 4 5.16949 4.72633C5.00762 4.85919 4.85919 5.00762 4.72633 5.16949C4 6.0558 4 7.36927 4 9.99942C4 12.6288 4 13.9438 4.72633 14.8294C4.85919 14.9912 5.00762 15.1396 5.16949 15.2725C6.00941 15.9604 7.23329 15.9972 9.59946 15.9988",
  stroke: "currentColor",
  strokeWidth: "1.5",
  strokeLinecap: "round",
  strokeLinejoin: "round"
}));
const ThumbUpIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M6.89531 2.23972C6.72984 2.12153 6.5 2.23981 6.5 2.44315V5.25001C6.5 6.21651 5.7165 7.00001 4.75 7.00001H2.5V13.5H12.1884C12.762 13.5 13.262 13.1096 13.4011 12.5532L14.4011 8.55318C14.5984 7.76425 14.0017 7.00001 13.1884 7.00001H9.25H8.5V6.25001V3.51458C8.5 3.43384 8.46101 3.35807 8.39531 3.31114L6.89531 2.23972ZM5 2.44315C5 1.01975 6.6089 0.191779 7.76717 1.01912L9.26717 2.09054C9.72706 2.41904 10 2.94941 10 3.51458V5.50001H13.1884C14.9775 5.50001 16.2903 7.18133 15.8563 8.91698L14.8563 12.917C14.5503 14.1412 13.4503 15 12.1884 15H1.75H1V14.25V6.25001V5.50001H1.75H4.75C4.88807 5.50001 5 5.38808 5 5.25001V2.44315Z",
  fill: "currentColor"
}));
const ThumbDownIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M6.89531 13.7603C6.72984 13.8785 6.5 13.7602 6.5 13.5569V10.75C6.5 9.7835 5.7165 9 4.75 9H2.5V2.5H12.1884C12.762 2.5 13.262 2.89037 13.4011 3.44683L14.4011 7.44683C14.5984 8.23576 14.0017 9 13.1884 9H9.25H8.5V9.75V12.4854C8.5 12.5662 8.46101 12.6419 8.39531 12.6889L6.89531 13.7603ZM5 13.5569C5 14.9803 6.6089 15.8082 7.76717 14.9809L9.26717 13.9095C9.72706 13.581 10 13.0506 10 12.4854V10.5H13.1884C14.9775 10.5 16.2903 8.81868 15.8563 7.08303L14.8563 3.08303C14.5503 1.85882 13.4503 1 12.1884 1H1.75H1V1.75V9.75V10.5H1.75H4.75C4.88807 10.5 5 10.6119 5 10.75V13.5569Z",
  fill: "currentColor"
}));
const ChevronDownIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M12.0607 6.74999L11.5303 7.28032L8.7071 10.1035C8.31657 10.4941 7.68341 10.4941 7.29288 10.1035L4.46966 7.28032L3.93933 6.74999L4.99999 5.68933L5.53032 6.21966L7.99999 8.68933L10.4697 6.21966L11 5.68933L12.0607 6.74999Z",
  fill: "currentColor"
}));
const CheckCircleFillIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8ZM11.5303 6.53033L12.0607 6L11 4.93934L10.4697 5.46967L6.5 9.43934L5.53033 8.46967L5 7.93934L3.93934 9L4.46967 9.53033L5.96967 11.0303C6.26256 11.3232 6.73744 11.3232 7.03033 11.0303L11.5303 6.53033Z",
    fill: "currentColor"
  }));
};
const GlobeIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10.268 14.0934C11.9051 13.4838 13.2303 12.2333 13.9384 10.6469C13.1192 10.7941 12.2138 10.9111 11.2469 10.9925C11.0336 12.2005 10.695 13.2621 10.268 14.0934ZM8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM8.48347 14.4823C8.32384 14.494 8.16262 14.5 8 14.5C7.83738 14.5 7.67616 14.494 7.51654 14.4823C7.5132 14.4791 7.50984 14.4759 7.50647 14.4726C7.2415 14.2165 6.94578 13.7854 6.67032 13.1558C6.41594 12.5744 6.19979 11.8714 6.04101 11.0778C6.67605 11.1088 7.33104 11.125 8 11.125C8.66896 11.125 9.32395 11.1088 9.95899 11.0778C9.80021 11.8714 9.58406 12.5744 9.32968 13.1558C9.05422 13.7854 8.7585 14.2165 8.49353 14.4726C8.49016 14.4759 8.4868 14.4791 8.48347 14.4823ZM11.4187 9.72246C12.5137 9.62096 13.5116 9.47245 14.3724 9.28806C14.4561 8.87172 14.5 8.44099 14.5 8C14.5 7.55901 14.4561 7.12828 14.3724 6.71194C13.5116 6.52755 12.5137 6.37904 11.4187 6.27753C11.4719 6.83232 11.5 7.40867 11.5 8C11.5 8.59133 11.4719 9.16768 11.4187 9.72246ZM10.1525 6.18401C10.2157 6.75982 10.25 7.36805 10.25 8C10.25 8.63195 10.2157 9.24018 10.1525 9.81598C9.46123 9.85455 8.7409 9.875 8 9.875C7.25909 9.875 6.53877 9.85455 5.84749 9.81598C5.7843 9.24018 5.75 8.63195 5.75 8C5.75 7.36805 5.7843 6.75982 5.84749 6.18401C6.53877 6.14545 7.25909 6.125 8 6.125C8.74091 6.125 9.46123 6.14545 10.1525 6.18401ZM11.2469 5.00748C12.2138 5.08891 13.1191 5.20593 13.9384 5.35306C13.2303 3.7667 11.9051 2.51622 10.268 1.90662C10.695 2.73788 11.0336 3.79953 11.2469 5.00748ZM8.48347 1.51771C8.4868 1.52089 8.49016 1.52411 8.49353 1.52737C8.7585 1.78353 9.05422 2.21456 9.32968 2.84417C9.58406 3.42562 9.80021 4.12856 9.95899 4.92219C9.32395 4.89118 8.66896 4.875 8 4.875C7.33104 4.875 6.67605 4.89118 6.04101 4.92219C6.19978 4.12856 6.41594 3.42562 6.67032 2.84417C6.94578 2.21456 7.2415 1.78353 7.50647 1.52737C7.50984 1.52411 7.51319 1.52089 7.51653 1.51771C7.67615 1.50597 7.83738 1.5 8 1.5C8.16262 1.5 8.32384 1.50597 8.48347 1.51771ZM5.73202 1.90663C4.0949 2.51622 2.76975 3.7667 2.06159 5.35306C2.88085 5.20593 3.78617 5.08891 4.75309 5.00748C4.96639 3.79953 5.30497 2.73788 5.73202 1.90663ZM4.58133 6.27753C3.48633 6.37904 2.48837 6.52755 1.62761 6.71194C1.54392 7.12828 1.5 7.55901 1.5 8C1.5 8.44099 1.54392 8.87172 1.62761 9.28806C2.48837 9.47245 3.48633 9.62096 4.58133 9.72246C4.52807 9.16768 4.5 8.59133 4.5 8C4.5 7.40867 4.52807 6.83232 4.58133 6.27753ZM4.75309 10.9925C3.78617 10.9111 2.88085 10.7941 2.06159 10.6469C2.76975 12.2333 4.0949 13.4838 5.73202 14.0934C5.30497 13.2621 4.96639 12.2005 4.75309 10.9925Z",
    fill: "currentColor"
  }));
};
const LockIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10 4.5V6H6V4.5C6 3.39543 6.89543 2.5 8 2.5C9.10457 2.5 10 3.39543 10 4.5ZM4.5 6V4.5C4.5 2.567 6.067 1 8 1C9.933 1 11.5 2.567 11.5 4.5V6H12.5H14V7.5V12.5C14 13.8807 12.8807 15 11.5 15H4.5C3.11929 15 2 13.8807 2 12.5V7.5V6H3.5H4.5ZM11.5 7.5H10H6H4.5H3.5V12.5C3.5 13.0523 3.94772 13.5 4.5 13.5H11.5C12.0523 13.5 12.5 13.0523 12.5 12.5V7.5H11.5Z",
    fill: "currentColor"
  }));
};
const EyeIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M4.02168 4.76932C6.11619 2.33698 9.88374 2.33698 11.9783 4.76932L14.7602 7.99999L11.9783 11.2307C9.88374 13.663 6.1162 13.663 4.02168 11.2307L1.23971 7.99999L4.02168 4.76932ZM13.1149 3.79054C10.422 0.663244 5.57797 0.663247 2.88503 3.79054L-0.318359 7.5106V8.48938L2.88503 12.2094C5.57797 15.3367 10.422 15.3367 13.1149 12.2094L16.3183 8.48938V7.5106L13.1149 3.79054ZM6.49997 7.99999C6.49997 7.17157 7.17154 6.49999 7.99997 6.49999C8.82839 6.49999 9.49997 7.17157 9.49997 7.99999C9.49997 8.82842 8.82839 9.49999 7.99997 9.49999C7.17154 9.49999 6.49997 8.82842 6.49997 7.99999ZM7.99997 4.99999C6.34311 4.99999 4.99997 6.34314 4.99997 7.99999C4.99997 9.65685 6.34311 11 7.99997 11C9.65682 11 11 9.65685 11 7.99999C11 6.34314 9.65682 4.99999 7.99997 4.99999Z",
    fill: "currentColor"
  }));
};
const ShareIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M15 11.25V10.5H13.5V11.25V12.75C13.5 13.1642 13.1642 13.5 12.75 13.5H3.25C2.83579 13.5 2.5 13.1642 2.5 12.75L2.5 3.25C2.5 2.83579 2.83579 2.5 3.25 2.5H5.75H6.5V1H5.75H3.25C2.00736 1 1 2.00736 1 3.25V12.75C1 13.9926 2.00736 15 3.25 15H12.75C13.9926 15 15 13.9926 15 12.75V11.25ZM15 5.5L10.5 1V4C7.46243 4 5 6.46243 5 9.5V10L5.05855 9.91218C6.27146 8.09281 8.31339 7 10.5 7V10L15 5.5Z",
    fill: "currentColor"
  }));
};
function MessageShareIcon({
  size = 16
}) {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 24 24",
    width: size,
    fill: "none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M8.6125 10.8083L14.3875 7.69167M8.6125 13.1917L14.3875 16.3083M3.625 12C3.625 12.7293 3.90156 13.4288 4.39384 13.9445C4.88613 14.4603 5.55381 14.75 6.25 14.75C6.94619 14.75 7.61387 14.4603 8.10616 13.9445C8.59844 13.4288 8.875 12.7293 8.875 12C8.875 11.2707 8.59844 10.5712 8.10616 10.0555C7.61387 9.53973 6.94619 9.25 6.25 9.25C5.55381 9.25 4.88613 9.53973 4.39384 10.0555C3.90156 10.5712 3.625 11.2707 3.625 12ZM14.125 6.5C14.125 7.22935 14.4016 7.92882 14.8938 8.44454C15.3861 8.96027 16.0538 9.25 16.75 9.25C17.4462 9.25 18.1139 8.96027 18.6062 8.44454C19.0984 7.92882 19.375 7.22935 19.375 6.5C19.375 5.77065 19.0984 5.07118 18.6062 4.55546C18.1139 4.03973 17.4462 3.75 16.75 3.75C16.0538 3.75 15.3861 4.03973 14.8938 4.55546C14.4016 5.07118 14.125 5.77065 14.125 6.5ZM14.125 17.5C14.125 18.2293 14.4016 18.9288 14.8938 19.4445C15.3861 19.9603 16.0538 20.25 16.75 20.25C17.4462 20.25 18.1139 19.9603 18.6062 19.4445C19.0984 18.9288 19.375 18.2293 19.375 17.5C19.375 16.7707 19.0984 16.0712 18.6062 15.5555C18.1139 15.0397 17.4462 14.75 16.75 14.75C16.0538 14.75 15.3861 15.0397 14.8938 15.5555C14.4016 16.0712 14.125 16.7707 14.125 17.5Z",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }));
}
const CodeIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M4.21969 12.5303L4.75002 13.0607L5.81068 12L5.28035 11.4697L1.81068 7.99999L5.28035 4.53032L5.81068 3.99999L4.75002 2.93933L4.21969 3.46966L0.39647 7.29289C0.00594562 7.68341 0.00594562 8.31658 0.39647 8.7071L4.21969 12.5303ZM11.7804 12.5303L11.25 13.0607L10.1894 12L10.7197 11.4697L14.1894 7.99999L10.7197 4.53032L10.1894 3.99999L11.25 2.93933L11.7804 3.46966L15.6036 7.29289C15.9941 7.68341 15.9941 8.31658 15.6036 8.7071L11.7804 12.5303Z",
    fill: "currentColor"
  }));
};
const PlayIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M13.4549 7.22745L13.3229 7.16146L2.5 1.74999L2.4583 1.72914L1.80902 1.4045L1.3618 1.18089C1.19558 1.09778 1 1.21865 1 1.4045L1 1.9045L1 2.63041L1 2.67704L1 13.3229L1 13.3696L1 14.0955L1 14.5955C1 14.7813 1.19558 14.9022 1.3618 14.8191L1.80902 14.5955L2.4583 14.2708L2.5 14.25L13.3229 8.83852L13.4549 8.77253L14.2546 8.37267L14.5528 8.2236C14.737 8.13147 14.737 7.86851 14.5528 7.77638L14.2546 7.62731L13.4549 7.22745ZM11.6459 7.99999L2.5 3.42704L2.5 12.5729L11.6459 7.99999Z",
    fill: "currentColor"
  }));
};
const PythonIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M7.90474 0.00013087C7.24499 0.00316291 6.61494 0.0588153 6.06057 0.15584C4.42745 0.441207 4.13094 1.0385 4.13094 2.14002V3.59479H7.9902V4.07971H4.13094H2.68259C1.56099 4.07971 0.578874 4.7465 0.271682 6.01496C-0.0826597 7.4689 -0.0983767 8.37619 0.271682 9.89434C0.546012 11.0244 1.20115 11.8296 2.32276 11.8296H3.64966V10.0856C3.64966 8.82574 4.75179 7.71441 6.06057 7.71441H9.91533C10.9884 7.71441 11.845 6.84056 11.845 5.77472V2.14002C11.845 1.10556 10.9626 0.328487 9.91533 0.15584C9.25237 0.046687 8.56448 -0.00290121 7.90474 0.00013087ZM5.81768 1.17017C6.21631 1.17017 6.54185 1.49742 6.54185 1.89978C6.54185 2.30072 6.21631 2.62494 5.81768 2.62494C5.41761 2.62494 5.09351 2.30072 5.09351 1.89978C5.09351 1.49742 5.41761 1.17017 5.81768 1.17017Z",
    fill: "currentColor"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M12.3262 4.07971V5.77472C12.3262 7.08883 11.1997 8.19488 9.91525 8.19488H6.06049C5.0046 8.19488 4.13086 9.0887 4.13086 10.1346V13.7693C4.13086 14.8037 5.04033 15.4122 6.06049 15.709C7.28211 16.0642 8.45359 16.1285 9.91525 15.709C10.8868 15.4307 11.8449 14.8708 11.8449 13.7693V12.3145H7.99012V11.8296H11.8449H13.7745C14.8961 11.8296 15.3141 11.0558 15.7041 9.89434C16.1071 8.69865 16.0899 7.5488 15.7041 6.01495C15.4269 4.91058 14.8975 4.07971 13.7745 4.07971H12.3262ZM10.1581 13.2843C10.5582 13.2843 10.8823 13.6086 10.8823 14.0095C10.8823 14.4119 10.5582 14.7391 10.1581 14.7391C9.7595 14.7391 9.43397 14.4119 9.43397 14.0095C9.43397 13.6086 9.7595 13.2843 10.1581 13.2843Z",
    fill: "currentColor"
  }));
};
const TerminalWindowIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M1.5 2.5H14.5V12.5C14.5 13.0523 14.0523 13.5 13.5 13.5H2.5C1.94772 13.5 1.5 13.0523 1.5 12.5V2.5ZM0 1H1.5H14.5H16V2.5V12.5C16 13.8807 14.8807 15 13.5 15H2.5C1.11929 15 0 13.8807 0 12.5V2.5V1ZM4 11.1339L4.44194 10.6919L6.51516 8.61872C6.85687 8.27701 6.85687 7.72299 6.51517 7.38128L4.44194 5.30806L4 4.86612L3.11612 5.75L3.55806 6.19194L5.36612 8L3.55806 9.80806L3.11612 10.25L4 11.1339ZM8 9.75494H8.6225H11.75H12.3725V10.9999H11.75H8.6225H8V9.75494Z",
    fill: "currentColor"
  }));
};
const TerminalIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M1.53035 12.7804L1.00002 13.3108L-0.0606384 12.2501L0.469692 11.7198L4.18936 8.00011L0.469692 4.28044L-0.0606384 3.75011L1.00002 2.68945L1.53035 3.21978L5.60358 7.29301C5.9941 7.68353 5.9941 8.3167 5.60357 8.70722L1.53035 12.7804ZM8.75002 12.5001H8.00002V14.0001H8.75002H15.25H16V12.5001H15.25H8.75002Z",
    fill: "currentColor"
  }));
};
const ClockRewind = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M7.96452 2.5C11.0257 2.5 13.5 4.96643 13.5 8C13.5 11.0336 11.0257 13.5 7.96452 13.5C6.12055 13.5 4.48831 12.6051 3.48161 11.2273L3.03915 10.6217L1.828 11.5066L2.27046 12.1122C3.54872 13.8617 5.62368 15 7.96452 15C11.8461 15 15 11.87 15 8C15 4.13001 11.8461 1 7.96452 1C5.06835 1 2.57851 2.74164 1.5 5.23347V3.75V3H0V3.75V7.25C0 7.66421 0.335786 8 0.75 8H3.75H4.5V6.5H3.75H2.63724C3.29365 4.19393 5.42843 2.5 7.96452 2.5ZM8.75 5.25V4.5H7.25V5.25V7.8662C7.25 8.20056 7.4171 8.51279 7.6953 8.69825L9.08397 9.62404L9.70801 10.0401L10.5401 8.79199L9.91603 8.37596L8.75 7.59861V5.25Z",
    fill: "currentColor"
  }));
};
const LogsIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M9 2H9.75H14.25H15V3.5H14.25H9.75H9V2ZM9 12.5H9.75H14.25H15V14H14.25H9.75H9V12.5ZM9.75 7.25H9V8.75H9.75H14.25H15V7.25H14.25H9.75ZM1 12.5H1.75H2.25H3V14H2.25H1.75H1V12.5ZM1.75 2H1V3.5H1.75H2.25H3V2H2.25H1.75ZM1 7.25H1.75H2.25H3V8.75H2.25H1.75H1V7.25ZM5.75 12.5H5V14H5.75H6.25H7V12.5H6.25H5.75ZM5 2H5.75H6.25H7V3.5H6.25H5.75H5V2ZM5.75 7.25H5V8.75H5.75H6.25H7V7.25H6.25H5.75Z",
    fill: "currentColor"
  }));
};
const ImageIcon = ({
  size = 16
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    height: size,
    strokeLinejoin: "round",
    viewBox: "0 0 16 16",
    width: size,
    style: {
      color: 'currentcolor'
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M14.5 2.5H1.5V9.18933L2.96966 7.71967L3.18933 7.5H3.49999H6.63001H6.93933L6.96966 7.46967L10.4697 3.96967L11.5303 3.96967L14.5 6.93934V2.5ZM8.00066 8.55999L9.53034 10.0897L10.0607 10.62L9.00001 11.6807L8.46968 11.1503L6.31935 9H3.81065L1.53032 11.2803L1.5 11.3106V12.5C1.5 13.0523 1.94772 13.5 2.5 13.5H13.5C14.0523 13.5 14.5 13.0523 14.5 12.5V9.06066L11 5.56066L8.03032 8.53033L8.00066 8.55999ZM4.05312e-06 10.8107V12.5C4.05312e-06 13.8807 1.11929 15 2.5 15H13.5C14.8807 15 16 13.8807 16 12.5V9.56066L16.5607 9L16.0303 8.46967L16 8.43934V2.5V1H14.5H1.5H4.05312e-06V2.5V10.6893L-0.0606689 10.75L4.05312e-06 10.8107Z",
    fill: "currentColor"
  }));
};
const FullscreenIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M1 5.25V6H2.5V5.25V2.5H5.25H6V1H5.25H2C1.44772 1 1 1.44772 1 2V5.25ZM5.25 14.9994H6V13.4994H5.25H2.5V10.7494V9.99939H1V10.7494V13.9994C1 14.5517 1.44772 14.9994 2 14.9994H5.25ZM15 10V10.75V14C15 14.5523 14.5523 15 14 15H10.75H10V13.5H10.75H13.5V10.75V10H15ZM10.75 1H10V2.5H10.75H13.5V5.25V6H15V5.25V2C15 1.44772 14.5523 1 14 1H10.75Z",
  fill: "currentColor"
}));
const DownloadIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fillRule: "evenodd",
  clipRule: "evenodd",
  d: "M8.75 1V1.75V8.68934L10.7197 6.71967L11.25 6.18934L12.3107 7.25L11.7803 7.78033L8.70711 10.8536C8.31658 11.2441 7.68342 11.2441 7.29289 10.8536L4.21967 7.78033L3.68934 7.25L4.75 6.18934L5.28033 6.71967L7.25 8.68934V1.75V1H8.75ZM13.5 9.25V13.5H2.5V9.25V8.5H1V9.25V14C1 14.5523 1.44771 15 2 15H14C14.5523 15 15 14.5523 15 14V9.25V8.5H13.5V9.25Z",
  fill: "currentColor"
}));
const LineChartIcon = ({
  size = 16
}) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
  height: size,
  strokeLinejoin: "round",
  viewBox: "0 0 16 16",
  width: size,
  style: {
    color: 'currentcolor'
  }
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fill: "currentColor",
  fillRule: "evenodd",
  d: "M1 1v11.75A2.25 2.25 0 0 0 3.25 15H15v-1.5H3.25a.75.75 0 0 1-.75-.75V1H1Zm13.297 5.013.513-.547-1.094-1.026-.513.547-3.22 3.434-2.276-2.275a1 1 0 0 0-1.414 0L4.22 8.22l-.53.53 1.06 1.06.53-.53L7 7.56l2.287 2.287a1 1 0 0 0 1.437-.023l3.573-3.811Z",
  clipRule: "evenodd"
}));
const CloseIcon = ({
  size = 24
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "currentColor"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M7 17L17 7M7 7L17 17",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }));
};
const ArrowRightIcon = ({
  size = 24
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M20.3635 12.7068C20.5509 12.5193 20.6562 12.265 20.6562 11.9998C20.6562 11.7347 20.5509 11.4803 20.3635 11.2928L14.7065 5.63582C14.5179 5.45366 14.2653 5.35287 14.0031 5.35515C13.7409 5.35742 13.4901 5.46259 13.3046 5.648C13.1192 5.83341 13.0141 6.08422 13.0118 6.34642C13.0095 6.60862 13.1103 6.86122 13.2925 7.04982L17.2425 10.9998L3.99946 10.9998C3.73425 10.9998 3.47989 11.1052 3.29236 11.2927C3.10482 11.4803 2.99946 11.7346 2.99946 11.9998C2.99946 12.265 3.10482 12.5194 3.29236 12.7069C3.47989 12.8945 3.73425 12.9998 3.99946 12.9998L17.2425 12.9998L13.2925 16.9498C13.1103 17.1384 13.0095 17.391 13.0118 17.6532C13.0141 17.9154 13.1192 18.1662 13.3046 18.3516C13.4901 18.537 13.7409 18.6422 14.0031 18.6445C14.2653 18.6468 14.5179 18.546 14.7065 18.3638L20.3635 12.7068Z",
    fill: "currentColor"
  }));
};
const LeftOutlined = ({
  size = 24
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M14 7L9 12L14 17",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }));
};
const RightOutlined = ({
  size = 24
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M10 17L15 12L10 7",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }));
};
const SendIcon = ({
  size = 24
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    width: size,
    height: size,
    viewBox: "0 0 15 15",
    fill: "none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M0 15L1.56 8.055L10.185 7.515L1.56 6.93L0 0L15 7.5L0 15Z",
    fill: "currentColor"
  }));
};
const VoiceIcon = ({
  size = 24
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M0 4C0 1.79086 1.79086 0 4 0H20C22.2091 0 24 1.79086 24 4V20C24 22.2091 22.2091 24 20 24H4C1.79086 24 0 22.2091 0 20V4Z"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M13.5996 14.3449V9.65499C13.5996 7.03422 13.5996 5.72426 12.8596 5.3976C12.1187 5.07177 11.2475 5.99758 9.50496 7.8517C8.60251 8.81168 8.08807 9.02418 6.804 9.02418C5.68153 9.02418 5.11989 9.02418 4.71587 9.31084C3.87902 9.90582 4.00702 11.0683 4.00702 11.9999C4.00702 12.9316 3.87982 14.0941 4.71747 14.689C5.12069 14.9757 5.68233 14.9757 6.8048 14.9757C8.08887 14.9757 8.60331 15.1882 9.50576 16.1482C11.2483 18.0015 12.1195 18.9281 12.8604 18.6023C13.6004 18.2756 13.6004 16.9657 13.6004 14.344M15.9998 9.5C16.4998 10.1833 16.7998 11.0525 16.7998 11.9999C16.7998 12.9474 16.4998 13.8166 15.9998 14.4999M18.3999 7.83337C19.4 8.97168 20 10.4216 20 11.9999C20 13.5782 19.4 15.0282 18.3999 16.1665",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }));
};
const VoiceingIcon = ({
  size = 24
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M12 4V20M8 9V15M20 10V14M4 10V14M16 7V17",
    stroke: "#4C72FF",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }));
};
const RetryIcon = ({
  size = 24
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M0 4C0 1.79086 1.79086 0 4 0H20C22.2091 0 24 1.79086 24 4V20C24 22.2091 22.2091 24 20 24H4C1.79086 24 0 22.2091 0 20V4Z",
    fill: "white"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("g", {
    "clip-path": "url(#clip0_3718_62769)"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M14.1126 4.6665L14.5113 5.41184C14.7806 5.91517 14.9153 6.16717 14.826 6.27517C14.7373 6.38317 14.444 6.29584 13.8566 6.12184C13.2543 5.94356 12.6294 5.85307 12.0013 5.85317C8.50331 5.85317 5.66797 8.60517 5.66797 11.9998C5.66691 13.082 5.95953 14.1442 6.51464 15.0732M9.89064 19.3332L9.49197 18.5878C9.22264 18.0838 9.08797 17.8318 9.17731 17.7245C9.26597 17.6165 9.55931 17.7032 10.1466 17.8778C10.7333 18.0518 11.3566 18.1458 12.002 18.1458C15.5 18.1458 18.3353 15.3938 18.3353 11.9992C18.3362 10.9172 18.0436 9.85527 17.4886 8.9265",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("defs", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("clipPath", {
    id: "clip0_3718_62769"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("rect", {
    width: "16",
    height: "16",
    fill: "white",
    transform: "translate(4 4)"
  }))));
};
const DeleteIcon = ({
  size = 20
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    width: size,
    height: size,
    viewBox: "0 0 20 20",
    fill: "none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M7.29183 3.58321C7.29183 3.55495 7.30346 3.51147 7.35734 3.46432C7.41246 3.41609 7.50317 3.37488 7.61921 3.37488H12.3811C12.4972 3.37488 12.5879 3.41609 12.643 3.46432C12.6969 3.51147 12.7085 3.55495 12.7085 3.58321V4.62488H7.29183V3.58321ZM6.04183 4.62488V3.58321C6.04183 2.70201 6.82905 2.12488 7.61921 2.12488H12.3811C13.1713 2.12488 13.9585 2.70201 13.9585 3.58321V4.62488H15.6274H16.6699C17.0151 4.62488 17.2949 4.9047 17.2949 5.24988C17.2949 5.59506 17.0151 5.87488 16.6699 5.87488H16.2064L15.4459 15.8191C15.3457 17.122 14.2592 18.1283 12.9525 18.1283H7.04765C5.7409 18.1283 4.65446 17.1222 4.55423 15.8194L3.7937 5.87488H3.33105C2.98588 5.87488 2.70605 5.59506 2.70605 5.24988C2.70605 4.9047 2.98588 4.62488 3.33105 4.62488H4.37272H6.04183ZM13.3335 5.87488H6.66683H5.04735L5.80055 15.7235C5.85081 16.375 6.39416 16.8783 7.04765 16.8783H12.9525C13.606 16.8783 14.1493 16.3753 14.1996 15.7238L14.9528 5.87488H13.3335ZM11.6416 8.43754C11.9868 8.43754 12.2666 8.71736 12.2666 9.06254V13.752C12.2666 14.0972 11.9868 14.377 11.6416 14.377C11.2964 14.377 11.0166 14.0972 11.0166 13.752V9.06254C11.0166 8.71736 11.2964 8.43754 11.6416 8.43754ZM8.98372 9.06254C8.98372 8.71736 8.7039 8.43754 8.35872 8.43754C8.01355 8.43754 7.73372 8.71736 7.73372 9.06254V13.752C7.73372 14.0972 8.01355 14.377 8.35872 14.377C8.7039 14.377 8.98372 14.0972 8.98372 13.752V9.06254Z",
    fill: "#FF543D"
  }));
};
const SettingIcon = ({
  size = 20
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M22 6.5H16",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M6 6.5H2",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M10 10C8.067 10 6.5 8.433 6.5 6.5C6.5 4.567 8.067 3 10 3C11.933 3 13.5 4.567 13.5 6.5C13.5 8.433 11.933 10 10 10Z",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M22 17.5H18",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M8 17.5H2",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M14 21C12.067 21 10.5 19.433 10.5 17.5C10.5 15.567 12.067 14 14 14C15.933 14 17.5 15.567 17.5 17.5C17.5 19.433 15.933 21 14 21Z",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }));
};
const LanguageIcon = ({
  size = 20
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    width: size,
    height: size,
    viewBox: "0 0 24 24",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M2 12C2 17.523 6.477 22 12 22C17.523 22 22 17.523 22 12C22 6.477 17.523 2 12 2C6.477 2 2 6.477 2 12Z",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
    d: "M12.9999 2.04999C12.9999 2.04999 15.9999 5.99999 15.9999 12C15.9999 18 12.9999 21.95 12.9999 21.95M10.9999 21.95C10.9999 21.95 7.99988 18 7.99988 12C7.99988 5.99999 10.9999 2.04999 10.9999 2.04999M2.62988 15.5H21.3699M2.62988 8.49999H21.3699",
    stroke: "currentColor",
    strokeWidth: "1.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }));
};
const LoadingIcon = ({
  size = 20
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", {
    width: size,
    height: size,
    viewBox: "0 0 40 40",
    xmlns: "http://www.w3.org/2000/svg",
    fill: "#3498db"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("circle", {
    cx: "10",
    cy: "20",
    r: "4"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("animate", {
    attributeName: "opacity",
    from: "0.3",
    to: "1",
    dur: "1.2s",
    begin: "0s",
    repeatCount: "indefinite"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("animate", {
    attributeName: "r",
    from: "3",
    to: "4",
    dur: "1.2s",
    begin: "0s",
    repeatCount: "indefinite"
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("circle", {
    cx: "20",
    cy: "20",
    r: "4"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("animate", {
    attributeName: "opacity",
    from: "0.3",
    to: "1",
    dur: "1.2s",
    begin: "0.2s",
    repeatCount: "indefinite"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("animate", {
    attributeName: "r",
    from: "3",
    to: "4",
    dur: "1.2s",
    begin: "0.2s",
    repeatCount: "indefinite"
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("circle", {
    cx: "30",
    cy: "20",
    r: "4"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("animate", {
    attributeName: "opacity",
    from: "0.3",
    to: "1",
    dur: "1.2s",
    begin: "0.4s",
    repeatCount: "indefinite"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("animate", {
    attributeName: "r",
    from: "3",
    to: "4",
    dur: "1.2s",
    begin: "0.4s",
    repeatCount: "indefinite"
  })));
};

/***/ },

/***/ "./src/components/chatAssistant/injectComponent.tsx"
/*!**********************************************************!*\
  !*** ./src/components/chatAssistant/injectComponent.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   injectComponent: () => (/* binding */ injectComponent)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react_dom_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-dom/client */ "./node_modules/react-dom/client.js");


function injectComponent({
  component: Component,
  props
}) {
  return domRoot => {
    if (!domRoot) {
      return {
        unmount: () => {}
      };
    }
    if (!domRoot._reactRoot) {
      domRoot._reactRoot = react_dom_client__WEBPACK_IMPORTED_MODULE_1__.createRoot(domRoot);
    }
    try {
      // 使用 PropsWithChildren 解决 IntrinsicAttributes 类型报错
      domRoot._reactRoot.render(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(Component, props));
    } catch (err) {
      console.error('Failed to render React component:', err);
      return {
        unmount: () => {}
      };
    }
    return {
      unmount: () => {
        domRoot._reactRoot?.unmount();
        domRoot._reactRoot = null;
      }
    };
  };
}

/***/ },

/***/ "./src/components/chatAssistant/markdown.tsx"
/*!***************************************************!*\
  !*** ./src/components/chatAssistant/markdown.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Markdown: () => (/* binding */ Markdown)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react_markdown__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-markdown */ "./node_modules/react-markdown/lib/index.js");
/* harmony import */ var remark_gfm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! remark-gfm */ "./node_modules/remark-gfm/lib/index.js");
/* harmony import */ var _code_block__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./code-block */ "./src/components/chatAssistant/code-block.tsx");
function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }
/* eslint-disable @typescript-eslint/no-unused-vars */
/* eslint-disable react/jsx-props-no-spreading */
/* eslint-disable react/jsx-no-useless-fragment */
// @ts-nocheck




const components = {
  code: _code_block__WEBPACK_IMPORTED_MODULE_3__.CodeBlock,
  pre: ({
    children
  }) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, children),
  ol: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ol", _extends({
      className: "list-decimal list-outside ml-4"
    }, props), children);
  },
  li: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", _extends({
      className: "py-1"
    }, props), children);
  },
  ul: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", _extends({
      className: "list-decimal list-outside ml-4"
    }, props), children);
  },
  strong: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", _extends({
      className: "font-semibold"
    }, props), children);
  },
  a: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("a", {
      className: "text-blue-500 hover:underline",
      target: "_blank",
      rel: "noreferrer"
    }, children);
  },
  h1: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h1", _extends({
      className: "text-3xl font-semibold mt-6 mb-2"
    }, props), children);
  },
  h2: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h2", _extends({
      className: "text-2xl font-semibold mt-6 mb-2"
    }, props), children);
  },
  h3: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", _extends({
      className: "text-xl font-semibold mt-6 mb-2"
    }, props), children);
  },
  h4: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h4", _extends({
      className: "text-lg font-semibold mt-6 mb-2"
    }, props), children);
  },
  h5: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h5", _extends({
      className: "text-base font-semibold mt-6 mb-2"
    }, props), children);
  },
  h6: ({
    node,
    children,
    ...props
  }) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h6", _extends({
      className: "text-sm font-semibold mt-6 mb-2"
    }, props), children);
  }
};
const remarkPlugins = [remark_gfm__WEBPACK_IMPORTED_MODULE_2__["default"]];
const NonMemoizedMarkdown = ({
  children
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(react_markdown__WEBPACK_IMPORTED_MODULE_1__.Markdown, {
    remarkPlugins: remarkPlugins,
    components: components
  }, children);
};
const Markdown = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(NonMemoizedMarkdown, (prevProps, nextProps) => prevProps.children === nextProps.children);

/***/ },

/***/ "./src/components/chatAssistant/message-actions.tsx"
/*!**********************************************************!*\
  !*** ./src/components/chatAssistant/message-actions.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MessageActions: () => (/* binding */ MessageActions)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var copy_to_clipboard__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! copy-to-clipboard */ "./node_modules/copy-to-clipboard/index.js");
/* harmony import */ var copy_to_clipboard__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(copy_to_clipboard__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _hook_useSpeechPlayer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./hook/useSpeechPlayer */ "./src/components/chatAssistant/hook/useSpeechPlayer.ts");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./icons */ "./src/components/chatAssistant/icons.tsx");





const MessageActions = ({
  message
}) => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();
  const {
    isSpeaking,
    speak,
    stop
  } = (0,_hook_useSpeechPlayer__WEBPACK_IMPORTED_MODULE_3__.useSpeechPlayer)(message.id);
  const handleCopy = () => {
    copy_to_clipboard__WEBPACK_IMPORTED_MODULE_1___default()(message.content);
    showNotification({
      message: 'TextCopied'
    });
  };
  const handleVoicePlay = () => {
    const voiceText = message.content;
    if (isSpeaking) {
      stop();
    } else {
      speak(voiceText);
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "message-actions flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] text-[#676B74] cursor-pointer",
    onClick: handleCopy
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_4__.CopyIcon, {
    size: 24
  })), isSpeaking ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] text-[#676B74] cursor-pointer",
    onClick: stop
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_4__.VoiceingIcon, {
    size: 24
  })) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] text-[#676B74] cursor-pointer",
    onClick: handleVoicePlay
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_4__.VoiceIcon, {
    size: 24
  })));
};

/***/ },

/***/ "./src/components/chatAssistant/message.tsx"
/*!**************************************************!*\
  !*** ./src/components/chatAssistant/message.tsx ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PreviewMessage: () => (/* binding */ PreviewMessage),
/* harmony export */   ThinkingMessage: () => (/* binding */ ThinkingMessage)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/popover/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var copy_to_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! copy-to-clipboard */ "./node_modules/copy-to-clipboard/index.js");
/* harmony import */ var copy_to_clipboard__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(copy_to_clipboard__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var framer_motion__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! framer-motion */ "./node_modules/framer-motion/dist/es/components/AnimatePresence/index.mjs");
/* harmony import */ var framer_motion__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! framer-motion */ "./node_modules/framer-motion/dist/es/render/components/motion/proxy.mjs");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_utils__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../lib/utils */ "./src/lib/utils.ts");
/* harmony import */ var _messages_global_introduce_message__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./messages/global-introduce-message */ "./src/components/chatAssistant/messages/global-introduce-message.tsx");
/* harmony import */ var _messages_global_summary_message__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./messages/global-summary-message */ "./src/components/chatAssistant/messages/global-summary-message.tsx");
/* harmony import */ var _messages_google_event_create_messages__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./messages/google-event-create-messages */ "./src/components/chatAssistant/messages/google-event-create-messages.tsx");
/* harmony import */ var _messages_google_event_detail_message__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./messages/google-event-detail-message */ "./src/components/chatAssistant/messages/google-event-detail-message.tsx");
/* harmony import */ var _messages_google_login_auth_message__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./messages/google-login-auth-message */ "./src/components/chatAssistant/messages/google-login-auth-message.tsx");
/* harmony import */ var _messages_google_meet_information_suggest_message__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./messages/google-meet-information-suggest-message */ "./src/components/chatAssistant/messages/google-meet-information-suggest-message.tsx");
/* harmony import */ var _messages_google_meet_mention_message__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./messages/google-meet-mention-message */ "./src/components/chatAssistant/messages/google-meet-mention-message.tsx");
/* harmony import */ var _messages_google_meet_time_confirm_message__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./messages/google-meet-time-confirm-message */ "./src/components/chatAssistant/messages/google-meet-time-confirm-message.tsx");
/* harmony import */ var _messages_group_search_message__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./messages/group-search-message */ "./src/components/chatAssistant/messages/group-search-message.tsx");
/* harmony import */ var _messages_introduce_actions_message__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./messages/introduce-actions-message */ "./src/components/chatAssistant/messages/introduce-actions-message.tsx");
/* harmony import */ var _messages_introduce_meeting_message__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./messages/introduce-meeting-message */ "./src/components/chatAssistant/messages/introduce-meeting-message.tsx");
/* harmony import */ var _messages_introduce_summary_message__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./messages/introduce-summary-message */ "./src/components/chatAssistant/messages/introduce-summary-message.tsx");
/* harmony import */ var _messages_introduce_translation_message__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./messages/introduce-translation-message */ "./src/components/chatAssistant/messages/introduce-translation-message.tsx");
/* harmony import */ var _messages_room_actions_message__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./messages/room-actions-message */ "./src/components/chatAssistant/messages/room-actions-message.tsx");
/* harmony import */ var _messages_room_ai_des_message__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./messages/room-ai-des-message */ "./src/components/chatAssistant/messages/room-ai-des-message.tsx");
/* harmony import */ var _messages_room_ai_media_message__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./messages/room-ai-media-message */ "./src/components/chatAssistant/messages/room-ai-media-message.tsx");
/* harmony import */ var _messages_room_ai_reply_mention_message__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./messages/room-ai-reply-mention-message */ "./src/components/chatAssistant/messages/room-ai-reply-mention-message.tsx");
/* harmony import */ var _messages_room_ai_user_portrait__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./messages/room-ai-user-portrait */ "./src/components/chatAssistant/messages/room-ai-user-portrait.tsx");
/* harmony import */ var _messages_room_summary_message__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./messages/room-summary-message */ "./src/components/chatAssistant/messages/room-summary-message.tsx");
/* harmony import */ var _messages_upgrade_tip_message__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./messages/upgrade-tip-message */ "./src/components/chatAssistant/messages/upgrade-tip-message.tsx");
/* harmony import */ var _messages_urgent_check_message__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./messages/urgent-check-message */ "./src/components/chatAssistant/messages/urgent-check-message.tsx");
/* harmony import */ var _messages_user_search_message__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./messages/user-search-message */ "./src/components/chatAssistant/messages/user-search-message.tsx");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./icons */ "./src/components/chatAssistant/icons.tsx");
/* harmony import */ var _markdown__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./markdown */ "./src/components/chatAssistant/markdown.tsx");
/* harmony import */ var _message_actions__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./message-actions */ "./src/components/chatAssistant/message-actions.tsx");
/* harmony import */ var _ErrorBoundary__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./ErrorBoundary */ "./src/components/chatAssistant/ErrorBoundary.tsx");
/* harmony import */ var _messages_types__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./messages/types */ "./src/components/chatAssistant/messages/types.ts");
// @ts-nocheck








// import AISearchSugesstionsMessage from './messages/ai-search-sugesstion-message';



























const DefaultMessage = ({
  message,
  isLoading
}) => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_6__.getActions)();
  const handleCopy = () => {
    copy_to_clipboard__WEBPACK_IMPORTED_MODULE_3___default()(message.content);
    showNotification({
      message: 'TextCopied'
    });
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(framer_motion__WEBPACK_IMPORTED_MODULE_5__.motion.div, {
    className: "w-full px-[12px] group/message",
    initial: {
      y: 5,
      opacity: 0
    },
    animate: {
      y: 0,
      opacity: 1
    },
    "data-role": message.role
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex gap-4 w-full group-data-[role=user]/message:ml-auto group-data-[role=user]/message:max-w-2xl"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-4 w-full"
  }, message.content && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row gap-2 items-start w-full"
  }, message.role === 'user' ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    placement: "topRight",
    content: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "w-[24px] h-[24px] text-[#676B74] cursor-pointer",
      onClick: handleCopy
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_30__.CopyIcon, {
      size: 24
    }))
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_lib_utils__WEBPACK_IMPORTED_MODULE_7__.cn)('w-auto flex flex-col gap-4 bg-[#E8D7FF] text-[var(--color-text)] px-3 py-2 rounded-xl ml-auto dark:bg-[var(--color-background-own)]')
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_markdown__WEBPACK_IMPORTED_MODULE_31__.Markdown, null, message.content))) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_lib_utils__WEBPACK_IMPORTED_MODULE_7__.cn)('w-auto flex flex-col gap-4 bg-white text-[var(--color-text)] px-3 py-2 rounded-xl dark:bg-[#292929]', {
      '!bg-[#E8D7FF] text-black ml-auto': message.role === 'user'
    })
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_markdown__WEBPACK_IMPORTED_MODULE_31__.Markdown, null, message.content), message.role !== 'user' && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions__WEBPACK_IMPORTED_MODULE_32__.MessageActions, {
    message: message
  }))))));
};
const PurePreviewMessage = ({
  message,
  isLoading,
  deleteMessage
}) => {
  const messageType = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    // 使用自定义 Message 类型的 type 字段
    return message.type || _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.Default;
  }, [message.type]);
  const renderMessageComponent = () => {
    switch (messageType) {
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GlobalSummary:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_33__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_global_summary_message__WEBPACK_IMPORTED_MODULE_9__["default"], {
          message: message,
          deleteMessage: () => deleteMessage?.(message.id)
        }));
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.UrgentCheck:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_urgent_check_message__WEBPACK_IMPORTED_MODULE_28__["default"], {
          message: message,
          deleteMessage: () => deleteMessage?.(message.id)
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GroupSearch:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_group_search_message__WEBPACK_IMPORTED_MODULE_16__.GroupSearchMessage, {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.UserSearch:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_user_search_message__WEBPACK_IMPORTED_MODULE_29__.UserSearchMessage, {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GoogleAuth:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_google_login_auth_message__WEBPACK_IMPORTED_MODULE_12__["default"], {
          deleteMessage: () => deleteMessage?.(message.id)
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GoogleEventInsert:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_google_event_create_messages__WEBPACK_IMPORTED_MODULE_10__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GoogleEventDetail:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_google_event_detail_message__WEBPACK_IMPORTED_MODULE_11__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GoogleMeetTimeConfirm:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_google_meet_time_confirm_message__WEBPACK_IMPORTED_MODULE_15__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GoogleMeetMention:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_google_meet_mention_message__WEBPACK_IMPORTED_MODULE_14__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GoogleMeetInformationSuggest:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_google_meet_information_suggest_message__WEBPACK_IMPORTED_MODULE_13__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.RoomSummary:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_room_summary_message__WEBPACK_IMPORTED_MODULE_26__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.RoomActions:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_room_actions_message__WEBPACK_IMPORTED_MODULE_21__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.MeetingIntroduce:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_introduce_meeting_message__WEBPACK_IMPORTED_MODULE_18__["default"], null);
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.SummaryIntroduce:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_introduce_summary_message__WEBPACK_IMPORTED_MODULE_19__["default"], null);
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.TranslationIntroduce:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_introduce_translation_message__WEBPACK_IMPORTED_MODULE_20__["default"], null);
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.ActionsIntroduce:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_introduce_actions_message__WEBPACK_IMPORTED_MODULE_17__["default"], null);
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.GlobalIntroduce:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_global_introduce_message__WEBPACK_IMPORTED_MODULE_8__.GlobalIntroduceMessage, null);
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.RoomAIDescription:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_room_ai_des_message__WEBPACK_IMPORTED_MODULE_22__["default"], {
          message: message
        });
      // case AIMessageType.AISearchSugesstion:
      //   return <AISearchSugesstionsMessage />;
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.AIReplyMention:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_room_ai_reply_mention_message__WEBPACK_IMPORTED_MODULE_24__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.AIMediaSummary:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_room_ai_media_message__WEBPACK_IMPORTED_MODULE_23__["default"], {
          message: message
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.UserPortrait:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_room_ai_user_portrait__WEBPACK_IMPORTED_MODULE_25__["default"], {
          userId: message?.content
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.UpgradeTip:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_messages_upgrade_tip_message__WEBPACK_IMPORTED_MODULE_27__["default"], {
          message: message,
          deleteMessage: deleteMessage
        });
      case _messages_types__WEBPACK_IMPORTED_MODULE_34__.AIMessageType.Default:
      default:
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(DefaultMessage, {
          message: message,
          isLoading: isLoading
        });
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(framer_motion__WEBPACK_IMPORTED_MODULE_4__.AnimatePresence, null, renderMessageComponent());
};
const PreviewMessage = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(PurePreviewMessage, (prevProps, nextProps) => {
  if (prevProps.isLoading !== nextProps.isLoading) return false;
  if (prevProps.message.content !== nextProps.message.content) return false;
  if (prevProps.message.type !== nextProps.message.type) return false;
  return true;
});
const ThinkingMessage = () => {
  const role = 'assistant';
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(framer_motion__WEBPACK_IMPORTED_MODULE_5__.motion.div, {
    className: "w-full px-[12px] group/message ",
    initial: {
      y: 5,
      opacity: 0
    },
    animate: {
      y: 0,
      opacity: 1,
      transition: {
        delay: 1
      }
    },
    "data-role": role
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: classnames__WEBPACK_IMPORTED_MODULE_2___default()('flex gap-4 group-data-[role=user]/message:px-3 w-full group-data-[role=user]/message:w-fit group-data-[role=user]/message:ml-auto group-data-[role=user]/message:max-w-2xl group-data-[role=user]/message:py-2 rounded-xl', {
      'group-data-[role=user]/message:bg-muted': true
    })
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_30__.LoadingIcon, {
    size: 40
  })));
};

/***/ },

/***/ "./src/components/chatAssistant/messages.scss"
/*!****************************************************!*\
  !*** ./src/components/chatAssistant/messages.scss ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/messages.tsx"
/*!***************************************************!*\
  !*** ./src/components/chatAssistant/messages.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Messages: () => (/* binding */ Messages)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var fast_deep_equal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fast-deep-equal */ "./node_modules/fast-deep-equal/index.js");
/* harmony import */ var fast_deep_equal__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fast_deep_equal__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var framer_motion__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! framer-motion */ "./node_modules/framer-motion/dist/es/render/components/motion/proxy.mjs");
/* harmony import */ var _agent_stream_events__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./agent/stream-events */ "./src/components/chatAssistant/agent/stream-events.ts");
/* harmony import */ var _hook_use_messages__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./hook/use-messages */ "./src/components/chatAssistant/hook/use-messages.tsx");
/* harmony import */ var _hook_usePerformanceMonitor__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./hook/usePerformanceMonitor */ "./src/components/chatAssistant/hook/usePerformanceMonitor.ts");
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _message__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./message */ "./src/components/chatAssistant/message.tsx");
/* harmony import */ var _room_storage__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./room-storage */ "./src/components/chatAssistant/room-storage/index.tsx");
/* harmony import */ var _variables__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _messages_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./messages.scss */ "./src/components/chatAssistant/messages.scss");
/* eslint-disable no-null/no-null */











const EMPTY_TOOL_CALLS = [];

// 获取阶段的简洁描述
const getPhaseText = phase => {
  switch (phase) {
    case _agent_stream_events__WEBPACK_IMPORTED_MODULE_3__.AgentPhase.THINKING:
      return 'Thinking...';
    case _agent_stream_events__WEBPACK_IMPORTED_MODULE_3__.AgentPhase.TOOL_CALLING:
      return 'Getting data...';
    case _agent_stream_events__WEBPACK_IMPORTED_MODULE_3__.AgentPhase.GENERATING:
      return 'Generating response...';
    case _agent_stream_events__WEBPACK_IMPORTED_MODULE_3__.AgentPhase.COMPLETED:
      return 'Completed';
    case _agent_stream_events__WEBPACK_IMPORTED_MODULE_3__.AgentPhase.ERROR:
      return 'Error occurred';
    default:
      return 'Processing...';
  }
};

// 获取工具调用的简洁描述
const getToolCallText = tool => {
  const statusIcon = tool.status === 'success' ? '✓' : tool.status === 'failed' ? '✗' : '⋯';
  return `${statusIcon} ${tool.toolDescription}`;
};
function PureMessages({
  chatId,
  className,
  isLoading,
  status,
  messages,
  hasMore,
  currentPhase,
  toolCalls = EMPTY_TOOL_CALLS,
  deleteMessage,
  loadMore
}) {
  // 性能监控
  (0,_hook_usePerformanceMonitor__WEBPACK_IMPORTED_MODULE_5__.usePerformanceMonitor)('ChatAssistant/Messages', {
    logThreshold: 30
  });
  const upLoadRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const anchorRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
  const {
    containerRef: messagesContainerRef,
    endRef: messagesEndRef,
    isAtBottom,
    onViewportEnter,
    onViewportLeave
  } = (0,_hook_use_messages__WEBPACK_IMPORTED_MODULE_4__.useMessages)({
    chatId,
    status
  });

  // 将副作用移到 useEffect 中
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isAtBottom) {
      _room_storage__WEBPACK_IMPORTED_MODULE_8__["default"].updateRoomAIData(_variables__WEBPACK_IMPORTED_MODULE_9__.GLOBAL_SUMMARY_CHATID, 'unreadCount', 0);
    }
  }, [isAtBottom]);
  const handleScroll = () => {
    const container = messagesContainerRef.current;
    if (!container || upLoadRef.current) return;
    const {
      scrollTop
    } = container;
    if (scrollTop === 0 && hasMore) {
      upLoadRef.current = true;
      const anchor = container.firstChild?.firstChild || null;
      anchorRef.current = anchor;
      loadMore().finally(() => {
        upLoadRef.current = false;
        if (anchorRef.current) {
          anchorRef.current.scrollIntoView({
            behavior: 'instant',
            block: 'start'
          });
        }
        // scrollBuffer.current = calculateBuffer();
      });
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    ref: messagesContainerRef,
    onScroll: handleScroll,
    className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_6__.cn)('ai-message-container custom-scroll flex flex-col min-w-0 gap-[10px] h-full overflow-y-auto relative pt-4 overflow-x-hidden select-text', className)
  }, (messages || []).map((message, index) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message__WEBPACK_IMPORTED_MODULE_7__.PreviewMessage, {
      message: message,
      deleteMessage: deleteMessage,
      key: message.id,
      isLoading: status === 'streaming' && messages.length - 1 === index
    });
  }), status === 'streaming' && (Boolean(currentPhase) || toolCalls.length > 0) ? (() => {
    const lastMessage = messages[messages.length - 1];
    const hasReplyContent = lastMessage?.role === 'assistant' && lastMessage?.content;

    // 只在没有实际回复内容时显示思考过程和工具调用
    if (!hasReplyContent) {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "px-3 py-2 text-sm text-[var(--color-text-secondary)] flex flex-col gap-1"
      }, Boolean(currentPhase) && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "flex items-center gap-2"
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
        className: "inline-block w-1 h-1 rounded-full animate-ping"
      }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
        className: "opacity-70 animate-pulse"
      }, getPhaseText(currentPhase))), toolCalls.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "flex flex-col gap-1 ml-3"
      }, toolCalls.map((tool, index) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        key: `${tool.toolName}_${index}`,
        className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_6__.cn)('flex items-center gap-2 text-xs', tool.status === 'pending' && 'animate-pulse', tool.status === 'success' && 'opacity-70', tool.status === 'failed' && 'text-[var(--color-error)]')
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, getToolCallText(tool)), tool.summary && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
        className: "opacity-50 truncate"
      }, "\u2022", tool.summary)))));
    }
    return null;
  })() : null, (status === 'submitted' && messages.length > 0 && messages[messages.length - 1].role === 'user' || isLoading) && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message__WEBPACK_IMPORTED_MODULE_7__.ThinkingMessage, null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(framer_motion__WEBPACK_IMPORTED_MODULE_2__.motion.div, {
    ref: messagesEndRef,
    className: "shrink-0 min-w-[24px] min-h-[24px]",
    onViewportLeave: onViewportLeave,
    onViewportEnter: onViewportEnter
  }));
}
const Messages = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(PureMessages, (prevProps, nextProps) => {
  if (prevProps.status !== nextProps.status) return false;
  if (prevProps.currentPhase !== nextProps.currentPhase) return false;
  if (prevProps.toolCalls?.length !== nextProps.toolCalls?.length) return false;
  if (prevProps.status && nextProps.status) return false;
  if (prevProps.messages.length !== nextProps.messages.length) return false;
  if (!fast_deep_equal__WEBPACK_IMPORTED_MODULE_1___default()(prevProps.messages, nextProps.messages)) return false;
  if (!fast_deep_equal__WEBPACK_IMPORTED_MODULE_1___default()(prevProps.toolCalls, nextProps.toolCalls)) return false;
  return true;
});

/***/ },

/***/ "./src/components/chatAssistant/messages/global-intoduce-message.module.scss"
/*!***********************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/global-intoduce-message.module.scss ***!
  \***********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"introduceSummary":"rf6B3If7","introduceActions":"dJsvi1dH","introduceTranslation":"o3wMHYSu","introduceSmartreply":"rhP7CCVz"});

/***/ },

/***/ "./src/components/chatAssistant/messages/global-intoduce-message.scss"
/*!****************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/global-intoduce-message.scss ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/messages/global-introduce-message.tsx"
/*!****************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/global-introduce-message.tsx ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GlobalIntroduceMessage: () => (/* binding */ GlobalIntroduceMessage)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _global_summary_summary_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../global-summary/summary-utils */ "./src/components/chatAssistant/global-summary/summary-utils.ts");
/* harmony import */ var _hook_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../hook/use-scroll-to-bottom */ "./src/components/chatAssistant/hook/use-scroll-to-bottom.tsx");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _global_intoduce_message_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./global-intoduce-message.scss */ "./src/components/chatAssistant/messages/global-intoduce-message.scss");
/* harmony import */ var _global_intoduce_message_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./global-intoduce-message.module.scss */ "./src/components/chatAssistant/messages/global-intoduce-message.module.scss");










const GlobalIntroduceMessage = () => {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const {
    currentUserId
  } = global;
  const currentUser = currentUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, currentUserId) : undefined;
  const {
    scrollToBottom
  } = (0,_hook_use_scroll_to_bottom__WEBPACK_IMPORTED_MODULE_6__.useScrollToBottom)();
  const sendMeetingIntroduceMessage = () => {
    const message = (0,_global_summary_summary_utils__WEBPACK_IMPORTED_MODULE_5__.createIntroduceMeetingMessage)();
    _store__WEBPACK_IMPORTED_MODULE_7__.ChataiStores.summary?.storeMessage(message);
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.AddSummaryMessage, message);
    scrollToBottom();
  };
  const sendSmmaryIntroduceMessage = () => {
    const message = (0,_global_summary_summary_utils__WEBPACK_IMPORTED_MODULE_5__.createIntroduceSummaryMessage)();
    _store__WEBPACK_IMPORTED_MODULE_7__.ChataiStores.summary?.storeMessage(message);
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.AddSummaryMessage, message);
    scrollToBottom();
  };
  const sendActionsIntroduceMessage = () => {
    const message = (0,_global_summary_summary_utils__WEBPACK_IMPORTED_MODULE_5__.createIntroduceActionsMessage)();
    _store__WEBPACK_IMPORTED_MODULE_7__.ChataiStores.summary?.storeMessage(message);
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.AddSummaryMessage, message);
    scrollToBottom();
  };
  const sendTranslationIntroduceMessage = () => {
    const message = (0,_global_summary_summary_utils__WEBPACK_IMPORTED_MODULE_5__.createIntroduceTranslationMessage)();
    _store__WEBPACK_IMPORTED_MODULE_7__.ChataiStores.summary?.storeMessage(message);
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.AddSummaryMessage, message);
    scrollToBottom();
  };
  const handleSendMessage = value => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.AskGlobalAI, value);
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "global-summary-introduce"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", null, "Hi", [currentUser?.firstName, currentUser?.lastName].filter(Boolean).join(' '), ' ', "\uD83D\uDC4B"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", null, "How can I help you today\uFF01"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] p-[15px] grid grid-cols-2 gap-[12px] w-[743px] mt-[10px] mb-[20px] bg-[var(--color-background)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_global_intoduce_message_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].introduceSummary, 'global-summary-introduce-item'),
    onClick: sendSmmaryIntroduceMessage
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[18px] font-bold mb-[10px] text-[var(--color-text)]"
  }, "\uD83D\uDCDD AI Summary"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px] leading-[18px] text-[var(--color-text-secondary)] pr-[120px]"
  }, "Get instant, clear takeaways during the chat")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_global_intoduce_message_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].introduceActions, 'global-summary-introduce-item'),
    onClick: sendActionsIntroduceMessage
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[18px] font-bold mb-[10px] text-[var(--color-text)]"
  }, "\u2705 Action Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px] leading-[18px] text-[var(--color-text-secondary)] pr-[120px]"
  }, "Automatically capture next steps and assignments.")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_global_intoduce_message_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].introduceTranslation, 'global-summary-introduce-item'),
    onClick: sendTranslationIntroduceMessage
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[18px] font-bold mb-[10px] text-[var(--color-text)]"
  }, "\uD83D\uDCDA\uFE0F Translation & Grammar Check"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px] leading-[18px] text-[var(--color-text-secondary)] pr-[120px]"
  }, "Communicate effortlessly, in any language.")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_global_intoduce_message_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].introduceSmartreply, 'global-summary-introduce-item'),
    onClick: sendMeetingIntroduceMessage
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[18px] font-bold mb-[10px] text-[var(--color-text)]"
  }, "\uD83D\uDE80 Meeting Scheduler"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px] leading-[18px] text-[var(--color-text-secondary)] pr-[120px]"
  }, "Book and organize meetings with ease."))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h5", {
    className: "text-[16px] font-normal !mb-[12px]"
  }, " You can also ask me like this"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row flex-wrap gap-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "cursor-pointer p-[8px] rounded-[16px] text-[14px] text-[var(--color-text)] bg-[var(--color-background)]",
    onClick: () => handleSendMessage('What’s new today?')
  }, "What\u2019s new today?"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "cursor-pointer p-[8px] rounded-[16px] text-[14px] text-[var(--color-text)] bg-[var(--color-background)]",
    onClick: () => handleSendMessage('Summarize today’s crypto market highlights.')
  }, "Summarize today\u2019s crypto market highlights."))));
};

/***/ },

/***/ "./src/components/chatAssistant/messages/global-summary-message.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/global-summary-message.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/config-provider/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/dropdown/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/popover/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/theme/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _api_user_settings__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../api/user-settings */ "./src/components/chatAssistant/api/user-settings.ts");
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _message_actions_button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./message-actions-button */ "./src/components/chatAssistant/messages/message-actions-button.tsx");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _ErrorBoundary__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ErrorBoundary */ "./src/components/chatAssistant/ErrorBoundary.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* harmony import */ var _assets_actions_png__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../assets/actions.png */ "./src/components/chatAssistant/assets/actions.png");
/* harmony import */ var _assets_calendar_png__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../assets/calendar.png */ "./src/components/chatAssistant/assets/calendar.png");
/* harmony import */ var _assets_check_png__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../assets/check.png */ "./src/components/chatAssistant/assets/check.png");
/* harmony import */ var _assets_message_png__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../assets/message.png */ "./src/components/chatAssistant/assets/message.png");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _assets_user_png__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../assets/user.png */ "./src/components/chatAssistant/assets/user.png");
/* harmony import */ var _assets_write_png__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../assets/write.png */ "./src/components/chatAssistant/assets/write.png");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* eslint-disable no-null/no-null */
/* eslint-disable no-console */
/* eslint-disable @typescript-eslint/no-shadow */
/* eslint-disable max-len */




















// 新增：按主题聚合的结构（summary-by-topic 模板）

/**
 * 时间戳专用时间范围格式化工具
 * @param {number} start 开始时间戳（支持毫秒/秒级）
 * @param {number} end 结束时间戳（支持毫秒/秒级）
 * @returns {string} 格式化后的时间范围字符串
 */
function formatTimestampRange(start, end) {
  // 时间戳标准化处理（自动识别秒/毫秒）
  const normalizeTimestamp = ts => {
    if (ts.toString().length <= 10) return ts * 1000; // 秒级转毫秒
    return ts; // 毫秒级直接使用
  };
  const startDate = start ? new Date(normalizeTimestamp(start)) : undefined;
  const endDate = end ? new Date(normalizeTimestamp(end)) : undefined;
  const now = new Date();

  // 日期比较函数
  const isSameDay = (d1, d2) => d1.getFullYear() === d2.getFullYear() && d1.getMonth() === d2.getMonth() && d1.getDate() === d2.getDate();
  const isToday = date => isSameDay(date, now);

  // 时间格式化组件
  const formatTime = date => {
    const pad = n => String(n).padStart(2, '0');
    return `${pad(date.getHours())}:${pad(date.getMinutes())}`;
  };
  const formatDate = date => {
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const month = monthNames[date.getMonth()];
    const pad = n => String(n).padStart(2, '0');
    return `${month} ${pad(date.getDate())} / ${formatTime(date)}`;
  };
  if (!startDate && !endDate) {
    return '';
  }
  if (!startDate && endDate) {
    return `${formatDate(endDate)}`;
  }
  if (startDate && !endDate) {
    return `${formatDate(startDate)}`;
  }
  if (startDate && endDate) {
    // 范围判断逻辑
    if (isToday(startDate) && isToday(endDate)) {
      return `${formatTime(startDate)} - ${formatTime(endDate)}`;
    } else {
      return `${formatDate(startDate)} - ${formatDate(endDate)}`;
    }
  }
  return '';
}
function mergeTopics(mainTopic, customTopic) {
  const mergedMap = new Map();

  // 处理 mainTopic
  if (mainTopic.length > 0) {
    for (const item of mainTopic) {
      const key = item.chatId;
      if (!mergedMap.has(key)) {
        mergedMap.set(key, {
          chatId: item.chatId,
          chatRoomName: item.chatRoomName,
          mainTopics: item.summaryItems || [],
          customTopics: []
        });
      } else {
        const existing = mergedMap.get(key);
        existing.mainTopics.push(...(item.summaryItems || []));
      }
    }
  }

  // 处理 customTopic
  if (customTopic.length > 0) {
    for (const item of customTopic) {
      const key = item.chatId;
      if (!mergedMap.has(key)) {
        mergedMap.set(key, {
          chatId: item.chatId,
          chatRoomName: item.chatRoomName,
          mainTopics: [],
          customTopics: [{
            topicName: item.topicName,
            summaryItems: item.summaryItems || []
          }]
        });
      } else {
        const existing = mergedMap.get(key);
        existing.customTopics.push({
          topicName: item.topicName,
          summaryItems: item.summaryItems || []
        });
      }
    }
  }
  return Array.from(mergedMap.values());
}
const ChatAvatar = ({
  chatId,
  classNames,
  size,
  style,
  tooltip
}) => {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  if (!chatId) return null;
  let peer;
  if ((0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_21__.isUserId)(chatId)) {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, chatId);
  } else {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
    style: style,
    key: chatId,
    className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_8__.cn)(classNames, 'overlay-avatar inline-block cursor-pointer'),
    size: size,
    peer: peer,
    tooltip: tooltip
  });
};
const SummaryTopicItem = ({
  chatId,
  topicItem
}) => {
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__.useDrawerStore)();
  const showMessageDetail = (chatId, relevantMessageIds) => {
    openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__.DrawerKey.OriginalMessages, {
      relevantMessages: [{
        chatId,
        messageIds: relevantMessageIds
      }]
    });
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_12__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "list-disc pl-[18px] text-[16px] list-inside"
  }, (topicItem || []).map((summaryItem, index) => {
    const {
      content,
      relevantMessageIds
    } = summaryItem;
    if (!content) return null;
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
      role: "button",
      className: "cursor-pointer text-[15px] break-words",
      onClick: () => showMessageDetail(chatId, relevantMessageIds),
      "data-readable": true,
      key: index
    }, content);
  })));
};

// 新增：主题模式下的条目渲染（支持多会话消息定位）
const TopicSummaryItem = ({
  topicItems
}) => {
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__.useDrawerStore)();
  const showMessageDetail = relevantChats => {
    const relevantMessages = relevantChats.map(c => ({
      chatId: c.chatId,
      messageIds: c.messageIds
    }));
    openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__.DrawerKey.OriginalMessages, {
      relevantMessages
    });
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_12__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "list-disc pl-[18px] text-[16px] list-inside"
  }, (topicItems || []).map((summaryItem, index) => {
    const {
      content,
      relevantChats
    } = summaryItem;
    if (!content) return null;
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
      role: "button",
      className: "cursor-pointer text-[15px] break-words",
      onClick: () => showMessageDetail(relevantChats),
      "data-readable": true,
      key: index
    }, content);
  })));
};
const SummaryPenddingItem = ({
  pendingItem
}) => {
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__.useDrawerStore)();
  const showMessageDetail = () => {
    openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__.DrawerKey.OriginalMessages, {
      relevantMessages: [{
        chatId: pendingItem.chatId,
        messageIds: pendingItem.relevantMessageIds
      }]
    });
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_12__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex gap-[8px] my-[4px] cursor-pointer",
    key: pendingItem.chatId,
    onClick: showMessageDetail
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[18px] h-[18px] mt-[2px]",
    src: _assets_check_png__WEBPACK_IMPORTED_MODULE_16__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[15px]",
    "data-readable": true
  }, pendingItem.summary), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ChatAvatar, {
    size: 20,
    chatId: pendingItem.chatId
  })));
};
const SummaryGarbageItem = ({
  garBageItem
}) => {
  const {
    chatId,
    chatRoomName,
    level,
    summary,
    relevantMessageIds
  } = garBageItem;
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__.useDrawerStore)();
  const showMessageDetail = (chatId, relevantMessageIds) => {
    openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_13__.DrawerKey.OriginalMessages, {
      relevantMessages: [{
        chatId,
        messageIds: relevantMessageIds
      }]
    });
  };
  if (!(0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_21__.isUserId)(chatId)) {
    return undefined;
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_12__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex justify-start gap-[8px] my-[16px]",
    key: garBageItem.chatId,
    onClick: () => {
      showMessageDetail(chatId, relevantMessageIds);
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ChatAvatar, {
    chatId: chatId,
    size: 44
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col justify-center"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[16px] font-semibold leading-[20px] mb-[4px]"
  }, chatRoomName), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex justify-start gap-[4px]"
  }, level === 'high' ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[#FF543D] text-[14px] whitespace-nowrap"
  }, "\uD83D\uDD34 High-Risk") : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[#FF9B05] text-[14px] whitespace-nowrap"
  }, "\uD83D\uDFE1 Low-Risk"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px] text-[var(--color-text-secondary)]"
  }, summary)))));
};
const SummaryInfoContent = ({
  summaryInfo
}) => {
  const {
    globalsummarytemplate
  } = _api_user_settings__WEBPACK_IMPORTED_MODULE_7__.telegptSettings.telegptSettings;
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_5__.getActions)();
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const themeKey = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTheme)(global);
  const handleSummaryTempChange = temp => {
    _api_user_settings__WEBPACK_IMPORTED_MODULE_7__.telegptSettings.setSettingOption({
      globalsummarytemplate: temp
    });
    if (temp === 'summary-by-chat') {
      showNotification({
        message: 'Summaries will be organized by chat next time.',
        icon: 'message-succeeded'
      });
    } else {
      showNotification({
        message: 'Summaries will be organized by topic next time.',
        icon: 'message-succeeded'
      });
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_12__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mb-[6px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[52px] h-[52px] rounded-full ml-[-60px]",
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_18__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[16px] font-semibold"
  }, "TelyAI"), summaryInfo?.summaryEndTime ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[14px] text-[#A8A6AC]"
  }, (0,_utils_util__WEBPACK_IMPORTED_MODULE_8__.formatTimestamp)(summaryInfo.summaryEndTime)) : null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    theme: {
      algorithm: themeKey === 'dark' ? antd__WEBPACK_IMPORTED_MODULE_4__["default"].darkAlgorithm : antd__WEBPACK_IMPORTED_MODULE_4__["default"].defaultAlgorithm
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_2__["default"], {
    trigger: ['click'],
    placement: "bottomRight",
    className: "ml-auto",
    menu: {
      items: [{
        key: 'summary-by-chat',
        label: 'Summarize by Chats'
      }, {
        key: 'summary-by-topic',
        label: 'Summarize by Topics'
      }],
      selectable: true,
      defaultSelectedKeys: [globalsummarytemplate],
      onClick: key => {
        handleSummaryTempChange(key.key);
      }
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "more",
    className: "text-[var(--color-text-secondary)] text-[24px] rotate-90"
  })))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[22px] font-bold !mb-[6px]",
    "data-readable": true
  }, "Chat Summary"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center flex-wrap gap-[10px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-start gap-[8px] flex-nowrap"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-[22px] flex items-center"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_calendar_png__WEBPACK_IMPORTED_MODULE_15__,
    alt: ""
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center flex-wrap gap-[4px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-bold text-[14px] leading-[22px] whitespace-nowrap",
    "data-readable": true,
    "data-readable-inline": true
  }, "Time range:"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "leading-[22px] text-[14px]",
    "data-readable": true,
    "data-readable-inline": true
  }, formatTimestampRange(summaryInfo?.summaryStartTime, summaryInfo?.summaryEndTime)))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center flex-nowrap gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "h-[22px] flex items-center"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_message_png__WEBPACK_IMPORTED_MODULE_17__,
    alt: ""
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[4px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-bold text-[14px]",
    "data-readable": true,
    "data-readable-inline": true
  }, "Messages:"), summaryInfo?.summaryMessageCount ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "leading-[22px] text-[14px]",
    "data-readable": true,
    "data-readable-inline": true
  }, summaryInfo?.summaryMessageCount) : null))), summaryInfo?.summaryChatIds ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px] mt-[10px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_user_png__WEBPACK_IMPORTED_MODULE_19__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-bold text-[14px]"
  }, "Groups/friends: "), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center"
  }, (summaryInfo?.summaryChatIds ?? []).slice(0, 10).map((id, index) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ChatAvatar, {
      style: {
        zIndex: `${String(summaryInfo.summaryChatIds.length - index)}`
      },
      chatId: id,
      size: 24,
      classNames: "summary-avatar-group !border-solid-[2px] !border-white ml-[-4px]",
      key: id,
      tooltip: true
    });
  }), summaryInfo.summaryChatIds.length > 10 ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] rounded-full bg-[#979797] text-[12px] whitespace-nowrap flex items-center justify-center"
  }, summaryInfo.summaryChatIds.length - 10, "+") : null)) : null));
};
const IgnoreSummaryButton = ({
  chatId,
  handleIgnore
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[4px] cursor-pointer transition-colors duration-200 text-[14px] text-[var(--color-text)]",
    onClick: () => handleIgnore(chatId)
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "eye-crossed"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-semibold"
  }, "Ignore this chat"));
};
const MainSummaryByChatContent = ({
  messageId,
  summaryInfo,
  summaryTopic,
  pendingMatters,
  deleteMessage
}) => {
  // eslint-disable-next-line @typescript-eslint/naming-convention
  const {
    ignored_summary_chat_ids
  } = _api_user_settings__WEBPACK_IMPORTED_MODULE_7__.telegptSettings.telegptSettings;
  const ignoredChatIds = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_7__.getIdsFromEntityTypes)(ignored_summary_chat_ids);
  const [ignoredIds, setIgnoredIds] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(ignoredChatIds);
  const handleIgnore = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(id => {
    const newSelected = [...new Set([...ignoredIds, id])];
    const entityTypes = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_7__.buildEntityTypeFromIds)(newSelected);
    setIgnoredIds(newSelected);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_7__.telegptSettings.setSettingOption({
      ignored_summary_chat_ids: entityTypes
    }, res => {
      if (res.code === 0) {
        (0,_global__WEBPACK_IMPORTED_MODULE_5__.getActions)().showNotification({
          message: 'This chat will no longer be included in future summaries.'
        });
      }
    });
  }, [ignoredIds]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-max-[693px] rounded-[10px] pl-[82px] pr-[25px] pt-[20px] pb-[25px] bg-[var(--color-background)]",
    "data-message-container": true
  }, summaryInfo && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryInfoContent, {
    summaryInfo: summaryInfo
  }), summaryTopic.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px] !mb-[6px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Key Topics"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_write_png__WEBPACK_IMPORTED_MODULE_20__,
    alt: ""
  })), (summaryTopic || []).map((item, index) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      key: index
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex items-center justify-between gap-[8px]"
    }, ignoredIds.includes(item.chatId) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex items-center gap-[8px]"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
      className: "text-[16px] font-bold",
      "data-readable": true
    }, index + 1, ".", item.chatRoomName), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ChatAvatar, {
      size: 20,
      chatId: item.chatId
    })) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_3__["default"], {
      className: "room-info-popover",
      placement: "top",
      content: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(IgnoreSummaryButton, {
        chatId: item.chatId,
        handleIgnore: handleIgnore
      })
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex items-center gap-[8px]"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
      className: "text-[16px] font-bold",
      "data-readable": true
    }, index + 1, ".", item.chatRoomName), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ChatAvatar, {
      size: 20,
      chatId: item.chatId
    })))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
      className: "list-disc pl-[2px] text-[16px] list-inside"
    }, item.mainTopics.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[16px] font-bold",
      "data-readable": true
    }, "Key Points"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryTopicItem, {
      chatId: item.chatId,
      topicItem: item.mainTopics
    })), item.customTopics.length > 0 && (item?.customTopics ?? []).map((customTopic, index) => {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
        key: index
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
        className: "text-[16px] font-bold",
        "data-readable": true
      }, customTopic.topicName), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryTopicItem, {
        chatId: item.chatId,
        topicItem: customTopic.summaryItems
      }));
    })));
  })), pendingMatters.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px] mb-[16px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Actions Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_actions_png__WEBPACK_IMPORTED_MODULE_14__,
    alt: ""
  })), (pendingMatters || []).map(item => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryPenddingItem, {
    pendingItem: item,
    key: item.chatId
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_9__["default"], {
    canCopy: true,
    canVoice: true,
    canDelete: false,
    onDelete: deleteMessage,
    message: {
      id: messageId
    }
  }));
};

// 新增：按主题渲染的主内容（summary-by-topic 模板）
const MainSummaryByTopicContent = ({
  messageId,
  summaryInfo,
  topics,
  pendingMatters,
  deleteMessage
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-max-[693px] rounded-[10px] pl-[82px] pr-[25px] pt-[20px] pb-[25px] bg-[var(--color-background)]",
    "data-message-container": true
  }, summaryInfo && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryInfoContent, {
    summaryInfo: summaryInfo
  }), topics.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px] mb-[16px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Key Topics"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_write_png__WEBPACK_IMPORTED_MODULE_20__,
    alt: ""
  })), (topics || []).map((topic, index) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    key: index
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center justify-between gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[16px] font-bold",
    "data-readable": true
  }, index + 1, ".", topic.topicName || 'Untitled Topic'), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center"
  }, (topic?.relatedChatIds ?? []).slice(0, 6).map(id => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ChatAvatar, {
    size: 20,
    chatId: id,
    key: `${topic.topicName}-${id}`,
    tooltip: true
  })), topic.relatedChatIds && topic.relatedChatIds.length > 6 ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "ml-[4px] text-[12px] text-[var(--color-text-secondary)]"
  }, topic.relatedChatIds.length - 6, "+") : null))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(TopicSummaryItem, {
    topicItems: topic.summaryItems,
    key: index
  })))), pendingMatters.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px] mb-[16px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Actions Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_actions_png__WEBPACK_IMPORTED_MODULE_14__,
    alt: ""
  })), (pendingMatters || []).map(item => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryPenddingItem, {
    pendingItem: item,
    key: item.chatId
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_9__["default"], {
    canCopy: true,
    canVoice: true,
    canDelete: true,
    onDelete: deleteMessage,
    message: {
      id: messageId
    }
  }));
};
const SummaryContent = ({
  messageId,
  summaryInfo,
  summaryTopic,
  summaryTopicByTopic,
  summaryTemplate,
  pendingMatters,
  garbageMessage,
  deleteMessage
}) => {
  const isChatTemplate = summaryTemplate === 'summary-by-chat';
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, isChatTemplate ? !summaryTopic.length && !pendingMatters.length ? null : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(MainSummaryByChatContent, {
    messageId: messageId,
    summaryInfo: summaryInfo,
    summaryTopic: summaryTopic,
    pendingMatters: pendingMatters,
    deleteMessage: deleteMessage
  }) : !summaryTopicByTopic.length && !pendingMatters.length ? null : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(MainSummaryByTopicContent, {
    messageId: messageId,
    summaryInfo: summaryInfo,
    topics: summaryTopicByTopic,
    pendingMatters: pendingMatters,
    deleteMessage: deleteMessage
  }), garbageMessage && garbageMessage.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-max-[693px] rounded-[10px] bg-[var(--color-background)] pl-[82px] pr-[25px] pt-[20px] pb-[25px] mt-[10px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[52px] h-[52px] rounded-full ml-[-60px]",
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_18__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[16px] font-semibold"
  }, "TelyAI"), summaryInfo?.summaryEndTime ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[14px] text-[#A8A6AC]"
  }, (0,_utils_util__WEBPACK_IMPORTED_MODULE_8__.formatTimestamp)(summaryInfo.summaryEndTime)) : null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[22px] font-bold mb-[16px]"
  }, "Spam Filtering"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[20px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_calendar_png__WEBPACK_IMPORTED_MODULE_15__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "mr-[4px]"
  }, "Time range:"), formatTimestampRange(summaryInfo?.summaryStartTime, summaryInfo?.summaryEndTime)))), (garbageMessage || []).map(item => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryGarbageItem, {
    garBageItem: item,
    key: item.chatId
  }))));
};
const GlobalSummaryMessage = props => {
  const {
    message,
    deleteMessage
  } = props;
  const [summaryInfo, setSummaryInfo] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
  const [pendingMatters, setPendingMatters] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [garbageMessage, setGarbageMessage] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [summaryTopic, setSummaryTopic] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [summaryTopicByTopic, setSummaryTopicByTopic] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [summaryTemplate, setSummaryTemplate] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('summary-by-chat');
  const parseMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(messageContent => {
    const messageObj = JSON.parse(messageContent);
    const {
      mainTopic = [],
      pendingMatters,
      garbageMessage,
      customTopic = [],
      summaryInfo,
      summaryTemplate = 'summary-by-chat'
    } = messageObj;
    if (pendingMatters) {
      setPendingMatters(pendingMatters);
    }
    if (garbageMessage) {
      setGarbageMessage(garbageMessage);
    }
    if (summaryInfo) {
      setSummaryInfo(summaryInfo);
    }
    setSummaryTemplate(summaryTemplate);
    if (summaryTemplate === 'summary-by-topic') {
      const topics = [...(mainTopic || []), ...(customTopic || [])];
      setSummaryTopicByTopic(topics);
      setSummaryTopic([]);
    } else {
      const mergeSummaryTopics = mergeTopics(mainTopic, customTopic);
      setSummaryTopic(mergeSummaryTopics);
      setSummaryTopicByTopic([]);
    }
  }, []);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    try {
      parseMessage(message.content);
    } catch (error) {
      // eslint-disable-next-line no-console
      console.error(error);
    }
  }, [message, parseMessage]);
  if (!summaryInfo) {
    return null;
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryContent, {
    messageId: message.id,
    summaryInfo: summaryInfo,
    summaryTopic: summaryTopic,
    summaryTopicByTopic: summaryTopicByTopic,
    summaryTemplate: summaryTemplate,
    pendingMatters: pendingMatters,
    garbageMessage: garbageMessage,
    deleteMessage: deleteMessage
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GlobalSummaryMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/google-event-create-messages.tsx"
/*!********************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/google-event-create-messages.tsx ***!
  \********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   FormLabel: () => (/* binding */ FormLabel),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/button/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/config-provider/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/date-picker/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/input/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/select/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/theme/index.js");
/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! dayjs */ "./node_modules/dayjs/dayjs.min.js");
/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../icons */ "./src/components/chatAssistant/icons.tsx");
/* harmony import */ var _utils_google_api__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../utils/google-api */ "./src/components/chatAssistant/utils/google-api.ts");
/* harmony import */ var _utils_google_auth__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../utils/google-auth */ "./src/components/chatAssistant/utils/google-auth.ts");
/* harmony import */ var _utils_time_zones__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../utils/time-zones */ "./src/components/chatAssistant/utils/time-zones.ts");
/* harmony import */ var _assets_calendar_png__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../assets/calendar.png */ "./src/components/chatAssistant/assets/calendar.png");
/* harmony import */ var _assets_default_avatar_png__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../assets/default-avatar.png */ "./src/components/chatAssistant/assets/default-avatar.png");
/* harmony import */ var _assets_google_meet_png__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../assets/google-meet.png */ "./src/components/chatAssistant/assets/google-meet.png");
/* harmony import */ var _assets_user_png__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../assets/user.png */ "./src/components/chatAssistant/assets/user.png");
/* harmony import */ var _assets_write_png__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../assets/write.png */ "./src/components/chatAssistant/assets/write.png");
/* eslint-disable no-console */

















const FormLabel = props => {
  const [title, setTitle] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [icon, setIcon] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const {
    lable: label
  } = props;
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    switch (label) {
      case 'title':
        setIcon(_assets_write_png__WEBPACK_IMPORTED_MODULE_19__);
        setTitle('Title');
        break;
      case 'time':
        setIcon(_assets_calendar_png__WEBPACK_IMPORTED_MODULE_15__);
        setTitle('Time');
        break;
      case 'guests':
        setIcon(_assets_user_png__WEBPACK_IMPORTED_MODULE_18__);
        setTitle('Guests');
        break;
      case 'meet':
        setIcon(_assets_google_meet_png__WEBPACK_IMPORTED_MODULE_17__);
        setTitle('Meeting link');
        break;
    }
  }, [label]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: icon,
    alt: "",
    className: "w-[16px] h-[16px]"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px] font-semibold"
  }, title));
};
const ErrorTip = ({
  message
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[12px] leading-[18px] text-red-400"
  }, message);
};
const EmailItem = ({
  email,
  onDelete
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px] py-[10px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[24px] h-[24px] rounded-full",
    src: _assets_default_avatar_png__WEBPACK_IMPORTED_MODULE_16__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px] text-black overflow-hidden text-ellipsis"
  }, email), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "ml-auto cursor-pointer w-[20px] h-[20px] rounded-full text-[#979797] bg-[#F3F3F3] flex items-center justify-center",
    onClick: () => onDelete(email)
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_11__.CloseIcon, {
    size: 14
  })));
};
const GoogleEventCreateMessage = ({
  message
}) => {
  const disabledDate = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(current => {
    // Can not select days before today and today
    return current && current < dayjs__WEBPACK_IMPORTED_MODULE_7___default()().startOf('day');
  }, []);
  const {
    options: timeZoneOptions,
    parseTimezone
  } = (0,_utils_time_zones__WEBPACK_IMPORTED_MODULE_14__.useTimezoneSelect)();
  const {
    RangePicker
  } = antd__WEBPACK_IMPORTED_MODULE_3__["default"];
  const [title, setTitle] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [email, setEmail] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [startDate, setStartDate] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [endDate, setEndDate] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [emails, setEmails] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [emailError, setEmailError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [dateError, setDateError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [titleError, setTitleError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [isSubmitting, setIsSubmitting] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [selectedTimezone, setSelectedTimezone] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(Intl.DateTimeFormat().resolvedOptions().timeZone);
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_8__.getGlobal)();
  const themeKey = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_10__.selectTheme)(global);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    console.log('selectedTimezone', selectedTimezone);
  }, [selectedTimezone]);
  const validateEmail = email => {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  };
  const handleTitleChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    setTitle(e.target.value);
    if (e.target.value) {
      setTitleError('');
    }
  }, []);
  const handleTimeZoomChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(timeZone => {
    setSelectedTimezone(timeZone);
  }, []);
  const handleTimeChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((dates, dateStrings) => {
    if (dates) {
      console.log('From: ', dates[0], ', to: ', dates[1]);
      console.log('From: ', dateStrings[0], ', to: ', dateStrings[1]);
      setStartDate(dateStrings[0]);
      setEndDate(dateStrings[1]);
      setDateError('');
    }
  }, []);
  const handleEmailChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    setEmail(e.target.value);
  }, []);
  const handleEmailComplete = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    const emailStr = e.target.value;
    if (!emailStr) {
      setEmail('');
      return;
    }
    if (validateEmail(emailStr)) {
      setEmails(prev => [...prev, emailStr]);
      setEmail('');
      setEmailError('');
    } else {
      setEmailError('Please enter the correct email address');
    }
  }, []);
  const handleEmailEnter = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    const emailStr = e.currentTarget.value;
    if (!emailStr) {
      setEmail('');
      return;
    }
    if (validateEmail(emailStr)) {
      setEmails(prev => [...prev, emailStr]);
      setEmail('');
      setEmailError('');
    } else {
      setEmailError('Please enter the correct email address');
    }
  }, []);
  const handleDeleteEmail = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(email => {
    setEmails(prev => prev.filter(item => item !== email));
  }, []);
  const handleSubmit = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (isSubmitting) {
      return;
    }
    if (!title) {
      setTitleError('Please enter the title');
      return;
    }
    if (!startDate || !endDate) {
      setDateError('Please select the date');
      return;
    }
    if (!emails.length) {
      setEmailError('Please enter the email');
      return;
    }
    setIsSubmitting(true);
    const auth = (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_13__.getAuthState)();
    const attendees = [];
    if (emails.length) {
      emails.forEach(email => {
        attendees.push({
          email
        });
      });
    }
    (0,_utils_google_api__WEBPACK_IMPORTED_MODULE_12__.createGoogleMeet)({
      title,
      startDate: new Date(startDate),
      endDate: new Date(endDate),
      selectedTimezone,
      emails,
      // eslint-disable-next-line @typescript-eslint/no-non-null-asserted-optional-chain
      googleToken: auth?.accessToken
    }).then(res => {
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_9__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_9__.Actions.CreateCalendarSuccess, {
        message,
        response: res
      });
    }).catch(err => {
      console.log(err);
    }).finally(() => {
      setIsSubmitting(false);
    });
  }, [emails, endDate, isSubmitting, message, selectedTimezone, startDate, title]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_2__["default"], {
    theme: {
      algorithm: themeKey === 'dark' ? antd__WEBPACK_IMPORTED_MODULE_6__["default"].darkAlgorithm : antd__WEBPACK_IMPORTED_MODULE_6__["default"].defaultAlgorithm
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "google-event-create-message px-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "p-[10px] border border-solid border-[#D9D9D9] rounded-[16px] w-[326px] bg-white dark:bg-[#292929] dark:border-[#292929]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px] font-semibold mb-[16px]"
  }, "Please tell me the event details. "), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[8px] mb-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FormLabel, {
    lable: "title"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_4__["default"], {
    value: title,
    onChange: handleTitleChange
  }), titleError && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ErrorTip, {
    message: titleError
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[8px] mb-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FormLabel, {
    lable: "time"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(RangePicker, {
    disabledDate: disabledDate,
    presets: [{
      label: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
        "aria-label": "Current Time to End of Day"
      }, "Now ~ EOD"),
      value: () => [dayjs__WEBPACK_IMPORTED_MODULE_7___default()(), dayjs__WEBPACK_IMPORTED_MODULE_7___default()().endOf('day')] // 5.8.0+ support function
    }],
    showTime: true,
    format: "YYYY/MM/DD HH:mm",
    onChange: handleTimeChange
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_5__["default"], {
    className: "w-full",
    placeholder: "Please select",
    onChange: handleTimeZoomChange,
    options: timeZoneOptions,
    value: parseTimezone(selectedTimezone)
  })), dateError && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ErrorTip, {
    message: dateError
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[8px] mb-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FormLabel, {
    lable: "guests"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_4__["default"], {
    value: email,
    onChange: handleEmailChange,
    onBlur: handleEmailComplete,
    onPressEnter: handleEmailEnter
  }), emailError && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ErrorTip, {
    message: emailError
  }), emails.length > 0 && emails.map(email => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(EmailItem, {
    email: email,
    key: email,
    onDelete: handleDeleteEmail
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    type: "primary",
    className: "!bg-[#8C42F0] w-full",
    htmlType: "submit",
    onClick: handleSubmit,
    loading: isSubmitting,
    disabled: isSubmitting
  }, "Confirm"))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GoogleEventCreateMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/google-event-detail-message.tsx"
/*!*******************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/google-event-detail-message.tsx ***!
  \*******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var html_to_image__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! html-to-image */ "./node_modules/html-to-image/es/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _utils_meeting_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/meeting-utils */ "./src/components/chatAssistant/utils/meeting-utils.ts");
/* harmony import */ var _google_event_create_messages__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./google-event-create-messages */ "./src/components/chatAssistant/messages/google-event-create-messages.tsx");
/* harmony import */ var _message_actions_button__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./message-actions-button */ "./src/components/chatAssistant/messages/message-actions-button.tsx");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _assets_share_header_bg_png__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../assets/share-header-bg.png */ "./src/components/chatAssistant/assets/share-header-bg.png");
/* eslint-disable max-len */
/* eslint-disable no-console */
/* eslint-disable no-null/no-null */










const GoogleEventDetailMessage = ({
  message
}) => {
  const [capturing, setCapturing] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const parsedMessage = JSON.parse(message.content);
  const {
    eventData,
    chatId
  } = parsedMessage;
  if (!eventData) {
    return null;
  }
  const contentJSX = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_google_event_create_messages__WEBPACK_IMPORTED_MODULE_5__.FormLabel, {
    lable: "title",
    "data-readable": true
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px]",
    "data-readable": true
  }, eventData?.summary)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_google_event_create_messages__WEBPACK_IMPORTED_MODULE_5__.FormLabel, {
    lable: "time",
    "data-readable": true
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px]",
    "data-readable": true
  }, (0,_utils_meeting_utils__WEBPACK_IMPORTED_MODULE_4__.formatMeetingTimeRange)(eventData.start.dateTime, eventData.end.dateTime)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px] text-[#979797]",
    "data-readable": true
  }, (0,_utils_meeting_utils__WEBPACK_IMPORTED_MODULE_4__.formatTimeZone)(eventData.start.timeZone)))), eventData?.attendees?.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_google_event_create_messages__WEBPACK_IMPORTED_MODULE_5__.FormLabel, {
    lable: "guests",
    "data-readable": true
  }), eventData?.attendees?.map(attendee => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px]",
    key: attendee.email,
    "data-readable": true
  }, attendee.email))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_google_event_create_messages__WEBPACK_IMPORTED_MODULE_5__.FormLabel, {
    lable: "meet",
    "data-readable": true
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px]",
    "data-readable": true
  }, eventData?.hangoutLink)));
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex-col gap-[12px] p-[10px] border border-solid  border-[#D9D9D9] rounded-[16px] w-[326px] bg-white dark:bg-[#292929] dark:border-[#292929]",
    "data-message-container": true
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[14px] font-semibold",
    "data-readable": true
  }, "Event details"), contentJSX, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_6__["default"], {
    canCopy: true,
    canVoice: true,
    canShare: true,
    message: message
    // eslint-disable-next-line react/jsx-no-bind
    ,
    onClickShare: () => {
      // setCapturing(true);
      (0,_utils_meeting_utils__WEBPACK_IMPORTED_MODULE_4__.generateEventScreenshot)(eventData, chatId);
    }
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ShareCard, {
    capturing: capturing
    // eslint-disable-next-line react/jsx-no-bind
    ,
    captureCallback: () => {
      setCapturing(false);
    }
  }, contentJSX));
};
function ShareCard({
  capturing = false,
  children,
  captureCallback = () => {}
}) {
  const domRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  const {
    currentUserId
  } = global;
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, currentUserId);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (domRef.current) {
      setTimeout(() => {
        (0,html_to_image__WEBPACK_IMPORTED_MODULE_1__.toBlob)(domRef.current, {
          width: 330,
          pixelRatio: 2,
          // Higher pixel ratio for better quality
          quality: 1 // Maximum quality
        }).then(blob => {
          // return 123;
          const file = new File([blob], 'telyai.org.png', {
            type: 'image/png'
          });
          // @ts-ignore
          globalThis?.p__handleFileSelect?.([file], true);
          captureCallback();
        });
      }, 100);
    }
  }, [capturing, captureCallback]);
  if (!capturing) return null;
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "fixed top-0 left-0 translate-x-[-1000000px] translate-y-[-100000px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    ref: domRef,
    className: "relative w-[330px] box-content overflow-hidden bg-white text-black"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "absolute top-0 left-0 w-full blur-xl pointer-events-none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _assets_share_header_bg_png__WEBPACK_IMPORTED_MODULE_9__,
    alt: "",
    className: "w-full"
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "relative py-3 px-4 flex flex-col gap-2"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row justify-end items-center gap-2 text-xs text-[#979797]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_7__["default"], {
    className: "w-[20px] h-[20px]",
    peer: currentUser
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, currentUser?.firstName), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, currentUser?.lastName)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-[20px] font-bold"
  }, "Meeting Invitation"), children), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("section", {
    className: "flex flex-row gap-1 items-center justify-center py-2 text-xs bg-[#F7FAFF]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "inline w-[20px] h-[20px] rounded-full",
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_8__,
    alt: "Serena"
  }), "Powered by", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[#2996FF]"
  }, "telepgt.org"))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GoogleEventDetailMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/google-login-auth-message.tsx"
/*!*****************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/google-login-auth-message.tsx ***!
  \*****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/button/index.js");
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/message/index.js");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _utils_google_api__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/google-api */ "./src/components/chatAssistant/utils/google-api.ts");
/* harmony import */ var _utils_google_auth__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/google-auth */ "./src/components/chatAssistant/utils/google-auth.ts");
/* harmony import */ var _assets_google_png__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../assets/google.png */ "./src/components/chatAssistant/assets/google.png");







const GoogleLoginAuthMessage = props => {
  const {
    deleteMessage
  } = props;
  const handleAuth = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_ELECTRON) {
      window.electron.googleLogin().then(res => {
        const authState = {
          isLoggedIn: true,
          accessToken: res.access_token,
          idToken: res.id_token,
          grantedScopes: res.scope,
          expiresAt: res.expiry_date
        };
        (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_6__.setAuthState)(authState);
        _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__.Actions.GoogleAuthSuccess);
        deleteMessage();
      }).catch(error => {
        console.error('Google login failed:', error);
      });
    } else {
      (0,_utils_google_api__WEBPACK_IMPORTED_MODULE_5__.loginWithGoogle)().then(authState => {
        console.log(authState);
        _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_3__.Actions.GoogleAuthSuccess);
        deleteMessage();
      }).catch(error => {
        console.error('Google login failed:', error);
        antd__WEBPACK_IMPORTED_MODULE_2__["default"].info('Google login failed');
      });
    }
  }, [deleteMessage]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "p-[10px] border-solid border-[#D9D9D9] rounded-[16px] w-[316px] bg-white dark:bg-[#292929]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, "This service requires access to your Google Calendar."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
    className: "w-auto mt-[4px] flex items-center cursor-pointer hover:opacity-80 hover:!bg-[#F3F3F3]  gap-[8px] bg-[#F3F3F3] px-[12px] py-[10px] rounded-[6px] dark:!bg-[#383838] h-[36px] border-none",
    onClick: handleAuth
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _assets_google_png__WEBPACK_IMPORTED_MODULE_7__,
    alt: "",
    className: "w-[16px] h-[16px]"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[var(--color-text)]"
  }, "Google authorization"))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GoogleLoginAuthMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/google-meet-information-suggest-message.tsx"
/*!*******************************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/google-meet-information-suggest-message.tsx ***!
  \*******************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _store_messages_store__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../store/messages-store */ "./src/components/chatAssistant/store/messages-store.ts");
/* harmony import */ var _utils_user_information_collection__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/user-information-collection */ "./src/components/chatAssistant/utils/user-information-collection.ts");
/* eslint-disable max-len */
/* eslint-disable react/no-unescaped-entities */







const GoogleMeetInformationSuggestMessage = ({
  message
}) => {
  const {
    chatId,
    messageId,
    emailConfirmed,
    calendlyConfirmed,
    suggestType
  } = JSON.parse(message.content) || {};
  const [mergeEmailConfirmed, setMergeEmailConfirmed] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(emailConfirmed);
  const [mergeCalendlyConfirmed, setMergeCalendlyConfirmed] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(calendlyConfirmed);
  const {
    emails,
    calendlyUrls
  } = _utils_user_information_collection__WEBPACK_IMPORTED_MODULE_6__.userInformationCollection.informations;
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const renderName = () => {
    const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, chatId);
    const fullName = user ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(user) : '';
    return fullName;
  };
  const handleCalendlyUrlClick = url => {
    if (mergeCalendlyConfirmed) {
      return;
    }
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().sendMessage({
      messageList: {
        chatId,
        threadId: '-1',
        type: 'thread'
      },
      text: url
    });
    setMergeCalendlyConfirmed(true);
    message.content = JSON.stringify({
      chatId,
      messageId,
      emailConfirmed,
      calendlyConfirmed: true,
      suggestType
    });
    _store__WEBPACK_IMPORTED_MODULE_4__.ChataiStores?.message?.storeMessage((0,_store_messages_store__WEBPACK_IMPORTED_MODULE_5__.parseMessage2StoreMessage)(chatId, [message])[0]);
  };
  const handleEmailClick = email => {
    if (mergeEmailConfirmed) {
      return;
    }
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().sendMessage({
      messageList: {
        chatId,
        threadId: '-1',
        type: 'thread'
      },
      text: email
    });
    setMergeEmailConfirmed(true);
    message.content = JSON.stringify({
      chatId,
      messageId,
      emailConfirmed: true,
      calendlyConfirmed,
      suggestType
    });
    _store__WEBPACK_IMPORTED_MODULE_4__.ChataiStores?.message?.storeMessage((0,_store_messages_store__WEBPACK_IMPORTED_MODULE_5__.parseMessage2StoreMessage)(chatId, [message])[0]);
  };
  if (suggestType === 'both' && !calendlyUrls.length && !emails.length) {
    return undefined;
  } else if (suggestType === 'email' && !emails.length) {
    return undefined;
  } else if (suggestType === 'time' && !calendlyUrls.length) {
    return undefined;
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[12px] text-[15px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "p-[10px] border border-solid border-[#D9D9D9] rounded-[16px] w-full bg-white dark:bg-[#292929] dark:border-[#292929]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", null, "\uD83D\uDD14 ", renderName(), " would like to schedule a meeting with you. Would you like to send your calendar link or email address?"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "list-disc pl-[18px] mb-[4px]"
  }, (suggestType === 'both' || suggestType === 'time') && calendlyUrls.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("b", {
    className: "ml-[-18px]"
  }, "Calendars:"), calendlyUrls.map(url => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
      className: "word-break break-all"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[12px] mr-[4px]"
    }, "\uD83D\uDCC5"), url), !mergeCalendlyConfirmed && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "mx-[2px] font-semibold cursor-pointer ml-[4px] outline-none border-none focus:outline-none focus:ring-0 underline decoration-2",
      onClick: () => handleCalendlyUrlClick(url)
    }, "Send\uD83D\uDC49"));
  })), (suggestType === 'both' || suggestType === 'email') && emails.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("b", {
    className: "ml-[-18px]"
  }, "Emails:"), emails.map(email => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
      className: "word-break break-all"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[12px] mr-[4px]"
    }, "\u2709\uFE0F"), email), !mergeEmailConfirmed && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "mx-[2px] font-semibold cursor-pointer ml-[4px] outline-none border-none focus:outline-none focus:ring-0 underline decoration-2",
      onClick: () => handleEmailClick(email)
    }, "Send\uD83D\uDC49"));
  })))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GoogleMeetInformationSuggestMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/google-meet-mention-message.tsx"
/*!*******************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/google-meet-mention-message.tsx ***!
  \*******************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _store_messages_store__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../store/messages-store */ "./src/components/chatAssistant/store/messages-store.ts");
/* harmony import */ var _utils_google_api__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../utils/google-api */ "./src/components/chatAssistant/utils/google-api.ts");
/* harmony import */ var _utils_google_auth__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../utils/google-auth */ "./src/components/chatAssistant/utils/google-auth.ts");
/* harmony import */ var _utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../utils/schedule-meeting */ "./src/components/chatAssistant/utils/schedule-meeting.ts");
/* eslint-disable react/no-unescaped-entities */










const GoogleMeetMentionMessage = ({
  message
}) => {
  const {
    chatId,
    messageId,
    isConfirmed
  } = JSON.parse(message.content) || {};
  const [mergeConfirmed, setMergeConfirmed] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(isConfirmed);
  const renderName = () => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
    const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, chatId);
    const fullName = user ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserFullName)(user) : '';
    return fullName;
  };
  const handleConfirm = () => {
    // TODO: get meeting info from recent message
    const scheduleMeeting = _utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_9__["default"].create({
      chatId
    });
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
    const targetMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessage)(global, chatId, Number(messageId));
    scheduleMeeting.handleTargetMessage(targetMessage);
    setMergeConfirmed(true);
    message.content = JSON.stringify({
      chatId,
      messageId,
      isConfirmed: true
    });
    _store__WEBPACK_IMPORTED_MODULE_5__.ChataiStores?.message?.storeMessage((0,_store_messages_store__WEBPACK_IMPORTED_MODULE_6__.parseMessage2StoreMessage)(chatId, [message])[0]);
  };
  const handleClick = async () => {
    if (mergeConfirmed) {
      return;
    }
    if (!chatId || !messageId) {
      return;
    }
    const auth = (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_8__.getAuthState)();
    if (!auth || !(await (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_8__.isTokenValid)(auth))) {
      (0,_utils_google_api__WEBPACK_IMPORTED_MODULE_7__.createAuthConfirmModal)({
        onOk: () => {
          handleConfirm();
        }
      });
    } else {
      handleConfirm();
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[12px] text-[15px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "p-[10px] border border-solid border-[#D9D9D9] rounded-[16px] w-full bg-white dark:bg-[#292929] dark:border-[#292929]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, "\uD83D\uDD14 I noticed that", ' ', renderName(), ' ', "wants to schedule a meeting with you. Would you like me to help set it up?"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, "\uD83D\uDC49 Click", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: classnames__WEBPACK_IMPORTED_MODULE_1___default()('cursor-pointer mx-[2px] outline-none border-none focus:outline-none focus:ring-0', {
      'underline decoration-2': !mergeConfirmed
    }),
    onClick: handleClick
  }, "\"Yes\""), "to proceed, or ignore this message.")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GoogleMeetMentionMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/google-meet-time-confirm-message.tsx"
/*!************************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/google-meet-time-confirm-message.tsx ***!
  \************************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _store_messages_store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../store/messages-store */ "./src/components/chatAssistant/store/messages-store.ts");
/* harmony import */ var _utils_google_api__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/google-api */ "./src/components/chatAssistant/utils/google-api.ts");
/* harmony import */ var _utils_google_auth__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/google-auth */ "./src/components/chatAssistant/utils/google-auth.ts");
/* harmony import */ var _utils_meeting_utils__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../utils/meeting-utils */ "./src/components/chatAssistant/utils/meeting-utils.ts");
/* harmony import */ var _utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../utils/schedule-meeting */ "./src/components/chatAssistant/utils/schedule-meeting.ts");










// 格式化会议时间，返回相对日期和时间范围
function formatMeetingTime(startTime, duration = 1800) {
  const startDate = new Date(startTime);
  const endDate = new Date(new Date(startTime).getTime() + duration * 1000);

  // 获取当前日期
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  // 获取明天日期
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);

  // 格式化时间
  const timeFormatter = new Intl.DateTimeFormat('en-US', {
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  });
  const startTimeStr = timeFormatter.format(startDate);
  const endTimeStr = timeFormatter.format(endDate);

  // 格式化日期
  let datePrefix = '';
  const startDateCopy = new Date(startDate);
  startDateCopy.setHours(0, 0, 0, 0);
  if (startDateCopy.getTime() === today.getTime()) {
    datePrefix = 'Today';
  } else if (startDateCopy.getTime() === tomorrow.getTime()) {
    datePrefix = 'Tomorrow';
  } else {
    // 检查是否在当前周内
    const dayDiff = Math.floor((startDateCopy.getTime() - today.getTime()) / (24 * 60 * 60 * 1000));
    if (dayDiff >= 0 && dayDiff < 7) {
      // 如果在当前周内，显示星期几
      const weekdayFormatter = new Intl.DateTimeFormat('en-US', {
        weekday: 'long'
      });
      datePrefix = weekdayFormatter.format(startDate);
    } else {
      // 如果不是当前周内的日期，则使用月份和日期
      const monthFormatter = new Intl.DateTimeFormat('en-US', {
        month: 'long'
      });
      datePrefix = `${monthFormatter.format(startDate)} ${startDate.getDate()}`;
    }
  }
  return `${datePrefix} ${startTimeStr}–${endTimeStr}`;
}
const GoogleMeetTimeConfirmMessage = ({
  message
}) => {
  const {
    content
  } = message;
  const {
    chatId,
    startTime,
    duration,
    email,
    timeZone,
    isConfirmed
  } = JSON.parse(content || '{}') || {};
  const [mergeConfirmed, setMergeConfirmed] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(isConfirmed);
  const handleCreateGoogleMeet = ({
    token,
    start,
    end,
    email
  }) => {
    (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)().sendMessage({
      messageList: {
        chatId,
        threadId: '-1',
        type: 'thread'
      },
      text: _utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_8__.MEETING_INVITATION_TIP
    });
    (0,_utils_google_api__WEBPACK_IMPORTED_MODULE_5__.createGoogleMeet)({
      startDate: new Date(start),
      endDate: new Date(end),
      selectedTimezone: timeZone,
      // Add timezone
      emails: email,
      googleToken: token
    }).then(createMeetResponse => {
      // console.log('createMeetResponse', createMeetResponse);
      if (createMeetResponse) {
        (0,_utils_meeting_utils__WEBPACK_IMPORTED_MODULE_7__.generateEventScreenshot)(createMeetResponse, chatId);
      }
    });
  };
  const handleTimeSelect = async time => {
    if (mergeConfirmed) {
      return;
    }
    if (email.length > 0 && timeZone && duration) {
      const auth = (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_6__.getAuthState)();
      const createMeetParams = {
        token: auth?.accessToken || '',
        start: time,
        end: new Date(new Date(time).getTime() + duration * 1000).toISOString(),
        email
      };
      if (!auth || !(await (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_6__.isTokenValid)(auth))) {
        (0,_utils_google_api__WEBPACK_IMPORTED_MODULE_5__.createAuthConfirmModal)({
          onOk: accessToken => {
            createMeetParams.token = accessToken;
            handleCreateGoogleMeet(createMeetParams);
          }
        });
      } else {
        handleCreateGoogleMeet(createMeetParams);
      }
    } else {
      const scheduleMeeting = _utils_schedule_meeting__WEBPACK_IMPORTED_MODULE_8__["default"].create({
        chatId
      });
      const confirmParams = {
        startTime: [time],
        email,
        timeZone,
        duration,
        timeConfirmed: true
      };
      const auth = (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_6__.getAuthState)();
      if (!auth || !(await (0,_utils_google_auth__WEBPACK_IMPORTED_MODULE_6__.isTokenValid)(auth))) {
        (0,_utils_google_api__WEBPACK_IMPORTED_MODULE_5__.createAuthConfirmModal)({
          onOk: () => {
            scheduleMeeting.timeConfirmCallback(confirmParams);
          }
        });
      } else {
        scheduleMeeting.timeConfirmCallback(confirmParams);
      }
    }
    message.content = JSON.stringify({
      chatId,
      startTime,
      email,
      isConfirmed: true
    });
    _store__WEBPACK_IMPORTED_MODULE_3__.ChataiStores?.message?.storeMessage((0,_store_messages_store__WEBPACK_IMPORTED_MODULE_4__.parseMessage2StoreMessage)(chatId, [message])[0]);
    setMergeConfirmed(true);
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[12px] text-[14px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "p-[10px] border border-solid border-[#D9D9D9] rounded-[16px] w-[326px] bg-white dark:bg-[#292929] dark:border-[#292929]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, "\uD83D\uDCC5 I\u2019ve checked your calendar. Here are some available time slots in the coming days:"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "list-decimal pl-[18px] mb-[4px]"
  }, startTime && startTime.map((item, index) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
      key: index
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: classnames__WEBPACK_IMPORTED_MODULE_1___default()('font-semibold cursor-pointer bg-transparent border-none p-0', {
        'underline decoration-2': !mergeConfirmed
      }),
      onClick: () => handleTimeSelect(item)
    }, formatMeetingTime(item, duration)));
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, "Which time would you like to choose? Or \uD83D\uDCC6 "), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("a", {
    href: "https://calendar.google.com/",
    target: "_blank",
    className: "underline decoration-2 font-semibold",
    rel: "noreferrer"
  }, "View Full Calendar"))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GoogleMeetTimeConfirmMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/group-search-message.tsx"
/*!************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/group-search-message.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GroupSearchMessage: () => (/* binding */ GroupSearchMessage)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hook_useOldLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../hook/useOldLang */ "./src/components/chatAssistant/hook/useOldLang.ts");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* eslint-disable max-len */
/* eslint-disable no-null/no-null */







const GroupSearchMessage = ({
  message
}) => {
  const [chatIds, setChatIds] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const lang = (0,_hook_useOldLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const handleClick = chatId => {
    const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
    if (chat) {
      (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openChat({
        id: chatId
      });
    }
  };
  const renderChatAvatar = chatId => {
    if ((0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_6__.isUserId)(chatId)) {
      return null;
    }
    let membersCount;
    let title;
    const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
    if (chat) {
      membersCount = chat?.membersCount;
      title = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, chat);
    } else {
      return null;
    }
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex flex-row items-center gap-[8px] cursor-pointer px-[12px] py-[8px] rounded-[12px] hover:bg-[#D9D9D9]",
      onClick: () => {
        handleClick(chatId);
      }
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_5__["default"], {
      key: chatId,
      className: "overlay-avatar inline-block cursor-pointer",
      size: 44,
      peer: chat
    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex flex-col justify-center gap-[4px]"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[15px] font-semibold text-black leading-[18px]"
    }, title), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[14px] text-[#5E6272] leading-[18px]"
    }, membersCount, " Members")));
  };
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    try {
      const ids = JSON.parse(message.content);
      setChatIds(ids || []);
    } catch (error) {
      // eslint-disable-next-line no-console
      console.log(error);
    }
  }, [message]);
  if (chatIds.length === 0) {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, "\u672A\u627E\u5230\u76F8\u5173\u7FA4\u7EC4");
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "p-[10px] mx-[22px] rounded-[16px] border-[1px] border-[#D9D9D9] bg-white dark:bg-[#292929]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[12px]"
  }, chatIds.splice(0, 10).map(id => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, renderChatAvatar(id));
  })));
};

/***/ },

/***/ "./src/components/chatAssistant/messages/introduce-actions-message.tsx"
/*!*****************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/introduce-actions-message.tsx ***!
  \*****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _assets_summary_introduce_actions_png__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../assets/summary-introduce/actions.png */ "./src/components/chatAssistant/assets/summary-introduce/actions.png");
/* eslint-disable max-len */


const listStyle = 'text-[15px] text-[var(--color-text)]';
const IntroduceActionsMessage = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] w-[488px] bg-[var(--color-background)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _assets_summary_introduce_actions_png__WEBPACK_IMPORTED_MODULE_1__,
    alt: "",
    className: "w-[490px] h-[259px]"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "py-[14px] px-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", null, "\u2705  Action Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: listStyle
  }, "During message summarization, the AI assistant automatically identifies actionable tasks and follow-ups from your chats. No need to take notes\u2014your to-do list is generated in real time, helping you stay organized and never miss a beat.")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (IntroduceActionsMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/introduce-meeting-message.tsx"
/*!*****************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/introduce-meeting-message.tsx ***!
  \*****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _assets_summary_introduce_schedule_meeting_png__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../assets/summary-introduce/schedule-meeting.png */ "./src/components/chatAssistant/assets/summary-introduce/schedule-meeting.png");
/* eslint-disable max-len */


const listStyle = 'text-[15px] text-[var(--color-text)]';
const IntroduceMeetingMessage = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] w-[488px] bg-[var(--color-background)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _assets_summary_introduce_schedule_meeting_png__WEBPACK_IMPORTED_MODULE_1__,
    alt: "",
    className: "w-[490px] h-[259px]"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "py-[14px] px-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", null, "\uD83D\uDD25 Meeting Scheduler \uD83D\uDD25"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "pl-[24px] list-disc"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, "Automatic Detection & Smart Coordination The AI assistant instantly recognizes meeting-related messages, asks for time, participants, and other details\u2014all through natural chat flow."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, "Instant Invite Delivery Once confirmed, it auto-generates and sends calendar invites, keeping everyone in sync without ever leaving the conversation."))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (IntroduceMeetingMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/introduce-summary-message.tsx"
/*!*****************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/introduce-summary-message.tsx ***!
  \*****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _assets_summary_introduce_summarize_png__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../assets/summary-introduce/summarize.png */ "./src/components/chatAssistant/assets/summary-introduce/summarize.png");
/* eslint-disable max-len */


const listStyle = 'text-[15px] text-[var(--color-text)]';
const IntroduceSummaryMessage = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] w-[488px] bg-[var(--color-background)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _assets_summary_introduce_summarize_png__WEBPACK_IMPORTED_MODULE_1__,
    alt: "",
    className: "w-[490px] h-[259px]"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "py-[14px] px-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", null, "\uD83D\uDD25 Message Summarization \uD83D\uDD25"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: listStyle
  }, "The Message Summarization feature uses AI to automatically extract key content from IM conversations and periodically generate summary reports. It helps users efficiently grasp important group updates, improve information retrieval, and avoid missing critical messages."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", null, "\uD83D\uDD11 Key Capabilities:"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "pl-[24px] list-disc"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, "\uD83D\uDD0D Automatically extracts topics, key figures, time references, and user insights from chat messages"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, "\uD83E\uDDE0 Intelligently identifies and groups content by chat, ensuring clarity and structure"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, "\uD83D\uDD52 Automatically generates summary reports during active hours, adapting to peak and off-peak periods"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, "\uD83C\uDFAF Supports personalized summary customization, allowing users to focus on specific chats or content types"))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (IntroduceSummaryMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/introduce-translation-message.tsx"
/*!*********************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/introduce-translation-message.tsx ***!
  \*********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _assets_summary_introduce_summarize_png__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../assets/summary-introduce/summarize.png */ "./src/components/chatAssistant/assets/summary-introduce/summarize.png");
/* eslint-disable max-len */


const listStyle = 'text-[15px] text-[var(--color-text)]';
const IntroduceTranslationMessage = () => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] w-[488px] bg-[var(--color-background)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _assets_summary_introduce_summarize_png__WEBPACK_IMPORTED_MODULE_1__,
    alt: "",
    className: "w-[490px] h-[259px]"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "py-[14px] px-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", null, "\uD83D\uDD25 Real-time Translation \uD83D\uDD25"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "pl-[24px] list-disc"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("b", null, "Instant Translation While Typing:"), " Automatically detects the source language and translates it into the target language in real time."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("b", null, "Multi-language Support:"), " Covers major languages, including English, Chinese, Japanese, French, German, Spanish, and more."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("b", null, "Context-aware Translation:"), " Enhances accuracy and fluency by leveraging message context and chat history.")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", null, "\uD83D\uDD25 Grammar & Style Check \uD83D\uDD25"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "pl-[24px] list-disc"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("b", null, "Automatic Error Detection:"), " Identifies spelling, grammar, and sentence structure issues."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("b", null, "Expression Optimization:"), " Suggests more natural and professional phrasing suitable for business or formal messages."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: listStyle
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("b", null, "Multilingual Correction:"), " Supports grammar checks not only in English but also in other languages, such as Chinese."))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (IntroduceTranslationMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/message-actions-button.tsx"
/*!**************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/message-actions-button.tsx ***!
  \**************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _hook_useSpeechPlayer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hook/useSpeechPlayer */ "./src/components/chatAssistant/hook/useSpeechPlayer.ts");
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../icons */ "./src/components/chatAssistant/icons.tsx");




const MessageActionsItems = ({
  message,
  canCopy,
  canVoice,
  canShare,
  canDelete,
  onClickShare,
  onDelete
}) => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    isSpeaking,
    speak,
    stop
  } = (0,_hook_useSpeechPlayer__WEBPACK_IMPORTED_MODULE_2__.useSpeechPlayer)(message.id);
  const containerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);

  // 获取需要朗读的文本
  const getReadableText = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!containerRef.current) return '';

    // 查找父容器
    const parentContainer = containerRef.current.closest('[data-message-container]');
    if (!parentContainer) return '';

    // 获取所有标记为需要朗读的元素
    const readableElements = parentContainer.querySelectorAll('[data-readable], [data-readable-inline]');
    const texts = [];
    let currentLine = '';
    readableElements.forEach(element => {
      const text = element.textContent?.trim();
      if (text) {
        if (element.hasAttribute('data-readable-inline')) {
          // 内联文本，不换行，用空格连接
          if (currentLine) {
            currentLine = `${currentLine} ${text}`;
          } else {
            currentLine = text;
          }
        } else {
          // 普通文本，需要换行
          if (currentLine) {
            texts.push(currentLine);
            currentLine = '';
          }
          texts.push(text);
        }
      }
    });

    // 处理最后的内联文本
    if (currentLine) {
      texts.push(currentLine);
    }
    return texts.join('\n');
  }, []);
  const handleCopy = () => {
    const textToCopy = getReadableText();
    if (textToCopy) {
      navigator.clipboard.writeText(textToCopy).then(() => {
        showNotification({
          message: 'Copy successful'
        });
      }).catch(() => {
        showNotification({
          message: 'Copy failed'
        });
      });
    } else {
      showNotification({
        message: 'No text to copy'
      });
    }
  };
  const handleVoicePlay = () => {
    const voiceText = getReadableText();
    if (isSpeaking) {
      stop();
    } else if (voiceText) {
      try {
        speak(voiceText);
      } catch (error) {
        showNotification({
          message: '语音播放失败'
        });
      }
    } else {
      showNotification({
        message: '没有可播放的内容'
      });
    }
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    ref: containerRef,
    className: "flex items-center gap-[8px] py-[6px]"
  }, canCopy && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] text-[#676B74] cursor-pointer",
    onClick: handleCopy
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_3__.CopyIcon, {
    size: 24
  })), canVoice && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] text-[#676B74] cursor-pointer",
    onClick: handleVoicePlay
  }, isSpeaking ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_3__.VoiceingIcon, {
    size: 24
  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_3__.VoiceIcon, {
    size: 24
  })), canShare && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] text-[#676B74] cursor-pointer",
    onClick: onClickShare
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_3__.MessageShareIcon, {
    size: 24
  })), canDelete && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[20px] h-[20px] cursor-pointer",
    onClick: onDelete
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_icons__WEBPACK_IMPORTED_MODULE_3__.DeleteIcon, {
    size: 20
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageActionsItems);

/***/ },

/***/ "./src/components/chatAssistant/messages/room-actions-message.tsx"
/*!************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/room-actions-message.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _message_actions_button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message-actions-button */ "./src/components/chatAssistant/messages/message-actions-button.tsx");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _ErrorBoundary__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ErrorBoundary */ "./src/components/chatAssistant/ErrorBoundary.tsx");
/* harmony import */ var _assets_actions_png__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../assets/actions.png */ "./src/components/chatAssistant/assets/actions.png");
/* harmony import */ var _assets_calendar_png__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../assets/calendar.png */ "./src/components/chatAssistant/assets/calendar.png");
/* harmony import */ var _assets_check_png__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../assets/check.png */ "./src/components/chatAssistant/assets/check.png");
/* harmony import */ var _assets_message_png__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../assets/message.png */ "./src/components/chatAssistant/assets/message.png");
/* harmony import */ var _assets_user_png__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../assets/user.png */ "./src/components/chatAssistant/assets/user.png");
/* eslint-disable @stylistic/max-len */
/* eslint-disable no-null/no-null */
/* eslint-disable no-console */














const ChatAvatar = ({
  chatId,
  classNames,
  size,
  style
}) => {
  if (!chatId) return null;
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  let peer;
  if ((0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_3__.isUserId)(chatId)) {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectUser)(global, chatId);
  } else {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId);
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_6__["default"], {
    style: style,
    key: chatId,
    className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_4__.cn)(classNames, 'overlay-avatar inline-block cursor-pointer'),
    size: size,
    peer: peer
  });
};
const SummaryPenddingItem = ({
  pendingItem
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_7__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex gap-[8px] my-[4px] cursor-pointer"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[18px] h-[18px] mt-[2px]",
    src: _assets_check_png__WEBPACK_IMPORTED_MODULE_10__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[15px]",
    "data-readable": true
  }, pendingItem.summary)));
};
const ActionsItems = ({
  messageId
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    canCopy: true,
    canVoice: true,
    message: {
      id: messageId
    }
  });
};
const ActionInfoContent = ({
  summaryInfo
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_7__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px] mb-[16px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Actions Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_actions_png__WEBPACK_IMPORTED_MODULE_8__,
    alt: ""
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[20px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_calendar_png__WEBPACK_IMPORTED_MODULE_9__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[4px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "mr-[4px] font-bold text-[14px]",
    "data-readable-inline": true
  }, "Time:"), summaryInfo?.summaryTime ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[14px] text-[#A8A6AC]",
    "data-readable-inline": true
  }, (0,_utils_util__WEBPACK_IMPORTED_MODULE_4__.formatTimestamp)(summaryInfo.summaryTime)) : null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_message_png__WEBPACK_IMPORTED_MODULE_11__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[4px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-bold text-[14px]",
    "data-readable-inline": true
  }, "Messages:"), summaryInfo?.messageCount ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    "data-readable-inline": true
  }, summaryInfo?.messageCount) : null))), summaryInfo?.userIds ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px] mb-[18px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_user_png__WEBPACK_IMPORTED_MODULE_12__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-bold text-[14px]",
    "data-readable": true
  }, "Groups/friends: "), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center"
  }, summaryInfo.userIds.slice(0, 5).map((id, index) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ChatAvatar, {
      style: {
        zIndex: `${String(summaryInfo.userIds.length - index)};`
      },
      chatId: id,
      size: 24,
      classNames: "summary-avatar-group !border-solid-[2px] !border-white ml-[-4px]",
      key: id
    });
  }), summaryInfo.userIds.length > 10 ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] rounded-full bg-[#979797] text-[12px] whitespace-nowrap flex items-center justify-center",
    "data-readable": true
  }, summaryInfo.userIds.length - 10, "+") : null)) : null));
};
const RoomActionMessage = props => {
  const {
    message
  } = props;
  const [summaryInfo, setSummaryInfo] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
  const [pendingMatters, setPendingMatters] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const parseMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(messageContent => {
    const messageObj = JSON.parse(messageContent);
    const {
      pendingMatters,
      summaryInfo
    } = messageObj;
    if (pendingMatters) {
      setPendingMatters(pendingMatters);
    }
    if (summaryInfo) {
      setSummaryInfo(summaryInfo);
    }
  }, []);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    try {
      parseMessage(message.content);
    } catch (error) {
      console.error(error);
    }
  }, [message, parseMessage]);
  if (!summaryInfo) {
    return null;
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[12px] w-full"
  }, !pendingMatters.length ? null : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mx-auto rounded-[10px] px-3 py-2 bg-white dark:bg-[#292929]",
    "data-message-container": true
  }, summaryInfo && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ActionInfoContent, {
    summaryInfo: summaryInfo
  }), pendingMatters.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, pendingMatters.map(item => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryPenddingItem, {
    pendingItem: item
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ActionsItems, {
    messageId: message.id
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RoomActionMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/room-ai-des-message.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/messages/room-ai-des-message.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */
/* eslint-disable @stylistic/jsx-quotes */




const actionItemClassName = 'h-[40px] w-fit px-[12px] py-[8px] rounded-[6px] bg-[#F5F1FF] text-[14px] text-[var(--color-text)] dark:bg-[#383838]';
const RoomAIDescriptionMessage = ({
  message
}) => {
  const {
    content: chatId
  } = message;
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  const handleSummarize = () => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.RoomAIActions, {
      chatId,
      action: 'summary'
    });
  };
  const handleScheduleMeeting = () => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.RoomAIActions, {
      chatId,
      action: 'schedule-meet'
    });
  };
  const handleActionItems = () => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.RoomAIActions, {
      chatId,
      action: 'todo'
    });
  };
  const handleNewFeature = () => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.RoomAIActions, {
      chatId,
      action: 'new-feature'
    });
  };
  const handleSendMessage = value => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].emit(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.AskRoomAI, value);
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[12px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-3 py-2 rounded-xl text-[var(--color-text)] bg-white dark:bg-[#292929]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[14px]"
  }, "\uD83D\uDC4B Hi, welcome to \u3010", chat?.title, "\u3011! I\u2019m TelyAI \uD83E\uDD16, your smart assistant here."), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mt-[1rem]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", {
    className: "text-[14px] font-semibold"
  }, "\uD83D\uDE80 Here\u2019s what I can help you with:"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row flex-wrap gap-[8px] mt-[0.5rem]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: actionItemClassName,
    onClick: handleSummarize
  }, "\uD83E\uDDE0 Chat Summary"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: actionItemClassName,
    onClick: handleActionItems
  }, "\u2705 Action Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: actionItemClassName,
    onClick: handleNewFeature
  }, "\uD83D\uDD0D Group Search"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: actionItemClassName,
    onClick: handleNewFeature
  }, "\uD83D\uDC6E User Portrait"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: actionItemClassName,
    onClick: handleScheduleMeeting
  }, "\uD83D\uDCC5 Schedule Meeting"))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mt-[1rem]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("h3", {
    className: "text-[14px] font-semibold !mb-[10px]"
  }, "\uD83D\uDCCD You can ask me things like:"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "list-disc pl-[24px] text-[14px] text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: "cursor-pointer mb-[10px]",
    onClick: () => handleSendMessage('What’s new today?')
  }, "What\u2019s new today?"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
    className: "cursor-pointer",
    onClick: () => handleSendMessage('Summarize today’s crypto market highlights.')
  }, "Summarize today\u2019s crypto market highlights.")))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RoomAIDescriptionMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/room-ai-media-message.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/room-ai-media-message.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AIRoomBubble: () => (/* binding */ AIRoomBubble),
/* harmony export */   AppendixIcon: () => (/* binding */ AppendixIcon),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _message__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../message */ "./src/components/chatAssistant/message.tsx");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _common_Audio__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/Audio */ "./src/components/common/Audio.tsx");
/* harmony import */ var _hook_useMedia__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../hook/useMedia */ "./src/components/chatAssistant/hook/useMedia.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../chatAssistant/assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../utils/ai-analyse-message */ "./src/components/chatAssistant/utils/ai-analyse-message.ts");
/* harmony import */ var _message_actions_button__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./message-actions-button */ "./src/components/chatAssistant/messages/message-actions-button.tsx");
function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }
/* eslint-disable */













const RoomAIMediaMessage = props => {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTheme)(global);
  let content = {};
  let message = undefined;
  let summaryInfo = undefined;
  let isAuto = false;
  let status = "loading";
  try {
    content = JSON.parse(props?.message.content);
    message = content?.message;
    try {
      summaryInfo = JSON.parse(content?.summaryInfo);
    } catch (error) {}
    isAuto = content?.isAuto;
    status = content?.status;
  } catch (error) {}
  const isOwn = message ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isOwnMessage)(message) : false;
  const waveformCanvasRef = message?.content?.voice ? (0,_common_Audio__WEBPACK_IMPORTED_MODULE_7__.useWaveformCanvas)(theme, message?.content?.voice, 1, isOwn) : undefined;
  const imgBlobUrl = message?.content?.photo ? (0,_hook_useMedia__WEBPACK_IMPORTED_MODULE_8__["default"])(message?.content?.photo ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getPhotoMediaHash)(message?.content?.photo, "inline") : undefined, false, _api_types__WEBPACK_IMPORTED_MODULE_3__.ApiMediaFormat.BlobUrl) : undefined;
  const fullMediaData = message?.content?.photo?.blobUrl || imgBlobUrl;
  const forcedWidth = message?.content?.photo?.thumbnail?.width;
  const withBlurredBackground = Boolean(forcedWidth);
  function getType() {
    if (!message) return "";
    const {
      webPage,
      photo,
      document,
      audio,
      voice,
      video
    } = message?.content;
    const isUrl = (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_11__.checkIsUrl)(message?.content?.text?.text);
    const isImage = document ? (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_11__.checkIsImage)(document?.mimeType) : false;
    if (webPage || isUrl) {
      return "website page";
    } else if (photo || isImage) {
      return "image";
    } else if (document) {
      return "file";
    } else if (audio) {
      return "audio";
    } else if (voice) {
      return "voice";
    } else if (video) {
      return "video";
    }
    return "";
  }
  function onPreviewClick() {
    const {
      openMediaViewer
    } = (0,_global__WEBPACK_IMPORTED_MODULE_5__.getActions)();
    openMediaViewer({
      chatId: message?.chatId,
      threadId: -1,
      messageId: message?.id,
      origin: _types__WEBPACK_IMPORTED_MODULE_9__.MediaViewerOrigin.Inline,
      withDynamicLoading: true
    });
  }
  function renderMessageContent() {
    if (!message) return "";
    const {
      photo,
      document,
      audio,
      voice,
      video
    } = message?.content;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_5__.getGlobal)();
    const webPage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectWebPageFromMessage)(global, message);
    const isUrl = (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_11__.checkIsUrl)(message?.content?.text?.text);
    if (webPage || isUrl) {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])("flex", !isAuto ? "justify-end" : "")
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)] break-all"
      }, webPage ? webPage?.url : message?.content?.text?.text));
    } else if (photo) {
      return fullMediaData && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])("flex", !isAuto ? "justify-end" : "")
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
        src: fullMediaData,
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])("full-media cursor-pointer", withBlurredBackground && "with-blurred-bg"),
        alt: "",
        style: {
          width: `${forcedWidth ?? 0}px`
        },
        onClick: onPreviewClick
      }));
    } else if (document) {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])("flex", !isAuto ? "justify-end" : "")
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)] break-all"
      }, message?.content.document?.fileName));
    } else if (audio) {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])("flex", !isAuto ? "justify-end" : "")
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)] break-all"
      }, message?.content.audio?.fileName));
    } else if (voice) {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])("flex", !isAuto ? "justify-end" : "")
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)] break-all"
      }, message?.content?.voice && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "waveform-wrapper"
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "waveform",
        draggable: false
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("canvas", {
        ref: waveformCanvasRef
      }))), message?.content?.audio && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
        className: "title",
        dir: "auto",
        title: message?.content?.audio?.title
      }, message?.content?.audio?.title)));
    } else if (video) {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])("flex", !isAuto ? "justify-end" : "")
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)] break-all"
      }, message?.content.video?.fileName));
    }
    return undefined;
  }
  function renderSummary() {
    if (!message) return "";
    const {
      webPage,
      photo,
      document
    } = message?.content;
    const isUrl = (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_11__.checkIsUrl)(message?.content?.text?.text);
    const isImage = document ? (0,_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_11__.checkIsImage)(document?.mimeType) : false;
    if (webPage || isUrl) {
      return summaryInfo?.title ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)]"
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "font-[600] text-[16px]",
        "data-readable": true
      }, "Summary of the Article: \"", summaryInfo?.title, "\""), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "flex flex-col gap-[6px] mt-3"
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "font-[600]",
        "data-readable": true
      }, "Key Highlights:"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "flex flex-col"
      }, summaryInfo?.highlights?.map((item, index) => {
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
          className: "flex flex-col",
          key: index
        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
          className: "flex flex-row items-center flex-wrap"
        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
          className: "mr-[24px]",
          "data-readable": true
        }, index + 1, ". ", item?.title)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
          className: "list-disc list-inside ml-3 mb-1"
        }, item?.content?.map((contentItem, contentIndex) => {
          return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
            className: "break-word",
            key: contentIndex,
            "data-readable": true
          }, contentItem);
        })));
      }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_12__["default"], {
        canCopy: true,
        canVoice: true,
        message: props.message
      })) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(NoSummaryContent, {
        content: "website page",
        message: props.message
      });
    } else if (photo || isImage) {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] text-[var(--color-text)] p-3 text-[14px]"
      }, isAuto ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "font-[600]",
        "data-readable": true
      }, "Image summarize") : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "flex items-center gap-2",
        "data-readable": true
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
        src: _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_10__,
        className: "w-[18px] h-[18px]"
      }), "TelyAI"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "flex flex-col gap-[6px] mt-2",
        "data-readable": true
      }, summaryInfo?.text), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_12__["default"], {
        canCopy: true,
        canVoice: true,
        message: props.message
      }));
    } else {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)]"
      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "font-[600] text-[16px]",
        "data-readable": true
      }, "Key Highlights:"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
        className: "flex flex-col mt-2"
      }, Array.isArray(summaryInfo) && summaryInfo?.map((item, index) => {
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
          className: "flex flex-col",
          key: index
        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
          className: "flex flex-row items-center flex-wrap"
        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
          className: "mr-[24px] font-[600]",
          "data-readable": true
        }, item?.title)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
          className: "list-disc list-inside ml-3 mb-1"
        }, item?.content?.map((contentItem, contentIndex) => {
          return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
            className: "break-word",
            key: contentIndex,
            "data-readable": true
          }, contentItem);
        })));
      })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_12__["default"], {
        canCopy: true,
        canVoice: true,
        message: props.message
      }));
    }
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-2 px-3 text-[14px]",
    "data-message-container": true
  }, !isAuto && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "text-right"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(AIRoomBubble, null, "Summarize this ", getType())), renderMessageContent(), status === "loading" ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message__WEBPACK_IMPORTED_MODULE_1__.ThinkingMessage, null) : status === "error" ?
  /*#__PURE__*/
  // <NoSummaryContent content={getType() || ""} message={props.message} />
  react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryErrorContent, {
    message: props.message,
    content: props.message?.content
  }) : renderSummary());
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RoomAIMediaMessage);
const AIRoomBubble = ({
  children
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "bg-[var(--color-ai-room-bubble-bg)] py-2 px-3 rounded-t-[16px] rounded-bl-[16px] text-right inline-flex relative"
  }, children, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "absolute bottom-[-3px] right-[-9px] text-[var(--color-ai-room-bubble-bg)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(AppendixIcon, null)));
};
const AppendixIcon = props => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("svg", _extends({
  width: 9,
  height: 20
}, props), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("defs", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("filter", {
  id: "a",
  width: "200%",
  height: "141.2%",
  x: "-50%",
  y: "-14.7%",
  filterUnits: "objectBoundingBox"
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("feOffset", {
  dy: 1,
  in: "SourceAlpha",
  result: "shadowOffsetOuter1"
}), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("feGaussianBlur", {
  in: "shadowOffsetOuter1",
  result: "shadowBlurOuter1",
  stdDeviation: 1
}), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("feColorMatrix", {
  in: "shadowBlurOuter1",
  values: "0 0 0 0 0.0621962482 0 0 0 0 0.138574144 0 0 0 0 0.185037364 0 0 0 0.15 0"
}))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("g", {
  fill: "none",
  fillRule: "evenodd"
}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fill: "currentColor",
  d: "M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 0 1 6 17z",
  filter: "url(#a)"
}), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("path", {
  fill: "currentColor",
  d: "M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 0 1 6 17z"
})));
const NoSummaryContent = ({
  content,
  message
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    "data-readable": true
  }, "I couldn't find any accessible content from the ", content, " you provided. It appears the search query didn't return any results. Could you please paste the text you want summarized? That way, I can give you a clear and accurate summary!"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    canCopy: true,
    canVoice: true,
    message: message
  }));
};
const SummaryErrorContent = ({
  content,
  message
}) => {
  let messageContent, errorText;
  try {
    messageContent = content ? JSON.parse(content) : {};
    errorText = messageContent?.errorMsg ?? 'Unknown Error';
  } catch (e) {
    messageContent = 'Unknown Error';
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[var(--color-text)]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    "data-readable": true
  }, errorText), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    canCopy: true,
    canVoice: true,
    message: message
  }));
};

/***/ },

/***/ "./src/components/chatAssistant/messages/room-ai-reply-mention-message.tsx"
/*!*********************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/room-ai-reply-mention-message.tsx ***!
  \*********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _message__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../message */ "./src/components/chatAssistant/message.tsx");
/* eslint-disable */






const ReplyMentionMessage = props => {
  const {
    message
  } = props;
  let content = {};
  let messageId = 0;
  let status = "loading";
  let replys = [];
  try {
    content = JSON.parse(message.content);
    messageId = content?.messageId;
    status = content?.status;
    try {
      replys = JSON.parse(content?.replys?.replace(/'/g, '"')?.replace(/,\s+/g, ','));
    } catch (error) {
      // console.log("aiChatFoldersTask----replys", error);
    }
  } catch (error) {}
  const [disabled, setDisabled] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  function onReplyClick(text) {
    if (disabled) return;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const {
      saveReplyDraft,
      sendMessage,
      clearDraft
    } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
    const currentChat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectCurrentChat)(global);
    if (currentChat && messageId) {
      const chatId = currentChat.id;
      const threadId = -1;
      saveReplyDraft({
        chatId,
        threadId,
        draft: {
          replyInfo: {
            type: "message",
            replyToMsgId: messageId,
            replyToPeerId: undefined
          }
        },
        isLocalOnly: true
      });
      sendMessage({
        messageList: {
          chatId,
          threadId,
          type: "thread"
        },
        text
      });
      clearDraft({
        chatId,
        isLocalOnly: true
      });
      // disable the reply button
      setDisabled(true);
      _store__WEBPACK_IMPORTED_MODULE_3__.ChataiStores.message?.storeMessage({
        ...message,
        chatId,
        timestamp: new Date().getTime(),
        content: JSON.stringify({
          disabled: true,
          ...content
        })
      });
    }
  }
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setDisabled(content?.disabled);
  }, [message]);

  //  console.log("aiChatFoldersTask----message", content);

  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] bg-[var(--color-background)] text-[var(--color-text)] mx-2 p-3 w-full text-[14px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "font-[600]"
  }, "You were mentioned:"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, "\"", content?.content, "\""), status == "loading" ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message__WEBPACK_IMPORTED_MODULE_5__.ThinkingMessage, null) : status === "error" ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] bg-[#FFF9F9] text-[#000] p-3 text-[14px] border-[1px] border-[#FFC7C7]"
  }, content?.errorMsg) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, "Here are a few reply suggestions for you \uD83D\uDC47"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[6px] mt-2"
  }, replys?.map((reply, index) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])("bg-[var(--color-ai-room-mention-reply-bg)] rounded-[6px] p-[6px] ", disabled ? "cursor-not-allowed opacity-50" : "cursor-pointer hover:opacity-80"),
      key: index,
      onClick: () => onReplyClick(reply)
    }, "\"", reply, "\"");
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ReplyMentionMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/room-ai-user-portrait.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/room-ai-user-portrait.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../chatAssistant/assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* eslint-disable */






const RoomAIUserPortraitMessage = props => {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const {
    openUserPortrait
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const userId = props?.userId;
  const user = userId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectUser)(global, userId) : undefined;
  const handlePortraitClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    openUserPortrait({
      userId
    });
  });
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-2 px-3 text-[14px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] text-[var(--color-text)] p-3 text-[14px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_3__,
    className: "w-[18px] h-[18px]"
  }), "TelyAI"), user ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    onClick: handlePortraitClick,
    className: "flex flex-row items-center gap-2 mt-2 cursor-pointer hover:opacity-80"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_5__["default"], {
    peer: user,
    size: "small"
  }), `${user?.firstName || ""} ${user?.lastName || ""}`, " 's Portrait") : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, "Couldn't find the user.")));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RoomAIUserPortraitMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/room-summary-message.tsx"
/*!************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/room-summary-message.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var html_to_image__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! html-to-image */ "./node_modules/html-to-image/es/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _message_actions_button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message-actions-button */ "./src/components/chatAssistant/messages/message-actions-button.tsx");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _ErrorBoundary__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ErrorBoundary */ "./src/components/chatAssistant/ErrorBoundary.tsx");
/* harmony import */ var _assets_actions_png__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../assets/actions.png */ "./src/components/chatAssistant/assets/actions.png");
/* harmony import */ var _assets_calendar_png__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../assets/calendar.png */ "./src/components/chatAssistant/assets/calendar.png");
/* harmony import */ var _assets_check_png__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../assets/check.png */ "./src/components/chatAssistant/assets/check.png");
/* harmony import */ var _assets_message_png__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../assets/message.png */ "./src/components/chatAssistant/assets/message.png");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _assets_share_header_bg_png__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../assets/share-header-bg.png */ "./src/components/chatAssistant/assets/share-header-bg.png");
/* harmony import */ var _assets_user_png__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../assets/user.png */ "./src/components/chatAssistant/assets/user.png");
/* harmony import */ var _assets_write_png__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../assets/write.png */ "./src/components/chatAssistant/assets/write.png");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* eslint-disable no-null/no-null */
/* eslint-disable no-console */
/* eslint-disable @typescript-eslint/no-shadow */
/* eslint-disable max-len */

















const ChatAvatar = ({
  chatId,
  classNames,
  size,
  style
}) => {
  if (!chatId) return null;
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  let peer;
  if ((0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_16__.isUserId)(chatId)) {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, chatId);
  } else {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_6__["default"], {
    style: style,
    key: chatId,
    className: (0,_utils_util__WEBPACK_IMPORTED_MODULE_4__.cn)(classNames, 'overlay-avatar inline-block cursor-pointer'),
    size: size,
    peer: peer
  });
};
const SummaryTopicItem = ({
  topicItem,
  index
}) => {
  const {
    title,
    summaryItems
  } = topicItem;
  if (!summaryItems.length) return null;
  if (!title) return null;
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_7__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row items-center flex-wrap"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[16px] font-bold mr-[24px]",
    "data-readable": true
  }, index + 1, ". ", title)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "list-disc pl-[2px] text-[16px] list-inside"
  }, summaryItems.map(summaryItem => {
    const {
      content
    } = summaryItem;
    if (!content) return null;
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
      role: "button",
      className: "cursor-pointer text-[15px] break-words",
      "data-readable": true
    }, content);
  }))));
};
const SummaryPenddingItem = ({
  pendingItem
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_7__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex gap-[8px] my-[4px] cursor-pointer"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[18px] h-[18px] mt-[2px]",
    src: _assets_check_png__WEBPACK_IMPORTED_MODULE_10__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[15px]",
    "data-readable": true
  }, pendingItem.summary)));
};
const SummaryInfoContent = ({
  summaryInfo,
  title = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, "Chat Summary")
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ErrorBoundary__WEBPACK_IMPORTED_MODULE_7__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[22px] font-bold mb-[16px]",
    "data-readable": true
  }, title), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center flex-wrap"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px] pr-[20px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_calendar_png__WEBPACK_IMPORTED_MODULE_9__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[4px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "mr-[4px] font-bold text-[14px]",
    "data-readable-inline": true
  }, "Time:"), summaryInfo?.summaryTime ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[14px] text-[#A8A6AC] whitespace-nowrap",
    "data-readable-inline": true
  }, (0,_utils_util__WEBPACK_IMPORTED_MODULE_4__.formatTimestamp)(summaryInfo.summaryTime)) : null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_message_png__WEBPACK_IMPORTED_MODULE_11__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[4px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-bold text-[14px]",
    "data-readable": true,
    "data-readable-inline": true
  }, "Messages:"), summaryInfo?.messageCount ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    "data-readable": true,
    "data-readable-inline": true
  }, summaryInfo?.messageCount) : null))), summaryInfo?.userIds ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px] mb-[18px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_user_png__WEBPACK_IMPORTED_MODULE_14__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-bold text-[14px]"
  }, "Main speakers: "), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center"
  }, summaryInfo.userIds.slice(0, 5).map((id, index) => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ChatAvatar, {
      style: {
        zIndex: `${String(summaryInfo.userIds.length - index)};`
      },
      chatId: id,
      size: 24,
      classNames: "summary-avatar-group !border-solid-[2px] !border-white ml-[-4px]",
      key: id
    });
  }), summaryInfo.userIds.length > 10 ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-[24px] h-[24px] rounded-full bg-[#979797] text-[12px] whitespace-nowrap flex items-center justify-center"
  }, summaryInfo.userIds.length - 10, "+") : null)) : null));
};
const MainSummaryContent = ({
  messageId,
  summaryInfo,
  mainTopic,
  pendingMatters
}) => {
  const [capturing, setCapturing] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  const {
    chatId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMessageList)(global) || {};
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "mx-auto rounded-[10px] px-3 py-2 dark:bg-[#292929] bg-white",
    "data-message-container": true
  }, summaryInfo && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryInfoContent, {
    summaryInfo: summaryInfo
  }), mainTopic.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px] mb-[16px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Key Topics"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_write_png__WEBPACK_IMPORTED_MODULE_15__,
    alt: ""
  })), mainTopic.map((item, index) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryTopicItem, {
    topicItem: item,
    index: index
  }))), pendingMatters.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px] mb-[16px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Actions Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_actions_png__WEBPACK_IMPORTED_MODULE_8__,
    alt: ""
  })), pendingMatters.map(item => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryPenddingItem, {
    pendingItem: item
  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    canCopy: true,
    canVoice: true,
    canShare: true,
    message: {
      id: messageId
    }
    // eslint-disable-next-line react/jsx-no-bind
    ,
    onClickShare: () => {
      setCapturing(true);
    }
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(ShareCard, {
    capturing: capturing
    // eslint-disable-next-line react/jsx-no-bind
    ,
    captureCallback: () => {
      setCapturing(false);
    }
  }, summaryInfo && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryInfoContent, {
    summaryInfo: summaryInfo,
    title: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, "Chat Summary", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "ml-2 text-xs text-[#979797]"
    }, "[", chat?.title, "]"))
  }), mainTopic.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Key Topics"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_write_png__WEBPACK_IMPORTED_MODULE_15__,
    alt: ""
  })), mainTopic.map((item, index) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryTopicItem, {
    topicItem: item,
    index: index
  }))), pendingMatters.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[18px] font-bold",
    "data-readable": true
  }, "Actions Items"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _assets_actions_png__WEBPACK_IMPORTED_MODULE_8__,
    alt: ""
  })), pendingMatters.map(item => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SummaryPenddingItem, {
    pendingItem: item
  })))));
};
const RoomSummaryMessage = props => {
  const {
    message
  } = props;
  const [summaryInfo, setSummaryInfo] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
  const [mainTopic, setMainTopic] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [pendingMatters, setPendingMatters] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const parseMessage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(messageContent => {
    const messageObj = JSON.parse(messageContent);
    const {
      mainTopic,
      pendingMatters,
      summaryInfo
    } = messageObj;
    if (mainTopic) {
      setMainTopic(mainTopic);
    }
    if (pendingMatters) {
      setPendingMatters(pendingMatters);
    }
    if (summaryInfo) {
      setSummaryInfo(summaryInfo);
    }
  }, []);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    try {
      parseMessage(message.content);
    } catch (error) {
      // eslint-disable-next-line no-console
      console.error(error);
    }
  }, [message, parseMessage]);
  if (!summaryInfo) {
    return null;
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "px-[12px] w-full"
  }, !mainTopic.length && !pendingMatters.length ? null : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(MainSummaryContent, {
    messageId: message.id,
    summaryInfo: summaryInfo,
    mainTopic: mainTopic,
    pendingMatters: pendingMatters
  }));
};
function ShareCard({
  capturing = false,
  children,
  captureCallback = () => {}
}) {
  const domRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getGlobal)();
  const {
    currentUserId
  } = global;
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, currentUserId);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (domRef.current) {
      setTimeout(() => {
        (0,html_to_image__WEBPACK_IMPORTED_MODULE_1__.toBlob)(domRef.current, {
          pixelRatio: 2,
          // Higher pixel ratio for better quality
          quality: 1 // Maximum quality
        }).then(blob => {
          const file = new File([blob], 'telyai.org.png', {
            type: 'image/png'
          });
          // @ts-ignore
          globalThis?.p__handleFileSelect?.([file], true);
          captureCallback();
        });
      }, 100);
    }
  }, [capturing, captureCallback]);
  if (!capturing) return null;
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "fixed top-0 left-0 translate-x-[-1000000px] translate-y-[-100000px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    ref: domRef,
    className: "relative w-[390px] box-content overflow-hidden bg-white text-black"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "absolute top-0 left-0 w-full blur-xl pointer-events-none"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _assets_share_header_bg_png__WEBPACK_IMPORTED_MODULE_13__,
    alt: "",
    className: "w-full"
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "relative py-3 px-4 flex flex-col gap-2"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row justify-end items-center gap-2 text-xs text-[#979797]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_6__["default"], {
    className: "w-[20px] h-[20px]",
    peer: currentUser
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, currentUser?.firstName), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, currentUser?.lastName)), children), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("section", {
    className: "flex flex-row gap-1 items-center justify-center py-2 text-xs bg-[#F7FAFF]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "inline w-[20px] h-[20px] rounded-full",
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_12__,
    alt: "Serena"
  }), "Powered by", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[#2996FF]"
  }, "telepgt.org"))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RoomSummaryMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/upgrade-tip-message.scss"
/*!************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/upgrade-tip-message.scss ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/chatAssistant/messages/upgrade-tip-message.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/messages/upgrade-tip-message.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _upgrade_tip_message_scss__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./upgrade-tip-message.scss */ "./src/components/chatAssistant/messages/upgrade-tip-message.scss");





const UpgradeTipMessage = ({
  message,
  deleteMessage
}) => {
  const {
    openPayPackageModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const handleUpgradeSuccess = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(payload => {
    if (payload.creditBalance > 0) {
      deleteMessage(message.id);
    }
  }, [deleteMessage, message.id]);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].on(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.UpgradeSuccess, handleUpgradeSuccess);
    return () => {
      _lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__["default"].off(_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_2__.Actions.UpgradeSuccess, handleUpgradeSuccess);
    };
  }, [handleUpgradeSuccess]);
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "upgrade-tip-message"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "bg-[var(--color-background)] flex items-center justify-between gap-[8px] relative rounded-[10px] p-[20px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "headerBadge"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col flex-1"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[16px] font-bold text-[var(--color-text)]"
  }, "Upgrade your plan"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[14px]  text-[var(--color-text-secondary)]"
  }, "You have reached the free usage limit. You are welcome to try TelyAI Pro for a higher usage limit.")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center justify-center gap-[8px] bg-[var(--color-primary)] text-white text-[14px] w-[95px] h-[40px] rounded-[12px] cursor-pointer",
    onClick: () => {
      openPayPackageModal();
    }
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, "Upgrade"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_3__["default"], {
    name: "arrow-right"
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UpgradeTipMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/urgent-check-message.tsx"
/*!************************************************************************!*\
  !*** ./src/components/chatAssistant/messages/urgent-check-message.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd */ "./node_modules/antd/es/popover/index.js");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_user_settings__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../api/user-settings */ "./src/components/chatAssistant/api/user-settings.ts");
/* harmony import */ var _utils_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _message_actions_button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./message-actions-button */ "./src/components/chatAssistant/messages/message-actions-button.tsx");
/* harmony import */ var _component_ChatAvatar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../component/ChatAvatar */ "./src/components/chatAssistant/component/ChatAvatar.tsx");
/* harmony import */ var _component_Icon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../component/Icon */ "./src/components/chatAssistant/component/Icon.tsx");
/* harmony import */ var _global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../global-summary/DrawerContext */ "./src/components/chatAssistant/global-summary/DrawerContext.tsx");
/* harmony import */ var _assets_danger_png__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../assets/danger.png */ "./src/components/chatAssistant/assets/danger.png");
/* harmony import */ var _assets_serena_png__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* eslint-disable no-null/no-null */











const IgnoreSummaryButton = ({
  chatId,
  handleIgnore
}) => {
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[4px] cursor-pointer transition-colors duration-200 text-[14px] text-[var(--color-text)]",
    onClick: () => handleIgnore(chatId)
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Icon__WEBPACK_IMPORTED_MODULE_7__["default"], {
    name: "eye-crossed"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "font-semibold"
  }, "Ignore this chat"));
};
const UrgentCheckMessage = props => {
  const {
    message,
    deleteMessage
  } = props;
  const [urgentMessage, setUrgentMessage] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const {
    openDrawer
  } = (0,_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.useDrawerStore)();
  const {
    ignored_urgent_chat_ids
  } = _api_user_settings__WEBPACK_IMPORTED_MODULE_3__.telegptSettings.telegptSettings;
  const ignoredChatIds = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_3__.getIdsFromEntityTypes)(ignored_urgent_chat_ids);
  const [ignoredIds, setIgnoredIds] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(ignoredChatIds);
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const parsedMessage = JSON.parse(message.content);
    if (parsedMessage && typeof parsedMessage === 'object' && parsedMessage.length > 0) {
      setUrgentMessage(parsedMessage);
    }
  }, [message]);
  const handleIgnore = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(id => {
    const newSelected = [...new Set([...ignoredIds, id])];
    const entityTypes = (0,_api_user_settings__WEBPACK_IMPORTED_MODULE_3__.buildEntityTypeFromIds)(newSelected);
    setIgnoredIds(newSelected);
    _api_user_settings__WEBPACK_IMPORTED_MODULE_3__.telegptSettings.setSettingOption({
      ignored_urgent_chat_ids: entityTypes
    }, res => {
      if (res.code === 0) {
        (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)().showNotification({
          message: 'This chat will no longer be included in urgent messages.'
        });
      }
    });
  }, [ignoredIds]);
  if (!urgentMessage || urgentMessage.length === 0) {
    return null;
  }
  const showMessageDetail = item => {
    openDrawer(_global_summary_DrawerContext__WEBPACK_IMPORTED_MODULE_8__.DrawerKey.OriginalMessages, {
      relevantMessages: [{
        chatId: item.chatId,
        messageIds: [item.messageId]
      }]
    });
  };
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "w-max-[693px] rounded-[10px] bg-[var(--color-urgent-message-bg)] pl-[82px] pr-[25px] pt-[20px] pb-[25px] border-[1px] border-[#FFC7C7] dark:border-none",
    "data-message-container": true
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    className: "w-[52px] h-[52px] rounded-full ml-[-60px]",
    src: _assets_serena_png__WEBPACK_IMPORTED_MODULE_10__,
    alt: ""
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[16px] font-semibold"
  }, "TelyAI"), message.createdAt && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("p", {
    className: "text-[14px] text-[#A8A6AC]"
  }, (0,_utils_util__WEBPACK_IMPORTED_MODULE_4__.formatTimestamp)(new Date(message.createdAt).getTime())))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-row items-center gap-[8px] mb-[10px]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("img", {
    src: _assets_danger_png__WEBPACK_IMPORTED_MODULE_9__,
    alt: "",
    className: "w-[26px] h-[26px]"
  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
    className: "text-[20px] text-[#FF543D] font-bold",
    "data-readable": true
  }, "Urgent Alert")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul", {
    className: "list-disc pl-[24px]"
  }, urgentMessage.map(item => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li", {
      className: "flex flex-row items-top gap-[8px]",
      key: item.messageId
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[15px] break-words",
      "data-readable": true,
      onClick: () => showMessageDetail(item)
    }, item.content), ignoredIds.includes(item.chatId) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_ChatAvatar__WEBPACK_IMPORTED_MODULE_6__["default"], {
      size: 20,
      chatId: item.chatId
    }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(antd__WEBPACK_IMPORTED_MODULE_1__["default"], {
      className: "room-info-popover",
      placement: "top",
      content: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(IgnoreSummaryButton, {
        chatId: item.chatId,
        handleIgnore: handleIgnore
      })
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_ChatAvatar__WEBPACK_IMPORTED_MODULE_6__["default"], {
      size: 20,
      chatId: item.chatId
    }))));
  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_message_actions_button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    canCopy: true,
    canVoice: true,
    canDelete: true,
    onDelete: deleteMessage,
    message: message
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UrgentCheckMessage);

/***/ },

/***/ "./src/components/chatAssistant/messages/user-search-message.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/chatAssistant/messages/user-search-message.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UserSearchMessage: () => (/* binding */ UserSearchMessage)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _component_Avatar__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../component/Avatar */ "./src/components/chatAssistant/component/Avatar.tsx");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* eslint-disable max-len */
/* eslint-disable no-null/no-null */






const UserSearchMessage = ({
  message
}) => {
  const [senderIds, setSenderIds] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const handleClick = userId => {
    const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, userId);
    if (chat) {
      (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openChat({
        id: userId
      });
    }
  };
  const renderChatAvatar = userId => {
    if (!(0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_5__.isUserId)(userId)) {
      return null;
    }
    let title;
    const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, userId);
    if (peer) {
      title = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(peer);
    } else {
      return null;
    }
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex flex-row items-center gap-[8px] cursor-pointer px-[12px] py-[8px] rounded-[12px] hover:bg-[#D9D9D9]",
      onClick: () => {
        handleClick(userId);
      }
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_component_Avatar__WEBPACK_IMPORTED_MODULE_4__["default"], {
      key: userId,
      className: "overlay-avatar inline-block cursor-pointer",
      size: 44,
      peer: peer
    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
      className: "flex flex-col justify-center gap-[4px]"
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("span", {
      className: "text-[15px] font-semibold text-black leading-[18px]"
    }, title)));
  };
  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    try {
      const ids = JSON.parse(message.content);
      setSenderIds(ids || []);
    } catch (error) {
      // eslint-disable-next-line no-console
      console.log(error);
    }
  }, [message]);
  if (senderIds.length === 0) {
    return null;
  }
  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "p-[10px] mx-[22px] rounded-[16px] border-[1px] border-[#D9D9D9] bg-white dark:bg-[#292929]"
  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", {
    className: "flex flex-col gap-[12px]"
  }, senderIds.splice(0, 10).map(id => {
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, renderChatAvatar(id));
  })));
};

/***/ },

/***/ "./src/components/chatAssistant/room-ai/room-ai.module.scss"
/*!******************************************************************!*\
  !*** ./src/components/chatAssistant/room-ai/room-ai.module.scss ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"rightPanelBg":"ZfJHpS2Q","phaseIndicatorContainer":"W7UCs8bT","toolCallsContainer":"pDST73Gy"});

/***/ },

/***/ "./src/components/chatAssistant/utils/grammar.ts"
/*!*******************************************************!*\
  !*** ./src/components/chatAssistant/utils/grammar.ts ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   sapling: () => (/* binding */ sapling)
/* harmony export */ });
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
/* eslint-disable no-implicit-coercion */
/* eslint-disable no-console */
class GrammarChecker {
  constructor() {
    _defineProperty(this, "languageToolURL", void 0);
    this.languageToolURL = 'https://api.languagetoolplus.com/v2/check';
  }
  async saplingEditOverview(text) {
    const params = new URLSearchParams({
      text,
      language: 'en-US',
      useragent: 'standalone',
      disabledRules: 'WHITESPACE_RULE',
      mode: 'allButTextLevelOnly',
      allowIncompleteResults: 'true'
    });
    try {
      const response = await fetch(this.languageToolURL, {
        headers: {
          accept: 'application/json',
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: params.toString(),
        method: 'POST'
      });
      const data = await response.json();
      console.log('LanguageTool response:', JSON.stringify(data));
      return data.matches.map(m => {
        if (m.replacements && m.replacements.length) {
          return {
            description: m.rule.description,
            start: m.offset,
            end: m.offset + m.length,
            id: m.rule.id,
            general_error_type: m.rule.category.id.toLowerCase(),
            error_type: GrammarChecker.classifyTypeGramma(m.rule),
            replacement: m.replacements[0]?.value || '',
            isPremium: !!m.rule?.isPremium,
            shortMessage: m.shortMessage || '',
            original_text: text.substring(m.offset, m.offset + m.length),
            sentence: m.sentence,
            sentence_start: text.indexOf(m.sentence)
          };
        }
        return undefined;
      }).filter(Boolean);
    } catch (err) {
      console.log(err);
      return [];
    }
  }
  static classifyTypeGramma(rule) {
    const category = rule?.category?.id?.toLowerCase() || '';
    return category;
  }
  async check(text) {
    const editorData = await this.saplingEditOverview(text);
    return editorData;
  }
}
const sapling = new GrammarChecker();

/***/ },

/***/ "./src/components/chatAssistant/utils/grammarly.ts"
/*!*********************************************************!*\
  !*** ./src/components/chatAssistant/utils/grammarly.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getCorrectedText: () => (/* binding */ getCorrectedText),
/* harmony export */   grammarlyCheck: () => (/* binding */ grammarlyCheck),
/* harmony export */   grammarlyFormal: () => (/* binding */ grammarlyFormal),
/* harmony export */   grammarlyFriendly: () => (/* binding */ grammarlyFriendly),
/* harmony export */   grammarlyRephrase: () => (/* binding */ grammarlyRephrase),
/* harmony export */   grammarlyShorten: () => (/* binding */ grammarlyShorten)
/* harmony export */ });
/* harmony import */ var _telegpt_fetch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./telegpt-fetch */ "./src/components/chatAssistant/utils/telegpt-fetch.ts");

const grammarlyCheck = text => {
  return new Promise((resolve, reject) => {
    (0,_telegpt_fetch__WEBPACK_IMPORTED_MODULE_0__.TelegptFetch)('/grammarly-check', 'POST', JSON.stringify({
      text
    })).then(res => {
      resolve(res);
    }).catch(err => {
      reject(err);
    });
  });
};
const grammarlyShorten = text => {
  return new Promise((resolve, reject) => {
    (0,_telegpt_fetch__WEBPACK_IMPORTED_MODULE_0__.TelegptFetch)('/grammarly-shorten', 'POST', JSON.stringify({
      text
    })).then(res => {
      resolve(res);
    }).catch(err => {
      reject(err);
    });
  });
};
const grammarlyFormal = text => {
  return new Promise((resolve, reject) => {
    (0,_telegpt_fetch__WEBPACK_IMPORTED_MODULE_0__.TelegptFetch)('/grammarly-formal', 'POST', JSON.stringify({
      text
    })).then(res => {
      resolve(res);
    }).catch(err => {
      reject(err);
    });
  });
};
const grammarlyFriendly = text => {
  return new Promise((resolve, reject) => {
    (0,_telegpt_fetch__WEBPACK_IMPORTED_MODULE_0__.TelegptFetch)('/grammarly-friendly', 'POST', JSON.stringify({
      text
    })).then(res => {
      resolve(res);
    }).catch(err => {
      reject(err);
    });
  });
};
const grammarlyRephrase = text => {
  return new Promise((resolve, reject) => {
    (0,_telegpt_fetch__WEBPACK_IMPORTED_MODULE_0__.TelegptFetch)('/grammarly-rephrase', 'POST', JSON.stringify({
      text
    })).then(res => {
      resolve(res);
    }).catch(err => {
      reject(err);
    });
  });
};
function getCorrectedText(text, errors) {
  if (!errors.length) return text;

  // 从后往前替换，避免索引错乱
  const sorted = [...errors].sort((a, b) => b.offset - a.offset);
  for (const {
    offset,
    length,
    suggestions
  } of sorted) {
    const suggestion = suggestions[0] || '';
    text = text.slice(0, offset) + suggestion + text.slice(offset + length);
  }
  return text;
}

/***/ },

/***/ "./src/components/chatAssistant/utils/room-input-translate.ts"
/*!********************************************************************!*\
  !*** ./src/components/chatAssistant/utils/room-input-translate.ts ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   checkShouldShowHeaderTranslateTip: () => (/* binding */ checkShouldShowHeaderTranslateTip),
/* harmony export */   checkShouldShowInputTranslateTip: () => (/* binding */ checkShouldShowInputTranslateTip),
/* harmony export */   toggleAutoTranslation: () => (/* binding */ toggleAutoTranslation),
/* harmony export */   updateHeaderTranslateTipStatus: () => (/* binding */ updateHeaderTranslateTipStatus),
/* harmony export */   updateInputTranslateTipStatus: () => (/* binding */ updateInputTranslateTipStatus),
/* harmony export */   updateRoomInputTranslateOptions: () => (/* binding */ updateRoomInputTranslateOptions)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");


function updateRoomInputTranslateOptions(chatId, options) {
  let global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  global = {
    ...global,
    roomInputTranslateOptions: {
      ...global.roomInputTranslateOptions,
      [chatId]: options
    }
  };
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  localStorage.setItem('room-input-translate-config', JSON.stringify(global.roomInputTranslateOptions));
}

// translate tip
function checkLanguageDiff(chatId) {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  const systemLanguage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectSystemLanguage)(global);
  const baseLanguage = systemLanguage ? getBaseLanguage(systemLanguage) : getBaseLanguage();
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectChat)(global, chatId);
  const detectedLanguage = chat?.detectedLanguage;
  if (!detectedLanguage || !baseLanguage) return false;
  return detectedLanguage !== baseLanguage;
}
function getBaseLanguage(lang = navigator.language) {
  return lang.split('-')[0]; // 取 "-" 之前的部分
}
function checkShouldShowInputTranslateTip(chatId) {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  const inputTipClosedStatus = global.translateTip.inputTipClosedChats[chatId];
  if (inputTipClosedStatus) return false;
  const isDiff = checkLanguageDiff(chatId);
  if (!isDiff) return false;
  return true;
}
function checkShouldShowHeaderTranslateTip(chatId) {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  const headerTipClosedStatus = global.translateTip.headerTipClosed;
  if (headerTipClosedStatus) return false;
  const isDiff = checkLanguageDiff(chatId);
  if (!isDiff) return false;
  return true;
}
function updateHeaderTranslateTipStatus(status) {
  let global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  const newTranslateTipData = {
    ...global.translateTip,
    headerTipClosed: status
  };
  global = {
    ...global,
    translateTip: newTranslateTipData
  };
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  localStorage.setItem('translate-tip', JSON.stringify(newTranslateTipData));
}
function updateInputTranslateTipStatus(chatId, status) {
  let global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  const newTranslateTipData = {
    ...global.translateTip,
    inputTipClosedChats: {
      ...global.translateTip.inputTipClosedChats,
      [chatId]: status
    }
  };
  global = {
    ...global,
    translateTip: newTranslateTipData
  };
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
  localStorage.setItem('translate-tip', JSON.stringify(newTranslateTipData));
}
function toggleAutoTranslation(autoTranslate) {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  global.chatAutoTranslate = autoTranslate;
  (0,_global__WEBPACK_IMPORTED_MODULE_0__.setGlobal)(global);
}

/***/ },

/***/ "./src/components/chatAssistant/utils/time-zones.ts"
/*!**********************************************************!*\
  !*** ./src/components/chatAssistant/utils/time-zones.ts ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useTimezoneSelect: () => (/* binding */ useTimezoneSelect)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var spacetime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! spacetime */ "./node_modules/spacetime/builds/spacetime.mjs");
/* harmony import */ var timezone_soft__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! timezone-soft */ "./node_modules/timezone-soft/builds/timezone-soft.mjs");
/* eslint-disable no-null/no-null */




// type ICustomTimezone = {
//   [key: string]: string;
// };

// type ILabelStyle = 'original' | 'altName' | 'abbrev' | 'offsetHidden';
// type IDisplayValue = 'GMT' | 'UTC';

const allTimezones = {
  'Pacific/Midway': 'Midway Island, Samoa',
  'Pacific/Honolulu': 'Hawaii',
  'America/Juneau': 'Alaska',
  'America/Boise': 'Mountain Time',
  'America/Dawson': 'Dawson, Yukon',
  'America/Chihuahua': 'Chihuahua, La Paz, Mazatlan',
  'America/Phoenix': 'Arizona',
  'America/Chicago': 'Central Time',
  'America/Regina': 'Saskatchewan',
  'America/Mexico_City': 'Guadalajara, Mexico City, Monterrey',
  'America/Belize': 'Central America',
  'America/Detroit': 'Eastern Time',
  'America/Bogota': 'Bogota, Lima, Quito',
  'America/Caracas': 'Caracas, La Paz',
  'America/Santiago': 'Santiago',
  'America/St_Johns': 'Newfoundland and Labrador',
  'America/Sao_Paulo': 'Brasilia',
  'America/Tijuana': 'Tijuana',
  'America/Montevideo': 'Montevideo',
  'America/Argentina/Buenos_Aires': 'Buenos Aires, Georgetown',
  'America/Godthab': 'Greenland',
  'America/Los_Angeles': 'Pacific Time',
  'Atlantic/Azores': 'Azores',
  'Atlantic/Cape_Verde': 'Cape Verde Islands',
  GMT: 'UTC',
  'Europe/London': 'Edinburgh, London',
  'Europe/Dublin': 'Dublin',
  'Europe/Lisbon': 'Lisbon',
  'Africa/Casablanca': 'Casablanca, Monrovia',
  'Atlantic/Canary': 'Canary Islands',
  'Europe/Belgrade': 'Belgrade, Bratislava, Budapest, Ljubljana, Prague',
  'Europe/Sarajevo': 'Sarajevo, Skopje, Warsaw, Zagreb',
  'Europe/Brussels': 'Brussels, Copenhagen, Madrid, Paris',
  'Europe/Amsterdam': 'Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna',
  'Africa/Algiers': 'West Central Africa',
  'Europe/Bucharest': 'Bucharest',
  'Africa/Cairo': 'Cairo',
  'Europe/Helsinki': 'Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius',
  'Europe/Athens': 'Athens',
  'Asia/Jerusalem': 'Jerusalem',
  'Africa/Harare': 'Harare, Pretoria',
  'Europe/Moscow': 'Istanbul, Minsk, Moscow, St. Petersburg, Volgograd',
  'Asia/Kuwait': 'Kuwait, Riyadh',
  'Africa/Nairobi': 'Nairobi',
  'Asia/Baghdad': 'Baghdad',
  'Asia/Tehran': 'Tehran',
  'Asia/Dubai': 'Abu Dhabi, Muscat',
  'Asia/Baku': 'Baku, Tbilisi, Yerevan',
  'Asia/Kabul': 'Kabul',
  'Asia/Yekaterinburg': 'Ekaterinburg',
  'Asia/Karachi': 'Islamabad, Karachi, Tashkent',
  'Asia/Kolkata': 'Chennai, Kolkata, Mumbai, New Delhi',
  'Asia/Kathmandu': 'Kathmandu',
  'Asia/Dhaka': 'Astana, Dhaka',
  'Asia/Colombo': 'Sri Jayawardenepura',
  'Asia/Almaty': 'Almaty, Novosibirsk',
  'Asia/Rangoon': 'Yangon Rangoon',
  'Asia/Bangkok': 'Bangkok, Hanoi, Jakarta',
  'Asia/Krasnoyarsk': 'Krasnoyarsk',
  'Asia/Shanghai': 'Beijing, Chongqing, Hong Kong SAR, Urumqi',
  'Asia/Kuala_Lumpur': 'Kuala Lumpur, Singapore',
  'Asia/Taipei': 'Taipei',
  'Australia/Perth': 'Perth',
  'Asia/Irkutsk': 'Irkutsk, Ulaanbaatar',
  'Asia/Seoul': 'Seoul',
  'Asia/Tokyo': 'Osaka, Sapporo, Tokyo',
  'Asia/Yakutsk': 'Yakutsk',
  'Australia/Darwin': 'Darwin',
  'Australia/Adelaide': 'Adelaide',
  'Australia/Sydney': 'Canberra, Melbourne, Sydney',
  'Australia/Brisbane': 'Brisbane',
  'Australia/Hobart': 'Hobart',
  'Asia/Vladivostok': 'Vladivostok',
  'Pacific/Guam': 'Guam, Port Moresby',
  'Asia/Magadan': 'Magadan, Solomon Islands, New Caledonia',
  'Asia/Kamchatka': 'Kamchatka, Marshall Islands',
  'Pacific/Fiji': 'Fiji Islands',
  'Pacific/Auckland': 'Auckland, Wellington',
  'Pacific/Tongatapu': 'Nuku\'alofa'
};

// src/index.tsx
function useTimezoneSelect() {
  const timezones = allTimezones;
  const displayValue = 'GMT';
  const options = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return Object.entries(timezones).map(zone => {
      let _a;
      let _b;
      let _c;
      let _d;
      try {
        const now = spacetime__WEBPACK_IMPORTED_MODULE_1__["default"].now().goto(zone[0]);
        const isDstString = now.isDST() ? 'daylight' : 'standard';
        const tz = now.timezone();
        const tzStrings = (0,timezone_soft__WEBPACK_IMPORTED_MODULE_2__["default"])(zone[0]);
        const abbr = (_b = (_a = tzStrings == null ? void 0 : tzStrings[0]) == null ? void 0 : _a[isDstString]) == null ? void 0 : _b.abbr;
        const altName = (_d = (_c = tzStrings == null ? void 0 : tzStrings[0]) == null ? void 0 : _c[isDstString]) == null ? void 0 : _d.name;
        const min = tz.current.offset * 60;
        const hr = `${Math.floor(min / 60)}:${min % 60 === 0 ? '00' : Math.abs(min % 60)}`;
        const prefix = `(${displayValue}${hr.includes('-') ? hr : `+${hr}`}) ${zone[1]}`;
        return {
          value: tz.name,
          label: prefix,
          offset: tz.current.offset,
          abbrev: abbr,
          altName
        };
      } catch (e) {
        return null;
      }
    }).filter(Boolean).sort((a, b) => a.offset - b.offset);
  }, [timezones]);
  const findFuzzyTz = zone => {
    let _a;
    let _b;
    let currentTime;
    try {
      currentTime = spacetime__WEBPACK_IMPORTED_MODULE_1__["default"].now().goto(zone);
    } catch (err) {
      currentTime = spacetime__WEBPACK_IMPORTED_MODULE_1__["default"].now().goto('GMT');
    }
    return (_b = (_a = options.filter(tz => tz.offset === currentTime.timezone().current.offset).map(tz => {
      let score = 0;
      if (currentTime.timezones[tz.value.toLowerCase()] && Boolean(currentTime.timezones[tz.value.toLowerCase()].dst) === currentTime.timezone().hasDst) {
        if (tz.value.toLowerCase().indexOf(currentTime.tz.substring(currentTime.tz.indexOf('/') + 1)) !== -1) {
          score += 8;
        }
        if (tz.label.toLowerCase().indexOf(currentTime.tz.substring(currentTime.tz.indexOf('/') + 1)) !== -1) {
          score += 4;
        }
        if (tz.value.toLowerCase().indexOf(currentTime.tz.substring(0, currentTime.tz.indexOf('/'))) !== -1) {
          score += 2;
        }
        score += 1;
      } else if (tz.value === 'GMT') {
        score += 1;
      }
      return {
        tz,
        score
      };
    }).sort((a, b) => b.score - a.score)) == null ? void 0 : _a[0]) == null ? void 0 : _b.tz;
  };
  function isObject(item) {
    return typeof item === 'object' && !Array.isArray(item) && item !== null;
  }
  const parseTimezone = zone => {
    if (typeof zone === 'string') {
      // eslint-disable-next-line @stylistic/no-mixed-operators
      return options.find(tz => tz.value === zone) || zone.indexOf('/') !== -1 && findFuzzyTz(zone);
    } else if (isObject(zone) && !zone.label) {
      return options.find(tz => tz.value === zone.value);
    } else {
      return zone;
    }
  };
  return {
    options,
    parseTimezone
  };
}

/***/ },

/***/ "./src/components/common/Audio.scss"
/*!******************************************!*\
  !*** ./src/components/common/Audio.scss ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/Audio.tsx"
/*!*****************************************!*\
  !*** ./src/components/common/Audio.tsx ***!
  \*****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   TINY_SCREEN_WIDTH_MQL: () => (/* binding */ TINY_SCREEN_WIDTH_MQL),
/* harmony export */   WITH_AVATAR_TINY_SCREEN_WIDTH_MQL: () => (/* binding */ WITH_AVATAR_TINY_SCREEN_WIDTH_MQL),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   useWaveformCanvas: () => (/* binding */ useWaveformCanvas)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_media__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _util_audioPlayer__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/audioPlayer */ "./src/util/audioPlayer.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_waveform__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/waveform */ "./src/util/waveform.ts");
/* harmony import */ var _helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _helpers_documentInfo__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./helpers/documentInfo */ "./src/components/common/helpers/documentInfo.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_waveform__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./helpers/waveform */ "./src/components/common/helpers/waveform.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useAudioPlayer__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../hooks/useAudioPlayer */ "./src/hooks/useAudioPlayer.ts");
/* harmony import */ var _hooks_useBuffering__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../hooks/useBuffering */ "./src/hooks/useBuffering.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../hooks/useMediaWithLoadProgress */ "./src/hooks/useMediaWithLoadProgress.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../ui/ProgressSpinner */ "./src/components/ui/ProgressSpinner.tsx");
/* harmony import */ var _AnimatedIcon__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./AnimatedIcon */ "./src/components/common/AnimatedIcon.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _Audio_scss__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./Audio.scss */ "./src/components/common/Audio.scss");































const TINY_SCREEN_WIDTH_MQL = window.matchMedia('(max-width: 375px)');
const WITH_AVATAR_TINY_SCREEN_WIDTH_MQL = window.matchMedia('(max-width: 410px)');
const AVG_VOICE_DURATION = 10;
// This is needed for browsers requiring user interaction before playing.
const PRELOAD = true;
const Audio = ({
  theme,
  message,
  senderTitle,
  uploadProgress,
  origin,
  date,
  noAvatars,
  className,
  isSelectable,
  isSelected,
  isDownloading,
  isTranscribing,
  isTranscriptionHidden,
  isTranscribed,
  isTranscriptionError,
  canDownload,
  canTranscribe,
  autoPlay,
  webPage,
  mediaDuration,
  onHideTranscription,
  onPlay,
  onPause,
  onReadMedia,
  onCancelUpload,
  onDateClick
}) => {
  const {
    cancelMediaDownload,
    downloadMedia,
    transcribeAudio,
    openOneTimeMediaModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    content: {
      audio: contentAudio,
      voice,
      video
    },
    isMediaUnread
  } = message;
  const audio = contentAudio || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getWebPageAudio)(webPage);
  const media = voice || video || audio;
  const mediaSource = voice || video;
  const isVoice = Boolean(voice || video);
  const isSeeking = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const seekerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_22__["default"])();
  const {
    isRtl
  } = lang;
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const [isActivated, setIsActivated] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const shouldLoad = isActivated || PRELOAD;
  const coverHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaHash)(media, 'pictogram');
  const coverBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_20__["default"])(coverHash, false, _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl);
  const hasTtl = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.hasMessageTtl)(message);
  const isInOneTimeModal = origin === _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.OneTimeModal;
  const trackType = isVoice ? hasTtl ? 'oneTimeVoice' : 'voice' : 'audio';
  const mediaData = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_20__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaHash)(media, 'inline'), !shouldLoad, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaFormat)(media, 'inline'));
  const {
    loadProgress: downloadProgress
  } = (0,_hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_21__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaHash)(media, 'download'), !isDownloading, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaFormat)(media, 'download'));
  const handleForcePlay = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    setIsActivated(true);
    onPlay?.(message.id, message.chatId);
  });
  const handleTrackChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    setIsActivated(false);
  });
  const {
    isBuffered,
    bufferedRanges,
    bufferingHandlers,
    checkBuffering
  } = (0,_hooks_useBuffering__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const noReset = isInOneTimeModal;
  const {
    isPlaying,
    playProgress,
    playPause,
    setCurrentTime,
    duration
  } = (0,_hooks_useAudioPlayer__WEBPACK_IMPORTED_MODULE_17__["default"])((0,_util_audioPlayer__WEBPACK_IMPORTED_MODULE_7__.makeTrackId)(message), mediaDuration, trackType, mediaData, bufferingHandlers, undefined, checkBuffering, Boolean(isActivated || autoPlay), handleForcePlay, handleTrackChange, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isMessageLocal)(message) || hasTtl, undefined, onPause, noReset, hasTtl && !isInOneTimeModal);
  const reversePlayProgress = 1 - playProgress;
  const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isOwnMessage)(message);
  const isReverse = hasTtl && isInOneTimeModal;
  const waveformCanvasRef = useWaveformCanvas(theme, mediaSource, isMediaUnread && !isOwn && !isReverse ? 1 : playProgress, isOwn, !noAvatars, isMobile, isReverse);
  const withSeekline = isPlaying || playProgress > 0 && playProgress < 1;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setIsActivated(isPlaying);
  }, [isPlaying]);
  const isLoadingForPlaying = isActivated && !isBuffered;
  const {
    isUploading,
    isTransferring,
    transferProgress
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaTransferState)(uploadProgress || downloadProgress, isLoadingForPlaying || isDownloading, uploadProgress !== undefined);
  const {
    shouldRender: shouldRenderSpinner,
    transitionClassNames: spinnerClassNames
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_23__["default"])(isTransferring);
  const shouldRenderCross = shouldRenderSpinner && (isLoadingForPlaying || isUploading);
  const handleButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    if (isUploading) {
      onCancelUpload?.();
      return;
    }
    if (hasTtl) {
      openOneTimeMediaModal({
        message
      });
      onReadMedia?.();
      return;
    }
    if (!isPlaying) {
      onPlay?.(message.id, message.chatId);
    }
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().setAudioPlayerOrigin({
      origin
    });
    setIsActivated(!isActivated);
    playPause();
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (onReadMedia && isMediaUnread && isPlaying) {
      onReadMedia();
    }
  }, [isPlaying, isMediaUnread, onReadMedia]);
  const handleDownloadClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    if (isDownloading) {
      cancelMediaDownload({
        media
      });
    } else {
      downloadMedia({
        media,
        originMessage: message
      });
    }
  });
  const handleSeek = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(e => {
    if (isSeeking.current && seekerRef.current) {
      const {
        width,
        left
      } = seekerRef.current.getBoundingClientRect();
      const clientX = e instanceof MouseEvent ? e.clientX : e.targetTouches[0].clientX;
      e.stopPropagation(); // Prevent Slide-to-Reply activation
      // Prevent track skipping while seeking near end
      setCurrentTime(Math.max(Math.min(duration * ((clientX - left) / width), duration - 0.1), 0.001));
    }
  });
  const handleStartSeek = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(e => {
    if (e instanceof MouseEvent && e.button === 2) return;
    isSeeking.current = true;
    handleSeek(e);
  });
  const handleStopSeek = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    isSeeking.current = false;
  });
  const handleDateClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    onDateClick(message);
  });
  const handleTranscribe = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    transcribeAudio({
      chatId: message.chatId,
      messageId: message.id
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!seekerRef.current || !withSeekline || isInOneTimeModal) return undefined;
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_9__.captureEvents)(seekerRef.current, {
      onCapture: handleStartSeek,
      onRelease: handleStopSeek,
      onClick: handleStopSeek,
      onDrag: handleSeek
    });
  }, [withSeekline, handleStartSeek, handleSeek, handleStopSeek, isInOneTimeModal]);
  function renderFirstLine() {
    if (isVoice) {
      return senderTitle || 'Voice';
    }
    const {
      title,
      fileName
    } = audio;
    return title || fileName;
  }
  function renderSecondLine() {
    if (isVoice) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "meta",
        dir: isRtl ? 'rtl' : undefined
      }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatMediaDuration)((voice || video).duration));
    }
    const {
      performer
    } = audio;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "meta",
      dir: isRtl ? 'rtl' : undefined
    }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatMediaDuration)(duration), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "bullet"
    }, "\u2022"), performer && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "performer",
      title: performer
    }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_14__["default"])(performer)), performer && senderTitle && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "bullet"
    }, "\u2022"), senderTitle && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      title: senderTitle
    }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_14__["default"])(senderTitle)));
  }
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('Audio', className, isInOneTimeModal && 'non-interactive', origin === _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.Inline && 'inline', isOwn && origin === _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.Inline && 'own', (origin === _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.Search || origin === _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.SharedMedia) && 'bigger', isSelected && 'audio-is-selected');
  const buttonClassNames = ['toogle-play-wrapper'];
  if (shouldRenderCross) {
    buttonClassNames.push('loading');
  } else {
    buttonClassNames.push(isPlaying ? 'pause' : 'play');
  }
  const contentClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('content', withSeekline && 'with-seekline');
  function renderWithTitle() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: contentClassName
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "content-row"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: "title",
      dir: "auto",
      title: renderFirstLine()
    }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_14__["default"])(renderFirstLine())), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-date"
    }, Boolean(date) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_25__["default"], {
      className: "date",
      onClick: handleDateClick
    }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatPastTimeShort)(lang, date * 1000)))), withSeekline && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "meta search-result",
      dir: isRtl ? 'rtl' : undefined
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "duration with-seekline",
      dir: "auto"
    }, playProgress < 1 && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatMediaDuration)(duration * playProgress, duration)), renderSeekline(playProgress, bufferedRanges, seekerRef)), !withSeekline && renderSecondLine());
  }
  function renderTooglePlayWrapper() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])(...buttonClassNames)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
      round: true,
      ripple: !isMobile,
      size: "smaller",
      className: "toggle-play",
      color: coverBlobUrl ? 'translucent-white' : 'primary',
      ariaLabel: isPlaying ? 'Pause audio' : 'Play audio',
      onClick: handleButtonClick,
      isRtl: lang.isRtl,
      backgroundImage: coverBlobUrl,
      nonInteractive: isInOneTimeModal
    }, !isInOneTimeModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_28__["default"], {
      name: "play"
    }), !isInOneTimeModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_28__["default"], {
      name: "pause"
    }), isInOneTimeModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AnimatedIcon__WEBPACK_IMPORTED_MODULE_27__["default"], {
      className: "flame",
      tgsUrl: _helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_12__.LOCAL_TGS_URLS.Flame,
      nonInteractive: true,
      noLoop: false,
      size: 40
    })), hasTtl && !isInOneTimeModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_28__["default"], {
      name: "view-once"
    }));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: fullClassName,
    dir: lang.isRtl ? 'rtl' : 'ltr'
  }, isSelectable && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-select-control no-selection"
  }, isSelected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_28__["default"], {
    name: "select"
  })), renderTooglePlayWrapper(), shouldRenderSpinner && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('media-loading', spinnerClassNames, shouldRenderCross && 'interactive')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_26__["default"], {
    progress: transferProgress,
    transparent: true,
    withColor: true,
    size: "m",
    onClick: shouldRenderCross ? handleButtonClick : undefined,
    noCross: !shouldRenderCross
  })), isInOneTimeModal && !shouldRenderSpinner && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('media-loading')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_26__["default"], {
    progress: playProgress,
    transparent: true,
    size: "m",
    noCross: true,
    rotationOffset: 3 / 4
  })), audio && canDownload && !isUploading && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    round: true,
    size: "tiny",
    className: "download-button",
    ariaLabel: isDownloading ? 'Cancel download' : 'Download',
    onClick: handleDownloadClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_28__["default"], {
    name: isDownloading ? 'close' : 'arrow-down'
  })), origin === _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.Search && renderWithTitle(), origin !== _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.Search && audio && renderAudio(lang, audio, duration, isPlaying, playProgress, bufferedRanges, seekerRef, isDownloading || isUploading, date, transferProgress, onDateClick ? handleDateClick : undefined), origin === _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.SharedMedia && mediaSource && renderWithTitle(), (origin === _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.Inline || isInOneTimeModal || isTranscribed) && mediaSource && renderVoice(mediaSource, seekerRef, waveformCanvasRef, hasTtl ? reversePlayProgress : playProgress, isMediaUnread, isTranscribing, isTranscriptionHidden, isTranscribed, isTranscriptionError, canTranscribe ? handleTranscribe : undefined, onHideTranscription, origin));
};
function getSeeklineSpikeAmounts(isMobile, withAvatar) {
  return {
    MIN_SPIKES: isMobile ? TINY_SCREEN_WIDTH_MQL.matches ? 16 : 20 : 25,
    MAX_SPIKES: isMobile ? TINY_SCREEN_WIDTH_MQL.matches ? 35 : withAvatar && WITH_AVATAR_TINY_SCREEN_WIDTH_MQL.matches ? 40 : 45 : 75
  };
}
function renderAudio(lang, audio, duration, isPlaying, playProgress, bufferedRanges, seekerRef, showProgress, date, progress, handleDateClick) {
  const {
    title,
    performer,
    fileName
  } = audio;
  const showSeekline = isPlaying || playProgress > 0 && playProgress < 1;
  const {
    isRtl
  } = lang;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "content"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "title",
    dir: "auto",
    title: title
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_14__["default"])(title || fileName)), showSeekline && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "meta",
    dir: isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "duration with-seekline",
    dir: "auto"
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatMediaDuration)(duration * playProgress, duration)), renderSeekline(playProgress, bufferedRanges, seekerRef)), !showSeekline && showProgress && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "meta",
    dir: isRtl ? 'rtl' : undefined
  }, progress ? `${(0,_helpers_documentInfo__WEBPACK_IMPORTED_MODULE_13__.getFileSizeString)(audio.size * progress)} / ` : undefined, (0,_helpers_documentInfo__WEBPACK_IMPORTED_MODULE_13__.getFileSizeString)(audio.size)), !showSeekline && !showProgress && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "meta",
    dir: isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "duration",
    dir: "auto"
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatMediaDuration)(duration)), performer && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "bullet"
  }, "\u2022"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "performer",
    dir: "auto",
    title: performer
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_14__["default"])(performer))), Boolean(date) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "bullet"
  }, "\u2022"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_25__["default"], {
    className: "date",
    onClick: handleDateClick
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatMediaDateTime)(lang, date * 1000, true)))));
}
function renderVoice(media, seekerRef, waveformCanvasRef, playProgress, isMediaUnread, isTranscribing, isTranscriptionHidden, isTranscribed, isTranscriptionError, onClickTranscribe, onHideTranscription, origin) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "content"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "waveform-wrapper"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "waveform",
    draggable: false,
    ref: seekerRef
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: waveformCanvasRef
  })), onClickTranscribe && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    onClick: () => {
      if ((isTranscribed || isTranscriptionError) && onHideTranscription) {
        onHideTranscription(!isTranscriptionHidden);
      } else if (!isTranscribing) {
        onClickTranscribe();
      }
    }
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_28__["default"], {
    name: isTranscribed || isTranscriptionError ? 'down' : 'transcribe',
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('transcribe-icon', (isTranscribed || isTranscriptionError) && !isTranscriptionHidden && 'transcribe-shown')
  }), isTranscribing && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    viewBox: "0 0 32 24",
    className: "loading-svg"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("rect", {
    className: "loading-rect",
    fill: "transparent",
    width: "32",
    height: "24",
    "stroke-width": "3",
    "stroke-linejoin": "round",
    rx: "6",
    ry: "6",
    stroke: "white",
    "stroke-dashoffset": "1",
    "stroke-dasharray": "32,68"
  })))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('voice-duration', origin !== _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.OneTimeModal && isMediaUnread && 'unread'),
    dir: "auto"
  }, playProgress === 0 || playProgress === 1 ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatMediaDuration)(media.duration) : (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_10__.formatMediaDuration)(media.duration * playProgress)));
}
function useWaveformCanvas(theme, media, playProgress = 0, isOwn = false, withAvatar = false, isMobile = false, isReverse = false) {
  const canvasRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    data: spikes,
    peak
  } = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!media) {
      return undefined;
    }
    const {
      waveform,
      duration
    } = media;
    if (!waveform) {
      return {
        data: new Array(Math.min(duration, _helpers_waveform__WEBPACK_IMPORTED_MODULE_15__.MAX_EMPTY_WAVEFORM_POINTS)).fill(0),
        peak: 0
      };
    }
    const {
      MIN_SPIKES,
      MAX_SPIKES
    } = getSeeklineSpikeAmounts(isMobile, withAvatar);
    const durationFactor = Math.min(duration / AVG_VOICE_DURATION, 1);
    const spikesCount = Math.round(MIN_SPIKES + (MAX_SPIKES - MIN_SPIKES) * durationFactor);
    const decodedWaveform = (0,_util_waveform__WEBPACK_IMPORTED_MODULE_11__.decodeWaveform)(new Uint8Array(waveform));
    return (0,_util_waveform__WEBPACK_IMPORTED_MODULE_11__.interpolateArray)(decodedWaveform, spikesCount);
  }, [isMobile, media, withAvatar]) || {};
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    const canvas = canvasRef.current;
    if (!canvas || !spikes || peak === undefined) {
      return;
    }
    const fillColor = theme === 'dark' ? '#494A78' : '#ADD3F7';
    const fillOwnColor = theme === 'dark' ? '#B7ABED' : '#AEDFA4';
    const progressFillColor = theme === 'dark' ? '#8774E1' : '#3390EC';
    const progressFillOwnColor = theme === 'dark' ? '#FFFFFF' : '#4FAE4E';
    const fillStyle = isOwn ? fillOwnColor : fillColor;
    const progressFillStyle = isOwn ? progressFillOwnColor : progressFillColor;
    (0,_helpers_waveform__WEBPACK_IMPORTED_MODULE_15__.renderWaveform)(canvas, spikes, isReverse ? 1 - playProgress : playProgress, {
      peak,
      fillStyle,
      progressFillStyle
    });
  }, [isOwn, peak, playProgress, spikes, theme, isReverse]);
  return canvasRef;
}
function renderSeekline(playProgress, bufferedRanges, seekerRef) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "seekline",
    ref: seekerRef
  }, bufferedRanges.map(({
    start,
    end
  }) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "seekline-buffered-progress",
    style: `left: ${start * 100}%; right: ${100 - end * 100}%`
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "seekline-play-progress"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "seekline-play-progress-inner",
    style: `transform: translateX(${playProgress * 100}%)`
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "seekline-thumb"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: "seekline-thumb-inner",
    style: `transform: translateX(${playProgress * 100}%)`
  })));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  message
}) => {
  const webPage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectWebPageFromMessage)(global, message);
  const mediaDuration = (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_6__.selectMessageMediaDuration)(global, message);
  return {
    webPage,
    mediaDuration
  };
})(Audio)));

/***/ },

/***/ "./src/components/common/ChatForumLastMessage.module.scss"
/*!****************************************************************!*\
  !*** ./src/components/common/ChatForumLastMessage.module.scss ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Ow6Ij9O5","title-row":"CBda1UmC","titleRow":"CBda1UmC","loading":"L4Zk0yMN","other-column":"d0hTIVJn","otherColumn":"d0hTIVJn","main-column":"lEbV6HrI","mainColumn":"lEbV6HrI","unread":"BhS75ocD","last-message":"KJ16dBus","lastMessage":"KJ16dBus","after-wrapper":"uWo2dhui","afterWrapper":"uWo2dhui","after":"g3XnC73g","title":"k3Ch25ZQ","otherColumnIcon":"oknhG11L","other-column-title":"ZUj3xAjs","otherColumnTitle":"ZUj3xAjs","other-columns":"IkuCBmvA","otherColumns":"IkuCBmvA","ellipsis":"_m_2xcPW","reverse-corner":"U_yhhC0w","reverseCorner":"U_yhhC0w","overwritten-width":"HV0wCR4O","overwrittenWidth":"HV0wCR4O"});

/***/ },

/***/ "./src/components/common/ChatForumLastMessage.tsx"
/*!********************************************************!*\
  !*** ./src/components/common/ChatForumLastMessage.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _TopicIcon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./TopicIcon */ "./src/components/common/TopicIcon.tsx");
/* harmony import */ var _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./ChatForumLastMessage.module.scss */ "./src/components/common/ChatForumLastMessage.module.scss");












const NO_CORNER_THRESHOLD = Number(_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM);
const MAX_TOPICS = 3;
const ChatForumLastMessage = ({
  chat,
  topics,
  renderLastMessage,
  observeIntersection
}) => {
  const {
    openThread
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lastMessageRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const mainColumnRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [lastActiveTopic, ...otherTopics] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!topics) {
      return [];
    }
    return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getOrderedTopics)(Object.values(topics), undefined, true).slice(0, MAX_TOPICS);
  }, [topics]);
  const [isReversedCorner, setIsReversedCorner] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [overwrittenWidth, setOverwrittenWidth] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const {
    handleClick: handleOpenTopicClick,
    handleMouseDown: handleOpenTopicMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_7__.useFastClick)(e => {
    if (lastActiveTopic.unreadCount === 0 || chat.isForumAsMessages) return;
    e.stopPropagation();
    e.preventDefault();
    openThread({
      chatId: chat.id,
      threadId: lastActiveTopic.id,
      shouldReplaceHistory: true,
      noForumTopicPanel: (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__.getIsMobile)()
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const lastMessageElement = lastMessageRef.current;
    const mainColumnElement = mainColumnRef.current;
    if (!lastMessageElement || !mainColumnElement) return;
    const lastMessageWidth = lastMessageElement.offsetWidth;
    const mainColumnWidth = mainColumnElement.offsetWidth;
    if (Math.abs(lastMessageWidth - mainColumnWidth) < NO_CORNER_THRESHOLD) {
      setOverwrittenWidth(Math.max(lastMessageWidth, mainColumnWidth));
    } else {
      setOverwrittenWidth(undefined);
    }
    setIsReversedCorner(lastMessageWidth > mainColumnWidth);
  }, [lastActiveTopic, renderLastMessage]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root, isReversedCorner && _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].reverseCorner, overwrittenWidth && _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].overwrittenWidth),
    dir: lang.isRtl ? 'rtl' : undefined,
    style: overwrittenWidth ? `--overwritten-width: ${overwrittenWidth}px` : undefined
  }, lastActiveTopic && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].titleRow
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].mainColumn, lastActiveTopic.unreadCount && _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].unread),
    ref: mainColumnRef,
    onClick: handleOpenTopicClick,
    onMouseDown: handleOpenTopicMouseDown
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TopicIcon__WEBPACK_IMPORTED_MODULE_9__["default"], {
    topic: lastActiveTopic,
    observeIntersection: observeIntersection
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].title
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(lastActiveTopic.title)), !overwrittenWidth && isReversedCorner && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].afterWrapper
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].after
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].otherColumns
  }, otherTopics.map(topic => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].otherColumn, topic.unreadCount && _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].unread),
    key: topic.id
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TopicIcon__WEBPACK_IMPORTED_MODULE_9__["default"], {
    topic: topic,
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].otherColumnIcon,
    observeIntersection: observeIntersection
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].otherColumnTitle
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(topic.title))))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].ellipsis
  })), !lastActiveTopic && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].titleRow, _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].loading)
  }, lang('Loading')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].lastMessage, lastActiveTopic?.unreadCount && _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].unread),
    ref: lastMessageRef,
    onClick: handleOpenTopicClick,
    onMouseDown: handleOpenTopicMouseDown
  }, renderLastMessage(), !overwrittenWidth && !isReversedCorner && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].afterWrapper
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatForumLastMessage_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].after
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ChatForumLastMessage));

/***/ },

/***/ "./src/components/common/Composer.scss"
/*!*********************************************!*\
  !*** ./src/components/common/Composer.scss ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/Composer.tsx"
/*!********************************************!*\
  !*** ./src/components/common/Composer.tsx ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_notifications__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/helpers/notifications */ "./src/global/helpers/notifications.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_limits__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../global/selectors/limits */ "./src/global/selectors/limits.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_deeplink__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../util/deeplink */ "./src/util/deeplink.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_deleteLastCharacterOutsideSelection__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../util/deleteLastCharacterOutsideSelection */ "./src/util/deleteLastCharacterOutsideSelection.ts");
/* harmony import */ var _util_emoji_customEmojiManager__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../util/emoji/customEmojiManager */ "./src/util/emoji/customEmojiManager.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_focusEditableElement__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../util/focusEditableElement */ "./src/util/focusEditableElement.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _util_selection__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../util/selection */ "./src/util/selection.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_windowSize__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../util/windowSize */ "./src/util/windowSize.ts");
/* harmony import */ var _chatAssistant_component_input_translate_input_translate__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../chatAssistant/component/input-translate/input-translate */ "./src/components/chatAssistant/component/input-translate/input-translate.tsx");
/* harmony import */ var _chatAssistant_utils_user_information_collection__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../chatAssistant/utils/user-information-collection */ "./src/components/chatAssistant/utils/user-information-collection.ts");
/* harmony import */ var _middle_composer_helpers_applyIosAutoCapitalizationFix__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../middle/composer/helpers/applyIosAutoCapitalizationFix */ "./src/components/middle/composer/helpers/applyIosAutoCapitalizationFix.ts");
/* harmony import */ var _middle_composer_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../middle/composer/helpers/buildAttachment */ "./src/components/middle/composer/helpers/buildAttachment.ts");
/* harmony import */ var _middle_composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../middle/composer/helpers/customEmoji */ "./src/components/middle/composer/helpers/customEmoji.ts");
/* harmony import */ var _middle_composer_helpers_selection__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../middle/composer/helpers/selection */ "./src/components/middle/composer/helpers/selection.ts");
/* harmony import */ var _helpers_peerColor__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./helpers/peerColor */ "./src/components/common/helpers/peerColor.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useGetSelectionRange__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ../../hooks/useGetSelectionRange */ "./src/hooks/useGetSelectionRange.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useSchedule__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ../../hooks/useSchedule */ "./src/hooks/useSchedule.tsx");
/* harmony import */ var _hooks_useSendMessageAction__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ../../hooks/useSendMessageAction */ "./src/hooks/useSendMessageAction.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _hooks_useStateRef__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ../../hooks/useStateRef */ "./src/hooks/useStateRef.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");
/* harmony import */ var _middle_composer_hooks_useAttachmentModal__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ../middle/composer/hooks/useAttachmentModal */ "./src/components/middle/composer/hooks/useAttachmentModal.ts");
/* harmony import */ var _middle_composer_hooks_useChatCommandTooltip__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ../middle/composer/hooks/useChatCommandTooltip */ "./src/components/middle/composer/hooks/useChatCommandTooltip.ts");
/* harmony import */ var _middle_composer_hooks_useClipboardPaste__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ../middle/composer/hooks/useClipboardPaste */ "./src/components/middle/composer/hooks/useClipboardPaste.ts");
/* harmony import */ var _middle_composer_hooks_useCustomEmojiTooltip__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ../middle/composer/hooks/useCustomEmojiTooltip */ "./src/components/middle/composer/hooks/useCustomEmojiTooltip.ts");
/* harmony import */ var _middle_composer_hooks_useDraft__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ../middle/composer/hooks/useDraft */ "./src/components/middle/composer/hooks/useDraft.ts");
/* harmony import */ var _middle_composer_hooks_useEditing__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ../middle/composer/hooks/useEditing */ "./src/components/middle/composer/hooks/useEditing.ts");
/* harmony import */ var _middle_composer_hooks_useEmojiTooltip__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ../middle/composer/hooks/useEmojiTooltip */ "./src/components/middle/composer/hooks/useEmojiTooltip.ts");
/* harmony import */ var _middle_composer_hooks_useInlineBotTooltip__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ../middle/composer/hooks/useInlineBotTooltip */ "./src/components/middle/composer/hooks/useInlineBotTooltip.ts");
/* harmony import */ var _middle_composer_hooks_useLoadLinkPreview__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ../middle/composer/hooks/useLoadLinkPreview */ "./src/components/middle/composer/hooks/useLoadLinkPreview.ts");
/* harmony import */ var _middle_composer_hooks_useMentionTooltip__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ../middle/composer/hooks/useMentionTooltip */ "./src/components/middle/composer/hooks/useMentionTooltip.ts");
/* harmony import */ var _middle_composer_hooks_usePaidMessageConfirmation__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! ../middle/composer/hooks/usePaidMessageConfirmation */ "./src/components/middle/composer/hooks/usePaidMessageConfirmation.ts");
/* harmony import */ var _middle_composer_hooks_useStickerTooltip__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! ../middle/composer/hooks/useStickerTooltip */ "./src/components/middle/composer/hooks/useStickerTooltip.ts");
/* harmony import */ var _middle_composer_hooks_useVoiceRecording__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! ../middle/composer/hooks/useVoiceRecording */ "./src/components/middle/composer/hooks/useVoiceRecording.ts");
/* harmony import */ var _chatAssistant_component_input_grammar_GrammarToolWrapper__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(/*! ../chatAssistant/component/input-grammar/GrammarToolWrapper */ "./src/components/chatAssistant/component/input-grammar/GrammarToolWrapper.tsx");
/* harmony import */ var _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(/*! ../chatAssistant/lib/EventEmitter */ "./src/components/chatAssistant/lib/EventEmitter.ts");
/* harmony import */ var _middle_composer_AttachmentModal_async__WEBPACK_IMPORTED_MODULE_67__ = __webpack_require__(/*! ../middle/composer/AttachmentModal.async */ "./src/components/middle/composer/AttachmentModal.async.tsx");
/* harmony import */ var _middle_composer_AttachMenu__WEBPACK_IMPORTED_MODULE_68__ = __webpack_require__(/*! ../middle/composer/AttachMenu */ "./src/components/middle/composer/AttachMenu.tsx");
/* harmony import */ var _middle_composer_BotCommandMenu_async__WEBPACK_IMPORTED_MODULE_69__ = __webpack_require__(/*! ../middle/composer/BotCommandMenu.async */ "./src/components/middle/composer/BotCommandMenu.async.tsx");
/* harmony import */ var _middle_composer_BotKeyboardMenu__WEBPACK_IMPORTED_MODULE_70__ = __webpack_require__(/*! ../middle/composer/BotKeyboardMenu */ "./src/components/middle/composer/BotKeyboardMenu.tsx");
/* harmony import */ var _middle_composer_BotMenuButton__WEBPACK_IMPORTED_MODULE_71__ = __webpack_require__(/*! ../middle/composer/BotMenuButton */ "./src/components/middle/composer/BotMenuButton.tsx");
/* harmony import */ var _middle_composer_ChatCommandTooltip_async__WEBPACK_IMPORTED_MODULE_72__ = __webpack_require__(/*! ../middle/composer/ChatCommandTooltip.async */ "./src/components/middle/composer/ChatCommandTooltip.async.tsx");
/* harmony import */ var _middle_composer_ComposerEmbeddedMessage__WEBPACK_IMPORTED_MODULE_73__ = __webpack_require__(/*! ../middle/composer/ComposerEmbeddedMessage */ "./src/components/middle/composer/ComposerEmbeddedMessage.tsx");
/* harmony import */ var _middle_composer_CustomEmojiTooltip_async__WEBPACK_IMPORTED_MODULE_74__ = __webpack_require__(/*! ../middle/composer/CustomEmojiTooltip.async */ "./src/components/middle/composer/CustomEmojiTooltip.async.tsx");
/* harmony import */ var _middle_composer_CustomSendMenu_async__WEBPACK_IMPORTED_MODULE_75__ = __webpack_require__(/*! ../middle/composer/CustomSendMenu.async */ "./src/components/middle/composer/CustomSendMenu.async.tsx");
/* harmony import */ var _middle_composer_DropArea_async__WEBPACK_IMPORTED_MODULE_76__ = __webpack_require__(/*! ../middle/composer/DropArea.async */ "./src/components/middle/composer/DropArea.async.tsx");
/* harmony import */ var _middle_composer_EmojiTooltip_async__WEBPACK_IMPORTED_MODULE_77__ = __webpack_require__(/*! ../middle/composer/EmojiTooltip.async */ "./src/components/middle/composer/EmojiTooltip.async.tsx");
/* harmony import */ var _middle_composer_InlineBotTooltip_async__WEBPACK_IMPORTED_MODULE_78__ = __webpack_require__(/*! ../middle/composer/InlineBotTooltip.async */ "./src/components/middle/composer/InlineBotTooltip.async.tsx");
/* harmony import */ var _middle_composer_MentionTooltip_async__WEBPACK_IMPORTED_MODULE_79__ = __webpack_require__(/*! ../middle/composer/MentionTooltip.async */ "./src/components/middle/composer/MentionTooltip.async.tsx");
/* harmony import */ var _middle_composer_MessageInput__WEBPACK_IMPORTED_MODULE_80__ = __webpack_require__(/*! ../middle/composer/MessageInput */ "./src/components/middle/composer/MessageInput.tsx");
/* harmony import */ var _middle_composer_PollModal_async__WEBPACK_IMPORTED_MODULE_81__ = __webpack_require__(/*! ../middle/composer/PollModal.async */ "./src/components/middle/composer/PollModal.async.tsx");
/* harmony import */ var _middle_composer_SendAsMenu_async__WEBPACK_IMPORTED_MODULE_82__ = __webpack_require__(/*! ../middle/composer/SendAsMenu.async */ "./src/components/middle/composer/SendAsMenu.async.tsx");
/* harmony import */ var _middle_composer_StickerTooltip_async__WEBPACK_IMPORTED_MODULE_83__ = __webpack_require__(/*! ../middle/composer/StickerTooltip.async */ "./src/components/middle/composer/StickerTooltip.async.tsx");
/* harmony import */ var _middle_composer_SymbolMenuButton__WEBPACK_IMPORTED_MODULE_84__ = __webpack_require__(/*! ../middle/composer/SymbolMenuButton */ "./src/components/middle/composer/SymbolMenuButton.tsx");
/* harmony import */ var _middle_composer_ToDoListModal_async__WEBPACK_IMPORTED_MODULE_85__ = __webpack_require__(/*! ../middle/composer/ToDoListModal.async */ "./src/components/middle/composer/ToDoListModal.async.tsx");
/* harmony import */ var _middle_composer_WebPagePreview__WEBPACK_IMPORTED_MODULE_86__ = __webpack_require__(/*! ../middle/composer/WebPagePreview */ "./src/components/middle/composer/WebPagePreview.tsx");
/* harmony import */ var _middle_message_MessageEffect__WEBPACK_IMPORTED_MODULE_87__ = __webpack_require__(/*! ../middle/message/MessageEffect */ "./src/components/middle/message/MessageEffect.tsx");
/* harmony import */ var _middle_message_reactions_ReactionSelector__WEBPACK_IMPORTED_MODULE_88__ = __webpack_require__(/*! ../middle/message/reactions/ReactionSelector */ "./src/components/middle/message/reactions/ReactionSelector.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_89__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_90__ = __webpack_require__(/*! ../ui/ResponsiveHoverButton */ "./src/components/ui/ResponsiveHoverButton.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_91__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_92__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _AnimatedCounter__WEBPACK_IMPORTED_MODULE_93__ = __webpack_require__(/*! ./AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_94__ = __webpack_require__(/*! ./Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_95__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _PaymentMessageConfirmDialog__WEBPACK_IMPORTED_MODULE_96__ = __webpack_require__(/*! ./PaymentMessageConfirmDialog */ "./src/components/common/PaymentMessageConfirmDialog.tsx");
/* harmony import */ var _reactions_ReactionAnimatedEmoji__WEBPACK_IMPORTED_MODULE_97__ = __webpack_require__(/*! ./reactions/ReactionAnimatedEmoji */ "./src/components/common/reactions/ReactionAnimatedEmoji.tsx");
/* harmony import */ var _Composer_scss__WEBPACK_IMPORTED_MODULE_98__ = __webpack_require__(/*! ./Composer.scss */ "./src/components/common/Composer.scss");
/* harmony import */ var _middle_composer_ComposerTranslatededMessage__WEBPACK_IMPORTED_MODULE_99__ = __webpack_require__(/*! ../middle/composer/ComposerTranslatededMessage */ "./src/components/middle/composer/ComposerTranslatededMessage.tsx");
/* harmony import */ var _chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_100__ = __webpack_require__(/*! ../chatAssistant/utils/room-input-translate */ "./src/components/chatAssistant/utils/room-input-translate.ts");
/* harmony import */ var _chatAssistant_hook_useEventBusTeact__WEBPACK_IMPORTED_MODULE_101__ = __webpack_require__(/*! ../chatAssistant/hook/useEventBusTeact */ "./src/components/chatAssistant/hook/useEventBusTeact.ts");







































































































var MainButtonState = /*#__PURE__*/function (MainButtonState) {
  MainButtonState["Send"] = "send";
  MainButtonState["Record"] = "record";
  MainButtonState["Edit"] = "edit";
  MainButtonState["Schedule"] = "schedule";
  MainButtonState["Forward"] = "forward";
  MainButtonState["SendOneTime"] = "sendOneTime";
  return MainButtonState;
}(MainButtonState || {});
const VOICE_RECORDING_FILENAME = 'wonderful-voice-message.ogg';
// When voice recording is active, composer placeholder will hide to prevent overlapping
const SCREEN_WIDTH_TO_HIDE_PLACEHOLDER = 600; // px

const MOBILE_KEYBOARD_HIDE_DELAY_MS = 100;
const SELECT_MODE_TRANSITION_MS = 200;
const SENDING_ANIMATION_DURATION = 350;
const MOUNT_ANIMATION_DURATION = 430;
const Composer = ({
  type,
  isOnActiveTab,
  dropAreaState,
  isInScheduledList,
  canScheduleUntilOnline,
  isReady,
  isMobile,
  editingMessage,
  chatId,
  threadId,
  storyId,
  currentMessageList,
  messageListType,
  draft,
  chat,
  chatFullInfo,
  replyToTopic,
  isForCurrentMessageList,
  isCurrentUserPremium,
  canSendVoiceByPrivacy,
  isChatWithBot,
  isChatWithSelf,
  isChannel,
  fileSizeLimit,
  isRightColumnShown,
  isSelectModeActive,
  isReactionPickerOpen,
  shouldDisplayGiftsButton,
  isForwarding,
  isReplying,
  hasSuggestedPost,
  forwardedMessagesCount,
  pollModal,
  todoListModal,
  botKeyboardMessageId,
  botKeyboardPlaceholder,
  inputPlaceholder,
  withScheduledButton,
  stickersForEmoji,
  customEmojiForEmoji,
  topInlineBotIds,
  currentUserId,
  currentUser,
  captionLimit,
  contentToBeScheduled,
  shouldSuggestStickers,
  shouldSuggestCustomEmoji,
  baseEmojiKeywords,
  emojiKeywords,
  recentEmojis,
  inlineBots,
  isInlineBotLoading,
  botCommands,
  sendAsPeer,
  sendAsId,
  editingDraft,
  requestedDraft,
  requestedDraftFiles,
  botMenuButton,
  attachBots,
  attachMenuPeerType,
  attachmentSettings,
  theme,
  slowMode,
  shouldUpdateStickerSetOrder,
  editableInputCssSelector,
  editableInputId,
  inputId,
  className,
  availableReactions,
  topReactions,
  canBuyPremium,
  canPlayAnimatedEmojis,
  shouldCollectDebugLogs,
  sentStoryReaction,
  stealthMode,
  canSendOneTimeMedia,
  quickReplyMessages,
  quickReplies,
  canSendQuickReplies,
  webPagePreview,
  noWebPage,
  isContactRequirePremium,
  paidMessagesStars,
  effect,
  effectReactions,
  areEffectsSupported,
  canPlayEffect,
  shouldPlayEffect,
  maxMessageLength,
  isSilentPosting,
  isPaymentMessageConfirmDialogOpen,
  starsBalance,
  isStarsBalanceModalOpen,
  disallowedGifts,
  isAccountFrozen,
  isAppConfigLoaded,
  insertingPeerIdMention,
  pollMaxAnswers,
  onDropHide,
  onFocus,
  onBlur,
  onForward,
  inputTranslateOptions
}) => {
  const {
    sendMessage,
    clearDraft,
    showDialog,
    openPollModal,
    closePollModal,
    openTodoListModal,
    closeTodoListModal,
    loadScheduledHistory,
    openThread,
    addRecentEmoji,
    sendInlineBotResult,
    loadSendAs,
    resetOpenChatWithDraft,
    callAttachBot,
    addRecentCustomEmoji,
    showNotification,
    showAllowedMessageTypesNotification,
    openStoryReactionPicker,
    openGiftModal,
    closeReactionPicker,
    sendStoryReaction,
    editMessage,
    updateAttachmentSettings,
    saveEffectInDraft,
    setReactionEffect,
    hideEffectInComposer,
    updateChatSilentPosting,
    updateInsertingPeerIdMention,
    updateDraftSuggestedPostInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_44__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_42__["default"])();
  const inputRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const counterRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const storyReactionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [getHtml, setHtml] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)('');
  const [isMounted, setIsMounted] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const getSelectionRange = (0,_hooks_useGetSelectionRange__WEBPACK_IMPORTED_MODULE_41__["default"])(editableInputCssSelector);
  const lastMessageSendTimeSeconds = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const prevDropAreaState = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_46__["default"])(dropAreaState);
  const {
    width: windowWidth
  } = _util_windowSize__WEBPACK_IMPORTED_MODULE_25__["default"].get();
  const isInMessageList = type === 'messageList';
  const isInStoryViewer = type === 'story';
  const sendAsPeerIds = isInMessageList ? chat?.sendAsPeerIds : undefined;
  const canShowSendAs = Boolean(sendAsPeerIds?.length);
  // Prevent Symbol Menu from closing when calendar is open
  const [isSymbolMenuForced, forceShowSymbolMenu, cancelForceShowSymbolMenu] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__["default"])();
  const sendMessageAction = (0,_hooks_useSendMessageAction__WEBPACK_IMPORTED_MODULE_48__["default"])(chatId, threadId);
  const [isInputHasFocus, markInputHasFocus, unmarkInputHasFocus] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__["default"])();
  const [isAttachMenuOpen, onAttachMenuOpen, onAttachMenuClose] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__["default"])();
  const [isInlineAILoading, setIsInlineAILoading] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const canMediaBeReplaced = editingMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.canEditMedia)(editingMessage);
  const isMonoforum = chat?.isMonoforum;
  const {
    emojiSet,
    members: groupChatMembers,
    botCommands: chatBotCommands
  } = chatFullInfo || {};
  const chatEmojiSetId = emojiSet?.id;
  const canSchedule = !paidMessagesStars && !isMonoforum;
  const isSentStoryReactionHeart = sentStoryReaction && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isSameReaction)(sentStoryReaction, _config__WEBPACK_IMPORTED_MODULE_3__.HEART_REACTION);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(_util_emoji_customEmojiManager__WEBPACK_IMPORTED_MODULE_17__.processMessageInputForCustomEmoji, [getHtml]);
  const customEmojiNotificationNumber = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
  const [requestCalendar, calendar] = (0,_hooks_useSchedule__WEBPACK_IMPORTED_MODULE_47__["default"])(isInMessageList && canScheduleUntilOnline, cancelForceShowSymbolMenu);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_36__["default"])(() => {
    setIsMounted(true);
  }, MOUNT_ANIMATION_DURATION);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isInMessageList) return;
    closeReactionPicker();
  }, [isInMessageList, storyId]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    lastMessageSendTimeSeconds.current = undefined;
  }, [chatId]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isAppConfigLoaded && chatId && isReady && !isInStoryViewer && !isMonoforum) {
      loadScheduledHistory({
        chatId
      });
    }
  }, [isReady, chatId, threadId, isInStoryViewer, isAppConfigLoaded, isMonoforum]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const isChannelWithProfiles = isChannel && chat?.areProfilesShown;
    const isChatWithSendAs = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatSuperGroup)(chat) && Boolean((0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatPublic)(chat) || chat.isLinkedInDiscussion || chat.hasGeo);
    if (!sendAsPeerIds && isReady && (isChatWithSendAs || isChannelWithProfiles)) {
      loadSendAs({
        chatId
      });
    }
  }, [chat, chatId, isChannel, isReady, loadSendAs, sendAsPeerIds]);
  const shouldAnimateSendAsButtonRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_51__["default"])(([prevChatId, prevSendAsPeerIds]) => {
    // We only animate send-as button if `sendAsPeerIds` was missing when opening the chat
    shouldAnimateSendAsButtonRef.current = Boolean(chatId === prevChatId && sendAsPeerIds && !prevSendAsPeerIds);
  }, [chatId, sendAsPeerIds]);
  const [attachments, setAttachments] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const hasAttachments = Boolean(attachments.length);
  const [nextText, setNextText] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const {
    canSendStickers,
    canSendGifs,
    canAttachMedia,
    canAttachPolls,
    canAttachEmbedLinks,
    canAttachToDoLists,
    canSendVoices,
    canSendPlainText,
    canSendAudios,
    canSendVideos,
    canSendPhotos,
    canSendDocuments
  } = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getAllowedAttachmentOptions)(chat, chatFullInfo, isChatWithBot, isChatWithSelf, isInStoryViewer, paidMessagesStars, isInScheduledList), [chat, chatFullInfo, isChatWithBot, isChatWithSelf, isInStoryViewer, paidMessagesStars, isInScheduledList]);
  const isNeedPremium = isContactRequirePremium && isInStoryViewer;
  const isSendTextBlocked = isNeedPremium || !canSendPlainText;
  const messagesCount = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_38__["default"])(() => {
    if (hasAttachments) return attachments.length;
    const messagesInInput = getHtml() || hasAttachments ? 1 : 0;
    if (!isForwarding || !forwardedMessagesCount) return messagesInInput || 1;
    return forwardedMessagesCount + messagesInInput;
  }, [getHtml, hasAttachments, attachments, isForwarding, forwardedMessagesCount]);
  const starsForAllMessages = paidMessagesStars ? messagesCount * paidMessagesStars : 0;
  const {
    closeConfirmDialog: closeConfirmModalPayForMessage,
    dialogHandler: paymentMessageConfirmDialogHandler,
    shouldAutoApprove: shouldPaidMessageAutoApprove,
    setAutoApprove: setShouldPaidMessageAutoApprove,
    handleWithConfirmation: handleActionWithPaymentConfirmation
  } = (0,_middle_composer_hooks_usePaidMessageConfirmation__WEBPACK_IMPORTED_MODULE_62__["default"])(starsForAllMessages, isStarsBalanceModalOpen, starsBalance);
  const hasWebPagePreview = !hasAttachments && canAttachEmbedLinks && !noWebPage && Boolean(webPagePreview);
  const isComposerBlocked = isSendTextBlocked && !editingMessage;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!hasWebPagePreview) {
      updateAttachmentSettings({
        isInvertedMedia: undefined
      });
    }
  }, [hasWebPagePreview]);
  const insertHtmlAndUpdateCursor = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((newHtml, inInputId = editableInputId) => {
    if (inInputId === editableInputId && isComposerBlocked) return;
    const selection = window.getSelection();
    let messageInput;
    if (inInputId === editableInputId) {
      messageInput = document.querySelector(editableInputCssSelector);
    } else {
      messageInput = document.getElementById(inInputId);
    }
    if (selection.rangeCount) {
      const selectionRange = selection.getRangeAt(0);
      if ((0,_middle_composer_helpers_selection__WEBPACK_IMPORTED_MODULE_31__.isSelectionInsideInput)(selectionRange, inInputId)) {
        (0,_util_selection__WEBPACK_IMPORTED_MODULE_23__.insertHtmlInSelection)(newHtml);
        messageInput.dispatchEvent(new Event('input', {
          bubbles: true
        }));
        return;
      }
    }
    setHtml(`${getHtml()}${newHtml}`);

    // If selection is outside of input, set cursor at the end of input
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestNextMutation)(() => {
      (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_19__["default"])(messageInput);
    });
  });
  const insertTextAndUpdateCursor = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((text, inInputId = editableInputId) => {
    const newHtml = (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_33__["default"])(text, ['escape_html', 'emoji_html', 'br_html']).join('').replace(/\u200b+/g, '\u200b');
    insertHtmlAndUpdateCursor(newHtml, inInputId);
  });
  const insertFormattedTextAndUpdateCursor = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((text, inInputId = editableInputId) => {
    const newHtml = (0,_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_34__.getTextWithEntitiesAsHtml)(text);
    insertHtmlAndUpdateCursor(newHtml, inInputId);
  });
  const insertCustomEmojiAndUpdateCursor = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((emoji, inInputId = editableInputId) => {
    insertHtmlAndUpdateCursor((0,_middle_composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_30__.buildCustomEmojiHtml)(emoji), inInputId);
  });
  const insertNextText = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    if (!nextText) return;
    insertFormattedTextAndUpdateCursor(nextText, editableInputId);
    setNextText(undefined);
  });
  const {
    shouldForceCompression,
    shouldForceAsFile,
    handleAppendFiles,
    handleFileSelect,
    onCaptionUpdate,
    handleClearAttachments,
    handleSetAttachments
  } = (0,_middle_composer_hooks_useAttachmentModal__WEBPACK_IMPORTED_MODULE_52__["default"])({
    attachments,
    setHtml,
    setAttachments,
    fileSizeLimit,
    chatId,
    canSendAudios,
    canSendVideos,
    canSendPhotos,
    canSendDocuments,
    insertNextText,
    editedMessage: editingMessage,
    shouldSendInHighQuality: attachmentSettings.shouldSendInHighQuality
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    // @ts-ignore
    globalThis.p__handleFileSelect = handleFileSelect;
    return () => {
      // @ts-ignore
      globalThis.p__handleFileSelect = undefined;
      // @ts-ignore
      delete globalThis.p__handleFileSelect;
    };
  }, [handleFileSelect]);
  const [isBotKeyboardOpen, openBotKeyboard, closeBotKeyboard] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__["default"])();
  const [isBotCommandMenuOpen, openBotCommandMenu, closeBotCommandMenu] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__["default"])();
  const [isSymbolMenuOpen, openSymbolMenu, closeSymbolMenu] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__["default"])();
  const [isSendAsMenuOpen, openSendAsMenu, closeSendAsMenu] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__["default"])();
  const [isHoverDisabled, disableHover, enableHover] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_40__["default"])();
  const {
    startRecordingVoice,
    stopRecordingVoice,
    pauseRecordingVoice,
    activeVoiceRecording,
    currentRecordTime,
    recordButtonRef: mainButtonRef,
    startRecordTimeRef,
    isViewOnceEnabled,
    setIsViewOnceEnabled,
    toogleViewOnceEnabled
  } = (0,_middle_composer_hooks_useVoiceRecording__WEBPACK_IMPORTED_MODULE_64__["default"])();
  const shouldSendRecordingStatus = isForCurrentMessageList && !isInStoryViewer;
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_35__["default"])(() => {
    sendMessageAction({
      type: 'recordAudio'
    });
  }, shouldSendRecordingStatus ? activeVoiceRecording && _config__WEBPACK_IMPORTED_MODULE_3__.SEND_MESSAGE_ACTION_INTERVAL : undefined);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isForCurrentMessageList || isInStoryViewer) return;
    if (!activeVoiceRecording) {
      sendMessageAction({
        type: 'cancel'
      });
    }
  }, [activeVoiceRecording, isForCurrentMessageList, isInStoryViewer, sendMessageAction]);
  const isEditingRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_50__.useStateRef)(Boolean(editingMessage));
  const updateInlineAILoading = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(value => {
    setIsInlineAILoading(value);
  });
  const updataAIResponse = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(text => {
    setIsInlineAILoading(false);
    setHtml(text);
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isForCurrentMessageList || isInStoryViewer) return;
    if (getHtml() && !isEditingRef.current) {
      sendMessageAction({
        type: 'typing'
      });
    }
  }, [getHtml, isEditingRef, isForCurrentMessageList, isInStoryViewer, sendMessageAction]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_66__["default"].on('update-input-text', updataAIResponse);
    _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_66__["default"].on('update-input-spiner', updateInlineAILoading);
    return () => {
      _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_66__["default"].off('update-input-text', updataAIResponse);
      _chatAssistant_lib_EventEmitter__WEBPACK_IMPORTED_MODULE_66__["default"].off('update-input-spiner', updateInlineAILoading);
    };
  }, []);
  const isAdmin = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatAdmin)(chat);
  const {
    isEmojiTooltipOpen,
    closeEmojiTooltip,
    filteredEmojis,
    filteredCustomEmojis,
    insertEmoji
  } = (0,_middle_composer_hooks_useEmojiTooltip__WEBPACK_IMPORTED_MODULE_58__["default"])(Boolean(isReady && isOnActiveTab && (isInStoryViewer || isForCurrentMessageList) && shouldSuggestStickers && !hasAttachments), getHtml, setHtml, undefined, recentEmojis, baseEmojiKeywords, emojiKeywords);
  const {
    isCustomEmojiTooltipOpen,
    closeCustomEmojiTooltip,
    insertCustomEmoji
  } = (0,_middle_composer_hooks_useCustomEmojiTooltip__WEBPACK_IMPORTED_MODULE_55__["default"])(Boolean(isReady && isOnActiveTab && (isInStoryViewer || isForCurrentMessageList) && shouldSuggestCustomEmoji && !hasAttachments), getHtml, setHtml, getSelectionRange, inputRef, customEmojiForEmoji);
  const {
    isStickerTooltipOpen,
    closeStickerTooltip
  } = (0,_middle_composer_hooks_useStickerTooltip__WEBPACK_IMPORTED_MODULE_63__["default"])(Boolean(isReady && isOnActiveTab && (isInStoryViewer || isForCurrentMessageList) && shouldSuggestStickers && canSendStickers && !hasAttachments), getHtml, stickersForEmoji);
  const {
    isMentionTooltipOpen,
    closeMentionTooltip,
    insertMention,
    insertMentionsBatch,
    mentionFilteredUsers
  } = (0,_middle_composer_hooks_useMentionTooltip__WEBPACK_IMPORTED_MODULE_61__["default"])(Boolean(isInMessageList && isReady && isForCurrentMessageList && !hasAttachments), getHtml, setHtml, getSelectionRange, inputRef, groupChatMembers, topInlineBotIds, currentUserId);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!insertingPeerIdMention) return;
    const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), insertingPeerIdMention);
    if (peer) {
      insertMention(peer, true, true);
    }
    updateInsertingPeerIdMention({
      peerId: undefined
    });
  }, [insertingPeerIdMention, insertMention]);
  const {
    isOpen: isInlineBotTooltipOpen,
    botId: inlineBotId,
    isGallery: isInlineBotTooltipGallery,
    switchPm: inlineBotSwitchPm,
    switchWebview: inlineBotSwitchWebview,
    results: inlineBotResults,
    closeTooltip: closeInlineBotTooltip,
    help: inlineBotHelp,
    loadMore: loadMoreForInlineBot
  } = (0,_middle_composer_hooks_useInlineBotTooltip__WEBPACK_IMPORTED_MODULE_59__["default"])(Boolean(isInMessageList && isReady && isForCurrentMessageList && !hasAttachments), chatId, getHtml, inlineBots);
  const hasQuickReplies = Boolean(quickReplies && Object.keys(quickReplies).length);
  const {
    isOpen: isChatCommandTooltipOpen,
    close: closeChatCommandTooltip,
    filteredBotCommands: botTooltipCommands,
    filteredQuickReplies: quickReplyCommands
  } = (0,_middle_composer_hooks_useChatCommandTooltip__WEBPACK_IMPORTED_MODULE_53__["default"])(Boolean(isInMessageList && isReady && isForCurrentMessageList && (botCommands && botCommands?.length || chatBotCommands?.length || hasQuickReplies && canSendQuickReplies)), getHtml, botCommands, chatBotCommands, canSendQuickReplies ? quickReplies : undefined);
  (0,_middle_composer_hooks_useDraft__WEBPACK_IMPORTED_MODULE_56__["default"])({
    draft,
    chatId,
    threadId,
    getHtml,
    setHtml,
    editedMessage: editingMessage,
    isDisabled: isInStoryViewer || Boolean(requestedDraft) || !hasSuggestedPost && isMonoforum
  });
  (0,_middle_composer_hooks_useLoadLinkPreview__WEBPACK_IMPORTED_MODULE_60__["default"])({
    chatId,
    threadId,
    getHtml
  });
  const resetComposer = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((shouldPreserveInput = false) => {
    if (!shouldPreserveInput) {
      setHtml('');
    }
    setAttachments(_util_memo__WEBPACK_IMPORTED_MODULE_21__.MEMO_EMPTY_ARRAY);
    setNextText(undefined);
    closeEmojiTooltip();
    closeCustomEmojiTooltip();
    closeStickerTooltip();
    closeMentionTooltip();
    if (isMobile) {
      // @optimization
      setTimeout(() => closeSymbolMenu(), SENDING_ANIMATION_DURATION);
    } else {
      closeSymbolMenu();
    }
  });
  const [handleEditComplete, handleEditCancel, shouldForceShowEditing] = (0,_middle_composer_hooks_useEditing__WEBPACK_IMPORTED_MODULE_57__["default"])(getHtml, setHtml, editingMessage, resetComposer, chatId, threadId, messageListType, draft, editingDraft);

  // Handle chat change (should be placed after `useDraft` and `useEditing`)
  const resetComposerRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_50__.useStateRef)(resetComposer);
  const stopRecordingVoiceRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_50__.useStateRef)(stopRecordingVoice);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return () => {
      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
      stopRecordingVoiceRef.current();
      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
      resetComposerRef.current();
    };
  }, [chatId, threadId, resetComposerRef, stopRecordingVoiceRef]);
  const areAllGiftsDisallowed = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!disallowedGifts) {
      return undefined;
    }
    return Object.values(disallowedGifts).every(Boolean);
  }, [disallowedGifts]);
  const shouldShowGiftButton = Boolean(!isChatWithSelf && shouldDisplayGiftsButton && !areAllGiftsDisallowed);
  const shouldShowSuggestedPostButton = isMonoforum && !editingMessage && !isForwarding && !isReplying && !draft?.suggestedPostInfo;
  const showCustomEmojiPremiumNotification = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    const notificationNumber = customEmojiNotificationNumber.current;
    if (!notificationNumber) {
      showNotification({
        message: oldLang('UnlockPremiumEmojiHint'),
        action: {
          action: 'openPremiumModal',
          payload: {
            initialSection: 'animated_emoji'
          }
        },
        actionText: oldLang('PremiumMore')
      });
    } else {
      showNotification({
        message: oldLang('UnlockPremiumEmojiHint2'),
        action: {
          action: 'openChat',
          payload: {
            id: currentUserId,
            shouldReplaceHistory: true
          }
        },
        actionText: oldLang('Open')
      });
    }
    customEmojiNotificationNumber.current = Number(!notificationNumber);
  });
  const mainButtonState = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_38__["default"])(() => {
    if (!isInputHasFocus && onForward && !(getHtml() && !hasAttachments)) {
      return MainButtonState.Forward;
    }
    if (editingMessage && shouldForceShowEditing) {
      return MainButtonState.Edit;
    }
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__.IS_VOICE_RECORDING_SUPPORTED && !activeVoiceRecording && !isForwarding && !(getHtml() && !hasAttachments)) {
      return MainButtonState.Record;
    }
    if (isInScheduledList) {
      return MainButtonState.Schedule;
    }
    return MainButtonState.Send;
  }, [activeVoiceRecording, editingMessage, getHtml, hasAttachments, isForwarding, isInputHasFocus, onForward, shouldForceShowEditing, isInScheduledList]);
  const canShowCustomSendMenu = !isInScheduledList;
  const {
    isContextMenuOpen: isCustomSendMenuOpen,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_37__["default"])(mainButtonRef, !(mainButtonState === MainButtonState.Send && canShowCustomSendMenu));
  const {
    contextMenuAnchor: storyReactionPickerAnchor,
    handleContextMenu: handleStoryPickerContextMenu,
    handleBeforeContextMenu: handleBeforeStoryPickerContextMenu,
    handleContextMenuHide: handleStoryPickerContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_37__["default"])(storyReactionRef, !isInStoryViewer);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isReactionPickerOpen) return;
    if (storyReactionPickerAnchor) {
      openStoryReactionPicker({
        peerId: chatId,
        storyId: storyId,
        position: storyReactionPickerAnchor
      });
      handleStoryPickerContextMenuHide();
    }
  }, [chatId, handleStoryPickerContextMenuHide, isReactionPickerOpen, storyId, storyReactionPickerAnchor]);
  (0,_middle_composer_hooks_useClipboardPaste__WEBPACK_IMPORTED_MODULE_54__["default"])(isForCurrentMessageList || isInStoryViewer, insertFormattedTextAndUpdateCursor, handleSetAttachments, setNextText, editingMessage, !isCurrentUserPremium && !isChatWithSelf, showCustomEmojiPremiumNotification);
  const handleEmbeddedClear = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    if (editingMessage) {
      handleEditCancel();
    }
  });
  const validateTextLength = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((text, isAttachmentModal) => {
    const maxLength = isAttachmentModal ? captionLimit : maxMessageLength;
    if (text?.length > maxLength) {
      const extraLength = text.length - maxLength;
      showDialog({
        data: {
          message: 'MESSAGE_TOO_LONG_PLEASE_REMOVE_CHARACTERS',
          textParams: {
            '{EXTRA_CHARS_COUNT}': extraLength.toString(),
            '{PLURAL_S}': extraLength > 1 ? 's' : ''
          },
          hasErrorKey: true
        }
      });
      return false;
    }
    return true;
  });
  const checkSlowMode = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    if (slowMode && !isAdmin) {
      const messageInput = document.querySelector(editableInputCssSelector);
      const nowSeconds = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_24__.getServerTime)();
      const secondsSinceLastMessage = lastMessageSendTimeSeconds.current && Math.floor(nowSeconds - lastMessageSendTimeSeconds.current);
      const nextSendDateNotReached = slowMode.nextSendDate && slowMode.nextSendDate > nowSeconds;
      if (secondsSinceLastMessage && secondsSinceLastMessage < slowMode.seconds || nextSendDateNotReached) {
        const secondsRemaining = nextSendDateNotReached ? slowMode.nextSendDate - nowSeconds : slowMode.seconds - secondsSinceLastMessage;
        showDialog({
          data: {
            message: oldLang('SlowModeHint', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_13__.formatMediaDuration)(secondsRemaining)),
            isSlowMode: true,
            hasErrorKey: false
          }
        });
        messageInput?.blur();
        return false;
      }
    }
    return true;
  });
  const canSendAttachments = attachmentsToSend => {
    if (!currentMessageList && !storyId) {
      return false;
    }
    const {
      text
    } = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_22__["default"])(getHtml());
    if (!text && !attachmentsToSend.length) {
      return false;
    }
    if (!validateTextLength(text, true)) return false;
    if (!checkSlowMode()) return false;
    return true;
  };
  const sendAttachments = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(({
    attachments: attachmentsToSend,
    sendCompressed = attachmentSettings.shouldCompress,
    sendGrouped = attachmentSettings.shouldSendGrouped,
    isSilent,
    scheduledAt,
    isInvertedMedia
  }) => {
    if (!currentMessageList && !storyId) {
      return;
    }
    isSilent = isSilent || isSilentPosting;
    const {
      text,
      entities
    } = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_22__["default"])(getHtml());
    isInvertedMedia = text && sendCompressed && sendGrouped ? isInvertedMedia : undefined;
    if (editingMessage) {
      editMessage({
        messageList: currentMessageList,
        text,
        entities,
        attachments: (0,_middle_composer_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_29__.prepareAttachmentsToSend)(attachmentsToSend, sendCompressed)
      });
    } else {
      sendMessage({
        messageList: currentMessageList,
        text,
        entities,
        scheduledAt,
        isSilent,
        shouldUpdateStickerSetOrder,
        attachments: (0,_middle_composer_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_29__.prepareAttachmentsToSend)(attachmentsToSend, sendCompressed),
        shouldGroupMessages: sendGrouped,
        isInvertedMedia
      });
    }
    lastMessageSendTimeSeconds.current = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_24__.getServerTime)();
    clearDraft({
      chatId,
      isLocalOnly: true
    });

    // Wait until message animation starts
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
      resetComposer();
    });
  });
  const handleSendAttachmentsFromModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((sendCompressed, sendGrouped, isInvertedMedia) => {
    if (canSendAttachments(attachments)) {
      if (editingMessage) {
        sendAttachments({
          attachments,
          sendCompressed,
          sendGrouped,
          isInvertedMedia
        });
        return;
      }
      handleActionWithPaymentConfirmation(sendAttachments, {
        attachments,
        sendCompressed,
        sendGrouped,
        isInvertedMedia
      });
    }
  });
  const handleSendAttachments = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((sendCompressed, sendGrouped, isSilent, scheduledAt, isInvertedMedia) => {
    if (canSendAttachments(attachments)) {
      sendAttachments({
        attachments,
        sendCompressed,
        sendGrouped,
        isSilent,
        scheduledAt,
        isInvertedMedia
      });
    }
  });
  const handleSendCore = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((currentAttachments, isSilent = false, scheduledAt) => {
    const {
      text,
      entities
    } = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_22__["default"])(getHtml());
    if (currentAttachments.length) {
      if (canSendAttachments(currentAttachments)) {
        sendAttachments({
          attachments: currentAttachments,
          scheduledAt,
          isSilent
        });
      }
      return;
    }
    if (!text && !isForwarding) {
      return;
    }
    if (!validateTextLength(text)) return;
    const messageInput = document.querySelector(editableInputCssSelector);
    const effectId = effect?.id;
    if (text || isForwarding) {
      if (!checkSlowMode()) return;
      const isInvertedMedia = hasWebPagePreview ? attachmentSettings.isInvertedMedia : undefined;
      if (areEffectsSupported) saveEffectInDraft({
        chatId,
        threadId,
        effectId: undefined
      });
      sendMessage({
        messageList: currentMessageList,
        text,
        entities,
        scheduledAt,
        isSilent,
        shouldUpdateStickerSetOrder,
        isInvertedMedia,
        effectId,
        webPageMediaSize: attachmentSettings.webPageMediaSize,
        webPageUrl: hasWebPagePreview ? webPagePreview.url : undefined,
        isForwarding
      });
    }
    lastMessageSendTimeSeconds.current = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_24__.getServerTime)();
    clearDraft({
      chatId,
      threadId,
      isLocalOnly: true,
      shouldKeepReply: isForwarding
    });
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__.IS_IOS && messageInput && messageInput === document.activeElement) {
      (0,_middle_composer_helpers_applyIosAutoCapitalizationFix__WEBPACK_IMPORTED_MODULE_28__["default"])(messageInput);
    }

    // Wait until message animation starts
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
      resetComposer();
    });
  });
  const handleSend = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(async (isSilent = false, scheduledAt) => {
    if (!currentMessageList && !storyId) {
      return;
    }
    isSilent = isSilent || isSilentPosting;
    let currentAttachments = attachments;
    if (activeVoiceRecording) {
      const record = await stopRecordingVoice();
      const ttlSeconds = isViewOnceEnabled ? _config__WEBPACK_IMPORTED_MODULE_3__.ONE_TIME_MEDIA_TTL_SECONDS : undefined;
      if (record) {
        const {
          blob,
          duration,
          waveform
        } = record;
        currentAttachments = [await (0,_middle_composer_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_29__["default"])(VOICE_RECORDING_FILENAME, blob, {
          voice: {
            duration,
            waveform
          },
          ttlSeconds
        })];
      }
    }
    // TODO:translate text
    const {
      text
    } = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_22__["default"])(getHtml());
    handleSendCore(currentAttachments, isSilent, scheduledAt);
    // TODO: collect information from send message
    _chatAssistant_utils_user_information_collection__WEBPACK_IMPORTED_MODULE_27__.userInformationCollection.collectInformation(text);
  });
  const handleSendWithConfirmation = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((isSilent = false, scheduledAt) => {
    handleActionWithPaymentConfirmation(handleSend, isSilent, scheduledAt);
  });
  const handleTodoListCreate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    if (!isCurrentUserPremium) {
      showNotification({
        message: lang('SubscribeToTelegramPremiumForCreateToDo'),
        action: {
          action: 'openPremiumModal',
          payload: {
            initialSection: 'todo'
          }
        },
        actionText: lang('PremiumMore')
      });
      return;
    }
    openTodoListModal({
      chatId
    });
  });
  const handleClickBotMenu = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    if (botMenuButton?.type !== 'webApp') {
      return;
    }
    const parsedLink = (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_15__.tryParseDeepLink)(botMenuButton.url);
    if (parsedLink?.type === 'publicUsernameOrBotLink' && parsedLink.appName) {
      (0,_util_deeplink__WEBPACK_IMPORTED_MODULE_14__.processDeepLink)(botMenuButton.url);
    } else {
      callAttachBot({
        chatId,
        url: botMenuButton.url,
        threadId
      });
    }
  });
  const handleActivateBotCommandMenu = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    closeSymbolMenu();
    openBotCommandMenu();
  });
  const handleMessageSchedule = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((args, scheduledAt, messageList, effectId) => {
    if (args && 'queryId' in args) {
      const {
        id,
        queryId,
        isSilent
      } = args;
      sendInlineBotResult({
        id,
        chatId,
        threadId,
        queryId,
        scheduledAt,
        isSilent: isSilent || isSilentPosting
      });
      return;
    }
    const {
      isSilent,
      ...restArgs
    } = args || {};
    if (!args || Object.keys(restArgs).length === 0) {
      void handleSend(Boolean(isSilent), scheduledAt);
    } else if (args.sendCompressed !== undefined || args.sendGrouped !== undefined) {
      const {
        sendCompressed = false,
        sendGrouped = false,
        isInvertedMedia
      } = args;
      void handleSendAttachments(sendCompressed, sendGrouped, isSilent, scheduledAt, isInvertedMedia);
    } else {
      sendMessage({
        ...args,
        messageList,
        scheduledAt,
        effectId
      });
    }
  });
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_39__["default"])(([prevContentToBeScheduled]) => {
    if (currentMessageList && contentToBeScheduled && contentToBeScheduled !== prevContentToBeScheduled) {
      requestCalendar(scheduledAt => {
        handleMessageSchedule(contentToBeScheduled, scheduledAt, currentMessageList);
      });
    }
  }, [contentToBeScheduled, currentMessageList, handleMessageSchedule, requestCalendar]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (requestedDraft) {
      insertFormattedTextAndUpdateCursor(requestedDraft);
      resetOpenChatWithDraft();
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestNextMutation)(() => {
        const messageInput = document.getElementById(editableInputId);
        (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_19__["default"])(messageInput, true);
      });
    }
  }, [editableInputId, requestedDraft, resetOpenChatWithDraft, setHtml]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (requestedDraftFiles?.length) {
      void handleFileSelect(requestedDraftFiles);
      resetOpenChatWithDraft();
    }
  }, [handleFileSelect, requestedDraftFiles, resetOpenChatWithDraft]);
  const handleCustomEmojiSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((emoji, inInputId) => {
    const emojiSetId = 'id' in emoji.stickerSetInfo && emoji.stickerSetInfo.id;
    if (!emoji.isFree && !isCurrentUserPremium && !isChatWithSelf && emojiSetId !== chatEmojiSetId) {
      showCustomEmojiPremiumNotification();
      return;
    }
    insertCustomEmojiAndUpdateCursor(emoji, inInputId);
  });
  const handleCustomEmojiSelectAttachmentModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(emoji => {
    handleCustomEmojiSelect(emoji, _config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_MODAL_ID);
  });
  const handleGifSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((gif, isSilent, isScheduleRequested) => {
    if (!currentMessageList && !storyId) {
      return;
    }
    isSilent = isSilent || isSilentPosting;
    if (isInScheduledList || isScheduleRequested) {
      forceShowSymbolMenu();
      requestCalendar(scheduledAt => {
        cancelForceShowSymbolMenu();
        handleActionWithPaymentConfirmation(handleMessageSchedule, {
          gif,
          isSilent
        }, scheduledAt, currentMessageList);
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
          resetComposer(true);
        });
      });
    } else {
      handleActionWithPaymentConfirmation(sendMessage, {
        messageList: currentMessageList,
        gif,
        isSilent
      });
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
        resetComposer(true);
      });
    }
  });
  const handleStickerSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((sticker, isSilent, isScheduleRequested, shouldPreserveInput = false, canUpdateStickerSetsOrder) => {
    if (!currentMessageList && !storyId) {
      return;
    }
    isSilent = isSilent || isSilentPosting;
    sticker = {
      ...sticker,
      isPreloadedGlobally: true
    };
    if (isInScheduledList || isScheduleRequested) {
      forceShowSymbolMenu();
      requestCalendar(scheduledAt => {
        cancelForceShowSymbolMenu();
        handleActionWithPaymentConfirmation(handleMessageSchedule, {
          sticker,
          isSilent
        }, scheduledAt, currentMessageList);
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
          resetComposer(shouldPreserveInput);
        });
      });
    } else {
      handleActionWithPaymentConfirmation(sendMessage, {
        messageList: currentMessageList,
        sticker,
        isSilent,
        shouldUpdateStickerSetOrder: shouldUpdateStickerSetOrder && canUpdateStickerSetsOrder
      });
      clearDraft({
        chatId,
        threadId,
        isLocalOnly: true
      });
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
        resetComposer(shouldPreserveInput);
      });
    }
  });
  const handleInlineBotSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((inlineResult, isSilent, isScheduleRequested) => {
    if (!currentMessageList && !storyId) {
      return;
    }
    isSilent = isSilent || isSilentPosting;
    if (isInScheduledList || isScheduleRequested) {
      requestCalendar(scheduledAt => {
        handleActionWithPaymentConfirmation(handleMessageSchedule, {
          id: inlineResult.id,
          queryId: inlineResult.queryId,
          isSilent
        }, scheduledAt, currentMessageList);
      });
    } else {
      handleActionWithPaymentConfirmation(sendInlineBotResult, {
        id: inlineResult.id,
        queryId: inlineResult.queryId,
        threadId,
        chatId,
        isSilent
      });
    }
    const messageInput = document.querySelector(editableInputCssSelector);
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__.IS_IOS && messageInput && messageInput === document.activeElement) {
      (0,_middle_composer_helpers_applyIosAutoCapitalizationFix__WEBPACK_IMPORTED_MODULE_28__["default"])(messageInput);
    }
    clearDraft({
      chatId,
      isLocalOnly: true
    });
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
      resetComposer();
    });
  });
  const handleBotCommandSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    clearDraft({
      chatId,
      isLocalOnly: true
    });
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
      resetComposer();
    });
  });
  const handlePollSend = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(poll => {
    if (!currentMessageList) {
      return;
    }
    if (isInScheduledList) {
      requestCalendar(scheduledAt => {
        handleActionWithPaymentConfirmation(handleMessageSchedule, {
          poll
        }, scheduledAt, currentMessageList);
      });
      closePollModal();
    } else {
      handleActionWithPaymentConfirmation(sendMessage, {
        messageList: currentMessageList,
        poll,
        isSilent: isSilentPosting
      });
      closePollModal();
    }
  });
  const handleToDoListSend = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(todo => {
    if (!currentMessageList) {
      return;
    }
    if (isInScheduledList) {
      requestCalendar(scheduledAt => {
        handleActionWithPaymentConfirmation(handleMessageSchedule, {
          todo
        }, scheduledAt, currentMessageList);
      });
    } else {
      handleActionWithPaymentConfirmation(sendMessage, {
        messageList: currentMessageList,
        todo,
        isSilent: isSilentPosting
      });
    }
  });
  const sendSilent = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(additionalArgs => {
    if (isInScheduledList) {
      requestCalendar(scheduledAt => {
        handleMessageSchedule({
          ...additionalArgs,
          isSilent: true
        }, scheduledAt, currentMessageList);
      });
    } else if (additionalArgs && ('sendCompressed' in additionalArgs || 'sendGrouped' in additionalArgs)) {
      const {
        sendCompressed = false,
        sendGrouped = false,
        isInvertedMedia
      } = additionalArgs;
      void handleSendAttachments(sendCompressed, sendGrouped, true, undefined, isInvertedMedia);
    } else {
      void handleSend(true);
    }
  });
  const handleSendAsMenuOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    const messageInput = document.querySelector(editableInputCssSelector);
    if (!isMobile || messageInput !== document.activeElement) {
      closeBotCommandMenu();
      closeSymbolMenu();
      openSendAsMenu();
      return;
    }
    messageInput?.blur();
    setTimeout(() => {
      closeBotCommandMenu();
      closeSymbolMenu();
      openSendAsMenu();
    }, MOBILE_KEYBOARD_HIDE_DELAY_MS);
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isComposerBlocked) return;
    setHtml('');
  }, [isComposerBlocked, setHtml, attachments]);
  const insertTextAndUpdateCursorAttachmentModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(text => {
    insertTextAndUpdateCursor(text, _config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_MODAL_ID);
  });
  const removeSymbol = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((inInputId = editableInputId) => {
    const selection = window.getSelection();
    if (selection.rangeCount) {
      const selectionRange = selection.getRangeAt(0);
      if ((0,_middle_composer_helpers_selection__WEBPACK_IMPORTED_MODULE_31__.isSelectionInsideInput)(selectionRange, inInputId)) {
        document.execCommand('delete', false);
        return;
      }
    }
    setHtml((0,_util_deleteLastCharacterOutsideSelection__WEBPACK_IMPORTED_MODULE_16__["default"])(getHtml()));
  });
  const removeSymbolAttachmentModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    removeSymbol(_config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_MODAL_ID);
  });
  const handleAllScheduledClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    openThread({
      chatId,
      threadId,
      type: 'scheduled',
      noForumTopicPanel: true
    });
  });
  const handleGiftClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    openGiftModal({
      forUserId: chatId
    });
  });
  const handleSuggestPostClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    updateDraftSuggestedPostInfo({
      price: {
        currency: _config__WEBPACK_IMPORTED_MODULE_3__.STARS_CURRENCY_CODE,
        amount: 0,
        nanos: 0
      }
    });
  });
  const handleToggleSilentPosting = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    const newValue = !isSilentPosting;
    updateChatSilentPosting({
      chatId,
      isEnabled: newValue
    });
    showNotification({
      localId: 'silentPosting',
      icon: newValue ? 'mute' : 'unmute',
      message: lang(`ComposerSilentPosting${newValue ? 'Enabled' : 'Disabled'}Tootlip`)
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isRightColumnShown && isMobile) {
      closeSymbolMenu();
    }
  }, [isRightColumnShown, closeSymbolMenu, isMobile]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isReady) return;
    if (isSelectModeActive) {
      disableHover();
    } else {
      setTimeout(() => {
        enableHover();
      }, SELECT_MODE_TRANSITION_MS);
    }
  }, [isSelectModeActive, enableHover, disableHover, isReady]);
  const hasText = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_38__["default"])(() => Boolean(getHtml()), [getHtml]);
  const withBotMenuButton = isChatWithBot && botMenuButton?.type === 'webApp' && !editingMessage && messageListType === 'thread';
  const isBotMenuButtonOpen = withBotMenuButton && !hasText && !activeVoiceRecording;
  const [timedPlaceholderLangKey, timedPlaceholderDate] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (slowMode?.nextSendDate) {
      return ['SlowModeWait', slowMode.nextSendDate];
    }
    if (stealthMode?.activeUntil && isInStoryViewer) {
      return ['StealthModeActiveHint', stealthMode.activeUntil];
    }
    return [];
  }, [isInStoryViewer, slowMode?.nextSendDate, stealthMode?.activeUntil]);
  const isComposerHasFocus = isBotKeyboardOpen || isSymbolMenuOpen || isEmojiTooltipOpen || isSendAsMenuOpen || isMentionTooltipOpen || isInlineBotTooltipOpen || isBotCommandMenuOpen || isAttachMenuOpen || isStickerTooltipOpen || isChatCommandTooltipOpen || isCustomEmojiTooltipOpen || isBotMenuButtonOpen || isCustomSendMenuOpen || Boolean(activeVoiceRecording) || attachments.length > 0 || isInputHasFocus;
  const isReactionSelectorOpen = isComposerHasFocus && !isReactionPickerOpen && isInStoryViewer && !isAttachMenuOpen && !isSymbolMenuOpen;
  const placeholder = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (activeVoiceRecording && windowWidth <= SCREEN_WIDTH_TO_HIDE_PLACEHOLDER) {
      return '';
    }
    if (!isComposerBlocked) {
      if (botKeyboardPlaceholder) return botKeyboardPlaceholder;
      if (inputPlaceholder) return inputPlaceholder;
      if (paidMessagesStars) {
        return lang('ComposerPlaceholderPaidMessage', {
          amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_20__.formatStarsAsIcon)(lang, paidMessagesStars, {
            asFont: true,
            className: 'placeholder-star-icon'
          })
        }, {
          withNodes: true
        });
      }
      if (isReplying && hasSuggestedPost) {
        return lang('ComposerPlaceholderCaption');
      }
      if (chat?.adminRights?.anonymous) {
        return lang('ComposerPlaceholderAnonymous');
      }
      if (chat?.isForum && chat?.isForumAsMessages && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID) {
        return replyToTopic ? lang('ComposerPlaceholderTopic', {
          topic: replyToTopic.title
        }) : lang('ComposerPlaceholderTopicGeneral');
      }
      if (isChannel) {
        return lang(isSilentPosting ? 'ComposerPlaceholderBroadcastSilent' : 'ComposerPlaceholderBroadcast');
      }
      return lang('ComposerPlaceholder');
    }
    if (isInStoryViewer) return lang('ComposerStoryPlaceholderLocked');
    return lang('ComposerPlaceholderNoText');
  }, [activeVoiceRecording, botKeyboardPlaceholder, chat, inputPlaceholder, isChannel, isComposerBlocked, isInStoryViewer, isSilentPosting, lang, replyToTopic, isReplying, threadId, windowWidth, paidMessagesStars, hasSuggestedPost]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isComposerHasFocus) {
      onFocus?.();
    } else {
      onBlur?.();
    }
  }, [isComposerHasFocus, onBlur, onFocus]);
  const {
    shouldRender: shouldRenderReactionSelector,
    transitionClassNames: reactionSelectorTransitonClassNames
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_49__["default"])(isReactionSelectorOpen);
  const areVoiceMessagesNotAllowed = mainButtonState === MainButtonState.Record && (!canAttachMedia || !canSendVoiceByPrivacy || !canSendVoices);
  const areAutoTranslate = inputTranslateOptions?.autoTranslate && mainButtonState === MainButtonState.Send;
  const mainButtonHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    switch (mainButtonState) {
      case MainButtonState.Forward:
        onForward?.();
        break;
      case MainButtonState.Send:
        if (areAutoTranslate && hasText) return;
        handleSendWithConfirmation();
        break;
      case MainButtonState.Record:
        {
          if (areVoiceMessagesNotAllowed) {
            if (!canSendVoiceByPrivacy) {
              showNotification({
                message: oldLang('VoiceMessagesRestrictedByPrivacy', chat?.title)
              });
            } else if (!canSendVoices) {
              showAllowedMessageTypesNotification({
                chatId,
                messageListType
              });
            }
          } else {
            setIsViewOnceEnabled(false);
            void startRecordingVoice();
          }
          break;
        }
      case MainButtonState.Edit:
        handleEditComplete();
        break;
      case MainButtonState.Schedule:
        if (activeVoiceRecording) {
          pauseRecordingVoice();
        }
        if (!currentMessageList) {
          return;
        }
        requestCalendar(scheduledAt => {
          handleMessageSchedule({}, scheduledAt, currentMessageList, effect?.id);
        });
        break;
      default:
        break;
    }
  });
  const scheduledDefaultDate = new Date();
  scheduledDefaultDate.setSeconds(0);
  scheduledDefaultDate.setMilliseconds(0);
  const scheduledMaxDate = new Date();
  scheduledMaxDate.setFullYear(scheduledMaxDate.getFullYear() + 1);
  let sendButtonAriaLabel = 'SendMessage';
  switch (mainButtonState) {
    case MainButtonState.Forward:
      sendButtonAriaLabel = 'Forward';
      break;
    case MainButtonState.Edit:
      sendButtonAriaLabel = 'Save edited message';
      break;
    case MainButtonState.Record:
      sendButtonAriaLabel = !canAttachMedia ? 'Conversation.DefaultRestrictedMedia' : 'AccDescrVoiceMessage';
  }
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('Composer', !isSelectModeActive && 'shown', isHoverDisabled && 'hover-disabled', isMounted && 'mounted', className);
  const handleToggleReaction = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(reaction => {
    let text;
    let entities;
    if (reaction.type === 'emoji') {
      text = reaction.emoticon;
    }
    if (reaction.type === 'custom') {
      const sticker = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().customEmojis.byId[reaction.documentId];
      if (!sticker) {
        return;
      }
      if (!sticker.isFree && !isCurrentUserPremium && !isChatWithSelf) {
        showCustomEmojiPremiumNotification();
        return;
      }
      const customEmojiMessage = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_22__["default"])((0,_middle_composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_30__.buildCustomEmojiHtml)(sticker));
      text = customEmojiMessage.text;
      entities = customEmojiMessage.entities;
    }
    handleActionWithPaymentConfirmation(sendMessage, {
      text,
      entities,
      isReaction: true
    });
    closeReactionPicker();
  });
  const handleToggleEffectReaction = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(reaction => {
    setReactionEffect({
      chatId,
      threadId,
      reaction
    });
    closeReactionPicker();
  });
  const handleReactionPickerOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(position => {
    openStoryReactionPicker({
      peerId: chatId,
      storyId: storyId,
      position,
      sendAsMessage: true
    });
  });
  const handleLikeStory = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    const reaction = sentStoryReaction ? undefined : _config__WEBPACK_IMPORTED_MODULE_3__.HEART_REACTION;
    sendStoryReaction({
      peerId: chatId,
      storyId: storyId,
      containerId: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getStoryKey)(chatId, storyId),
      reaction
    });
  });
  const handleSendScheduled = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    requestCalendar(scheduledAt => {
      handleMessageSchedule({}, scheduledAt, currentMessageList);
    });
  });
  const handleSendSilent = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    handleActionWithPaymentConfirmation(sendSilent);
  });
  const handleSendWhenOnline = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    handleActionWithPaymentConfirmation(handleMessageSchedule, {}, _config__WEBPACK_IMPORTED_MODULE_3__.SCHEDULED_WHEN_ONLINE, currentMessageList, effect?.id);
  });
  const handleSendScheduledAttachments = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((sendCompressed, sendGrouped, isInvertedMedia) => {
    requestCalendar(scheduledAt => {
      handleActionWithPaymentConfirmation(handleMessageSchedule, {
        sendCompressed,
        sendGrouped,
        isInvertedMedia
      }, scheduledAt, currentMessageList);
    });
  });
  const handleSendSilentAttachments = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])((sendCompressed, sendGrouped, isInvertedMedia) => {
    handleActionWithPaymentConfirmation(sendSilent, {
      sendCompressed,
      sendGrouped,
      isInvertedMedia
    });
  });
  const handleRemoveEffect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    saveEffectInDraft({
      chatId,
      threadId,
      effectId: undefined
    });
  });
  const handleStopEffect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_43__["default"])(() => {
    hideEffectInComposer({});
  });
  const onSend = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    switch (mainButtonState) {
      case MainButtonState.Edit:
        return handleEditComplete;
      case MainButtonState.Schedule:
        return handleSendScheduled;
      default:
        return handleSendWithConfirmation;
    }
  }, [mainButtonState, handleEditComplete, handleSendWithConfirmation]);
  const withBotCommands = isChatWithBot && botMenuButton?.type === 'commands' && !editingMessage && botCommands !== false && !activeVoiceRecording;
  const effectEmoji = areEffectsSupported && effect?.emoticon;
  const shouldRenderPaidBadge = Boolean(paidMessagesStars && mainButtonState === MainButtonState.Send);
  const prevShouldRenderPaidBadge = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_45__["default"])(shouldRenderPaidBadge);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: fullClassName
  }, isInMessageList && canAttachMedia && isReady && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_DropArea_async__WEBPACK_IMPORTED_MODULE_76__["default"], {
    isOpen: dropAreaState !== _middle_composer_DropArea_async__WEBPACK_IMPORTED_MODULE_76__.DropAreaState.None,
    withQuick: dropAreaState === _middle_composer_DropArea_async__WEBPACK_IMPORTED_MODULE_76__.DropAreaState.QuickFile || prevDropAreaState === _middle_composer_DropArea_async__WEBPACK_IMPORTED_MODULE_76__.DropAreaState.QuickFile,
    onHide: onDropHide,
    onFileSelect: handleFileSelect,
    editingMessage: editingMessage
  }), shouldRenderReactionSelector && !isNeedPremium && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_message_reactions_ReactionSelector__WEBPACK_IMPORTED_MODULE_88__["default"], {
    topReactions: topReactions,
    allAvailableReactions: availableReactions,
    onToggleReaction: handleToggleReaction,
    isPrivate: true,
    isReady: isReady,
    canBuyPremium: canBuyPremium,
    isCurrentUserPremium: isCurrentUserPremium,
    isInSavedMessages: isChatWithSelf,
    isInStoryViewer: isInStoryViewer,
    canPlayAnimatedEmojis: canPlayAnimatedEmojis,
    onShowMore: handleReactionPickerOpen,
    className: reactionSelectorTransitonClassNames
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_AttachmentModal_async__WEBPACK_IMPORTED_MODULE_67__["default"], {
    chatId: chatId,
    threadId: threadId,
    canShowCustomSendMenu: canShowCustomSendMenu,
    attachments: attachments,
    getHtml: getHtml,
    isReady: isReady,
    shouldForceCompression: shouldForceCompression,
    shouldForceAsFile: shouldForceAsFile,
    isForCurrentMessageList: isForCurrentMessageList,
    isForMessage: isInMessageList,
    shouldSchedule: canSchedule && isInScheduledList,
    canSchedule: canSchedule,
    forceDarkTheme: isInStoryViewer,
    onCaptionUpdate: onCaptionUpdate,
    onSendSilent: handleSendSilentAttachments,
    onSend: handleSendAttachmentsFromModal,
    onSendScheduled: handleSendScheduledAttachments,
    onFileAppend: handleAppendFiles,
    onClear: handleClearAttachments,
    onAttachmentsUpdate: handleSetAttachments,
    onCustomEmojiSelect: handleCustomEmojiSelectAttachmentModal,
    onRemoveSymbol: removeSymbolAttachmentModal,
    onEmojiSelect: insertTextAndUpdateCursorAttachmentModal,
    editingMessage: editingMessage,
    onSendWhenOnline: handleSendWhenOnline,
    canScheduleUntilOnline: canScheduleUntilOnline && !isViewOnceEnabled,
    paidMessagesStars: paidMessagesStars
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_PollModal_async__WEBPACK_IMPORTED_MODULE_81__["default"], {
    isOpen: pollModal.isOpen,
    isQuiz: pollModal.isQuiz,
    shouldBeAnonymous: isChannel,
    maxOptionsCount: pollMaxAnswers,
    onClear: closePollModal,
    onSend: handlePollSend
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_ToDoListModal_async__WEBPACK_IMPORTED_MODULE_85__["default"], {
    modal: todoListModal,
    onClear: closeTodoListModal,
    onSend: handleToDoListSend
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_SendAsMenu_async__WEBPACK_IMPORTED_MODULE_82__["default"], {
    isOpen: isSendAsMenuOpen,
    onClose: closeSendAsMenu,
    chatId: chatId,
    selectedSendAsId: sendAsId,
    sendAsPeerIds: sendAsPeerIds,
    isCurrentUserPremium: isCurrentUserPremium
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_MentionTooltip_async__WEBPACK_IMPORTED_MODULE_79__["default"], {
    isOpen: isMentionTooltipOpen,
    filteredUsers: mentionFilteredUsers,
    onInsertUserName: insertMention,
    onInsertUsersAll: insertMentionsBatch,
    onClose: closeMentionTooltip
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_ChatCommandTooltip_async__WEBPACK_IMPORTED_MODULE_72__["default"], {
    isOpen: isChatCommandTooltipOpen,
    chatId: chatId,
    withUsername: Boolean(chatBotCommands),
    botCommands: botTooltipCommands,
    quickReplies: quickReplyCommands,
    getHtml: getHtml,
    self: currentUser,
    quickReplyMessages: quickReplyMessages,
    onClick: handleBotCommandSelect,
    onClose: closeChatCommandTooltip
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('composer-wrapper', isInStoryViewer && 'with-story-tweaks', isNeedPremium && 'is-need-premium')
  }, !isNeedPremium && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    className: "svg-appendix",
    width: "9",
    height: "20"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("defs", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("filter", {
    x: "-50%",
    y: "-14.7%",
    width: "200%",
    height: "141.2%",
    filterUnits: "objectBoundingBox",
    id: "composerAppendix"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feOffset", {
    dy: "1",
    in: "SourceAlpha",
    result: "shadowOffsetOuter1"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feGaussianBlur", {
    stdDeviation: "1",
    in: "shadowOffsetOuter1",
    result: "shadowBlurOuter1"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feColorMatrix", {
    values: "0 0 0 0 0.0621962482 0 0 0 0 0.138574144 0 0 0 0 0.185037364 0 0 0 0.15 0",
    in: "shadowBlurOuter1"
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("g", {
    fill: "none",
    "fill-rule": "evenodd"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 016 17z",
    fill: "#000",
    filter: "url(#composerAppendix)"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 016 17z",
    fill: "#FFF",
    className: "corner"
  }))), inputTranslateOptions?.autoTranslate && hasText && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_ComposerTranslatededMessage__WEBPACK_IMPORTED_MODULE_99__["default"], {
    chatId: chatId,
    getHtml: getHtml,
    onUpdate: setHtml,
    onSend: onSend
  }), isInMessageList && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_InlineBotTooltip_async__WEBPACK_IMPORTED_MODULE_78__["default"], {
    isOpen: isInlineBotTooltipOpen,
    botId: inlineBotId,
    isGallery: isInlineBotTooltipGallery,
    inlineBotResults: inlineBotResults,
    switchPm: inlineBotSwitchPm,
    switchWebview: inlineBotSwitchWebview,
    loadMore: loadMoreForInlineBot,
    isSavedMessages: isChatWithSelf,
    canSendGifs: canSendGifs,
    isCurrentUserPremium: isCurrentUserPremium,
    onSelectResult: handleInlineBotSelect,
    onClose: closeInlineBotTooltip
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_ComposerEmbeddedMessage__WEBPACK_IMPORTED_MODULE_73__["default"], {
    onClear: handleEmbeddedClear,
    shouldForceShowEditing: Boolean(shouldForceShowEditing && editingMessage),
    chatId: chatId,
    threadId: threadId,
    messageListType: messageListType
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_WebPagePreview__WEBPACK_IMPORTED_MODULE_86__["default"], {
    chatId: chatId,
    threadId: threadId,
    isDisabled: !canAttachEmbedLinks || hasAttachments || !hasText,
    isEditing: Boolean(editingMessage)
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('message-input-wrapper', (0,_helpers_peerColor__WEBPACK_IMPORTED_MODULE_32__.getPeerColorClass)(currentUser))
  }, isInMessageList && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, withBotMenuButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_BotMenuButton__WEBPACK_IMPORTED_MODULE_71__["default"], {
    isOpen: isBotMenuButtonOpen,
    text: botMenuButton.text,
    isDisabled: Boolean(activeVoiceRecording),
    onClick: handleClickBotMenu
  }), withBotCommands && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_90__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('bot-commands', 'composer-action-button'),
    round: true,
    disabled: botCommands === undefined,
    color: "translucent",
    onActivate: handleActivateBotCommandMenu,
    ariaLabel: "Open bot command keyboard"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "bot-commands-filled"
  })), canShowSendAs && sendAsPeer && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    round: true,
    color: "translucent",
    onClick: isSendAsMenuOpen ? closeSendAsMenu : handleSendAsMenuOpen,
    ariaLabel: oldLang('SendMessageAsTitle'),
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('send-as-button', 'composer-action-button', shouldAnimateSendAsButtonRef.current && 'appear-animation')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Avatar__WEBPACK_IMPORTED_MODULE_94__["default"], {
    peer: sendAsPeer,
    size: "tiny"
  }))), (!isComposerBlocked || canSendGifs || canSendStickers) && !isNeedPremium && !isAccountFrozen && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_SymbolMenuButton__WEBPACK_IMPORTED_MODULE_84__["default"], {
    chatId: chatId,
    threadId: threadId,
    isMobile: isMobile,
    isReady: isReady,
    isSymbolMenuOpen: isSymbolMenuOpen,
    openSymbolMenu: openSymbolMenu,
    closeSymbolMenu: closeSymbolMenu,
    canSendStickers: canSendStickers,
    canSendGifs: canSendGifs,
    isMessageComposer: isInMessageList,
    onGifSelect: handleGifSelect,
    onStickerSelect: handleStickerSelect,
    onCustomEmojiSelect: handleCustomEmojiSelect,
    onRemoveSymbol: removeSymbol,
    onEmojiSelect: insertTextAndUpdateCursor,
    closeBotCommandMenu: closeBotCommandMenu,
    closeSendAsMenu: closeSendAsMenu,
    isSymbolMenuForced: isSymbolMenuForced,
    canSendPlainText: !isComposerBlocked,
    inputCssSelector: editableInputCssSelector,
    idPrefix: type,
    forceDarkTheme: isInStoryViewer
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_MessageInput__WEBPACK_IMPORTED_MODULE_80__["default"], {
    ref: inputRef,
    id: inputId,
    editableInputId: editableInputId,
    customEmojiPrefix: type,
    isStoryInput: isInStoryViewer,
    chatId: chatId,
    canSendPlainText: !isComposerBlocked,
    threadId: threadId,
    isReady: isReady,
    isActive: !hasAttachments,
    getHtml: getHtml,
    placeholder: placeholder,
    timedPlaceholderDate: timedPlaceholderDate,
    timedPlaceholderLangKey: timedPlaceholderLangKey,
    forcedPlaceholder: inlineBotHelp
    // canAutoFocus={isReady && isForCurrentMessageList && !hasAttachments && isInMessageList}
    ,
    canAutoFocus: false,
    noFocusInterception: hasAttachments,
    shouldSuppressFocus: isMobile && isSymbolMenuOpen,
    shouldSuppressTextFormatter: isEmojiTooltipOpen || isMentionTooltipOpen || isInlineBotTooltipOpen,
    onUpdate: setHtml,
    onSend: onSend,
    onSuppressedFocus: closeSymbolMenu,
    onFocus: () => {
      // markInputHasFocus();
      if ((0,_chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_100__.checkShouldShowInputTranslateTip)(chatId)) {
        (0,_chatAssistant_hook_useEventBusTeact__WEBPACK_IMPORTED_MODULE_101__.emitEventTeact)('actions:openInputTranslateTip');
      }
    },
    onBlur: unmarkInputHasFocus,
    isNeedPremium: isNeedPremium,
    messageListType: messageListType
  }), isInMessageList && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, (isInlineBotLoading && Boolean(inlineBotId) || isInlineAILoading) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_91__["default"], {
    color: "gray",
    className: "flex-shrink-0"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_92__["default"], {
    className: "composer-action-buttons-container",
    slideClassName: "composer-action-buttons",
    activeKey: Number(hasText),
    direction: "inverse",
    name: "slideFadeAndroid"
  }, !hasText && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, isChannel && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_92__["default"], {
    className: "composer-action-button",
    name: "reveal",
    activeKey: Number(isSilentPosting)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    round: true,
    faded: true,
    className: "composer-action-button",
    color: "translucent",
    onClick: handleToggleSilentPosting,
    ariaLabel: lang(isSilentPosting ? 'AriaComposerSilentPostingDisable' : 'AriaComposerSilentPostingEnable')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: isSilentPosting ? 'mute' : 'unmute'
  }))), withScheduledButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    round: true,
    faded: true,
    className: "composer-action-button scheduled-button",
    color: "translucent",
    onClick: handleAllScheduledClick,
    ariaLabel: lang('AriaComposerOpenScheduled')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "schedule"
  })), shouldShowGiftButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    round: true,
    faded: true,
    className: "composer-action-button",
    color: "translucent",
    onClick: handleGiftClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "gift"
  })), shouldShowSuggestedPostButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    round: true,
    faded: true,
    className: "composer-action-button",
    color: "translucent",
    onClick: handleSuggestPostClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "cash-circle"
  })), Boolean(botKeyboardMessageId) && !activeVoiceRecording && !editingMessage && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_90__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('composer-action-button', isBotKeyboardOpen && 'activated'),
    round: true,
    color: "translucent",
    onActivate: openBotKeyboard,
    ariaLabel: lang('AriaComposerBotKeyboard')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "bot-command"
  }))))), activeVoiceRecording && Boolean(currentRecordTime) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "recording-state"
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_13__.formatVoiceRecordDuration)(currentRecordTime - startRecordTimeRef.current)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_component_input_grammar_GrammarToolWrapper__WEBPACK_IMPORTED_MODULE_65__["default"], {
    getHtml: getHtml,
    setHtml: setHtml
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_component_input_translate_input_translate__WEBPACK_IMPORTED_MODULE_26__["default"], {
    chatId: chatId
  }), !isNeedPremium && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_AttachMenu__WEBPACK_IMPORTED_MODULE_68__["default"], {
    chatId: chatId,
    threadId: threadId,
    editingMessage: editingMessage,
    canEditMedia: canMediaBeReplaced,
    isButtonVisible: !activeVoiceRecording,
    canAttachMedia: canAttachMedia,
    canAttachPolls: canAttachPolls,
    canAttachToDoLists: canAttachToDoLists,
    canSendPhotos: canSendPhotos,
    canSendVideos: canSendVideos,
    canSendDocuments: canSendDocuments,
    canSendAudios: canSendAudios,
    onFileSelect: handleFileSelect,
    onPollCreate: openPollModal,
    onTodoListCreate: handleTodoListCreate,
    isScheduled: isInScheduledList,
    attachBots: isInMessageList ? attachBots : undefined,
    peerType: attachMenuPeerType,
    shouldCollectDebugLogs: shouldCollectDebugLogs,
    theme: theme,
    onMenuOpen: onAttachMenuOpen,
    onMenuClose: onAttachMenuClose,
    messageListType: messageListType,
    paidMessagesStars: paidMessagesStars
  }), isInMessageList && Boolean(botKeyboardMessageId) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_BotKeyboardMenu__WEBPACK_IMPORTED_MODULE_70__["default"], {
    messageId: botKeyboardMessageId,
    isOpen: isBotKeyboardOpen,
    onClose: closeBotKeyboard
  }), isInMessageList && botCommands && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_BotCommandMenu_async__WEBPACK_IMPORTED_MODULE_69__["default"], {
    isOpen: isBotCommandMenuOpen,
    botCommands: botCommands,
    onClose: closeBotCommandMenu
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_CustomEmojiTooltip_async__WEBPACK_IMPORTED_MODULE_74__["default"], {
    key: `custom-emoji-tooltip-${editableInputId}`,
    chatId: chatId,
    isOpen: isCustomEmojiTooltipOpen,
    onCustomEmojiSelect: insertCustomEmoji,
    addRecentCustomEmoji: addRecentCustomEmoji,
    onClose: closeCustomEmojiTooltip
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_StickerTooltip_async__WEBPACK_IMPORTED_MODULE_83__["default"], {
    key: `sticker-tooltip-${editableInputId}`,
    chatId: chatId,
    threadId: threadId,
    isOpen: isStickerTooltipOpen,
    onStickerSelect: handleStickerSelect,
    onClose: closeStickerTooltip
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_EmojiTooltip_async__WEBPACK_IMPORTED_MODULE_77__["default"], {
    key: `emoji-tooltip-${editableInputId}`,
    isOpen: isEmojiTooltipOpen,
    emojis: filteredEmojis,
    customEmojis: filteredCustomEmojis,
    addRecentEmoji: addRecentEmoji,
    addRecentCustomEmoji: addRecentCustomEmoji,
    onEmojiSelect: insertEmoji,
    onCustomEmojiSelect: insertEmoji,
    onClose: closeEmojiTooltip
  }))), canSendOneTimeMedia && activeVoiceRecording && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('view-once', isViewOnceEnabled && 'active'),
    round: true,
    color: "secondary",
    ariaLabel: oldLang('Chat.PlayOnceVoiceMessageTooltip'),
    onClick: toogleViewOnceEnabled
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "view-once"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "one-filled"
  })), activeVoiceRecording && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    round: true,
    color: "danger",
    className: "cancel",
    onClick: stopRecordingVoice,
    ariaLabel: "Cancel voice recording"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "delete"
  })), isInStoryViewer && !activeVoiceRecording && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    round: true,
    className: "story-reaction-button",
    color: "secondary",
    onClick: handleLikeStory,
    onContextMenu: handleStoryPickerContextMenu,
    onMouseDown: handleBeforeStoryPickerContextMenu,
    ariaLabel: oldLang('AccDescrLike'),
    ref: storyReactionRef
  }, sentStoryReaction && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_reactions_ReactionAnimatedEmoji__WEBPACK_IMPORTED_MODULE_97__["default"], {
    key: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getReactionKey)(sentStoryReaction),
    containerId: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getStoryKey)(chatId, storyId),
    reaction: sentStoryReaction,
    withEffectOnly: isSentStoryReactionHeart
  }), (!sentStoryReaction || isSentStoryReactionHeart) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "heart",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])(isSentStoryReactionHeart && 'story-reaction-heart')
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    ref: mainButtonRef,
    round: true,
    color: "secondary",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])(mainButtonState, 'main-button', !isReady && 'not-ready', activeVoiceRecording && 'recording'),
    disabled: areVoiceMessagesNotAllowed || areAutoTranslate && hasText,
    allowDisabledClick: true,
    noFastClick: true,
    ariaLabel: oldLang(sendButtonAriaLabel),
    onClick: mainButtonHandler,
    onContextMenu: mainButtonState === MainButtonState.Send && canShowCustomSendMenu ? handleContextMenu : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "send"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "microphone-alt"
  }), onForward && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "forward"
  }), isInMessageList && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "schedule"
  }), isInMessageList && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "check"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_89__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('paidStarsBadge', shouldRenderPaidBadge && 'visible', prevShouldRenderPaidBadge && !shouldRenderPaidBadge && 'hiding', !prevShouldRenderPaidBadge && !shouldRenderPaidBadge && 'hidden'),
    nonInteractive: true,
    size: "tiny",
    color: "stars",
    pill: true,
    fluid: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "paidStarsBadgeText"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_95__["default"], {
    name: "star",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('star-amount-icon', className)
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AnimatedCounter__WEBPACK_IMPORTED_MODULE_93__["default"], {
    ref: counterRef,
    text: lang.number(starsForAllMessages)
  })))), effectEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "effect-icon",
    onClick: handleRemoveEffect
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_33__["default"])(effectEmoji)), effect && canPlayEffect && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_message_MessageEffect__WEBPACK_IMPORTED_MODULE_87__["default"], {
    shouldPlay: shouldPlayEffect,
    effect: effect,
    onStop: handleStopEffect
  }), canShowCustomSendMenu && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_composer_CustomSendMenu_async__WEBPACK_IMPORTED_MODULE_75__["default"], {
    isOpen: isCustomSendMenuOpen,
    canSchedule: canSchedule && isInMessageList && !isViewOnceEnabled,
    canScheduleUntilOnline: canScheduleUntilOnline && !isViewOnceEnabled,
    onSendSilent: !isChatWithSelf ? handleSendSilent : undefined,
    onSendSchedule: !isInScheduledList ? handleSendScheduled : undefined,
    onSendWhenOnline: handleSendWhenOnline,
    onRemoveEffect: handleRemoveEffect,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide,
    isSavedMessages: isChatWithSelf,
    chatId: chatId,
    withEffects: areEffectsSupported,
    hasCurrentEffect: Boolean(effect),
    effectReactions: effectReactions,
    allAvailableReactions: availableReactions,
    onToggleReaction: handleToggleEffectReaction,
    isCurrentUserPremium: isCurrentUserPremium,
    isInSavedMessages: isChatWithSelf,
    isInStoryViewer: isInStoryViewer,
    canPlayAnimatedEmojis: canPlayAnimatedEmojis
  }), calendar, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PaymentMessageConfirmDialog__WEBPACK_IMPORTED_MODULE_96__["default"], {
    isOpen: isPaymentMessageConfirmDialogOpen,
    onClose: closeConfirmModalPayForMessage,
    userName: chat ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_7__.getPeerTitle)(lang, chat) : undefined,
    messagePriceInStars: paidMessagesStars || 0,
    messagesCount: messagesCount,
    shouldAutoApprove: shouldPaidMessageAutoApprove,
    setAutoApprove: setShouldPaidMessageAutoApprove,
    confirmHandler: paymentMessageConfirmDialogHandler
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId,
  storyId,
  messageListType,
  isMobile,
  type
}) => {
  const appConfig = global.appConfig;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const chatBot = !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isSystemBot)(chatId) ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectBot)(global, chatId) : undefined;
  const isChatWithBot = Boolean(chatBot);
  const isChatWithSelf = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatWithSelf)(global, chatId);
  const isChatWithUser = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_18__.isUserId)(chatId);
  const userFullInfo = isChatWithUser ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUserFullInfo)(global, chatId) : undefined;
  const paidMessagesStars = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerPaidMessagesStars)(global, chatId);
  const chatFullInfo = !isChatWithUser ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatFullInfo)(global, chatId) : undefined;
  const messageWithActualBotKeyboard = (isChatWithBot || !isChatWithUser) && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectNewestMessageWithBotKeyboardButtons)(global, chatId, threadId);
  const {
    shouldSuggestStickers,
    shouldSuggestCustomEmoji,
    shouldUpdateStickerSetOrder,
    shouldPaidMessageAutoApprove
  } = global.settings.byKey;
  const {
    language,
    shouldCollectDebugLogs
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_10__.selectSharedSettings)(global);
  const {
    forwardMessages: {
      messageIds: forwardMessageIds
    }
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global);
  const baseEmojiKeywords = global.emojiKeywords[_config__WEBPACK_IMPORTED_MODULE_3__.BASE_EMOJI_KEYWORD_LANG];
  const emojiKeywords = language !== _config__WEBPACK_IMPORTED_MODULE_3__.BASE_EMOJI_KEYWORD_LANG ? global.emojiKeywords[language] : undefined;
  const botKeyboardMessageId = messageWithActualBotKeyboard ? messageWithActualBotKeyboard.id : undefined;
  const keyboardMessage = botKeyboardMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessage)(global, chatId, botKeyboardMessageId) : undefined;
  const {
    currentUserId
  } = global;
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, currentUserId);
  const defaultSendAsId = chatFullInfo ? chatFullInfo?.sendAsId || currentUserId : undefined;
  const sendAsId = defaultSendAsId;
  const sendAsPeer = sendAsId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, sendAsId) : undefined;
  const requestedDraft = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectRequestedDraft)(global, chatId);
  const requestedDraftFiles = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectRequestedDraftFiles)(global, chatId);
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global);
  const isStoryViewerOpen = Boolean(tabState.storyViewer.storyId);
  const currentMessageList = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMessageList)(global);
  const isForCurrentMessageList = chatId === currentMessageList?.chatId && threadId === currentMessageList?.threadId && messageListType === currentMessageList?.type && !isStoryViewerOpen;
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, chatId);
  const canSendVoiceByPrivacy = (user && !userFullInfo?.noVoiceMessages) ?? true;
  const slowMode = chatFullInfo?.slowMode;
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserPremium)(global);
  const editingDraft = messageListType === 'scheduled' ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectEditingScheduledDraft)(global, chatId) : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectEditingDraft)(global, chatId, threadId);
  const story = storyId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStory)(global, chatId, storyId);
  const sentStoryReaction = story && 'sentReaction' in story ? story.sentReaction : undefined;
  const draft = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectDraft)(global, chatId, threadId);
  const replyToMessage = draft?.replyInfo ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessage)(global, chatId, draft.replyInfo.replyToMsgId) : undefined;
  const replyToTopic = chat?.isForum && chat.isForumAsMessages && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && replyToMessage ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTopicFromMessage)(global, replyToMessage) : undefined;
  const isInScheduledList = messageListType === 'scheduled';
  const canSendQuickReplies = isChatWithUser && !isChatWithBot && !isInScheduledList && !isChatWithSelf;
  const noWebPage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectNoWebPage)(global, chatId, threadId);
  const isSilentPosting = chat && (0,_global_helpers_notifications__WEBPACK_IMPORTED_MODULE_6__.getChatNotifySettings)(chat, (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectNotifyDefaults)(global), (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectNotifyException)(global, chatId))?.isSilentPosting;
  const areEffectsSupported = isChatWithUser && !isChatWithBot && !isInScheduledList && !isChatWithSelf && type !== 'story' && chatId !== _config__WEBPACK_IMPORTED_MODULE_3__.SERVICE_NOTIFICATIONS_USER_ID;
  const canPlayEffect = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPerformanceSettingsValue)(global, 'stickerEffects');
  const shouldPlayEffect = tabState.shouldPlayEffectInComposer;
  const effectId = areEffectsSupported && draft?.effectId;
  const effect = effectId ? global.availableEffectById[effectId] : undefined;
  const effectReactions = global.reactions.effectReactions;
  const maxMessageLength = global.config?.maxMessageLength || _config__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_MAX_MESSAGE_LENGTH;
  const isForwarding = chatId === tabState.forwardMessages.toChatId;
  const isReplying = Boolean(draft?.replyInfo);
  const hasSuggestedPost = Boolean(draft?.suggestedPostInfo);
  const starsBalance = global.stars?.balance.amount || 0;
  const isStarsBalanceModalOpen = Boolean(tabState.starsBalanceModal);
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserFrozen)(global);
  const isAppConfigLoaded = global.isAppConfigLoaded;
  const insertingPeerIdMention = tabState.insertingPeerIdMention;
  const webPagePreview = tabState.webPagePreviewId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectWebPage)(global, tabState.webPagePreviewId) : undefined;
  const inputTranslateOptions = global.roomInputTranslateOptions[chatId];
  return {
    availableReactions: global.reactions.availableReactions,
    topReactions: type === 'story' ? global.reactions.topReactions : undefined,
    isOnActiveTab: !tabState.isBlurred,
    editingMessage: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectEditingMessage)(global, chatId, threadId, messageListType),
    draft,
    chat,
    isChatWithBot,
    isChatWithSelf,
    isForCurrentMessageList,
    canScheduleUntilOnline: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCanScheduleUntilOnline)(global, chatId),
    isChannel: chat ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat) : undefined,
    isRightColumnShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsRightColumnShown)(global, isMobile),
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsInSelectMode)(global),
    withScheduledButton: messageListType === 'thread' && (userFullInfo || chatFullInfo)?.hasScheduledMessages,
    isInScheduledList,
    botKeyboardMessageId,
    botKeyboardPlaceholder: keyboardMessage?.keyboardPlaceholder,
    isForwarding,
    isReplying,
    hasSuggestedPost,
    forwardedMessagesCount: isForwarding ? forwardMessageIds.length : undefined,
    pollModal: tabState.pollModal,
    todoListModal: tabState.todoListModal,
    stickersForEmoji: global.stickers.forEmoji.stickers,
    customEmojiForEmoji: global.customEmojis.forEmoji.stickers,
    chatFullInfo,
    topInlineBotIds: global.topInlineBots?.userIds,
    currentUserId,
    currentUser,
    contentToBeScheduled: tabState.contentToBeScheduled,
    shouldSuggestStickers,
    shouldSuggestCustomEmoji,
    shouldUpdateStickerSetOrder,
    recentEmojis: global.recentEmojis,
    baseEmojiKeywords: baseEmojiKeywords?.keywords,
    emojiKeywords: emojiKeywords?.keywords,
    inlineBots: tabState.inlineBots.byUsername,
    isInlineBotLoading: tabState.inlineBots.isLoading,
    botCommands: userFullInfo ? userFullInfo.botInfo?.commands || false : undefined,
    botMenuButton: userFullInfo?.botInfo?.menuButton,
    sendAsPeer,
    sendAsId,
    editingDraft,
    requestedDraft,
    requestedDraftFiles,
    attachBots: global.attachMenu.bots,
    attachMenuPeerType: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatType)(global, chatId),
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTheme)(global),
    fileSizeLimit: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_9__.selectCurrentLimit)(global, 'uploadMaxFileparts') * _config__WEBPACK_IMPORTED_MODULE_3__.MAX_UPLOAD_FILEPART_SIZE,
    captionLimit: (0,_global_selectors_limits__WEBPACK_IMPORTED_MODULE_9__.selectCurrentLimit)(global, 'captionLength'),
    isCurrentUserPremium,
    canSendVoiceByPrivacy,
    attachmentSettings: global.attachmentSettings,
    slowMode,
    currentMessageList,
    isReactionPickerOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsReactionPickerOpen)(global),
    canBuyPremium: !isCurrentUserPremium && !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsPremiumPurchaseBlocked)(global),
    canPlayAnimatedEmojis: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCanPlayAnimatedEmojis)(global),
    canSendOneTimeMedia: !isChatWithSelf && isChatWithUser && !isChatWithBot && !isInScheduledList,
    shouldCollectDebugLogs,
    sentStoryReaction,
    stealthMode: global.stories.stealthMode,
    replyToTopic,
    quickReplyMessages: global.quickReplies.messagesById,
    quickReplies: global.quickReplies.byId,
    canSendQuickReplies,
    noWebPage,
    webPagePreview,
    isContactRequirePremium: userFullInfo?.isContactRequirePremium,
    effect,
    effectReactions,
    areEffectsSupported,
    canPlayEffect,
    shouldPlayEffect,
    maxMessageLength,
    paidMessagesStars,
    shouldPaidMessageAutoApprove,
    isSilentPosting,
    isPaymentMessageConfirmDialogOpen: tabState.isPaymentMessageConfirmDialogOpen,
    starsBalance,
    isStarsBalanceModalOpen,
    shouldDisplayGiftsButton: userFullInfo?.shouldDisplayGiftsButton,
    disallowedGifts: userFullInfo?.disallowedGifts,
    isAccountFrozen,
    isAppConfigLoaded,
    insertingPeerIdMention,
    pollMaxAnswers: appConfig?.pollMaxAnswers,
    inputTranslateOptions
  };
})(Composer)));

/***/ },

/***/ "./src/components/common/DeleteChatModal.scss"
/*!****************************************************!*\
  !*** ./src/components/common/DeleteChatModal.scss ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/DeleteChatModal.tsx"
/*!***************************************************!*\
  !*** ./src/components/common/DeleteChatModal.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _DeleteChatModal_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./DeleteChatModal.scss */ "./src/components/common/DeleteChatModal.scss");













const DeleteChatModal = ({
  isOpen,
  chat,
  isSavedDialog,
  isChannel,
  isPrivateChat,
  isChatWithSelf,
  isBot,
  isBasicGroup,
  isSuperGroup,
  currentUserId,
  canDeleteForAll,
  contactName,
  onClose,
  onCloseAnimationEnd
}) => {
  const {
    leaveChannel,
    deleteHistory,
    deleteSavedHistory,
    deleteChannel,
    deleteChatUser,
    blockUser,
    deleteChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const chatTitle = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, chat);
  const handleDeleteForAll = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    deleteHistory({
      chatId: chat.id,
      shouldDeleteForAll: true
    });
    onClose();
  });
  const handleDeleteAndStop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    deleteHistory({
      chatId: chat.id,
      shouldDeleteForAll: true
    });
    blockUser({
      userId: chat.id
    });
    onClose();
  });
  const handleDeleteChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (isSavedDialog) {
      deleteSavedHistory({
        chatId: chat.id
      });
    } else if (isPrivateChat) {
      deleteHistory({
        chatId: chat.id,
        shouldDeleteForAll: false
      });
    } else if (isBasicGroup) {
      if (chat.isCreator) {
        deleteHistory({
          chatId: chat.id,
          shouldDeleteForAll: true
        });
        deleteChat({
          chatId: chat.id
        });
      } else {
        deleteHistory({
          chatId: chat.id,
          shouldDeleteForAll: false
        });
        deleteChatUser({
          chatId: chat.id,
          userId: currentUserId
        });
      }
    } else if ((isChannel || isSuperGroup) && !chat.isCreator) {
      leaveChannel({
        chatId: chat.id
      });
    } else if ((isChannel || isSuperGroup) && chat.isCreator) {
      deleteChannel({
        chatId: chat.id
      });
    }
    onClose();
  });
  const handleLeaveChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (isChannel || isSuperGroup) {
      leaveChannel({
        chatId: chat.id
      });
      onClose();
    } else if (isBasicGroup && chat.isCreator) {
      deleteHistory({
        chatId: chat.id,
        shouldDeleteForAll: false
      });
      deleteChatUser({
        chatId: chat.id,
        userId: currentUserId
      });
    } else {
      handleDeleteChat();
    }
  });
  function renderHeader() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "modal-header",
      dir: lang.isRtl ? 'rtl' : undefined
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
      size: "tiny",
      peer: chat,
      isSavedMessages: isChatWithSelf
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
      className: "modal-title"
    }, lang(renderTitle())));
  }
  function renderTitle() {
    if (isSavedDialog) {
      return isChatWithSelf ? 'ClearHistoryMyNotesTitle' : 'ClearHistoryTitleSingle2';
    }
    if (isChannel && !chat.isCreator) {
      return 'LeaveChannel';
    }
    if (isChannel && chat.isCreator) {
      return 'ChannelDelete';
    }
    if (isBasicGroup || isSuperGroup) {
      return 'Group.LeaveGroup';
    }
    return 'DeleteChatUser';
  }
  function renderContent() {
    if (isSavedDialog) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(isChatWithSelf ? lang('ClearHistoryMyNotesMessage') : lang('ClearHistoryMessageSingle', chatTitle), ['simple_markdown', 'emoji']));
    }
    if (isChannel && chat.isCreator) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(lang('ChatList.DeleteAndLeaveGroupConfirmation', chatTitle), ['simple_markdown', 'emoji']));
    }
    if (isChannel && !chat.isCreator || isBasicGroup || isSuperGroup) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(lang('ChannelLeaveAlertWithName', chatTitle), ['simple_markdown', 'emoji']));
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(lang('ChatList.DeleteChatConfirmation', contactName), ['simple_markdown', 'emoji']));
  }
  function renderActionText() {
    if (isSavedDialog) {
      return 'Delete';
    }
    if (isChannel && !chat.isCreator) {
      return 'LeaveChannel';
    }
    if (isChannel && chat.isCreator) {
      return 'Chat.Input.Delete';
    }
    if (isBasicGroup || isSuperGroup) {
      return 'Group.LeaveGroup';
    }
    return canDeleteForAll ? 'ChatList.DeleteForCurrentUser' : 'Delete';
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Modal__WEBPACK_IMPORTED_MODULE_9__["default"], {
    isOpen: isOpen,
    className: "DeleteChatModal",
    header: renderHeader(),
    onClose: onClose,
    onCloseAnimationEnd: onCloseAnimationEnd
  }, renderContent(), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "dialog-buttons-column"
  }, isBot && !isSavedDialog && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    color: "danger",
    className: "confirm-dialog-button",
    isText: true,
    onClick: handleDeleteAndStop
  }, lang('DeleteAndStop')), canDeleteForAll && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    color: "danger",
    className: "confirm-dialog-button",
    isText: true,
    onClick: handleDeleteForAll
  }, contactName ? (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_5__["default"])(lang('ChatList.DeleteForEveryone', contactName)) : lang('DeleteForAll')), !isPrivateChat && chat.isCreator && !isSavedDialog && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    color: "danger",
    className: "confirm-dialog-button",
    isText: true,
    onClick: handleDeleteChat
  }, lang('DeleteForAll')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    color: "danger",
    className: "confirm-dialog-button",
    isText: true,
    onClick: isPrivateChat || isSavedDialog ? handleDeleteChat : handleLeaveChat
  }, lang(renderActionText())), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: "confirm-dialog-button",
    isText: true,
    onClick: onClose
  }, lang('Cancel'))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chat,
  isSavedDialog
}) => {
  const isPrivateChat = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_4__.isUserId)(chat.id);
  const isChatWithSelf = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsChatWithSelf)(global, chat.id);
  const user = isPrivateChat && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getPrivateChatUserId)(chat));
  const isBot = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isUserBot)(user) && !chat.isSupport;
  const canDeleteForAll = isPrivateChat && !isChatWithSelf && !isBot && !isSavedDialog;
  const contactName = isPrivateChat ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)((0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getPrivateChatUserId)(chat))) : undefined;
  return {
    isPrivateChat,
    isChatWithSelf,
    isBot,
    isChannel: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatChannel)(chat),
    isBasicGroup: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatBasicGroup)(chat),
    isSuperGroup: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatSuperGroup)(chat),
    currentUserId: global.currentUserId,
    canDeleteForAll,
    contactName
  };
})(DeleteChatModal)));

/***/ },

/***/ "./src/components/common/Document.tsx"
/*!********************************************!*\
  !*** ./src/components/common/Document.tsx ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _helpers_documentInfo__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers/documentInfo */ "./src/components/common/helpers/documentInfo.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useMediaWithLoadProgress */ "./src/hooks/useMediaWithLoadProgress.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _File__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./File */ "./src/components/common/File.tsx");















const BYTES_PER_MB = 1024 * 1024;
const Document = ({
  document,
  observeIntersection,
  smaller,
  canAutoLoad,
  autoLoadFileMaxSizeMb,
  uploadProgress,
  withDate,
  datetime,
  className,
  sender,
  isSelected,
  isSelectable,
  shouldWarnAboutSvg,
  isDownloading,
  message,
  onSelect,
  onCancelUpload,
  onMediaClick,
  onDateClick
}) => {
  const {
    cancelMediaDownload,
    downloadMedia,
    setSharedSettingOption
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const [isSvgDialogOpen, openSvgDialog, closeSvgDialog] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const [shouldNotWarnAboutSvg, setShouldNotWarnAboutSvg] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    fileName,
    size,
    timestamp
  } = document;
  const extension = (0,_helpers_documentInfo__WEBPACK_IMPORTED_MODULE_4__.getDocumentExtension)(document) || '';
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_6__.useIsIntersecting)(ref, observeIntersection);
  const [wasIntersected, markIntersected] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isIntersecting) {
      markIntersected();
    }
  }, [isIntersecting, markIntersected]);

  // Auto-loading does not use global download manager because requires additional click to save files locally
  const [isLoadAllowed, setIsLoadAllowed] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(canAutoLoad && (!autoLoadFileMaxSizeMb || size <= autoLoadFileMaxSizeMb * BYTES_PER_MB));
  const shouldDownload = Boolean(isDownloading || isLoadAllowed && wasIntersected);
  const documentHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getDocumentMediaHash)(document, 'download');
  const {
    loadProgress: downloadProgress,
    mediaData
  } = (0,_hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_9__["default"])(documentHash, !shouldDownload, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMediaFormat)(document, 'download'), undefined, true);
  const isLoaded = Boolean(mediaData);
  const {
    isUploading,
    isTransferring,
    transferProgress
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMediaTransferState)(uploadProgress || downloadProgress, shouldDownload && !isLoaded, uploadProgress !== undefined);
  const hasPreview = (0,_helpers_documentInfo__WEBPACK_IMPORTED_MODULE_4__.getDocumentHasPreview)(document);
  const thumbDataUri = hasPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMediaThumbUri)(document) : undefined;
  const localBlobUrl = hasPreview ? document.previewBlobUrl : undefined;
  const previewData = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_8__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getDocumentMediaHash)(document, 'pictogram'), !isIntersecting);
  const withMediaViewer = onMediaClick && document.innerMediaType;
  const handleDownload = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    downloadMedia({
      media: document,
      originMessage: message
    });
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (isUploading) {
      if (onCancelUpload) {
        onCancelUpload();
      }
      return;
    }
    if (isDownloading) {
      cancelMediaDownload({
        media: document
      });
      return;
    }
    if (isTransferring) {
      setIsLoadAllowed(false);
      return;
    }
    if (withMediaViewer) {
      onMediaClick();
      return;
    }
    if (_config__WEBPACK_IMPORTED_MODULE_2__.SVG_EXTENSIONS.has(extension) && shouldWarnAboutSvg) {
      openSvgDialog();
      return;
    }
    handleDownload();
  });
  const handleSvgConfirm = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    setSharedSettingOption({
      shouldWarnAboutSvg: !shouldNotWarnAboutSvg
    });
    closeSvgDialog();
    handleDownload();
  });
  const handleDateClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    onDateClick?.(message);
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_File__WEBPACK_IMPORTED_MODULE_13__["default"], {
    ref: ref,
    name: fileName,
    extension: extension,
    size: size,
    timestamp: withDate ? datetime || timestamp : undefined,
    thumbnailDataUri: thumbDataUri,
    previewData: localBlobUrl || previewData,
    smaller: smaller,
    isTransferring: isTransferring,
    isUploading: isUploading,
    transferProgress: transferProgress,
    className: className,
    sender: sender,
    isSelectable: isSelectable,
    isSelected: isSelected,
    actionIcon: withMediaViewer ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isDocumentVideo)(document) ? 'play' : 'eye' : 'download',
    onClick: handleClick,
    onSelect: onSelect,
    onDateClick: onDateClick ? handleDateClick : undefined
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_12__["default"], {
    isOpen: isSvgDialogOpen,
    onClose: closeSvgDialog,
    confirmHandler: handleSvgConfirm
  }, lang('lng_launch_svg_warning'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_11__["default"], {
    className: "dialog-checkbox",
    checked: shouldNotWarnAboutSvg,
    label: lang('lng_launch_exe_dont_ask'),
    onCheck: setShouldNotWarnAboutSvg
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Document));

/***/ },

/***/ "./src/components/common/DotAnimation.scss"
/*!*************************************************!*\
  !*** ./src/components/common/DotAnimation.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/DotAnimation.tsx"
/*!************************************************!*\
  !*** ./src/components/common/DotAnimation.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _DotAnimation_scss__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./DotAnimation.scss */ "./src/components/common/DotAnimation.scss");





const DotAnimation = ({
  content,
  className
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('DotAnimation', className),
    dir: lang.isRtl ? 'rtl' : 'auto'
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_2__["default"])(content), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "ellipsis"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DotAnimation);

/***/ },

/***/ "./src/components/common/File.scss"
/*!*****************************************!*\
  !*** ./src/components/common/File.scss ***!
  \*****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/File.tsx"
/*!****************************************!*\
  !*** ./src/components/common/File.tsx ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _helpers_documentInfo__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers/documentInfo */ "./src/components/common/helpers/documentInfo.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCanvasBlur__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useCanvasBlur */ "./src/hooks/useCanvasBlur.ts");
/* harmony import */ var _hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useMediaTransitionDeprecated */ "./src/hooks/useMediaTransitionDeprecated.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../ui/ProgressSpinner */ "./src/components/ui/ProgressSpinner.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _File_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./File.scss */ "./src/components/common/File.scss");

















const File = ({
  ref,
  name,
  size,
  extension = '',
  timestamp,
  sender,
  thumbnailDataUri,
  previewData,
  className,
  smaller,
  isTransferring,
  isUploading,
  isSelectable,
  isSelected,
  transferProgress,
  actionIcon,
  onClick,
  onSelect,
  onDateClick
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  let elementRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  if (ref) {
    elementRef = ref;
  }
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const [withThumb] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!previewData);
  const noThumb = Boolean(previewData);
  const thumbRef = (0,_hooks_useCanvasBlur__WEBPACK_IMPORTED_MODULE_8__["default"])(thumbnailDataUri, noThumb, isMobile && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_CANVAS_FILTER_SUPPORTED);
  const thumbClassNames = (0,_hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_9__["default"])(!noThumb);
  const {
    shouldRender: shouldSpinnerRender,
    transitionClassNames: spinnerClassNames
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_11__["default"])(isTransferring, undefined, true);
  const color = (0,_helpers_documentInfo__WEBPACK_IMPORTED_MODULE_4__.getColorFromExtension)(extension);
  const sizeString = (0,_helpers_documentInfo__WEBPACK_IMPORTED_MODULE_4__.getFileSizeString)(size);
  const subtitle = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isTransferring || !transferProgress) return sizeString;
    return `${(0,_helpers_documentInfo__WEBPACK_IMPORTED_MODULE_4__.getFileSizeString)(size * transferProgress)} / ${sizeString}`;
  }, [isTransferring, size, sizeString, transferProgress]);
  const {
    width,
    height
  } = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.getDocumentThumbnailDimensions)(smaller);
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('File', className, smaller && 'smaller', onClick && !isUploading && 'interactive', isSelected && 'file-is-selected');
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: elementRef,
    className: fullClassName,
    dir: lang.isRtl ? 'rtl' : undefined,
    onClick: onSelect
  }, isSelectable && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-select-control no-selection"
  }, isSelected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_14__["default"], {
    name: "select"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "file-icon-container",
    onClick: isUploading ? undefined : onClick
  }, thumbnailDataUri || previewData ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "file-preview media-inner"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: previewData,
    className: "full-media",
    width: width,
    height: height,
    draggable: false,
    alt: ""
  }), withThumb && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: thumbRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('thumbnail', thumbClassNames)
  })) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: `file-icon ${color}`
  }, extension.length <= 4 && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "file-ext",
    dir: "auto"
  }, extension)), shouldSpinnerRender && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('file-progress', color, spinnerClassNames)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_13__["default"], {
    progress: transferProgress,
    size: smaller ? 's' : 'm',
    onClick: isUploading ? onClick : undefined
  })), onClick && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_14__["default"], {
    name: actionIcon || 'download',
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('action-icon', shouldSpinnerRender && 'hidden')
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "file-info"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "file-title",
    dir: "auto",
    title: name
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(name)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "file-subtitle",
    dir: "auto"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, subtitle), sender && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "file-sender"
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(sender)), !sender && Boolean(timestamp) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "bullet"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_12__["default"], {
    onClick: onDateClick
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatMediaDateTime)(lang, timestamp * 1000, true))))), sender && Boolean(timestamp) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_12__["default"], {
    onClick: onDateClick
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatPastTimeShort)(lang, timestamp * 1000)));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(File));

/***/ },

/***/ "./src/components/common/GroupChatInfo.tsx"
/*!*************************************************!*\
  !*** ./src/components/common/GroupChatInfo.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _DotAnimation__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./DotAnimation */ "./src/components/common/DotAnimation.tsx");
/* harmony import */ var _FullNameTitle__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _TopicIcon__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./TopicIcon */ "./src/components/common/TopicIcon.tsx");
/* harmony import */ var _TypingStatus__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./TypingStatus */ "./src/components/common/TypingStatus.tsx");



















const TOPIC_ICON_SIZE = 2.5 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.REM;
const GroupChatInfo = ({
  typingStatus,
  className,
  statusIcon,
  avatarSize = 'medium',
  noAvatar,
  status,
  withDots,
  withMediaViewer,
  withUsername,
  withFullInfo,
  withUpdatingStatus,
  withChatType,
  threadInfo,
  noRtl,
  chat: realChat,
  onlineCount,
  areMessagesLoaded,
  topic,
  messagesCount,
  noStatusOrTyping,
  withStory,
  storyViewerOrigin,
  noEmojiStatus,
  emojiStatusSize,
  isSavedDialog,
  self,
  withMonoforumStatus,
  monoforumChannel,
  onClick,
  onEmojiStatusClick
}) => {
  const {
    loadFullChat,
    openMediaViewer,
    loadMoreProfilePhotos
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const chat = !withMonoforumStatus && monoforumChannel ? monoforumChannel : realChat;
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isSuperGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatSuperGroup)(chat);
  const isTopic = Boolean(chat?.isForum && threadInfo && topic);
  const {
    id: chatId,
    isMin
  } = chat || {};
  const isRestricted = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsChatRestricted)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), chatId);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId && !isMin) {
      if (withFullInfo) loadFullChat({
        chatId
      });
      if (withMediaViewer) loadMoreProfilePhotos({
        peerId: chatId,
        isPreload: true
      });
    }
  }, [chatId, isMin, withFullInfo, isSuperGroup, withMediaViewer]);
  const handleAvatarViewerOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])((e, hasMedia) => {
    if (chat && hasMedia) {
      e.stopPropagation();
      openMediaViewer({
        isAvatarView: true,
        chatId: chat.id,
        mediaIndex: 0,
        origin: avatarSize === 'jumbo' ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ProfileAvatar : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.MiddleHeaderAvatar
      });
    }
  });
  const mainUsername = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => chat && withUsername && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMainUsername)(chat), [chat, withUsername]);
  if (!chat) {
    return undefined;
  }
  function renderStatusOrTyping() {
    if (status) {
      return withDots ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DotAnimation__WEBPACK_IMPORTED_MODULE_13__["default"], {
        className: "status",
        content: status
      }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "status",
        dir: "auto"
      }, statusIcon && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
        className: "status-icon",
        name: statusIcon
      }), (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(status));
    }
    if (withUpdatingStatus && !areMessagesLoaded && !isRestricted) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DotAnimation__WEBPACK_IMPORTED_MODULE_13__["default"], {
        className: "status",
        content: oldLang('Updating')
      });
    }
    if (withMonoforumStatus) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "status",
        dir: "auto"
      }, lang('MonoforumStatus'));
    }
    if (realChat?.isMonoforum) {
      return undefined;
    }
    if (status) {
      return withDots ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DotAnimation__WEBPACK_IMPORTED_MODULE_13__["default"], {
        className: "status",
        content: status
      }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "status",
        dir: "auto"
      }, statusIcon && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
        className: "status-icon",
        name: statusIcon
      }), (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(status));
    }
    if (!chat) {
      return undefined;
    }
    if (typingStatus) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TypingStatus__WEBPACK_IMPORTED_MODULE_17__["default"], {
        typingStatus: typingStatus
      });
    }
    if (isTopic) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "status",
        dir: "auto"
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_11__["default"], {
        name: "fade",
        shouldRestoreHeight: true,
        activeKey: messagesCount !== undefined ? 1 : 2,
        className: "message-count-transition"
      }, messagesCount !== undefined && oldLang('messages', messagesCount, 'i')));
    }
    if (withChatType) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "status",
        dir: "auto"
      }, oldLang((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getChatTypeString)(chat)));
    }
    const groupStatus = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getGroupStatus)(oldLang, chat);
    const onlineStatus = onlineCount ? `, ${oldLang('OnlineCount', onlineCount, 'i')}` : undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "status"
    }, mainUsername && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "handle withStatus"
    }, mainUsername), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "group-status"
    }, groupStatus), onlineStatus && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "online-status"
    }, onlineStatus));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('ChatInfo', className),
    dir: !noRtl && oldLang.isRtl ? 'rtl' : undefined,
    onClick: onClick
  }, !noAvatar && !isTopic && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, isSavedDialog && self && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Avatar__WEBPACK_IMPORTED_MODULE_12__["default"], {
    key: "saved-messages",
    size: avatarSize,
    peer: self,
    isSavedMessages: true,
    className: "saved-dialog-avatar"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Avatar__WEBPACK_IMPORTED_MODULE_12__["default"], {
    key: chat.id,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(isSavedDialog && 'overlay-avatar'),
    size: avatarSize,
    peer: chat,
    withStory: withStory,
    asMessageBubble: Boolean(monoforumChannel),
    storyViewerOrigin: storyViewerOrigin,
    storyViewerMode: "single-peer",
    isSavedDialog: isSavedDialog,
    onClick: withMediaViewer ? handleAvatarViewerOpen : undefined
  })), isTopic && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TopicIcon__WEBPACK_IMPORTED_MODULE_16__["default"], {
    topic: topic,
    className: "topic-header-icon",
    size: TOPIC_ICON_SIZE
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info"
  }, topic ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    dir: "auto",
    className: "fullName"
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(topic.title)) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FullNameTitle__WEBPACK_IMPORTED_MODULE_14__["default"], {
    peer: chat,
    isMonoforum: !withMonoforumStatus && Boolean(monoforumChannel),
    emojiStatusSize: emojiStatusSize,
    withEmojiStatus: !noEmojiStatus,
    isSavedDialog: isSavedDialog,
    onEmojiStatusClick: onEmojiStatusClick
  }), !noStatusOrTyping && renderStatusOrTyping()));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const threadInfo = threadId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectThreadInfo)(global, chatId, threadId) : undefined;
  const onlineCount = chat ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatOnlineCount)(global, chat) : undefined;
  const areMessagesLoaded = Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessages)(global, chatId));
  const topic = threadId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTopic)(global, chatId, threadId) : undefined;
  const messagesCount = topic && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectThreadMessagesCount)(global, chatId, threadId);
  const self = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, global.currentUserId);
  const monoforumChannel = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectMonoforumChannel)(global, chatId);
  return {
    chat,
    threadInfo,
    onlineCount,
    topic,
    areMessagesLoaded,
    messagesCount,
    self,
    monoforumChannel
  };
})(GroupChatInfo)));

/***/ },

/***/ "./src/components/common/LastMessageMeta.scss"
/*!****************************************************!*\
  !*** ./src/components/common/LastMessageMeta.scss ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/LastMessageMeta.tsx"
/*!***************************************************!*\
  !*** ./src/components/common/LastMessageMeta.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _MessageOutgoingStatus__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./MessageOutgoingStatus */ "./src/components/common/MessageOutgoingStatus.tsx");
/* harmony import */ var _LastMessageMeta_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./LastMessageMeta.scss */ "./src/components/common/LastMessageMeta.scss");







const LastMessageMeta = ({
  className,
  message,
  outgoingStatus,
  draftDate
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const shouldUseDraft = draftDate && draftDate > message.date;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('LastMessageMeta', className)
  }, outgoingStatus && !shouldUseDraft && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageOutgoingStatus__WEBPACK_IMPORTED_MODULE_4__["default"], {
    status: outgoingStatus
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "time"
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatPastTimeShort)(lang, (shouldUseDraft ? draftDate : message.date) * 1000)));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(LastMessageMeta));

/***/ },

/***/ "./src/components/common/LinkField.module.scss"
/*!*****************************************************!*\
  !*** ./src/components/common/LinkField.module.scss ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"primaryLink":"xNjJHI7j","input":"Ag6k_p7b","moreMenu":"p7t3macG","copy":"obuPXobw","title":"vCMpiQTJ","share":"Sbagy_Tm"});

/***/ },

/***/ "./src/components/common/LinkField.tsx"
/*!*********************************************!*\
  !*** ./src/components/common/LinkField.tsx ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _LinkField_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./LinkField.module.scss */ "./src/components/common/LinkField.module.scss");













const InviteLink = ({
  title,
  link,
  isDisabled,
  className,
  withShare,
  onRevoke
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    showNotification,
    openChatWithDraft
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const isOnlyCopy = !onRevoke;
  const copyLink = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_3__.copyTextToClipboard)(link);
    showNotification({
      message: {
        key: 'LinkCopied'
      }
    });
  });
  const handleCopyClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (isDisabled) return;
    copyLink();
  });
  const handleShare = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    openChatWithDraft({
      text: {
        text: link
      }
    });
  });
  const PrimaryLinkMenuButton = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
      round: true,
      ripple: !isMobile,
      size: "smaller",
      color: "translucent",
      className: isOpen ? 'active' : '',
      onClick: onTrigger,
      ariaLabel: lang('AccDescrOpenMenu2')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_10__["default"], {
      name: "more"
    }));
  }, [isMobile, lang]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: className
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _LinkField_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].title
  }, lang(title || 'InviteLink.InviteLink')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _LinkField_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].primaryLink
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("input", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('form-control', _LinkField_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].input),
    value: link,
    readOnly: true,
    onClick: handleCopyClick
  }), isOnlyCopy ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
    color: "translucent",
    className: _LinkField_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].copy,
    size: "smaller",
    round: true,
    disabled: isDisabled,
    onClick: handleCopyClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_10__["default"], {
    name: "copy"
  })) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: _LinkField_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].moreMenu,
    trigger: PrimaryLinkMenuButton,
    positionX: "right"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
    icon: "copy",
    onClick: handleCopyClick,
    disabled: isDisabled
  }, lang('Copy')), onRevoke && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_9__["default"], {
    icon: "delete",
    onClick: onRevoke,
    destructive: true
  }, lang('RevokeButton')))), withShare && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
    size: "smaller",
    disabled: isDisabled,
    onClick: handleShare,
    className: _LinkField_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].share
  }, lang('FolderLinkScreen.LinkActionShare')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(InviteLink));

/***/ },

/***/ "./src/components/common/Media.scss"
/*!******************************************!*\
  !*** ./src/components/common/Media.scss ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/Media.tsx"
/*!*****************************************!*\
  !*** ./src/components/common/Media.tsx ***!
  \*****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useMediaTransitionDeprecated */ "./src/hooks/useMediaTransitionDeprecated.ts");
/* harmony import */ var _MediaSpoiler__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _Media_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./Media.scss */ "./src/components/common/Media.scss");















const Media = ({
  message,
  idPrefix = 'shared-media',
  isProtected,
  observeIntersection,
  onClick
}) => {
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_8__.useIsIntersecting)(ref, observeIntersection);
  const thumbDataUri = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_6__["default"])(message);
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_5__["default"])(message, 'pictogram');
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__["default"])(mediaHash, !isIntersecting);
  const transitionClassNames = (0,_hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_11__["default"])(mediaBlobUrl);
  const video = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageVideo)(message);
  const hasSpoiler = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageIsSpoiler)(message);
  const [isSpoilerShown,, hideSpoiler] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__["default"])(hasSpoiler);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    hideSpoiler();
    onClick(message.id, message.chatId);
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    id: `${idPrefix}${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageHtmlId)(message.id)}`,
    className: "Media scroll-item",
    onClick: onClick ? handleClick : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: thumbDataUri,
    className: "media-miniature",
    alt: "",
    draggable: !isProtected,
    decoding: "async",
    onContextMenu: isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_4__["default"] : undefined
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: mediaBlobUrl,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('full-media', 'media-miniature', transitionClassNames),
    alt: "",
    draggable: !isProtected,
    decoding: "async",
    onContextMenu: isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_4__["default"] : undefined
  }), hasSpoiler && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MediaSpoiler__WEBPACK_IMPORTED_MODULE_12__["default"], {
    thumbDataUri: mediaBlobUrl || thumbDataUri,
    isVisible: isSpoilerShown,
    className: "media-spoiler"
  }), video && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "video-duration"
  }, video.isGif ? 'GIF' : (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatMediaDuration)(video.duration)), isProtected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Media));

/***/ },

/***/ "./src/components/common/MessageOutgoingStatus.scss"
/*!**********************************************************!*\
  !*** ./src/components/common/MessageOutgoingStatus.scss ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/MessageOutgoingStatus.tsx"
/*!*********************************************************!*\
  !*** ./src/components/common/MessageOutgoingStatus.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _MessageOutgoingStatus_scss__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./MessageOutgoingStatus.scss */ "./src/components/common/MessageOutgoingStatus.scss");





var Keys = /*#__PURE__*/function (Keys) {
  Keys[Keys["failed"] = 0] = "failed";
  Keys[Keys["pending"] = 1] = "pending";
  Keys[Keys["succeeded"] = 2] = "succeeded";
  Keys[Keys["read"] = 3] = "read";
  return Keys;
}(Keys || {});
const MessageOutgoingStatus = ({
  status
}) => {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "MessageOutgoingStatus"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_1__["default"], {
    name: "reveal",
    activeKey: Keys[status]
  }, status === 'failed' ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "MessageOutgoingStatus--failed"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_2__["default"], {
    name: "message-failed"
  })) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_2__["default"], {
    name: `message-${status}`
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MessageOutgoingStatus));

/***/ },

/***/ "./src/components/common/NothingFound.scss"
/*!*************************************************!*\
  !*** ./src/components/common/NothingFound.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/NothingFound.tsx"
/*!************************************************!*\
  !*** ./src/components/common/NothingFound.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _NothingFound_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./NothingFound.scss */ "./src/components/common/NothingFound.scss");









const DEFAULT_TEXT = 'Nothing found.';
const NothingFound = ({
  text = DEFAULT_TEXT,
  description,
  withSticker
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const {
    transitionClassNames
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_5__["default"])(true);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('NothingFound', transitionClassNames, description && 'with-description', withSticker && 'with-sticker')
  }, withSticker && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_6__["default"], {
    className: "sticker",
    size: 120,
    tgsUrl: _helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_2__.LOCAL_TGS_URLS.DuckNothingFound,
    previewUrl: _helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_2__.LOCAL_TGS_PREVIEW_URLS.DuckNothingFound,
    nonInteractive: true,
    noLoop: false
  }), text, description && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "description"
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_3__["default"])(lang(description), ['br'])));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(NothingFound));

/***/ },

/***/ "./src/components/common/PaymentMessageConfirmDialog.module.scss"
/*!***********************************************************************!*\
  !*** ./src/components/common/PaymentMessageConfirmDialog.module.scss ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"checkBox":"eScpikxM"});

/***/ },

/***/ "./src/components/common/PaymentMessageConfirmDialog.tsx"
/*!***************************************************************!*\
  !*** ./src/components/common/PaymentMessageConfirmDialog.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _PaymentMessageConfirmDialog_module_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./PaymentMessageConfirmDialog.module.scss */ "./src/components/common/PaymentMessageConfirmDialog.module.scss");







const PaymentMessageConfirmDialog = ({
  isOpen,
  onClose,
  userName,
  messagePriceInStars,
  messagesCount,
  shouldAutoApprove: shouldPaidMessageAutoApprove,
  setAutoApprove: setShouldPaidMessageAutoApprove,
  confirmHandler
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const confirmPaymentMessage = lang('ConfirmationModalPaymentForMessage', {
    user: userName,
    amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_1__.formatStarsAsText)(lang, messagePriceInStars),
    totalAmount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_1__.formatStarsAsText)(lang, messagePriceInStars * messagesCount),
    count: messagesCount
  }, {
    withMarkdown: true,
    withNodes: true,
    pluralValue: messagesCount
  });
  const confirmLabel = lang('PayForMessage', {
    count: messagesCount
  }, {
    withNodes: true,
    pluralValue: messagesCount
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_4__["default"], {
    title: lang('TitleConfirmPayment'),
    confirmLabel: confirmLabel,
    isOpen: isOpen,
    onClose: onClose,
    confirmHandler: confirmHandler
  }, confirmPaymentMessage, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_3__["default"], {
    className: _PaymentMessageConfirmDialog_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].checkBox,
    label: lang('DoNotAskAgain'),
    checked: shouldPaidMessageAutoApprove,
    onCheck: setShouldPaidMessageAutoApprove
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PaymentMessageConfirmDialog));

/***/ },

/***/ "./src/components/common/PrivateChatInfo.tsx"
/*!***************************************************!*\
  !*** ./src/components/common/PrivateChatInfo.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_schedulers_useIntervalForceUpdate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/schedulers/useIntervalForceUpdate */ "./src/hooks/schedulers/useIntervalForceUpdate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_RippleEffect__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/RippleEffect */ "./src/components/ui/RippleEffect.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _DotAnimation__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./DotAnimation */ "./src/components/common/DotAnimation.tsx");
/* harmony import */ var _FullNameTitle__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _TypingStatus__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./TypingStatus */ "./src/components/common/TypingStatus.tsx");

















const UPDATE_INTERVAL = 1000 * 60; // 1 min

const PrivateChatInfo = ({
  customPeer,
  typingStatus,
  avatarSize = 'medium',
  status,
  statusIcon,
  withDots,
  withMediaViewer,
  withUsername,
  withStory,
  withFullInfo,
  withUpdatingStatus,
  emojiStatusSize,
  noStatusOrTyping,
  noEmojiStatus,
  noFake,
  noVerified,
  noRtl,
  user,
  userStatus,
  self,
  isSavedMessages,
  isSavedDialog,
  areMessagesLoaded,
  adminMember,
  ripple,
  className,
  storyViewerOrigin,
  isSynced,
  onEmojiStatusClick,
  iconElement,
  rightElement
}) => {
  const {
    loadFullUser,
    openMediaViewer,
    loadMoreProfilePhotos
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const {
    id: userId
  } = user || {};
  const hasAvatarMediaViewer = withMediaViewer && !isSavedMessages;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (userId) {
      if (withFullInfo && isSynced) loadFullUser({
        userId
      });
      if (withMediaViewer) loadMoreProfilePhotos({
        peerId: userId,
        isPreload: true
      });
    }
  }, [userId, withFullInfo, withMediaViewer, isSynced]);
  (0,_hooks_schedulers_useIntervalForceUpdate__WEBPACK_IMPORTED_MODULE_7__["default"])(UPDATE_INTERVAL);
  const handleAvatarViewerOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])((e, hasMedia) => {
    if (user && hasMedia) {
      e.stopPropagation();
      openMediaViewer({
        isAvatarView: true,
        chatId: user.id,
        mediaIndex: 0,
        origin: avatarSize === 'jumbo' ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ProfileAvatar : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.MiddleHeaderAvatar
      });
    }
  });
  const mainUsername = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => user && withUsername && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMainUsername)(user), [user, withUsername]);
  if (!user && !customPeer) {
    return undefined;
  }
  function renderStatusOrTyping() {
    if (status) {
      return withDots ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DotAnimation__WEBPACK_IMPORTED_MODULE_12__["default"], {
        className: "status",
        content: status
      }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "status",
        dir: "auto"
      }, statusIcon && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_14__["default"], {
        className: "status-icon",
        name: statusIcon
      }), (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(status));
    }
    if (withUpdatingStatus && !areMessagesLoaded) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DotAnimation__WEBPACK_IMPORTED_MODULE_12__["default"], {
        className: "status",
        content: lang('Updating')
      });
    }
    if (customPeer?.subtitleKey) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "status",
        dir: "auto"
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "user-status",
        dir: "auto"
      }, lang(customPeer.subtitleKey)));
    }
    if (!user) {
      return undefined;
    }
    if (typingStatus) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TypingStatus__WEBPACK_IMPORTED_MODULE_15__["default"], {
        typingStatus: typingStatus
      });
    }
    if ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isSystemBot)(user.id)) {
      return undefined;
    }
    const translatedStatus = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserStatus)(lang, user, userStatus);
    const mainUserNameClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('handle', translatedStatus && 'withStatus');
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('status', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUserOnline)(user, userStatus, true) && 'online')
    }, mainUsername && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: mainUserNameClassName
    }, mainUsername), translatedStatus && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "user-status",
      dir: "auto"
    }, translatedStatus));
  }
  const customTitle = adminMember ? adminMember.customTitle || lang(adminMember.isOwner ? 'GroupInfo.LabelOwner' : 'GroupInfo.LabelAdmin') : undefined;
  function renderNameTitle() {
    if (customTitle) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "info-name-title"
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FullNameTitle__WEBPACK_IMPORTED_MODULE_13__["default"], {
        peer: user,
        withEmojiStatus: !noEmojiStatus,
        emojiStatusSize: emojiStatusSize,
        isSavedMessages: isSavedMessages,
        isSavedDialog: isSavedDialog,
        onEmojiStatusClick: onEmojiStatusClick
      }), customTitle && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "custom-title"
      }, customTitle));
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FullNameTitle__WEBPACK_IMPORTED_MODULE_13__["default"], {
      peer: customPeer || user,
      noFake: noFake,
      noVerified: noVerified,
      withEmojiStatus: !noEmojiStatus,
      emojiStatusSize: emojiStatusSize,
      isSavedMessages: isSavedMessages,
      isSavedDialog: isSavedDialog,
      onEmojiStatusClick: onEmojiStatusClick,
      iconElement: iconElement
    });
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('ChatInfo', className),
    dir: !noRtl && lang.isRtl ? 'rtl' : undefined
  }, isSavedDialog && self && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
    key: "saved-messages",
    size: avatarSize,
    peer: self,
    isSavedMessages: true,
    className: "saved-dialog-avatar"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
    key: user?.id,
    size: avatarSize,
    peer: customPeer || user,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(isSavedDialog && 'overlay-avatar'),
    isSavedMessages: isSavedMessages,
    isSavedDialog: isSavedDialog,
    withStory: withStory,
    storyViewerOrigin: storyViewerOrigin,
    storyViewerMode: "single-peer",
    onClick: hasAvatarMediaViewer ? handleAvatarViewerOpen : undefined
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info"
  }, renderNameTitle(), (status || !isSavedMessages && !noStatusOrTyping) && renderStatusOrTyping()), ripple && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RippleEffect__WEBPACK_IMPORTED_MODULE_10__["default"], null), rightElement);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  userId,
  forceShowSelf
}) => {
  const {
    isSynced
  } = global;
  const user = userId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, userId) : undefined;
  const userStatus = userId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUserStatus)(global, userId) : undefined;
  const isSavedMessages = !forceShowSelf && user && user.isSelf;
  const self = isSavedMessages ? user : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, global.currentUserId);
  const areMessagesLoaded = Boolean(userId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessages)(global, userId));
  return {
    user,
    userStatus,
    isSavedMessages,
    areMessagesLoaded,
    self,
    isSynced
  };
})(PrivateChatInfo)));

/***/ },

/***/ "./src/components/common/ProfileInfo.module.scss"
/*!*******************************************************!*\
  !*** ./src/components/common/ProfileInfo.module.scss ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"fallbackPhoto":"Wm9Ygb23","fallbackPhotoContents":"nflKKT3R","fallbackPhotoVisible":"tFkRrvxe","fallbackPhotoAvatar":"R7w3H5eC","photoWrapper":"GBGLnrA7","photoDashes":"uyvKpR3B","photoDash":"wB4yjvei","photoDash_current":"aZmp9FLh","photoDashCurrent":"aZmp9FLh","navigation":"ZZRcBh8v","navigation_prev":"RQITz4WQ","navigationPrev":"RQITz4WQ","navigation_next":"_0F1Txru","navigationNext":"_0F1Txru","info":"UcyW7tVh","status":"cpyXyZDl","user-status":"_HDVUj4P","userStatus":"_HDVUj4P","get-status":"Qga38M20","getStatus":"Qga38M20","topicContainer":"yzg267rr","topicTitle":"umOuiu3K","topicIcon":"ZCxp0_t4","topicIconTitle":"lkfZNWOm","topicMessagesCounter":"tLTzQ2ks"});

/***/ },

/***/ "./src/components/common/ProfileInfo.scss"
/*!************************************************!*\
  !*** ./src/components/common/ProfileInfo.scss ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/ProfileInfo.tsx"
/*!***********************************************!*\
  !*** ./src/components/common/ProfileInfo.tsx ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../global/selectors/sharedState.ts */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../util/resolveTransitionName.ts */ "./src/util/resolveTransitionName.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_schedulers_useIntervalForceUpdate__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/schedulers/useIntervalForceUpdate */ "./src/hooks/schedulers/useIntervalForceUpdate.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_usePhotosPreload__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./hooks/usePhotosPreload */ "./src/components/common/hooks/usePhotosPreload.ts");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _FullNameTitle__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _ProfilePhoto__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./ProfilePhoto */ "./src/components/common/ProfilePhoto.tsx");
/* harmony import */ var _TopicIcon__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./TopicIcon */ "./src/components/common/TopicIcon.tsx");
/* harmony import */ var _ProfileInfo_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./ProfileInfo.scss */ "./src/components/common/ProfileInfo.scss");
/* harmony import */ var _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./ProfileInfo.module.scss */ "./src/components/common/ProfileInfo.module.scss");


























const EMOJI_STATUS_SIZE = 24;
const EMOJI_TOPIC_SIZE = 120;
const LOAD_MORE_THRESHOLD = 3;
const MAX_PHOTO_DASH_COUNT = 30;
const STATUS_UPDATE_INTERVAL = 1000 * 60; // 1 min

const ProfileInfo = ({
  forceShowSelf,
  canPlayVideo,
  user,
  userStatus,
  chat,
  mediaIndex,
  avatarOwnerId,
  topic,
  messagesCount,
  animationLevel,
  emojiStatusSticker,
  emojiStatusSlug,
  profilePhotos,
  peerId,
  isForMonoforum
}) => {
  const {
    openMediaViewer,
    openPremiumModal,
    openStickerSet,
    openPrivacySettingsNoticeModal,
    loadMoreProfilePhotos,
    openUniqueGiftBySlug
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  (0,_hooks_schedulers_useIntervalForceUpdate__WEBPACK_IMPORTED_MODULE_12__["default"])(user ? STATUS_UPDATE_INTERVAL : undefined);
  const photos = profilePhotos?.photos || _util_memo__WEBPACK_IMPORTED_MODULE_9__.MEMO_EMPTY_ARRAY;
  const prevMediaIndex = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__["default"])(mediaIndex);
  const prevAvatarOwnerId = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__["default"])(avatarOwnerId);
  const [hasSlideAnimation, setHasSlideAnimation] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [currentPhotoIndex, setCurrentPhotoIndex] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const isFirst = photos.length <= 1 || currentPhotoIndex === 0;
  const isLast = photos.length <= 1 || currentPhotoIndex === photos.length - 1;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (photos.length - currentPhotoIndex <= LOAD_MORE_THRESHOLD) {
      loadMoreProfilePhotos({
        peerId
      });
    }
  }, [currentPhotoIndex, peerId, photos.length]);

  // Set the current avatar photo to the last selected photo in Media Viewer after it is closed
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (prevAvatarOwnerId && prevMediaIndex !== undefined && mediaIndex === undefined) {
      setHasSlideAnimation(false);
      setCurrentPhotoIndex(prevMediaIndex);
    }
  }, [mediaIndex, prevMediaIndex, prevAvatarOwnerId]);

  // Deleting the last profile photo may result in an error
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (currentPhotoIndex > photos.length) {
      setHasSlideAnimation(false);
      setCurrentPhotoIndex(Math.max(0, photos.length - 1));
    }
  }, [currentPhotoIndex, photos.length]);
  (0,_hooks_usePhotosPreload__WEBPACK_IMPORTED_MODULE_17__["default"])(photos, currentPhotoIndex);
  const handleProfilePhotoClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openMediaViewer({
      isAvatarView: true,
      chatId: peerId,
      mediaIndex: currentPhotoIndex,
      origin: forceShowSelf ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.SettingsAvatar : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ProfileAvatar
    });
  });
  const handleStatusClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (emojiStatusSlug) {
      openUniqueGiftBySlug({
        slug: emojiStatusSlug
      });
      return;
    }
    if (!peerId) {
      openStickerSet({
        stickerSetInfo: emojiStatusSticker.stickerSetInfo
      });
      return;
    }
    openPremiumModal({
      fromUserId: peerId
    });
  });
  const selectPreviousMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (isFirst) {
      return;
    }
    setHasSlideAnimation(true);
    setCurrentPhotoIndex(currentPhotoIndex - 1);
  });
  const selectNextMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (isLast) {
      return;
    }
    setHasSlideAnimation(true);
    setCurrentPhotoIndex(currentPhotoIndex + 1);
  });
  const handleOpenGetReadDateModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openPrivacySettingsNoticeModal({
      chatId: chat.id,
      isReadDate: false
    });
  });
  function handleSelectFallbackPhoto() {
    if (!isFirst) return;
    setHasSlideAnimation(true);
    setCurrentPhotoIndex(photos.length - 1);
  }

  // Swipe gestures
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const element = document.querySelector(`.${_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].photoWrapper}`);
    if (!element) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_8__.captureEvents)(element, {
      selectorToPreventScroll: '.Profile, .settings-content',
      onSwipe: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV ? (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_8__.SwipeDirection.Right) {
          selectPreviousMedia();
          return true;
        } else if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_8__.SwipeDirection.Left) {
          selectNextMedia();
          return true;
        }
        return false;
      } : undefined
    });
  }, [selectNextMedia, selectPreviousMedia]);
  if (!user && !chat) {
    return undefined;
  }
  function renderTopic() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].topicContainer
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TopicIcon__WEBPACK_IMPORTED_MODULE_22__["default"], {
      topic: topic,
      size: EMOJI_TOPIC_SIZE,
      className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].topicIcon,
      letterClassName: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].topicIconTitle,
      noLoopLimit: true
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
      className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].topicTitle,
      dir: oldLang.isRtl ? 'rtl' : undefined
    }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(topic.title)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].topicMessagesCounter
    }, messagesCount ? oldLang('Chat.Title.Topic', messagesCount, 'i') : oldLang('lng_forum_no_messages')));
  }
  function renderPhotoTabs() {
    const totalPhotosLength = Math.max(photos.length, profilePhotos?.count || 0);
    if (!photos || totalPhotosLength <= 1) {
      return undefined;
    }
    const enumerator = Array.from({
      length: Math.min(totalPhotosLength, MAX_PHOTO_DASH_COUNT)
    });
    const activeDashIndex = currentPhotoIndex >= MAX_PHOTO_DASH_COUNT ? MAX_PHOTO_DASH_COUNT - 1 : currentPhotoIndex;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].photoDashes
    }, enumerator.map((_, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].photoDash, i === activeDashIndex && _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].photoDash_current)
    })));
  }
  function renderPhoto(isActive) {
    const photo = photos.length > 0 ? photos[currentPhotoIndex] : undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ProfilePhoto__WEBPACK_IMPORTED_MODULE_21__["default"], {
      key: currentPhotoIndex,
      user: user,
      chat: chat,
      photo: photo,
      canPlayVideo: Boolean(isActive && canPlayVideo),
      onClick: handleProfilePhotoClick
    });
  }
  function renderStatus() {
    const isAnonymousForwards = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isAnonymousForwardsChat)(peerId);
    const isSystemBotChat = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isSystemBot)(peerId);
    if (isAnonymousForwards || isSystemBotChat) return undefined;
    if (isForMonoforum) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].status, 'status'),
        dir: "auto"
      }, lang('MonoforumStatus'));
    }
    if (user) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].status, 'status', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUserOnline)(user, userStatus) && 'online')
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].userStatus,
        dir: "auto"
      }, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserStatus)(oldLang, user, userStatus)), userStatus?.isReadDateRestrictedByMe && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].getStatus,
        onClick: handleOpenGetReadDateModal
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('StatusHiddenShow'))));
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].status, 'status'),
      dir: "auto"
    }, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat) ? oldLang('Subscribers', chat.membersCount ?? 0, 'i') : oldLang('Members', chat.membersCount ?? 0, 'i'));
  }
  if (topic) {
    return renderTopic();
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('ProfileInfo'),
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].photoWrapper
  }, renderPhotoTabs(), !forceShowSelf && profilePhotos?.personalPhoto && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].fallbackPhoto, isFirst && _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].fallbackPhotoVisible)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].fallbackPhotoContents
  }, oldLang(profilePhotos.personalPhoto.isVideo ? 'UserInfo.CustomVideo' : 'UserInfo.CustomPhoto'))), forceShowSelf && profilePhotos?.fallbackPhoto && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].fallbackPhoto, (isFirst || isLast) && _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].fallbackPhotoVisible)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].fallbackPhotoContents,
    onClick: handleSelectFallbackPhoto
  }, !isLast && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Avatar__WEBPACK_IMPORTED_MODULE_19__["default"], {
    photo: profilePhotos.fallbackPhoto,
    className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].fallbackPhotoAvatar,
    size: "mini"
  }), oldLang(profilePhotos.fallbackPhoto.isVideo ? 'UserInfo.PublicVideo' : 'UserInfo.PublicPhoto'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_18__["default"], {
    activeKey: currentPhotoIndex,
    name: (0,_util_resolveTransitionName_ts__WEBPACK_IMPORTED_MODULE_10__.resolveTransitionName)('slide', animationLevel, !hasSlideAnimation, oldLang.isRtl)
  }, renderPhoto), !isFirst && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    type: "button",
    dir: oldLang.isRtl ? 'rtl' : undefined,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].navigation, _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].navigation_prev),
    "aria-label": oldLang('AccDescrPrevious'),
    onClick: selectPreviousMedia
  }), !isLast && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    type: "button",
    dir: oldLang.isRtl ? 'rtl' : undefined,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].navigation, _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].navigation_next),
    "aria-label": oldLang('Next'),
    onClick: selectNextMedia
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_24__["default"].info,
    dir: oldLang.isRtl ? 'rtl' : 'auto'
  }, (user || chat) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FullNameTitle__WEBPACK_IMPORTED_MODULE_20__["default"], {
    peer: user || chat,
    withEmojiStatus: true,
    emojiStatusSize: EMOJI_STATUS_SIZE,
    onEmojiStatusClick: handleStatusClick,
    noLoopLimit: true,
    canCopyTitle: true
  }), renderStatus()));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId
}) => {
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, peerId);
  const userStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUserStatus)(global, peerId);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, peerId);
  const profilePhotos = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerPhotos)(global, peerId);
  const {
    mediaIndex,
    chatId: avatarOwnerId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global).mediaViewer;
  const isForum = chat?.isForum;
  const {
    threadId: currentTopicId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global) || {};
  const topic = isForum && currentTopicId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTopic)(global, peerId, currentTopicId) : undefined;
  const {
    animationLevel
  } = (0,_global_selectors_sharedState_ts__WEBPACK_IMPORTED_MODULE_5__.selectSharedSettings)(global);
  const emojiStatus = (user || chat)?.emojiStatus;
  const emojiStatusSticker = emojiStatus ? global.customEmojis.byId[emojiStatus.documentId] : undefined;
  const emojiStatusSlug = emojiStatus?.type === 'collectible' ? emojiStatus.slug : undefined;
  return {
    user,
    userStatus,
    chat,
    mediaIndex,
    avatarOwnerId,
    animationLevel,
    emojiStatusSticker,
    emojiStatusSlug,
    profilePhotos,
    ...(topic && {
      topic,
      messagesCount: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectThreadMessagesCount)(global, peerId, currentTopicId)
    })
  };
})(ProfileInfo)));

/***/ },

/***/ "./src/components/common/ProfilePhoto.scss"
/*!*************************************************!*\
  !*** ./src/components/common/ProfilePhoto.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/ProfilePhoto.tsx"
/*!************************************************!*\
  !*** ./src/components/common/ProfilePhoto.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _helpers_peerColor__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./helpers/peerColor */ "./src/components/common/helpers/peerColor.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCanvasBlur__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useCanvasBlur */ "./src/hooks/useCanvasBlur.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useMediaTransitionDeprecated */ "./src/hooks/useMediaTransitionDeprecated.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../ui/OptimizedVideo */ "./src/components/ui/OptimizedVideo.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ProfilePhoto_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ProfilePhoto.scss */ "./src/components/common/ProfilePhoto.scss");



















const ProfilePhoto = ({
  chat,
  user,
  photo,
  isSavedMessages,
  isSavedDialog,
  canPlayVideo,
  onClick
}) => {
  const videoRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isDeleted = user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.isDeletedUser)(user);
  const isRepliesChat = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.isChatWithRepliesBot)(chat.id);
  const isAnonymousForwards = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.isAnonymousForwardsChat)(chat.id);
  const peer = user || chat;
  const canHaveMedia = peer && !isSavedMessages && !isDeleted && !isRepliesChat && !isAnonymousForwards;
  const {
    isVideo
  } = photo || {};
  const avatarHash = (!photo || photo.id === peer.avatarPhotoId) && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getChatAvatarHash)(peer, 'normal');
  const previewHash = canHaveMedia && photo && !avatarHash && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getPhotoMediaHash)(photo, 'pictogram');
  const previewBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__["default"])(previewHash || avatarHash);
  const photoHash = canHaveMedia && photo && !isVideo && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getProfilePhotoMediaHash)(photo);
  const photoBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__["default"])(photoHash);
  const videoHash = canHaveMedia && photo && isVideo && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getVideoProfilePhotoMediaHash)(photo);
  const videoBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__["default"])(videoHash);
  const fullMediaData = videoBlobUrl || photoBlobUrl;
  const [isVideoReady, markVideoReady] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const isFullMediaReady = Boolean(fullMediaData && (!isVideo || isVideoReady));
  const transitionClassNames = (0,_hooks_useMediaTransitionDeprecated__WEBPACK_IMPORTED_MODULE_12__["default"])(isFullMediaReady);
  const isBlurredThumb = canHaveMedia && !isFullMediaReady && !previewBlobUrl && photo?.thumbnail?.dataUri;
  const blurredThumbCanvasRef = (0,_hooks_useCanvasBlur__WEBPACK_IMPORTED_MODULE_9__["default"])(photo?.thumbnail?.dataUri, !isBlurredThumb, isMobile && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_CANVAS_FILTER_SUPPORTED);
  const hasMedia = photo || previewBlobUrl || isBlurredThumb;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (videoRef.current && !canPlayVideo) {
      videoRef.current.currentTime = 0;
    }
  }, [canPlayVideo]);
  const specialIcon = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isSavedMessages) {
      return isSavedDialog ? 'my-notes' : 'avatar-saved-messages';
    }
    if (isDeleted) {
      return 'avatar-deleted-account';
    }
    if (isRepliesChat) {
      return 'reply-filled';
    }
    if (isAnonymousForwards) {
      return 'author-hidden';
    }
    return undefined;
  }, [isAnonymousForwards, isDeleted, isSavedDialog, isRepliesChat, isSavedMessages]);
  let content;
  if (specialIcon) {
    content = /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
      name: specialIcon,
      role: "img"
    });
  } else if (hasMedia) {
    content = /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, isBlurredThumb ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
      ref: blurredThumbCanvasRef,
      className: "thumb"
    }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      src: previewBlobUrl,
      draggable: false,
      className: "thumb",
      alt: ""
    }), photo && (isVideo ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_14__["default"], {
      canPlay: canPlayVideo,
      ref: videoRef,
      src: fullMediaData,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('avatar-media', transitionClassNames),
      muted: true,
      disablePictureInPicture: true,
      loop: true,
      playsInline: true,
      onReady: markVideoReady
    }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      src: fullMediaData,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('avatar-media', transitionClassNames),
      alt: ""
    })));
  } else if (user) {
    const userFullName = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getUserFullName)(user);
    content = userFullName ? (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_5__.getFirstLetters)(userFullName, 2) : undefined;
  } else if (chat) {
    const title = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getChatTitle)(lang, chat);
    content = title && (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_5__.getFirstLetters)(title, (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_4__.isUserId)(chat.id) ? 2 : 1);
  } else {
    content = /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "spinner-wrapper"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_15__["default"], {
      color: "white"
    }));
  }
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('ProfilePhoto', (0,_helpers_peerColor__WEBPACK_IMPORTED_MODULE_6__.getPeerColorClass)(peer), isSavedMessages && 'saved-messages', isAnonymousForwards && 'anonymous-forwards', isDeleted && 'deleted-account', isRepliesChat && 'replies-bot-account', !isSavedMessages && !hasMedia && 'no-photo');
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: fullClassName,
    onClick: hasMedia ? onClick : undefined
  }, typeof content === 'string' ? (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(content, ['hq_emoji']) : content);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ProfilePhoto));

/***/ },

/***/ "./src/components/common/SensitiveContentConfirmModal.module.scss"
/*!************************************************************************!*\
  !*** ./src/components/common/SensitiveContentConfirmModal.module.scss ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"checkBox":"mYXi2mIC"});

/***/ },

/***/ "./src/components/common/SensitiveContentConfirmModal.tsx"
/*!****************************************************************!*\
  !*** ./src/components/common/SensitiveContentConfirmModal.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _SensitiveContentConfirmModal_module_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./SensitiveContentConfirmModal.module.scss */ "./src/components/common/SensitiveContentConfirmModal.module.scss");








const SensitiveContentConfirmModal = ({
  isOpen,
  onClose,
  shouldAlwaysShow,
  onAlwaysShowChanged,
  confirmHandler,
  verifyAgeMin
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_5__["default"], {
    title: lang('TitleSensitiveModal', {
      years: verifyAgeMin
    }),
    confirmLabel: lang('ButtonSensitiveView'),
    isOpen: isOpen,
    onClose: onClose,
    confirmHandler: confirmHandler
  }, lang('TextSensitiveModal'), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_4__["default"], {
    className: _SensitiveContentConfirmModal_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].checkBox,
    label: lang('ButtonSensitiveAlways', {
      years: verifyAgeMin
    }),
    checked: shouldAlwaysShow,
    onCheck: onAlwaysShowChanged
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const appConfig = global.appConfig;
  const verifyAgeMin = appConfig?.verifyAgeMin;
  return {
    verifyAgeMin: verifyAgeMin || _config__WEBPACK_IMPORTED_MODULE_2__.VERIFY_AGE_MIN_DEFAULT
  };
})(SensitiveContentConfirmModal)));

/***/ },

/***/ "./src/components/common/TopicChip.module.scss"
/*!*****************************************************!*\
  !*** ./src/components/common/TopicChip.module.scss ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"JldIqqof"});

/***/ },

/***/ "./src/components/common/TopicChip.tsx"
/*!*********************************************!*\
  !*** ./src/components/common/TopicChip.tsx ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_forumColors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/forumColors */ "./src/util/forumColors.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _TopicIcon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./TopicIcon */ "./src/components/common/TopicIcon.tsx");
/* harmony import */ var _TopicChip_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./TopicChip.module.scss */ "./src/components/common/TopicChip.module.scss");
/* harmony import */ var _assets_blank_png__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../assets/blank.png */ "./src/assets/blank.png");











const TOPIC_ICON_SIZE = 1.125 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.REM;
const TopicChip = ({
  topic,
  className,
  onClick
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_TopicChip_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].root, className),
    style: `--topic-button-accent-color: var(${(0,_util_forumColors__WEBPACK_IMPORTED_MODULE_2__.getTopicColorCssVariable)(topic?.iconColor)})`,
    onClick: onClick
  }, topic ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TopicIcon__WEBPACK_IMPORTED_MODULE_7__["default"], {
    topic: topic,
    size: TOPIC_ICON_SIZE
  }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: _assets_blank_png__WEBPACK_IMPORTED_MODULE_9__,
    alt: "",
    draggable: false
  }), topic?.title ? (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__["default"])(topic.title) : lang('Loading'), topic?.isClosed && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: "lock"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: "next"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(TopicChip));

/***/ },

/***/ "./src/components/common/TopicIcon.tsx"
/*!*********************************************!*\
  !*** ./src/components/common/TopicIcon.tsx ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _CustomEmoji__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _TopicDefaultIcon__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./TopicDefaultIcon */ "./src/components/common/TopicDefaultIcon.tsx");




const LOOP_LIMIT = 2;
const DEFAULT_ICON_ID = '0';
const TopicIcon = ({
  topic,
  className,
  letterClassName,
  size,
  noLoopLimit,
  observeIntersection,
  onClick
}) => {
  if (topic.iconEmojiId && topic.iconEmojiId !== DEFAULT_ICON_ID) {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_CustomEmoji__WEBPACK_IMPORTED_MODULE_1__["default"], {
      documentId: topic.iconEmojiId,
      className: className,
      size: size,
      observeIntersectionForPlaying: observeIntersection,
      loopLimit: !noLoopLimit ? LOOP_LIMIT : undefined,
      onClick: onClick
    });
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TopicDefaultIcon__WEBPACK_IMPORTED_MODULE_2__["default"], {
    iconColor: topic.iconColor,
    title: topic.title,
    topicId: topic.id,
    className: className,
    letterClassName: letterClassName,
    onClick: onClick
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(TopicIcon));

/***/ },

/***/ "./src/components/common/TypingStatus.scss"
/*!*************************************************!*\
  !*** ./src/components/common/TypingStatus.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/TypingStatus.tsx"
/*!************************************************!*\
  !*** ./src/components/common/TypingStatus.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _DotAnimation__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./DotAnimation */ "./src/components/common/DotAnimation.tsx");
/* harmony import */ var _TypingStatus_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./TypingStatus.scss */ "./src/components/common/TypingStatus.scss");









const TypingStatus = ({
  typingStatus,
  typingUser
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const typingUserName = typingUser && !typingUser.isSelf && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(typingUser);
  const content = lang(typingStatus.action)
  // Fix for translation "{user} is typing"
  .replace('{user}', '').replace('{emoji}', typingStatus.emoji || '').trim();
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "typing-status",
    dir: lang.isRtl ? 'rtl' : 'auto'
  }, typingUserName && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "sender-name",
    dir: "auto"
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__["default"])(typingUserName)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DotAnimation__WEBPACK_IMPORTED_MODULE_6__["default"], {
    content: content
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  typingStatus
}) => {
  if (!typingStatus.userId) {
    return {};
  }
  const typingUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, typingStatus.userId);
  return {
    typingUser
  };
})(TypingStatus)));

/***/ },

/***/ "./src/components/common/WebLink.scss"
/*!********************************************!*\
  !*** ./src/components/common/WebLink.scss ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/WebLink.tsx"
/*!*******************************************!*\
  !*** ./src/components/common/WebLink.tsx ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_trimText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/trimText */ "./src/util/trimText.ts");
/* harmony import */ var _helpers_renderMessageText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./helpers/renderMessageText */ "./src/components/common/helpers/renderMessageText.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _Media__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./Media */ "./src/components/common/Media.tsx");
/* harmony import */ var _SafeLink__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _WebLink_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./WebLink.scss */ "./src/components/common/WebLink.scss");
















const MAX_TEXT_LENGTH = 170; // symbols

const WebLink = ({
  message,
  webPage,
  senderTitle,
  isProtected,
  observeIntersection,
  onMessageClick
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  let linkData = webPage;
  if (!linkData) {
    const link = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getFirstLinkInMessage)(message);
    if (link) {
      const {
        url,
        domain
      } = link;
      linkData = {
        siteName: domain.replace(/^www./, ''),
        url: url.includes('://') ? url : url.includes('@') ? `mailto:${url}` : `http://${url}`,
        formattedDescription: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageText)(message)?.text !== url ? (0,_helpers_renderMessageText__WEBPACK_IMPORTED_MODULE_7__.renderMessageSummary)(lang, message, undefined, undefined, MAX_TEXT_LENGTH) : undefined
      };
    }
  }
  const handleMessageClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    onMessageClick(message);
  });
  if (linkData?.webpageType !== 'full') {
    return undefined;
  }
  const {
    siteName,
    url,
    displayUrl,
    title,
    description,
    formattedDescription,
    photo,
    video
  } = linkData;
  const truncatedDescription = !senderTitle && description && (0,_util_trimText__WEBPACK_IMPORTED_MODULE_6__["default"])(description, MAX_TEXT_LENGTH);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('WebLink scroll-item', !photo && !video && 'without-media');
  const safeLinkContent = url.replace('mailto:', '') || displayUrl;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: className,
    "data-initial": (siteName || displayUrl)[0],
    dir: lang.isRtl ? 'rtl' : undefined
  }, photo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Media__WEBPACK_IMPORTED_MODULE_12__["default"], {
    message: message,
    isProtected: isProtected,
    observeIntersection: observeIntersection
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "content"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isRtl: lang.isRtl,
    className: "site-title",
    onClick: handleMessageClick
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_8__["default"])(title || siteName || displayUrl)), (truncatedDescription || formattedDescription) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isRtl: lang.isRtl,
    className: "site-description",
    onClick: handleMessageClick
  }, formattedDescription || truncatedDescription && (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_8__["default"])(truncatedDescription)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SafeLink__WEBPACK_IMPORTED_MODULE_13__["default"], {
    url: url,
    className: "site-name",
    text: safeLinkContent,
    isRtl: lang.isRtl
  }), senderTitle && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "sender-name"
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_8__["default"])(senderTitle))), senderTitle && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-date"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Link__WEBPACK_IMPORTED_MODULE_11__["default"], {
    className: "date",
    onClick: handleMessageClick,
    isRtl: lang.isRtl
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatPastTimeShort)(lang, message.date * 1000))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  message
}) => {
  const webPage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectWebPageFromMessage)(global, message);
  return {
    webPage
  };
})(WebLink)));

/***/ },

/***/ "./src/components/common/embedded/EmbeddedMessage.scss"
/*!*************************************************************!*\
  !*** ./src/components/common/embedded/EmbeddedMessage.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/common/embedded/EmbeddedMessage.tsx"
/*!************************************************************!*\
  !*** ./src/components/common/embedded/EmbeddedMessage.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ClosableEmbeddedMessage: () => (/* binding */ ClosableEmbeddedMessage),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_messageSummary__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/messageSummary */ "./src/global/helpers/messageSummary.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_hoc_freezeWhenClosed__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/hoc/freezeWhenClosed */ "./src/util/hoc/freezeWhenClosed.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _middle_message_hooks_useMessageTranslation__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../middle/message/hooks/useMessageTranslation */ "./src/components/middle/message/hooks/useMessageTranslation.ts");
/* harmony import */ var _ui_RippleEffect__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/RippleEffect */ "./src/components/ui/RippleEffect.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _MediaSpoiler__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _MessageSummary__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../MessageSummary */ "./src/components/common/MessageSummary.tsx");
/* harmony import */ var _PeerColorWrapper__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _EmbeddedMessage_scss__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./EmbeddedMessage.scss */ "./src/components/common/embedded/EmbeddedMessage.scss");




























const NBSP = '\u00A0';
const EMOJI_SIZE = 17;
const EmbeddedMessage = ({
  className,
  message,
  replyInfo,
  suggestedPostInfo,
  sender,
  senderChat,
  forwardSender,
  composerForwardSenders,
  title,
  customText,
  isProtected,
  isInComposer,
  noUserColors,
  chatTranslations,
  requestedChatTranslationLanguage,
  isMediaNsfw,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  onClick
}) => {
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_16__.useIsIntersecting)(ref, observeIntersectionForLoading);
  const containedMedia = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const media = replyInfo?.type === 'message' && replyInfo.replyMedia || message?.content;
    if (!media) {
      return undefined;
    }
    return {
      content: media
    };
  }, [message, replyInfo]);
  const gif = containedMedia?.content?.video?.isGif ? containedMedia.content.video : undefined;
  const isVideoThumbnail = Boolean(gif && !gif.previewPhotoSizes?.length);
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_13__["default"])(containedMedia, isVideoThumbnail ? 'full' : 'pictogram');
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_18__["default"])(mediaHash, !isIntersecting);
  const mediaThumbnail = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_14__["default"])(containedMedia);
  const isRoundVideo = Boolean(containedMedia && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageRoundVideo)(containedMedia));
  const isSpoiler = Boolean(containedMedia && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageIsSpoiler)(containedMedia)) || isMediaNsfw;
  const isQuote = Boolean(replyInfo?.type === 'message' && replyInfo.isQuote);
  const replyForwardInfo = replyInfo?.type === 'message' ? replyInfo.replyFrom : undefined;
  const shouldTranslate = message && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isMessageTranslatable)(message);
  const {
    translatedText
  } = (0,_middle_message_hooks_useMessageTranslation__WEBPACK_IMPORTED_MODULE_20__["default"])(chatTranslations, message?.chatId, shouldTranslate ? message?.id : undefined, requestedChatTranslationLanguage);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_19__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_17__["default"])();
  const senderTitle = sender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(oldLang, sender) : replyForwardInfo?.hiddenUserName || message?.forwardInfo?.hiddenUserName;
  const forwardSendersTitle = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!composerForwardSenders) return undefined;
    const peerTitles = composerForwardSenders.map(peer => (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, peer)).filter(Boolean);
    return lang.conjunction(peerTitles);
  }, [composerForwardSenders, lang]);
  const senderChatTitle = senderChat ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(oldLang, senderChat) : undefined;
  const forwardSenderTitle = forwardSender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(oldLang, forwardSender) : message?.forwardInfo?.hiddenUserName;
  const areSendersSame = sender && sender.id === forwardSender?.id;
  const {
    handleClick,
    handleMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_15__.useFastClick)(onClick);
  function renderTextContent() {
    const isFree = !suggestedPostInfo?.price?.amount;
    if (suggestedPostInfo) {
      if (isFree && !suggestedPostInfo.scheduleDate) {
        return lang('ComposerEmbeddedMessageSuggestedPostDescription');
      }
      const priceText = suggestedPostInfo.price ? suggestedPostInfo.price.currency === _config__WEBPACK_IMPORTED_MODULE_1__.TON_CURRENCY_CODE ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_9__.formatTonAsIcon)(lang, suggestedPostInfo.price.amount, {
        className: 'suggested-price-ton-icon',
        shouldConvertFromNanos: true
      }) : (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_9__.formatStarsAsIcon)(lang, suggestedPostInfo.price.amount, {
        className: 'suggested-price-star-icon'
      }) : '';
      const scheduleText = suggestedPostInfo.scheduleDate ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatScheduledDateTime)(suggestedPostInfo.scheduleDate, lang, oldLang) : '';
      if (priceText && !scheduleText) {
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
          className: "suggested-post-price-wrapper"
        }, lang('TitleSuggestedPostAmountForAnyTime', {
          amount: priceText
        }, {
          withNodes: true,
          withMarkdown: true
        }));
      }
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "suggested-post-price-wrapper"
      }, priceText, scheduleText ? ` • ${scheduleText}` : '');
    }
    if (replyInfo?.type === 'message' && replyInfo.quoteText) {
      return (0,_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_12__.renderTextWithEntities)({
        text: replyInfo.quoteText.text,
        entities: replyInfo.quoteText.entities,
        asPreview: true,
        emojiSize: EMOJI_SIZE
      });
    }
    if (!message) {
      return customText || renderMediaContentType(containedMedia) || NBSP;
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageSummary__WEBPACK_IMPORTED_MODULE_24__["default"], {
      message: message,
      noEmoji: Boolean(mediaThumbnail),
      translatedText: translatedText,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      emojiSize: EMOJI_SIZE
    });
  }
  function renderMediaContentType(media) {
    if (!media || media.content.text) return NBSP;
    const description = (0,_global_helpers_messageSummary__WEBPACK_IMPORTED_MODULE_3__.getMediaContentTypeDescription)(oldLang, media.content, {});
    if (!description || description === _config__WEBPACK_IMPORTED_MODULE_1__.CONTENT_NOT_SUPPORTED) return NBSP;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(description));
  }
  function checkShouldRenderSenderTitle() {
    if (!senderChat) return true;
    if ((0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_7__.isUserId)(senderChat?.id)) return true;
    if (senderChat.id === sender?.id) return false;
    return true;
  }
  function renderSender() {
    if (title) {
      return (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(title);
    }
    if (suggestedPostInfo && replyInfo) {
      return lang('TitleSuggestedChanges');
    }
    if (suggestedPostInfo) {
      return lang('ComposerEmbeddedMessageSuggestedPostTitle');
    }
    if (!senderTitle && !forwardSendersTitle) {
      return NBSP;
    }
    let icon;
    if (senderChat) {
      if ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatChannel)(senderChat)) {
        icon = 'channel-filled';
      }
      if ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatGroup)(senderChat)) {
        icon = 'group-filled';
      }
    }
    const isReplyToQuote = isInComposer && Boolean(replyInfo && 'quoteText' in replyInfo && replyInfo?.quoteText);
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "embedded-sender-wrapper"
    }, checkShouldRenderSenderTitle() && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "embedded-sender"
    }, !composerForwardSenders && senderTitle && (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(isReplyToQuote ? oldLang('ReplyToQuote', senderTitle) : senderTitle), forwardSendersTitle && (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('ComposerTitleForwardFrom', {
      users: forwardSendersTitle
    }, {
      withNodes: true,
      withMarkdown: true
    }))), icon && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_22__["default"], {
      name: icon,
      className: "embedded-chat-icon"
    }), icon && senderChatTitle && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "embedded-sender-chat"
    }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(senderChatTitle)));
  }
  function renderForwardSender() {
    return forwardSenderTitle && !areSendersSame && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "embedded-forward-sender-wrapper"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_22__["default"], {
      name: forwardSender ? 'share-filled' : 'forward',
      className: "embedded-origin-icon"
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "forward-sender-title"
    }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(forwardSenderTitle)));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_25__["default"], {
    peer: sender,
    emojiIconClassName: "EmbeddedMessage--background-icons",
    ref: ref,
    shouldReset: true,
    noUserColors: noUserColors,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('EmbeddedMessage', className, isQuote && 'is-quote', mediaThumbnail && 'with-thumb', 'no-selection', composerForwardSenders && 'is-input-forward', suggestedPostInfo && 'is-suggested-post'),
    dir: lang.isRtl ? 'rtl' : undefined,
    onClick: handleClick,
    onMouseDown: handleMouseDown
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "hover-effect"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RippleEffect__WEBPACK_IMPORTED_MODULE_21__["default"], null), mediaThumbnail && renderPictogram(mediaThumbnail, mediaBlobUrl, isVideoThumbnail, isRoundVideo, isProtected, isSpoiler), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-text"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('embedded-text-wrapper', isQuote && 'multiline')
  }, renderTextContent()), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-title"
  }, renderSender(), renderForwardSender())));
};
function renderPictogram(thumbDataUri, blobUrl, isFullVideo, isRoundVideo, isProtected, isSpoiler) {
  const {
    width,
    height
  } = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_10__.getPictogramDimensions)();
  const srcUrl = blobUrl || thumbDataUri;
  const shouldRenderVideo = isFullVideo && blobUrl;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('embedded-thumb', isRoundVideo && 'round')
  }, !isSpoiler && !shouldRenderVideo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: srcUrl,
    width: width,
    height: height,
    alt: "",
    className: "pictogram",
    draggable: false
  }), !isSpoiler && shouldRenderVideo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("video", {
    src: blobUrl,
    width: width,
    height: height,
    playsInline: true,
    disablePictureInPicture: true,
    className: "pictogram"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MediaSpoiler__WEBPACK_IMPORTED_MODULE_23__["default"], {
    thumbDataUri: shouldRenderVideo ? thumbDataUri : srcUrl,
    isVisible: Boolean(isSpoiler),
    width: width,
    height: height
  }), isProtected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  }));
}
const ClosableEmbeddedMessage = (0,_util_hoc_freezeWhenClosed__WEBPACK_IMPORTED_MODULE_8__["default"])(EmbeddedMessage);
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmbeddedMessage);

/***/ },

/***/ "./src/components/common/embedded/EmbeddedStory.tsx"
/*!**********************************************************!*\
  !*** ./src/components/common/embedded/EmbeddedStory.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFastClick__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useFastClick */ "./src/hooks/useFastClick.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _PeerColorWrapper__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _EmbeddedMessage_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./EmbeddedMessage.scss */ "./src/components/common/embedded/EmbeddedMessage.scss");
















const NBSP = '\u00A0';
const EmbeddedStory = ({
  story,
  sender,
  noUserColors,
  isProtected,
  observeIntersectionForLoading,
  onClick
}) => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_8__.useIsIntersecting)(ref, observeIntersectionForLoading);
  const isFullStory = story && 'content' in story;
  const isExpiredStory = story && 'isDeleted' in story;
  const isVideoStory = isFullStory && Boolean(story.content.video);
  const title = isFullStory ? 'Story' : isExpiredStory ? 'ExpiredStory' : 'Loading';
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__["default"])(isFullStory && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryMediaHash)(story, 'pictogram'), !isIntersecting);
  const mediaThumbnail = isVideoStory ? story.content.video.thumbnail?.dataUri : undefined;
  const pictogramUrl = mediaBlobUrl || mediaThumbnail;
  const senderTitle = sender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, sender) : undefined;
  const handleFastClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (story && !isExpiredStory) {
      onClick();
    } else {
      showNotification({
        message: lang('StoryNotFound')
      });
    }
  });
  const {
    handleClick,
    handleMouseDown
  } = (0,_hooks_useFastClick__WEBPACK_IMPORTED_MODULE_7__.useFastClick)(handleFastClick);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_13__["default"], {
    ref: ref,
    peerColor: sender?.color,
    noUserColors: noUserColors,
    shouldReset: true,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('EmbeddedMessage', pictogramUrl && 'with-thumb'),
    onClick: handleClick,
    onMouseDown: handleMouseDown
  }, pictogramUrl && renderPictogram(pictogramUrl, isProtected), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-text with-message-color"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "embedded-text-wrapper"
  }, isExpiredStory && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "story-expired",
    className: "embedded-origin-icon"
  }), isFullStory && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "story-reply",
    className: "embedded-origin-icon"
  }), lang(title)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-title"
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(senderTitle || NBSP))));
};
function renderPictogram(srcUrl, isProtected) {
  const {
    width,
    height
  } = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.getPictogramDimensions)();
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "embedded-thumb"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: srcUrl,
    width: width,
    height: height,
    alt: "",
    className: "pictogram",
    draggable: false
  }), isProtected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmbeddedStory);

/***/ },

/***/ "./src/components/common/helpers/boostInfo.ts"
/*!****************************************************!*\
  !*** ./src/components/common/helpers/boostInfo.ts ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getBoostProgressInfo: () => (/* binding */ getBoostProgressInfo)
/* harmony export */ });
function getBoostProgressInfo(boostInfo, freezeOnLevelUp) {
  const {
    level,
    boosts,
    currentLevelBoosts,
    nextLevelBoosts,
    hasMyBoost,
    prepaidGiveaways
  } = boostInfo;
  const isJustUpgraded = freezeOnLevelUp && boosts === currentLevelBoosts && hasMyBoost;
  const currentLevel = isJustUpgraded ? level - 1 : level;
  const hasNextLevel = Boolean(nextLevelBoosts);
  const levelProgress = !nextLevelBoosts || isJustUpgraded ? 1 : (boosts - currentLevelBoosts) / (nextLevelBoosts - currentLevelBoosts);
  const remainingBoosts = nextLevelBoosts ? nextLevelBoosts - boosts : 0;
  const isMaxLevel = nextLevelBoosts === undefined;
  return {
    currentLevel,
    hasNextLevel,
    boosts,
    levelProgress,
    remainingBoosts,
    isMaxLevel,
    prepaidGiveaways
  };
}

/***/ },

/***/ "./src/components/common/helpers/formatUsername.ts"
/*!*********************************************************!*\
  !*** ./src/components/common/helpers/formatUsername.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ formatUsername)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");

function formatUsername(username, asAbsoluteLink) {
  return asAbsoluteLink ? `${_config__WEBPACK_IMPORTED_MODULE_0__.TME_LINK_PREFIX}${username}` : `@${username}`;
}

/***/ },

/***/ "./src/components/common/helpers/waveform.ts"
/*!***************************************************!*\
  !*** ./src/components/common/helpers/waveform.ts ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MAX_EMPTY_WAVEFORM_POINTS: () => (/* binding */ MAX_EMPTY_WAVEFORM_POINTS),
/* harmony export */   renderWaveform: () => (/* binding */ renderWaveform)
/* harmony export */ });
const MAX_EMPTY_WAVEFORM_POINTS = 30;
const SPIKE_WIDTH = 2;
const SPIKE_STEP = 4;
const SPIKE_RADIUS = 1;
const HEIGHT = 23;
function renderWaveform(canvas, spikes, progress, {
  peak,
  fillStyle,
  progressFillStyle
}) {
  const width = spikes.length * SPIKE_STEP;
  const height = HEIGHT;
  canvas.width = width * 2;
  canvas.height = height * 2;
  canvas.style.width = `${width}px`;
  canvas.style.height = `${height}px`;
  const ctx = canvas.getContext('2d');
  ctx.scale(2, 2);
  spikes.forEach((item, i) => {
    ctx.globalAlpha = i / spikes.length >= progress ? 0.5 : 1;
    ctx.fillStyle = progress > i / spikes.length ? progressFillStyle : fillStyle;
    const spikeHeight = Math.max(2, HEIGHT * (item / Math.max(1, peak)));
    roundedRectangle(ctx, i * SPIKE_STEP, (height + spikeHeight) / 2, SPIKE_WIDTH, spikeHeight, SPIKE_RADIUS);
    ctx.fill();
  });
}
function roundedRectangle(ctx, x, y, width, height, radius) {
  if (width < 2 * radius) {
    radius = width / 2;
  }
  if (height < 2 * radius) {
    radius = height / 2;
  }
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.arcTo(x + width, y, x + width, y - height, radius);
  ctx.arcTo(x + width, y - height, x, y - height, radius);
  ctx.arcTo(x, y - height, x, y, radius);
  ctx.arcTo(x, y, x + width, y, radius);
  ctx.closePath();
}

/***/ },

/***/ "./src/components/common/hooks/useAnimatedEmoji.ts"
/*!*********************************************************!*\
  !*** ./src/components/common/hooks/useAnimatedEmoji.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useAnimatedEmoji)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_safePlay__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/safePlay */ "./src/util/safePlay.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");








const SIZE = 7 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.REM;
const INTERACTION_BUNCH_TIME = 1000;
const MS_DIVIDER = 1000;
const TIME_DEFAULT = 0;
function useAnimatedEmoji(chatId, messageId, soundId, activeEmojiInteractions, isOwn, emoji, preferredSize) {
  const {
    interactWithAnimatedEmoji,
    sendEmojiInteraction,
    sendWatchingEmojiInteraction
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const audioRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const soundMediaData = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_7__["default"])(soundId ? `document${soundId}` : undefined, !soundId);
  const size = preferredSize || SIZE;
  const style = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_3__["default"])(`width: ${size}px`, `height: ${size}px`, emoji && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_ELECTRON && 'cursor: pointer');
  const interactions = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const startedInteractions = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const sendInteractionBunch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const container = ref.current;
    if (!container) return;
    sendEmojiInteraction({
      chatId: chatId,
      messageId: messageId,
      emoji: emoji,
      interactions: interactions.current
    });
    startedInteractions.current = undefined;
    interactions.current = undefined;
  });
  const play = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const audio = audioRef.current;
    if (soundMediaData) {
      if (audio) {
        audio.pause();
        audio.remove();
      }
      audioRef.current = new Audio();
      audioRef.current.src = soundMediaData;
      (0,_util_safePlay__WEBPACK_IMPORTED_MODULE_4__["default"])(audioRef.current);
      audioRef.current.addEventListener('ended', () => {
        audioRef.current = undefined;
      }, {
        once: true
      });
    }
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    play();
    const container = ref.current;
    if (!emoji || !container || !messageId || !chatId) {
      return;
    }
    const {
      x,
      y
    } = container.getBoundingClientRect();
    interactWithAnimatedEmoji({
      emoji,
      x,
      y,
      startSize: size,
      isReversed: !isOwn
    });
    if (!interactions.current) {
      interactions.current = [];
      startedInteractions.current = performance.now();
      setTimeout(sendInteractionBunch, INTERACTION_BUNCH_TIME);
    }
    interactions.current.push(startedInteractions.current ? (performance.now() - startedInteractions.current) / MS_DIVIDER : TIME_DEFAULT);
  });

  // Set an end anchor for remote activated interaction
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const container = ref.current;
    if (!container || !activeEmojiInteractions) return;
    activeEmojiInteractions.forEach(({
      id,
      startSize,
      messageId: interactionMessageId
    }) => {
      if (startSize || messageId !== interactionMessageId) {
        return;
      }
      const {
        x,
        y
      } = container.getBoundingClientRect();
      sendWatchingEmojiInteraction({
        id,
        chatId: chatId,
        emoticon: emoji,
        startSize: size,
        x,
        y,
        isReversed: !isOwn
      });
      play();
    });
  }, [activeEmojiInteractions, chatId, emoji, isOwn, messageId, play, sendWatchingEmojiInteraction, size]);
  return {
    ref,
    size,
    style,
    handleClick
  };
}

/***/ },

/***/ "./src/components/common/hooks/usePhotosPreload.ts"
/*!*********************************************************!*\
  !*** ./src/components/common/hooks/usePhotosPreload.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePhotosPreload)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");




const PHOTOS_TO_PRELOAD = 4;
function usePhotosPreload(photos, currentIndex) {
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    photos.slice(currentIndex, currentIndex + PHOTOS_TO_PRELOAD).forEach(photo => {
      const mediaHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getProfilePhotoMediaHash)(photo);
      const mediaData = _util_mediaLoader__WEBPACK_IMPORTED_MODULE_3__.getFromMemory(mediaHash);
      if (!mediaData) {
        _util_mediaLoader__WEBPACK_IMPORTED_MODULE_3__.fetch(mediaHash, _api_types__WEBPACK_IMPORTED_MODULE_1__.ApiMediaFormat.BlobUrl);
      }
    });
  }, [currentIndex, photos]);
}

/***/ },

/***/ "./src/components/common/profile/BusinessHours.module.scss"
/*!*****************************************************************!*\
  !*** ./src/components/common/profile/BusinessHours.module.scss ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Ef_0p5Qm","top":"nHSmCUNs","icon":"rlM4Mbnn","left":"JTZ8UnnP","bottom":"lp9VIV1o","status":"JVL7ZnnJ","status-open":"segAfYXs","statusOpen":"segAfYXs","arrow":"dYxw2cFn","offset-trigger":"gVwflFhz","offsetTrigger":"gVwflFhz","transition":"WKgL_XiP","timetable":"MPBKHdZL","schedule":"Rs0VPgpq","weekday":"cmxPqAof","current-day":"YZVvP_56","currentDay":"YZVvP_56"});

/***/ },

/***/ "./src/components/common/profile/BusinessHours.tsx"
/*!*********************************************************!*\
  !*** ./src/components/common/profile/BusinessHours.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_dates_workHours__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/dates/workHours */ "./src/util/dates/workHours.ts");
/* harmony import */ var _hooks_data_useSelectorSignal__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/data/useSelectorSignal */ "./src/hooks/data/useSelectorSignal.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./BusinessHours.module.scss */ "./src/components/common/profile/BusinessHours.module.scss");


















const DAYS = Array.from({
  length: 7
}, (_, i) => i);
const BusinessHours = ({
  businessHours
}) => {
  const transitionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [isExpanded, expand, collapse] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])(false);
  const [isMyTime, showInMyTime, showInLocalTime] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])(false);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_10__["default"])();
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_7__["default"])(forceUpdate, 60 * 1000);
  const timezoneSignal = (0,_hooks_data_useSelectorSignal__WEBPACK_IMPORTED_MODULE_6__["default"])(global => global.timezones?.byId);
  const timezones = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_8__["default"])(timezoneSignal, [timezoneSignal]);
  const timezoneMinuteDifference = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!timezones) return 0;
    const timezone = timezones[businessHours.timezoneId];
    const myOffset = (0,_util_dates_workHours__WEBPACK_IMPORTED_MODULE_5__.getUtcOffset)();
    return (myOffset - timezone.utcOffset) / 60;
  }, [businessHours.timezoneId, timezones]);
  const workHours = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const weekStart = (0,_util_dates_workHours__WEBPACK_IMPORTED_MODULE_5__.getWeekStart)();
    const shiftedHours = (0,_util_dates_workHours__WEBPACK_IMPORTED_MODULE_5__.shiftTimeRanges)(businessHours.workHours, isMyTime ? timezoneMinuteDifference : 0);
    const days = (0,_util_dates_workHours__WEBPACK_IMPORTED_MODULE_5__.splitDays)(shiftedHours);
    const result = {};
    DAYS.forEach(day => {
      const segments = days[day];
      if (!segments) {
        result[day] = [lang('BusinessHoursDayClosed')];
        return;
      }
      result[day] = segments.map(({
        startMinute,
        endMinute
      }) => {
        if (endMinute - startMinute === 24 * 60) return lang('BusinessHoursDayFullOpened');
        const start = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatTime)(lang, weekStart + startMinute * 60 * 1000);
        const end = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatTime)(lang, weekStart + endMinute * 60 * 1000);
        return `${start} – ${end}`;
      });
    });
    return result;
  }, [businessHours.workHours, isMyTime, lang, timezoneMinuteDifference]);
  const isBusinessOpen = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const localTimeHours = (0,_util_dates_workHours__WEBPACK_IMPORTED_MODULE_5__.shiftTimeRanges)(businessHours.workHours, timezoneMinuteDifference);
    const weekStart = (0,_util_dates_workHours__WEBPACK_IMPORTED_MODULE_5__.getWeekStart)();
    const now = new Date().getTime();
    const minutesSinceWeekStart = (now - weekStart) / 1000 / 60;
    return localTimeHours.some(({
      startMinute,
      endMinute
    }) => startMinute <= minutesSinceWeekStart && minutesSinceWeekStart <= endMinute);
  }, [businessHours.workHours, timezoneMinuteDifference]);
  const currentDay = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const now = new Date(Date.now() - (isMyTime ? 0 : timezoneMinuteDifference * 60 * 1000));
    return (now.getDay() + 6) % 7;
  }, [isMyTime, timezoneMinuteDifference]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (isExpanded) {
      collapse();
    } else {
      expand();
    }
  });
  const handleTriggerOffset = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    e.stopPropagation();
    if (isMyTime) {
      showInLocalTime();
    } else {
      showInMyTime();
    }
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isExpanded) return;
    const slide = document.querySelector(`.${_ui_Transition__WEBPACK_IMPORTED_MODULE_14__.ACTIVE_SLIDE_CLASS_NAME} > .${_BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].timetable}`);
    if (!slide) return;
    const height = slide.offsetHeight;
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      transitionRef.current.style.height = `${height}px`;
    });
  }, [isExpanded]);
  const handleAnimationStart = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    const slide = document.querySelector(`.${_ui_Transition__WEBPACK_IMPORTED_MODULE_14__.TO_SLIDE_CLASS_NAME} > .${_BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].timetable}`);
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMeasure)(() => {
      const height = slide.offsetHeight;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
        transitionRef.current.style.height = `${height}px`;
      });
    });
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    icon: "clock",
    iconClassName: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].icon,
    multiline: true,
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].root,
    isStatic: isExpanded,
    ripple: true,
    narrow: true,
    withColorTransition: true,
    onClick: handleClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].top
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].left
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, lang('BusinessHoursProfile')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].status, isBusinessOpen && _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].statusOpen)
  }, isBusinessOpen ? lang('BusinessHoursProfileNowOpen') : lang('BusinessHoursProfileNowClosed'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].arrow,
    name: isExpanded ? 'up' : 'down'
  })), isExpanded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].bottom
  }, Boolean(timezoneMinuteDifference) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].offsetTrigger,
    role: "button",
    tabIndex: 0,
    onMouseDown: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_TOUCH_ENV ? handleTriggerOffset : undefined,
    onClick: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_TOUCH_ENV ? handleTriggerOffset : undefined
  }, lang(isMyTime ? 'BusinessHoursProfileSwitchMy' : 'BusinessHoursProfileSwitchLocal')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Transition__WEBPACK_IMPORTED_MODULE_14__["default"], {
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].transition,
    ref: transitionRef,
    name: "fade",
    activeKey: Number(isMyTime),
    onStart: handleAnimationStart
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("dl", {
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].timetable
  }, DAYS.map(day => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("dt", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].weekday, day === currentDay && _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].currentDay)
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatWeekday)(lang, day === 6 ? 0 : day + 1)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("dd", {
    className: _BusinessHours_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].schedule
  }, workHours[day].map(segment => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, segment)))))))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(BusinessHours));

/***/ },

/***/ "./src/components/common/profile/ChatExtra.module.scss"
/*!*************************************************************!*\
  !*** ./src/components/common/profile/ChatExtra.module.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"businessLocation":"UZbkeFDB","personalChannel":"HP5EJx7s","personalChannelTitle":"cHyTGri2","botVerificationSection":"RWFu5ENh","sectionInfo":"IrqRJFxm","botVerificationIcon":"b32hsSPS","personalChannelSubscribers":"kYd2GrmU","personalChannelItem":"qOJwhXMC","openAppButton":"x925YeS3"});

/***/ },

/***/ "./src/components/common/profile/ChatExtra.tsx"
/*!*****************************************************!*\
  !*** ./src/components/common/profile/ChatExtra.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_notifications__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/helpers/notifications */ "./src/global/helpers/notifications.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_phoneNumber__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/phoneNumber */ "./src/util/phoneNumber.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _util_themeStyle__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/themeStyle */ "./src/util/themeStyle.ts");
/* harmony import */ var _left_main_hooks__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../left/main/hooks */ "./src/components/left/main/hooks/index.ts");
/* harmony import */ var _helpers_formatUsername__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../helpers/formatUsername */ "./src/components/common/helpers/formatUsername.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/window/useDevicePixelRatio */ "./src/hooks/window/useDevicePixelRatio.ts");
/* harmony import */ var _left_main_Chat__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../left/main/Chat */ "./src/components/left/main/Chat.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _ui_Switcher__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../ui/Switcher */ "./src/components/ui/Switcher.tsx");
/* harmony import */ var _CustomEmoji__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _SafeLink__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _BusinessHours__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./BusinessHours */ "./src/components/common/profile/BusinessHours.tsx");
/* harmony import */ var _PortraitEntry__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./PortraitEntry */ "./src/components/common/profile/PortraitEntry.tsx");
/* harmony import */ var _UserBirthday__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./UserBirthday */ "./src/components/common/profile/UserBirthday.tsx");
/* harmony import */ var _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ChatExtra.module.scss */ "./src/components/common/profile/ChatExtra.module.scss");
































const DEFAULT_MAP_CONFIG = {
  width: 64,
  height: 64,
  zoom: 15
};
const BOT_VERIFICATION_ICON_SIZE = 16;
const ChatExtra = ({
  chatOrUserId,
  user,
  chat,
  userFullInfo,
  isInSettings,
  canInviteUsers,
  isMuted,
  phoneCodeList,
  topicId,
  description,
  chatInviteLink,
  topicLink,
  hasSavedMessages,
  personalChannel,
  hasMainMiniApp,
  isBotCanManageEmojiStatus,
  botAppPermissions,
  botVerification,
  subscriptionType
}) => {
  const {
    showNotification,
    updateChatMutedState,
    updateTopicMutedState,
    loadPeerStories,
    openSavedDialog,
    openMapModal,
    requestCollectibleInfo,
    requestMainWebView,
    toggleUserEmojiStatusPermission,
    toggleUserLocationPermission
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    id: userId,
    usernames,
    phoneNumber,
    isSelf
  } = user || {};
  const {
    id: chatId,
    usernames: chatUsernames
  } = chat || {};
  const peerId = userId || chatId;
  const {
    businessLocation,
    businessWorkHours,
    personalChannelMessageId,
    birthday
  } = userFullInfo || {};
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_14__["default"])(([prevPeerId]) => {
    if (!peerId || prevPeerId === peerId) return;
    if (user || chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isChatChannel)(chat)) {
      loadPeerStories({
        peerId
      });
    }
  }, [peerId, chat, user]);
  const {
    width,
    height,
    zoom
  } = DEFAULT_MAP_CONFIG;
  const dpr = (0,_hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_19__["default"])();
  const locationMediaHash = businessLocation?.geo && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.buildStaticMapHash)(businessLocation.geo, width, height, zoom, dpr);
  const locationBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_17__["default"])(locationMediaHash);
  const locationRightComponent = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!businessLocation?.geo) return undefined;
    if (locationBlobUrl) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
        src: locationBlobUrl,
        alt: "",
        className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].businessLocation
      });
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_23__["default"], {
      className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].businessLocation
    });
  }, [businessLocation, locationBlobUrl]);
  const isTopicInfo = Boolean(topicId && topicId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID);
  const shouldRenderAllLinks = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isChatChannel)(chat) || user?.isPremium;
  const activeUsernames = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const result = usernames?.filter(u => u.isActive);
    return result?.length ? result : undefined;
  }, [usernames]);
  const activeChatUsernames = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const result = !user ? chatUsernames?.filter(u => u.isActive) : undefined;
    return result?.length ? result : undefined;
  }, [chatUsernames, user]);
  const link = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!chat) {
      return undefined;
    }
    return isTopicInfo ? topicLink : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getChatLink)(chat) || chatInviteLink;
  }, [chat, isTopicInfo, topicLink, chatInviteLink]);
  const handleClickLocation = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    const {
      address,
      geo
    } = businessLocation;
    if (!geo) {
      (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_7__.copyTextToClipboard)(address);
      showNotification({
        message: oldLang('BusinessLocationCopied')
      });
      return;
    }
    openMapModal({
      geoPoint: geo,
      zoom
    });
  });
  const handleNotificationChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (isTopicInfo) {
      updateTopicMutedState({
        chatId: chatId,
        topicId: topicId,
        isMuted: !isMuted
      });
    } else {
      updateChatMutedState({
        chatId: chatId,
        isMuted: !isMuted
      });
    }
  });
  const manageEmojiStatusChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (!user) return;
    toggleUserEmojiStatusPermission({
      botId: user.id,
      isEnabled: !isBotCanManageEmojiStatus
    });
  });
  const handleLocationPermissionChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (!user) return;
    toggleUserLocationPermission({
      botId: user.id,
      isAccessGranted: !botAppPermissions?.geolocation
    });
  });
  const handleOpenSavedDialog = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    openSavedDialog({
      chatId: chatOrUserId
    });
  });
  function copy(text, entity) {
    (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_7__.copyTextToClipboard)(text);
    showNotification({
      message: `${entity} was copied`
    });
  }
  const formattedNumber = phoneNumber && (0,_util_phoneNumber__WEBPACK_IMPORTED_MODULE_8__.formatPhoneNumberWithCode)(phoneCodeList, phoneNumber);
  const handlePhoneClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (phoneNumber?.length === _config__WEBPACK_IMPORTED_MODULE_3__.FRAGMENT_PHONE_LENGTH && phoneNumber.startsWith(_config__WEBPACK_IMPORTED_MODULE_3__.FRAGMENT_PHONE_CODE)) {
      requestCollectibleInfo({
        collectible: phoneNumber,
        peerId: peerId,
        type: 'phone'
      });
      return;
    }
    copy(formattedNumber, oldLang('Phone'));
  });
  const handleUsernameClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])((username, isChat) => {
    if (!username.isEditable) {
      requestCollectibleInfo({
        collectible: username.username,
        peerId: peerId,
        type: 'username'
      });
      return;
    }
    copy((0,_helpers_formatUsername__WEBPACK_IMPORTED_MODULE_12__["default"])(username.username, isChat), oldLang(isChat ? 'Link' : 'Username'));
  });
  const handleOpenApp = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    const botId = user?.id;
    if (!botId) {
      return;
    }
    const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_10__.extractCurrentThemeParams)();
    requestMainWebView({
      botId,
      peerId: botId,
      theme,
      shouldMarkBotTrusted: true
    });
  });
  const appTermsInfo = lang('ProfileOpenAppAbout', {
    terms: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SafeLink__WEBPACK_IMPORTED_MODULE_26__["default"], {
      text: lang('ProfileOpenAppTerms'),
      url: lang('ProfileBotOpenAppInfoLink')
    })
  }, {
    withNodes: true
  });
  const isRestricted = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsChatRestricted)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), chatId) : false;
  if (isRestricted || isSelf && !isInSettings) {
    return undefined;
  }
  function renderUsernames(usernameList, isChat) {
    const [mainUsername, ...otherUsernames] = usernameList;
    const usernameLinks = otherUsernames.length ? oldLang('UsernameAlso', '%USERNAMES%').split('%').map(s => {
      return s === 'USERNAMES' ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, otherUsernames.map((username, idx) => {
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, idx > 0 ? ', ' : '', /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("a", {
          key: username.username,
          href: (0,_helpers_formatUsername__WEBPACK_IMPORTED_MODULE_12__["default"])(username.username, true),
          onMouseDown: _util_stopEvent__WEBPACK_IMPORTED_MODULE_9__["default"],
          onClick: e => {
            (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_9__["default"])(e);
            handleUsernameClick(username, isChat);
          },
          className: "text-entity-link username-link"
        }, (0,_helpers_formatUsername__WEBPACK_IMPORTED_MODULE_12__["default"])(username.username)));
      })) : s;
    }) : undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
      icon: isChat ? 'link' : 'mention',
      multiline: true,
      narrow: true,
      ripple: true,
      onClick: () => {
        handleUsernameClick(mainUsername, isChat);
      }
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "title",
      dir: lang.isRtl ? 'rtl' : undefined
    }, (0,_helpers_formatUsername__WEBPACK_IMPORTED_MODULE_12__["default"])(mainUsername.username, isChat)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "subtitle"
    }, usernameLinks && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "other-usernames"
    }, usernameLinks), oldLang(isChat ? 'Link' : 'Username')));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "ChatExtra"
  }, personalChannel && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].personalChannel
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].personalChannelTitle
  }, oldLang('ProfileChannel')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].personalChannelSubscribers
  }, oldLang('Subscribers', personalChannel.membersCount, 'i')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_left_main_Chat__WEBPACK_IMPORTED_MODULE_20__["default"], {
    chatId: personalChannel.id,
    orderDiff: 0,
    animationType: _left_main_hooks__WEBPACK_IMPORTED_MODULE_11__.ChatAnimationTypes.None,
    isPreview: true,
    previewMessageId: personalChannelMessageId,
    className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].personalChannelItem
  })), Boolean(formattedNumber?.length) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    icon: "phone",
    multiline: true,
    narrow: true,
    ripple: true,
    onClick: handlePhoneClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "title",
    dir: lang.isRtl ? 'rtl' : undefined
  }, formattedNumber), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "subtitle"
  }, oldLang('Phone'))), activeUsernames && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderUsernames(activeUsernames), user && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PortraitEntry__WEBPACK_IMPORTED_MODULE_28__["default"], {
    user: user,
    subscriptionType: subscriptionType
  })), description && Boolean(description.length) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    icon: "info",
    multiline: true,
    narrow: true,
    isStatic: true,
    allowSelection: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "title word-break allow-selection",
    dir: lang.isRtl ? 'rtl' : undefined
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_13__["default"])(description, ['br', shouldRenderAllLinks ? 'links' : 'tg_links', 'emoji'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "subtitle"
  }, oldLang(userId ? 'UserBio' : 'Info'))), activeChatUsernames && !isTopicInfo && renderUsernames(activeChatUsernames, true), (!activeChatUsernames && canInviteUsers || isTopicInfo) && link && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    icon: "link",
    multiline: true,
    narrow: true,
    ripple: true,
    onClick: () => copy(link, oldLang('SetUrlPlaceholder'))
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title"
  }, link), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "subtitle"
  }, oldLang('SetUrlPlaceholder'))), birthday && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_UserBirthday__WEBPACK_IMPORTED_MODULE_29__["default"], {
    key: peerId,
    birthday: birthday,
    user: user,
    isInSettings: isInSettings
  }), hasMainMiniApp && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    multiline: true,
    isStatic: true,
    narrow: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
    className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].openAppButton,
    size: "smaller",
    onClick: handleOpenApp
  }, oldLang('ProfileBotOpenApp')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].sectionInfo
  }, appTermsInfo)), !isInSettings && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    icon: "unmute",
    narrow: true,
    ripple: true,
    onClick: handleNotificationChange
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('Notifications')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Switcher__WEBPACK_IMPORTED_MODULE_24__["default"], {
    id: "group-notifications",
    label: userId ? 'Toggle User Notifications' : 'Toggle Chat Notifications',
    checked: !isMuted,
    inactive: true
  })), businessWorkHours && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_BusinessHours__WEBPACK_IMPORTED_MODULE_27__["default"], {
    businessHours: businessWorkHours
  }), businessLocation && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    icon: "location",
    ripple: true,
    multiline: true,
    narrow: true,
    rightElement: locationRightComponent,
    onClick: handleClickLocation
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title"
  }, businessLocation.address), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "subtitle"
  }, oldLang('BusinessProfileLocation'))), hasSavedMessages && !isInSettings && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    icon: "saved-messages",
    narrow: true,
    ripple: true,
    onClick: handleOpenSavedDialog
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('SavedMessagesTab'))), userFullInfo && 'isBotAccessEmojiGranted' in userFullInfo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    icon: "user",
    narrow: true,
    ripple: true,
    onClick: manageEmojiStatusChange
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('BotProfilePermissionEmojiStatus')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Switcher__WEBPACK_IMPORTED_MODULE_24__["default"], {
    label: oldLang('BotProfilePermissionEmojiStatus'),
    checked: isBotCanManageEmojiStatus,
    inactive: true
  })), botAppPermissions?.geolocation !== undefined && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
    icon: "location",
    narrow: true,
    ripple: true,
    onClick: handleLocationPermissionChange
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, oldLang('BotProfilePermissionLocation')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Switcher__WEBPACK_IMPORTED_MODULE_24__["default"], {
    label: oldLang('BotProfilePermissionLocation'),
    checked: botAppPermissions?.geolocation,
    inactive: true
  })), botVerification && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].botVerificationSection
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_CustomEmoji__WEBPACK_IMPORTED_MODULE_25__["default"], {
    className: _ChatExtra_module_scss__WEBPACK_IMPORTED_MODULE_30__["default"].botVerificationIcon,
    documentId: botVerification.iconId,
    size: BOT_VERIFICATION_ICON_SIZE
  }), botVerification.description));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatOrUserId,
  isSavedDialog
}) => {
  const {
    countryList: {
      phoneCodes: phoneCodeList
    },
    subscriptionInfo
  } = global;
  const chat = chatOrUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatOrUserId) : undefined;
  const user = chatOrUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, chatOrUserId) : undefined;
  const botAppPermissions = chatOrUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectBotAppPermissions)(global, chatOrUserId) : undefined;
  const isForum = chat?.isForum;
  const isMuted = chat && (0,_global_helpers_notifications__WEBPACK_IMPORTED_MODULE_5__.getIsChatMuted)(chat, (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectNotifyDefaults)(global), (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectNotifyException)(global, chat.id));
  const {
    threadId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global) || {};
  const topicId = isForum && threadId ? Number(threadId) : undefined;
  const chatFullInfo = chat && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatFullInfo)(global, chat.id);
  const userFullInfo = user && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUserFullInfo)(global, user.id);
  const botVerification = userFullInfo?.botVerification || chatFullInfo?.botVerification;
  const chatInviteLink = chatFullInfo?.inviteLink;
  const description = userFullInfo?.bio || chatFullInfo?.about;
  const canInviteUsers = chat && !user && (!(0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isChatChannel)(chat) && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isUserRightBanned)(chat, 'inviteUsers') || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getHasAdminRight)(chat, 'inviteUsers'));
  const topicLink = topicId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopicLink)(global, chatOrUserId, topicId) : undefined;
  const hasSavedMessages = !isSavedDialog && global.chats.listIds.saved?.includes(chatOrUserId);
  const personalChannel = userFullInfo?.personalChannelId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, userFullInfo.personalChannelId) : undefined;
  const hasMainMiniApp = user?.hasMainMiniApp;
  return {
    phoneCodeList,
    chat,
    user,
    userFullInfo,
    canInviteUsers,
    botAppPermissions,
    isMuted,
    topicId,
    chatInviteLink,
    description,
    topicLink,
    hasSavedMessages,
    personalChannel,
    hasMainMiniApp,
    isBotCanManageEmojiStatus: userFullInfo?.isBotCanManageEmojiStatus,
    botVerification,
    subscriptionType: subscriptionInfo?.subscriptionType
  };
})(ChatExtra)));

/***/ },

/***/ "./src/components/common/profile/PortraitEntry.tsx"
/*!*********************************************************!*\
  !*** ./src/components/common/profile/PortraitEntry.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/subscriptionHandler */ "./src/util/subscriptionHandler.ts");
/* harmony import */ var _chatAssistant_store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../chatAssistant/store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _right_userPortrait_UserPortrait__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../right/userPortrait/UserPortrait */ "./src/components/right/userPortrait/UserPortrait.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");










const DotIcon = () => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
  xmlns: "http://www.w3.org/2000/svg",
  width: 12,
  height: 3,
  fill: "none"
}, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
  fill: "currentColor",
  d: "M1.268 0a1.267 1.267 0 1 1-.002 2.534A1.267 1.267 0 0 1 1.268 0Zm4.435 0a1.268 1.268 0 1 1 0 2.536 1.268 1.268 0 0 1 0-2.536Zm4.437 0a1.268 1.268 0 1 1 0 2.535 1.268 1.268 0 0 1 0-2.535Z"
}));
const PortraitEntry = ({
  user,
  subscriptionType
}) => {
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    openUserPortrait,
    openPayPackageModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [userInfo, setUserInfo] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const handlePortraitClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_3__.checkCredisBalance)()) {
      openPayPackageModal();
      return;
    }
    if (subscriptionType === 'plus') {
      openUserPortrait({
        userId: user?.id
      });
    } else {
      openPayPackageModal();
    }
  });
  const getUserPortrait = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async senderId => {
    if (!senderId) return;
    const portraitInfo = await _chatAssistant_store__WEBPACK_IMPORTED_MODULE_4__.ChataiStores.userPortrait?.getUserPortrait(senderId);
    if (portraitInfo) {
      setUserInfo(portraitInfo);
    } else {
      setUserInfo(undefined);
    }
  }, []);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    getUserPortrait(user?.id);
  }, [user?.id, getUserPortrait]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_8__["default"], {
    icon: "portrait-large-icon",
    iconClassName: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(userInfo?.tags?.length ? 'pb-[40px]' : ''),
    multiline: true,
    narrow: true,
    ripple: true,
    onClick: handlePortraitClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "title"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "font-[600]"
  }, (user?.firstName || '') + (user?.lastName || '')), "\u2018s portrait"), userInfo?.tags && userInfo?.tags?.length > 0 && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center gap-1 my-1"
  }, userInfo?.tags?.slice(0, 1)?.map((tag, index) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center justify-center px-2 rounded-[4px] h-[24px] text-[12px] font-[500]",
    style: `background: ${_right_userPortrait_UserPortrait__WEBPACK_IMPORTED_MODULE_7__.PortraitTagColors[index]}`
  }, tag)), userInfo?.tags?.length > 1 && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center justify-center px-2 rounded-[4px] h-[24px]",
    style: `background: ${_right_userPortrait_UserPortrait__WEBPACK_IMPORTED_MODULE_7__.PortraitTagColors[1]}`
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(DotIcon, null))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "subtitle"
  }, oldLang('User Portrait')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PortraitEntry));

/***/ },

/***/ "./src/components/common/profile/UserBirthday.module.scss"
/*!****************************************************************!*\
  !*** ./src/components/common/profile/UserBirthday.module.scss ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"wCp6TBYF","number":"lQeU96Fj","float":"nKt3QDc_","show-up":"ZaSLCV2k","showUp":"ZaSLCV2k","dissapear":"jA50ot3v","shiftOrigin":"e1ezfWJb","effect":"cFEXGUih","giftIcon":"c4HDQNGJ"});

/***/ },

/***/ "./src/components/common/profile/UserBirthday.tsx"
/*!********************************************************!*\
  !*** ./src/components/common/profile/UserBirthday.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _helpers_renderText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _StickerView__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _UserBirthday_module_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./UserBirthday.module.scss */ "./src/components/common/profile/UserBirthday.module.scss");




















const NUMBER_EMOJI_SUFFIX = '\uFE0F\u20E3';
const NUMBER_STICKER_SIZE = 128;
const EFFECT_EMOJIS = ['🎉', '🎆', '🎈'];
const EFFECT_SIZE = 288;
const ANIMATION_DURATION = 3000;
const UserBirthday = ({
  user,
  birthday,
  isPremiumPurchaseBlocked,
  birthdayNumbers,
  animatedEmojiEffects,
  isInSettings
}) => {
  const {
    openGiftModal,
    requestConfetti
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const animationPlayedRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const [isPlayingAnimation, playAnimation, stopAnimation] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const {
    formattedDate,
    isToday,
    age
  } = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const today = new Date();
    const date = new Date();
    if (birthday.year) {
      date.setFullYear(birthday.year);
    }
    date.setMonth(birthday.month - 1);
    date.setDate(birthday.day);
    date.setHours(0, 0, 0, 0);
    const formatted = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__.formatDateToString)(date, lang.code, true, 'long');
    const isBirthdayToday = date.getDate() === today.getDate() && date.getMonth() === today.getMonth();
    return {
      formattedDate: formatted,
      isToday: isBirthdayToday,
      age: birthday.year && getAge(date)
    };
  }, [birthday, lang]);
  const numbersForAge = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!age || !isToday) return undefined;
    const numbers = birthdayNumbers?.stickers?.filter(({
      emoji
    }) => emoji?.endsWith(NUMBER_EMOJI_SUFFIX));
    if (!numbers) return undefined;
    const byEmoji = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_9__.buildCollectionByKey)(numbers, 'emoji');
    const ageDigits = age.toString().split('');
    return ageDigits.map(digit => byEmoji[digit + NUMBER_EMOJI_SUFFIX]);
  }, [age, birthdayNumbers?.stickers, isToday]);
  const effectSticker = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isToday) return undefined;
    const randomEffect = EFFECT_EMOJIS[Math.floor(Math.random() * EFFECT_EMOJIS.length)];
    return animatedEmojiEffects?.stickers?.find(({
      emoji
    }) => emoji === randomEffect);
  }, [animatedEmojiEffects?.stickers, isToday]);

  // Preload stickers
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isToday || !numbersForAge) return;
    numbersForAge.forEach(sticker => {
      const hash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getStickerMediaHash)(sticker, 'preview');
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_10__.fetch(hash, _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl);
    });
    if (effectSticker) {
      const effectHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getStickerMediaHash)(effectSticker, 'preview');
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_10__.fetch(effectHash, _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl);
    }
  }, [effectSticker, isToday, numbersForAge]);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_12__["default"])(stopAnimation, isPlayingAnimation ? ANIMATION_DURATION : undefined);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isPlayingAnimation) {
      animationPlayedRef.current = true;
      const column = document.getElementById(isInSettings ? 'LeftColumn' : 'RightColumn');
      if (!column) return;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMeasure)(() => {
        const {
          top,
          left,
          width,
          height
        } = column.getBoundingClientRect();
        requestConfetti({
          top,
          left,
          width,
          height,
          style: 'top-down'
        });
      });
    }
  }, [isInSettings, isPlayingAnimation]);
  const valueKey = `ProfileBirthday${isToday ? 'Today' : ''}Value${age ? 'Year' : ''}`;
  const canGiftPremium = isToday && !user.isPremium && !user.isSelf && !isPremiumPurchaseBlocked;
  const handleOpenGiftModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    openGiftModal({
      forUserId: user.id
    });
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!isToday) return;
    if (canGiftPremium && animationPlayedRef.current) {
      handleOpenGiftModal();
      return;
    }
    playAnimation();
  });
  const isStatic = !isToday && !canGiftPremium;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _UserBirthday_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    icon: "calendar",
    secondaryIcon: canGiftPremium ? 'gift' : undefined,
    secondaryIconClassName: _UserBirthday_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].giftIcon,
    multiline: true,
    narrow: true,
    ref: ref,
    ripple: !isStatic,
    onClick: handleClick,
    isStatic: isStatic,
    onSecondaryIconClick: handleOpenGiftModal
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title",
    dir: lang.isRtl ? 'rtl' : undefined
  }, (0,_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang(valueKey, [formattedDate, age], undefined, age))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "subtitle"
  }, lang(isToday ? 'ProfileBirthdayToday' : 'ProfileBirthday'))), isPlayingAnimation && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_OFFSET_PATH_SUPPORTED && numbersForAge?.map((sticker, index) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(_UserBirthday_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].number, index > 0 && _UserBirthday_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].shiftOrigin),
    style: `--digit-offset: ${index}`
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StickerView__WEBPACK_IMPORTED_MODULE_17__["default"], {
    containerRef: ref,
    sticker: sticker,
    size: NUMBER_STICKER_SIZE,
    forceAlways: true
  }))), isPlayingAnimation && effectSticker && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _UserBirthday_module_scss__WEBPACK_IMPORTED_MODULE_18__["default"].effect
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StickerView__WEBPACK_IMPORTED_MODULE_17__["default"], {
    containerRef: ref,
    sticker: effectSticker,
    size: EFFECT_SIZE,
    shouldLoop: true,
    forceAlways: true
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    birthdayNumbers,
    animatedEmojiEffects
  } = global;
  return {
    birthdayNumbers,
    animatedEmojiEffects,
    isPremiumPurchaseBlocked: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsPremiumPurchaseBlocked)(global)
  };
})(UserBirthday)));

// https://stackoverflow.com/a/7091965
function getAge(birthdate) {
  const today = new Date();
  let age = today.getFullYear() - birthdate.getFullYear();
  const m = today.getMonth() - birthdate.getMonth();
  if (m < 0 || m === 0 && today.getDate() < birthdate.getDate()) {
    age--;
  }
  return age;
}

/***/ },

/***/ "./src/components/left/ChatFolderModal.async.tsx"
/*!*******************************************************!*\
  !*** ./src/components/left/ChatFolderModal.async.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ChatFolderModalAsync = props => {
  const {
    isOpen
  } = props;
  const ChatFolderModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ChatFolderModal', !isOpen);
  return ChatFolderModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ChatFolderModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatFolderModalAsync);

/***/ },

/***/ "./src/components/left/MuteChatModal.async.tsx"
/*!*****************************************************!*\
  !*** ./src/components/left/MuteChatModal.async.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MuteChatModalAsync = props => {
  const {
    isOpen
  } = props;
  const MuteChatModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MuteChatModal', !isOpen);
  return MuteChatModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MuteChatModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MuteChatModalAsync);

/***/ },

/***/ "./src/components/left/main/Archive.module.scss"
/*!******************************************************!*\
  !*** ./src/components/left/main/Archive.module.scss ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"sG8AAzvK","minimized":"lTOui0dp","button":"bNkLqJf1","title":"rMTpNazX","unread-count":"O7esHjyC","unreadCount":"O7esHjyC","info":"OS2LWzdu","name":"bkCtPuPQ","icon":"f4LUPgr4","avatarWrapper":"RMY__Znz","avatar":"qeb0Aox1","chatsPreview":"_1817Hwgd","unread":"SS39xuL3"});

/***/ },

/***/ "./src/components/left/main/Archive.tsx"
/*!**********************************************!*\
  !*** ./src/components/left/main/Archive.tsx ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Badge__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Badge */ "./src/components/ui/Badge.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./Archive.module.scss */ "./src/components/left/main/Archive.module.scss");
















const PREVIEW_SLICE = 5;
const ARCHIVE_CUSTOM_PEER = {
  isCustomPeer: true,
  title: 'Archived Chats',
  avatarIcon: 'archive-filled',
  customPeerAvatarColor: '#9EAAB5'
};
const Archive = ({
  archiveSettings,
  onDragEnter,
  onClick
}) => {
  const {
    updateArchiveSettings
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const orderedChatIds = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_8__.useFolderManagerForOrderedIds)(_config__WEBPACK_IMPORTED_MODULE_2__.ARCHIVED_FOLDER_ID);
  const unreadCounters = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_8__.useFolderManagerForUnreadCounters)();
  const archiveUnreadCount = unreadCounters[_config__WEBPACK_IMPORTED_MODULE_2__.ARCHIVED_FOLDER_ID]?.chatsCount;
  const previewItems = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!orderedChatIds?.length) return lang('Loading');
    const chatsById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().chats.byId;
    return orderedChatIds.slice(0, PREVIEW_SLICE).map((chatId, i, arr) => {
      const isLast = i === arr.length - 1;
      const chat = chatsById[chatId];
      if (!chat) {
        return undefined;
      }
      const title = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getChatTitle)(lang, chat);
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].chat, archiveUnreadCount && chat.unreadCount && _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].unread)
      }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(title)), isLast ? '' : ', ');
    });
  }, [orderedChatIds, lang, archiveUnreadCount]);
  const contextActions = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const actionMinimize = !archiveSettings.isMinimized && {
      title: lang('ContextArchiveCollapse'),
      icon: 'collapse',
      handler: () => {
        updateArchiveSettings({
          isMinimized: true
        });
      }
    };
    const actionExpand = archiveSettings.isMinimized && {
      title: lang('ContextArchiveExpand'),
      icon: 'expand',
      handler: () => {
        updateArchiveSettings({
          isMinimized: false
        });
      }
    };
    const actionHide = {
      title: lang('ContextArchiveToMenu'),
      icon: 'archive-to-main',
      handler: () => {
        updateArchiveSettings({
          isHidden: true
        });
      }
    };
    return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.compact)([actionMinimize, actionExpand, actionHide]);
  }, [archiveSettings.isMinimized, lang, updateArchiveSettings]);
  const handleDragEnter = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(e => {
    e.preventDefault();
    onDragEnter?.();
  }, [onDragEnter]);
  function renderCollapsed() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].info, 'info')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "info-row"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('title', _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].title)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
      dir: "auto",
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].name, 'fullName')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
      name: "archive-filled",
      className: _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].icon
    }), lang('ArchivedChats'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Badge__WEBPACK_IMPORTED_MODULE_12__["default"], {
      className: _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].unreadCount,
      text: archiveUnreadCount ? (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_6__.formatIntegerCompact)(lang, archiveUnreadCount) : undefined
    })));
  }
  function renderRegular() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('status', _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].avatarWrapper)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
      peer: ARCHIVE_CUSTOM_PEER
    })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].info, 'info')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "info-row"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('title', _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].title)
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
      dir: "auto",
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].name, 'fullName')
    }, lang('ArchivedChats')))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "subtitle"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('status', _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].chatsPreview)
    }, previewItems), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Badge__WEBPACK_IMPORTED_MODULE_12__["default"], {
      className: _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].unreadCount,
      text: archiveUnreadCount ? (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_6__.formatIntegerCompact)(lang, archiveUnreadCount) : undefined
    }))));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    onClick: onClick,
    onDragEnter: handleDragEnter,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].root, archiveSettings.isMinimized && _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].minimized, 'chat-item-clickable', 'chat-item-archive'),
    buttonClassName: _Archive_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].button,
    contextActions: contextActions,
    withPortalForMenu: true
  }, archiveSettings.isMinimized ? renderCollapsed() : renderRegular());
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Archive));

/***/ },

/***/ "./src/components/left/main/Chat.scss"
/*!********************************************!*\
  !*** ./src/components/left/main/Chat.scss ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/left/main/Chat.tsx"
/*!*******************************************!*\
  !*** ./src/components/left/main/Chat.tsx ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_notifications__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/helpers/notifications */ "./src/global/helpers/notifications.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _chatAssistant_room_storage__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../chatAssistant/room-storage */ "./src/components/chatAssistant/room-storage/index.tsx");
/* harmony import */ var _hooks_data_useSelectorSignal__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/data/useSelectorSignal */ "./src/hooks/data/useSelectorSignal.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useChatContextActions__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useChatContextActions */ "./src/hooks/useChatContextActions.ts");
/* harmony import */ var _hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useEnsureMessage */ "./src/hooks/useEnsureMessage.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _hooks_useChatListEntry__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./hooks/useChatListEntry */ "./src/components/left/main/hooks/useChatListEntry.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_DeleteChatModal__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../common/DeleteChatModal */ "./src/components/common/DeleteChatModal.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_LastMessageMeta__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../common/LastMessageMeta */ "./src/components/common/LastMessageMeta.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ChatFolderModal_async__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../ChatFolderModal.async */ "./src/components/left/ChatFolderModal.async.tsx");
/* harmony import */ var _MuteChatModal_async__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../MuteChatModal.async */ "./src/components/left/MuteChatModal.async.tsx");
/* harmony import */ var _ChatBadge__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ChatBadge */ "./src/components/left/main/ChatBadge.tsx");
/* harmony import */ var _ChatCallStatus__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./ChatCallStatus */ "./src/components/left/main/ChatCallStatus.tsx");
/* harmony import */ var _Chat_scss__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./Chat.scss */ "./src/components/left/main/Chat.scss");


































const Chat = ({
  chatId,
  folderId,
  orderDiff,
  animationType,
  isPinned,
  listedTopicIds,
  topics,
  observeIntersection,
  chat,
  monoforumChannel,
  lastMessageStory,
  isMuted,
  user,
  userStatus,
  lastMessageSender,
  lastMessageOutgoingStatus,
  offsetTop,
  draft,
  withInterfaceAnimations,
  isSelected,
  isSelectedForum,
  isForumPanelOpen,
  canScrollDown,
  canChangeFolder,
  lastMessageTopic,
  typingStatus,
  lastMessageId,
  lastMessage,
  isSavedDialog,
  currentUserId,
  isPreview,
  previewMessageId,
  className,
  isSynced,
  onDragEnter,
  isAccountFrozen
}) => {
  const {
    openChat,
    openSavedDialog,
    toggleChatInfo,
    focusLastMessage,
    focusMessage,
    loadTopics,
    openForumPanel,
    closeForumPanel,
    setShouldCloseRightColumn,
    reportMessages,
    openFrozenAccountModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const [isDeleteModalOpen, openDeleteModal, closeDeleteModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const [isMuteModalOpen, openMuteModal, closeMuteModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const [isChatFolderModalOpen, openChatFolderModal, closeChatFolderModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const [shouldRenderDeleteModal, markRenderDeleteModal, unmarkRenderDeleteModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const [shouldRenderMuteModal, markRenderMuteModal, unmarkRenderMuteModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const [shouldRenderChatFolderModal, markRenderChatFolderModal, unmarkRenderChatFolderModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const {
    isForum,
    isForumAsMessages,
    isMonoforum
  } = chat || {};
  (0,_hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_15__["default"])(isSavedDialog ? currentUserId : chatId, lastMessageId, lastMessage);
  const {
    renderSubtitle,
    ref
  } = (0,_hooks_useChatListEntry__WEBPACK_IMPORTED_MODULE_20__["default"])({
    chat,
    chatId,
    lastMessage,
    typingStatus,
    draft,
    statefulMediaContent: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.groupStatefulContent)({
      story: lastMessageStory
    }),
    lastMessageTopic,
    lastMessageSender,
    observeIntersection,
    animationType,
    withInterfaceAnimations,
    orderDiff,
    isSavedDialog,
    isPreview,
    topics
  });
  const getIsForumPanelClosed = (0,_hooks_data_useSelectorSignal__WEBPACK_IMPORTED_MODULE_12__["default"])(_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsForumPanelClosed);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    // 记录点击事件到 RoomStorage
    _chatAssistant_room_storage__WEBPACK_IMPORTED_MODULE_11__["default"].incrementClickCount(chatId);
    const noForumTopicPanel = isMobile && isForumAsMessages;
    if (isMobile) {
      setShouldCloseRightColumn({
        value: true
      });
    }
    if (isPreview) {
      focusMessage({
        chatId,
        messageId: previewMessageId
      });
      return;
    }
    if (isSavedDialog) {
      openSavedDialog({
        chatId,
        noForumTopicPanel: true
      }, {
        forceOnHeavyAnimation: true
      });
      if (isMobile) {
        toggleChatInfo({
          force: false
        });
      }
      return;
    }
    if (isForum) {
      if (isForumPanelOpen) {
        closeForumPanel(undefined, {
          forceOnHeavyAnimation: true
        });
        return;
      } else {
        if (!noForumTopicPanel) {
          openForumPanel({
            chatId
          }, {
            forceOnHeavyAnimation: true
          });
        }
        if (!isForumAsMessages) return;
      }
    }
    openChat({
      id: chatId,
      noForumTopicPanel,
      shouldReplaceHistory: true
    }, {
      forceOnHeavyAnimation: true
    });
    if (isSelected && canScrollDown) {
      focusLastMessage();
    }
  });
  const handleDragEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(e => {
    e.preventDefault();
    onDragEnter?.(chatId);
  });
  const handleDelete = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    if (isAccountFrozen) {
      openFrozenAccountModal();
      return;
    }
    markRenderDeleteModal();
    openDeleteModal();
  });
  const handleMute = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    if (isAccountFrozen) {
      openFrozenAccountModal();
      return;
    }
    markRenderMuteModal();
    openMuteModal();
  });
  const handleChatFolderChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    markRenderChatFolderModal();
    openChatFolderModal();
  });
  const handleReport = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_18__["default"])(() => {
    if (isAccountFrozen) {
      openFrozenAccountModal();
      return;
    }
    if (!chat) return;
    reportMessages({
      chatId: chat.id,
      messageIds: []
    });
  });
  const contextActions = (0,_hooks_useChatContextActions__WEBPACK_IMPORTED_MODULE_14__["default"])({
    chat,
    user,
    handleDelete,
    handleMute,
    handleChatFolderChange,
    handleReport,
    folderId,
    isPinned,
    isMuted,
    canChangeFolder,
    isSavedDialog,
    currentUserId,
    isPreview,
    topics
  });
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_17__.useIsIntersecting)(ref, chat ? observeIntersection : undefined);

  // Load the forum topics to display unread count badge
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isIntersecting && isForum && isSynced && listedTopicIds === undefined) {
      loadTopics({
        chatId
      });
    }
  }, [chatId, listedTopicIds, isSynced, isForum, isIntersecting]);
  const isOnline = user && userStatus && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.isUserOnline)(user, userStatus);
  const {
    hasShownClass: isAvatarOnlineShown
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_19__["default"])(isOnline);
  const href = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_7__.IS_OPEN_IN_NEW_TAB_SUPPORTED) return undefined;
    if (isSavedDialog) {
      return `#${(0,_util_routing__WEBPACK_IMPORTED_MODULE_10__.createLocationHash)(currentUserId, 'thread', chatId)}`;
    }
    return `#${(0,_util_routing__WEBPACK_IMPORTED_MODULE_10__.createLocationHash)(chatId, 'thread', _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID)}`;
  }, [chatId, currentUserId, isSavedDialog]);
  if (!chat) {
    return undefined;
  }
  const peer = user || chat;
  const chatClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('Chat chat-item-clickable', (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_9__.isUserId)(chatId) ? 'private' : 'group', isForum && 'forum', isSelected && 'selected', isSelectedForum && 'selected-forum', isPreview && 'standalone', className);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_27__["default"], {
    ref: ref,
    className: chatClassName,
    href: href,
    style: `top: ${offsetTop}px`,
    ripple: !isForum && !isMobile,
    contextActions: contextActions,
    onClick: handleClick,
    onDragEnter: handleDragEnter,
    withPortalForMenu: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('status', 'status-clickable')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_21__["default"], {
    peer: isMonoforum ? monoforumChannel : peer,
    isSavedMessages: user?.isSelf,
    isSavedDialog: isSavedDialog,
    size: isPreview ? 'medium' : 'large',
    asMessageBubble: isMonoforum,
    withStory: !user?.isSelf && !isMonoforum,
    withStoryGap: isAvatarOnlineShown || Boolean(chat.subscriptionUntil),
    storyViewerOrigin: _types__WEBPACK_IMPORTED_MODULE_3__.StoryViewerOrigin.ChatList,
    storyViewerMode: "single-peer"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "avatar-badge-wrapper"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])('avatar-online', 'avatar-badge', isAvatarOnlineShown && 'avatar-online-shown')
  }), !isAvatarOnlineShown && Boolean(chat.subscriptionUntil) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_25__["default"], {
    type: "gold",
    className: "avatar-badge avatar-subscription",
    size: "adaptive"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatBadge__WEBPACK_IMPORTED_MODULE_30__["default"], {
    chat: chat,
    isMuted: isMuted,
    shouldShowOnlyMostImportant: true,
    forceHidden: getIsForumPanelClosed,
    topics: topics,
    isSelected: isSelected
  })), chat.isCallActive && chat.isCallNotEmpty && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatCallStatus__WEBPACK_IMPORTED_MODULE_31__["default"], {
    isMobile: isMobile,
    isSelected: isSelected,
    isActive: withInterfaceAnimations
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info-row"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_23__["default"], {
    peer: isMonoforum ? monoforumChannel : peer,
    isMonoforum: isMonoforum,
    monoforumBadgeClassName: "monoforum-badge",
    withEmojiStatus: true,
    isSavedMessages: chatId === user?.id && user?.isSelf,
    isSavedDialog: isSavedDialog,
    observeIntersection: observeIntersection
  }), isMuted && !isSavedDialog && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_24__["default"], {
    name: "muted"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "separator"
  }), lastMessage && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_LastMessageMeta__WEBPACK_IMPORTED_MODULE_26__["default"], {
    message: lastMessage,
    outgoingStatus: !isSavedDialog ? lastMessageOutgoingStatus : undefined,
    draftDate: draft?.date
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "subtitle"
  }, renderSubtitle(), !isPreview && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatBadge__WEBPACK_IMPORTED_MODULE_30__["default"], {
    chat: chat,
    isPinned: isPinned,
    isMuted: isMuted,
    isSavedDialog: isSavedDialog,
    hasMiniApp: user?.hasMainMiniApp,
    topics: topics,
    isSelected: isSelected
  }))), shouldRenderDeleteModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_DeleteChatModal__WEBPACK_IMPORTED_MODULE_22__["default"], {
    isOpen: isDeleteModalOpen,
    onClose: closeDeleteModal,
    onCloseAnimationEnd: unmarkRenderDeleteModal,
    chat: chat,
    isSavedDialog: isSavedDialog
  }), shouldRenderMuteModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MuteChatModal_async__WEBPACK_IMPORTED_MODULE_29__["default"], {
    isOpen: isMuteModalOpen,
    onClose: closeMuteModal,
    onCloseAnimationEnd: unmarkRenderMuteModal,
    chatId: chatId
  }), shouldRenderChatFolderModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatFolderModal_async__WEBPACK_IMPORTED_MODULE_28__["default"], {
    isOpen: isChatFolderModalOpen,
    onClose: closeChatFolderModal,
    onCloseAnimationEnd: unmarkRenderChatFolderModal,
    chatId: chatId
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  isSavedDialog,
  isPreview,
  previewMessageId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId);
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUser)(global, chatId);
  if (!chat) {
    return {
      currentUserId: global.currentUserId
    };
  }
  const lastMessageId = previewMessageId || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatLastMessageId)(global, chatId, isSavedDialog ? 'saved' : 'all');
  const lastMessage = previewMessageId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatMessage)(global, chatId, previewMessageId) : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChatLastMessage)(global, chatId, isSavedDialog ? 'saved' : 'all');
  const {
    isOutgoing,
    forwardInfo
  } = lastMessage || {};
  const savedDialogSender = isSavedDialog && forwardInfo?.fromId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeer)(global, forwardInfo.fromId) : undefined;
  const messageSender = lastMessage ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectSender)(global, lastMessage) : undefined;
  const lastMessageSender = savedDialogSender || messageSender;
  const {
    chatId: currentChatId,
    threadId: currentThreadId,
    type: messageListType
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global) || {};
  const isSelected = !isPreview && chatId === currentChatId && (isSavedDialog ? chatId === currentThreadId : currentThreadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID);
  const isSelectedForum = chat.isForum && chatId === currentChatId || chatId === (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global).forumPanelChatId;
  const userStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectUserStatus)(global, chatId);
  const lastMessageTopic = lastMessage && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopicFromMessage)(global, lastMessage);
  const typingStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectThreadParam)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID, 'typingStatus');
  const topicsInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopicsInfo)(global, chatId);
  const storyData = lastMessage?.content.storyData;
  const lastMessageStory = storyData && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectPeerStory)(global, storyData.peerId, storyData.id);
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsCurrentUserFrozen)(global);
  const monoforumChannel = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectMonoforumChannel)(global, chatId);
  return {
    chat,
    isMuted: (0,_global_helpers_notifications__WEBPACK_IMPORTED_MODULE_5__.getIsChatMuted)(chat, (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectNotifyDefaults)(global), (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectNotifyException)(global, chat.id)),
    lastMessageSender,
    draft: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectDraft)(global, chatId, _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID),
    isSelected,
    isSelectedForum,
    isForumPanelOpen: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsForumPanelOpen)(global),
    canScrollDown: isSelected && messageListType === 'thread',
    canChangeFolder: (global.chatFolders.orderedIds?.length || 0) > 1,
    ...(isOutgoing && lastMessage && {
      lastMessageOutgoingStatus: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectOutgoingStatus)(global, lastMessage)
    }),
    user,
    userStatus,
    lastMessageTopic,
    typingStatus,
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateInterface)(global),
    lastMessage,
    lastMessageId,
    currentUserId: global.currentUserId,
    listedTopicIds: topicsInfo?.listedTopicIds,
    topics: topicsInfo?.topicsById,
    isSynced: global.isSynced,
    lastMessageStory,
    isAccountFrozen,
    monoforumChannel
  };
})(Chat)));

/***/ },

/***/ "./src/components/left/main/ChatBadge.scss"
/*!*************************************************!*\
  !*** ./src/components/left/main/ChatBadge.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/left/main/ChatBadge.tsx"
/*!************************************************!*\
  !*** ./src/components/left/main/ChatBadge.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_signals__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/signals */ "./src/util/signals.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _util_themeStyle__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/themeStyle */ "./src/util/themeStyle.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ShowTransition__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/ShowTransition */ "./src/components/ui/ShowTransition.tsx");
/* harmony import */ var _ChatBadge_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./ChatBadge.scss */ "./src/components/left/main/ChatBadge.scss");

















const ChatBadge = ({
  topic,
  topics,
  chat,
  isPinned,
  isMuted,
  shouldShowOnlyMostImportant,
  wasTopicOpened,
  forceHidden,
  isSavedDialog,
  hasMiniApp,
  isSelected
}) => {
  const {
    requestMainWebView
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const {
    unreadMentionsCount = 0,
    unreadReactionsCount = 0
  } = !chat.isForum ? chat : {}; // TODO[forums] Unread mentions and reactions temporarily disabled for forums

  const isTopicUnopened = !isPinned && topic && !wasTopicOpened;
  const isForum = chat.isForum && !topic;
  const topicsWithUnread = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => isForum && topics ? Object.values(topics).filter(({
    unreadCount
  }) => unreadCount) : undefined, [topics, isForum]);
  const unreadCount = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isForum) {
      return (topic || chat).unreadCount;
    }
    return topicsWithUnread?.length;
  }, [chat, topic, topicsWithUnread, isForum]);
  const shouldBeUnMuted = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isForum) {
      return !isMuted || topic?.notifySettings.mutedUntil === 0;
    }
    if (isMuted) {
      return topicsWithUnread?.some(acc => acc.notifySettings.mutedUntil === 0);
    }
    const isEveryUnreadMuted = topicsWithUnread?.every(acc => acc.notifySettings.mutedUntil && acc.notifySettings.mutedUntil > (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_3__.getServerTime)());
    return !isEveryUnreadMuted;
  }, [isForum, isMuted, topicsWithUnread, topic?.notifySettings.mutedUntil]);
  const hasUnreadMark = topic ? false : chat.hasUnreadMark;
  const resolvedForceHidden = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_7__["default"])(() => (0,_util_signals__WEBPACK_IMPORTED_MODULE_4__.isSignal)(forceHidden) ? forceHidden() : forceHidden, [forceHidden]);
  const isShown = !resolvedForceHidden && Boolean(unreadCount || unreadMentionsCount || hasUnreadMark || isPinned || unreadReactionsCount || isTopicUnopened || hasMiniApp);
  const isUnread = Boolean((unreadCount || hasUnreadMark) && !isSavedDialog);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('ChatBadge', !shouldBeUnMuted && 'muted', !isUnread && isPinned && 'pinned', isUnread && 'unread');
  const handleOpenApp = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    e.stopPropagation();
    const theme = (0,_util_themeStyle__WEBPACK_IMPORTED_MODULE_6__.extractCurrentThemeParams)();
    requestMainWebView({
      botId: chat.id,
      peerId: chat.id,
      theme
    });
  });
  function renderContent() {
    const unreadReactionsElement = unreadReactionsCount && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('ChatBadge reaction', !shouldBeUnMuted && 'muted')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
      name: "heart"
    }));
    const unreadMentionsElement = unreadMentionsCount && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "ChatBadge mention"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
      name: "mention"
    }));
    const unopenedTopicElement = isTopicUnopened && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('ChatBadge unopened', !shouldBeUnMuted && 'muted')
    });
    const unreadCountElement = hasUnreadMark || unreadCount ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: className
    }, !hasUnreadMark && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_11__["default"], {
      text: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_5__.formatIntegerCompact)(lang, unreadCount)
    })) : undefined;
    const pinnedElement = isPinned && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: className
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
      name: "pinned-chat"
    }));
    const miniAppButton = hasMiniApp && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_13__["default"], {
      color: isSelected ? 'secondary' : 'primary',
      className: "ChatBadge miniapp",
      pill: true,
      size: "tiny",
      onClick: handleOpenApp
    }, oldLang('BotOpen'));
    const visiblePinnedElement = !unreadCountElement && !unreadMentionsElement && !unreadReactionsElement && pinnedElement;
    const elements = [unopenedTopicElement, unreadReactionsElement, unreadMentionsElement, unreadCountElement, visiblePinnedElement].filter(Boolean);
    if (isSavedDialog) return pinnedElement;

    // Show only if empty or have pinned icon
    if (hasMiniApp && (elements.length === 0 || visiblePinnedElement)) return miniAppButton;
    if (elements.length === 0) return undefined;
    if (elements.length === 1) return elements[0];
    if (shouldShowOnlyMostImportant) {
      const importanceOrderedElements = [unreadMentionsElement, unreadCountElement, unreadReactionsElement, pinnedElement].filter(Boolean);
      return importanceOrderedElements[0];
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "ChatBadge-wrapper"
    }, elements);
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ShowTransition__WEBPACK_IMPORTED_MODULE_14__["default"], {
    isCustom: true,
    className: "ChatBadge-transition",
    isOpen: isShown
  }, renderContent());
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ChatBadge));

/***/ },

/***/ "./src/components/left/main/ChatCallStatus.module.scss"
/*!*************************************************************!*\
  !*** ./src/components/left/main/ChatCallStatus.module.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"byPckqUT","indicator":"nl36F75B","indicatorInner":"AA5s1Pu4","selected":"qy2i51dM","active":"IsUWP16T","bar-animation-transform-2":"p_1Kbke9","barAnimationTransform2":"p_1Kbke9","bar-animation-transform-1":"gOCprMbJ","barAnimationTransform1":"gOCprMbJ"});

/***/ },

/***/ "./src/components/left/main/ChatCallStatus.tsx"
/*!*****************************************************!*\
  !*** ./src/components/left/main/ChatCallStatus.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _ChatCallStatus_module_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ChatCallStatus.module.scss */ "./src/components/left/main/ChatCallStatus.module.scss");




const ChatCallStatus = ({
  isSelected,
  isActive,
  isMobile
}) => {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_ChatCallStatus_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].root, isActive && _ChatCallStatus_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].active, isSelected && !isMobile && _ChatCallStatus_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].selected)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatCallStatus_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].indicator
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatCallStatus_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].indicatorInner
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatCallStatus_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].indicatorInner
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ChatCallStatus_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].indicatorInner
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ChatCallStatus));

/***/ },

/***/ "./src/components/left/main/ChatList.tsx"
/*!***********************************************!*\
  !*** ./src/components/left/main/ChatList.tsx ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_folderManager__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/folderManager */ "./src/util/folderManager.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _chatAssistant_global_summary_chat_serana_teact__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../chatAssistant/global-summary/chat-serana.teact */ "./src/components/chatAssistant/global-summary/chat-serana.teact.tsx");
/* harmony import */ var _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../chatAssistant/variables */ "./src/components/chatAssistant/variables.ts");
/* harmony import */ var _hooks_polling_usePeerStoriesPolling__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/polling/usePeerStoriesPolling */ "./src/hooks/polling/usePeerStoriesPolling.ts");
/* harmony import */ var _hooks_scroll_useTopOverscroll__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/scroll/useTopOverscroll */ "./src/hooks/scroll/useTopOverscroll.tsx");
/* harmony import */ var _hooks_useDebouncedCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useDebouncedCallback */ "./src/hooks/useDebouncedCallback.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useInfiniteScroll */ "./src/hooks/useInfiniteScroll.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOrderDiff__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./hooks/useOrderDiff */ "./src/components/left/main/hooks/useOrderDiff.ts");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _Archive__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./Archive */ "./src/components/left/main/Archive.tsx");
/* harmony import */ var _Chat__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./Chat */ "./src/components/left/main/Chat.tsx");
/* harmony import */ var _EmptyFolder__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./EmptyFolder */ "./src/components/left/main/EmptyFolder.tsx");
/* harmony import */ var _FrozenAccountNotification__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./FrozenAccountNotification */ "./src/components/left/main/FrozenAccountNotification.tsx");
/* harmony import */ var _UnconfirmedSession__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./UnconfirmedSession */ "./src/components/left/main/UnconfirmedSession.tsx");



























const INTERSECTION_THROTTLE = 200;
const DRAG_ENTER_DEBOUNCE = 500;
const RESERVED_HOTKEYS = new Set(['9', '0']);
const ChatList = ({
  className,
  folderType,
  folderId,
  isActive,
  isForumPanelOpen,
  canDisplayArchive,
  archiveSettings,
  sessions,
  foldersDispatch,
  onSettingsScreenSelect,
  onLeftColumnContentChange,
  isAccountFrozen,
  isMainList
}) => {
  const {
    openChat,
    openNextChat,
    closeForumPanel,
    toggleStoryRibbon,
    openFrozenAccountModal,
    openLeftColumnContent
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const shouldIgnoreDragRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const [unconfirmedSessionHeight, setUnconfirmedSessionHeight] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const isArchived = folderType === 'archived';
  const isAllFolder = folderType === 'all';
  const isSaved = folderType === 'saved';
  const isPresetFolder = folderType === 'preset';
  const isUnreadFolder = folderType === 'unread';
  const isAIFolder = folderType === 'ai';
  const resolvedFolderId = isAllFolder ? _config__WEBPACK_IMPORTED_MODULE_3__.ALL_FOLDER_ID : isArchived ? _config__WEBPACK_IMPORTED_MODULE_3__.ARCHIVED_FOLDER_ID : isSaved ? _config__WEBPACK_IMPORTED_MODULE_3__.SAVED_FOLDER_ID : isPresetFolder ? _config__WEBPACK_IMPORTED_MODULE_3__.PRESET_FOLDER_ID : isUnreadFolder ? _config__WEBPACK_IMPORTED_MODULE_3__.UNREAD_FOLDER_ID : isAIFolder ? _config__WEBPACK_IMPORTED_MODULE_3__.AI_FOLDER_ID : folderId;
  const shouldDisplayArchive = isAllFolder && canDisplayArchive && archiveSettings;
  const shouldShowFrozenAccountNotification = isAccountFrozen && isAllFolder;
  const orderedIds = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_13__.useFolderManagerForOrderedIds)(resolvedFolderId);
  (0,_hooks_polling_usePeerStoriesPolling__WEBPACK_IMPORTED_MODULE_10__["default"])(orderedIds);
  const chatsHeight = (orderedIds?.length || 0) * _config__WEBPACK_IMPORTED_MODULE_3__.CHAT_HEIGHT_PX;
  const archiveHeight = shouldDisplayArchive ? archiveSettings?.isMinimized ? _config__WEBPACK_IMPORTED_MODULE_3__.ARCHIVE_MINIMIZED_HEIGHT : _config__WEBPACK_IMPORTED_MODULE_3__.CHAT_HEIGHT_PX : 0;
  const frozenNotificationHeight = shouldShowFrozenAccountNotification ? 68 : 0;
  const {
    orderDiffById,
    getAnimationType
  } = (0,_hooks_useOrderDiff__WEBPACK_IMPORTED_MODULE_18__["default"])(orderedIds);
  const [viewportIds, getMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_15__["default"])(undefined, orderedIds, undefined, _config__WEBPACK_IMPORTED_MODULE_3__.CHAT_LIST_SLICE);
  const shouldShowUnconfirmedSessions = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const sessionsArray = Object.values(sessions || {});
    const current = sessionsArray.find(session => session.isCurrent);
    if (!current || (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)() - current.dateCreated < _config__WEBPACK_IMPORTED_MODULE_3__.FRESH_AUTH_PERIOD) return false;
    return !isAccountFrozen && isAllFolder && sessionsArray.some(session => session.isUnconfirmed);
  }, [isAllFolder, sessions, isAccountFrozen]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!shouldShowUnconfirmedSessions) setUnconfirmedSessionHeight(0);
  }, [shouldShowUnconfirmedSessions]);

  // Support <Alt>+<Up/Down> to navigate between chats
  (0,_hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_14__.useHotkeys)((0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => isActive && orderedIds?.length ? {
    'Alt+ArrowUp': e => {
      e.preventDefault();
      openNextChat({
        targetIndexDelta: -1,
        orderedIds
      });
    },
    'Alt+ArrowDown': e => {
      e.preventDefault();
      openNextChat({
        targetIndexDelta: 1,
        orderedIds
      });
    }
  } : undefined, [isActive, orderedIds]));

  // Support <Cmd>+<Digit> to navigate between chats
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isActive || isSaved || !orderedIds || !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_APP) {
      return undefined;
    }
    function handleKeyDown(e) {
      if ((_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_MAC_OS && e.metaKey || !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_MAC_OS && e.ctrlKey) && e.code.startsWith('Digit')) {
        const [, digit] = e.code.match(/Digit(\d)/) || [];
        if (!digit || RESERVED_HOTKEYS.has(digit)) return;
        const isArchiveInList = shouldDisplayArchive && archiveSettings && !archiveSettings.isMinimized;
        const shift = isArchiveInList ? -1 : 0;
        const position = Number(digit) + shift - 1;
        if (isArchiveInList && position === -1) {
          if (isMainList) openLeftColumnContent({
            contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived
          });
          return;
        }
        if (position > orderedIds.length - 1) return;
        openChat({
          id: orderedIds[position],
          shouldReplaceHistory: true
        });
      }
    }
    document.addEventListener('keydown', handleKeyDown);
    return () => {
      document.removeEventListener('keydown', handleKeyDown);
    };
  }, [archiveSettings, isSaved, isActive, openChat, openNextChat, orderedIds, shouldDisplayArchive, isMainList]);
  const {
    observe
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_16__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE
  });
  const handleArchivedClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    openLeftColumnContent({
      contentKey: _types__WEBPACK_IMPORTED_MODULE_2__.LeftColumnContent.Archived
    });
    closeForumPanel();
  });
  const handleFrozenAccountNotificationClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    openFrozenAccountModal();
  });
  const handleArchivedDragEnter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (shouldIgnoreDragRef.current) {
      shouldIgnoreDragRef.current = false;
      return;
    }
    handleArchivedClick();
  });
  const handleDragEnter = (0,_hooks_useDebouncedCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(chatId => {
    if (shouldIgnoreDragRef.current) {
      shouldIgnoreDragRef.current = false;
      return;
    }
    openChat({
      id: chatId,
      shouldReplaceHistory: true
    });
  }, [openChat], DRAG_ENTER_DEBOUNCE, true);
  const handleDragLeave = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(e => {
    const rect = e.currentTarget.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    if (x < rect.width || y < rect.y) return;
    shouldIgnoreDragRef.current = true;
  });
  const handleShowStoryRibbon = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    toggleStoryRibbon({
      isShown: true,
      isArchived
    });
  });
  const handleHideStoryRibbon = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    toggleStoryRibbon({
      isShown: false,
      isArchived
    });
  });
  const renderedOverflowTrigger = (0,_hooks_scroll_useTopOverscroll__WEBPACK_IMPORTED_MODULE_11__["default"])(containerRef, handleShowStoryRibbon, handleHideStoryRibbon, isSaved);
  function renderChats() {
    const viewportOffset = orderedIds.indexOf(viewportIds[0]);
    const pinnedCount = (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_6__.getPinnedChatsCount)(resolvedFolderId) || 0;
    return viewportIds.map((id, i) => {
      const isPinned = viewportOffset + i < pinnedCount + 1;
      const offsetTop = unconfirmedSessionHeight + archiveHeight + frozenNotificationHeight + (viewportOffset + i) * _config__WEBPACK_IMPORTED_MODULE_3__.CHAT_HEIGHT_PX;
      return id === _chatAssistant_variables__WEBPACK_IMPORTED_MODULE_9__.GLOBAL_SUMMARY_CHATID ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_global_summary_chat_serana_teact__WEBPACK_IMPORTED_MODULE_8__["default"], {
        key: "serena"
        // frozenNotificationHeight={frozenNotificationHeight}
        // archiveHeight={archiveHeight}
        // unconfirmedSessionHeight={unconfirmedSessionHeight}
        ,
        offsetTop: offsetTop
      }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Chat__WEBPACK_IMPORTED_MODULE_22__["default"], {
        key: id,
        teactOrderKey: isPinned ? i : (0,_util_folderManager__WEBPACK_IMPORTED_MODULE_6__.getOrderKey)(id, isSaved),
        chatId: id,
        isPinned: isPinned,
        folderId: folderId,
        isSavedDialog: isSaved,
        animationType: getAnimationType(id),
        orderDiff: orderDiffById[id],
        offsetTop: offsetTop,
        observeIntersection: observe,
        onDragEnter: handleDragEnter
      });
    });
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_19__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('chat-list custom-scroll', isForumPanelOpen && 'forum-panel-open', className),
    ref: containerRef,
    items: viewportIds,
    itemSelector: ".ListItem:not(.chat-item-archive)",
    preloadBackwards: _config__WEBPACK_IMPORTED_MODULE_3__.CHAT_LIST_SLICE,
    withAbsolutePositioning: true,
    beforeChildren: renderedOverflowTrigger,
    maxHeight: chatsHeight + archiveHeight + frozenNotificationHeight + unconfirmedSessionHeight,
    onLoadMore: getMore,
    onDragLeave: handleDragLeave
  }, shouldShowUnconfirmedSessions && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_UnconfirmedSession__WEBPACK_IMPORTED_MODULE_25__["default"], {
    key: "unconfirmed",
    sessions: sessions,
    onHeightChange: setUnconfirmedSessionHeight
  }), shouldShowFrozenAccountNotification && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FrozenAccountNotification__WEBPACK_IMPORTED_MODULE_24__["default"], {
    key: "frozen",
    onClick: handleFrozenAccountNotificationClick
  }), shouldDisplayArchive && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Archive__WEBPACK_IMPORTED_MODULE_21__["default"], {
    key: "archive",
    archiveSettings: archiveSettings,
    onClick: handleArchivedClick,
    onDragEnter: handleArchivedDragEnter
  }), viewportIds?.length ? renderChats() : viewportIds && !viewportIds.length && !isSaved ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_EmptyFolder__WEBPACK_IMPORTED_MODULE_23__["default"], {
    folderId: folderId,
    folderType: folderType,
    foldersDispatch: foldersDispatch
  }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_20__["default"], {
    key: "loading"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(ChatList));

/***/ },

/***/ "./src/components/left/main/EmptyFolder.module.scss"
/*!**********************************************************!*\
  !*** ./src/components/left/main/EmptyFolder.module.scss ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"yftKUVDQ","sticker":"UCBfMOiz","title":"dB9cHelg","description":"TJ_liZcJ","is-ios":"z51XfrFn","isIos":"z51XfrFn","is-macos":"tiLqJXxs","isMacos":"tiLqJXxs","button-text":"aL7e0w4t","buttonText":"aL7e0w4t","centered":"NefQ8HbN"});

/***/ },

/***/ "./src/components/left/main/EmptyFolder.tsx"
/*!**************************************************!*\
  !*** ./src/components/left/main/EmptyFolder.tsx ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _EmptyFolder_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./EmptyFolder.module.scss */ "./src/components/left/main/EmptyFolder.module.scss");











const ICON_SIZE = 96;
const EmptyFolder = ({
  chatFolder,
  animatedEmoji,
  foldersDispatch
}) => {
  const {
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const handleEditFolder = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    foldersDispatch({
      type: 'editFolder',
      payload: chatFolder
    });
    openSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.FoldersEditFolderFromChatList
    });
  }, [chatFolder, foldersDispatch]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _EmptyFolder_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _EmptyFolder_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].sticker
  }, animatedEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_6__["default"], {
    sticker: animatedEmoji,
    size: ICON_SIZE
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: _EmptyFolder_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].title,
    dir: "auto"
  }, lang('FilterNoChatsToDisplay')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _EmptyFolder_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].description,
    dir: "auto"
  }, lang(chatFolder ? 'ChatList.EmptyChatListFilterText' : 'Chat.EmptyChat')), chatFolder && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_8__["default"], {
    ripple: !isMobile,
    fluid: true,
    pill: true,
    onClick: handleEditFolder,
    size: "smaller",
    isRtl: lang.isRtl
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_7__["default"], {
    name: "settings"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _EmptyFolder_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].buttonText
  }, lang('ChatList.EmptyChatListEditFilter'))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  folderId,
  folderType
}) => {
  const chatFolder = folderId && folderType === 'folder' ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatFolder)(global, folderId) : undefined;
  return {
    chatFolder,
    animatedEmoji: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectAnimatedEmoji)(global, '📂')
  };
})(EmptyFolder)));

/***/ },

/***/ "./src/components/left/main/EmptyForum.module.scss"
/*!*********************************************************!*\
  !*** ./src/components/left/main/EmptyForum.module.scss ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Ky16H_sV","button-text":"W01t9CIf","buttonText":"W01t9CIf","sticker":"c8lE3XW5","title":"wlwD1B1Q","description":"V8OCFHmp","is-ios":"IxW_z_r0","isIos":"IxW_z_r0","is-macos":"OFxKGCEJ","isMacos":"OFxKGCEJ"});

/***/ },

/***/ "./src/components/left/main/EmptyForum.tsx"
/*!*************************************************!*\
  !*** ./src/components/left/main/EmptyForum.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _EmptyForum_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./EmptyForum.module.scss */ "./src/components/left/main/EmptyForum.module.scss");












const ICON_SIZE = 7 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_5__.REM;
const EmptyForum = ({
  chatId,
  animatedEmoji,
  canManageTopics
}) => {
  const {
    openCreateTopicPanel
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const handleCreateTopic = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    openCreateTopicPanel({
      chatId
    });
  }, [chatId, openCreateTopicPanel]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _EmptyForum_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _EmptyForum_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].sticker
  }, animatedEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_8__["default"], {
    sticker: animatedEmoji,
    size: ICON_SIZE
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    className: _EmptyForum_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].title,
    dir: "auto"
  }, lang('ChatList.EmptyTopicsTitle')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_EmptyForum_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].description, _EmptyForum_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].centered),
    dir: "auto"
  }, lang('ChatList.EmptyTopicsDescription')), canManageTopics && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
    ripple: !isMobile,
    fluid: true,
    onClick: handleCreateTopic,
    size: "smaller",
    isRtl: lang.isRtl
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _EmptyForum_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].buttonText
  }, lang('ChatList.EmptyTopicsCreate'))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  const canManageTopics = chat && (chat.isCreator || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getHasAdminRight)(chat, 'manageTopics'));
  return {
    animatedEmoji: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectAnimatedEmoji)(global, '🐣'),
    canManageTopics
  };
})(EmptyForum)));

/***/ },

/***/ "./src/components/left/main/ForumPanel.module.scss"
/*!*********************************************************!*\
  !*** ./src/components/left/main/ForumPanel.module.scss ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"MlF2n1nb","rtl":"Xs2y1fCE","no-animation":"kmDMv6D8","noAnimation":"kmDMv6D8","notch":"hGeb3TQJ","scrolled":"SZ24u3cn","scroll-top-handler":"ERz3fcar","scrollTopHandler":"ERz3fcar","info":"Sf633zAP"});

/***/ },

/***/ "./src/components/left/main/ForumPanel.tsx"
/*!*************************************************!*\
  !*** ./src/components/left/main/ForumPanel.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/cssAnimationEndListeners */ "./src/util/cssAnimationEndListeners.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useHistoryBack */ "./src/hooks/useHistoryBack.ts");
/* harmony import */ var _hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useInfiniteScroll */ "./src/hooks/useInfiniteScroll.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useOrderDiff__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./hooks/useOrderDiff */ "./src/components/left/main/hooks/useOrderDiff.ts");
/* harmony import */ var _calls_group_GroupCallTopPane__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../calls/group/GroupCallTopPane */ "./src/components/calls/group/GroupCallTopPane.tsx");
/* harmony import */ var _common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../common/GroupChatInfo */ "./src/components/common/GroupChatInfo.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _middle_HeaderActions__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../middle/HeaderActions */ "./src/components/middle/HeaderActions.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Loading__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../ui/Loading */ "./src/components/ui/Loading.tsx");
/* harmony import */ var _EmptyForum__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./EmptyForum */ "./src/components/left/main/EmptyForum.tsx");
/* harmony import */ var _Topic__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./Topic */ "./src/components/left/main/Topic.tsx");
/* harmony import */ var _ForumPanel_module_scss__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./ForumPanel.module.scss */ "./src/components/left/main/ForumPanel.module.scss");































const INTERSECTION_THROTTLE = 200;
const ForumPanel = ({
  chat,
  currentTopicId,
  isOpen,
  isHidden,
  topicsInfo,
  onTopicSearch,
  onCloseAnimationEnd,
  onOpenAnimationStart,
  withInterfaceAnimations
}) => {
  const {
    closeForumPanel,
    openChatWithInfo,
    loadTopics
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const scrollTopHandlerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const chatId = chat?.id;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId && !topicsInfo) {
      loadTopics({
        chatId
      });
    }
  }, [topicsInfo, chatId]);
  const [isScrolled, setIsScrolled] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_17__["default"])();
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    closeForumPanel();
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!withInterfaceAnimations && !isOpen) {
      onCloseAnimationEnd?.();
    }
  }, [withInterfaceAnimations, isOpen, onCloseAnimationEnd]);
  const handleToggleChatInfo = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(() => {
    if (!chat) return;
    openChatWithInfo({
      id: chat.id,
      shouldReplaceHistory: true
    });
  });
  const {
    observe
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_15__.useIntersectionObserver)({
    rootRef: containerRef,
    throttleMs: INTERSECTION_THROTTLE
  });
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_15__.useOnIntersect)(scrollTopHandlerRef, observe, ({
    isIntersecting
  }) => {
    setIsScrolled(!isIntersecting);
  });
  const orderedIds = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return topicsInfo ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getOrderedTopics)(Object.values(topicsInfo.topicsById), topicsInfo.orderedPinnedTopicIds).map(({
      id
    }) => id) : [];
  }, [topicsInfo]);
  const {
    orderDiffById,
    getAnimationType
  } = (0,_hooks_useOrderDiff__WEBPACK_IMPORTED_MODULE_19__["default"])(orderedIds, chat?.id);
  const [viewportIds, getMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    if (!chat) return;
    loadTopics({
      chatId: chat.id
    });
  }, orderedIds, !topicsInfo?.totalCount || orderedIds.length >= topicsInfo.totalCount, _config__WEBPACK_IMPORTED_MODULE_3__.TOPICS_SLICE);
  const shouldRenderRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const isVisible = isOpen && !isHidden;
  const prevIsVisible = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_18__["default"])(isVisible);
  if (prevIsVisible !== isVisible) {
    shouldRenderRef.current = false;
  }
  (0,_hooks_useHistoryBack__WEBPACK_IMPORTED_MODULE_13__["default"])({
    isActive: isVisible,
    onBack: handleClose
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isVisible ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_9__["default"])(handleClose) : undefined, [handleClose, isVisible]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (prevIsVisible !== isVisible) {
      // For performance reasons, we delay animation of the topic list panel to the next animation frame
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestNextMutation)(() => {
        if (!ref.current) return;
        const endHeavyAnimation = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.beginHeavyAnimation)();
        (0,_util_cssAnimationEndListeners__WEBPACK_IMPORTED_MODULE_11__.waitForTransitionEnd)(ref.current, endHeavyAnimation);
        onOpenAnimationStart?.();
        if (isVisible) {
          shouldRenderRef.current = true;
          ref.current.style.transform = 'none';
        } else {
          shouldRenderRef.current = false;
          ref.current.style.transform = '';
        }
      });
    }
  }, [isVisible, onOpenAnimationStart, prevIsVisible]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_7__.IS_TOUCH_ENV) {
      return undefined;
    }
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_10__.captureEvents)(ref.current, {
      selectorToPreventScroll: '.chat-list',
      onSwipe: (e, direction) => {
        const closeDirection = lang.isRtl ? _util_captureEvents__WEBPACK_IMPORTED_MODULE_10__.SwipeDirection.Left : _util_captureEvents__WEBPACK_IMPORTED_MODULE_10__.SwipeDirection.Right;
        if (direction === closeDirection) {
          closeForumPanel();
          return true;
        }
        return false;
      }
    });
  }, [closeForumPanel, lang.isRtl]);
  function renderTopics() {
    const viewportOffset = orderedIds.indexOf(viewportIds[0]);
    return viewportIds?.map((id, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Topic__WEBPACK_IMPORTED_MODULE_28__["default"], {
      key: id,
      chatId: chat.id,
      topic: topicsInfo.topicsById[id],
      style: `top: ${(viewportOffset + i) * _config__WEBPACK_IMPORTED_MODULE_3__.TOPIC_HEIGHT_PX}px;`,
      isSelected: currentTopicId === id,
      observeIntersection: observe,
      animationType: getAnimationType(id),
      orderDiff: orderDiffById[id]
    }));
  }
  const isLoading = topicsInfo === undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_8__["default"])(_ForumPanel_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].root, isScrolled && _ForumPanel_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].scrolled, lang.isRtl && _ForumPanel_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].rtl, !withInterfaceAnimations && _ForumPanel_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].noAnimation),
    onTransitionEnd: !isOpen ? onCloseAnimationEnd : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: "TopicListHeader",
    className: "left-header"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    round: true,
    size: "smaller",
    color: "translucent",
    onClick: handleClose,
    ariaLabel: lang('Close')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_22__["default"], {
    name: "close"
  })), chat && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_GroupChatInfo__WEBPACK_IMPORTED_MODULE_21__["default"], {
    noAvatar: true,
    className: _ForumPanel_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].info,
    chatId: chat.id,
    onClick: handleToggleChatInfo
  }), chat && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_middle_HeaderActions__WEBPACK_IMPORTED_MODULE_23__["default"], {
    chatId: chat.id,
    threadId: _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
    messageListType: "thread",
    canExpandActions: false,
    isForForum: true,
    isMobile: isMobile,
    onTopicSearch: onTopicSearch,
    showInviteButton: false
  })), chat && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_calls_group_GroupCallTopPane__WEBPACK_IMPORTED_MODULE_20__["default"], {
    chatId: chat.id
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _ForumPanel_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].notch
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_25__["default"], {
    className: "chat-list custom-scroll",
    ref: containerRef,
    items: viewportIds,
    preloadBackwards: _config__WEBPACK_IMPORTED_MODULE_3__.TOPICS_SLICE,
    withAbsolutePositioning: true,
    maxHeight: (orderedIds?.length || 0) * _config__WEBPACK_IMPORTED_MODULE_3__.TOPIC_HEIGHT_PX,
    onLoadMore: getMore,
    sensitiveArea: _config__WEBPACK_IMPORTED_MODULE_3__.TOPIC_LIST_SENSITIVE_AREA,
    beforeChildren: /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      ref: scrollTopHandlerRef,
      className: _ForumPanel_module_scss__WEBPACK_IMPORTED_MODULE_29__["default"].scrollTopHandler
    })
  }, Boolean(viewportIds?.length) && renderTopics(), isLoading && !viewportIds?.length && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Loading__WEBPACK_IMPORTED_MODULE_26__["default"], {
    key: "loading"
  })), !isLoading && viewportIds?.length === 1 && viewportIds[0] === _config__WEBPACK_IMPORTED_MODULE_3__.GENERAL_TOPIC_ID && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_EmptyForum__WEBPACK_IMPORTED_MODULE_27__["default"], {
    chatId: chatId
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const chatId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTabState)(global).forumPanelChatId;
  const chat = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectChat)(global, chatId) : undefined;
  const {
    chatId: currentChatId,
    threadId: currentThreadId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCurrentMessageList)(global) || {};
  const topicsInfo = chatId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectTopicsInfo)(global, chatId) : undefined;
  return {
    chat,
    currentTopicId: chatId === currentChatId ? Number(currentThreadId) : undefined,
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectCanAnimateInterface)(global),
    topicsInfo
  };
}, global => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_6__.selectIsForumPanelOpen)(global))(ForumPanel)));

/***/ },

/***/ "./src/components/left/main/FrozenAccountNotification.module.scss"
/*!************************************************************************!*\
  !*** ./src/components/left/main/FrozenAccountNotification.module.scss ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"fOmerTkM","title":"URLYINJA","subtitle":"mCFsx7Tv"});

/***/ },

/***/ "./src/components/left/main/FrozenAccountNotification.tsx"
/*!****************************************************************!*\
  !*** ./src/components/left/main/FrozenAccountNotification.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _FrozenAccountNotification_module_scss__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./FrozenAccountNotification.module.scss */ "./src/components/left/main/FrozenAccountNotification.module.scss");




const FrozenAccountNotification = ({
  onClick
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_1__["default"])();
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FrozenAccountNotification_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].root,
    onClick: onClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FrozenAccountNotification_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].title
  }, lang('TitleFrozenAccount')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FrozenAccountNotification_module_scss__WEBPACK_IMPORTED_MODULE_2__["default"].subtitle
  }, lang('SubtitleFrozenAccount')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(FrozenAccountNotification));

/***/ },

/***/ "./src/components/left/main/Topic.module.scss"
/*!****************************************************!*\
  !*** ./src/components/left/main/Topic.module.scss ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Fn34Vu_9","closed-icon":"MB7Gomjn","closedIcon":"MB7Gomjn","topic-icon":"oXJl4tra","topicIcon":"oXJl4tra"});

/***/ },

/***/ "./src/components/left/main/Topic.tsx"
/*!********************************************!*\
  !*** ./src/components/left/main/Topic.tsx ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_notifications__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/notifications */ "./src/global/helpers/notifications.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_routing__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/routing */ "./src/util/routing.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useChatListEntry__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./hooks/useChatListEntry */ "./src/components/left/main/hooks/useChatListEntry.tsx");
/* harmony import */ var _hooks_useTopicContextActions__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./hooks/useTopicContextActions */ "./src/components/left/main/hooks/useTopicContextActions.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_LastMessageMeta__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/LastMessageMeta */ "./src/components/common/LastMessageMeta.tsx");
/* harmony import */ var _common_TopicIcon__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/TopicIcon */ "./src/components/common/TopicIcon.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _MuteChatModal_async__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../MuteChatModal.async */ "./src/components/left/MuteChatModal.async.tsx");
/* harmony import */ var _ChatBadge__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./ChatBadge */ "./src/components/left/main/ChatBadge.tsx");
/* harmony import */ var _Topic_module_scss__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./Topic.module.scss */ "./src/components/left/main/Topic.module.scss");























const Topic = ({
  topic,
  isSelected,
  chatId,
  chat,
  isChatMuted,
  style,
  lastMessage,
  lastMessageStory,
  canScrollDown,
  lastMessageOutgoingStatus,
  observeIntersection,
  canDelete,
  lastMessageSender,
  animationType,
  withInterfaceAnimations,
  orderDiff,
  typingStatus,
  draft,
  wasTopicOpened,
  topics
}) => {
  const {
    openThread,
    deleteTopic,
    focusLastMessage,
    setViewForumAsMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const [isDeleteModalOpen, openDeleteModal, closeDeleteModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [isMuteModalOpen, openMuteModal, closeMuteModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [shouldRenderDeleteModal, markRenderDeleteModal, unmarkRenderDeleteModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [shouldRenderMuteModal, markRenderMuteModal, unmarkRenderMuteModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const {
    isPinned,
    isClosed,
    notifySettings
  } = topic;
  const isMuted = Boolean(notifySettings.mutedUntil || notifySettings.mutedUntil === undefined && isChatMuted);
  const handleOpenDeleteModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    markRenderDeleteModal();
    openDeleteModal();
  });
  const handleDelete = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    deleteTopic({
      chatId: chat.id,
      topicId: topic.id
    });
  });
  const handleMute = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    markRenderMuteModal();
    openMuteModal();
  });
  const {
    renderSubtitle,
    ref
  } = (0,_hooks_useChatListEntry__WEBPACK_IMPORTED_MODULE_12__["default"])({
    chat,
    chatId,
    lastMessage,
    draft,
    lastMessageSender,
    lastMessageTopic: topic,
    observeIntersection,
    isTopic: true,
    typingStatus,
    topics,
    statefulMediaContent: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.groupStatefulContent)({
      story: lastMessageStory
    }),
    animationType,
    withInterfaceAnimations,
    orderDiff
  });
  const handleOpenTopic = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openThread({
      chatId,
      threadId: topic.id,
      shouldReplaceHistory: true
    });
    setViewForumAsMessages({
      chatId,
      isEnabled: false
    });
    if (canScrollDown) {
      focusLastMessage();
    }
  });
  const contextActions = (0,_hooks_useTopicContextActions__WEBPACK_IMPORTED_MODULE_13__["default"])({
    topic,
    chat,
    isChatMuted,
    wasOpened: wasTopicOpened,
    canDelete,
    handleDelete: handleOpenDeleteModal,
    handleMute
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ListItem__WEBPACK_IMPORTED_MODULE_18__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_Topic_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].root, 'Chat', isSelected && 'selected', 'chat-item-clickable'),
    onClick: handleOpenTopic,
    style: style,
    href: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_OPEN_IN_NEW_TAB_SUPPORTED ? `#${(0,_util_routing__WEBPACK_IMPORTED_MODULE_7__.createLocationHash)(chatId, 'thread', topic.id)}` : undefined,
    contextActions: contextActions,
    withPortalForMenu: true,
    ref: ref
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info-row"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('title')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_TopicIcon__WEBPACK_IMPORTED_MODULE_16__["default"], {
    topic: topic,
    className: _Topic_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].topicIcon,
    observeIntersection: observeIntersection
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
    dir: "auto",
    className: "fullName"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_8__["default"])(topic.title))), Boolean(notifySettings.mutedUntil) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_14__["default"], {
    name: "muted"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "separator"
  }), isClosed && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_14__["default"], {
    name: "lock-badge",
    className: _Topic_module_scss__WEBPACK_IMPORTED_MODULE_21__["default"].closedIcon
  }), lastMessage && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_LastMessageMeta__WEBPACK_IMPORTED_MODULE_15__["default"], {
    message: lastMessage,
    outgoingStatus: lastMessageOutgoingStatus
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "subtitle"
  }, renderSubtitle(), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ChatBadge__WEBPACK_IMPORTED_MODULE_20__["default"], {
    chat: chat,
    isPinned: isPinned,
    isMuted: isMuted,
    topic: topic,
    wasTopicOpened: wasTopicOpened,
    topics: topics
  }))), shouldRenderDeleteModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_17__["default"], {
    isOpen: isDeleteModalOpen,
    onClose: closeDeleteModal,
    onCloseAnimationEnd: unmarkRenderDeleteModal,
    confirmIsDestructive: true,
    confirmHandler: handleDelete,
    text: lang('lng_forum_topic_delete_sure'),
    confirmLabel: lang('Delete')
  }), shouldRenderMuteModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MuteChatModal_async__WEBPACK_IMPORTED_MODULE_19__["default"], {
    isOpen: isMuteModalOpen,
    onClose: closeMuteModal,
    onCloseAnimationEnd: unmarkRenderMuteModal,
    chatId: chatId,
    topicId: topic.id
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  topic,
  isSelected
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, chatId);
  const lastMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessage)(global, chatId, topic.lastMessageId);
  const {
    isOutgoing
  } = lastMessage || {};
  const lastMessageSender = lastMessage && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectSender)(global, lastMessage);
  const typingStatus = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectThreadParam)(global, chatId, topic.id, 'typingStatus');
  const draft = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectDraft)(global, chatId, topic.id);
  const threadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectThreadInfo)(global, chatId, topic.id);
  const wasTopicOpened = Boolean(threadInfo?.lastReadInboxMessageId);
  const topics = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTopics)(global, chatId);
  const {
    chatId: currentChatId,
    threadId: currentThreadId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCurrentMessageList)(global) || {};
  const storyData = lastMessage?.content.storyData;
  const lastMessageStory = storyData && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerStory)(global, storyData.peerId, storyData.id);
  const isChatMuted = chat && (0,_global_helpers_notifications__WEBPACK_IMPORTED_MODULE_3__.getIsChatMuted)(chat, (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectNotifyDefaults)(global), (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectNotifyException)(global, chat.id));
  return {
    chat,
    lastMessage,
    lastMessageSender,
    typingStatus,
    isChatMuted,
    canDelete: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanDeleteTopic)(global, chatId, topic.id),
    withInterfaceAnimations: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanAnimateInterface)(global),
    draft,
    ...(isOutgoing && lastMessage && {
      lastMessageOutgoingStatus: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectOutgoingStatus)(global, lastMessage)
    }),
    canScrollDown: isSelected && chat?.id === currentChatId && currentThreadId === topic.id,
    wasTopicOpened,
    topics,
    lastMessageStory
  };
})(Topic)));

/***/ },

/***/ "./src/components/left/main/UnconfirmedSession.module.scss"
/*!*****************************************************************!*\
  !*** ./src/components/left/main/UnconfirmedSession.module.scss ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"minimized":"lTOui0dp","root":"yEkGgZVL","title":"VhAJDrnz","info":"WmyL1NJ8","buttons":"_40UGD1Y","button":"pedMJD_v"});

/***/ },

/***/ "./src/components/left/main/UnconfirmedSession.tsx"
/*!*********************************************************!*\
  !*** ./src/components/left/main/UnconfirmedSession.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _UnconfirmedSession_module_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./UnconfirmedSession.module.scss */ "./src/components/left/main/UnconfirmedSession.module.scss");








const UnconfirmedSession = ({
  sessions,
  onHeightChange
}) => {
  const {
    changeSessionSettings,
    terminateAuthorization,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_4__["default"])(ref, entry => {
    const height = entry.borderBoxSize?.[0]?.blockSize || entry.contentRect.height;
    onHeightChange(height);
  });
  const firstUnconfirmed = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return Object.values(sessions).sort((a, b) => b.dateCreated - a.dateCreated).find(session => session.isUnconfirmed);
  }, [sessions]);
  const locationString = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return [firstUnconfirmed.deviceModel, firstUnconfirmed.region, firstUnconfirmed.country].filter(Boolean).join(', ');
  }, [firstUnconfirmed]);
  const handleAccept = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    changeSessionSettings({
      hash: firstUnconfirmed.hash,
      isConfirmed: true
    });
  });
  const handleReject = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    terminateAuthorization({
      hash: firstUnconfirmed.hash
    });
    showNotification({
      title: lang('UnconfirmedAuthDeniedTitle', 1),
      message: lang('UnconfirmedAuthDeniedMessageSingle', locationString)
    });
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _UnconfirmedSession_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].root,
    ref: ref
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h2", {
    className: _UnconfirmedSession_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].title
  }, lang('UnconfirmedAuthTitle')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _UnconfirmedSession_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].info
  }, lang('UnconfirmedAuthSingle', locationString)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _UnconfirmedSession_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].buttons
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    fluid: true,
    isText: true,
    size: "smaller",
    className: _UnconfirmedSession_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].button,
    onClick: handleAccept
  }, lang('UnconfirmedAuthConfirm')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    fluid: true,
    isText: true,
    size: "smaller",
    color: "danger",
    onClick: handleReject,
    className: _UnconfirmedSession_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].button
  }, lang('UnconfirmedAuthDeny'))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(UnconfirmedSession));

/***/ },

/***/ "./src/components/left/main/hooks/index.ts"
/*!*************************************************!*\
  !*** ./src/components/left/main/hooks/index.ts ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ChatAnimationTypes: () => (/* reexport safe */ _useChatAnimationType__WEBPACK_IMPORTED_MODULE_0__.ChatAnimationTypes),
/* harmony export */   useChatAnimationType: () => (/* reexport safe */ _useChatAnimationType__WEBPACK_IMPORTED_MODULE_0__.useChatAnimationType)
/* harmony export */ });
/* harmony import */ var _useChatAnimationType__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./useChatAnimationType */ "./src/components/left/main/hooks/useChatAnimationType.ts");


/***/ },

/***/ "./src/components/left/main/hooks/useChatAnimationType.ts"
/*!****************************************************************!*\
  !*** ./src/components/left/main/hooks/useChatAnimationType.ts ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ChatAnimationTypes: () => (/* binding */ ChatAnimationTypes),
/* harmony export */   useChatAnimationType: () => (/* binding */ useChatAnimationType)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");

let ChatAnimationTypes = /*#__PURE__*/function (ChatAnimationTypes) {
  ChatAnimationTypes[ChatAnimationTypes["Move"] = 0] = "Move";
  ChatAnimationTypes[ChatAnimationTypes["Opacity"] = 1] = "Opacity";
  ChatAnimationTypes[ChatAnimationTypes["None"] = 2] = "None";
  return ChatAnimationTypes;
}({});
function useChatAnimationType(orderDiffById) {
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const orderDiffs = Object.values(orderDiffById);
    const numberOfUp = orderDiffs.filter(diff => diff < 0).length;
    const numberOfDown = orderDiffs.filter(diff => diff > 0).length;
    return chatId => {
      const orderDiff = orderDiffById[chatId];
      if (orderDiff === 0) {
        return ChatAnimationTypes.None;
      }
      if (orderDiff === Infinity || orderDiff === -Infinity || numberOfUp <= numberOfDown && orderDiff < 0 || numberOfDown < numberOfUp && orderDiff > 0) {
        return ChatAnimationTypes.Opacity;
      }
      return ChatAnimationTypes.Move;
    };
  }, [orderDiffById]);
}

/***/ },

/***/ "./src/components/left/main/hooks/useChatListEntry.tsx"
/*!*************************************************************!*\
  !*** ./src/components/left/main/hooks/useChatListEntry.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useChatListEntry)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _useChatAnimationType__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./useChatAnimationType */ "./src/components/left/main/hooks/useChatAnimationType.ts");
/* harmony import */ var _hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/media/useMessageMediaHash */ "./src/hooks/media/useMessageMediaHash.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/useEnsureStory */ "./src/hooks/useEnsureStory.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_ChatForumLastMessage__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../common/ChatForumLastMessage */ "./src/components/common/ChatForumLastMessage.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MessageSummary__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../common/MessageSummary */ "./src/components/common/MessageSummary.tsx");
/* harmony import */ var _common_TypingStatus__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../common/TypingStatus */ "./src/components/common/TypingStatus.tsx");



















const ANIMATION_DURATION = 200;
function useChatListEntry({
  chat,
  topics,
  lastMessage,
  statefulMediaContent,
  chatId,
  typingStatus,
  draft,
  lastMessageTopic,
  lastMessageSender,
  observeIntersection,
  animationType,
  orderDiff,
  withInterfaceAnimations,
  isTopic,
  isSavedDialog,
  isPreview
}) {
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const storyData = lastMessage?.content.storyData;
  const shouldTryLoadingStory = statefulMediaContent && !statefulMediaContent.story;
  (0,_hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_11__["default"])(shouldTryLoadingStory ? storyData?.peerId : undefined, storyData?.id, statefulMediaContent?.story);
  const mediaContent = statefulMediaContent?.story || lastMessage;
  const mediaHasPreview = mediaContent && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageSticker)(mediaContent);
  const thumbDataUri = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_10__["default"])(mediaContent);
  const mediaThumbnail = mediaHasPreview ? thumbDataUri : undefined;
  const mediaHash = (0,_hooks_media_useMessageMediaHash__WEBPACK_IMPORTED_MODULE_9__["default"])(mediaContent, 'micro');
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_12__["default"])(mediaHasPreview ? mediaHash : undefined);
  const isRoundVideo = Boolean(lastMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageRoundVideo)(lastMessage));
  const renderLastMessageOrTyping = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!isSavedDialog && !isPreview && typingStatus && lastMessage && typingStatus.timestamp > lastMessage.date * 1000) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_TypingStatus__WEBPACK_IMPORTED_MODULE_17__["default"], {
        typingStatus: typingStatus
      });
    }
    const isDraftReplyToTopic = draft && draft.replyInfo?.replyToMsgId === lastMessageTopic?.id;
    const isEmptyLocalReply = draft?.replyInfo && !draft.text && draft.isLocal;
    const canDisplayDraft = !chat?.isForum && !isSavedDialog && !isPreview && draft && !isEmptyLocalReply && (!isTopic || !isDraftReplyToTopic);
    if (canDisplayDraft) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
        className: "last-message",
        dir: oldLang.isRtl ? 'auto' : 'ltr'
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "draft"
      }, oldLang('Draft')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "last-message-summary",
        dir: "auto"
      }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_7__.renderTextWithEntities)({
        text: draft.text?.text || '',
        entities: draft.text?.entities,
        asPreview: true,
        withTranslucentThumbs: true
      })));
    }
    if (!lastMessage) {
      return undefined;
    }
    const senderName = lastMessageSender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getMessageSenderName)(oldLang, chatId, lastMessageSender) : undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: "last-message shared-canvas-container",
      dir: oldLang.isRtl ? 'auto' : 'ltr'
    }, senderName && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "sender-name"
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(senderName)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "colon"
    }, ":")), !isSavedDialog && lastMessage.forwardInfo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
      name: "share-filled",
      className: "chat-prefix-icon"
    }), lastMessage.replyInfo?.type === 'story' && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
      name: "story-reply",
      className: "chat-prefix-icon"
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "last-message-summary",
      dir: "auto"
    }, renderSummary(lastMessage, observeIntersection, mediaBlobUrl || mediaThumbnail, isRoundVideo)));
  }, [chat, chatId, draft, isRoundVideo, isTopic, oldLang, lastMessage, lastMessageSender, lastMessageTopic, mediaBlobUrl, mediaThumbnail, observeIntersection, typingStatus, isSavedDialog, isPreview]);
  function renderSubtitle() {
    if (chat?.isForum && !isTopic) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_ChatForumLastMessage__WEBPACK_IMPORTED_MODULE_14__["default"], {
        chat: chat,
        renderLastMessage: renderLastMessageOrTyping,
        observeIntersection: observeIntersection,
        topics: topics
      });
    }
    return renderLastMessageOrTyping();
  }

  // Sets animation excess values when `orderDiff` changes and then resets excess values to animate
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    const element = ref.current;
    if (!withInterfaceAnimations || !element) {
      return;
    }

    // TODO Refactor animation: create `useListAnimation` that owns `orderDiff` and `animationType`
    if (animationType === _useChatAnimationType__WEBPACK_IMPORTED_MODULE_8__.ChatAnimationTypes.Opacity) {
      element.style.opacity = '0';
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
        element.classList.add('animate-opacity');
        element.style.opacity = '1';
      });
    } else if (animationType === _useChatAnimationType__WEBPACK_IMPORTED_MODULE_8__.ChatAnimationTypes.Move) {
      element.style.transform = `translate3d(0, ${-orderDiff * _config__WEBPACK_IMPORTED_MODULE_1__.CHAT_HEIGHT_PX}px, 0)`;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
        element.classList.add('animate-transform');
        element.style.transform = '';
      });
    } else {
      return;
    }
    setTimeout(() => {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
        element.classList.remove('animate-opacity', 'animate-transform');
        element.style.opacity = '';
        element.style.transform = '';
      });
    }, ANIMATION_DURATION + _config__WEBPACK_IMPORTED_MODULE_1__.ANIMATION_END_DELAY);
  }, [withInterfaceAnimations, orderDiff, animationType]);
  return {
    renderSubtitle,
    ref
  };
}
function renderSummary(message, observeIntersection, blobUrl, isRoundVideo) {
  const messageSummary = /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MessageSummary__WEBPACK_IMPORTED_MODULE_16__["default"], {
    message: message,
    noEmoji: Boolean(blobUrl),
    observeIntersectionForLoading: observeIntersection,
    inChatList: true
  });
  if (!blobUrl) {
    return messageSummary;
  }
  const isSpoiler = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageIsSpoiler)(message);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "media-preview"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: blobUrl,
    alt: "",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('media-preview--image', isRoundVideo && 'round', isSpoiler && 'media-preview-spoiler'),
    draggable: false
  }), (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageVideo)(message) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
    name: "play"
  }), messageSummary);
}

/***/ },

/***/ "./src/components/left/main/hooks/useLeftHeaderButtonRtlForumTransition.ts"
/*!*********************************************************************************!*\
  !*** ./src/components/left/main/hooks/useLeftHeaderButtonRtlForumTransition.ts ***!
  \*********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useLeftHeaderButtonRtlForumTransition)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");



function useLeftHeaderButtonRtlForumTransition(shouldHideSearch) {
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__["default"])();
  const shouldDisableDropdownMenuTransitionRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(shouldHideSearch);
  const prevShouldHideSearch = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_2__["default"])(shouldHideSearch);
  function handleDropdownMenuTransitionEnd() {
    shouldDisableDropdownMenuTransitionRef.current = Boolean(shouldHideSearch);
    forceUpdate();
  }
  if (shouldHideSearch === false && prevShouldHideSearch !== shouldHideSearch) {
    shouldDisableDropdownMenuTransitionRef.current = false;
  }
  return {
    shouldDisableDropdownMenuTransitionRef,
    handleDropdownMenuTransitionEnd
  };
}

/***/ },

/***/ "./src/components/left/main/hooks/useOrderDiff.ts"
/*!********************************************************!*\
  !*** ./src/components/left/main/hooks/useOrderDiff.ts ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useOrderDiff)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _useChatAnimationType__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useChatAnimationType */ "./src/components/left/main/hooks/useChatAnimationType.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");




function useOrderDiff(orderedIds, key) {
  const orderById = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!orderedIds) {
      return undefined;
    }
    return orderedIds.reduce((acc, id, i) => {
      acc[id] = i;
      return acc;
    }, {});
  }, [orderedIds]);
  const prevOrderById = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_3__["default"])(orderById);
  const prevChatId = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_3__["default"])(key);
  const orderDiffById = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!orderById || !prevOrderById || key !== prevChatId) {
      return {};
    }
    return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_1__.mapValues)(orderById, (order, id) => {
      return prevOrderById[id] !== undefined ? order - prevOrderById[id] : -Infinity;
    });
  }, [key, orderById, prevChatId, prevOrderById]);
  const getAnimationType = (0,_useChatAnimationType__WEBPACK_IMPORTED_MODULE_2__.useChatAnimationType)(orderDiffById);
  return {
    orderDiffById,
    getAnimationType
  };
}

/***/ },

/***/ "./src/components/left/main/hooks/useTopicContextActions.ts"
/*!******************************************************************!*\
  !*** ./src/components/left/main/hooks/useTopicContextActions.ts ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useTopicContextActions)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");






function useTopicContextActions({
  topic,
  chat,
  isChatMuted,
  wasOpened,
  canDelete,
  handleDelete,
  handleMute
}) {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const {
      isPinned,
      notifySettings,
      isClosed,
      id: topicId
    } = topic;
    const chatId = chat.id;
    const {
      editTopic,
      toggleTopicPinned,
      markTopicRead,
      updateTopicMutedState,
      openChatInNewTab
    } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
    const canToggleClosed = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCanManageTopic)(chat, topic);
    const canTogglePinned = chat.isCreator || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getHasAdminRight)(chat, 'manageTopics');
    const actionOpenInNewTab = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_OPEN_IN_NEW_TAB_SUPPORTED && {
      title: 'Open in new tab',
      icon: 'open-in-new-tab',
      handler: () => {
        openChatInNewTab({
          chatId: chat.id,
          threadId: topicId
        });
      }
    };
    const actionUnreadMark = topic.unreadCount || !wasOpened ? {
      title: lang('MarkAsRead'),
      icon: 'readchats',
      handler: () => {
        markTopicRead({
          chatId,
          topicId
        });
      }
    } : undefined;
    const actionPin = canTogglePinned ? isPinned ? {
      title: lang('UnpinFromTop'),
      icon: 'unpin',
      handler: () => toggleTopicPinned({
        chatId,
        topicId,
        isPinned: false
      })
    } : {
      title: lang('PinToTop'),
      icon: 'pin',
      handler: () => toggleTopicPinned({
        chatId,
        topicId,
        isPinned: true
      })
    } : undefined;
    const actionMute = isChatMuted && notifySettings.mutedUntil === undefined || notifySettings.mutedUntil ? {
      title: lang('ChatList.Unmute'),
      icon: 'unmute',
      handler: () => updateTopicMutedState({
        chatId,
        topicId,
        isMuted: false
      })
    } : {
      title: `${lang('ChatList.Mute')}...`,
      icon: 'mute',
      handler: handleMute
    };
    const actionCloseTopic = canToggleClosed ? isClosed ? {
      title: lang('lng_forum_topic_reopen'),
      icon: 'reopen-topic',
      handler: () => editTopic({
        chatId,
        topicId,
        isClosed: false
      })
    } : {
      title: lang('lng_forum_topic_close'),
      icon: 'close-topic',
      handler: () => editTopic({
        chatId,
        topicId,
        isClosed: true
      })
    } : undefined;
    const actionDelete = canDelete ? {
      title: lang('lng_forum_topic_delete'),
      icon: 'delete',
      destructive: true,
      handler: handleDelete
    } : undefined;
    return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.compact)([actionOpenInNewTab, actionPin, actionUnreadMark, actionMute, actionCloseTopic, actionDelete]);
  }, [topic, chat, isChatMuted, wasOpened, lang, canDelete, handleDelete, handleMute]);
}

/***/ },

/***/ "./src/components/left/main/hooks/useTranslateTip.ts"
/*!***********************************************************!*\
  !*** ./src/components/left/main/hooks/useTranslateTip.ts ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useTranslateTip: () => (/* binding */ useTranslateTip)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chatAssistant_hook_useEventBusTeact__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../chatAssistant/hook/useEventBusTeact */ "./src/components/chatAssistant/hook/useEventBusTeact.ts");
/* harmony import */ var _chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../chatAssistant/utils/room-input-translate */ "./src/components/chatAssistant/utils/room-input-translate.ts");
/* harmony import */ var _hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/data/useSelector */ "./src/hooks/data/useSelector.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");






function getBaseLanguage(lang = navigator.language) {
  return lang.split('-')[0]; // 取 "-" 之前的部分
}
function useTranslateTip({
  chatId
}) {
  const [headerTranslateTipOpen, openHeaderTranslateTip, closeHeaderTranslateTip] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const [inputTranslateTipOpen, openInputTranslateTip, closeInputTranslateTip] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const chat = (0,_hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_4__["default"])(global => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectChat)(global, chatId));
  const globalSystemLanguage = (0,_hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_4__["default"])(_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectSystemLanguage);
  const translateTip = (0,_hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_4__["default"])(global => global.translateTip);
  const detectedLanguage = chat?.detectedLanguage;
  const systemLanguage = globalSystemLanguage ? getBaseLanguage(globalSystemLanguage) : getBaseLanguage();
  (0,_chatAssistant_hook_useEventBusTeact__WEBPACK_IMPORTED_MODULE_2__.useEventListenerTeact)('actions:openInputTranslateTip', openInputTranslateTip);
  const shouldShowTip = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!detectedLanguage || !systemLanguage) return false;
    return detectedLanguage !== systemLanguage;
  }, [detectedLanguage, systemLanguage]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!shouldShowTip) {
      closeHeaderTranslateTip();
      closeInputTranslateTip();
      return;
    }
    if (!translateTip.headerTipClosed) {
      openHeaderTranslateTip();
    } else {
      closeHeaderTranslateTip();
    }
    if (translateTip.inputTipClosedChats?.[chatId]) {
      closeInputTranslateTip();
    }
  }, [chatId, shouldShowTip, translateTip, closeHeaderTranslateTip, closeInputTranslateTip, openHeaderTranslateTip]);
  const handleCloseHeaderTranslateTip = () => {
    closeHeaderTranslateTip();
    (0,_chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_3__.updateHeaderTranslateTipStatus)(true);
  };
  const handleCloseInputTranslateTip = () => {
    closeInputTranslateTip();
    (0,_chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_3__.updateInputTranslateTipStatus)(chatId, true);
  };
  return {
    headerTranslateTipOpen,
    openHeaderTranslateTip,
    closeHeaderTranslateTip: handleCloseHeaderTranslateTip,
    inputTranslateTipOpen,
    openInputTranslateTip,
    closeInputTranslateTip: handleCloseInputTranslateTip,
    systemLanguage
  };
}

/***/ },

/***/ "./src/components/left/search/helpers/getSenderName.ts"
/*!*************************************************************!*\
  !*** ./src/components/left/search/helpers/getSenderName.ts ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getSenderName: () => (/* binding */ getSenderName)
/* harmony export */ });
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/entities/ids */ "./src/util/entities/ids.ts");



function getSenderName(lang, message, chatsById, usersById) {
  const {
    senderId
  } = message;
  if (!senderId) {
    return undefined;
  }
  const sender = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_2__.isUserId)(senderId) ? usersById[senderId] : chatsById[senderId];
  let senderName = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_1__.getPeerTitle)(lang, sender);
  const chat = chatsById[message.chatId];
  if (chat) {
    if ('isSelf' in sender && sender.isSelf) {
      senderName = `${lang('FromYou')} → ${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.getChatTitle)(lang, chat)}`;
    } else if ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.isChatGroup)(chat)) {
      senderName += ` → ${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.getChatTitle)(lang, chat)}`;
    }
  }
  return senderName;
}

/***/ },

/***/ "./src/components/main/visualEffects/SnapEffectContainer.module.scss"
/*!***************************************************************************!*\
  !*** ./src/components/main/visualEffects/SnapEffectContainer.module.scss ***!
  \***************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"AN8wkEiR","ghost":"ANWk2pWP","scale":"kMHxyoSt","elementContainer":"UDCMfXxs"});

/***/ },

/***/ "./src/components/main/visualEffects/SnapEffectContainer.tsx"
/*!*******************************************************************!*\
  !*** ./src/components/main/visualEffects/SnapEffectContainer.tsx ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   animateSnap: () => (/* binding */ animateSnap),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_element_jsxToHtml__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/element/jsxToHtml */ "./src/util/element/jsxToHtml.ts");
/* harmony import */ var _util_generateUniqueId__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/generateUniqueId */ "./src/util/generateUniqueId.ts");
/* harmony import */ var _SnapEffectContainer_module_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./SnapEffectContainer.module.scss */ "./src/components/main/visualEffects/SnapEffectContainer.module.scss");








const VISIBLITY_MARGIN = 50;
const DURATION = 1000;
const SnapEffectContainer = () => {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _SnapEffectContainer_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].root,
    id: _config__WEBPACK_IMPORTED_MODULE_2__.SNAP_EFFECT_CONTAINER_ID
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(SnapEffectContainer));
function animateSnap(element) {
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const canPlayEffect = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanAnimateSnapEffect)(global);
  if (!canPlayEffect) return false;
  // Get element current fixed position on screen
  const rect = element.getBoundingClientRect();
  const x = rect.left + window.scrollX;
  const y = rect.top + window.scrollY;
  const width = rect.width;
  const height = rect.height;

  // Check for visibility
  if (x + width + VISIBLITY_MARGIN < 0 || x - VISIBLITY_MARGIN > window.innerWidth || y + height + VISIBLITY_MARGIN < 0 || y - VISIBLITY_MARGIN > window.innerHeight) {
    return false;
  }
  const seed = Math.floor(Date.now() / 1000);
  const filterId = `${_config__WEBPACK_IMPORTED_MODULE_2__.SNAP_EFFECT_ID}-${(0,_util_generateUniqueId__WEBPACK_IMPORTED_MODULE_5__["default"])()}`;
  const component = /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    className: _SnapEffectContainer_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghost,
    width: width,
    height: height,
    style: `left: ${x}px; top: ${y}px;`,
    viewBox: `0 0 ${width} ${height}`
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("defs", null, createFilter(filterId, Math.min(width, height), seed)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("g", {
    filter: `url(#${filterId})`
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("foreignObject", {
    className: _SnapEffectContainer_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].elementContainer,
    width: width,
    height: height
  })));
  const svg = (0,_util_element_jsxToHtml__WEBPACK_IMPORTED_MODULE_4__["default"])(component)[0];
  const foreignObject = svg.querySelector('foreignObject');
  const computedStyle = window.getComputedStyle(element);
  const clone = element.cloneNode(true);
  Array.from(computedStyle).forEach(key => clone.style.setProperty(key, computedStyle.getPropertyValue(key), 'important'));
  foreignObject.appendChild(clone);
  const snapContainer = document.getElementById(_config__WEBPACK_IMPORTED_MODULE_2__.SNAP_EFFECT_CONTAINER_ID);
  snapContainer.appendChild(svg);
  svg.addEventListener('animationend', () => {
    snapContainer.removeChild(svg);
  }, {
    once: true
  });
  return true;
}
function createFilter(id, smallestSide, baseSeed = 42) {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("filter", {
    xmlns: _config__WEBPACK_IMPORTED_MODULE_2__.SVG_NAMESPACE,
    id: id,
    x: "-150%",
    y: "-150%",
    width: "400%",
    height: "400%",
    "color-interpolation-filters": "sRGB"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feTurbulence", {
    type: "fractalNoise",
    baseFrequency: "0.5",
    numOctaves: "1",
    result: "dustNoise",
    seed: baseSeed
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feComponentTransfer", {
    in: "dustNoise",
    result: "dustNoiseMask"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feFuncA", {
    type: "linear",
    slope: "5",
    intercept: "0"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("animate", {
    attributeName: "slope",
    values: "5; 2; 1; 0",
    dur: `${DURATION}ms`,
    fill: "freeze"
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feComposite", {
    in: "SourceGraphic",
    in2: "dustNoiseMask",
    operator: "in",
    result: "dustySource"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feTurbulence", {
    type: "fractalNoise",
    baseFrequency: "0.015",
    numOctaves: "1",
    result: "displacementNoise1",
    seed: baseSeed + 1
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feTurbulence", {
    type: "fractalNoise",
    baseFrequency: "1",
    numOctaves: "2",
    result: "displacementNoise2",
    seed: baseSeed + 2
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feMerge", {
    result: "combinedNoise"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feMergeNode", {
    in: "displacementNoise1"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feMergeNode", {
    in: "displacementNoise2"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feDisplacementMap", {
    in: "dustySource",
    in2: "combinedNoise",
    scale: "0",
    xChannelSelector: "R",
    yChannelSelector: "G"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("animate", {
    attributeName: "scale",
    values: `0; ${smallestSide * 3}`,
    dur: `${DURATION}ms`,
    fill: "freeze"
  })));
}

/***/ },

/***/ "./src/components/middle/HeaderActions.tsx"
/*!*************************************************!*\
  !*** ./src/components/middle/HeaderActions.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../chatAssistant/assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useHotkeys */ "./src/hooks/useHotkeys.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _HeaderMenuContainer_async__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./HeaderMenuContainer.async */ "./src/components/middle/HeaderMenuContainer.async.tsx");
/* harmony import */ var _chatAssistant_component_InviteButton_teact__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../chatAssistant/component/InviteButton.teact */ "./src/components/chatAssistant/component/InviteButton.teact.tsx");
/* harmony import */ var _chatAssistant_assets_input_translate_input_png__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../chatAssistant/assets/input/translate-input.png */ "./src/components/chatAssistant/assets/input/translate-input.png");
/* harmony import */ var _chatAssistant_assets_ai_translate_png__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../chatAssistant/assets/ai-translate.png */ "./src/components/chatAssistant/assets/ai-translate.png");
/* harmony import */ var _HeaderTranslateTip__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./HeaderTranslateTip */ "./src/components/middle/HeaderTranslateTip.tsx");
/* harmony import */ var _left_main_hooks_useTranslateTip__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../left/main/hooks/useTranslateTip */ "./src/components/left/main/hooks/useTranslateTip.ts");
/* harmony import */ var _chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../chatAssistant/utils/room-input-translate */ "./src/components/chatAssistant/utils/room-input-translate.ts");
/* harmony import */ var _util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../util/subscriptionHandler */ "./src/util/subscriptionHandler.ts");


























// Chrome breaks layout when focusing input during transition
const SEARCH_FOCUS_DELAY_MS = 320;
const HeaderActions = ({
  chatId,
  threadId,
  noMenu,
  isMobile,
  isChannel,
  canStartBot,
  canRestartBot,
  canUnblock,
  canSubscribe,
  canSearch,
  canCall,
  canMute,
  canViewStatistics,
  canViewMonetization,
  canViewBoosts,
  canShowBoostModal,
  canLeave,
  canEnterVoiceChat,
  canCreateVoiceChat,
  channelMonoforumId,
  pendingJoinRequests,
  isRightColumnShown,
  isForForum,
  canExpandActions,
  shouldJoinToSend,
  shouldSendJoinRequest,
  noAnimation,
  canTranslate,
  isTranslating,
  translationLanguage,
  language,
  detectedChatLanguage,
  doNotTranslate,
  onTopicSearch,
  isAccountFrozen,
  isChatAIShown
}) => {
  const {
    joinChannel,
    sendBotCommand,
    openMiddleSearch,
    restartBot,
    requestMasterAndRequestCall,
    requestNextManagementScreen,
    showNotification,
    openChat,
    requestChatTranslation,
    togglePeerTranslations,
    openChatLanguageModal,
    setSettingOption,
    unblockUser,
    setViewForumAsMessages,
    openChatAIWithInfo,
    // openFrozenAccountModal,
    openCreditLimitModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const menuButtonRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const [isMenuOpen, setIsMenuOpen] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [menuAnchor, setMenuAnchor] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const {
    closeHeaderTranslateTip,
    headerTranslateTipOpen
  } = (0,_left_main_hooks_useTranslateTip__WEBPACK_IMPORTED_MODULE_22__.useTranslateTip)({
    chatId
  });
  const handleHeaderMenuOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    setIsMenuOpen(true);
    const rect = menuButtonRef.current.getBoundingClientRect();
    setMenuAnchor({
      x: rect.right,
      y: rect.bottom
    });
  });
  const handleOpenChatAi = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    openChatAIWithInfo({
      chatId
    });
  });
  const handleHeaderMenuClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    setIsMenuOpen(false);
  });
  const handleHeaderMenuHide = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    setMenuAnchor(undefined);
  });
  const handleSubscribeClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    joinChannel({
      chatId
    });
    if (shouldSendJoinRequest) {
      showNotification({
        message: isChannel ? lang('RequestToJoinChannelSentDescription') : lang('RequestToJoinGroupSentDescription')
      });
    }
  });
  const handleStartBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    sendBotCommand({
      command: '/start'
    });
  });
  const handleRestartBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    restartBot({
      chatId
    });
  });
  const handleUnblock = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    unblockUser({
      userId: chatId
    });
  });
  const handleTranslateClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (isTranslating) {
      requestChatTranslation({
        chatId,
        toLanguageCode: undefined
      });
      (0,_chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_23__.toggleAutoTranslation)(false);
      return;
    }
    if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_24__.checkCredisBalance)()) {
      openCreditLimitModal({
        title: 'Translation failed',
        message: "You've reached your credit limit. Please upgrade your plan."
      });
      return;
    }
    requestChatTranslation({
      chatId,
      toLanguageCode: translationLanguage
    });
    (0,_chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_23__.toggleAutoTranslation)(true);
  });
  const handleJoinRequestsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    requestNextManagementScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_3__.ManagementScreens.JoinRequests
    });
  });
  const handleSearchClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (isForForum) {
      onTopicSearch?.();
      return;
    }
    openMiddleSearch();
    if (isMobile) {
      // iOS requires synchronous focus on user event.
      setFocusInSearchInput();
    } else if (noAnimation) {
      // The second RAF is necessary because Teact must update the state and render the async component
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestNextMutation)(setFocusInSearchInput);
      });
    } else {
      setTimeout(setFocusInSearchInput, SEARCH_FOCUS_DELAY_MS);
    }
  });
  const handleAsMessagesClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    openChat({
      id: chatId
    });
    setViewForumAsMessages({
      chatId,
      isEnabled: true
    });
  });
  const handleRequestCall = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (isAccountFrozen) {
      // openFrozenAccountModal();
      return;
    }
    requestMasterAndRequestCall({
      userId: chatId
    });
  });
  const handleHotkeySearchClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    if (!canSearch || !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.IS_APP || e.shiftKey) {
      return;
    }
    e.preventDefault();
    handleSearchClick();
  });
  const getTextWithLanguage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])((langKey, langCode) => {
    const simplified = langCode.split('-')[0];
    const translationKey = `TranslateLanguage${simplified.toUpperCase()}`;
    const name = lang(translationKey);
    if (name !== translationKey) {
      return lang(langKey, name);
    }
    const translatedNames = new Intl.DisplayNames([language], {
      type: 'language'
    });
    const translatedName = translatedNames.of(langCode);
    return lang(`${langKey}Other`, translatedName);
  });
  const translationKey = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (translationLanguage && isTranslating) {
      const simplified = translationLanguage.split('-')[0];
      const translationKey = simplified.toUpperCase();
      return translationKey;
    }
    return null;
  }, [translationLanguage, isTranslating]);
  const buttonText = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isTranslating) return lang('ShowOriginalButton');
    return getTextWithLanguage('TranslateToButton', translationLanguage);
  }, [translationLanguage, getTextWithLanguage, isTranslating, lang]);
  const doNotTranslateText = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!detectedChatLanguage) return undefined;
    return getTextWithLanguage('DoNotTranslateLanguage', detectedChatLanguage);
  }, [getTextWithLanguage, detectedChatLanguage]);
  const handleHide = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    togglePeerTranslations({
      chatId,
      isEnabled: false
    });
    requestChatTranslation({
      chatId,
      toLanguageCode: undefined
    });
  });
  const handleChangeLanguage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    openChatLanguageModal({
      chatId
    });
  });
  const handleDoNotTranslate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (!detectedChatLanguage) return;
    setSettingOption({
      doNotTranslate: [...doNotTranslate, detectedChatLanguage]
    });
    requestChatTranslation({
      chatId,
      toLanguageCode: undefined
    });
    showNotification({
      message: getTextWithLanguage('AddedToDoNotTranslate', detectedChatLanguage)
    });
  });
  (0,_hooks_useHotkeys__WEBPACK_IMPORTED_MODULE_10__.useHotkeys)((0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => ({
    'Mod+F': handleHotkeySearchClick
  }), []));
  const MoreMenuButton = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "relative"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
      round: !Boolean(translationKey),
      ripple: isRightColumnShown,
      color: "translucent",
      size: translationKey ? "tiny" : "smaller",
      className: `overflow-visible ${isOpen ? 'active' : ''}`,
      onClick: onTrigger,
      ariaLabel: lang('TranslateMessage')
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      src: Boolean(translationKey) ? _chatAssistant_assets_ai_translate_png__WEBPACK_IMPORTED_MODULE_20__ : _chatAssistant_assets_input_translate_input_png__WEBPACK_IMPORTED_MODULE_19__,
      className: "w-[24px] h-[24px]"
    }), Boolean(translationKey) ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "text-14px font-semibold"
    }, translationKey) : ""), headerTranslateTipOpen && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HeaderTranslateTip__WEBPACK_IMPORTED_MODULE_21__["default"], {
      chatId: chatId,
      onClose: closeHeaderTranslateTip
    }));
  }, [isRightColumnShown, translationKey, lang, headerTranslateTipOpen, chatId, closeHeaderTranslateTip]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "HeaderActions"
  }, !isForForum && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_component_InviteButton_teact__WEBPACK_IMPORTED_MODULE_18__["default"], null), !isForForum && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_15__["default"], {
    className: "stickers-more-menu with-menu-transitions",
    trigger: MoreMenuButton,
    positionX: "right"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    icon: "language",
    onClick: handleTranslateClick
  }, buttonText), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    icon: "replace",
    onClick: handleChangeLanguage
  }, lang('Chat.Translate.Menu.To'))), !isMobile && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, canExpandActions && !shouldSendJoinRequest && (canSubscribe || shouldJoinToSend) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    size: "tiny",
    ripple: true,
    fluid: true,
    onClick: handleSubscribeClick
  }, lang(isChannel ? 'ProfileJoinChannel' : 'ProfileJoinGroup')), canExpandActions && shouldSendJoinRequest && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    size: "tiny",
    ripple: true,
    fluid: true,
    onClick: handleSubscribeClick
  }, lang('ChannelJoinRequest')), canExpandActions && canStartBot && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    size: "tiny",
    ripple: true,
    fluid: true,
    onClick: handleStartBot
  }, lang('BotStart')), canExpandActions && canRestartBot && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    size: "tiny",
    ripple: true,
    fluid: true,
    onClick: handleRestartBot
  }, lang('BotRestart')), canExpandActions && canUnblock && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    size: "tiny",
    ripple: true,
    fluid: true,
    onClick: handleUnblock
  }, lang('Unblock')), canSearch && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    round: true,
    ripple: isRightColumnShown,
    color: "translucent",
    size: "smaller",
    onClick: handleSearchClick,
    ariaLabel: lang('Conversation.SearchPlaceholder')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "search"
  })), canCall && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    round: true,
    color: "translucent",
    size: "smaller",
    onClick: handleRequestCall,
    ariaLabel: "Call"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "phone"
  }))), !isForForum && Boolean(pendingJoinRequests) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    round: true,
    className: "badge-button",
    ripple: isRightColumnShown,
    color: "translucent",
    size: "smaller",
    onClick: handleJoinRequestsClick,
    ariaLabel: isChannel ? lang('SubscribeRequests') : lang('MemberRequests')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "user"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "badge"
  }, pendingJoinRequests)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    ref: menuButtonRef,
    className: isMenuOpen ? 'active' : '',
    round: true,
    ripple: !isMobile,
    size: "smaller",
    color: "translucent",
    disabled: noMenu,
    ariaLabel: "More actions",
    onClick: handleHeaderMenuOpen
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "more"
  })), !isChatAIShown && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    className: "flex items-center gap-[10px] !bg-[#F7F7F7] w-[125px]",
    size: "tiny",
    ariaLabel: "Ask TelyAI",
    color: "translucent",
    onClick: handleOpenChatAi
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_5__,
    className: "w-[24px] h-[24px]"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-[14px] text-[var(--color-text)] normal-case"
  }, "Ask TelyAI")), menuAnchor && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_HeaderMenuContainer_async__WEBPACK_IMPORTED_MODULE_17__["default"], {
    chatId: chatId,
    threadId: threadId,
    isOpen: isMenuOpen,
    anchor: menuAnchor,
    withExtraActions: isMobile || !canExpandActions,
    isChannel: isChannel,
    canStartBot: canStartBot,
    canSubscribe: canSubscribe,
    canSearch: canSearch,
    canCall: canCall,
    canMute: canMute,
    canViewStatistics: canViewStatistics,
    canViewBoosts: canViewBoosts,
    canViewMonetization: canViewMonetization,
    canShowBoostModal: canShowBoostModal,
    canLeave: canLeave,
    canEnterVoiceChat: canEnterVoiceChat,
    canCreateVoiceChat: canCreateVoiceChat,
    pendingJoinRequests: pendingJoinRequests,
    onJoinRequestsClick: handleJoinRequestsClick,
    withForumActions: isForForum,
    channelMonoforumId: channelMonoforumId,
    onSubscribeChannel: handleSubscribeClick,
    onSearchClick: handleSearchClick,
    onAsMessagesClick: handleAsMessagesClick,
    onClose: handleHeaderMenuClose,
    onCloseAnimationEnd: handleHeaderMenuHide
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId,
  messageListType,
  isMobile
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChat)(global, chatId);
  const isChannel = Boolean(chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatChannel)(chat));
  const isSuperGroup = Boolean(chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatSuperGroup)(chat));
  const language = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectLanguageCode)(global);
  const translationLanguage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTranslationLanguage)(global);
  const isPrivate = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_9__.isUserId)(chatId);
  const {
    doNotTranslate
  } = global.settings.byKey;
  const isRestricted = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatRestricted)(global, chatId);
  if (!chat || isRestricted || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsInSelectMode)(global)) {
    return {
      noMenu: true,
      language,
      translationLanguage,
      doNotTranslate
    };
  }
  const bot = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectBot)(global, chatId);
  const chatFullInfo = !isPrivate ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectChatFullInfo)(global, chatId) : undefined;
  const userFullInfo = isPrivate ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectUserFullInfo)(global, chatId) : undefined;
  const fullInfo = chatFullInfo || userFullInfo;
  const isChatWithSelf = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatWithSelf)(global, chatId);
  const isMainThread = messageListType === 'thread' && threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID;
  const isDiscussionThread = messageListType === 'thread' && threadId !== _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID;
  const isRightColumnShown = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsRightColumnShown)(global, isMobile);
  const isSavedDialog = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getIsSavedDialog)(chatId, threadId, global.currentUserId);
  const isUserBlocked = isPrivate ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsUserBlocked)(global, chatId) : false;
  const canRestartBot = Boolean(bot && isUserBlocked);
  const canStartBot = !canRestartBot && Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsChatBotNotStarted)(global, chatId));
  const canUnblock = isUserBlocked && !bot;
  const canSubscribe = Boolean((isMainThread || chat.isForum) && (isChannel || isSuperGroup) && chat.isNotJoined && !chat.isMonoforum);
  const canSearch = isMainThread || isDiscussionThread;
  const canCall = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.ARE_CALLS_SUPPORTED && (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_9__.isUserId)(chat.id) && !isChatWithSelf && !bot && !chat.isSupport && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isAnonymousForwardsChat)(chat.id);
  const canMute = isMainThread && !isChatWithSelf && !canSubscribe;
  const canLeave = isSavedDialog || isMainThread && !canSubscribe;
  const canEnterVoiceChat = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.ARE_CALLS_SUPPORTED && isMainThread && chat.isCallActive;
  const canCreateVoiceChat = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_8__.ARE_CALLS_SUPPORTED && isMainThread && !chat.isCallActive && (chat.adminRights?.manageCall || chat.isCreator && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatBasicGroup)(chat)) && !chat.isMonoforum;
  const canViewStatistics = isMainThread && chatFullInfo?.canViewStatistics;
  const canViewMonetization = isMainThread && chatFullInfo?.canViewMonetization;
  const canViewBoosts = isMainThread && !chat.isMonoforum && (isSuperGroup || isChannel) && (canViewStatistics || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.getHasAdminRight)(chat, 'postStories'));
  const canShowBoostModal = !canViewBoosts && (isSuperGroup || isChannel) && !chat.isMonoforum;
  const pendingJoinRequests = isMainThread ? chatFullInfo?.requestsPending : undefined;
  const shouldJoinToSend = Boolean(chat?.isNotJoined && chat.isJoinToSend);
  const shouldSendJoinRequest = Boolean(chat?.isNotJoined && chat.isJoinRequest);
  const noAnimation = !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCanAnimateInterface)(global);
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectIsCurrentUserFrozen)(global);
  const channelMonoforumId = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_6__.isChatChannel)(chat) ? chat.linkedMonoforumId : undefined;
  const isTranslating = Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectRequestedChatTranslationLanguage)(global, chatId));
  const canTranslate = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectCanTranslateChat)(global, chatId) && !fullInfo?.isTranslationDisabled;
  return {
    noMenu: false,
    isChannel,
    isRightColumnShown,
    canStartBot,
    canRestartBot,
    canSubscribe,
    canSearch,
    canCall,
    canMute,
    canViewStatistics,
    canViewMonetization,
    canViewBoosts,
    canShowBoostModal,
    canLeave,
    canEnterVoiceChat,
    canCreateVoiceChat,
    pendingJoinRequests,
    shouldJoinToSend,
    shouldSendJoinRequest,
    noAnimation,
    canTranslate,
    isTranslating,
    translationLanguage,
    language,
    doNotTranslate,
    detectedChatLanguage: chat.detectedLanguage,
    canUnblock,
    isAccountFrozen,
    channelMonoforumId,
    isChatAIShown: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_7__.selectTabState)(global).isChatAIShown
  };
})(HeaderActions)));
function setFocusInSearchInput() {
  const searchInput = document.querySelector('#MiddleSearch input');
  searchInput?.focus();
}

/***/ },

/***/ "./src/components/middle/HeaderMenuContainer.async.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/HeaderMenuContainer.async.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const HeaderMenuContainerAsync = props => {
  const {
    isOpen
  } = props;
  const HeaderMenuContainer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'HeaderMenuContainer', !isOpen);
  return HeaderMenuContainer ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(HeaderMenuContainer, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (HeaderMenuContainerAsync);

/***/ },

/***/ "./src/components/middle/HeaderTranslateTip.scss"
/*!*******************************************************!*\
  !*** ./src/components/middle/HeaderTranslateTip.scss ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/HeaderTranslateTip.tsx"
/*!******************************************************!*\
  !*** ./src/components/middle/HeaderTranslateTip.tsx ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../chatAssistant/utils/room-input-translate */ "./src/components/chatAssistant/utils/room-input-translate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _left_main_hooks_useTranslateTip__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../left/main/hooks/useTranslateTip */ "./src/components/left/main/hooks/useTranslateTip.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _HeaderTranslateTip_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./HeaderTranslateTip.scss */ "./src/components/middle/HeaderTranslateTip.scss");








const HeaderTranslateTip = ({
  global,
  chatId,
  isTranslating,
  detectedLanguage,
  onClose
}) => {
  const {
    requestChatTranslation,
    setSettingOption
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    systemLanguage
  } = (0,_left_main_hooks_useTranslateTip__WEBPACK_IMPORTED_MODULE_5__.useTranslateTip)({
    chatId
  });
  const language = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectLanguageCode)(global);
  const translatedNames = new Intl.DisplayNames([language], {
    type: 'language'
  });
  const detectedLanguageName = detectedLanguage ? translatedNames.of(detectedLanguage) : undefined;
  const translatedName = systemLanguage ? translatedNames.of(systemLanguage) : undefined;
  const handleTranslateClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(e => {
    e.preventDefault();
    e.stopPropagation();
    if (isTranslating) {
      requestChatTranslation({
        chatId,
        toLanguageCode: undefined
      });
      return;
    }
    if (systemLanguage) {
      setSettingOption({
        translationLanguage: systemLanguage
      });
      requestChatTranslation({
        chatId,
        toLanguageCode: systemLanguage
      });
      (0,_chatAssistant_utils_room_input_translate__WEBPACK_IMPORTED_MODULE_3__.toggleAutoTranslation)(true);
    }
    onClose();
  });
  const handleClose = e => {
    e.preventDefault();
    e.stopPropagation();
    onClose();
  };
  const handleStopPropagation = e => {
    e.preventDefault();
    e.stopPropagation();
  };
  return /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "header-translate-tip",
    onClick: handleStopPropagation
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "text-transform-none"
  }, `I noticed this chat is in ${detectedLanguageName}. Want me to translate it into ${translatedName}?`), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center gap-[8px] justify-end mt-[12px]"
  }, /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_6__["default"], {
    size: "tiny",
    className: "!h-[32px] w-[88px] normal-case !bg-white/50 !text-black !m-0",
    onClick: handleClose
  }, "No need"), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_6__["default"], {
    size: "tiny",
    className: "!h-[32px] w-[88px] normal-case !bg-white !text-black !m-0",
    onClick: handleTranslateClick
  }, "Translate")), /*#__PURE__*/_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "header-translate-tip-arrow"
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const isTranslating = Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectRequestedChatTranslationLanguage)(global, chatId));
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChat)(global, chatId);
  const detectedLanguage = chat?.detectedLanguage;
  return {
    global,
    isTranslating,
    detectedLanguage
  };
})(HeaderTranslateTip)));

/***/ },

/***/ "./src/components/middle/composer/AttachBotIcon.module.scss"
/*!******************************************************************!*\
  !*** ./src/components/middle/composer/AttachBotIcon.module.scss ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"mklnEg0s","compact":"VGmPJoga","image":"tT8KQwg0"});

/***/ },

/***/ "./src/components/middle/composer/AttachBotIcon.tsx"
/*!**********************************************************!*\
  !*** ./src/components/middle/composer/AttachBotIcon.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _AttachBotIcon_module_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./AttachBotIcon.module.scss */ "./src/components/middle/composer/AttachBotIcon.module.scss");








const ADDITIONAL_STROKE_WIDTH = '0.5px';
const DARK_THEME_COLOR = 'rgb(170, 170, 170)';
const LIGHT_THEME_COLOR = 'rgb(112, 117, 121)';
const COLOR_REPLACE_PATTERN = /#fff/gi;
const AttachBotIcon = ({
  icon,
  theme
}) => {
  const {
    isTouchScreen
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const mediaData = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_5__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getDocumentMediaHash)(icon, 'full'), false, _api_types__WEBPACK_IMPORTED_MODULE_1__.ApiMediaFormat.Text);
  const iconSvg = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!mediaData) return '';
    const color = theme === 'dark' ? DARK_THEME_COLOR : LIGHT_THEME_COLOR;
    const mediaDataWithReplacedColors = mediaData.replace(COLOR_REPLACE_PATTERN, color);
    const doc = new DOMParser().parseFromString(mediaDataWithReplacedColors, 'image/svg+xml');
    doc.querySelectorAll('path').forEach(path => {
      path.style.stroke = color;
      path.style.strokeWidth = ADDITIONAL_STROKE_WIDTH;
    });
    return `data:image/svg+xml;utf8,${doc.documentElement.outerHTML}`;
  }, [mediaData, theme]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("i", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_AttachBotIcon_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].root, 'icon', !isTouchScreen && _AttachBotIcon_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].compact)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: iconSvg,
    alt: "",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_AttachBotIcon_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].image, !isTouchScreen && _AttachBotIcon_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].compact),
    draggable: false
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(AttachBotIcon));

/***/ },

/***/ "./src/components/middle/composer/AttachBotItem.tsx"
/*!**********************************************************!*\
  !*** ./src/components/middle/composer/AttachBotItem.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _AttachBotIcon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./AttachBotIcon */ "./src/components/middle/composer/AttachBotIcon.tsx");









const AttachBotItem = ({
  bot,
  theme,
  chatId,
  threadId,
  isInSideMenu,
  canShowNew,
  onMenuOpened,
  onMenuClosed
}) => {
  const {
    callAttachBot,
    toggleAttachBot
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const icon = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return bot.icons.find(({
      name
    }) => name === 'default_static')?.document;
  }, [bot.icons]);
  const [isMenuOpen, openMenu, closeMenu] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const [menuPosition, setMenuPosition] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const handleContextMenu = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(e => {
    e.preventDefault();
    const rect = e.currentTarget.getBoundingClientRect();
    setMenuPosition({
      x: rect.right,
      y: rect.bottom
    });
    onMenuOpened();
    openMenu();
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    if (isInSideMenu) {
      callAttachBot({
        bot,
        isFromSideMenu: true
      });
    } else {
      callAttachBot({
        bot,
        chatId: chatId,
        threadId
      });
    }
  });
  const handleCloseMenu = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    closeMenu();
    onMenuClosed();
  });
  const handleCloseAnimationEnd = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    setMenuPosition(undefined);
  });
  const handleRemoveBot = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    toggleAttachBot({
      botId: bot.id,
      isEnabled: false
    });
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_6__["default"], {
    key: bot.id,
    customIcon: icon && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AttachBotIcon__WEBPACK_IMPORTED_MODULE_7__["default"], {
      icon: icon,
      theme: theme
    }),
    icon: !icon ? 'bots' : undefined,
    onClick: handleClick,
    onContextMenu: handleContextMenu
  }, bot.shortName, canShowNew && bot.isDisclaimerNeeded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "menu-item-badge"
  }, lang('New')), menuPosition && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_5__["default"], {
    isOpen: isMenuOpen,
    positionX: "right",
    style: `left: ${menuPosition.x}px;top: ${menuPosition.y}px;`,
    className: "bot-attach-context-menu",
    autoClose: true,
    withPortal: true,
    onClose: handleCloseMenu,
    onCloseAnimationEnd: handleCloseAnimationEnd
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_6__["default"], {
    icon: "stop",
    destructive: true,
    onClick: handleRemoveBot
  }, lang('WebApp.RemoveBot'))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(AttachBotItem));

/***/ },

/***/ "./src/components/middle/composer/AttachMenu.scss"
/*!********************************************************!*\
  !*** ./src/components/middle/composer/AttachMenu.scss ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/composer/AttachMenu.tsx"
/*!*******************************************************!*\
  !*** ./src/components/middle/composer/AttachMenu.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_debugConsole__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/debugConsole */ "./src/util/debugConsole.ts");
/* harmony import */ var _util_files__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/files */ "./src/util/files.ts");
/* harmony import */ var _util_systemFilesDialog__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/systemFilesDialog */ "./src/util/systemFilesDialog.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMouseInside__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useMouseInside */ "./src/hooks/useMouseInside.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/ResponsiveHoverButton */ "./src/components/ui/ResponsiveHoverButton.tsx");
/* harmony import */ var _AttachBotItem__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./AttachBotItem */ "./src/components/middle/composer/AttachBotItem.tsx");
/* harmony import */ var _AttachMenu_scss__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./AttachMenu.scss */ "./src/components/middle/composer/AttachMenu.scss");





















const AttachMenu = ({
  chatId,
  threadId,
  isButtonVisible,
  canAttachMedia,
  canAttachPolls,
  canAttachToDoLists,
  canSendPhotos,
  canSendVideos,
  canSendDocuments,
  canSendAudios,
  attachBots,
  peerType,
  isScheduled,
  theme,
  shouldCollectDebugLogs,
  canEditMedia,
  editingMessage,
  messageListType,
  paidMessagesStars,
  onFileSelect,
  onMenuOpen,
  onMenuClose,
  onPollCreate,
  onTodoListCreate
}) => {
  const {
    updateAttachmentSettings
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isAttachMenuOpen, openAttachMenu, closeAttachMenu] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [handleMouseEnter, handleMouseLeave, markMouseInside] = (0,_hooks_useMouseInside__WEBPACK_IMPORTED_MODULE_12__["default"])(isAttachMenuOpen, closeAttachMenu);
  const canSendVideoAndPhoto = canSendPhotos && canSendVideos;
  const canSendVideoOrPhoto = canSendPhotos || canSendVideos;
  const [isAttachmentBotMenuOpen, markAttachmentBotMenuOpen, unmarkAttachmentBotMenuOpen] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const isMenuOpen = isAttachMenuOpen || isAttachmentBotMenuOpen;
  const isPhotoOrVideo = editingMessage && editingMessage?.groupedId && Boolean((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessagePhoto)(editingMessage) || Boolean((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageVideo)(editingMessage)));
  const isFile = editingMessage && editingMessage?.groupedId && Boolean((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageAudio)(editingMessage) || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageVoice)(editingMessage) || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageDocument)(editingMessage));
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isAttachMenuOpen) {
      markMouseInside();
    }
  }, [isAttachMenuOpen, markMouseInside]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isMenuOpen) {
      onMenuOpen();
    } else {
      onMenuClose();
    }
  }, [isMenuOpen, onMenuClose, onMenuOpen]);
  const handleToggleAttachMenu = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (isAttachMenuOpen) {
      closeAttachMenu();
    } else {
      openAttachMenu();
    }
  });
  const handleFileSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    const {
      files
    } = e.target;
    const validatedFiles = (0,_util_files__WEBPACK_IMPORTED_MODULE_7__.validateFiles)(files);
    if (validatedFiles?.length) {
      onFileSelect(validatedFiles);
    }
  });
  const handleQuickSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    updateAttachmentSettings({
      shouldCompress: true
    });
    (0,_util_systemFilesDialog__WEBPACK_IMPORTED_MODULE_8__.openSystemFilesDialog)(Array.from(canSendVideoAndPhoto ? _config__WEBPACK_IMPORTED_MODULE_2__.CONTENT_TYPES_WITH_PREVIEW : canSendPhotos ? _config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_PHOTO_CONTENT_TYPES : _config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_VIDEO_CONTENT_TYPES).join(','), e => handleFileSelect(e));
  });
  const handleDocumentSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    updateAttachmentSettings({
      shouldCompress: false
    });
    (0,_util_systemFilesDialog__WEBPACK_IMPORTED_MODULE_8__.openSystemFilesDialog)(!canSendDocuments && canSendAudios ? Array.from(_config__WEBPACK_IMPORTED_MODULE_2__.SUPPORTED_AUDIO_CONTENT_TYPES).join(',') : '*', e => handleFileSelect(e));
  });
  const handleSendLogs = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    const file = new File([(0,_util_debugConsole__WEBPACK_IMPORTED_MODULE_6__.getDebugLogs)()], _config__WEBPACK_IMPORTED_MODULE_2__.DEBUG_LOG_FILENAME, {
      type: 'text/plain'
    });
    onFileSelect([file]);
  });
  const bots = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return attachBots ? Object.values(attachBots).filter(bot => {
      if (!peerType || !bot.isForAttachMenu) return false;
      if (peerType === 'bots' && bot.id === chatId && bot.attachMenuPeerTypes && bot.attachMenuPeerTypes.includes('self')) {
        return true;
      }
      return bot.attachMenuPeerTypes.includes(peerType);
    }) : undefined;
  }, [attachBots, chatId, peerType]);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  if (!isButtonVisible) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "AttachMenu"
  }, editingMessage && canEditMedia ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_17__["default"], {
    id: "replace-menu-button",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('AttachMenu--button composer-action-button', isAttachMenuOpen && 'activated'),
    round: true,
    color: "translucent",
    onActivate: handleToggleAttachMenu,
    ariaLabel: "Replace an attachment",
    ariaControls: "replace-menu-controls",
    hasPopup: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_14__["default"], {
    name: "replace"
  })) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_17__["default"], {
    id: "attach-menu-button",
    disabled: Boolean(editingMessage),
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('AttachMenu--button composer-action-button', isAttachMenuOpen && 'activated'),
    round: true,
    color: "translucent",
    onActivate: handleToggleAttachMenu,
    ariaLabel: "Add an attachment",
    ariaControls: "attach-menu-controls",
    hasPopup: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_14__["default"], {
    name: "attach"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_15__["default"], {
    id: "attach-menu-controls",
    isOpen: isMenuOpen,
    autoClose: true,
    positionX: "right",
    positionY: "bottom",
    onClose: closeAttachMenu,
    className: "AttachMenu--menu fluid",
    onCloseAnimationEnd: closeAttachMenu,
    onMouseEnter: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV ? handleMouseEnter : undefined,
    onMouseLeave: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV ? handleMouseLeave : undefined,
    noCloseOnBackdrop: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_TOUCH_ENV,
    ariaLabelledBy: "attach-menu-button"
  }, !canAttachMedia && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    className: "media-disabled",
    disabled: true
  }, lang(messageListType === 'scheduled' && paidMessagesStars ? 'DescriptionScheduledPaidMediaNotAllowed' : 'DescriptionRestrictedMedia')), canAttachMedia && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, canSendVideoOrPhoto && !isFile && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    icon: "photo",
    onClick: handleQuickSelect
  }, oldLang(canSendVideoAndPhoto ? 'AttachmentMenu.PhotoOrVideo' : canSendPhotos ? 'InputAttach.Popover.Photo' : 'InputAttach.Popover.Video')), (canSendDocuments || canSendAudios) && !isPhotoOrVideo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    icon: "document",
    onClick: handleDocumentSelect
  }, oldLang(!canSendDocuments && canSendAudios ? 'InputAttach.Popover.Music' : 'AttachDocument')), canSendDocuments && shouldCollectDebugLogs && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    icon: "bug",
    onClick: handleSendLogs
  }, oldLang('DebugSendLogs'))), canAttachPolls && !editingMessage && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    icon: "poll",
    onClick: onPollCreate
  }, oldLang('Poll')), canAttachToDoLists && !editingMessage && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
    icon: "select",
    onClick: onTodoListCreate
  }, lang('TitleToDoList')), !editingMessage && !canEditMedia && !isScheduled && bots?.map(bot => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AttachBotItem__WEBPACK_IMPORTED_MODULE_18__["default"], {
    bot: bot,
    chatId: chatId,
    threadId: threadId,
    theme: theme,
    onMenuOpened: markAttachmentBotMenuOpen,
    onMenuClosed: unmarkAttachmentBotMenuOpen
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(AttachMenu));

/***/ },

/***/ "./src/components/middle/composer/AttachmentModal.async.tsx"
/*!******************************************************************!*\
  !*** ./src/components/middle/composer/AttachmentModal.async.tsx ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const AttachmentModalAsync = props => {
  const {
    attachments
  } = props;
  const AttachmentModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'AttachmentModal', !attachments.length);
  return AttachmentModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(AttachmentModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (AttachmentModalAsync);

/***/ },

/***/ "./src/components/middle/composer/BotCommandMenu.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/middle/composer/BotCommandMenu.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const BotCommandMenuAsync = props => {
  const {
    isOpen
  } = props;
  const BotCommandMenu = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'BotCommandMenu', !isOpen);
  return BotCommandMenu ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(BotCommandMenu, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (BotCommandMenuAsync);

/***/ },

/***/ "./src/components/middle/composer/BotKeyboardMenu.scss"
/*!*************************************************************!*\
  !*** ./src/components/middle/composer/BotKeyboardMenu.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/composer/BotKeyboardMenu.tsx"
/*!************************************************************!*\
  !*** ./src/components/middle/composer/BotKeyboardMenu.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers/renderKeyboardButtonText */ "./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx");
/* harmony import */ var _hooks_useMouseInside__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useMouseInside */ "./src/hooks/useMouseInside.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _BotKeyboardMenu_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./BotKeyboardMenu.scss */ "./src/components/middle/composer/BotKeyboardMenu.scss");











const BotKeyboardMenu = ({
  isOpen,
  message,
  onClose
}) => {
  const {
    clickBotInlineButton
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const [handleMouseEnter, handleMouseLeave] = (0,_hooks_useMouseInside__WEBPACK_IMPORTED_MODULE_5__["default"])(isOpen, onClose);
  const {
    isKeyboardSingleUse
  } = message || {};
  const buttonTexts = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const texts = [];
    message?.keyboardButtons.forEach(row => {
      texts.push(row.map(button => (0,_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_4__["default"])(lang, button)));
    });
    return texts;
  }, [lang, message?.keyboardButtons]);
  if (!message || !message.keyboardButtons) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_8__["default"], {
    isOpen: isOpen,
    autoClose: isKeyboardSingleUse,
    positionX: "right",
    positionY: "bottom",
    onClose: onClose,
    className: "BotKeyboardMenu",
    onCloseAnimationEnd: onClose,
    onMouseEnter: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV ? handleMouseEnter : undefined,
    onMouseLeave: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV ? handleMouseLeave : undefined,
    noCompact: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "content custom-scroll"
  }, message.keyboardButtons.map((row, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "row"
  }, row.map((button, j) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
    ripple: true,
    disabled: button.type === 'unsupported',
    onClick: () => clickBotInlineButton({
      chatId: message.chatId,
      messageId: message.id,
      button
    })
  }, buttonTexts?.[i][j]))))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  messageId
}) => {
  const {
    chatId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectCurrentMessageList)(global) || {};
  if (!chatId) {
    return {};
  }
  return {
    message: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectChatMessage)(global, chatId, messageId)
  };
})(BotKeyboardMenu)));

/***/ },

/***/ "./src/components/middle/composer/BotMenuButton.tsx"
/*!**********************************************************!*\
  !*** ./src/components/middle/composer/BotMenuButton.tsx ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");






const BotMenuButton = ({
  isOpen,
  onClick,
  text,
  isDisabled
}) => {
  const textRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const textEl = textRef.current;
    if (!textEl) return;
    const width = textEl.scrollWidth + 1; // Make width slightly bigger prevent ellipsis in some cases

    const composerEl = textEl.closest('.Composer');
    composerEl.style.setProperty('--bot-menu-text-width', `${width}px`);
  }, [isOpen, text]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const textEl = textRef.current;
    if (!textEl) return undefined;
    const composerEl = textEl.closest('.Composer');
    return () => {
      composerEl.style.removeProperty('--bot-menu-text-width');
    };
  }, []);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_4__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('composer-action-button bot-menu', isOpen && 'open'),
    round: true,
    color: "translucent",
    disabled: isDisabled,
    onClick: onClick,
    ariaLabel: "Open bot command keyboard"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_3__["default"], {
    name: "webapp",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('bot-menu-icon', isOpen && 'open')
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    ref: textRef,
    className: "bot-menu-text"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_2__["default"])(text)));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(BotMenuButton));

/***/ },

/***/ "./src/components/middle/composer/ChatCommandTooltip.async.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/middle/composer/ChatCommandTooltip.async.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ChatCommandTooltipAsync = props => {
  const {
    isOpen
  } = props;
  const ChatCommandTooltip = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ChatCommandTooltip', !isOpen);
  return ChatCommandTooltip ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ChatCommandTooltip, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatCommandTooltipAsync);

/***/ },

/***/ "./src/components/middle/composer/ComposerEmbeddedMessage.scss"
/*!*********************************************************************!*\
  !*** ./src/components/middle/composer/ComposerEmbeddedMessage.scss ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/composer/ComposerEmbeddedMessage.tsx"
/*!********************************************************************!*\
  !*** ./src/components/middle/composer/ComposerEmbeddedMessage.tsx ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_media__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_helpers_peerColor__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/helpers/peerColor */ "./src/components/common/helpers/peerColor.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _common_embedded_EmbeddedMessage__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/embedded/EmbeddedMessage */ "./src/components/common/embedded/EmbeddedMessage.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/MenuSeparator */ "./src/components/ui/MenuSeparator.tsx");
/* harmony import */ var _ComposerEmbeddedMessage_scss__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./ComposerEmbeddedMessage.scss */ "./src/components/middle/composer/ComposerEmbeddedMessage.scss");























const CLOSE_DURATION = 350;
const ComposerEmbeddedMessage = ({
  replyInfo,
  suggestedPostInfo,
  editingId,
  message,
  sender,
  shouldAnimate,
  forwardedMessagesCount,
  noAuthors,
  noCaptions,
  forwardsHaveCaptions,
  copyForward,
  shouldForceShowEditing,
  isCurrentUserPremium,
  isContextMenuDisabled,
  isReplyToDiscussion,
  isInChangingRecipientMode,
  shouldPreventComposerAnimation,
  senderChat,
  chatId,
  currentUserId,
  isSenderChannel,
  forwardMessageIds,
  fromChatId,
  isMediaNsfw,
  onClear
}) => {
  const {
    resetDraftReplyInfo,
    resetDraftSuggestedPostInfo,
    updateDraftReplyInfo,
    setEditingId,
    focusMessage,
    changeRecipient,
    openChatOrTopicWithReplyInDraft,
    setForwardNoAuthors,
    setForwardNoCaptions,
    exitForwardMode,
    setShouldPreventComposerAnimation,
    openSuggestMessageModal,
    setForwardCopyForward
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const isReplyToTopicStart = message?.content.action?.type === 'topicCreate';
  const isShowingReply = replyInfo && !shouldForceShowEditing;
  const isReplyWithQuote = Boolean(replyInfo?.quoteText);
  const isShowingSuggestedPost = Boolean(suggestedPostInfo) && !shouldForceShowEditing;
  const isForwarding = Boolean(forwardedMessagesCount);
  const selectSenderFromForwardedMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(forwardedMessage => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectForwardedSender)(global, forwardedMessage);
    if (!sender) {
      sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectSender)(global, forwardedMessage);
    }
    return sender;
  });
  const forwardSenders = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isForwarding) return undefined;
    const forwardedMessages = forwardMessageIds?.map(id => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatMessage)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), fromChatId, id)).filter(Boolean);
    const senders = forwardedMessages?.map(m => selectSenderFromForwardedMessage(m)).filter(Boolean);
    return senders ? (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.unique)(senders) : undefined;
  }, [isForwarding, forwardMessageIds, fromChatId]);
  const isShown = (() => {
    if (isInChangingRecipientMode) return false;
    if (message && (replyInfo || editingId)) return true;
    if (forwardSenders && isForwarding) return true;
    if (isShowingSuggestedPost) return true;
    return false;
  })();
  const {
    shouldRender,
    transitionClassNames
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_14__["default"])(isShown && !isReplyToTopicStart && !isReplyToDiscussion, undefined, !shouldAnimate, undefined, !shouldAnimate, CLOSE_DURATION, !shouldAnimate);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldPreventComposerAnimation) {
      setShouldPreventComposerAnimation({
        shouldPreventComposerAnimation: false
      });
    }
  });
  const clearEmbedded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    if (editingId) {
      setEditingId({
        messageId: undefined
      });
    } else if (forwardedMessagesCount) {
      exitForwardMode();
    } else if (isShowingSuggestedPost) {
      resetDraftSuggestedPostInfo();
      resetDraftReplyInfo();
    } else if (replyInfo && !shouldForceShowEditing) {
      resetDraftReplyInfo();
    }
    onClear?.();
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isShown ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_6__["default"])(clearEmbedded) : undefined, [isShown, clearEmbedded]);
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_9__["default"])(ref);
  const focusMessageFromDraft = () => {
    focusMessage({
      chatId: message.chatId,
      messageId: message.id,
      noForumTopicPanel: true
    });
  };
  const handleMessageClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(e => {
    if (suggestedPostInfo) {
      openSuggestMessageModal({
        chatId
      });
      return;
    }
    handleContextMenu(e);
  });
  const handleClearClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(e => {
    e.stopPropagation();
    clearEmbedded();
    handleContextMenuHide();
  });
  const buildAutoCloseMenuItemHandler = action => {
    return () => {
      handleContextMenuClose();
      action();
    };
  };
  const handleForwardToAnotherChatClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(buildAutoCloseMenuItemHandler(changeRecipient));
  const handleShowMessageClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(buildAutoCloseMenuItemHandler(focusMessageFromDraft));
  const handleRemoveQuoteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(buildAutoCloseMenuItemHandler(() => updateDraftReplyInfo({
    quoteText: undefined
  })));
  const handleChangeReplyRecipientClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(buildAutoCloseMenuItemHandler(changeRecipient));
  const handleReplyInSenderChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    handleContextMenuClose();
    if (!sender) return;
    openChatOrTopicWithReplyInDraft({
      chatId: sender.id
    });
  });
  const handleDoNotReplyClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(buildAutoCloseMenuItemHandler(clearEmbedded));
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => ref.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => ref.current);
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => ref.current.querySelector('.forward-context-menu .bubble'));
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!shouldRender) {
      handleContextMenuClose();
      handleContextMenuHide();
    }
  }, [handleContextMenuClose, handleContextMenuHide, shouldRender]);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('ComposerEmbeddedMessage', transitionClassNames);
  const renderingSender = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_10__["default"])(sender, true);
  const innerClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('ComposerEmbeddedMessage_inner', (0,_common_helpers_peerColor__WEBPACK_IMPORTED_MODULE_8__.getPeerColorClass)(renderingSender));
  const leftIcon = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (editingId) {
      return 'edit';
    }
    if (isShowingSuggestedPost) {
      return 'cash-circle';
    }
    if (isForwarding) {
      return 'forward';
    }
    if (isShowingReply) {
      return 'reply';
    }
    return undefined;
  }, [editingId, isForwarding, isShowingReply, isShowingSuggestedPost]);
  const customText = forwardedMessagesCount && forwardedMessagesCount > 1 ? oldLang('ForwardedMessageCount', forwardedMessagesCount) : undefined;
  const strippedMessage = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!message || !isForwarding || !message.content.text || !noAuthors || isCurrentUserPremium) return message;
    const strippedText = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.stripCustomEmoji)(message.content.text);
    return {
      ...message,
      content: {
        ...message.content,
        text: strippedText
      }
    };
  }, [isCurrentUserPremium, isForwarding, message, noAuthors]);
  const renderingLeftIcon = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_10__["default"])(leftIcon, true);
  if (!shouldRender) {
    return undefined;
  }
  const canReplyInSenderChat = sender && !isSenderChannel && chatId !== sender.id && sender.id !== currentUserId;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: className,
    ref: ref,
    onContextMenu: handleContextMenu
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: innerClassName
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "embedded-left-icon",
    onClick: handleContextMenu
  }, renderingLeftIcon && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
    name: renderingLeftIcon
  }), Boolean(replyInfo?.quoteText) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
    name: "quote",
    className: "quote-reply"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_embedded_EmbeddedMessage__WEBPACK_IMPORTED_MODULE_15__.ClosableEmbeddedMessage, {
    isOpen: isShown,
    className: "inside-input",
    replyInfo: replyInfo,
    suggestedPostInfo: suggestedPostInfo,
    isMediaNsfw: isMediaNsfw,
    isInComposer: true,
    message: strippedMessage,
    sender: !noAuthors ? sender : undefined,
    composerForwardSenders: forwardSenders,
    customText: customText,
    title: editingId && !isShowingReply ? oldLang('EditMessage') : noAuthors ? oldLang('HiddenSendersNameDescription') : copyForward ? oldLang('CopyForwardDescription') : undefined,
    onClick: handleMessageClick,
    senderChat: senderChat
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    className: "embedded-cancel",
    round: true,
    faded: true,
    color: "translucent",
    ariaLabel: oldLang('Cancel'),
    onClick: handleClearClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
    name: "close"
  })), (isShowingReply || isForwarding) && !isContextMenuDisabled && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_18__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuAnchor,
    getTriggerElement: getTriggerElement,
    getRootElement: getRootElement,
    getMenuElement: getMenuElement,
    className: "forward-context-menu",
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide
  }, isForwarding && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: !noAuthors ? 'message-succeeded' : undefined,
    customIcon: noAuthors ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
      name: "placeholder"
    }) : undefined,
    onClick: () => setForwardNoAuthors({
      noAuthors: false
    })
  }, oldLang(forwardedMessagesCount > 1 ? 'ShowSenderNames' : 'ShowSendersName')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: noAuthors ? 'message-succeeded' : undefined,
    customIcon: !noAuthors ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
      name: "placeholder"
    }) : undefined,
    onClick: () => setForwardNoAuthors({
      noAuthors: true
    })
  }, oldLang(forwardedMessagesCount > 1 ? 'HideSenderNames' : 'HideSendersName')), forwardsHaveCaptions && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_20__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: !noCaptions ? 'message-succeeded' : undefined,
    customIcon: noCaptions ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
      name: "placeholder"
    }) : undefined,
    onClick: () => setForwardNoCaptions({
      noCaptions: false
    })
  }, oldLang(forwardedMessagesCount > 1 ? 'Conversation.ForwardOptions.ShowCaption' : 'ShowCaption')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: noCaptions ? 'message-succeeded' : undefined,
    customIcon: !noCaptions ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
      name: "placeholder"
    }) : undefined,
    onClick: () => setForwardNoCaptions({
      noCaptions: true
    })
  }, oldLang(forwardedMessagesCount > 1 ? 'Conversation.ForwardOptions.HideCaption' : 'HideCaption'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_20__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: copyForward ? 'message-succeeded' : undefined,
    customIcon: !copyForward ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
      name: "placeholder"
    }) : undefined,
    onClick: () => setForwardCopyForward({
      copyForward: true
    })
  }, oldLang('CopyForwardEnable')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: !copyForward ? 'message-succeeded' : undefined,
    customIcon: copyForward ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_16__["default"], {
      name: "placeholder"
    }) : undefined,
    onClick: () => setForwardCopyForward({
      copyForward: false
    })
  }, oldLang('CopyForwardDisable')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_20__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: "replace",
    onClick: handleForwardToAnotherChatClick
  }, oldLang('ForwardAnotherChat'))), isShowingReply && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: "show-message",
    onClick: handleShowMessageClick
  }, oldLang('Message.Context.Goto')), isReplyWithQuote && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: "remove-quote",
    onClick: handleRemoveQuoteClick
  }, oldLang('RemoveQuote')), canReplyInSenderChat && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: "user",
    onClick: handleReplyInSenderChat
  }, lang('ReplyInPrivateMessage')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: "replace",
    onClick: handleChangeReplyRecipientClick
  }, oldLang('ReplyToAnotherChat')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_19__["default"], {
    icon: "delete",
    onClick: handleDoNotReplyClick
  }, oldLang('DoNotReply'))))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  shouldForceShowEditing,
  chatId,
  threadId,
  messageListType
}) => {
  const {
    forwardMessages: {
      fromChatId,
      toChatId,
      messageIds: forwardMessageIds,
      noAuthors,
      noCaptions,
      copyForward
    },
    isShareMessageModalShown: isModalShown,
    shouldPreventComposerAnimation
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const editingId = messageListType === 'scheduled' ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectEditingScheduledId)(global, chatId) : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectEditingId)(global, chatId, threadId);
  const shouldAnimate = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanAnimateInterface)(global) && !shouldPreventComposerAnimation;
  const isForwarding = toChatId === chatId;
  const forwardedMessages = forwardMessageIds?.map(id => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatMessage)(global, fromChatId, id));
  const draft = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectDraft)(global, chatId, threadId);
  const replyInfo = draft?.replyInfo;
  const suggestedPostInfo = draft?.suggestedPostInfo;
  const replyToPeerId = replyInfo?.replyToPeerId;
  const senderChat = replyToPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, replyToPeerId) : undefined;
  let message;
  if (editingId) {
    message = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectEditingMessage)(global, chatId, threadId, messageListType);
  } else if (isForwarding && forwardMessageIds.length === 1) {
    message = forwardedMessages?.[0];
  } else if (replyInfo && !shouldForceShowEditing) {
    message = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatMessage)(global, replyInfo.replyToPeerId || chatId, replyInfo.replyToMsgId);
  }
  let sender;
  const selectSenderFromForwardedMessage = forwardedMessage => {
    sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectForwardedSender)(global, forwardedMessage);
    if (!sender) {
      sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectSender)(global, forwardedMessage);
    }
    return sender;
  };
  if (editingId && message) {
    sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectSender)(global, message);
  } else if (isForwarding) {
    let forwardSenders = forwardedMessages?.map(m => selectSenderFromForwardedMessage(m)).filter(Boolean);
    forwardSenders = forwardSenders ? (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.unique)(forwardSenders) : undefined;
    sender = forwardSenders?.length === 1 ? forwardSenders?.[0] : undefined;
  } else if (replyInfo && message && !shouldForceShowEditing) {
    const {
      forwardInfo
    } = message;
    const isChatWithSelf = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsChatWithSelf)(global, chatId);
    if (forwardInfo && (forwardInfo.isChannelPost || isChatWithSelf)) {
      sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectForwardedSender)(global, message);
    }
    if (!sender && (!forwardInfo?.hiddenUserName || Boolean(replyInfo.quoteText))) {
      sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectSender)(global, message);
    }
  }
  const chat = sender && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, sender.id);
  const isSenderChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatChannel)(chat);
  const forwardsHaveCaptions = forwardedMessages?.some(forward => forward?.content.text && Object.keys(forward.content).length > 1);
  const isContextMenuDisabled = isForwarding && forwardMessageIds.length === 1 && Boolean(message?.content.storyData);
  const isReplyToDiscussion = replyInfo?.replyToMsgId === threadId && !replyInfo.replyToPeerId;
  const isMediaNsfw = message && (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_4__.selectIsMediaNsfw)(global, message);
  return {
    replyInfo,
    suggestedPostInfo,
    editingId,
    message,
    sender,
    shouldAnimate,
    forwardedMessagesCount: isForwarding ? forwardMessageIds.length : undefined,
    noAuthors,
    noCaptions,
    forwardsHaveCaptions,
    copyForward,
    isCurrentUserPremium: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserPremium)(global),
    isContextMenuDisabled,
    isReplyToDiscussion,
    isInChangingRecipientMode: isModalShown,
    shouldPreventComposerAnimation,
    senderChat,
    currentUserId: global.currentUserId,
    isSenderChannel,
    forwardMessageIds,
    fromChatId,
    isMediaNsfw
  };
})(ComposerEmbeddedMessage)));

/***/ },

/***/ "./src/components/middle/composer/ComposerTranslatededMessage.scss"
/*!*************************************************************************!*\
  !*** ./src/components/middle/composer/ComposerTranslatededMessage.scss ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/composer/ComposerTranslatededMessage.tsx"
/*!************************************************************************!*\
  !*** ./src/components/middle/composer/ComposerTranslatededMessage.tsx ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_focusEditableElement__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/focusEditableElement */ "./src/util/focusEditableElement.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _chatAssistant_hook_useEventBusTeact__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../chatAssistant/hook/useEventBusTeact */ "./src/components/chatAssistant/hook/useEventBusTeact.ts");
/* harmony import */ var _chatAssistant_utils_util__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../chatAssistant/utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ComposerTranslatededMessage_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./ComposerTranslatededMessage.scss */ "./src/components/middle/composer/ComposerTranslatededMessage.scss");
/* harmony import */ var _util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../util/subscriptionHandler */ "./src/util/subscriptionHandler.ts");
/* eslint-disable no-console */
















const ComposerTranslatededMessage = ({
  chatId,
  currentUserId,
  currentUser,
  getHtml,
  inputTranslateOptions,
  onUpdate,
  onSend
}) => {
  const [inputValue, setInputValue] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const timerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const lastHtmlRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)('');
  const [isTranslate, setIsTranslate] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const inputRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    showNotification,
    openCreditLimitModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const html = getHtml();

    // 内容没变，不处理
    if (html === lastHtmlRef.current) return;
    lastHtmlRef.current = html;

    // 清除上一次定时器（防抖）
    if (timerRef.current) {
      clearTimeout(timerRef.current);
    }
    timerRef.current = setTimeout(() => {
      try {
        const {
          text
        } = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_6__["default"])(html);
        if (!text?.trim()) return;
        if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_14__.checkCredisBalance)()) {
          openCreditLimitModal({
            title: 'Translation failed',
            message: "You've reached your credit limit. Please upgrade your plan."
          });
          return;
        }
        setIsTranslate(true);
        (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_7__.callApi)('translateTextByTencent', {
          text: [{
            text
          }],
          toLanguageCode: inputTranslateOptions.translateLanguage,
          userId: currentUserId,
          userName: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(currentUser)
        }).then(result => {
          if (result && result[0].text) {
            setInputValue(result[0].text);
            inputRef.current.innerHTML = result[0].text;
          }
        }).finally(() => {
          setIsTranslate(false);
        });
      } catch (e) {
        console.error('translate error', e);
      }
    }, 2000);
    return () => {
      if (timerRef.current) {
        clearTimeout(timerRef.current);
      }
    };
  }, [chatId, currentUser, currentUserId, getHtml, inputTranslateOptions.translateLanguage]);
  const focusInput = () => {
    if (!inputRef.current) {
      return;
    }
    (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_5__["default"])(inputRef.current);
  };
  const handleChange = e => {
    const {
      innerHTML
    } = e.currentTarget;
    setInputValue(innerHTML);
  };
  const handleSend = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    if (isTranslate || !inputValue) {
      showNotification({
        message: 'Please wait for the translation to finish.'
      });
      return;
    }
    onUpdate(inputValue);
    onSend();
  });
  (0,_chatAssistant_hook_useEventBusTeact__WEBPACK_IMPORTED_MODULE_8__.useEventListenerTeact)('actions:sendMessage', handleSend);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "ComposerTranslatededMessage px-[0.75rem] py-[10px] flex gap-[10px]"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "px-[14px] py-[12px] bg-[var(--color-peer-bg-2)] rounded-[14px] flex-1 w-full overflow-hidden"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "text-[12px] text-[var(--color-text-secondary)] flex items-center gap-[4px]"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, "Translated to"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, inputTranslateOptions.translateLanguageName)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "relative w-fit min-w-[32px] max-w-full"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_chatAssistant_utils_util__WEBPACK_IMPORTED_MODULE_9__.cn)('absolute w-full h-full z-[-1]', {
      'text-loading': isTranslate
    })
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: inputRef,
    className: "message-input text-[14px] text-[var(--color-text)] break-word whitespace-pre-wrap",
    contentEditable: true,
    role: "textbox",
    dir: "auto",
    tabIndex: 0,
    onClick: focusInput,
    onChange: handleChange
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
    round: true,
    color: "secondary",
    className: "!bg-[#E9F2FF] mt-auto",
    onClick: handleSend
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "send",
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])('color:var(--color-primary)')
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId
}) => {
  const {
    currentUserId
  } = global;
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, currentUserId);
  const inputTranslateOptions = global.roomInputTranslateOptions[chatId];
  return {
    currentUserId,
    currentUser,
    inputTranslateOptions
  };
})(ComposerTranslatededMessage)));

/***/ },

/***/ "./src/components/middle/composer/CustomEmojiTooltip.async.tsx"
/*!*********************************************************************!*\
  !*** ./src/components/middle/composer/CustomEmojiTooltip.async.tsx ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const CustomEmojiTooltipAsync = props => {
  const {
    isOpen
  } = props;
  const CustomEmojiTooltip = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CustomEmojiTooltip', !isOpen);
  return CustomEmojiTooltip ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CustomEmojiTooltip, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CustomEmojiTooltipAsync);

/***/ },

/***/ "./src/components/middle/composer/CustomSendMenu.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/middle/composer/CustomSendMenu.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const CustomSendMenuAsync = props => {
  const {
    isOpen
  } = props;
  const CustomSend = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'CustomSendMenu', !isOpen);
  return CustomSend ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(CustomSend, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CustomSendMenuAsync);

/***/ },

/***/ "./src/components/middle/composer/DropArea.async.tsx"
/*!***********************************************************!*\
  !*** ./src/components/middle/composer/DropArea.async.tsx ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   DropAreaState: () => (/* reexport safe */ _DropArea__WEBPACK_IMPORTED_MODULE_3__.DropAreaState),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");
/* harmony import */ var _DropArea__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./DropArea */ "./src/components/middle/composer/DropArea.tsx");



const DropAreaAsync = props => {
  const {
    isOpen
  } = props;
  const DropArea = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'DropArea', !isOpen);
  return DropArea ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(DropArea, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (DropAreaAsync);


/***/ },

/***/ "./src/components/middle/composer/DropArea.scss"
/*!******************************************************!*\
  !*** ./src/components/middle/composer/DropArea.scss ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/composer/DropArea.tsx"
/*!*****************************************************!*\
  !*** ./src/components/middle/composer/DropArea.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   DropAreaState: () => (/* binding */ DropAreaState),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./helpers/buildAttachment */ "./src/components/middle/composer/helpers/buildAttachment.ts");
/* harmony import */ var _helpers_getFilesFromDataTransferItems__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./helpers/getFilesFromDataTransferItems */ "./src/components/middle/composer/helpers/getFilesFromDataTransferItems.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _ui_Portal__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/Portal */ "./src/components/ui/Portal.ts");
/* harmony import */ var _DropTarget__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./DropTarget */ "./src/components/middle/composer/DropTarget.tsx");
/* harmony import */ var _DropArea_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./DropArea.scss */ "./src/components/middle/composer/DropArea.scss");















let DropAreaState = /*#__PURE__*/function (DropAreaState) {
  DropAreaState["None"] = "none";
  DropAreaState["Document"] = "document";
  DropAreaState["QuickFile"] = "quick_file";
  return DropAreaState;
}({});
const DROP_LEAVE_TIMEOUT_MS = 150;
const DropArea = ({
  isOpen,
  withQuick,
  editingMessage,
  onHide,
  onFileSelect
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    showNotification,
    updateAttachmentSettings
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const hideTimeoutRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const prevWithQuick = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_9__["default"])(withQuick);
  const {
    shouldRender,
    transitionClassNames
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_10__["default"])(isOpen);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => isOpen ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_4__["default"])(onHide) : undefined, [isOpen, onHide]);
  const handleFilesDrop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(async e => {
    const {
      dataTransfer: dt
    } = e;
    let files = [];
    if (dt.files && dt.files.length > 0 && (!dt.items || !dt.items.length)) {
      files = files.concat(Array.from(dt.files));
    } else if (dt.items && dt.items.length > 0) {
      const folderFiles = await (0,_helpers_getFilesFromDataTransferItems__WEBPACK_IMPORTED_MODULE_6__["default"])(dt.items);
      if (folderFiles?.length) {
        files = files.concat(folderFiles);
      }
    }
    if (editingMessage) {
      if (files.length > 1) {
        showNotification({
          message: lang('MediaReplaceInvalidError', undefined, {
            pluralValue: files.length
          })
        });
        return;
      }
      if (files.length === 1) {
        const newAttachment = await (0,_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_5__["default"])(files[0].name, files[0]);
        const canReplace = editingMessage && newAttachment && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.canReplaceMessageMedia)(editingMessage, newAttachment);
        if (!canReplace) {
          showNotification({
            message: lang('MediaReplaceInvalidError', undefined, {
              pluralValue: files.length
            })
          });
          return;
        }
      }
    }
    onHide();
    updateAttachmentSettings({
      shouldCompress: withQuick ? false : undefined
    });
    onFileSelect(files);
  });
  const handleQuickFilesDrop = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(async e => {
    const {
      dataTransfer: dt
    } = e;
    let files = [];
    if (dt.files && dt.files.length > 0) {
      const files = Array.from(dt.files);
      if (editingMessage) {
        if (files.length > 1) {
          showNotification({
            message: lang('MediaReplaceInvalidError', undefined, {
              pluralValue: files.length
            })
          });
          return;
        }
        if (files.length === 1) {
          const newAttachment = await (0,_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_5__["default"])(files[0].name, files[0]);
          const canReplace = editingMessage && newAttachment && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.canReplaceMessageMedia)(editingMessage, newAttachment);
          if (!canReplace) {
            showNotification({
              message: lang('MediaReplaceInvalidError', undefined, {
                pluralValue: files.length
              })
            });
            return;
          }
        }
      }
      onHide();
      updateAttachmentSettings({
        shouldCompress: true
      });
      onFileSelect(files);
    }
  });
  const handleDragLeave = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(e => {
    e.stopPropagation();
    const {
      target: fromTarget,
      relatedTarget: toTarget
    } = e;

    // Esc button pressed during drag event
    if (fromTarget.matches('.DropTarget, .DropArea') && (!toTarget || !toTarget.matches('.DropTarget, .DropArea'))) {
      hideTimeoutRef.current = window.setTimeout(() => {
        onHide();
      }, DROP_LEAVE_TIMEOUT_MS);
    }
  });
  const handleDragOver = () => {
    if (hideTimeoutRef.current) {
      window.clearTimeout(hideTimeoutRef.current);
    }
  };
  if (!shouldRender) {
    return undefined;
  }
  const shouldRenderQuick = withQuick || prevWithQuick;
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('DropArea', transitionClassNames);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Portal__WEBPACK_IMPORTED_MODULE_11__["default"], {
    containerSelector: "#middle-column-portals"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: className,
    onDragLeave: handleDragLeave,
    onDragOver: handleDragOver,
    onDrop: onHide,
    onClick: onHide
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DropTarget__WEBPACK_IMPORTED_MODULE_12__["default"], {
    onFileSelect: handleFilesDrop,
    isGeneric: !shouldRenderQuick
  }), shouldRenderQuick && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_DropTarget__WEBPACK_IMPORTED_MODULE_12__["default"], {
    onFileSelect: handleQuickFilesDrop,
    isQuick: true
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(DropArea));

/***/ },

/***/ "./src/components/middle/composer/DropTarget.scss"
/*!********************************************************!*\
  !*** ./src/components/middle/composer/DropTarget.scss ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/composer/DropTarget.tsx"
/*!*******************************************************!*\
  !*** ./src/components/middle/composer/DropTarget.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useEffectOnce__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useEffectOnce */ "./src/hooks/useEffectOnce.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _DropTarget_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./DropTarget.scss */ "./src/components/middle/composer/DropTarget.scss");









const DropTarget = ({
  isQuick,
  isGeneric,
  onFileSelect
}) => {
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const svgRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [isHovered, markHovered, unmarkHovered] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const handleDragLeave = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(e => {
    const {
      relatedTarget: toTarget
    } = e;
    if (toTarget) {
      e.stopPropagation();
    }
    unmarkHovered();
  });
  const handleResize = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    const svg = svgRef.current;
    if (!svg) {
      return;
    }
    const {
      width,
      height
    } = svg.getBoundingClientRect();
    svg.viewBox.baseVal.width = width;
    svg.viewBox.baseVal.height = height;
  });

  // Can't listen for SVG resize
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_5__["default"])(ref, handleResize);
  (0,_hooks_useEffectOnce__WEBPACK_IMPORTED_MODULE_2__["default"])(handleResize);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('DropTarget', isHovered && 'hovered');
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: className,
    ref: ref,
    onDrop: onFileSelect,
    onDragEnter: markHovered,
    onDragLeave: handleDragLeave,
    "data-dropzone": true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    className: "target-outline-container"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("rect", {
    className: "target-outline",
    x: "0",
    y: "0",
    width: "100%",
    height: "100%",
    rx: "8"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "target-content"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: isQuick ? 'photo' : 'document'
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title"
  }, "Drop files here to send them"), !isGeneric && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "description"
  }, isQuick ? 'in a quick way' : 'without compression')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(DropTarget));

/***/ },

/***/ "./src/components/middle/composer/EmojiTooltip.async.tsx"
/*!***************************************************************!*\
  !*** ./src/components/middle/composer/EmojiTooltip.async.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const EmojiTooltipAsync = props => {
  const {
    isOpen
  } = props;
  const EmojiTooltip = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'EmojiTooltip', !isOpen);
  return EmojiTooltip ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(EmojiTooltip, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (EmojiTooltipAsync);

/***/ },

/***/ "./src/components/middle/composer/InlineBotTooltip.async.tsx"
/*!*******************************************************************!*\
  !*** ./src/components/middle/composer/InlineBotTooltip.async.tsx ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const InlineBotTooltipAsync = props => {
  const {
    isOpen
  } = props;
  const InlineBotTooltip = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'InlineBotTooltip', !isOpen);
  return InlineBotTooltip ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(InlineBotTooltip, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InlineBotTooltipAsync);

/***/ },

/***/ "./src/components/middle/composer/MentionTooltip.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/middle/composer/MentionTooltip.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const MentionTooltipAsync = props => {
  const {
    isOpen
  } = props;
  const MentionTooltip = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'MentionTooltip', !isOpen);
  return MentionTooltip ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(MentionTooltip, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MentionTooltipAsync);

/***/ },

/***/ "./src/components/middle/composer/MessageInput.tsx"
/*!*********************************************************!*\
  !*** ./src/components/middle/composer/MessageInput.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_captureKeyboardListeners__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/captureKeyboardListeners */ "./src/util/captureKeyboardListeners.ts");
/* harmony import */ var _util_directInputManager__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/directInputManager */ "./src/util/directInputManager.ts");
/* harmony import */ var _util_emoji_parseEmojiOnlyString__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../util/emoji/parseEmojiOnlyString */ "./src/util/emoji/parseEmojiOnlyString.ts");
/* harmony import */ var _util_focusEditableElement__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/focusEditableElement */ "./src/util/focusEditableElement.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _chatAssistant_hook_useEventBusTeact__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../chatAssistant/hook/useEventBusTeact */ "./src/components/chatAssistant/hook/useEventBusTeact.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_selection__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./helpers/selection */ "./src/components/middle/composer/helpers/selection.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useInputCustomEmojis__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./hooks/useInputCustomEmojis */ "./src/components/middle/composer/hooks/useInputCustomEmojis.ts");
/* harmony import */ var _chatAssistant_component_input_grammar_InputGrammarWrapper__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../chatAssistant/component/input-grammar/InputGrammarWrapper */ "./src/components/chatAssistant/component/input-grammar/InputGrammarWrapper.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_TextTimer__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../ui/TextTimer */ "./src/components/ui/TextTimer.tsx");
/* harmony import */ var _TextFormatter_async__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./TextFormatter.async */ "./src/components/middle/composer/TextFormatter.async.tsx");




























const CONTEXT_MENU_CLOSE_DELAY_MS = 100;
// Focus slows down animation, also it breaks transition layout in Chrome
const FOCUS_DELAY_MS = 350;
const TRANSITION_DURATION_FACTOR = 50;
const SCROLLER_CLASS = 'input-scroller';
const INPUT_WRAPPER_CLASS = 'message-input-wrapper';
const MAX_ATTACHMENT_MODAL_INPUT_HEIGHT = 160;
const MAX_STORY_MODAL_INPUT_HEIGHT = 128;
const TAB_INDEX_PRIORITY_TIMEOUT = 2000;
// Heuristics allowing the user to make a triple click
const SELECTION_RECALCULATE_DELAY_MS = 260;
const TEXT_FORMATTER_SAFE_AREA_PX = 140;
// For some reason Safari inserts `<br>` after user removes text from input
const SAFARI_BR = '<br>';
const IGNORE_KEYS = ['Esc', 'Escape', 'Enter', 'PageUp', 'PageDown', 'Meta', 'Alt', 'Ctrl', 'ArrowDown', 'ArrowUp', 'Control', 'Shift'];
function clearSelection() {
  const selection = window.getSelection();
  if (!selection) {
    return;
  }
  if (selection.removeAllRanges) {
    selection.removeAllRanges();
  } else if (selection.empty) {
    selection.empty();
  }
}
const MessageInput = ({
  ref,
  id,
  chatId,
  captionLimit,
  isAttachmentModalInput,
  isStoryInput,
  customEmojiPrefix,
  editableInputId,
  isReady,
  isActive,
  getHtml,
  placeholder,
  timedPlaceholderLangKey,
  timedPlaceholderDate,
  forcedPlaceholder,
  canSendPlainText,
  canAutoFocus,
  noFocusInterception,
  shouldSuppressFocus,
  shouldSuppressTextFormatter,
  replyInfo,
  isSelectModeActive,
  canPlayAnimatedEmojis,
  messageSendKeyCombo,
  onUpdate,
  onSuppressedFocus,
  onSend,
  onScroll,
  onFocus,
  onBlur,
  isNeedPremium,
  messageListType,
  inputTranslateOptions
}) => {
  const {
    editLastMessage,
    replyToNextMessage,
    showAllowedMessageTypesNotification,
    openPremiumModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  let inputRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  if (ref) {
    inputRef = ref;
  }
  const selectionTimeoutRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const cloneRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const scrollerCloneRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const sharedCanvasRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const sharedCanvasHqRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const absoluteContainerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_20__["default"])();
  const isContextMenuOpenRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const [isTextFormatterOpen, openTextFormatter, closeTextFormatter] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const [textFormatterAnchorPosition, setTextFormatterAnchorPosition] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [selectedRange, setSelectedRange] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isTextFormatterDisabled, setIsTextFormatterDisabled] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const isMobileDevice = isMobile && (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_IOS || _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_ANDROID);
  const [shouldDisplayTimer, setShouldDisplayTimer] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    setShouldDisplayTimer(Boolean(timedPlaceholderLangKey && timedPlaceholderDate));
  }, [timedPlaceholderDate, timedPlaceholderLangKey]);
  const handleTimerEnd = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    setShouldDisplayTimer(false);
  });
  (0,_hooks_useInputCustomEmojis__WEBPACK_IMPORTED_MODULE_21__["default"])(getHtml, inputRef, sharedCanvasRef, sharedCanvasHqRef, absoluteContainerRef, customEmojiPrefix, canPlayAnimatedEmojis, isReady, isActive);
  const maxInputHeight = isAttachmentModalInput ? MAX_ATTACHMENT_MODAL_INPUT_HEIGHT : isStoryInput ? MAX_STORY_MODAL_INPUT_HEIGHT : isMobile ? 256 : 416;
  const updateInputHeight = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])((willSend = false) => {
    // Defer to avoid animation/layout conflicts during DOM updates
    (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_12__.fastRaf)(() => {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestForcedReflow)(() => {
        const scroller = inputRef.current.closest(`.${SCROLLER_CLASS}`);
        const currentHeight = Number(scroller.style.height.replace('px', ''));
        const clone = scrollerCloneRef.current;
        const {
          scrollHeight
        } = clone;
        const newHeight = Math.min(scrollHeight, maxInputHeight);
        if (newHeight === currentHeight) {
          return undefined;
        }
        const isOverflown = scrollHeight > maxInputHeight;
        function exec() {
          const transitionDuration = Math.round(TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight)));
          scroller.style.height = `${newHeight}px`;
          scroller.style.transitionDuration = `${transitionDuration}ms`;
          scroller.classList.toggle('overflown', isOverflown);
        }
        if (willSend) {
          // Delay to next frame to sync with sending animation
          (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMutation)(exec);
          return undefined;
        } else {
          return exec;
        }
      });
    });
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!isAttachmentModalInput) return;
    updateInputHeight(false);
  }, [isAttachmentModalInput, updateInputHeight]);
  const htmlRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(getHtml());
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    const html = isActive ? getHtml() : '';
    if (html !== inputRef.current.innerHTML) {
      inputRef.current.innerHTML = html;
      // inputRef.current!.dispatchEvent(new Event('input', { bubbles: true }));
    }
    if (html !== cloneRef.current.innerHTML) {
      cloneRef.current.innerHTML = html;
    }
    if (html !== htmlRef.current) {
      htmlRef.current = html;
      updateInputHeight(!html);
    }
  }, [getHtml, isActive, updateInputHeight]);
  const chatIdRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(chatId);
  chatIdRef.current = chatId;
  const focusInput = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    if (!inputRef.current || isNeedPremium) {
      return;
    }
    if ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.getIsHeavyAnimating)()) {
      setTimeout(focusInput, FOCUS_DELAY_MS);
      return;
    }
    (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_11__["default"])(inputRef.current);
  });
  const handleCloseTextFormatter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => {
    closeTextFormatter();
    clearSelection();
  });
  function checkSelection() {
    // Disable the formatter on iOS devices for now.
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_IOS) {
      return false;
    }
    const selection = window.getSelection();
    if (!selection || !selection.rangeCount || isContextMenuOpenRef.current) {
      closeTextFormatter();
      if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_ANDROID) {
        setIsTextFormatterDisabled(false);
      }
      return false;
    }
    const selectionRange = selection.getRangeAt(0);
    const selectedText = selectionRange.toString().trim();
    if (shouldSuppressTextFormatter || !(0,_helpers_selection__WEBPACK_IMPORTED_MODULE_15__.isSelectionInsideInput)(selectionRange, editableInputId || _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_ID) || !selectedText || (0,_util_emoji_parseEmojiOnlyString__WEBPACK_IMPORTED_MODULE_10__["default"])(selectedText) || !selectionRange.START_TO_END) {
      closeTextFormatter();
      return false;
    }
    return true;
  }
  function processSelection() {
    if (!checkSelection()) {
      return;
    }
    if (isTextFormatterDisabled) {
      return;
    }
    const selectionRange = window.getSelection().getRangeAt(0);
    const selectionRect = selectionRange.getBoundingClientRect();
    const scrollerRect = inputRef.current.closest(`.${SCROLLER_CLASS}`).getBoundingClientRect();
    let x = selectionRect.left + selectionRect.width / 2 - scrollerRect.left;
    if (x < TEXT_FORMATTER_SAFE_AREA_PX) {
      x = TEXT_FORMATTER_SAFE_AREA_PX;
    } else if (x > scrollerRect.width - TEXT_FORMATTER_SAFE_AREA_PX) {
      x = scrollerRect.width - TEXT_FORMATTER_SAFE_AREA_PX;
    }
    setTextFormatterAnchorPosition({
      x,
      y: selectionRect.top - scrollerRect.top
    });
    setSelectedRange(selectionRange);
    openTextFormatter();
  }
  function processSelectionWithTimeout() {
    if (selectionTimeoutRef.current) {
      window.clearTimeout(selectionTimeoutRef.current);
    }
    // Small delay to allow browser properly recalculate selection
    selectionTimeoutRef.current = window.setTimeout(processSelection, SELECTION_RECALCULATE_DELAY_MS);
  }
  function handleMouseDown(e) {
    if (e.button !== 2) {
      const listenerEl = e.currentTarget.closest(`.${INPUT_WRAPPER_CLASS}`) || e.target;
      listenerEl.addEventListener('mouseup', processSelectionWithTimeout, {
        once: true
      });
      return;
    }
    if (isContextMenuOpenRef.current) {
      return;
    }
    isContextMenuOpenRef.current = true;
    function handleCloseContextMenu(e2) {
      if (e2 instanceof KeyboardEvent && e2.key !== 'Esc' && e2.key !== 'Escape') {
        return;
      }
      setTimeout(() => {
        isContextMenuOpenRef.current = false;
      }, CONTEXT_MENU_CLOSE_DELAY_MS);
      window.removeEventListener('keydown', handleCloseContextMenu);
      window.removeEventListener('mousedown', handleCloseContextMenu);
    }
    document.addEventListener('mousedown', handleCloseContextMenu);
    document.addEventListener('keydown', handleCloseContextMenu);
  }
  function handleKeyDown(e) {
    // https://levelup.gitconnected.com/javascript-events-handlers-keyboard-and-load-events-1b3e46a6b0c3#1960
    const {
      isComposing
    } = e;
    const html = getHtml();
    if (!isComposing && !html && (e.metaKey || e.ctrlKey)) {
      const targetIndexDelta = e.key === 'ArrowDown' ? 1 : e.key === 'ArrowUp' ? -1 : undefined;
      if (targetIndexDelta) {
        e.preventDefault();
        replyToNextMessage({
          targetIndexDelta
        });
        return;
      }
    }
    if (!isComposing && e.key === 'Enter' && !e.shiftKey) {
      if (!isMobileDevice && (messageSendKeyCombo === 'enter' && !e.shiftKey || messageSendKeyCombo === 'ctrl-enter' && (e.ctrlKey || e.metaKey))) {
        e.preventDefault();
        closeTextFormatter();
        if (inputTranslateOptions?.autoTranslate) {
          (0,_chatAssistant_hook_useEventBusTeact__WEBPACK_IMPORTED_MODULE_13__.emitEventTeact)('actions:sendMessage');
          return;
        }
        onSend();
      }
    } else if (!isComposing && e.key === 'ArrowUp' && !html && !e.metaKey && !e.ctrlKey && !e.altKey) {
      e.preventDefault();
      editLastMessage();
    } else {
      e.target.addEventListener('keyup', processSelectionWithTimeout, {
        once: true
      });
    }
  }
  function handleChange(e) {
    const {
      innerHTML,
      textContent
    } = e.currentTarget;
    onUpdate(innerHTML === SAFARI_BR ? '' : innerHTML);
    // Reset focus on the input to remove any active styling when input is cleared
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV && (!textContent || !textContent.length)
    // When emojis are not supported, innerHTML contains an emoji img tag that doesn't exist in the textContext
    && !(!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_EMOJI_SUPPORTED && innerHTML.includes('emoji-small')) && !innerHTML.includes('custom-emoji')) {
      const selection = window.getSelection();
      if (selection) {
        inputRef.current.blur();
        selection.removeAllRanges();
        (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_11__["default"])(inputRef.current, true);
      }
    }
  }
  function handleAndroidContextMenu(e) {
    if (!checkSelection()) {
      return;
    }
    setIsTextFormatterDisabled(!isTextFormatterDisabled);
    if (!isTextFormatterDisabled) {
      e.preventDefault();
      e.stopPropagation();
      processSelection();
    } else {
      closeTextFormatter();
    }
  }
  function handleClick() {
    if (isAttachmentModalInput || canSendPlainText || isStoryInput && isNeedPremium) return;
    showAllowedMessageTypesNotification({
      chatId,
      messageListType
    });
  }
  const handleOpenPremiumModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_19__["default"])(() => openPremiumModal());
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_TOUCH_ENV) {
      return;
    }
    if (canAutoFocus) {
      focusInput();
    }
  }, [chatId, focusInput, replyInfo, canAutoFocus]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!chatId || editableInputId !== _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_ID || noFocusInterception || isMobileDevice || isSelectModeActive) {
      return undefined;
    }
    const handleDocumentKeyDown = e => {
      if ((0,_util_directInputManager__WEBPACK_IMPORTED_MODULE_9__.getIsDirectTextInputDisabled)()) {
        return;
      }
      const {
        key
      } = e;
      const target = e.target;
      if (!target || IGNORE_KEYS.includes(key)) {
        return;
      }
      const input = inputRef.current;
      const isSelectionCollapsed = document.getSelection()?.isCollapsed;
      if ((key.startsWith('Arrow') || e.shiftKey && key === 'Shift') && !isSelectionCollapsed || e.code === 'KeyC' && (e.ctrlKey || e.metaKey) && target.tagName !== 'INPUT') {
        return;
      }
      if (input && target !== input && target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && !target.isContentEditable) {
        (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_11__["default"])(input, true, true);
        const newEvent = new KeyboardEvent(e.type, e);
        input.dispatchEvent(newEvent);
      }
    };
    document.addEventListener('keydown', handleDocumentKeyDown, true);
    return () => {
      document.removeEventListener('keydown', handleDocumentKeyDown, true);
    };
  }, [chatId, editableInputId, isMobileDevice, isSelectModeActive, noFocusInterception]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const captureFirstTab = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_12__.debounce)(e => {
      if (e.key === 'Tab' && !(0,_util_directInputManager__WEBPACK_IMPORTED_MODULE_9__.getIsDirectTextInputDisabled)()) {
        e.preventDefault();
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMutation)(focusInput);
      }
    }, TAB_INDEX_PRIORITY_TIMEOUT, true, false);
    return (0,_util_captureKeyboardListeners__WEBPACK_IMPORTED_MODULE_8__["default"])({
      onTab: captureFirstTab
    });
  }, [focusInput]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const input = inputRef.current;
    function suppressFocus() {
      input.blur();
    }
    if (shouldSuppressFocus) {
      input.addEventListener('focus', suppressFocus);
    }
    return () => {
      input.removeEventListener('focus', suppressFocus);
    };
  }, [shouldSuppressFocus]);
  const isTouched = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_17__["default"])(() => Boolean(isActive && getHtml()), [isActive, getHtml]);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('form-control allow-selection', isTouched && 'touched', shouldSuppressFocus && 'focus-disabled');
  const inputScrollerContentClass = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('input-scroller-content', isNeedPremium && 'is-need-premium');
  const placeholderAriaLabel = typeof placeholder === 'string' ? placeholder : undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: id,
    onClick: shouldSuppressFocus ? onSuppressedFocus : undefined,
    dir: oldLang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('custom-scroll', SCROLLER_CLASS, isNeedPremium && 'is-need-premium'),
    onScroll: onScroll,
    onClick: !isAttachmentModalInput && !canSendPlainText ? handleClick : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: inputScrollerContentClass
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_component_input_grammar_InputGrammarWrapper__WEBPACK_IMPORTED_MODULE_22__["default"], {
    inputRef: inputRef,
    getHtml: getHtml,
    setHtml: onUpdate
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: inputRef,
    id: editableInputId || _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_ID,
    className: className,
    contentEditable: isAttachmentModalInput || canSendPlainText,
    role: "textbox",
    dir: "auto",
    tabIndex: 0,
    onClick: focusInput,
    onChange: handleChange,
    onKeyDown: handleKeyDown,
    onMouseDown: handleMouseDown,
    onContextMenu: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_ANDROID ? handleAndroidContextMenu : undefined,
    onTouchCancel: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_6__.IS_ANDROID ? processSelectionWithTimeout : undefined,
    "aria-label": placeholderAriaLabel,
    onFocus: !isNeedPremium ? onFocus : undefined,
    onBlur: !isNeedPremium ? onBlur : undefined
  }), !forcedPlaceholder && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('placeholder-text', !isAttachmentModalInput && !canSendPlainText && 'with-icon', isNeedPremium && 'is-need-premium'),
    dir: "auto"
  }, !isAttachmentModalInput && !canSendPlainText && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_23__["default"], {
    name: "lock-badge",
    className: "placeholder-icon"
  }), shouldDisplayTimer ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_TextTimer__WEBPACK_IMPORTED_MODULE_25__["default"], {
    langKey: timedPlaceholderLangKey,
    endsAt: timedPlaceholderDate,
    onEnd: handleTimerEnd
  }) : placeholder, isStoryInput && isNeedPremium && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_24__["default"], {
    className: "unlock-button",
    size: "tiny",
    color: "adaptive",
    onClick: handleOpenPremiumModal
  }, oldLang('StoryRepliesLockedButton'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: sharedCanvasRef,
    className: "shared-canvas"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: sharedCanvasHqRef,
    className: "shared-canvas"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: absoluteContainerRef,
    className: "absolute-video-container"
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: scrollerCloneRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])('custom-scroll', SCROLLER_CLASS, 'clone', isNeedPremium && 'is-need-premium')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: inputScrollerContentClass
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: cloneRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_7__["default"])(className, 'clone'),
    dir: "auto"
  }))), captionLimit !== undefined && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "max-length-indicator",
    dir: "auto"
  }, captionLimit), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TextFormatter_async__WEBPACK_IMPORTED_MODULE_26__["default"], {
    isOpen: isTextFormatterOpen,
    anchorPosition: textFormatterAnchorPosition,
    selectedRange: selectedRange,
    setSelectedRange: setSelectedRange,
    onClose: handleCloseTextFormatter
  }), forcedPlaceholder && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "forced-placeholder"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_14__["default"])(forcedPlaceholder)));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId
}) => {
  const {
    messageSendKeyCombo
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_5__.selectSharedSettings)(global);
  const inputTranslateOptions = global.roomInputTranslateOptions[chatId];
  return {
    messageSendKeyCombo,
    replyInfo: chatId && threadId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectDraft)(global, chatId, threadId)?.replyInfo : undefined,
    isSelectModeActive: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsInSelectMode)(global),
    canPlayAnimatedEmojis: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanPlayAnimatedEmojis)(global),
    inputTranslateOptions
  };
})(MessageInput)));

/***/ },

/***/ "./src/components/middle/composer/PollModal.async.tsx"
/*!************************************************************!*\
  !*** ./src/components/middle/composer/PollModal.async.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const PollModalAsync = props => {
  const {
    isOpen
  } = props;
  const PollModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'PollModal', !isOpen);
  return PollModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PollModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PollModalAsync);

/***/ },

/***/ "./src/components/middle/composer/SendAsMenu.async.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/composer/SendAsMenu.async.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SendAsMenuAsync = props => {
  const {
    isOpen
  } = props;
  const SendAsMenu = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SendAsMenu', !isOpen);
  return SendAsMenu ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SendAsMenu, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SendAsMenuAsync);

/***/ },

/***/ "./src/components/middle/composer/StickerTooltip.async.tsx"
/*!*****************************************************************!*\
  !*** ./src/components/middle/composer/StickerTooltip.async.tsx ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const StickerTooltipAsync = props => {
  const {
    isOpen
  } = props;
  const StickerTooltip = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'StickerTooltip', !isOpen);
  return StickerTooltip ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(StickerTooltip, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (StickerTooltipAsync);

/***/ },

/***/ "./src/components/middle/composer/SymbolMenu.async.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/composer/SymbolMenu.async.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const SymbolMenuAsync = props => {
  const {
    isOpen
  } = props;
  const SymbolMenu = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'SymbolMenu', !isOpen);
  return SymbolMenu ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(SymbolMenu, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SymbolMenuAsync);

/***/ },

/***/ "./src/components/middle/composer/SymbolMenuButton.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/composer/SymbolMenuButton.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/ResponsiveHoverButton */ "./src/components/ui/ResponsiveHoverButton.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _SymbolMenu_async__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./SymbolMenu.async */ "./src/components/middle/composer/SymbolMenu.async.tsx");












const MOBILE_KEYBOARD_HIDE_DELAY_MS = 100;
const SymbolMenuButton = ({
  chatId,
  threadId,
  isMobile,
  canSendGifs,
  canSendStickers,
  isMessageComposer,
  isReady,
  isSymbolMenuOpen,
  idPrefix,
  isAttachmentModal,
  canSendPlainText,
  isSymbolMenuForced,
  className,
  forceDarkTheme,
  inputCssSelector = _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_CSS_SELECTOR,
  openSymbolMenu,
  closeSymbolMenu,
  onCustomEmojiSelect,
  onStickerSelect,
  onGifSelect,
  onRemoveSymbol,
  onEmojiSelect,
  closeBotCommandMenu,
  closeSendAsMenu
}) => {
  const {
    setStickerSearchQuery,
    setGifSearchQuery,
    addRecentEmoji,
    addRecentCustomEmoji
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const triggerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [isSymbolMenuLoaded, onSymbolMenuLoadingComplete] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const [contextMenuAnchor, setContextMenuAnchor] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const symbolMenuButtonClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('composer-action-button mobile-symbol-menu-button', !isReady && 'not-ready', isSymbolMenuLoaded ? isSymbolMenuOpen && 'menu-opened' : isSymbolMenuOpen && 'is-loading');
  const handleActivateSymbolMenu = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    closeBotCommandMenu?.();
    closeSendAsMenu?.();
    openSymbolMenu();
    const triggerEl = triggerRef.current;
    if (!triggerEl) return;
    const {
      x,
      y
    } = triggerEl.getBoundingClientRect();
    setContextMenuAnchor({
      x,
      y
    });
  });
  const handleSearchOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(type => {
    if (type === 'stickers') {
      setStickerSearchQuery({
        query: ''
      });
      setGifSearchQuery({
        query: undefined
      });
    } else {
      setGifSearchQuery({
        query: ''
      });
      setStickerSearchQuery({
        query: undefined
      });
    }
  });
  const handleSymbolMenuOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    const messageInput = document.querySelector(isAttachmentModal ? _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_MODAL_CSS_SELECTOR : inputCssSelector);
    if (!isMobile || messageInput !== document.activeElement) {
      openSymbolMenu();
      return;
    }
    messageInput?.blur();
    setTimeout(() => {
      closeBotCommandMenu?.();
      openSymbolMenu();
    }, MOBILE_KEYBOARD_HIDE_DELAY_MS);
  });
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => triggerRef.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => triggerRef.current?.closest('.custom-scroll, .no-scrollbar'));
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => document.querySelector('#portals .SymbolMenu .bubble'));
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => ({
    withPortal: true
  }));
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, isMobile ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
    className: symbolMenuButtonClassName,
    round: true,
    color: "translucent",
    onClick: isSymbolMenuOpen ? closeSymbolMenu : handleSymbolMenuOpen,
    ariaLabel: "Choose emoji, sticker or GIF"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: "smile"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: "keyboard"
  }), isSymbolMenuOpen && !isSymbolMenuLoaded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_9__["default"], {
    color: "gray"
  })) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ResponsiveHoverButton__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('composer-action-button symbol-menu-button', isSymbolMenuOpen && 'activated'),
    round: true,
    color: "translucent",
    onActivate: handleActivateSymbolMenu,
    ariaLabel: "Choose emoji, sticker or GIF"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: triggerRef,
    className: "symbol-menu-trigger"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: "smile"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SymbolMenu_async__WEBPACK_IMPORTED_MODULE_10__["default"], {
    chatId: chatId,
    threadId: threadId,
    isOpen: isSymbolMenuOpen || Boolean(isSymbolMenuForced),
    canSendGifs: canSendGifs,
    canSendStickers: canSendStickers,
    isMessageComposer: isMessageComposer,
    idPrefix: idPrefix,
    onLoad: onSymbolMenuLoadingComplete,
    onClose: closeSymbolMenu,
    onEmojiSelect: onEmojiSelect,
    onStickerSelect: onStickerSelect,
    onCustomEmojiSelect: onCustomEmojiSelect,
    onGifSelect: onGifSelect,
    onRemoveSymbol: onRemoveSymbol,
    onSearchOpen: handleSearchOpen,
    addRecentEmoji: addRecentEmoji,
    addRecentCustomEmoji: addRecentCustomEmoji,
    isAttachmentModal: isAttachmentModal,
    canSendPlainText: canSendPlainText,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(className, forceDarkTheme && 'component-theme-dark'),
    anchor: isAttachmentModal ? contextMenuAnchor : undefined,
    getTriggerElement: isAttachmentModal ? getTriggerElement : undefined,
    getRootElement: isAttachmentModal ? getRootElement : undefined,
    getMenuElement: isAttachmentModal ? getMenuElement : undefined,
    getLayout: isAttachmentModal ? getLayout : undefined
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(SymbolMenuButton));

/***/ },

/***/ "./src/components/middle/composer/TextFormatter.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/middle/composer/TextFormatter.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const TextFormatterAsync = props => {
  const {
    isOpen
  } = props;
  const TextFormatter = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'TextFormatter', !isOpen);
  return TextFormatter ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(TextFormatter, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (TextFormatterAsync);

/***/ },

/***/ "./src/components/middle/composer/ToDoListModal.async.tsx"
/*!****************************************************************!*\
  !*** ./src/components/middle/composer/ToDoListModal.async.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ToDoListModalAsync = props => {
  const {
    modal
  } = props;
  const ToDoListModal = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ToDoListModal', !modal);
  return ToDoListModal ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ToDoListModal, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ToDoListModalAsync);

/***/ },

/***/ "./src/components/middle/composer/WebPagePreview.module.scss"
/*!*******************************************************************!*\
  !*** ./src/components/middle/composer/WebPagePreview.module.scss ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"O3di3ULC","no-page-transitions":"UDdgVrUQ","noPageTransitions":"UDdgVrUQ","select-mode-active":"Y5TInySi","selectModeActive":"Y5TInySi","middle-column-footer":"XlGyc4tC","middleColumnFooter":"XlGyc4tC","no-message-composer-animations":"eDMArdYq","noMessageComposerAnimations":"eDMArdYq","ComposerEmbeddedMessage":"z4RvByc2","composerEmbeddedMessage":"z4RvByc2","inner":"m3DBx9f5","contextMenu":"zqTOc7LU","clear":"yhxytYkd","left-icon":"vFWsMwfP","leftIcon":"vFWsMwfP","preview":"otSxF62k","previewText":"itmZe2qi","previewImageContainer":"VvwZOug9","previewImage":"b0A9Zfoa","siteName":"ER149gdz","siteDescription":"FSYSqC60","interactive":"G5_7x_Hn"});

/***/ },

/***/ "./src/components/middle/composer/WebPagePreview.tsx"
/*!***********************************************************!*\
  !*** ./src/components/middle/composer/WebPagePreview.tsx ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./WebPagePreview.module.scss */ "./src/components/middle/composer/WebPagePreview.module.scss");



















const WebPagePreview = ({
  chatId,
  threadId,
  isDisabled,
  webPagePreview,
  noWebPage,
  attachmentSettings,
  isEditing
}) => {
  const {
    toggleMessageWebPage,
    updateAttachmentSettings
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isInvertedMedia = attachmentSettings.isInvertedMedia;
  const isSmallerMedia = attachmentSettings.webPageMediaSize === 'small';
  const isShown = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    return Boolean(webPagePreview && !noWebPage && !isDisabled);
  }, [isDisabled, noWebPage, webPagePreview]);
  const {
    shouldRender
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_11__["default"])({
    isOpen: isShown,
    ref,
    withShouldRender: true
  });
  const hasMediaSizeOptions = webPagePreview?.webpageType === 'full' && webPagePreview.hasLargeMedia;
  const prevWebPageRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(webPagePreview);
  if (webPagePreview && webPagePreview !== prevWebPageRef.current) {
    prevWebPageRef.current = webPagePreview;
  }
  const renderingWebPage = webPagePreview || prevWebPageRef.current;
  const isFullWebPage = renderingWebPage?.webpageType === 'full';
  const thumbnailUrl = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_5__["default"])(isFullWebPage ? {
    content: renderingWebPage
  } : undefined);
  const previewMedia = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getWebPagePhoto)(renderingWebPage) || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getWebPageVideo)(renderingWebPage) || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getWebPageAudio)(renderingWebPage) || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getWebPageDocument)(renderingWebPage);
  const previewMediaHash = previewMedia && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMediaHash)(previewMedia, 'pictogram');
  const previewMediaUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__["default"])(previewMediaHash);
  const {
    shouldRender: shouldRenderPreviewMedia,
    ref: previewMediaRef
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_11__["default"])({
    isOpen: Boolean(previewMediaUrl),
    withShouldRender: true,
    noCloseTransition: true
  });
  const hasPreviewMedia = Boolean(previewMediaUrl || shouldRenderPreviewMedia);
  const handleClearWebpagePreview = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    toggleMessageWebPage({
      chatId,
      threadId,
      noWebPage: true
    });
  });
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide,
    handleBeforeContextMenu
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_6__["default"])(ref, isEditing, true);
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => ref.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => ref.current);
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => ref.current.querySelector(`.${_WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].contextMenu} .bubble`));
  const handlePreviewClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    handleContextMenu(e);
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!shouldRender || !renderingWebPage) {
      handleContextMenuClose();
      handleContextMenuHide();
    }
  }, [handleContextMenuClose, handleContextMenuHide, shouldRender, renderingWebPage]);
  function updateIsInvertedMedia(value) {
    updateAttachmentSettings({
      isInvertedMedia: value
    });
  }
  function updateIsLargerMedia(value) {
    updateAttachmentSettings({
      webPageMediaSize: value
    });
  }
  if (!shouldRender || !renderingWebPage) {
    return undefined;
  }
  function renderContextMenu() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_15__["default"], {
      isOpen: isContextMenuOpen,
      anchor: contextMenuAnchor,
      getTriggerElement: getTriggerElement,
      getRootElement: getRootElement,
      getMenuElement: getMenuElement,
      className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].contextMenu,
      onClose: handleContextMenuClose,
      onCloseAnimationEnd: handleContextMenuHide,
      autoClose: true
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, isInvertedMedia ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
      icon: "move-caption-up",
      onClick: () => updateIsInvertedMedia(undefined)
    }, lang('ContextMoveTextUp')) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
      icon: "move-caption-down",
      onClick: () => updateIsInvertedMedia(true)
    }, lang('ContextMoveTextDown')), hasMediaSizeOptions && (isSmallerMedia ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
      icon: "expand",
      onClick: () => updateIsLargerMedia('large')
    }, lang('ContextLinkLargerMedia')) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
      icon: "collapse",
      onClick: () => updateIsLargerMedia('small')
    }, lang('ContextLinkSmallerMedia'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
      icon: "delete",
      onClick: handleClearWebpagePreview
    }, lang('ContextLinkRemovePreview'))));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].root, !isEditing && _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].interactive),
    ref: ref
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].inner
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].leftIcon,
    onClick: handlePreviewClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "link"
  })), renderingWebPage && renderingWebPage.webpageType !== 'empty' && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_13__["default"], {
    noUserColors: true,
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].preview,
    onContextMenu: handleContextMenu,
    onMouseDown: handleBeforeContextMenu,
    onClick: handlePreviewClick
  }, hasPreviewMedia && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].previewImageContainer
  }, thumbnailUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: thumbnailUrl,
    alt: "",
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].previewImage
  }), shouldRenderPreviewMedia && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    ref: previewMediaRef,
    src: previewMediaUrl,
    alt: "",
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].previewImage
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].previewText
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].siteName
  }, isFullWebPage ? renderingWebPage.siteName || renderingWebPage.url : lang('Loading')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].siteDescription
  }, isFullWebPage ? renderingWebPage.description || lang(getMediaTypeKey(renderingWebPage)) : renderingWebPage.url))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
    className: _WebPagePreview_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].clear,
    round: true,
    faded: true,
    color: "translucent",
    ariaLabel: lang('AccLinkRemovePreview'),
    onClick: handleClearWebpagePreview
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "close"
  })), !isEditing && renderContextMenu()));
};
function getMediaTypeKey(webPage) {
  if (webPage.photo) return 'AttachPhoto';
  if (webPage.video) return 'AttachVideo';
  if (webPage.audio) return 'AttachMusic';
  if (webPage.document) return 'AttachDocument';
  if (webPage.story) return 'AttachStory';
  return 'LinkPreview';
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  chatId,
  threadId
}) => {
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const noWebPage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectNoWebPage)(global, chatId, threadId);
  const {
    attachmentSettings
  } = global;
  const webPagePreview = tabState.webPagePreviewId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectWebPage)(global, tabState.webPagePreviewId) : undefined;
  return {
    webPagePreview: webPagePreview?.webpageType === 'empty' ? undefined : webPagePreview,
    noWebPage,
    attachmentSettings
  };
})(WebPagePreview)));

/***/ },

/***/ "./src/components/middle/composer/helpers/applyIosAutoCapitalizationFix.ts"
/*!*********************************************************************************!*\
  !*** ./src/components/middle/composer/helpers/applyIosAutoCapitalizationFix.ts ***!
  \*********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ applyIosAutoCapitalizationFix)
/* harmony export */ });
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");

let resetInput;
if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_IOS) {
  resetInput = document.createElement('input');
  resetInput.classList.add('for-ios-autocapitalization-fix');
  document.body.appendChild(resetInput);
}

// https://stackoverflow.com/a/55652503
function applyIosAutoCapitalizationFix(inputEl) {
  resetInput.focus();
  inputEl.focus();
}

/***/ },

/***/ "./src/components/middle/composer/helpers/cleanHtml.ts"
/*!*************************************************************!*\
  !*** ./src/components/middle/composer/helpers/cleanHtml.ts ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   escapeHtml: () => (/* binding */ escapeHtml),
/* harmony export */   preparePastedHtml: () => (/* binding */ preparePastedHtml)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _lib_cleanDocsHtml__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../lib/cleanDocsHtml */ "./src/lib/cleanDocsHtml.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");




const STYLE_TAG_REGEX = /<style>(.*?)<\/style>/gs;
function preparePastedHtml(html) {
  let fragment = document.createElement('div');
  try {
    html = (0,_lib_cleanDocsHtml__WEBPACK_IMPORTED_MODULE_2__["default"])(html);
  } catch (err) {
    if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG) {
      // eslint-disable-next-line no-console
      console.error(err);
    }
  }
  fragment.innerHTML = html.replace(/\u00a0/g, ' ').replace(STYLE_TAG_REGEX, ''); // Strip &nbsp and styles

  const textContents = fragment.querySelectorAll('.text-content');
  if (textContents.length) {
    fragment = textContents[textContents.length - 1]; // Replace with the last copied message
  }
  Array.from(fragment.getElementsByTagName('*')).forEach(node => {
    if (!(node instanceof HTMLElement)) {
      node.remove();
      return;
    }
    node.removeAttribute('style');

    // Fix newlines
    if (node.tagName === 'BR') node.replaceWith('\n');
    if (node.tagName === 'P') node.appendChild(document.createTextNode('\n'));
    if (node.tagName === 'IMG' && !node.dataset.entityType) node.replaceWith(node.getAttribute('alt') || '');
    // We do not intercept copy logic, so we remove some nodes here
    if (node.dataset.ignoreOnPaste) node.remove();
    if (_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_3__.ENTITY_CLASS_BY_NODE_NAME[node.tagName]) {
      node.setAttribute('data-entity-type', _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_3__.ENTITY_CLASS_BY_NODE_NAME[node.tagName]);
    }
    // Strip non-entity tags
    if (!node.dataset.entityType && node.textContent === node.innerText) node.replaceWith(node.textContent);
    // Append entity parameters for parsing
    if (node.dataset.alt) node.setAttribute('alt', node.dataset.alt);
    switch (node.dataset.entityType) {
      case _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMessageEntityTypes.MentionName:
        node.replaceWith(node.textContent || '');
        break;
      case _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMessageEntityTypes.CustomEmoji:
        node.textContent = node.dataset.alt || '';
        break;
    }
  });
  return fragment.innerHTML.trimEnd();
}
function escapeHtml(html) {
  const fragment = document.createElement('div');
  const text = document.createTextNode(html);
  fragment.appendChild(text);
  return fragment.innerHTML;
}

/***/ },

/***/ "./src/components/middle/composer/helpers/getFilesFromDataTransferItems.ts"
/*!*********************************************************************************!*\
  !*** ./src/components/middle/composer/helpers/getFilesFromDataTransferItems.ts ***!
  \*********************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ getFilesFromDataTransferItems)
/* harmony export */ });
/* harmony import */ var _util_files__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/files */ "./src/util/files.ts");

async function getFilesFromDataTransferItems(dataTransferItems) {
  const files = [];
  function traverseFileTreePromise(entry, item) {
    return new Promise(resolve => {
      if (entry instanceof File) {
        files.push(entry);
        resolve(entry);
      } else if (entry.isFile) {
        const itemFile = item.getAsFile();
        entry.file(file => {
          files.push(file);
          resolve(file);
        }, () => {
          // iOS Safari throws an error "NotFoundError: Path does not exist" for files from the clipboard
          // https://stackoverflow.com/a/50059309
          if (itemFile) {
            files.push(itemFile);
          }
          resolve(itemFile);
        });
      } else if (entry.isDirectory) {
        const dirReader = entry.createReader();
        dirReader.readEntries(entries => {
          const entriesPromises = [];
          for (let i = 0; i < entries.length; i++) {
            entriesPromises.push(traverseFileTreePromise(entries[i], item));
          }
          resolve(Promise.all(entriesPromises));
        });
      }
    });
  }
  const entriesPromises = [];
  for (let i = 0; i < dataTransferItems.length; i++) {
    const item = dataTransferItems[i];
    if (item.kind === 'file') {
      const entry = item.webkitGetAsEntry() || item.getAsFile();
      if (entry) {
        entriesPromises.push(traverseFileTreePromise(entry, item));
      }
    }
  }
  await Promise.all(entriesPromises);
  return (0,_util_files__WEBPACK_IMPORTED_MODULE_0__.validateFiles)(files);
}

/***/ },

/***/ "./src/components/middle/composer/helpers/prepareForRegExp.ts"
/*!********************************************************************!*\
  !*** ./src/components/middle/composer/helpers/prepareForRegExp.ts ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   prepareForRegExp: () => (/* binding */ prepareForRegExp)
/* harmony export */ });
const RE_BR = /(<br>|<br\s?\/>)/g;
const RE_SPACE = /(&nbsp;|\u00A0)/g;
const RE_CLEAN_HTML = /(<div>|<\/div>)/gi;
const RE_EXTRA_NEW_LINE = /\n$/i;
function prepareForRegExp(html) {
  return html.replace(RE_SPACE, ' ').replace(RE_BR, '\n').replace(RE_CLEAN_HTML, '').replace(RE_EXTRA_NEW_LINE, '');
}

/***/ },

/***/ "./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx"
/*!*****************************************************************************!*\
  !*** ./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx ***!
  \*****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ renderKeyboardButtonText)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _util_replaceWithTeact__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/replaceWithTeact */ "./src/util/replaceWithTeact.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");





function renderKeyboardButtonText(lang, button) {
  if (button.type === 'receipt') {
    return lang('PaymentReceipt');
  }
  if (button.type === 'buy') {
    return (0,_util_replaceWithTeact__WEBPACK_IMPORTED_MODULE_2__.replaceWithTeact)(button.text, _config__WEBPACK_IMPORTED_MODULE_1__.STARS_ICON_PLACEHOLDER, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
      className: "star-currency-icon",
      name: "star"
    }));
  }
  return (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_3__["default"])(button.text);
}

/***/ },

/***/ "./src/components/middle/composer/helpers/selection.ts"
/*!*************************************************************!*\
  !*** ./src/components/middle/composer/helpers/selection.ts ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   isSelectionInsideInput: () => (/* binding */ isSelectionInsideInput)
/* harmony export */ });
const MAX_NESTING_PARENTS = 5;
function isSelectionInsideInput(selectionRange, inputId) {
  const {
    commonAncestorContainer
  } = selectionRange;
  let parentNode = commonAncestorContainer;
  let iterations = 1;
  while (parentNode && parentNode.id !== inputId && iterations < MAX_NESTING_PARENTS) {
    parentNode = parentNode.parentElement;
    iterations++;
  }
  return Boolean(parentNode && parentNode.id === inputId);
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useAttachmentModal.ts"
/*!********************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useAttachmentModal.ts ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useAttachmentModal)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../helpers/buildAttachment */ "./src/components/middle/composer/helpers/buildAttachment.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");







function useAttachmentModal({
  attachments,
  fileSizeLimit,
  setHtml,
  setAttachments,
  chatId,
  canSendAudios,
  canSendVideos,
  canSendPhotos,
  canSendDocuments,
  insertNextText,
  editedMessage,
  shouldSendInHighQuality
}) {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const {
    openLimitReachedModal,
    showAllowedMessageTypesNotification,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [shouldForceAsFile, setShouldForceAsFile] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [shouldForceCompression, setShouldForceCompression] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const handleClearAttachments = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    setAttachments(_util_memo__WEBPACK_IMPORTED_MODULE_3__.MEMO_EMPTY_ARRAY);
    insertNextText();
  });
  const handleSetAttachments = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(newValue => {
    const newAttachments = typeof newValue === 'function' ? newValue(attachments) : newValue;
    if (!newAttachments.length) {
      handleClearAttachments();
      return;
    }
    if (newAttachments.some(attachment => {
      const type = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getAttachmentMediaType)(attachment);
      return type === 'audio' && !canSendAudios && !canSendDocuments || type === 'video' && !canSendVideos && !canSendDocuments || type === 'photo' && !canSendPhotos && !canSendDocuments || type === 'file' && !canSendDocuments;
    })) {
      showAllowedMessageTypesNotification({
        chatId
      });
    } else if (newAttachments.some(({
      size
    }) => size > fileSizeLimit)) {
      openLimitReachedModal({
        limit: 'uploadMaxFileparts'
      });
    } else {
      setAttachments(newAttachments);
      const shouldForce = newAttachments.some(attachment => {
        const type = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getAttachmentMediaType)(attachment);
        return type === 'audio' && !canSendAudios || type === 'video' && !canSendVideos || type === 'photo' && !canSendPhotos;
      });
      setShouldForceAsFile(Boolean(shouldForce && canSendDocuments));
      setShouldForceCompression(!canSendDocuments);
    }
  });
  const handleAppendFiles = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(async (files, isSpoiler) => {
    if (editedMessage) {
      const newAttachment = await (0,_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_4__["default"])(files[0].name, files[0]);
      const canReplace = editedMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.canReplaceMessageMedia)(editedMessage, newAttachment);
      if (editedMessage?.groupedId) {
        if (canReplace) {
          handleSetAttachments([newAttachment]);
        } else {
          showNotification({
            message: lang('MediaReplaceInvalidError', undefined, {
              pluralValue: files.length
            })
          });
        }
      } else {
        handleSetAttachments([newAttachment]);
      }
    } else {
      const newAttachments = await Promise.all(files.map(file => (0,_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_4__["default"])(file.name, file, {
        shouldSendAsSpoiler: isSpoiler || undefined,
        shouldSendInHighQuality
      })));
      handleSetAttachments([...attachments, ...newAttachments]);
    }
  });
  const handleFileSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(async files => {
    if (editedMessage) {
      const newAttachment = await (0,_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_4__["default"])(files[0].name, files[0]);
      const canReplace = editedMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.canReplaceMessageMedia)(editedMessage, newAttachment);
      if (editedMessage?.groupedId) {
        if (canReplace) {
          handleSetAttachments([newAttachment]);
        } else {
          showNotification({
            message: lang('MediaReplaceInvalidError', undefined, {
              pluralValue: files.length
            })
          });
        }
      } else {
        handleSetAttachments([newAttachment]);
      }
    } else {
      const newAttachments = await Promise.all(files.map(file => (0,_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_4__["default"])(file.name, file, {
        shouldSendInHighQuality
      })));
      handleSetAttachments(newAttachments);
    }
  });
  const handleUpdateAttachmentsQuality = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(async () => {
    const newAttachments = await Promise.all(attachments.map(attachment => (0,_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_4__["default"])(attachment.filename, attachment.blob, {
      shouldSendInHighQuality
    })));
    handleSetAttachments(newAttachments);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    handleUpdateAttachmentsQuality();
  }, [shouldSendInHighQuality]);
  return {
    handleAppendFiles,
    handleFileSelect,
    onCaptionUpdate: setHtml,
    handleClearAttachments,
    handleSetAttachments,
    shouldForceCompression,
    shouldForceAsFile
  };
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useChatCommandTooltip.ts"
/*!***********************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useChatCommandTooltip.ts ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useChatCommandTooltip)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _helpers_prepareForRegExp__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../helpers/prepareForRegExp */ "./src/components/middle/composer/helpers/prepareForRegExp.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");





const RE_COMMAND = /^\/([\w@]{1,32})?$/i;
const THROTTLE = 300;
function useChatCommandTooltip(isEnabled, getHtml, botCommands, chatBotCommands, quickReplies) {
  const [filteredBotCommands, setFilteredBotCommands] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [filteredQuickReplies, setFilteredQuickReplies] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_4__["default"])(false);
  const detectCommandThrottled = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_2__.useThrottledResolver)(() => {
    const html = getHtml();
    return isEnabled && html.startsWith('/') ? (0,_helpers_prepareForRegExp__WEBPACK_IMPORTED_MODULE_1__.prepareForRegExp)(html).match(RE_COMMAND)?.[0].trim() : undefined;
  }, [getHtml, isEnabled], THROTTLE);
  const getCommand = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_3__["default"])(detectCommandThrottled, [detectCommandThrottled, getHtml], true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const command = getCommand();
    const commands = botCommands || chatBotCommands;
    if (!command || !commands && !quickReplies) {
      setFilteredBotCommands(undefined);
      setFilteredQuickReplies(undefined);
      return;
    }
    const filter = command.substring(1);
    const nextFilteredBotCommands = commands?.filter(c => !filter || c.command.startsWith(filter));
    setFilteredBotCommands(nextFilteredBotCommands?.length ? nextFilteredBotCommands : undefined);
    const newFilteredQuickReplies = Object.values(quickReplies || {}).filter(quickReply => !filter || quickReply.shortcut.startsWith(filter));
    setFilteredQuickReplies(newFilteredQuickReplies?.length ? newFilteredQuickReplies : undefined);
  }, [getCommand, botCommands, chatBotCommands, quickReplies]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);
  return {
    isOpen: Boolean((filteredBotCommands?.length || filteredQuickReplies?.length) && !isManuallyClosed),
    close: markManuallyClosed,
    filteredBotCommands,
    filteredQuickReplies
  };
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useClipboardPaste.ts"
/*!*******************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useClipboardPaste.ts ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_symbols__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers/symbols */ "./src/global/helpers/symbols.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../helpers/buildAttachment */ "./src/components/middle/composer/helpers/buildAttachment.ts");
/* harmony import */ var _helpers_cleanHtml__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../helpers/cleanHtml */ "./src/components/middle/composer/helpers/cleanHtml.ts");
/* harmony import */ var _helpers_getFilesFromDataTransferItems__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../helpers/getFilesFromDataTransferItems */ "./src/components/middle/composer/helpers/getFilesFromDataTransferItems.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");










const TYPE_HTML = 'text/html';
const DOCUMENT_TYPE_WORD = 'urn:schemas-microsoft-com:office:word';
const NAMESPACE_PREFIX_WORD = 'xmlns:w';
const VALID_TARGET_IDS = new Set([_config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_ID, _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_MODAL_ID, _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_STORY_INPUT_ID]);
const CLOSEST_CONTENT_EDITABLE_SELECTOR = 'div[contenteditable]';
const useClipboardPaste = (isActive, insertTextAndUpdateCursor, setAttachments, setNextText, editedMessage, shouldStripCustomEmoji, onCustomEmojiStripped) => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isActive) {
      return undefined;
    }
    async function handlePaste(e) {
      if (!e.clipboardData) {
        return;
      }
      const input = e.target?.closest(CLOSEST_CONTENT_EDITABLE_SELECTOR);
      if (!input || !VALID_TARGET_IDS.has(input.id)) {
        return;
      }
      e.preventDefault();

      // Some extensions can trigger paste into their panels without focus
      if (document.activeElement !== input) {
        return;
      }
      const pastedText = e.clipboardData.getData('text');
      const html = e.clipboardData.getData('text/html');
      let pastedFormattedText = html ? (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_5__["default"])((0,_helpers_cleanHtml__WEBPACK_IMPORTED_MODULE_7__.preparePastedHtml)(html), undefined, true) : undefined;
      if (pastedFormattedText && (0,_global_helpers_symbols__WEBPACK_IMPORTED_MODULE_4__.containsCustomEmoji)(pastedFormattedText) && shouldStripCustomEmoji) {
        pastedFormattedText = (0,_global_helpers_symbols__WEBPACK_IMPORTED_MODULE_4__.stripCustomEmoji)(pastedFormattedText);
        onCustomEmojiStripped?.();
      }
      const {
        items
      } = e.clipboardData;
      let files = [];
      if (items.length > 0) {
        files = await (0,_helpers_getFilesFromDataTransferItems__WEBPACK_IMPORTED_MODULE_8__["default"])(items);
        if (editedMessage) {
          files = files?.slice(0, 1);
        }
      }
      if (!files?.length && !pastedText) {
        return;
      }
      const textToPaste = pastedFormattedText?.entities?.length ? pastedFormattedText : {
        text: pastedText
      };
      let isWordDocument = false;
      try {
        const parser = new DOMParser();
        const parsedDocument = parser.parseFromString(html, TYPE_HTML);
        isWordDocument = parsedDocument.documentElement.getAttribute(NAMESPACE_PREFIX_WORD) === DOCUMENT_TYPE_WORD;
      } catch (err) {
        // Ignore
      }
      const hasText = textToPaste && textToPaste.text;
      let shouldSetAttachments = files?.length && !isWordDocument;
      const newAttachments = files ? await Promise.all(files.map(file => (0,_helpers_buildAttachment__WEBPACK_IMPORTED_MODULE_6__["default"])(file.name, file))) : [];
      const canReplace = editedMessage && newAttachments?.length && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.canReplaceMessageMedia)(editedMessage, newAttachments[0]) || Boolean(hasText);
      const isUploadingDocumentSticker = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUploadingFileSticker)(newAttachments[0]);
      const isInAlbum = editedMessage && editedMessage?.groupedId;
      if (editedMessage && newAttachments?.length > 1) {
        showNotification({
          message: lang('MediaReplaceInvalidError', undefined, {
            pluralValue: newAttachments.length
          })
        });
        return;
      }
      if (editedMessage && isUploadingDocumentSticker) {
        showNotification({
          message: lang('MediaReplaceInvalidError', undefined, {
            pluralValue: 1
          })
        });
        return;
      }
      if (isInAlbum) {
        shouldSetAttachments = canReplace;
        if (!shouldSetAttachments) {
          showNotification({
            message: lang('MediaReplaceInvalidError', undefined, {
              pluralValue: newAttachments.length
            })
          });
          return;
        }
      }
      if (shouldSetAttachments) {
        setAttachments(editedMessage ? newAttachments : attachments => attachments.concat(newAttachments));
      }
      if (hasText) {
        if (shouldSetAttachments) {
          setNextText(textToPaste);
        } else {
          insertTextAndUpdateCursor(textToPaste, input?.id);
        }
      }
    }
    document.addEventListener('paste', handlePaste, false);
    return () => {
      document.removeEventListener('paste', handlePaste, false);
    };
  }, [insertTextAndUpdateCursor, editedMessage, setAttachments, isActive, shouldStripCustomEmoji, onCustomEmojiStripped, setNextText, lang]);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useClipboardPaste);

/***/ },

/***/ "./src/components/middle/composer/hooks/useCustomEmojiTooltip.ts"
/*!***********************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useCustomEmojiTooltip.ts ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useCustomEmojiTooltip)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _lib_twemojiRegex__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../lib/twemojiRegex */ "./src/lib/twemojiRegex.js");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/focusEditableElement */ "./src/util/focusEditableElement.ts");
/* harmony import */ var _util_selection__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/selection */ "./src/util/selection.ts");
/* harmony import */ var _helpers_customEmoji__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../helpers/customEmoji */ "./src/components/middle/composer/helpers/customEmoji.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");














const THROTTLE = 300;
const RE_ENDS_ON_EMOJI = new RegExp(`(${_lib_twemojiRegex__WEBPACK_IMPORTED_MODULE_4__["default"].source})$`, 'g');
const RE_ENDS_ON_EMOJI_IMG = new RegExp(`${_config__WEBPACK_IMPORTED_MODULE_2__.EMOJI_IMG_REGEX.source}$`, 'g');
function useCustomEmojiTooltip(isEnabled, getHtml, setHtml, getSelectionRange, inputRef, customEmojis) {
  const {
    loadCustomEmojiForEmoji,
    clearCustomEmojiForEmoji
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__["default"])(false);
  const extractLastEmojiThrottled = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_9__.useThrottledResolver)(() => {
    const html = getHtml();
    if (!isEnabled || !html || !getSelectionRange()?.collapsed) return undefined;
    const hasEmoji = html.match(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_EMOJI_SUPPORTED ? _lib_twemojiRegex__WEBPACK_IMPORTED_MODULE_4__["default"] : _config__WEBPACK_IMPORTED_MODULE_2__.EMOJI_IMG_REGEX);
    if (!hasEmoji) return undefined;
    const htmlBeforeSelection = (0,_util_selection__WEBPACK_IMPORTED_MODULE_7__.getHtmlBeforeSelection)(inputRef.current);
    return htmlBeforeSelection.match(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_EMOJI_SUPPORTED ? RE_ENDS_ON_EMOJI : RE_ENDS_ON_EMOJI_IMG)?.[0];
  }, [getHtml, getSelectionRange, inputRef, isEnabled], THROTTLE);
  const getLastEmoji = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_10__["default"])(extractLastEmojiThrottled, [extractLastEmojiThrottled, getHtml, getSelectionRange], true);
  const isActive = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_11__["default"])(() => Boolean(getLastEmoji()), [getLastEmoji]);
  const hasCustomEmojis = Boolean(customEmojis?.length);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isEnabled || !isActive) return;
    const lastEmoji = getLastEmoji();
    if (lastEmoji) {
      if (!hasCustomEmojis) {
        const emoji = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_EMOJI_SUPPORTED ? lastEmoji : lastEmoji.match(/.+alt="(.+)"/)?.[1];
        if (emoji) {
          loadCustomEmojiForEmoji({
            emoji
          });
        }
      }
    } else {
      clearCustomEmojiForEmoji();
    }
  }, [isEnabled, isActive, getLastEmoji, hasCustomEmojis, clearCustomEmojiForEmoji, loadCustomEmojiForEmoji]);
  const insertCustomEmoji = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(emoji => {
    const lastEmoji = getLastEmoji();
    if (!isEnabled || !lastEmoji) return;
    const inputEl = inputRef.current;
    const htmlBeforeSelection = (0,_util_selection__WEBPACK_IMPORTED_MODULE_7__.getHtmlBeforeSelection)(inputEl);
    const regexText = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_EMOJI_SUPPORTED ? lastEmoji
    // Escape regexp special chars
    : lastEmoji.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&');
    const regex = new RegExp(`(${regexText})\\1*$`, '');
    const matched = htmlBeforeSelection.match(regex)[0];
    const count = matched.length / lastEmoji.length;
    const newHtml = htmlBeforeSelection.replace(regex, (0,_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_8__.buildCustomEmojiHtml)(emoji).repeat(count));
    const htmlAfterSelection = inputEl.innerHTML.substring(htmlBeforeSelection.length);
    setHtml(`${newHtml}${htmlAfterSelection}`);
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestNextMutation)(() => {
      (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__["default"])(inputEl, true, true);
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);
  return {
    isCustomEmojiTooltipOpen: Boolean(isActive && hasCustomEmojis && !isManuallyClosed),
    closeCustomEmojiTooltip: markManuallyClosed,
    insertCustomEmoji
  };
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useDraft.ts"
/*!**********************************************************!*\
  !*** ./src/components/middle/composer/hooks/useDraft.ts ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_focusEditableElement__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/focusEditableElement */ "./src/util/focusEditableElement.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useRunDebounced */ "./src/hooks/useRunDebounced.ts");
/* harmony import */ var _hooks_useStateRef__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/useStateRef */ "./src/hooks/useStateRef.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");
/* harmony import */ var _hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/window/useBeforeUnload */ "./src/hooks/window/useBeforeUnload.ts");














let isFrozen = false;
function freeze() {
  isFrozen = true;
  (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
    isFrozen = false;
  });
}
const useDraft = ({
  draft,
  chatId,
  threadId,
  getHtml,
  setHtml,
  editedMessage,
  isDisabled
}) => {
  const {
    saveDraft,
    clearDraft,
    loadCustomEmojis
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isTouchedRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const html = getHtml();
    const isLocalDraft = draft?.isLocal !== undefined;
    if ((0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_7__.getTextWithEntitiesAsHtml)(draft?.text) === html && !isLocalDraft) {
      isTouchedRef.current = false;
    } else {
      isTouchedRef.current = true;
    }
  }, [draft, getHtml]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    isTouchedRef.current = false;
  }, [chatId, threadId]);
  const isEditing = Boolean(editedMessage);
  const updateDraft = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])((prevState = {}) => {
    if (isDisabled || isEditing || !isTouchedRef.current) return;
    const html = getHtml();
    if (html) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
        saveDraft({
          chatId: prevState.chatId ?? chatId,
          threadId: prevState.threadId ?? threadId,
          text: (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_6__["default"])(html)
        });
      });
    } else {
      clearDraft({
        chatId: prevState.chatId ?? chatId,
        threadId: prevState.threadId ?? threadId,
        shouldKeepReply: true,
        shouldKeepSuggestedPost: true
      });
    }
  });
  const runDebouncedForSaveDraft = (0,_hooks_useRunDebounced__WEBPACK_IMPORTED_MODULE_10__["default"])(_config__WEBPACK_IMPORTED_MODULE_3__.DRAFT_DEBOUNCE, true, undefined, [chatId, threadId]);

  // Restore draft on chat change
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_9__["default"])(([prevChatId, prevThreadId, prevDraft]) => {
    if (isDisabled) {
      return;
    }
    const isTouched = isTouchedRef.current;
    const shouldUpdateSuggestedPost = draft?.suggestedPostInfo && !prevDraft?.suggestedPostInfo;
    if (chatId === prevChatId && threadId === prevThreadId) {
      if (isTouched && !draft) return; // Prevent reset from other client if we have local edits
      if (!draft && prevDraft) {
        setHtml('');
      }
      if (isTouched && !shouldUpdateSuggestedPost) return;
    }
    if (editedMessage || !draft) {
      return;
    }
    setHtml((0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_7__.getTextWithEntitiesAsHtml)(draft.text));
    if (shouldUpdateSuggestedPost) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestNextMutation)(() => {
        const messageInput = document.querySelector(_config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_CSS_SELECTOR);
        if (messageInput) {
          (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_5__["default"])(messageInput, true);
        }
      });
    }
    const customEmojiIds = draft.text?.entities?.map(entity => entity.type === _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMessageEntityTypes.CustomEmoji && entity.documentId).filter(Boolean) || [];
    if (customEmojiIds.length) loadCustomEmojis({
      ids: customEmojiIds
    });
  }, [chatId, threadId, draft, getHtml, setHtml, editedMessage, isDisabled]);

  // Save draft on chat change. Should be layout effect to read correct html on cleanup
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (isDisabled) {
      return undefined;
    }
    return () => {
      if (!isEditing) {
        updateDraft({
          chatId,
          threadId
        });
      }
      freeze();
    };
  }, [chatId, threadId, isEditing, updateDraft, isDisabled]);
  const chatIdRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_11__.useStateRef)(chatId);
  const threadIdRef = (0,_hooks_useStateRef__WEBPACK_IMPORTED_MODULE_11__.useStateRef)(threadId);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled || isFrozen) {
      return;
    }
    if (!getHtml()) {
      updateDraft();
      return;
    }
    const scopedСhatId = chatIdRef.current;
    const scopedThreadId = threadIdRef.current;
    runDebouncedForSaveDraft(() => {
      if (chatIdRef.current === scopedСhatId && threadIdRef.current === scopedThreadId) {
        updateDraft();
      }
    });
  }, [chatIdRef, getHtml, isDisabled, runDebouncedForSaveDraft, threadIdRef, updateDraft]);
  (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_12__["default"])(updateDraft);
  (0,_hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_13__["default"])(updateDraft);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useDraft);

/***/ },

/***/ "./src/components/middle/composer/hooks/useEditing.ts"
/*!************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useEditing.ts ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/focusEditableElement */ "./src/util/focusEditableElement.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");
/* harmony import */ var _hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/window/useBeforeUnload */ "./src/hooks/window/useBeforeUnload.ts");















const URL_ENTITIES = new Set([_api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMessageEntityTypes.TextUrl, _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMessageEntityTypes.Url]);
const DEBOUNCE_MS = 300;
const useEditing = (getHtml, setHtml, editedMessage, resetComposer, chatId, threadId, type, draft, editingDraft) => {
  const {
    editMessage,
    setEditingDraft,
    toggleMessageWebPage,
    openDeleteMessageModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [shouldForceShowEditing, setShouldForceShowEditing] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const replyingToId = draft?.replyInfo?.replyToMsgId;
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_11__["default"])(([prevEditedMessage, prevReplyingToId]) => {
    if (!editedMessage) {
      return;
    }
    if (replyingToId && prevReplyingToId !== replyingToId) {
      setHtml('');
      setShouldForceShowEditing(false);
      return;
    }
    if (prevEditedMessage?.id === editedMessage.id && replyingToId === prevReplyingToId) {
      return;
    }
    const text = !prevEditedMessage && editingDraft?.text.length ? editingDraft : editedMessage.content.text;
    const html = (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_8__.getTextWithEntitiesAsHtml)(text);
    setHtml(html);
    setShouldForceShowEditing(true);
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestNextMutation)(() => {
      const messageInput = document.querySelector(_config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_CSS_SELECTOR);
      if (messageInput) {
        (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__["default"])(messageInput, true);
      }
    });
  }, [editedMessage, replyingToId, editingDraft, setHtml]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!editedMessage) {
      return;
    }
    const shouldSetNoWebPage = !('webPage' in editedMessage.content) && editedMessage.content.text?.entities?.some(entity => URL_ENTITIES.has(entity.type));
    toggleMessageWebPage({
      chatId,
      threadId,
      noWebPage: shouldSetNoWebPage
    });
  }, [chatId, threadId, editedMessage]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!editedMessage) return undefined;
    return () => {
      const edited = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_7__["default"])(getHtml());
      const update = edited.text.length ? edited : undefined;
      setEditingDraft({
        chatId,
        threadId,
        type,
        text: update
      });
    };
  }, [chatId, editedMessage, getHtml, setEditingDraft, threadId, type]);
  const detectLinkDebounced = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_9__.useDebouncedResolver)(() => {
    if (!editedMessage) return false;
    const edited = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_7__["default"])(getHtml());
    return !('webPage' in editedMessage.content) && editedMessage.content.text?.entities?.some(entity => URL_ENTITIES.has(entity.type)) && !edited.entities?.some(entity => URL_ENTITIES.has(entity.type));
  }, [editedMessage, getHtml], DEBOUNCE_MS, true);
  const getShouldResetNoWebPageDebounced = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_10__["default"])(detectLinkDebounced, [detectLinkDebounced, getHtml], true);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_11__["default"])(([prevEditedMessage]) => {
    if (!editedMessage || prevEditedMessage?.id !== editedMessage.id) {
      return;
    }
    if (getShouldResetNoWebPageDebounced()) {
      toggleMessageWebPage({
        chatId,
        threadId,
        noWebPage: false
      });
    }
  }, [editedMessage, chatId, getHtml, threadId, getShouldResetNoWebPageDebounced]);
  const restoreNewDraftAfterEditing = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    if (!draft) return;

    // Run one frame after editing draft reset
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestMeasure)(() => {
      setHtml((0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_8__.getTextWithEntitiesAsHtml)(draft.text));

      // Wait one more frame until new HTML is rendered
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_4__.requestNextMutation)(() => {
        const messageInput = document.querySelector(_config__WEBPACK_IMPORTED_MODULE_3__.EDITABLE_INPUT_CSS_SELECTOR);
        if (messageInput) {
          (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__["default"])(messageInput, true);
        }
      });
    });
  });
  const handleEditCancel = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    resetComposer();
    restoreNewDraftAfterEditing();
  });
  const handleEditComplete = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    const {
      text,
      entities
    } = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_7__["default"])(getHtml());
    if (!editedMessage) {
      return;
    }
    if (!text && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.hasMessageMedia)(editedMessage)) {
      openDeleteMessageModal({
        chatId,
        messageIds: [editedMessage.id],
        isSchedule: type === 'scheduled'
      });
      return;
    }
    editMessage({
      messageList: {
        chatId,
        threadId,
        type
      },
      text,
      entities
    });
    resetComposer();
    restoreNewDraftAfterEditing();
  });
  const handleBlur = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    if (!editedMessage) return;
    const edited = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_7__["default"])(getHtml());
    const update = edited.text.length ? edited : undefined;
    setEditingDraft({
      chatId,
      threadId,
      type,
      text: update
    });
  });
  (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_13__["default"])(handleBlur);
  (0,_hooks_window_useBeforeUnload__WEBPACK_IMPORTED_MODULE_14__["default"])(handleBlur);
  return [handleEditComplete, handleEditCancel, shouldForceShowEditing];
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useEditing);

/***/ },

/***/ "./src/components/middle/composer/hooks/useEmojiTooltip.ts"
/*!*****************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useEmojiTooltip.ts ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useEmojiTooltip)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_emoji_emoji__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/emoji/emoji */ "./src/util/emoji/emoji.ts");
/* harmony import */ var _util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/focusEditableElement */ "./src/util/focusEditableElement.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _util_memoized__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../util/memoized */ "./src/util/memoized.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_customEmoji__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../helpers/customEmoji */ "./src/components/middle/composer/helpers/customEmoji.ts");
/* harmony import */ var _helpers_prepareForRegExp__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../helpers/prepareForRegExp */ "./src/components/middle/composer/helpers/prepareForRegExp.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");

















let emojiDataPromise;
let emojiRawData;
let emojiData;
let RE_EMOJI_SEARCH;
let RE_LOWERCASE_TEST;
const EMOJIS_LIMIT = 36;
const FILTER_MIN_LENGTH = 2;
const THROTTLE = 300;
const prepareRecentEmojisMemo = (0,_util_memoized__WEBPACK_IMPORTED_MODULE_9__["default"])(prepareRecentEmojis);
const prepareLibraryMemo = (0,_util_memoized__WEBPACK_IMPORTED_MODULE_9__["default"])(prepareLibrary);
const searchInLibraryMemo = (0,_util_memoized__WEBPACK_IMPORTED_MODULE_9__["default"])(searchInLibrary);
try {
  RE_EMOJI_SEARCH = /(^|\s):(?!\s)[-+_:'\s\p{L}\p{N}]*$/gui;
  RE_LOWERCASE_TEST = /\p{Ll}/u;
} catch (e) {
  // Support for older versions of firefox
  RE_EMOJI_SEARCH = /(^|\s):(?!\s)[-+_:'\s\d\wа-яёґєії]*$/gi;
  RE_LOWERCASE_TEST = /[a-zяёґєії]/;
}
function useEmojiTooltip(isEnabled, getHtml, setHtml, inputId = _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_ID, recentEmojiIds, baseEmojiKeywords, emojiKeywords) {
  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_15__["default"])(false);
  const [byId, setById] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [filteredEmojis, setFilteredEmojis] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY);
  const [filteredCustomEmojis, setFilteredCustomEmojis] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(_util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY);

  // Initialize data on first render
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isEnabled) return;
    function exec() {
      setById(emojiData.emojis);
    }
    if (emojiData) {
      exec();
    } else {
      ensureEmojiData().then(exec);
    }
  }, [isEnabled]);
  const detectEmojiCodeThrottled = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_13__.useThrottledResolver)(() => {
    const html = getHtml();
    return isEnabled && html.includes(':') ? (0,_helpers_prepareForRegExp__WEBPACK_IMPORTED_MODULE_12__.prepareForRegExp)(html).match(RE_EMOJI_SEARCH)?.[0].trim() : undefined;
  }, [getHtml, isEnabled], THROTTLE);
  const getEmojiCode = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_14__["default"])(detectEmojiCodeThrottled, [detectEmojiCodeThrottled, getHtml], true);
  const updateFiltered = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])(emojis => {
    setFilteredEmojis(emojis);
    if (emojis === _util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY) {
      setFilteredCustomEmojis(_util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY);
      return;
    }
    const nativeEmojis = emojis.map(emoji => emoji.native);
    const customEmojis = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.uniqueByField)((0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCustomEmojiForEmojis)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), nativeEmojis), 'id');
    setFilteredCustomEmojis(customEmojis);
  });
  const insertEmoji = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_16__["default"])((emoji, isForce = false) => {
    const html = getHtml();
    if (!html) return;
    const atIndex = html.lastIndexOf(':', isForce ? html.lastIndexOf(':') - 1 : undefined);
    if (atIndex !== -1) {
      const emojiHtml = typeof emoji === 'string' ? (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_10__["default"])(emoji, ['emoji_html'])[0] : (0,_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_11__.buildCustomEmojiHtml)(emoji);
      setHtml(`${html.substring(0, atIndex)}${emojiHtml}`);
      const messageInput = inputId === _config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_ID ? document.querySelector(_config__WEBPACK_IMPORTED_MODULE_2__.EDITABLE_INPUT_CSS_SELECTOR) : document.getElementById(inputId);
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestNextMutation)(() => {
        (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__["default"])(messageInput, true, true);
      });
    }
    updateFiltered(_util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const emojiCode = getEmojiCode();
    if (!emojiCode || !byId) {
      updateFiltered(_util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY);
      return;
    }
    const newShouldAutoInsert = emojiCode.length > 2 && emojiCode.endsWith(':');
    const filter = emojiCode.substring(1, newShouldAutoInsert ? 1 + emojiCode.length - 2 : undefined);
    let matched = _util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY;
    if (!filter) {
      matched = prepareRecentEmojisMemo(byId, recentEmojiIds, EMOJIS_LIMIT);
    } else if (filter.length === 1 && RE_LOWERCASE_TEST.test(filter) || filter.length >= FILTER_MIN_LENGTH) {
      const library = prepareLibraryMemo(byId, baseEmojiKeywords, emojiKeywords);
      matched = searchInLibraryMemo(library, filter.toLowerCase(), EMOJIS_LIMIT);
    }
    if (!matched.length) {
      updateFiltered(_util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY);
      return;
    }
    if (newShouldAutoInsert) {
      insertEmoji(matched[0].native, true);
    } else {
      updateFiltered(matched);
    }
  }, [baseEmojiKeywords, byId, getEmojiCode, emojiKeywords, insertEmoji, recentEmojiIds, updateFiltered]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);
  return {
    isEmojiTooltipOpen: Boolean(filteredEmojis.length || filteredCustomEmojis.length) && !isManuallyClosed,
    closeEmojiTooltip: markManuallyClosed,
    filteredEmojis,
    filteredCustomEmojis,
    insertEmoji
  };
}
async function ensureEmojiData() {
  if (!emojiDataPromise) {
    emojiDataPromise = __webpack_require__.e(/*! import() */ "vendors-node_modules_emoji-data-ios_emoji-data_json").then(__webpack_require__.t.bind(__webpack_require__, /*! emoji-data-ios/emoji-data.json */ "./node_modules/emoji-data-ios/emoji-data.json", 19));
    emojiRawData = (await emojiDataPromise).default;
    emojiData = (0,_util_emoji_emoji__WEBPACK_IMPORTED_MODULE_5__.uncompressEmoji)(emojiRawData);
  }
  return emojiDataPromise;
}
function prepareRecentEmojis(byId, recentEmojiIds, limit) {
  if (!byId || !recentEmojiIds.length) {
    return _util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY;
  }
  return Object.values((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.pickTruthy)(byId, recentEmojiIds)).slice(0, limit);
}
function prepareLibrary(byId, baseEmojiKeywords, emojiKeywords) {
  const emojis = Object.values(byId);
  const byNative = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.buildCollectionByKey)(emojis, 'native');
  const baseEmojisByKeyword = baseEmojiKeywords ? (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.mapValues)(baseEmojiKeywords, natives => {
    return Object.values((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.pickTruthy)(byNative, natives));
  }) : {};
  const emojisByKeyword = emojiKeywords ? (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.mapValues)(emojiKeywords, natives => {
    return Object.values((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.pickTruthy)(byNative, natives));
  }) : {};
  const byKeyword = {
    ...baseEmojisByKeyword,
    ...emojisByKeyword
  };
  const keywords = [].concat(Object.keys(baseEmojisByKeyword), Object.keys(emojisByKeyword));
  const byName = emojis.reduce((result, emoji) => {
    emoji.names.forEach(name => {
      if (!result[name]) {
        result[name] = [];
      }
      result[name].push(emoji);
    });
    return result;
  }, {});
  const names = Object.keys(byName);
  const maxKeyLength = keywords.reduce((max, keyword) => Math.max(max, keyword.length), 0);
  return {
    byKeyword,
    keywords,
    byName,
    names,
    maxKeyLength
  };
}
function searchInLibrary(library, filter, limit) {
  const {
    byKeyword,
    keywords,
    byName,
    names,
    maxKeyLength
  } = library;
  let matched = [];
  if (filter.length > maxKeyLength) {
    return _util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY;
  }
  const matchedKeywords = keywords.filter(keyword => keyword.startsWith(filter)).sort();
  matched = matched.concat(Object.values((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.pickTruthy)(byKeyword, matchedKeywords)).flat());

  // Also search by names, which is useful for non-English languages
  const matchedNames = names.filter(name => name.startsWith(filter));
  matched = matched.concat(Object.values((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.pickTruthy)(byName, matchedNames)).flat());
  matched = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.unique)(matched);
  if (!matched.length) {
    return _util_memo__WEBPACK_IMPORTED_MODULE_8__.MEMO_EMPTY_ARRAY;
  }
  return matched.slice(0, limit);
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useInlineBotTooltip.ts"
/*!*********************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useInlineBotTooltip.ts ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useInlineBotTooltip)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_memoized__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/memoized */ "./src/util/memoized.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");








const THROTTLE = 300;
const INLINE_BOT_QUERY_REGEXP = /^@([a-z0-9_]{1,32})[\u00A0\u0020]+(.*)/is;
const HAS_NEW_LINE = /^@([a-z0-9_]{1,32})[\u00A0\u0020]+\n{2,}/i;
const MEMO_NO_RESULT = {
  username: '',
  query: '',
  canShowHelp: false,
  usernameLowered: ''
};
const tempEl = document.createElement('div');
function useInlineBotTooltip(isEnabled, chatId, getHtml, inlineBots) {
  const {
    queryInlineBot,
    resetInlineBot,
    resetAllInlineBots
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_5__["default"])(false);
  const extractBotQueryThrottled = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_3__.useThrottledResolver)(() => {
    const html = getHtml();
    return isEnabled && html.startsWith('@') ? parseBotQuery(html) : MEMO_NO_RESULT;
  }, [getHtml, isEnabled], THROTTLE);
  const {
    username,
    query,
    canShowHelp,
    usernameLowered
  } = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_4__["default"])(extractBotQueryThrottled, [extractBotQueryThrottled, getHtml], true);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_7__["default"])(([prevUsername]) => {
    if (prevUsername) {
      resetInlineBot({
        username: prevUsername
      });
    }
  }, [username, resetInlineBot]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!usernameLowered) return;
    queryInlineBot({
      chatId,
      username: usernameLowered,
      query
    });
  }, [chatId, query, queryInlineBot, usernameLowered]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);
  const {
    id: botId,
    switchPm,
    switchWebview,
    offset,
    results,
    isGallery,
    help
  } = usernameLowered && inlineBots?.[usernameLowered] || {};
  const isOpen = Boolean((results?.length || switchPm) && !isManuallyClosed);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen && !username) {
      resetAllInlineBots();
    }
  }, [isOpen, resetAllInlineBots, username]);
  const loadMore = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!usernameLowered) return;
    queryInlineBot({
      chatId,
      username: usernameLowered,
      query,
      offset
    });
  });
  return {
    isOpen,
    botId,
    isGallery,
    switchPm,
    switchWebview,
    results,
    closeTooltip: markManuallyClosed,
    help: canShowHelp && help ? `@${username} ${help}` : undefined,
    loadMore
  };
}
const buildQueryStateMemo = (0,_util_memoized__WEBPACK_IMPORTED_MODULE_2__["default"])((username, query, canShowHelp) => ({
  username,
  query,
  canShowHelp,
  usernameLowered: username.toLowerCase()
}));
function parseBotQuery(html) {
  if (!html.startsWith('@')) {
    return MEMO_NO_RESULT;
  }
  const text = getPlainText(html);
  const result = text.match(INLINE_BOT_QUERY_REGEXP);
  if (!result) {
    return MEMO_NO_RESULT;
  }
  return buildQueryStateMemo(result[1], result[2], result[2] === '' && !text.match(HAS_NEW_LINE));
}
function getPlainText(html) {
  tempEl.innerHTML = html.replace(/<br>/g, '\n');
  tempEl.querySelectorAll('[alt]').forEach(el => {
    if (!el.innerText) {
      el.innerText = el.getAttribute('alt');
    }
  });
  return tempEl.innerText;
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useInputCustomEmojis.ts"
/*!**********************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useInputCustomEmojis.ts ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useInputCustomEmojis)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _lib_rlottie_RLottie_async__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../lib/rlottie/RLottie.async */ "./src/lib/rlottie/RLottie.async.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_AbsoluteVideo__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/AbsoluteVideo */ "./src/util/AbsoluteVideo.ts");
/* harmony import */ var _util_emoji_customEmojiManager__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/emoji/customEmojiManager */ "./src/util/emoji/customEmojiManager.ts");
/* harmony import */ var _util_math__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/math */ "./src/util/math.ts");
/* harmony import */ var _util_switchTheme__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/switchTheme */ "./src/util/switchTheme.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_stickers_useColorFilter__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/stickers/useColorFilter */ "./src/hooks/stickers/useColorFilter.tsx");
/* harmony import */ var _hooks_stickers_useDynamicColorListener__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/stickers/useDynamicColorListener */ "./src/hooks/stickers/useDynamicColorListener.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../../hooks/useThrottledCallback */ "./src/hooks/useThrottledCallback.ts");
/* harmony import */ var _hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../../hooks/window/useBackgroundMode */ "./src/hooks/window/useBackgroundMode.ts");
/* harmony import */ var _hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../../hooks/window/useDevicePixelRatio */ "./src/hooks/window/useDevicePixelRatio.ts");


















const SIZE = 1.25 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_9__.REM;
const THROTTLE_MS = 300;
function useInputCustomEmojis(getHtml, inputRef, sharedCanvasRef, sharedCanvasHqRef, absoluteContainerRef, prefixId, canPlayAnimatedEmojis, isReady, isActive) {
  const customColor = (0,_hooks_stickers_useDynamicColorListener__WEBPACK_IMPORTED_MODULE_11__["default"])(inputRef, undefined, !isReady);
  const colorFilter = (0,_hooks_stickers_useColorFilter__WEBPACK_IMPORTED_MODULE_10__["default"])(customColor, true);
  const dpr = (0,_hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_17__["default"])();
  const playersById = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(new Map());
  const clearPlayers = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(ids => {
    ids.forEach(id => {
      const player = playersById.current.get(id);
      if (player) {
        player.destroy();
        playersById.current.delete(id);
      }
    });
  });
  const synchronizeElements = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!isReady || !inputRef.current || !sharedCanvasRef.current || !sharedCanvasHqRef.current) return;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const playerIdsToClear = new Set(playersById.current.keys());
    const customEmojis = Array.from(inputRef.current.querySelectorAll('.custom-emoji'));
    customEmojis.forEach(element => {
      if (!element.dataset.uniqueId) {
        return;
      }
      const playerId = `${prefixId}${element.dataset.uniqueId}${customColor || ''}`;
      const documentId = element.dataset.documentId;
      playerIdsToClear.delete(playerId);
      const mediaUrl = (0,_util_emoji_customEmojiManager__WEBPACK_IMPORTED_MODULE_6__.getCustomEmojiMediaDataForInput)(documentId);
      if (!mediaUrl) {
        return;
      }
      const canvasBounds = sharedCanvasRef.current.getBoundingClientRect();
      const elementBounds = element.getBoundingClientRect();
      const x = (0,_util_math__WEBPACK_IMPORTED_MODULE_7__.round)((elementBounds.left - canvasBounds.left) / canvasBounds.width, 4);
      const y = (0,_util_math__WEBPACK_IMPORTED_MODULE_7__.round)((elementBounds.top - canvasBounds.top) / canvasBounds.height, 4);
      if (playersById.current.has(playerId)) {
        const player = playersById.current.get(playerId);
        player.updatePosition(x, y);
        return;
      }
      const customEmoji = global.customEmojis.byId[documentId];
      if (!customEmoji) {
        return;
      }
      const isHq = customEmoji?.stickerSetInfo && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectIsAlwaysHighPriorityEmoji)(global, customEmoji.stickerSetInfo);
      const renderId = [prefixId, documentId, customColor, dpr].filter(Boolean).join('_');
      createPlayer({
        customEmoji,
        sharedCanvasRef,
        sharedCanvasHqRef,
        absoluteContainerRef,
        renderId,
        viewId: playerId,
        mediaUrl,
        isHq,
        position: {
          x,
          y
        },
        textColor: customColor,
        colorFilter
      }).then(animation => {
        if (canPlayAnimatedEmojis) {
          animation.play();
        }
        playersById.current.set(playerId, animation);
      });
    });
    clearPlayers(Array.from(playerIdsToClear));
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return (0,_util_emoji_customEmojiManager__WEBPACK_IMPORTED_MODULE_6__.addCustomEmojiInputRenderCallback)(synchronizeElements);
  }, [synchronizeElements]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const activePlayersById = playersById.current;
    // Always clear players on unmount
    return () => {
      clearPlayers(Array.from(activePlayersById.keys()));
    };
  }, []);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!getHtml() || !inputRef.current || !sharedCanvasRef.current || !isActive || !isReady) {
      clearPlayers(Array.from(playersById.current.keys()));
      return;
    }

    // Wait one frame for DOM to update
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(() => {
      synchronizeElements();
    });
  }, [getHtml, synchronizeElements, inputRef, clearPlayers, sharedCanvasRef, isActive, isReady]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    document.documentElement.style.setProperty('--input-custom-emoji-filter', colorFilter || 'none');
  }, [colorFilter]);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_12__["default"])(([prevCustomColor]) => {
    if (prevCustomColor !== undefined && customColor !== prevCustomColor) {
      synchronizeElements();
    }
  }, [customColor, synchronizeElements]);
  const throttledSynchronizeElements = (0,_hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_15__["default"])(synchronizeElements, [synchronizeElements], THROTTLE_MS, false);
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_14__["default"])(sharedCanvasRef, throttledSynchronizeElements);
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_12__["default"])(([prevDpr]) => {
    if (dpr !== prevDpr) {
      clearPlayers(Array.from(playersById.current.keys()));
      synchronizeElements();
    }
  }, [dpr, synchronizeElements]);
  const freezeAnimation = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    playersById.current.forEach(player => {
      player.pause();
    });
  });
  const unfreezeAnimation = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!canPlayAnimatedEmojis) {
      return;
    }
    playersById.current?.forEach(player => {
      player.play();
    });
  });
  const unfreezeAnimationOnRaf = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(unfreezeAnimation);
  });

  // Pausing frame may not happen in background,
  // so we need to make sure it happens right after focusing,
  // then we can play again.
  (0,_hooks_window_useBackgroundMode__WEBPACK_IMPORTED_MODULE_16__["default"])(freezeAnimation, unfreezeAnimationOnRaf);
}
async function createPlayer({
  customEmoji,
  sharedCanvasRef,
  sharedCanvasHqRef,
  absoluteContainerRef,
  renderId,
  viewId,
  mediaUrl,
  position,
  isHq,
  textColor,
  colorFilter
}) {
  if (customEmoji.isLottie) {
    const color = customEmoji.shouldUseTextColor && textColor ? (0,_util_switchTheme__WEBPACK_IMPORTED_MODULE_8__.hexToRgb)(textColor) : undefined;
    const RLottie = await (0,_lib_rlottie_RLottie_async__WEBPACK_IMPORTED_MODULE_3__.ensureRLottie)();
    const lottie = RLottie.init(mediaUrl, isHq ? sharedCanvasHqRef.current : sharedCanvasRef.current, renderId, {
      size: SIZE,
      coords: position,
      isLowPriority: !isHq
    }, viewId, color ? [color.r, color.g, color.b] : undefined);
    return {
      play: () => lottie.play(),
      pause: () => lottie.pause(),
      destroy: () => lottie.removeView(viewId),
      updatePosition: (x, y) => {
        return lottie.setSharedCanvasCoords(viewId, {
          x,
          y
        });
      }
    };
  }
  if (customEmoji.isVideo) {
    const style = customEmoji.shouldUseTextColor && colorFilter ? `filter: ${colorFilter};` : undefined;
    const absoluteVideo = new _util_AbsoluteVideo__WEBPACK_IMPORTED_MODULE_5__["default"](mediaUrl, absoluteContainerRef.current, {
      size: SIZE,
      position,
      style
    });
    return {
      play: () => absoluteVideo.play(),
      pause: () => absoluteVideo.pause(),
      destroy: () => absoluteVideo.destroy(),
      updatePosition: (x, y) => absoluteVideo.updatePosition({
        x,
        y
      })
    };
  }
  throw new Error('Unsupported custom emoji type');
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useLoadLinkPreview.ts"
/*!********************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useLoadLinkPreview.ts ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useLoadLinkPreview)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/parseHtmlAsFormattedText */ "./src/util/parseHtmlAsFormattedText.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");








const DEBOUNCE_MS = 300;
const RE_LINK = new RegExp(_config__WEBPACK_IMPORTED_MODULE_3__.RE_LINK_TEMPLATE, 'i');
function useLoadLinkPreview({
  getHtml,
  chatId,
  threadId
}) {
  const {
    loadWebPagePreview,
    clearWebPagePreview,
    toggleMessageWebPage
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const formattedTextWithLinkRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const detectLinkDebounced = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_5__.useDebouncedResolver)(() => {
    const formattedText = (0,_util_parseHtmlAsFormattedText__WEBPACK_IMPORTED_MODULE_4__["default"])(getHtml());
    const linkEntity = formattedText.entities?.find(entity => entity.type === _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMessageEntityTypes.TextUrl);
    formattedTextWithLinkRef.current = formattedText;
    return linkEntity?.url || formattedText.text.match(RE_LINK)?.[0];
  }, [getHtml], DEBOUNCE_MS, true);
  const getLink = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_6__["default"])(detectLinkDebounced, [detectLinkDebounced, getHtml], true);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const link = getLink();
    const formattedText = formattedTextWithLinkRef.current;
    if (link) {
      loadWebPagePreview({
        text: formattedText
      });
    } else {
      clearWebPagePreview();
      toggleMessageWebPage({
        chatId,
        threadId
      });
    }
  }, [getLink, chatId, threadId]);
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    clearWebPagePreview();
    toggleMessageWebPage({
      chatId,
      threadId
    });
  }, [chatId, clearWebPagePreview, threadId, toggleMessageWebPage]);
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useMentionTooltip.ts"
/*!*******************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useMentionTooltip.ts ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useMentionTooltip)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/focusEditableElement */ "./src/util/focusEditableElement.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_selection__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/selection */ "./src/util/selection.ts");
/* harmony import */ var _helpers_prepareForRegExp__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../helpers/prepareForRegExp */ "./src/components/middle/composer/helpers/prepareForRegExp.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");















const THROTTLE = 300;
let RE_USERNAME_SEARCH;
try {
  RE_USERNAME_SEARCH = /(^|\s)@[-_\p{L}\p{M}\p{N}]*$/gui;
} catch (e) {
  // Support for older versions of Firefox
  RE_USERNAME_SEARCH = /(^|\s)@[-_\d\wа-яёґєії]*$/gi;
}
function useMentionTooltip(isEnabled, getHtml, setHtml, getSelectionRange, inputRef, groupChatMembers, topInlineBotIds, currentUserId) {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const [filteredUsers, setFilteredUsers] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_12__["default"])(false);
  const extractUsernameTagThrottled = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_10__.useThrottledResolver)(() => {
    const html = getHtml();
    if (!isEnabled || !getSelectionRange()?.collapsed || !html.includes('@')) return undefined;
    const htmlBeforeSelection = (0,_util_selection__WEBPACK_IMPORTED_MODULE_8__.getHtmlBeforeSelection)(inputRef.current);
    return (0,_helpers_prepareForRegExp__WEBPACK_IMPORTED_MODULE_9__.prepareForRegExp)(htmlBeforeSelection).match(RE_USERNAME_SEARCH)?.[0].trim();
  }, [isEnabled, getHtml, getSelectionRange, inputRef], THROTTLE);
  const getUsernameTag = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_11__["default"])(extractUsernameTagThrottled, [extractUsernameTagThrottled, getHtml, getSelectionRange], true);
  const getWithInlineBots = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    return isEnabled && getHtml().startsWith('@');
  }, [getHtml, isEnabled]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const usernameTag = getUsernameTag();
    if (!usernameTag || !(groupChatMembers || topInlineBotIds)) {
      setFilteredUsers(undefined);
      return;
    }

    // No need for expensive global updates on users, so we avoid them
    const usersById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().users.byId;
    if (!usersById) {
      setFilteredUsers(undefined);
      return;
    }
    const memberIds = groupChatMembers?.reduce((acc, member) => {
      if (member.userId !== currentUserId) {
        acc.push(member.userId);
      }
      return acc;
    }, []);
    const filter = usernameTag.substring(1);
    const filteredIds = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__.filterPeersByQuery)({
      ids: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.unique)([...(getWithInlineBots() && topInlineBotIds || []), ...(memberIds || [])]),
      query: filter,
      type: 'user'
    });
    setFilteredUsers(Object.values((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_7__.pickTruthy)(usersById, filteredIds)));
  }, [currentUserId, groupChatMembers, topInlineBotIds, getUsernameTag, getWithInlineBots]);
  const insertMention = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])((peer, forceFocus = false, insertAtEnd = false) => {
    if (!peer.hasUsername && !(0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__.getPeerTitle)(lang, peer)) {
      return;
    }
    const mainUsername = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMainUsername)(peer);
    const userFirstOrLastName = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__.getPeerTitle)(lang, peer) || '';
    const htmlToInsert = mainUsername ? `@${mainUsername}` : `<a
          class="text-entity-link"
          data-entity-type="${_api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMessageEntityTypes.MentionName}"
          data-user-id="${peer.id}"
          contenteditable="false"
          dir="auto"
        >${userFirstOrLastName}</a>`;
    const inputEl = inputRef.current;
    const htmlBeforeSelection = (0,_util_selection__WEBPACK_IMPORTED_MODULE_8__.getHtmlBeforeSelection)(inputEl);
    const fixedHtmlBeforeSelection = cleanWebkitNewLines(htmlBeforeSelection);
    const atIndex = insertAtEnd ? fixedHtmlBeforeSelection.length : fixedHtmlBeforeSelection.lastIndexOf('@');
    const shiftCaretPosition = (mainUsername ? mainUsername.length + 1 : userFirstOrLastName.length) - (fixedHtmlBeforeSelection.length - atIndex);
    if (atIndex !== -1) {
      const newHtml = `${fixedHtmlBeforeSelection.substr(0, atIndex)}${htmlToInsert}&nbsp;`;
      const htmlAfterSelection = cleanWebkitNewLines(inputEl.innerHTML).substring(fixedHtmlBeforeSelection.length);
      const caretPosition = (0,_util_selection__WEBPACK_IMPORTED_MODULE_8__.getCaretPosition)(inputEl);
      setHtml(`${newHtml}${htmlAfterSelection}`);
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestNextMutation)(() => {
        const newCaretPosition = caretPosition + shiftCaretPosition + 1;
        (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__["default"])(inputEl, forceFocus);
        if (newCaretPosition >= 0) {
          (0,_util_selection__WEBPACK_IMPORTED_MODULE_8__.setCaretPosition)(inputEl, newCaretPosition);
        }
      });
    }
    setFilteredUsers(undefined);
  });

  // Batch insert multiple mentions in a single DOM update
  const insertMentionsBatch = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])((peers, forceFocusFirst = true) => {
    if (!peers || !peers.length) return;
    const parts = [];
    for (const peer of peers) {
      if (!peer.hasUsername && !(0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__.getPeerTitle)(lang, peer)) {
        continue;
      }
      const mainUsername = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMainUsername)(peer);
      const userFirstOrLastName = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_5__.getPeerTitle)(lang, peer) || '';
      const htmlToInsert = mainUsername ? `@${mainUsername}` : `<a
            class="text-entity-link"
            data-entity-type="${_api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMessageEntityTypes.MentionName}"
            data-user-id="${peer.id}"
            contenteditable="false"
            dir="auto"
          >${userFirstOrLastName}</a>`;
      parts.push(htmlToInsert);
    }
    if (!parts.length) return;
    const combined = parts.join('&nbsp;');
    const inputEl = inputRef.current;
    const htmlBeforeSelection = (0,_util_selection__WEBPACK_IMPORTED_MODULE_8__.getHtmlBeforeSelection)(inputEl);
    const fixedHtmlBeforeSelection = cleanWebkitNewLines(htmlBeforeSelection);
    const atIndex = fixedHtmlBeforeSelection.lastIndexOf('@');
    if (atIndex !== -1) {
      const prefix = fixedHtmlBeforeSelection.substr(0, atIndex);
      const htmlAfterSelection = cleanWebkitNewLines(inputEl.innerHTML).substring(fixedHtmlBeforeSelection.length);
      setHtml(`${prefix}${combined}&nbsp;${htmlAfterSelection}`);
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestNextMutation)(() => {
        (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__["default"])(inputEl, forceFocusFirst);
        const newCaretPosition = (prefix + combined).length + 1;
        (0,_util_selection__WEBPACK_IMPORTED_MODULE_8__.setCaretPosition)(inputEl, newCaretPosition);
      });
    } else {
      const currentHtml = cleanWebkitNewLines(inputEl.innerHTML);
      setHtml(`${currentHtml}${combined}&nbsp;`);
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestNextMutation)(() => {
        (0,_util_focusEditableElement__WEBPACK_IMPORTED_MODULE_6__["default"])(inputEl, forceFocusFirst);
        const newCaretPosition = (currentHtml + combined).length + 1;
        (0,_util_selection__WEBPACK_IMPORTED_MODULE_8__.setCaretPosition)(inputEl, newCaretPosition);
      });
    }
    setFilteredUsers(undefined);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);
  return {
    isMentionTooltipOpen: Boolean(filteredUsers?.length && !isManuallyClosed),
    closeMentionTooltip: markManuallyClosed,
    insertMention,
    insertMentionsBatch,
    mentionFilteredUsers: filteredUsers
  };
}

// Webkit replaces the line break with the `<div><br /></div>` or `<div></div>` code.
// It is necessary to clean the html to a single form before processing.
function cleanWebkitNewLines(html) {
  return html.replace(/<div>(<br>|<br\s?\/>)?<\/div>/gi, '<br>');
}

/***/ },

/***/ "./src/components/middle/composer/hooks/usePaidMessageConfirmation.ts"
/*!****************************************************************************!*\
  !*** ./src/components/middle/composer/hooks/usePaidMessageConfirmation.ts ***!
  \****************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePaidMessageConfirmation)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");




function usePaidMessageConfirmation(starsForAllMessages, isStarsBalanceModeOpen, starsBalance) {
  const {
    shouldPaidMessageAutoApprove
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().settings.byKey;
  const [shouldAutoApprove, setAutoApprove] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(Boolean(shouldPaidMessageAutoApprove));
  const [isWaitingStarsTopup, setIsWaitingStarsTopup] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const confirmPaymentHandlerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const closeConfirmDialog = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().closePaymentMessageConfirmDialogOpen();
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isWaitingStarsTopup && !isStarsBalanceModeOpen) {
      setIsWaitingStarsTopup(false);
      if (starsBalance > starsForAllMessages) {
        confirmPaymentHandlerRef?.current?.();
      }
    }
  }, [isWaitingStarsTopup, isStarsBalanceModeOpen, starsBalance, starsForAllMessages]);
  const handleStarsTopup = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openStarsBalanceModal({
      topup: {
        balanceNeeded: starsForAllMessages,
        purpose: _config__WEBPACK_IMPORTED_MODULE_2__.PAID_MESSAGES_PURPOSE
      }
    });
    setIsWaitingStarsTopup(true);
  });
  const dialogHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    if (starsForAllMessages > starsBalance) {
      handleStarsTopup();
    } else {
      confirmPaymentHandlerRef?.current?.();
    }
    (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().closePaymentMessageConfirmDialogOpen();
    if (shouldAutoApprove) (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().setPaidMessageAutoApprove();
  });
  const handleWithConfirmation = (handler, ...args) => {
    if (starsForAllMessages) {
      confirmPaymentHandlerRef.current = () => handler(...args);
      if (!shouldPaidMessageAutoApprove) {
        (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().openPaymentMessageConfirmDialogOpen();
        return;
      }
      if (starsForAllMessages > starsBalance) {
        handleStarsTopup();
        return;
      }
    }
    handler(...args);
  };
  return {
    closeConfirmDialog,
    handleWithConfirmation,
    dialogHandler,
    shouldAutoApprove,
    setAutoApprove
  };
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useStickerTooltip.ts"
/*!*******************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useStickerTooltip.ts ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useStickerTooltip)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _lib_twemojiRegex__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../lib/twemojiRegex */ "./src/lib/twemojiRegex.js");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_emoji_parseEmojiOnlyString__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/emoji/parseEmojiOnlyString */ "./src/util/emoji/parseEmojiOnlyString.ts");
/* harmony import */ var _helpers_prepareForRegExp__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../helpers/prepareForRegExp */ "./src/components/middle/composer/helpers/prepareForRegExp.ts");
/* harmony import */ var _hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useDerivedState */ "./src/hooks/useDerivedState.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");










const MAX_LENGTH = 8;
const STARTS_ENDS_ON_EMOJI_IMG_REGEX = new RegExp(`^${_config__WEBPACK_IMPORTED_MODULE_2__.EMOJI_IMG_REGEX.source}$`, 'g');
function useStickerTooltip(isEnabled, getHtml, stickers) {
  const {
    loadStickersForEmoji,
    clearStickersForEmoji
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])(false);
  const getSingleEmoji = (0,_hooks_useDerivedSignal__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    const html = getHtml();
    if (!isEnabled || !html || _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_EMOJI_SUPPORTED && html.length > MAX_LENGTH) return undefined;
    const hasEmoji = html.match(_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_EMOJI_SUPPORTED ? _lib_twemojiRegex__WEBPACK_IMPORTED_MODULE_3__["default"] : _config__WEBPACK_IMPORTED_MODULE_2__.EMOJI_IMG_REGEX);
    if (!hasEmoji) return undefined;
    const cleanHtml = (0,_helpers_prepareForRegExp__WEBPACK_IMPORTED_MODULE_6__.prepareForRegExp)(html);
    const isSingleEmoji = cleanHtml && (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_EMOJI_SUPPORTED && (0,_util_emoji_parseEmojiOnlyString__WEBPACK_IMPORTED_MODULE_5__["default"])(cleanHtml) === 1 || !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_EMOJI_SUPPORTED && Boolean(html.match(STARTS_ENDS_ON_EMOJI_IMG_REGEX)));
    return isSingleEmoji ? _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_EMOJI_SUPPORTED ? cleanHtml : cleanHtml.match(/alt="(.+)"/)?.[1] : undefined;
  }, [getHtml, isEnabled]);
  const isActive = (0,_hooks_useDerivedState__WEBPACK_IMPORTED_MODULE_8__["default"])(() => Boolean(getSingleEmoji()), [getSingleEmoji]);
  const hasStickers = Boolean(stickers?.length);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isEnabled || !isActive) return;
    const singleEmoji = getSingleEmoji();
    if (singleEmoji) {
      if (!hasStickers) {
        loadStickersForEmoji({
          emoji: singleEmoji
        });
      }
    } else {
      clearStickersForEmoji();
    }
  }, [isEnabled, isActive, getSingleEmoji, hasStickers, loadStickersForEmoji, clearStickersForEmoji]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);
  return {
    isStickerTooltipOpen: Boolean(isActive && hasStickers && !isManuallyClosed),
    closeStickerTooltip: markManuallyClosed
  };
}

/***/ },

/***/ "./src/components/middle/composer/hooks/useVoiceRecording.ts"
/*!*******************************************************************!*\
  !*** ./src/components/middle/composer/hooks/useVoiceRecording.ts ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/captureEscKeyListener */ "./src/util/captureEscKeyListener.ts");
/* harmony import */ var _util_voiceRecording__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/voiceRecording */ "./src/util/voiceRecording.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");






const useVoiceRecording = () => {
  const recordButtonRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [activeVoiceRecording, setActiveVoiceRecording] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const startRecordTimeRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [currentRecordTime, setCurrentRecordTime] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isViewOnceEnabled, setIsViewOnceEnabled] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    // Preloading worker fixes silent first record on iOS
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_SAFARI && _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_VOICE_RECORDING_SUPPORTED) {
      void _util_voiceRecording__WEBPACK_IMPORTED_MODULE_4__.init();
    }
  }, []);
  const startRecordingVoice = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(async () => {
    try {
      const {
        stop,
        pause
      } = await _util_voiceRecording__WEBPACK_IMPORTED_MODULE_4__.start(tickVolume => {
        if (recordButtonRef.current) {
          if (startRecordTimeRef.current && Date.now() % 4 === 0) {
            (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
              if (!recordButtonRef.current) return;
              recordButtonRef.current.style.boxShadow = `0 0 0 ${(tickVolume || 0) * 50}px rgba(0,0,0,.15)`;
            });
          }
          setCurrentRecordTime(Date.now());
        }
      });
      startRecordTimeRef.current = Date.now();
      setCurrentRecordTime(Date.now());
      setActiveVoiceRecording({
        stop,
        pause
      });
    } catch (err) {
      // eslint-disable-next-line no-console
      console.error(err);
    }
  });
  const pauseRecordingVoice = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (!activeVoiceRecording) {
      return undefined;
    }
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      if (recordButtonRef.current) {
        recordButtonRef.current.style.boxShadow = 'none';
      }
    });
    try {
      return activeVoiceRecording.pause();
    } catch (err) {
      // eslint-disable-next-line no-console
      console.error(err);
      return undefined;
    }
  });
  const stopRecordingVoice = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (!activeVoiceRecording) {
      return undefined;
    }
    setActiveVoiceRecording(undefined);
    startRecordTimeRef.current = undefined;
    setCurrentRecordTime(undefined);
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      if (recordButtonRef.current) {
        recordButtonRef.current.style.boxShadow = 'none';
      }
    });
    try {
      return activeVoiceRecording.stop();
    } catch (err) {
      // eslint-disable-next-line no-console
      console.error(err);
      return undefined;
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return activeVoiceRecording ? (0,_util_captureEscKeyListener__WEBPACK_IMPORTED_MODULE_3__["default"])(stopRecordingVoice) : undefined;
  }, [activeVoiceRecording, stopRecordingVoice]);
  const toogleViewOnceEnabled = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    setIsViewOnceEnabled(!isViewOnceEnabled);
  });
  return {
    startRecordingVoice,
    pauseRecordingVoice,
    stopRecordingVoice,
    activeVoiceRecording,
    currentRecordTime,
    recordButtonRef,
    startRecordTimeRef,
    isViewOnceEnabled,
    setIsViewOnceEnabled,
    toogleViewOnceEnabled
  };
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useVoiceRecording);

/***/ },

/***/ "./src/components/middle/hooks/useHeaderPane.tsx"
/*!*******************************************************!*\
  !*** ./src/components/middle/hooks/useHeaderPane.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   applyAnimationState: () => (/* binding */ applyAnimationState),
/* harmony export */   "default": () => (/* binding */ useHeaderPane)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/teact/teact-dom */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useThrottledCallback */ "./src/hooks/useThrottledCallback.ts");







// Max slide transition duration
const CLOSE_DURATION = 450;
const RESIZE_THROTTLE = 100;
function useHeaderPane({
  ref: providedRef,
  isOpen,
  isDisabled,
  withResizeObserver,
  onStateChange
}) {
  const [shouldRender, setShouldRender] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(isOpen);
  const localRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const ref = providedRef || localRef;
  const lastHeightRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
  const reset = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    setShouldRender(true);
    onStateChange?.({
      element: undefined,
      height: 0,
      isOpen: false
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled) {
      reset();
    }
  }, [isDisabled]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen) {
      setShouldRender(true);
    }
  }, [isOpen]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useUnmountCleanup)(reset);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    setShouldRender(false);
    onStateChange?.({
      height: 0,
      isOpen: false
    });
  }, !isOpen ? CLOSE_DURATION : undefined);

  // Should be `useCallback` to trigger effect on deps change
  const handleUpdate = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    const element = ref.current;
    if (isDisabled || !element || !shouldRender) return;
    if (!isOpen) {
      onStateChange?.({
        element,
        height: 0,
        isOpen: false
      });
      return;
    }
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestForcedReflow)(() => {
      const currentHeight = element.offsetHeight;
      lastHeightRef.current = currentHeight;
      return () => {
        onStateChange?.({
          element,
          height: currentHeight,
          isOpen
        });
      };
    });
  }, [isOpen, shouldRender, isDisabled, ref, onStateChange]);
  const handleResize = (0,_hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const element = ref.current;
    if (!element) return;
    const newHeight = element.offsetHeight;
    if (newHeight === lastHeightRef.current) {
      return;
    }
    handleUpdate();
  }, [handleUpdate, ref], RESIZE_THROTTLE, true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(handleUpdate, [handleUpdate]);
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_5__["default"])(ref, handleResize, !withResizeObserver || !shouldRender);
  return {
    shouldRender,
    ref
  };
}
function applyAnimationState(list, noTransition = false) {
  let cumulativeHeight = 0;
  for (let i = 0; i < list.length; i++) {
    const state = list[i];
    const element = state.element;
    if (!element) {
      continue;
    }
    const shiftPx = `${cumulativeHeight}px`;
    const apply = () => {
      (0,_lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__.setExtraStyles)(element, {
        transform: `translateY(${state.isOpen ? shiftPx : `calc(${shiftPx} - 100%)`})`,
        zIndex: String(-i),
        transition: noTransition ? 'none' : ''
      });
    };
    if (!element.dataset.isPanelOpen && state.isOpen && !noTransition) {
      // Start animation right above its final position
      (0,_lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__.setExtraStyles)(element, {
        transform: `translateY(calc(${shiftPx} - 100%))`,
        zIndex: String(-i),
        transition: 'none'
      });
      element.dataset.isPanelOpen = 'true';
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestNextMutation)(apply);
    } else {
      apply();
    }
    cumulativeHeight += state.height;
  }
}

/***/ },

/***/ "./src/components/middle/message/Album.scss"
/*!**************************************************!*\
  !*** ./src/components/middle/message/Album.scss ***!
  \**************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/Album.tsx"
/*!*************************************************!*\
  !*** ./src/components/middle/message/Album.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./helpers/calculateAlbumLayout */ "./src/components/middle/message/helpers/calculateAlbumLayout.ts");
/* harmony import */ var _hocs_withSelectControl__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./hocs/withSelectControl */ "./src/components/middle/message/hocs/withSelectControl.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _Photo__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./Photo */ "./src/components/middle/message/Photo.tsx");
/* harmony import */ var _Video__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./Video */ "./src/components/middle/message/Video.tsx");
/* harmony import */ var _Album_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./Album.scss */ "./src/components/middle/message/Album.scss");












const PhotoWithSelect = (0,_hocs_withSelectControl__WEBPACK_IMPORTED_MODULE_6__["default"])(_Photo__WEBPACK_IMPORTED_MODULE_8__["default"]);
const VideoWithSelect = (0,_hocs_withSelectControl__WEBPACK_IMPORTED_MODULE_6__["default"])(_Video__WEBPACK_IMPORTED_MODULE_9__["default"]);
const Album = ({
  album,
  observeIntersection,
  hasCustomAppendix,
  isOwn,
  isProtected,
  albumLayout,
  onMediaClick,
  uploadsByKey,
  activeDownloads,
  theme
}) => {
  const {
    cancelUploadMedia
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    content: {
      paidMedia
    }
  } = album.mainMessage;
  const mediaCount = album.isPaidMedia ? paidMedia.extendedMedia.length : album.messages.length;
  const handlePaidMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(index => {
    onMediaClick(album.mainMessage.id, index);
  });
  const handleAlbumMessageClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(messageId => {
    onMediaClick(messageId);
  });
  const handleCancelUpload = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(messageId => {
    cancelUploadMedia({
      chatId: album.mainMessage.chatId,
      messageId
    });
  });
  const messages = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (album.isPaidMedia) {
      return album.mainMessage.content.paidMedia.extendedMedia.map(() => album.mainMessage);
    }
    return album.messages;
  }, [album]);
  function renderAlbumMessage(message, index) {
    const renderingPaidMedia = album.isPaidMedia ? message.content.paidMedia?.extendedMedia[index] : undefined;
    const paidPhotoOrPreview = renderingPaidMedia && 'mediaType' in renderingPaidMedia ? renderingPaidMedia : renderingPaidMedia?.photo;
    const paidVideoOrPreview = renderingPaidMedia && 'mediaType' in renderingPaidMedia ? renderingPaidMedia : renderingPaidMedia?.video;
    const photo = paidPhotoOrPreview || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessagePhoto)(message);
    const video = paidVideoOrPreview || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(message).video;
    const fileUpload = uploadsByKey[(0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message)];
    const uploadProgress = fileUpload?.progress;
    const {
      dimensions,
      sides
    } = albumLayout.layout[index];

    // Ignoring global updates is a known drawback here
    const canAutoLoad = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanAutoLoadMedia)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), message);
    const canAutoPlay = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanAutoPlayMedia)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), message);
    if (photo) {
      const shouldAffectAppendix = hasCustomAppendix && (isOwn ? index === mediaCount - 1 : Boolean(sides & _helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_5__.AlbumRectPart.Left && sides & _helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_5__.AlbumRectPart.Bottom));
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PhotoWithSelect, {
        id: `album-media-${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageHtmlId)(message.id, album.isPaidMedia ? index : undefined)}`,
        photo: photo,
        isOwn: isOwn,
        observeIntersectionForLoading: observeIntersection,
        canAutoLoad: canAutoLoad,
        shouldAffectAppendix: shouldAffectAppendix,
        uploadProgress: uploadProgress,
        dimensions: dimensions,
        isProtected: isProtected,
        clickArg: album.isPaidMedia ? index : message.id,
        onClick: album.isPaidMedia ? handlePaidMediaClick : handleAlbumMessageClick,
        onCancelUpload: handleCancelUpload,
        isDownloading: photo.mediaType !== 'extendedMediaPreview' && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getIsDownloading)(activeDownloads, photo),
        theme: theme,
        noSelectControls: album.isPaidMedia
      });
    } else if (video) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(VideoWithSelect, {
        id: `album-media-${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageHtmlId)(message.id)}`,
        video: video,
        observeIntersectionForLoading: observeIntersection,
        canAutoLoad: canAutoLoad,
        canAutoPlay: canAutoPlay,
        uploadProgress: uploadProgress,
        dimensions: dimensions,
        isProtected: isProtected,
        clickArg: album.isPaidMedia ? index : message.id,
        onClick: album.isPaidMedia ? handlePaidMediaClick : handleAlbumMessageClick,
        onCancelUpload: handleCancelUpload,
        isDownloading: video.mediaType !== 'extendedMediaPreview' && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getIsDownloading)(activeDownloads, video),
        theme: theme,
        noSelectControls: album.isPaidMedia
      });
    }
    return undefined;
  }
  const {
    width: containerWidth,
    height: containerHeight
  } = albumLayout.containerStyle;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "Album",
    style: `width: ${containerWidth}px; height: ${containerHeight}px;`
  }, messages.map(renderAlbumMessage));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTheme)(global);
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectActiveDownloads)(global);
  return {
    theme,
    uploadsByKey: global.fileUploads.byMessageKey,
    activeDownloads
  };
})(Album));

/***/ },

/***/ "./src/components/middle/message/AnimatedCustomEmoji.tsx"
/*!***************************************************************!*\
  !*** ./src/components/middle/message/AnimatedCustomEmoji.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../composer/helpers/customEmoji */ "./src/components/middle/composer/helpers/customEmoji.ts");
/* harmony import */ var _common_hooks_useAnimatedEmoji__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/hooks/useAnimatedEmoji */ "./src/components/common/hooks/useAnimatedEmoji.ts");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _AnimatedEmoji_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./AnimatedEmoji.scss */ "./src/components/middle/message/AnimatedEmoji.scss");










const AnimatedCustomEmoji = ({
  isOwn,
  customEmojiId,
  messageId,
  chatId,
  activeEmojiInteractions,
  sticker,
  effect,
  soundId,
  noPlay,
  observeIntersection
}) => {
  const {
    ref,
    size,
    style,
    handleClick
  } = (0,_common_hooks_useAnimatedEmoji__WEBPACK_IMPORTED_MODULE_6__["default"])(chatId, messageId, soundId, activeEmojiInteractions, isOwn, effect?.emoji, (0,_composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_5__.getCustomEmojiSize)(1));
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_7__["default"], {
    ref: ref,
    documentId: customEmojiId,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('AnimatedEmoji media-inner', sticker?.id === _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.LIKE_STICKER_ID && 'like-sticker-thumb'),
    style: style,
    size: size,
    isBig: true,
    noPlay: noPlay,
    withSharedAnimation: true,
    forceOnHeavyAnimation: Boolean(effect && activeEmojiInteractions?.length),
    observeIntersectionForLoading: observeIntersection,
    onClick: handleClick
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  customEmojiId,
  withEffects
}) => {
  const sticker = global.customEmojis.byId[customEmojiId];
  return {
    sticker,
    effect: sticker?.emoji && withEffects ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmojiEffect)(global, sticker.emoji) : undefined,
    soundId: sticker?.emoji && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmojiSound)(global, sticker.emoji),
    noPlay: !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectCanPlayAnimatedEmojis)(global)
  };
})(AnimatedCustomEmoji)));

/***/ },

/***/ "./src/components/middle/message/AnimatedEmoji.scss"
/*!**********************************************************!*\
  !*** ./src/components/middle/message/AnimatedEmoji.scss ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/AnimatedEmoji.tsx"
/*!*********************************************************!*\
  !*** ./src/components/middle/message/AnimatedEmoji.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _common_hooks_useAnimatedEmoji__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/hooks/useAnimatedEmoji */ "./src/components/common/hooks/useAnimatedEmoji.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _AnimatedEmoji_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./AnimatedEmoji.scss */ "./src/components/middle/message/AnimatedEmoji.scss");










const QUALITY = 1;
const AnimatedEmoji = ({
  isOwn,
  observeIntersection,
  forceLoadPreview,
  messageId,
  chatId,
  activeEmojiInteractions,
  sticker,
  effect,
  soundId
}) => {
  const {
    ref,
    size,
    style,
    handleClick
  } = (0,_common_hooks_useAnimatedEmoji__WEBPACK_IMPORTED_MODULE_6__["default"])(chatId, messageId, soundId, activeEmojiInteractions, isOwn, effect?.emoji);
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__.useIsIntersecting)(ref, observeIntersection);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_7__["default"], {
    sticker: sticker,
    size: size,
    quality: QUALITY,
    noLoad: !isIntersecting,
    forcePreview: forceLoadPreview,
    play: isIntersecting,
    forceAlways: true,
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('AnimatedEmoji media-inner', sticker?.id === _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.LIKE_STICKER_ID && 'like-sticker-thumb'),
    style: style,
    onClick: handleClick
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  emoji,
  withEffects
}) => {
  return {
    sticker: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmoji)(global, emoji),
    effect: withEffects ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmojiEffect)(global, emoji) : undefined,
    soundId: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectAnimatedEmojiSound)(global, emoji)
  };
})(AnimatedEmoji)));

/***/ },

/***/ "./src/components/middle/message/BaseStory.module.scss"
/*!*************************************************************!*\
  !*** ./src/components/middle/message/BaseStory.module.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"EVLTkrt1","preview":"V3HabdKr","linkPreview":"ClGe8yij","media":"WAItYc5d","nonInteractive":"AQWPv0bP","expired":"tprkr7qf","expiredIcon":"nLA7VEhv"});

/***/ },

/***/ "./src/components/middle/message/BaseStory.tsx"
/*!*****************************************************!*\
  !*** ./src/components/middle/message/BaseStory.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useCanvasBlur__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useCanvasBlur */ "./src/hooks/useCanvasBlur.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useShowTransitionDeprecated */ "./src/hooks/useShowTransitionDeprecated.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _story_mediaArea_MediaAreaOverlay__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../story/mediaArea/MediaAreaOverlay */ "./src/components/story/mediaArea/MediaAreaOverlay.tsx");
/* harmony import */ var _BaseStory_module_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./BaseStory.module.scss */ "./src/components/middle/message/BaseStory.module.scss");

















function BaseStory({
  story,
  isPreview,
  isProtected,
  isConnected
}) {
  const {
    openStoryViewer,
    loadPeerStoriesByIds,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isExpired = story && 'isDeleted' in story;
  const isLoaded = story && 'content' in story;
  const video = isLoaded ? story.content.video : undefined;
  const imageHash = isLoaded ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryMediaHash)(story) : undefined;
  const imgBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__["default"])(imageHash);
  const thumbnail = isLoaded ? video ? video.thumbnail?.dataUri : story.content.photo?.thumbnail?.dataUri : undefined;
  const mediaUrl = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_8__["default"])(imgBlobUrl, true);
  const {
    shouldRender,
    transitionClassNames
  } = (0,_hooks_useShowTransitionDeprecated__WEBPACK_IMPORTED_MODULE_12__["default"])(Boolean(mediaUrl));
  const blurredBackgroundRef = (0,_hooks_useCanvasBlur__WEBPACK_IMPORTED_MODULE_7__["default"])(thumbnail, isExpired && !isPreview, isMobile && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_CANVAS_FILTER_SUPPORTED);
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_BaseStory_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].root, 'media-inner', (!isConnected || isExpired) && _BaseStory_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].nonInteractive, isExpired && _BaseStory_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].expired, isPreview && _BaseStory_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].preview);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (story && !(isLoaded || isExpired)) {
      loadPeerStoriesByIds({
        peerId: story.peerId,
        storyIds: [story.id]
      });
    }
  }, [story, isExpired, isLoaded]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (isExpired) {
      showNotification({
        message: lang('StoryNotFound')
      });
      return;
    }
    openStoryViewer({
      peerId: story.peerId,
      storyId: story.id,
      isSinglePeer: true,
      isSingleStory: true
    });
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: fullClassName,
    onClick: isConnected ? handleClick : undefined
  }, !isExpired && isPreview && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: blurredBackgroundRef,
    className: "thumbnail blurred-bg"
  }), shouldRender && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: mediaUrl,
    alt: "",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_BaseStory_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].media, isPreview && _BaseStory_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].linkPreview, transitionClassNames),
    draggable: false
  }), isLoaded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_story_mediaArea_MediaAreaOverlay__WEBPACK_IMPORTED_MODULE_14__["default"], {
    story: story,
    className: transitionClassNames
  })), isExpired && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: "story-expired",
    className: _BaseStory_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].expiredIcon
  }), lang('StoryExpiredSubtitle')), Boolean(video?.duration) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-media-duration"
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatMediaDuration)(video.duration)), isProtected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(BaseStory));

/***/ },

/***/ "./src/components/middle/message/CommentButton.scss"
/*!**********************************************************!*\
  !*** ./src/components/middle/message/CommentButton.scss ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/CommentButton.tsx"
/*!*********************************************************!*\
  !*** ./src/components/middle/message/CommentButton.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../right/hooks/useAsyncRendering */ "./src/components/right/hooks/useAsyncRendering.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _CommentButton_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./CommentButton.scss */ "./src/components/middle/message/CommentButton.scss");















const SHOW_LOADER_DELAY = 450;
const CommentButton = ({
  isCustomShape,
  threadInfo,
  disabled,
  isLoading,
  asActionButton
}) => {
  const {
    openThread,
    openFrozenAccountModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const shouldRenderLoading = (0,_right_hooks_useAsyncRendering__WEBPACK_IMPORTED_MODULE_8__["default"])([isLoading], SHOW_LOADER_DELAY);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const {
    originMessageId,
    chatId,
    messagesCount,
    lastMessageId,
    lastReadInboxMessageId,
    recentReplierIds,
    originChannelId
  } = threadInfo;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    if ((0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsCurrentUserFrozen)(global)) {
      openFrozenAccountModal();
      return;
    }
    openThread({
      isComments: true,
      chatId,
      originMessageId,
      originChannelId
    });
  });
  const recentRepliers = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!recentReplierIds?.length) {
      return undefined;
    }

    // No need for expensive global updates on chats and users, so we avoid them
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return recentReplierIds.map(peerId => {
      return (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeer)(global, peerId);
    }).filter(Boolean);
  }, [recentReplierIds]);
  if (messagesCount === undefined) {
    return undefined;
  }
  function renderRecentRepliers() {
    return Boolean(recentRepliers?.length) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "recent-repliers",
      dir: oldLang.isRtl ? 'rtl' : 'ltr'
    }, recentRepliers.map(peer => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
      key: peer.id,
      size: "small",
      peer: peer
    })));
  }
  const hasUnread = Boolean(lastReadInboxMessageId && lastMessageId && lastReadInboxMessageId < lastMessageId);
  const commentsText = messagesCount ? oldLang('CommentsCount', '%COMMENTS_COUNT%', undefined, messagesCount).split('%').map(s => {
    return s === 'COMMENTS_COUNT' ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_9__["default"], {
      text: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_4__.formatIntegerCompact)(lang, messagesCount)
    }) : s;
  }) : undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    "data-cnt": (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_4__.formatIntegerCompact)(lang, messagesCount),
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('CommentButton', hasUnread && 'has-unread', disabled && 'disabled', isCustomShape && 'CommentButton-custom-shape', isLoading && 'loading', asActionButton && 'as-action-button'),
    dir: oldLang.isRtl ? 'rtl' : 'ltr',
    onClick: handleClick,
    role: "button",
    tabIndex: 0
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "comments-sticker",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('CommentButton_icon-comments', isLoading && shouldRenderLoading && 'CommentButton_hidden')
  }), !recentRepliers?.length && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "comments"
  }), renderRecentRepliers(), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "label",
    dir: "auto"
  }, messagesCount ? commentsText : oldLang('LeaveAComment')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "CommentButton_right"
  }, isLoading && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_12__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('CommentButton_loading', !shouldRenderLoading && 'CommentButton_hidden'),
    color: isCustomShape ? 'white' : 'blue'
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "next",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('CommentButton_icon-open', isLoading && shouldRenderLoading && 'CommentButton_hidden')
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(CommentButton));

/***/ },

/***/ "./src/components/middle/message/Contact.module.scss"
/*!***********************************************************!*\
  !*** ./src/components/middle/message/Contact.module.scss ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"AAHWWWvU","info-container":"tpDpg82n","infoContainer":"tpDpg82n","info":"fpYynE5s","name":"_PNTJc_V","phone":"JP_3wes8","divider":"_OSJcuqH","buttons":"Blui4M4G","button":"ReDHhQHm","disabled":"XAeKpuIZ","emoji-icon-background":"SjZYi3sJ","emojiIconBackground":"SjZYi3sJ"});

/***/ },

/***/ "./src/components/middle/message/Contact.tsx"
/*!***************************************************!*\
  !*** ./src/components/middle/message/Contact.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_phoneNumber__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/phoneNumber */ "./src/util/phoneNumber.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./Contact.module.scss */ "./src/components/middle/message/Contact.module.scss");












const UNREGISTERED_CONTACT_ID = '0';
const Contact = ({
  contact,
  user,
  phoneCodeList,
  noUserColors
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    openChat,
    openAddContactDialog,
    showNotification,
    openChatWithInfo
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    phoneNumber,
    userId
  } = contact;
  const isRegistered = userId !== UNREGISTERED_CONTACT_ID;
  const canAddContact = isRegistered && user && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCanAddContact)(user);
  const handleOpenChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openChat({
      id: userId
    });
  });
  const handleAddContact = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openAddContactDialog({
      userId: user?.id
    });
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (user) {
      openChatWithInfo({
        id: userId
      });
    } else {
      (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_4__.copyTextToClipboard)(phoneNumber);
      showNotification({
        message: lang('PhoneCopied')
      });
    }
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_9__["default"], {
    noUserColors: noUserColors,
    peer: user,
    emojiIconClassName: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].emojiIconBackground,
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].infoContainer,
    onClick: handleClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_8__["default"], {
    size: "medium",
    peer: user,
    text: getContactName(contact)
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].info
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].name
  }, user ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(user) : getContactName(contact)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].phone
  }, (0,_util_phoneNumber__WEBPACK_IMPORTED_MODULE_5__.formatPhoneNumberWithCode)(phoneCodeList, phoneNumber)))), isRegistered && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].divider
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].buttons
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
    isText: true,
    color: "translucent",
    ripple: true,
    size: "tiny",
    onClick: handleOpenChat,
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].button
  }, lang('SharedContactMessage')), canAddContact && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_10__["default"], {
    isText: true,
    color: "translucent",
    ripple: true,
    size: "tiny",
    onClick: handleAddContact,
    className: _Contact_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].button
  }, lang('SharedContactAdd')))));
};
function getContactName(contact) {
  if (contact.firstName && contact.lastName) {
    return `${contact.firstName} ${contact.lastName}`;
  }
  if (contact.firstName) {
    return contact.firstName;
  }
  if (contact.lastName) {
    return contact.lastName;
  }
  return '';
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  contact
}) => {
  const {
    countryList: {
      phoneCodes: phoneCodeList
    }
  } = global;
  const user = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, contact.userId);
  return {
    user,
    phoneCodeList
  };
})(Contact));

/***/ },

/***/ "./src/components/middle/message/ContextMenuContainer.async.tsx"
/*!**********************************************************************!*\
  !*** ./src/components/middle/message/ContextMenuContainer.async.tsx ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/moduleLoader */ "./src/util/moduleLoader.ts");
/* harmony import */ var _hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useModuleLoader */ "./src/hooks/useModuleLoader.ts");



const ContextMenuContainerAsync = props => {
  const {
    isOpen
  } = props;
  const ContextMenuContainer = (0,_hooks_useModuleLoader__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_moduleLoader__WEBPACK_IMPORTED_MODULE_1__.Bundles.Extra, 'ContextMenuContainer', !isOpen);
  return ContextMenuContainer ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(ContextMenuContainer, props) : undefined;
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ContextMenuContainerAsync);

/***/ },

/***/ "./src/components/middle/message/FactCheck.module.scss"
/*!*************************************************************!*\
  !*** ./src/components/middle/message/FactCheck.module.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"HMB5LgeX","title":"vZnCPl3t","content":"k_dGolcu","separator":"qRaSs5iA","footnote":"EDmr0wJG","collapsed":"hYzpXwTM","cutoutWrapper":"nfCzKu78","collapseIcon":"mxPizZpR","clickable":"Cj2cLczd"});

/***/ },

/***/ "./src/components/middle/message/FactCheck.tsx"
/*!*****************************************************!*\
  !*** ./src/components/middle/message/FactCheck.tsx ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_element_useCollapsibleLines__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/element/useCollapsibleLines */ "./src/hooks/element/useCollapsibleLines.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _ui_Separator__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/Separator */ "./src/components/ui/Separator.tsx");
/* harmony import */ var _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./FactCheck.module.scss */ "./src/components/middle/message/FactCheck.module.scss");











const COLOR = {
  color: 0
};
const MAX_LINES = 4;
const FactCheck = ({
  factCheck,
  isToggleDisabled
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const cutoutRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isCollapsed,
    isCollapsible,
    setIsCollapsed
  } = (0,_hooks_element_useCollapsibleLines__WEBPACK_IMPORTED_MODULE_3__["default"])(ref, MAX_LINES, cutoutRef);
  const countryLocalized = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!factCheck.countryCode || !lang.code) return undefined;
    const displayNames = new Intl.DisplayNames([lang.code], {
      type: 'region'
    });
    return displayNames.of(factCheck.countryCode);
  }, [factCheck.countryCode, lang.code]);
  const canExpand = !isToggleDisabled && isCollapsed;
  const handleExpand = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    setIsCollapsed(false);
  });
  const handleToggle = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    setIsCollapsed(prev => !prev);
  });
  if (!factCheck.text) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_7__["default"], {
    peerColor: COLOR,
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root,
    onClick: canExpand ? handleExpand : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: cutoutRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].cutoutWrapper, isCollapsed && _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].collapsed)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].title
  }, lang('FactCheck')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].content
  }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__.renderTextWithEntities)({
    text: factCheck.text.text,
    entities: factCheck.text.entities
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Separator__WEBPACK_IMPORTED_MODULE_8__["default"], {
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].separator
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].footnote
  }, lang('FactCheckFooter', countryLocalized))), isCollapsible && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].collapseIcon, !isToggleDisabled && _FactCheck_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].clickable),
    onClick: !isToggleDisabled ? handleToggle : undefined,
    "aria-hidden": true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
    name: isCollapsed ? 'down' : 'up'
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(FactCheck));

/***/ },

/***/ "./src/components/middle/message/Game.scss"
/*!*************************************************!*\
  !*** ./src/components/middle/message/Game.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/Game.tsx"
/*!************************************************!*\
  !*** ./src/components/middle/message/Game.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _Game_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Game.scss */ "./src/components/middle/message/Game.scss");







const DEFAULT_PREVIEW_DIMENSIONS = {
  width: 480,
  height: 270
};
const Game = ({
  message,
  canAutoLoadMedia
}) => {
  const {
    clickBotInlineButton
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const game = message.content.game;
  const {
    title,
    description
  } = game;
  const photoHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getGamePreviewPhotoHash)(game);
  const videoHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getGamePreviewVideoHash)(game);
  const photoBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__["default"])(photoHash, !canAutoLoadMedia);
  const videoBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__["default"])(videoHash, !canAutoLoadMedia);
  const handleGameClick = () => {
    clickBotInlineButton({
      chatId: message.chatId,
      messageId: message.id,
      button: message.inlineButtons[0][0]
    });
  };
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "Game"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "preview",
    style: `width: ${DEFAULT_PREVIEW_DIMENSIONS.width}px; height: ${DEFAULT_PREVIEW_DIMENSIONS.height}px`,
    onClick: handleGameClick
  }, !photoBlobUrl && !videoBlobUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_4__["default"], {
    className: "skeleton preview-content"
  }), photoBlobUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: "preview-content",
    src: photoBlobUrl,
    alt: title,
    draggable: false
  }), videoBlobUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("video", {
    className: "preview-content",
    playsInline: true,
    muted: true,
    disablePictureInPicture: true,
    autoPlay: true,
    loop: true,
    src: videoBlobUrl
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "title"
  }, title), !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageText)(message) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "description"
  }, description));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Game));

/***/ },

/***/ "./src/components/middle/message/Giveaway.module.scss"
/*!************************************************************!*\
  !*** ./src/components/middle/message/Giveaway.module.scss ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"CbpKtOey","title":"ogvcv3mr","sticker":"hjjKhvVv","resultSticker":"JEiR48jJ","count":"n_QCMv_A","section":"MSFa9BPf","description":"HfZ6SuLI","peers":"rPyyNYxK","peer":"FV70u896","button":"jMBw7STU","result":"ZQ4aVVkI","separator":"ao0x1YnS"});

/***/ },

/***/ "./src/components/middle/message/Giveaway.tsx"
/*!****************************************************!*\
  !*** ./src/components/middle/message/Giveaway.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_emoji_emoji__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/emoji/emoji */ "./src/util/emoji/emoji.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _common_PeerChip__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/PeerChip */ "./src/components/common/PeerChip.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_Separator__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/Separator */ "./src/components/ui/Separator.tsx");
/* harmony import */ var _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./Giveaway.module.scss */ "./src/components/middle/message/Giveaway.module.scss");






















const NBSP = '\u00A0';
const GIFT_STICKER_SIZE = 175;
const RESULT_STICKER_SIZE = 150;
const Giveaway = ({
  chat,
  sender,
  message,
  canPlayAnimatedEmojis,
  giftSticker
}) => {
  const {
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isLoadingInfo = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const [giveawayInfo, setGiveawayInfo] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const {
    giveaway,
    giveawayResults
  } = message.content;
  const isResults = Boolean(giveawayResults);
  const {
    months,
    untilDate,
    prizeDescription,
    stars
  } = giveaway || giveawayResults;
  const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isOwnMessage)(message);
  const quantity = isResults ? giveawayResults.winnersCount : giveaway.quantity;
  const hasEnded = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_8__.getServerTime)() > untilDate;
  const countryList = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isResults) return undefined;
    const translatedNames = new Intl.DisplayNames([lang.code, 'en'].filter(Boolean), {
      type: 'region'
    });
    return giveaway?.countries?.map(countryCode => `${(0,_util_emoji_emoji__WEBPACK_IMPORTED_MODULE_7__.isoToEmoji)(countryCode)}${NBSP}${translatedNames.of(countryCode)}`).join(', ');
  }, [giveaway, isResults, lang.code]);
  const handlePeerClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(channelId => {
    openChat({
      id: channelId
    });
  });
  const handleShowInfoClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(async () => {
    if (isLoadingInfo.current) return;
    isLoadingInfo.current = true;
    const result = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_9__.callApi)('fetchGiveawayInfo', {
      peer: chat,
      messageId: message.id
    });
    setGiveawayInfo(result);
    isLoadingInfo.current = false;
  });
  const handleCloseInfo = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    setGiveawayInfo(undefined);
  });
  const giveawayInfoTitle = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!giveawayInfo) return undefined;
    return lang(giveawayInfo.type === 'results' ? 'BoostingGiveawayEnd' : 'BoostingGiveAwayAbout');
  }, [giveawayInfo, lang]);
  function renderGiveawayDescription(media) {
    const channelIds = media.channelIds;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].section
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].title
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('BoostingGiveawayPrizes'), ['simple_markdown'])), prizeDescription && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].description
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('BoostingGiveawayMsgPrizes', [quantity, prizeDescription], undefined, quantity), ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Separator__WEBPACK_IMPORTED_MODULE_19__["default"], null, lang('BoostingGiveawayMsgWithDivider'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].description
    }, message?.content?.giveaway?.stars ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('Chat.Giveaway.Message.Stars.PrizeText', lang('Stars', message?.content?.giveaway?.stars)), ['simple_markdown']), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("br", null), (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('AmongWinners', quantity), ['simple_markdown'])) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('Chat.Giveaway.Info.Subscriptions', quantity), ['simple_markdown']), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("br", null), (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('ActionGiftPremiumSubtitle', lang('Chat.Giveaway.Info.Months', months)), ['simple_markdown'])))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].section
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].title
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('BoostingGiveawayMsgParticipants'), ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].description
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('BoostingGiveawayMsgAllSubsPlural', channelIds.length), ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].peers
    }, channelIds.map(peerId => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerChip__WEBPACK_IMPORTED_MODULE_16__["default"], {
      peerId: peerId,
      forceShowSelf: true,
      withPeerColors: !isOwn,
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].peer,
      clickArg: peerId,
      onClick: handlePeerClick
    }))), countryList && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('Chat.Giveaway.Message.CountriesFrom', countryList)))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].section
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].title
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('BoostingWinnersDate'), ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].description
    }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(untilDate * 1000, lang.code, true))));
  }
  function renderGiveawayResultsDescription(media) {
    const winnerIds = media.winnerIds;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].section
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].title
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('BoostingGiveawayResultsMsgWinnersSelected'), ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].description
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lang('BoostingGiveawayResultsMsgWinnersTitle', winnerIds.length), ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("strong", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].title
    }, lang('lng_prizes_results_winners')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].peers
    }, winnerIds.map(peerId => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerChip__WEBPACK_IMPORTED_MODULE_16__["default"], {
      peerId: peerId,
      forceShowSelf: true,
      withPeerColors: !isOwn,
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].peer,
      clickArg: peerId,
      onClick: handlePeerClick
    })))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].section
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].description
    }, lang('BoostingGiveawayResultsMsgAllWinnersReceivedLinks'))));
  }
  function renderGiveawayInfo() {
    if (!sender || !giveawayInfo) return undefined;
    const isResultsInfo = giveawayInfo.type === 'results';
    const chatTitle = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerChat)(sender) ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, sender) : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(sender);
    const endDate = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateAtTime)(lang, untilDate * 1000);
    const otherChannelsCount = giveaway?.channelIds ? giveaway.channelIds.length - 1 : 0;
    const otherChannelsString = lang('Chat.Giveaway.Info.OtherChannels', otherChannelsCount);
    const isSeveral = otherChannelsCount > 0;
    const firstKey = isResultsInfo ? 'BoostingGiveawayHowItWorksTextEnd' : 'BoostingGiveawayHowItWorksText';
    const giveawayDuration = isResultsInfo ? lang('Chat.Giveaway.Info.Months', months) : lang('Stars', stars, 'i');
    const firstParagraph = lang(firstKey, [chatTitle, quantity, giveawayDuration], undefined, quantity);
    const additionalPrizes = prizeDescription ? lang('BoostingGiveawayHowItWorksIncludeText', [chatTitle, quantity, prizeDescription], undefined, quantity) : undefined;
    let secondKey = '';
    if (isResultsInfo) {
      secondKey = isSeveral ? 'BoostingGiveawayHowItWorksSubTextSeveralEnd' : 'BoostingGiveawayHowItWorksSubTextEnd';
    } else {
      secondKey = isSeveral ? 'BoostingGiveawayHowItWorksSubTextSeveral' : 'BoostingGiveawayHowItWorksSubText';
    }
    let secondParagraph = lang(secondKey, [endDate, quantity, chatTitle, otherChannelsCount], undefined, quantity);
    if (isResultsInfo && giveawayInfo.activatedCount) {
      secondParagraph += ` ${lang('BoostingGiveawayUsedLinksPlural', giveawayInfo.activatedCount)}`;
    }
    let result = '';
    if (isResultsInfo) {
      if (giveawayInfo.isRefunded) {
        result = lang('BoostingGiveawayCanceledByPayment');
      } else {
        result = lang(giveawayInfo.isWinner ? 'BoostingGiveawayYouWon' : 'BoostingGiveawayYouNotWon');
      }
    }
    let lastParagraph = '';
    if (isResultsInfo) {
      // Nothing
    } else if (giveawayInfo.disallowedCountry) {
      lastParagraph = lang('BoostingGiveawayNotEligibleCountry');
    } else if (giveawayInfo.adminDisallowedChatId) {
      // Since rerenders are not expected, we can use the global state directly
      const chatsById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().chats.byId;
      const disallowedChat = chatsById[giveawayInfo.adminDisallowedChatId];
      const disallowedChatTitle = disallowedChat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(lang, disallowedChat);
      lastParagraph = lang('BoostingGiveawayNotEligibleAdmin', disallowedChatTitle);
    } else if (giveawayInfo.joinedTooEarlyDate) {
      const joinedTooEarlyDate = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateAtTime)(lang, giveawayInfo.joinedTooEarlyDate * 1000);
      lastParagraph = lang('BoostingGiveawayNotEligible', joinedTooEarlyDate);
    } else if (giveawayInfo.isParticipating) {
      lastParagraph = isSeveral ? lang('Chat.Giveaway.Info.ParticipatingMany', [chatTitle, otherChannelsCount]) : lang('Chat.Giveaway.Info.Participating', chatTitle);
    } else {
      lastParagraph = isSeveral ? lang('Chat.Giveaway.Info.NotQualifiedMany', [chatTitle, otherChannelsString, endDate]) : lang('Chat.Giveaway.Info.NotQualified', [chatTitle, endDate]);
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, result && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].result
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(result, ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(firstParagraph, ['simple_markdown'])), additionalPrizes && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(additionalPrizes, ['simple_markdown'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(secondParagraph, ['simple_markdown'])), lastParagraph && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", null, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_11__["default"])(lastParagraph, ['simple_markdown'])));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].sticker, isResults && _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].resultSticker)
  }, isResults ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_15__["default"], {
    size: RESULT_STICKER_SIZE,
    tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_10__.LOCAL_TGS_URLS.PartyPopper,
    nonInteractive: true,
    noLoop: true
  }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_14__["default"], {
    sticker: giftSticker,
    play: canPlayAnimatedEmojis && hasEnded,
    noLoop: true,
    nonInteractive: true,
    size: GIFT_STICKER_SIZE
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].count
  }, `x${quantity}`)), isResults ? renderGiveawayResultsDescription(giveawayResults) : renderGiveawayDescription(giveaway), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_17__["default"], {
    className: _Giveaway_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].button,
    color: "adaptive",
    size: "smaller",
    onClick: handleShowInfoClick
  }, lang('BoostingHowItWork')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_18__["default"], {
    isOpen: Boolean(giveawayInfo),
    isOnlyConfirm: true,
    title: giveawayInfoTitle,
    confirmHandler: handleCloseInfo,
    onClose: handleCloseInfo
  }, renderGiveawayInfo()));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  message
}) => {
  const {
    giveaway
  } = message.content;
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, message.chatId);
  const sender = (giveaway?.channelIds[0] ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, giveaway.channelIds[0]) : undefined) || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectForwardedSender)(global, message) || chat;
  const sticker = giveaway && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectGiftStickerForDuration)(global, giveaway.months);
  return {
    chat,
    sender,
    giftSticker: sticker,
    canPlayAnimatedEmojis: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanPlayAnimatedEmojis)(global)
  };
})(Giveaway)));

/***/ },

/***/ "./src/components/middle/message/InlineButtons.scss"
/*!**********************************************************!*\
  !*** ./src/components/middle/message/InlineButtons.scss ***!
  \**********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/InlineButtons.tsx"
/*!*********************************************************!*\
  !*** ./src/components/middle/message/InlineButtons.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../composer/helpers/renderKeyboardButtonText */ "./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _InlineButtons_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./InlineButtons.scss */ "./src/components/middle/message/InlineButtons.scss");








const InlineButtons = ({
  message,
  onClick
}) => {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const renderIcon = button => {
    const {
      type
    } = button;
    switch (type) {
      case 'url':
        {
          if (!_config__WEBPACK_IMPORTED_MODULE_1__.RE_TME_LINK.test(button.url)) {
            return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
              className: "corner-icon",
              name: "arrow-right"
            });
          }
          break;
        }
      case 'urlAuth':
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "arrow-right"
        });
      case 'buy':
      case 'receipt':
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "card"
        });
      case 'switchBotInline':
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "share-filled"
        });
      case 'webView':
      case 'simpleWebView':
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "webapp"
        });
      case 'copy':
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
          className: "corner-icon",
          name: "copy"
        });
      case 'suggestedMessage':
        if (button.buttonType === 'suggestChanges') {
          return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
            className: "left-icon",
            name: "edit"
          });
        }
        if (button.buttonType === 'approve') {
          return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
            className: "left-icon",
            name: "check"
          });
        }
        if (button.buttonType === 'decline') {
          return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
            className: "left-icon",
            name: "close"
          });
        }
        break;
    }
    return undefined;
  };
  const buttonTexts = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const texts = [];
    message.inlineButtons.forEach(row => {
      texts.push(row.map(button => (0,_composer_helpers_renderKeyboardButtonText__WEBPACK_IMPORTED_MODULE_2__["default"])(lang, button)));
    });
    return texts;
  }, [lang, message.inlineButtons]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "InlineButtons"
  }, message.inlineButtons.map((row, i) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "row"
  }, row.map((button, j) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_5__["default"], {
    size: "tiny",
    ripple: true,
    disabled: button.type === 'unsupported' || button.type === 'suggestedMessage' && button.disabled,
    onClick: () => onClick({
      chatId: message.chatId,
      messageId: message.id,
      button
    })
  }, renderIcon(button), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "inline-button-text"
  }, buttonTexts[i][j]))))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(InlineButtons));

/***/ },

/***/ "./src/components/middle/message/Invoice.scss"
/*!****************************************************!*\
  !*** ./src/components/middle/message/Invoice.scss ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/Invoice.tsx"
/*!***************************************************!*\
  !*** ./src/components/middle/message/Invoice.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_getCustomAppendixBg__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./helpers/getCustomAppendixBg */ "./src/components/middle/message/helpers/getCustomAppendixBg.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./hooks/useBlurredMediaThumbRef */ "./src/components/middle/message/hooks/useBlurredMediaThumbRef.ts");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _Invoice_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./Invoice.scss */ "./src/components/middle/message/Invoice.scss");
















const Invoice = ({
  message,
  shouldAffectAppendix,
  isInSelectMode,
  isSelected,
  theme,
  forcedWidth
}) => {
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const invoice = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageInvoice)(message);
  const {
    title,
    description,
    amount,
    currency,
    isTest,
    photo
  } = invoice;
  const photoUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getWebDocumentHash)(photo));
  const withBlurredBackground = Boolean(forcedWidth);
  const blurredBackgroundRef = (0,_hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_12__["default"])(photoUrl, !withBlurredBackground);
  const messageId = message.id;
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_9__["default"])(([prevShouldAffectAppendix]) => {
    if (!shouldAffectAppendix) {
      if (prevShouldAffectAppendix) {
        ref.current.closest(_config__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_CONTENT_SELECTOR).removeAttribute(_config__WEBPACK_IMPORTED_MODULE_1__.CUSTOM_APPENDIX_ATTRIBUTE);
      }
      return;
    }
    if (photoUrl) {
      const contentEl = ref.current.closest(_config__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_CONTENT_SELECTOR);
      (0,_helpers_getCustomAppendixBg__WEBPACK_IMPORTED_MODULE_7__["default"])(photoUrl, false, messageId, isSelected, theme).then(appendixBg => {
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
          contentEl.style.setProperty('--appendix-bg', appendixBg);
          contentEl.setAttribute(_config__WEBPACK_IMPORTED_MODULE_1__.CUSTOM_APPENDIX_ATTRIBUTE, '');
        });
      });
    }
  }, [shouldAffectAppendix, photoUrl, isInSelectMode, isSelected, theme, messageId]);
  const width = forcedWidth || photo?.dimensions?.width;
  const style = (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(photo?.dimensions && `width: ${width}px`, photo?.dimensions && `aspect-ratio: ${photo.dimensions.width} / ${photo.dimensions.height}`, Boolean(!photo?.dimensions && forcedWidth) && `width: ${forcedWidth}px`);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: "Invoice"
  }, title && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "title"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(title)), description && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "info"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(description, ['emoji', 'br'])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: `description ${photo ? 'has-image' : ''}`
  }, Boolean(photo) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "invoice-image-container"
  }, withBlurredBackground && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: blurredBackgroundRef,
    className: "thumbnail blurred-bg"
  }), photoUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    className: "invoice-image",
    src: photoUrl,
    alt: "",
    style: style,
    crossOrigin: "anonymous",
    draggable: false
  }), !photoUrl && photo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_13__["default"], {
    width: width,
    height: photo.dimensions?.height,
    forceAspectRatio: true
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "description-text"
  }, (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__.formatCurrency)(lang, amount, currency, {
    iconClassName: 'invoice-currency-icon'
  }), isTest && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "test-invoice"
  }, oldLang('PaymentTestInvoice')))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Invoice));

/***/ },

/***/ "./src/components/middle/message/InvoiceMediaPreview.module.scss"
/*!***********************************************************************!*\
  !*** ./src/components/middle/message/InvoiceMediaPreview.module.scss ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"dCK8GQ_8","duration":"CWT8ZMwV","buy":"C38zhCDM","spoiler":"CG55VZP1"});

/***/ },

/***/ "./src/components/middle/message/InvoiceMediaPreview.tsx"
/*!***************************************************************!*\
  !*** ./src/components/middle/message/InvoiceMediaPreview.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./InvoiceMediaPreview.module.scss */ "./src/components/middle/message/InvoiceMediaPreview.module.scss");













const POLLING_INTERVAL = 30000;
const InvoiceMediaPreview = ({
  message,
  isConnected
}) => {
  const {
    openInvoice,
    loadExtendedMedia
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const invoice = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMessageInvoice)(message);
  const {
    chatId,
    id
  } = message;
  const refreshExtendedMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    loadExtendedMedia({
      chatId,
      ids: [id]
    });
  });
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_6__["default"])(refreshExtendedMedia, isConnected ? POLLING_INTERVAL : undefined);
  const {
    amount,
    currency,
    extendedMedia
  } = invoice;
  const {
    width,
    height,
    thumbnail,
    duration
  } = extendedMedia;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openInvoice({
      type: 'message',
      chatId,
      messageId: id,
      isExtendedMedia: true
    });
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root, 'media-inner'),
    onClick: handleClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_10__["default"], {
    thumbDataUri: thumbnail?.dataUri,
    width: width,
    height: height,
    isVisible: true,
    className: _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].spoiler
  }), Boolean(duration) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].duration
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatMediaDuration)(duration)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].buy
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
    name: "lock",
    className: _InvoiceMediaPreview_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].lock
  }), lang('Checkout.PayPrice', (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__.formatCurrencyAsString)(amount, currency))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(InvoiceMediaPreview));

/***/ },

/***/ "./src/components/middle/message/Location.scss"
/*!*****************************************************!*\
  !*** ./src/components/middle/message/Location.scss ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/Location.tsx"
/*!****************************************************!*\
  !*** ./src/components/middle/message/Location.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_map__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/map */ "./src/util/map.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/schedulers/useTimeout */ "./src/hooks/schedulers/useTimeout.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/window/useDevicePixelRatio */ "./src/hooks/window/useDevicePixelRatio.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/placeholder/Skeleton */ "./src/components/ui/placeholder/Skeleton.tsx");
/* harmony import */ var _Location_scss__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./Location.scss */ "./src/components/middle/message/Location.scss");
/* harmony import */ var _assets_map_pin_svg__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../assets/map-pin.svg */ "./src/assets/map-pin.svg");





















const TIMER_RADIUS = 12;
const TIMER_CIRCUMFERENCE = TIMER_RADIUS * 2 * Math.PI;
const MOVE_THRESHOLD = 0.0001; // ~11m
const DEFAULT_MAP_CONFIG = {
  width: 400,
  height: 300,
  zoom: 16
};
const Location = ({
  message,
  peer
}) => {
  const {
    openMapModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const countdownRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const location = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageLocation)(message);
  const {
    mediaType,
    geo
  } = location;
  const serverTime = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)();
  const isExpired = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isGeoLiveExpired)(message);
  const secondsBeforeEnd = mediaType === 'geoLive' && !isExpired ? message.date + location.period - serverTime : undefined;
  const [point, setPoint] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(geo);
  const shouldRenderText = mediaType === 'venue' || mediaType === 'geoLive' && !isExpired;
  const {
    width,
    height,
    zoom
  } = DEFAULT_MAP_CONFIG;
  const dpr = (0,_hooks_window_useDevicePixelRatio__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const mediaHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.buildStaticMapHash)(point, width, height, zoom, dpr);
  const mediaBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_12__["default"])(mediaHash);
  const prevMediaBlobUrl = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_14__["default"])(mediaBlobUrl, true);
  const mapBlobUrl = mediaBlobUrl || prevMediaBlobUrl;
  const accuracyRadiusPx = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (mediaType !== 'geoLive' || !point.accuracyRadius) {
      return 0;
    }
    const {
      lat,
      accuracyRadius
    } = point;
    return accuracyRadius / (0,_util_map__WEBPACK_IMPORTED_MODULE_6__.getMetersPerPixel)(lat, zoom);
  }, [mediaType, point, zoom]);
  const handleClick = () => {
    openMapModal({
      geoPoint: point,
      zoom
    });
  };
  const updateCountdown = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(countdownEl => {
    if (mediaType !== 'geoLive') return;
    const svgEl = countdownEl.lastElementChild;
    const timerEl = countdownEl.firstElementChild;
    const timeLeft = message.date + location.period - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_7__.getServerTime)();
    const strokeDashOffset = (1 - timeLeft / location.period) * TIMER_CIRCUMFERENCE;
    const text = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatCountdownShort)(lang, timeLeft * 1000);
    timerEl.textContent = text;
    svgEl.firstElementChild.setAttribute('stroke-dashoffset', `-${strokeDashOffset}`);
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (countdownRef.current) {
      updateCountdown(countdownRef.current);
    }
  }, [updateCountdown]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    // Prevent map refetching for slight location changes
    if (Math.abs(geo.lat - point.lat) < MOVE_THRESHOLD && Math.abs(geo.long - point.long) < MOVE_THRESHOLD) {
      if (point.accuracyRadius !== geo.accuracyRadius) {
        setPoint({
          ...point,
          accuracyRadius: geo.accuracyRadius
        });
      }
      return;
    }
    setPoint(geo);
  }, [geo, point]);
  (0,_hooks_schedulers_useTimeout__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    forceUpdate();
  }, !isExpired ? (secondsBeforeEnd || 0) * 1000 : undefined);
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
      const countdownEl = countdownRef.current;
      if (countdownEl) {
        updateCountdown(countdownEl);
      }
    });
  }, secondsBeforeEnd ? 1000 : undefined);
  function renderInfo() {
    if (!shouldRenderText) return undefined;
    if (mediaType === 'venue') {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info"
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info-title"
      }, location.title), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info-subtitle"
      }, location.address));
    }
    if (mediaType === 'geoLive') {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info"
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info-title"
      }, lang('AttachLiveLocation')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "location-info-subtitle"
      }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatLocationLastUpdate)(lang, serverTime, message.editDate)), !isExpired && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "geo-countdown",
        ref: countdownRef
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: "geo-countdown-text"
      }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
        width: "32px",
        height: "32px"
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("circle", {
        cx: "16",
        cy: "16",
        r: TIMER_RADIUS,
        className: "geo-countdown-progress",
        transform: "rotate(-90, 16, 16)",
        "stroke-dasharray": TIMER_CIRCUMFERENCE,
        "stroke-dashoffset": "0"
      }))));
    }
    return undefined;
  }
  function renderMap() {
    if (!mapBlobUrl) return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_placeholder_Skeleton__WEBPACK_IMPORTED_MODULE_17__["default"], {
      width: width,
      height: height
    });
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: "full-media map",
      src: mapBlobUrl,
      alt: "Location on a map",
      draggable: false,
      style: `width: ${DEFAULT_MAP_CONFIG.width}px; height: ${DEFAULT_MAP_CONFIG.height}px;`
    });
  }
  function renderPin() {
    const pinClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('pin', mediaType, isExpired && 'expired');
    if (mediaType === 'geoLive') {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: pinClassName
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PinSvg, null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_16__["default"], {
        peer: peer,
        className: "location-avatar"
      }), location.heading !== undefined && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
        className: "direction",
        style: `--direction: ${location.heading}deg`
      }));
    }
    if (mediaType === 'venue') {
      const color = (0,_util_map__WEBPACK_IMPORTED_MODULE_6__.getVenueColor)(location.venueType);
      const iconSrc = (0,_util_map__WEBPACK_IMPORTED_MODULE_6__.getVenueIconUrl)(location.venueType);
      if (iconSrc) {
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
          className: pinClassName,
          style: `--pin-color: ${color}`
        }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(PinSvg, null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
          src: iconSrc,
          draggable: false,
          className: "venue-icon",
          alt: ""
        }));
      }
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
      className: pinClassName,
      draggable: false,
      src: _assets_map_pin_svg__WEBPACK_IMPORTED_MODULE_19__,
      alt: ""
    });
  }
  function renderOverlay() {
    if (!mapBlobUrl) return undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, Boolean(accuracyRadiusPx) && !isExpired && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "location-accuracy",
      style: `width: ${accuracyRadiusPx * 2}px; height: ${accuracyRadiusPx * 2}px`
    }), renderPin());
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: "Location media-inner interactive",
    onClick: handleClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "map-wrapper"
  }, renderMap(), renderOverlay()), renderInfo());
};
function PinSvg() {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    className: "round-pin",
    style: "enable-background:new 0 0 64 64",
    viewBox: "0 0 64 64"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("circle", {
    cx: "32",
    cy: "32",
    r: "24.5"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "M32 8c13.23 0 24 10.77 24 24S45.23 56 32 56 8 45.23 8 32 18.77 8 32 8m0-1C18.19 7 7 18.19 7 32s11.19 25 25 25 25-11.19 25-25S45.81 7 32 7z"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "m29.38 57.67-1.98-1.59 3.02-1.66L32 51.54l1.58 2.88 3.02 1.66-1.91 1.53L32 60.73z"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "m32 52.58 1.07 1.95.14.26.26.14 2.24 1.22-1.33 1.06-.07.06-.06.07L32 59.96l-2.24-2.61-.06-.07-.07-.06-1.33-1.06 2.24-1.22.26-.14.14-.26L32 52.58m0-2.08-1.94 3.56L26.5 56l2.5 2 3 3.5 3-3.5 2.5-2-3.56-1.94L32 50.5z"
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Location));

/***/ },

/***/ "./src/components/middle/message/Message.scss"
/*!****************************************************!*\
  !*** ./src/components/middle/message/Message.scss ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/Message.tsx"
/*!***************************************************!*\
  !*** ./src/components/middle/message/Message.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_helpers_replies__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../global/helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _global_selectors_media__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../global/selectors/media */ "./src/global/selectors/media.ts");
/* harmony import */ var _global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../global/selectors/sharedState */ "./src/global/selectors/sharedState.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _util_visibility_isElementInViewport__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../util/visibility/isElementInViewport */ "./src/util/visibility/isElementInViewport.ts");
/* harmony import */ var _chatAssistant_component_message_gpt_menu__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../chatAssistant/component/message-gpt-menu */ "./src/components/chatAssistant/component/message-gpt-menu.tsx");
/* harmony import */ var _chatAssistant_hook_useMessageGptMenuHandlers__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../chatAssistant/hook/useMessageGptMenuHandlers */ "./src/components/chatAssistant/hook/useMessageGptMenuHandlers.tsx");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _common_helpers_peerColor__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../common/helpers/peerColor */ "./src/components/common/helpers/peerColor.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../composer/helpers/customEmoji */ "./src/components/middle/composer/helpers/customEmoji.ts");
/* harmony import */ var _helpers_buildContentClassName__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./helpers/buildContentClassName */ "./src/components/middle/message/helpers/buildContentClassName.ts");
/* harmony import */ var _helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./helpers/calculateAlbumLayout */ "./src/components/middle/message/helpers/calculateAlbumLayout.ts");
/* harmony import */ var _helpers_getSingularPaidMedia__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./helpers/getSingularPaidMedia */ "./src/components/middle/message/helpers/getSingularPaidMedia.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/middle/message/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../../hooks/useEnsureMessage */ "./src/hooks/useEnsureMessage.ts");
/* harmony import */ var _hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../../../hooks/useEnsureStory */ "./src/hooks/useEnsureStory.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useResizeMessageObserver__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ../../../hooks/useResizeMessageObserver */ "./src/hooks/useResizeMessageObserver.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useTextLanguage__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ../../../hooks/useTextLanguage */ "./src/hooks/useTextLanguage.ts");
/* harmony import */ var _hooks_useDetectChatLanguage__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./hooks/useDetectChatLanguage */ "./src/components/middle/message/hooks/useDetectChatLanguage.ts");
/* harmony import */ var _hooks_useFocusMessage__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./hooks/useFocusMessage */ "./src/components/middle/message/hooks/useFocusMessage.ts");
/* harmony import */ var _hooks_useInnerHandlers__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./hooks/useInnerHandlers */ "./src/components/middle/message/hooks/useInnerHandlers.ts");
/* harmony import */ var _hooks_useMessageTranslation__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./hooks/useMessageTranslation */ "./src/components/middle/message/hooks/useMessageTranslation.ts");
/* harmony import */ var _hooks_useOuterHandlers__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./hooks/useOuterHandlers */ "./src/components/middle/message/hooks/useOuterHandlers.ts");
/* harmony import */ var _common_Audio__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ../../common/Audio */ "./src/components/common/Audio.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _common_Document__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ../../common/Document */ "./src/components/common/Document.tsx");
/* harmony import */ var _common_DotAnimation__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! ../../common/DotAnimation */ "./src/components/common/DotAnimation.tsx");
/* harmony import */ var _common_embedded_EmbeddedMessage__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! ../../common/embedded/EmbeddedMessage */ "./src/components/common/embedded/EmbeddedMessage.tsx");
/* harmony import */ var _common_embedded_EmbeddedStory__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! ../../common/embedded/EmbeddedStory */ "./src/components/common/embedded/EmbeddedStory.tsx");
/* harmony import */ var _common_FakeIcon__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! ../../common/FakeIcon */ "./src/components/common/FakeIcon.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_MessageText__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! ../../common/MessageText */ "./src/components/common/MessageText.tsx");
/* harmony import */ var _common_reactions_ReactionStaticEmoji__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! ../../common/reactions/ReactionStaticEmoji */ "./src/components/common/reactions/ReactionStaticEmoji.tsx");
/* harmony import */ var _common_TopicChip__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! ../../common/TopicChip */ "./src/components/common/TopicChip.tsx");
/* harmony import */ var _main_visualEffects_SnapEffectContainer__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! ../../main/visualEffects/SnapEffectContainer */ "./src/components/main/visualEffects/SnapEffectContainer.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! ../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_InputText__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! ../../ui/InputText */ "./src/components/ui/InputText.tsx");
/* harmony import */ var _Album__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! ./Album */ "./src/components/middle/message/Album.tsx");
/* harmony import */ var _AnimatedCustomEmoji__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! ./AnimatedCustomEmoji */ "./src/components/middle/message/AnimatedCustomEmoji.tsx");
/* harmony import */ var _AnimatedEmoji__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(/*! ./AnimatedEmoji */ "./src/components/middle/message/AnimatedEmoji.tsx");
/* harmony import */ var _CommentButton__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(/*! ./CommentButton */ "./src/components/middle/message/CommentButton.tsx");
/* harmony import */ var _Contact__WEBPACK_IMPORTED_MODULE_67__ = __webpack_require__(/*! ./Contact */ "./src/components/middle/message/Contact.tsx");
/* harmony import */ var _ContextMenuContainer_async__WEBPACK_IMPORTED_MODULE_68__ = __webpack_require__(/*! ./ContextMenuContainer.async */ "./src/components/middle/message/ContextMenuContainer.async.tsx");
/* harmony import */ var _FactCheck__WEBPACK_IMPORTED_MODULE_69__ = __webpack_require__(/*! ./FactCheck */ "./src/components/middle/message/FactCheck.tsx");
/* harmony import */ var _Game__WEBPACK_IMPORTED_MODULE_70__ = __webpack_require__(/*! ./Game */ "./src/components/middle/message/Game.tsx");
/* harmony import */ var _Giveaway__WEBPACK_IMPORTED_MODULE_71__ = __webpack_require__(/*! ./Giveaway */ "./src/components/middle/message/Giveaway.tsx");
/* harmony import */ var _InlineButtons__WEBPACK_IMPORTED_MODULE_72__ = __webpack_require__(/*! ./InlineButtons */ "./src/components/middle/message/InlineButtons.tsx");
/* harmony import */ var _Invoice__WEBPACK_IMPORTED_MODULE_73__ = __webpack_require__(/*! ./Invoice */ "./src/components/middle/message/Invoice.tsx");
/* harmony import */ var _InvoiceMediaPreview__WEBPACK_IMPORTED_MODULE_74__ = __webpack_require__(/*! ./InvoiceMediaPreview */ "./src/components/middle/message/InvoiceMediaPreview.tsx");
/* harmony import */ var _Location__WEBPACK_IMPORTED_MODULE_75__ = __webpack_require__(/*! ./Location */ "./src/components/middle/message/Location.tsx");
/* harmony import */ var _MessageAppendix__WEBPACK_IMPORTED_MODULE_76__ = __webpack_require__(/*! ./MessageAppendix */ "./src/components/middle/message/MessageAppendix.tsx");
/* harmony import */ var _MessageEffect__WEBPACK_IMPORTED_MODULE_77__ = __webpack_require__(/*! ./MessageEffect */ "./src/components/middle/message/MessageEffect.tsx");
/* harmony import */ var _MessageMeta__WEBPACK_IMPORTED_MODULE_78__ = __webpack_require__(/*! ./MessageMeta */ "./src/components/middle/message/MessageMeta.tsx");
/* harmony import */ var _MessagePhoneCall__WEBPACK_IMPORTED_MODULE_79__ = __webpack_require__(/*! ./MessagePhoneCall */ "./src/components/middle/message/MessagePhoneCall.tsx");
/* harmony import */ var _PaidMediaOverlay__WEBPACK_IMPORTED_MODULE_80__ = __webpack_require__(/*! ./PaidMediaOverlay */ "./src/components/middle/message/PaidMediaOverlay.tsx");
/* harmony import */ var _Photo__WEBPACK_IMPORTED_MODULE_81__ = __webpack_require__(/*! ./Photo */ "./src/components/middle/message/Photo.tsx");
/* harmony import */ var _Poll__WEBPACK_IMPORTED_MODULE_82__ = __webpack_require__(/*! ./Poll */ "./src/components/middle/message/Poll.tsx");
/* harmony import */ var _reactions_Reactions__WEBPACK_IMPORTED_MODULE_83__ = __webpack_require__(/*! ./reactions/Reactions */ "./src/components/middle/message/reactions/Reactions.tsx");
/* harmony import */ var _RoundVideo__WEBPACK_IMPORTED_MODULE_84__ = __webpack_require__(/*! ./RoundVideo */ "./src/components/middle/message/RoundVideo.tsx");
/* harmony import */ var _Sticker__WEBPACK_IMPORTED_MODULE_85__ = __webpack_require__(/*! ./Sticker */ "./src/components/middle/message/Sticker.tsx");
/* harmony import */ var _Story__WEBPACK_IMPORTED_MODULE_86__ = __webpack_require__(/*! ./Story */ "./src/components/middle/message/Story.tsx");
/* harmony import */ var _StoryMention__WEBPACK_IMPORTED_MODULE_87__ = __webpack_require__(/*! ./StoryMention */ "./src/components/middle/message/StoryMention.tsx");
/* harmony import */ var _TodoList__WEBPACK_IMPORTED_MODULE_88__ = __webpack_require__(/*! ./TodoList */ "./src/components/middle/message/TodoList.tsx");
/* harmony import */ var _Video__WEBPACK_IMPORTED_MODULE_89__ = __webpack_require__(/*! ./Video */ "./src/components/middle/message/Video.tsx");
/* harmony import */ var _WebPage__WEBPACK_IMPORTED_MODULE_90__ = __webpack_require__(/*! ./WebPage */ "./src/components/middle/message/WebPage.tsx");
/* harmony import */ var _Message_scss__WEBPACK_IMPORTED_MODULE_91__ = __webpack_require__(/*! ./Message.scss */ "./src/components/middle/message/Message.scss");





























































































const NBSP = '\u00A0';
const NO_MEDIA_CORNERS_THRESHOLD = 18;
const QUICK_REACTION_SIZE = 1.75 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_20__.REM;
const EXTRA_SPACE_FOR_REACTIONS = 2.25 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_20__.REM;
const MAX_REASON_LENGTH = 200;
const Message = ({
  message,
  observeIntersectionForBottom,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  album,
  noAvatars,
  withAvatar,
  withSenderName,
  noComments,
  noReplies,
  appearanceOrder,
  isJustAdded,
  isFirstInGroup,
  isPremium,
  isLastInGroup,
  isFirstInDocumentGroup,
  isLastInDocumentGroup,
  isTranscribing,
  transcribedText,
  hasTranslation,
  isLastInList,
  theme,
  forceSenderName,
  sender,
  canShowSender,
  originSender,
  botSender,
  isThreadTop,
  shouldHideReply,
  replyMessage,
  replyMessageSender,
  replyMessageForwardSender,
  replyMessageChat,
  replyStory,
  isReplyPrivate,
  storySender,
  outgoingStatus,
  uploadProgress,
  isInDocumentGroup,
  isLoadingComments,
  isProtected,
  isChatProtected,
  isFocused,
  focusDirection,
  focusedQuote,
  focusedQuoteOffset,
  noFocusHighlight,
  scrollTargetPosition,
  isResizingContainer,
  isForwarding,
  isChatWithSelf,
  isRepliesChat,
  isAnonymousForwards,
  isChannel,
  isGroup,
  canReply,
  highlight,
  animatedEmoji,
  animatedCustomEmoji,
  hasActiveReactions,
  hasLinkedChat,
  isInSelectMode,
  isSelected,
  isGroupSelected,
  threadId,
  reactionMessage,
  availableReactions,
  defaultReaction,
  activeEmojiInteractions,
  messageListType,
  isPinnedList,
  isPinned,
  isDownloading,
  canAutoLoadMedia,
  canAutoPlayMedia,
  shouldLoopStickers,
  autoLoadFileMaxSizeMb,
  repliesThreadInfo,
  hasUnreadReaction,
  memoFirstUnreadIdRef,
  senderAdminMember,
  messageTopic,
  hasTopicChip,
  chatTranslations,
  areTranslationsEnabled,
  shouldDetectChatLanguage,
  requestedTranslationLanguage,
  requestedChatTranslationLanguage,
  withAnimatedEffects,
  webPageStory,
  isConnected,
  getIsMessageListReady,
  shouldWarnAboutSvg,
  senderBoosts,
  tags,
  canTranscribeVoice,
  viaBusinessBot,
  effect,
  poll,
  maxTimestamp,
  lastPlaybackTimestamp,
  isMediaNsfw,
  isReplyMediaNsfw,
  paidMessageStars,
  isChatWithUser,
  isAccountFrozen,
  minFutureTime,
  webPage,
  onIntersectPinnedMessage
}) => {
  const {
    toggleMessageSelection,
    clickBotInlineButton,
    clickSuggestedMessageButton,
    rejectSuggestedPost,
    openSuggestedPostApprovalModal,
    disableContextMenuHint,
    animateUnreadReaction,
    focusLastMessage,
    markMentionsRead
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const bottomMarkerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const quickReactionRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const messageContentRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_36__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_34__["default"])();
  const [isTranscriptionHidden, setTranscriptionHidden] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isPlayingSnapAnimation, setIsPlayingSnapAnimation] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isPlayingDeleteAnimation, setIsPlayingDeleteAnimation] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [shouldPlayEffect, requestEffect, hideEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_32__["default"])();
  const [isDeclineDialogOpen, openDeclineDialog, closeDeclineDialog] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_32__["default"])();
  const [declineReason, setDeclineReason] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const {
    isMobile,
    isTouchScreen
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_28__["default"])();
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_33__.useOnIntersect)(bottomMarkerRef, observeIntersectionForBottom);
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    contextMenuTarget,
    handleBeforeContextMenu,
    handleContextMenu: onContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_29__["default"])(ref, isTouchScreen && isInSelectMode || isAccountFrozen, !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__.IS_ELECTRON, _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__.IS_ANDROID, getIsMessageListReady);
  const {
    isGptMenuOpen,
    gptMenuPosition
  } = (0,_chatAssistant_hook_useMessageGptMenuHandlers__WEBPACK_IMPORTED_MODULE_19__["default"])(messageContentRef);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isContextMenuOpen) {
      disableContextMenuHint();
    }
  }, [isContextMenuOpen, disableContextMenuHint]);
  const noAppearanceAnimation = appearanceOrder <= 0;
  const [isShown, markShown] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_32__["default"])(noAppearanceAnimation);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (noAppearanceAnimation) {
      return;
    }
    setTimeout(markShown, appearanceOrder * _config__WEBPACK_IMPORTED_MODULE_4__.MESSAGE_APPEARANCE_DELAY);
  }, [appearanceOrder, markShown, noAppearanceAnimation]);
  (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_39__["default"])({
    ref,
    isOpen: isShown || isJustAdded,
    noMountTransition: noAppearanceAnimation && !isJustAdded,
    className: false
  });
  const {
    id: messageId,
    chatId,
    forwardInfo,
    viaBotId,
    isTranscriptionError,
    factCheck
  } = message;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useUnmountCleanup)(() => {
    if (message.isPinned) {
      const id = album ? album.mainMessage.id : messageId;
      onIntersectPinnedMessage?.({
        viewportPinnedIdsToRemove: [id]
      });
    }
  });
  const isLocal = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isMessageLocal)(message);
  const isOwn = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isOwnMessage)(message);
  const isScheduled = messageListType === 'scheduled' || message.isScheduled;
  const hasMessageReply = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isReplyToMessage)(message) && !shouldHideReply;
  const {
    paidMedia
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageContent)(message);
  const {
    photo: paidMediaPhoto,
    video: paidMediaVideo
  } = (0,_helpers_getSingularPaidMedia__WEBPACK_IMPORTED_MODULE_26__["default"])(paidMedia);
  const {
    photo = paidMediaPhoto,
    video = paidMediaVideo,
    audio,
    voice,
    document,
    sticker,
    contact,
    invoice,
    location,
    action,
    game,
    storyData,
    giveaway,
    giveawayResults,
    todo
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageContent)(message);
  const messageReplyInfo = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_7__.getMessageReplyInfo)(message);
  const storyReplyInfo = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_7__.getStoryReplyInfo)(message);
  const withVoiceTranscription = Boolean(!isTranscriptionHidden && (isTranscriptionError || transcribedText));
  const hasStoryReply = Boolean(storyReplyInfo);
  const hasThread = Boolean(repliesThreadInfo) && messageListType === 'thread';
  const isCustomShape = !withVoiceTranscription && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageCustomShape)(message);
  const hasAnimatedEmoji = isCustomShape && (animatedEmoji || animatedCustomEmoji);
  const hasReactions = reactionMessage?.reactions && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.areReactionsEmpty)(reactionMessage.reactions);
  const asForwarded = forwardInfo && (!isChatWithSelf || isScheduled) && !isRepliesChat && !forwardInfo.isLinkedChannelPost && !isAnonymousForwards && !botSender || Boolean(storyData && !storyData.isMention);
  const canShowSenderBoosts = Boolean(senderBoosts) && !asForwarded && isFirstInGroup;
  const isStoryMention = storyData?.isMention;
  const isRoundVideo = video?.mediaType === 'video' && video.isRound;
  const isAlbum = Boolean(album) && (album.isPaidMedia && paidMedia.extendedMedia.length > 1 || album.messages.length > 1) && !album.messages.some(msg => Object.keys(msg.content).length === 0);
  const isInDocumentGroupNotFirst = isInDocumentGroup && !isFirstInDocumentGroup;
  const isInDocumentGroupNotLast = isInDocumentGroup && !isLastInDocumentGroup;
  const isContextMenuShown = contextMenuAnchor !== undefined;
  const canShowActionButton = !(isContextMenuShown || isInSelectMode || isForwarding) && !isInDocumentGroupNotLast && !isStoryMention && !((sticker || hasAnimatedEmoji) && asForwarded);
  const canForward = isChannel && !isScheduled && message.isForwardingAllowed && !isChatProtected;
  const canFocus = Boolean(isPinnedList || forwardInfo && (forwardInfo.isChannelPost || isChatWithSelf || isRepliesChat || isAnonymousForwards) && forwardInfo.fromMessageId);
  const hasFactCheck = Boolean(factCheck?.text);
  const hasForwardedCustomShape = asForwarded && isCustomShape;
  const hasSubheader = hasTopicChip || hasMessageReply || hasStoryReply || hasForwardedCustomShape;
  const selectMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_35__["default"])((e, groupedId) => {
    if (isAccountFrozen) return;
    toggleMessageSelection({
      messageId,
      groupedId,
      ...(e?.shiftKey && {
        withShift: true
      }),
      ...(isAlbum && {
        childMessageIds: album.messages.map(({
          id
        }) => id)
      })
    });
  });
  const messageSender = canShowSender ? sender : undefined;
  const shouldPreferOriginSender = forwardInfo && (isChatWithSelf || isRepliesChat || isAnonymousForwards || !messageSender);
  const avatarPeer = shouldPreferOriginSender ? originSender : messageSender;
  const messageColorPeer = asForwarded ? originSender : sender;
  const noUserColors = isOwn && !isCustomShape;
  const senderPeer = forwardInfo || storyData ? originSender : messageSender;
  const hasTtl = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.hasMessageTtl)(message);
  const {
    handleMouseDown,
    handleClick,
    handleContextMenu,
    handleDoubleClick,
    handleContentDoubleClick,
    handleMouseMove,
    handleSendQuickReaction,
    handleMouseLeave,
    isSwiped,
    isQuickReactionVisible,
    handleDocumentGroupMouseEnter
  } = (0,_hooks_useOuterHandlers__WEBPACK_IMPORTED_MODULE_45__["default"])(selectMessage, ref, messageId, Boolean(isInSelectMode), Boolean(canReply), Boolean(isProtected), onContextMenu, handleBeforeContextMenu, chatId, isContextMenuShown, quickReactionRef, isInDocumentGroupNotLast, getIsMessageListReady);
  const {
    handleSenderClick,
    handleViaBotClick,
    handleReplyClick,
    handleMediaClick,
    handleDocumentClick,
    handleAudioPlay,
    handleAlbumMediaClick,
    handlePhotoMediaClick,
    handleVideoMediaClick,
    handleMetaClick,
    handleTranslationClick,
    handleOpenThread,
    handleReadMedia,
    handleCancelUpload,
    handleVoteSend,
    handleGroupForward,
    handleForward,
    handleFocus,
    handleFocusForwarded,
    handleDocumentGroupSelectAll,
    handleTopicChipClick,
    handleStoryClick
  } = (0,_hooks_useInnerHandlers__WEBPACK_IMPORTED_MODULE_43__["default"])({
    lang: oldLang,
    selectMessage,
    message,
    webPage,
    chatId,
    threadId,
    isInDocumentGroup,
    asForwarded,
    isScheduled,
    album,
    avatarPeer,
    senderPeer,
    botSender,
    messageTopic,
    isTranslatingChat: Boolean(requestedChatTranslationLanguage),
    story: replyStory && 'content' in replyStory ? replyStory : undefined,
    isReplyPrivate,
    isRepliesChat,
    isSavedMessages: isChatWithSelf,
    lastPlaybackTimestamp
  });
  const handleEffectClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_35__["default"])(e => {
    e.stopPropagation();
    requestEffect();
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isLastInList) {
      return;
    }
    if (withVoiceTranscription && transcribedText) {
      focusLastMessage();
    }
  }, [focusLastMessage, isLastInList, transcribedText, withVoiceTranscription]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const element = ref.current;
    const isPartialAlbumDelete = message.isInAlbum && album?.messages.some(msg => !msg.isDeleting);
    if (message.isDeleting && element && !isPartialAlbumDelete) {
      if ((0,_main_visualEffects_SnapEffectContainer__WEBPACK_IMPORTED_MODULE_59__.animateSnap)(element)) {
        setIsPlayingSnapAnimation(true);
      } else {
        setIsPlayingDeleteAnimation(true);
      }
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps -- Only start animation on `isDeleting` change
  }, [message.isDeleting]);
  const textMessage = album?.hasMultipleCaptions ? undefined : album?.captionMessage || message;
  const hasTextContent = textMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.hasMessageText)(textMessage);
  const hasText = hasTextContent || hasFactCheck;
  const containerClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('Message message-list-item', isFirstInGroup && 'first-in-group', isProtected && 'hide-on-print', isProtected && !hasTextContent ? 'is-protected' : 'allow-selection', isLastInGroup && 'last-in-group', isFirstInDocumentGroup && 'first-in-document-group', isLastInDocumentGroup && 'last-in-document-group', isLastInList && 'last-in-list', isOwn && 'own', Boolean(message.viewsCount) && 'has-views', message.isEdited && 'was-edited', hasMessageReply && 'has-reply', isContextMenuOpen && 'has-menu-open', isFocused && !noFocusHighlight && 'focused', isForwarding && 'is-forwarding', isPlayingDeleteAnimation && 'is-deleting', isPlayingSnapAnimation && 'is-dissolving', isInDocumentGroup && 'is-in-document-group', isAlbum && 'is-album', message.hasUnreadMention && 'has-unread-mention', isSelected && 'is-selected', isInSelectMode && 'is-in-selection-mode', isThreadTop && !withAvatar && 'is-thread-top', Boolean(message.inlineButtons) && 'has-inline-buttons', isSwiped && 'is-swiped', isJustAdded && 'is-just-added', (hasActiveReactions || shouldPlayEffect) && 'has-active-effect', isStoryMention && 'is-story-mention', !canShowActionButton && 'no-action-button');
  const text = textMessage && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageContent)(textMessage).text;
  const isInvertedMedia = Boolean(message.isInvertedMedia);
  const {
    replyToMsgId,
    replyToPeerId
  } = messageReplyInfo || {};
  const {
    peerId: storyReplyPeerId,
    storyId: storyReplyId
  } = storyReplyInfo || {};
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if ((sticker?.hasEffect || effect) && (memoFirstUnreadIdRef?.current && messageId >= memoFirstUnreadIdRef.current || isLocal)) {
      requestEffect();
    }
  }, [effect, isLocal, memoFirstUnreadIdRef, messageId, sticker?.hasEffect]);
  const detectedLanguage = (0,_hooks_useTextLanguage__WEBPACK_IMPORTED_MODULE_40__["default"])(text?.text, !(areTranslationsEnabled && shouldDetectChatLanguage), getIsMessageListReady);
  (0,_hooks_useDetectChatLanguage__WEBPACK_IMPORTED_MODULE_41__["default"])(message, detectedLanguage, !shouldDetectChatLanguage, getIsMessageListReady);
  const shouldTranslate = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isMessageTranslatable)(message, true);
  const {
    isPending: isTranslationPending,
    translatedText
  } = (0,_hooks_useMessageTranslation__WEBPACK_IMPORTED_MODULE_44__["default"])(chatTranslations, chatId, shouldTranslate ? messageId : undefined, requestedTranslationLanguage);
  // Used to display previous result while new one is loading
  const previousTranslatedText = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_37__["default"])(translatedText, Boolean(shouldTranslate));
  const currentTranslatedText = translatedText || previousTranslatedText;
  const phoneCall = action?.type === 'phoneCall' ? action : undefined;
  const isMediaWithCommentButton = (repliesThreadInfo || hasLinkedChat && isChannel && isLocal) && !isInDocumentGroupNotLast && messageListType === 'thread' && !noComments;
  const withCommentButton = repliesThreadInfo?.isCommentsInfo && !isInDocumentGroupNotLast && messageListType === 'thread' && !noComments;
  const withQuickReactionButton = !isTouchScreen && !phoneCall && !isInSelectMode && defaultReaction && !isInDocumentGroupNotLast && !isStoryMention && !hasTtl && !isAccountFrozen;
  const hasOutsideReactions = !withVoiceTranscription && hasReactions && (isCustomShape || (photo || video || storyData || location?.mediaType === 'geo') && !hasText);
  const contentClassName = (0,_helpers_buildContentClassName__WEBPACK_IMPORTED_MODULE_24__.buildContentClassName)(message, album, {
    poll,
    webPage,
    hasSubheader,
    isCustomShape,
    isLastInGroup,
    asForwarded,
    hasThread: hasThread && !noComments,
    forceSenderName,
    hasCommentCounter: hasThread && repliesThreadInfo.messagesCount > 0,
    hasCommentButton: withCommentButton,
    hasActionButton: canForward || canFocus,
    hasReactions,
    isGeoLiveActive: location?.mediaType === 'geoLive' && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isGeoLiveExpired)(message),
    withVoiceTranscription,
    peerColorClass: (0,_common_helpers_peerColor__WEBPACK_IMPORTED_MODULE_21__.getPeerColorClass)(messageColorPeer, noUserColors, true),
    hasOutsideReactions
  });
  const withAppendix = contentClassName.includes('has-appendix');
  const emojiSize = (0,_composer_helpers_customEmoji__WEBPACK_IMPORTED_MODULE_23__.getCustomEmojiSize)(message.emojiOnlyCount);
  const paidMessageStarsInMeta = !isChatWithUser ? isAlbum && paidMessageStars ? album.messages.length * paidMessageStars : paidMessageStars : undefined;
  let metaPosition;
  if (phoneCall) {
    metaPosition = 'none';
  } else if (isInDocumentGroupNotLast) {
    metaPosition = 'none';
  } else if (hasText && !webPage && !emojiSize && !isInvertedMedia) {
    metaPosition = 'in-text';
  } else if (isInvertedMedia && !emojiSize && (hasFactCheck || webPage)) {
    metaPosition = 'in-text';
  } else {
    metaPosition = 'standalone';
  }
  let reactionsPosition;
  if (hasReactions) {
    if (hasOutsideReactions) {
      reactionsPosition = 'outside';
    } else if (asForwarded) {
      metaPosition = 'standalone';
      reactionsPosition = 'inside';
    } else {
      reactionsPosition = 'inside';
    }
  } else {
    reactionsPosition = 'none';
  }
  const quickReactionPosition = isCustomShape ? 'in-meta' : 'in-content';
  (0,_hooks_useEnsureMessage__WEBPACK_IMPORTED_MODULE_30__["default"])(replyToPeerId || chatId, replyToMsgId, replyMessage, message.id, shouldHideReply || isReplyPrivate);
  (0,_hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_31__["default"])(storyReplyPeerId || chatId, storyReplyId, replyStory);
  (0,_hooks_useFocusMessage__WEBPACK_IMPORTED_MODULE_42__["default"])({
    elementRef: ref,
    chatId,
    isFocused,
    focusDirection,
    noFocusHighlight,
    isResizingContainer,
    isJustAdded,
    isQuote: Boolean(focusedQuote),
    scrollTargetPosition
  });
  const viaBusinessBotTitle = viaBusinessBot ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__.getPeerFullTitle)(oldLang, viaBusinessBot) : undefined;
  const canShowPostAuthor = !message.senderId;
  const signature = viaBusinessBotTitle || canShowPostAuthor && message.postAuthorTitle || (asForwarded || isChatWithSelf) && forwardInfo?.postAuthorTitle || undefined;
  (0,_hooks_useResizeMessageObserver__WEBPACK_IMPORTED_MODULE_38__["default"])(ref, isLastInList);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const bottomMarker = bottomMarkerRef.current;
    if (!bottomMarker || !(0,_util_visibility_isElementInViewport__WEBPACK_IMPORTED_MODULE_17__.isElementInViewport)(bottomMarker)) return;
    if (hasUnreadReaction) {
      animateUnreadReaction({
        messageIds: [messageId]
      });
    }
    let unreadMentionIds = [];
    if (message.hasUnreadMention) {
      unreadMentionIds = [messageId];
    }
    if (album) {
      unreadMentionIds = album.messages.filter(msg => msg.hasUnreadMention).map(msg => msg.id);
    }
    if (unreadMentionIds.length) {
      markMentionsRead({
        chatId,
        messageIds: unreadMentionIds
      });
    }
  }, [hasUnreadReaction, album, chatId, messageId, animateUnreadReaction, message.hasUnreadMention]);
  const albumLayout = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return isAlbum ? (0,_helpers_calculateAlbumLayout__WEBPACK_IMPORTED_MODULE_25__.calculateAlbumLayout)(isOwn, Boolean(noAvatars), album, isMobile) : undefined;
  }, [isAlbum, isOwn, noAvatars, album, isMobile]);
  const extraPadding = asForwarded && !isCustomShape ? 28 : 0;
  const sizeCalculations = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    let calculatedWidth;
    let contentWidth;
    let noMediaCorners = false;
    let style = '';
    let reactionsMaxWidth;
    if (!isAlbum && (photo || video || invoice?.extendedMedia)) {
      let width;
      if (photo || video) {
        const media = photo || video;
        if (media && !isRoundVideo) {
          width = (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_27__.calculateMediaDimensions)({
            media,
            isOwn,
            asForwarded,
            noAvatars,
            isMobile
          }).width;
        }
      } else if (invoice?.extendedMedia && invoice.extendedMedia.width && invoice.extendedMedia.height) {
        const {
          width: previewWidth,
          height: previewHeight
        } = invoice.extendedMedia;
        width = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_20__.calculateDimensionsForMessageMedia)({
          width: previewWidth,
          height: previewHeight,
          fromOwnMessage: isOwn,
          asForwarded,
          noAvatars,
          isMobile
        }).width;
      }
      if (width) {
        if (width < _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_27__.MIN_MEDIA_WIDTH_WITH_TEXT) {
          contentWidth = width;
        }
        calculatedWidth = Math.max((0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_27__.getMinMediaWidth)(text?.text, isMediaWithCommentButton), width);
        if (!asForwarded && invoice?.extendedMedia && calculatedWidth - width > NO_MEDIA_CORNERS_THRESHOLD) {
          noMediaCorners = true;
        }
      }
    } else if (albumLayout) {
      calculatedWidth = Math.max((0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_27__.getMinMediaWidth)(text?.text, isMediaWithCommentButton), albumLayout.containerStyle.width);
      if (calculatedWidth - albumLayout.containerStyle.width > NO_MEDIA_CORNERS_THRESHOLD) {
        noMediaCorners = true;
      }
    }
    if (calculatedWidth) {
      style = `width: ${calculatedWidth}px`;
      reactionsMaxWidth = calculatedWidth + EXTRA_SPACE_FOR_REACTIONS;
    } else if (sticker && !hasSubheader) {
      const {
        width
      } = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_20__.getStickerDimensions)(sticker, isMobile);
      style = `width: ${width + extraPadding}px`;
      reactionsMaxWidth = width + EXTRA_SPACE_FOR_REACTIONS;
    }
    return {
      contentWidth,
      noMediaCorners,
      style,
      reactionsMaxWidth
    };
  }, [albumLayout, asForwarded, extraPadding, hasSubheader, invoice?.extendedMedia, isAlbum, isMediaWithCommentButton, isMobile, isOwn, noAvatars, photo, sticker, text?.text, video, isRoundVideo]);
  const {
    contentWidth,
    noMediaCorners,
    style,
    reactionsMaxWidth
  } = sizeCalculations;
  function renderMessageText(isForAnimation) {
    if (!textMessage) return undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MessageText__WEBPACK_IMPORTED_MODULE_56__["default"], {
      messageOrStory: textMessage,
      translatedText: requestedTranslationLanguage || hasTranslation ? currentTranslatedText : undefined,
      isForAnimation: isForAnimation,
      focusedQuote: focusedQuote,
      focusedQuoteOffset: focusedQuoteOffset,
      emojiSize: emojiSize,
      highlight: highlight,
      isProtected: isProtected,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      withTranslucentThumbs: isCustomShape,
      isInSelectMode: isInSelectMode,
      canBeEmpty: hasFactCheck,
      maxTimestamp: maxTimestamp,
      threadId: threadId
    });
  }
  const renderQuickReactionButton = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!defaultReaction) return undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('quick-reaction', 'no-selection', isQuickReactionVisible && !hasActiveReactions && 'visible'),
      onClick: handleSendQuickReaction,
      ref: quickReactionRef
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_reactions_ReactionStaticEmoji__WEBPACK_IMPORTED_MODULE_57__["default"], {
      reaction: defaultReaction,
      size: QUICK_REACTION_SIZE,
      availableReactions: availableReactions,
      observeIntersection: observeIntersectionForPlaying
    }));
  }, [hasActiveReactions, availableReactions, defaultReaction, handleSendQuickReaction, isQuickReactionVisible, observeIntersectionForPlaying]);
  function renderReactionsAndMeta() {
    const meta = /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageMeta__WEBPACK_IMPORTED_MODULE_78__["default"], {
      message: message,
      isPinned: isPinned,
      withFullDate: isChatWithSelf && !isOwn,
      noReplies: noReplies,
      repliesThreadInfo: repliesThreadInfo,
      outgoingStatus: outgoingStatus,
      signature: signature,
      withReactionOffset: reactionsPosition === 'inside',
      renderQuickReactionButton: withQuickReactionButton && quickReactionPosition === 'in-meta' ? renderQuickReactionButton : undefined,
      availableReactions: availableReactions,
      isTranslated: Boolean(requestedTranslationLanguage ? currentTranslatedText : undefined),
      effectEmoji: effect?.emoticon,
      onClick: handleMetaClick,
      onEffectClick: handleEffectClick,
      onTranslationClick: handleTranslationClick,
      onOpenThread: handleOpenThread,
      paidMessageStars: paidMessageStarsInMeta
    });
    if (reactionsPosition !== 'inside') {
      return meta;
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_reactions_Reactions__WEBPACK_IMPORTED_MODULE_83__["default"], {
      message: reactionMessage,
      threadId: threadId,
      metaChildren: meta,
      observeIntersection: observeIntersectionForPlaying,
      noRecentReactors: isChannel,
      tags: tags,
      isCurrentUserPremium: isPremium,
      isAccountFrozen: isAccountFrozen
    });
  }
  function renderContent() {
    const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('content-inner', asForwarded && 'forwarded-message', hasForwardedCustomShape && 'forwarded-custom-shape', hasSubheader && 'with-subheader', noMediaCorners && 'no-media-corners');
    const hasCustomAppendix = isLastInGroup && (!hasText || isInvertedMedia && !hasFactCheck && !hasReactions) && !withCommentButton;
    const textContentClass = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('text-content', 'clearfix', metaPosition === 'in-text' && 'with-meta', outgoingStatus && 'with-outgoing-icon');
    const shouldReadMedia = !hasTtl || !isOwn || isChatWithSelf;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: className,
      onDoubleClick: handleContentDoubleClick,
      dir: "auto"
    }, !asForwarded && shouldRenderSenderName() && renderSenderName(), hasSubheader && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-subheader"
    }, hasTopicChip && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_TopicChip__WEBPACK_IMPORTED_MODULE_58__["default"], {
      topic: messageTopic,
      onClick: handleTopicChipClick,
      className: "message-topic"
    }), hasForwardedCustomShape && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "forward-custom-shape-subheader"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-title"
    }, renderForwardTitle()), renderSenderName(true, true)), hasMessageReply && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_embedded_EmbeddedMessage__WEBPACK_IMPORTED_MODULE_51__["default"], {
      message: replyMessage,
      replyInfo: messageReplyInfo,
      noUserColors: noUserColors,
      isProtected: isProtected,
      sender: replyMessageSender,
      senderChat: replyMessageChat,
      forwardSender: replyMessageForwardSender,
      chatTranslations: chatTranslations,
      isMediaNsfw: isReplyMediaNsfw,
      requestedChatTranslationLanguage: requestedChatTranslationLanguage,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      onClick: handleReplyClick
    }), hasStoryReply && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_embedded_EmbeddedStory__WEBPACK_IMPORTED_MODULE_52__["default"], {
      story: replyStory,
      sender: storySender,
      noUserColors: noUserColors,
      isProtected: isProtected,
      observeIntersectionForLoading: observeIntersectionForLoading,
      onClick: handleStoryClick
    })), sticker && observeIntersectionForLoading && observeIntersectionForPlaying && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Sticker__WEBPACK_IMPORTED_MODULE_85__["default"], {
      message: message,
      observeIntersection: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      shouldLoop: shouldLoopStickers,
      shouldPlayEffect: shouldPlayEffect,
      withEffect: withAnimatedEffects,
      isMediaNsfw: isMediaNsfw,
      onStopEffect: hideEffect
    }), hasAnimatedEmoji && animatedCustomEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AnimatedCustomEmoji__WEBPACK_IMPORTED_MODULE_64__["default"], {
      customEmojiId: animatedCustomEmoji,
      withEffects: withAnimatedEffects && isChatWithUser && !effect,
      isOwn: isOwn,
      observeIntersection: observeIntersectionForLoading,
      forceLoadPreview: isLocal,
      messageId: messageId,
      chatId: chatId,
      activeEmojiInteractions: activeEmojiInteractions
    }), hasAnimatedEmoji && animatedEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_AnimatedEmoji__WEBPACK_IMPORTED_MODULE_65__["default"], {
      emoji: animatedEmoji,
      withEffects: withAnimatedEffects && isChatWithUser && !effect,
      isOwn: isOwn,
      observeIntersection: observeIntersectionForLoading,
      forceLoadPreview: isLocal,
      messageId: messageId,
      chatId: chatId,
      activeEmojiInteractions: activeEmojiInteractions
    }), withAnimatedEffects && effect && !isLocal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageEffect__WEBPACK_IMPORTED_MODULE_77__["default"], {
      shouldPlay: shouldPlayEffect,
      messageId: message.id,
      isMirrored: !message.isOutgoing,
      effect: effect,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      onStop: hideEffect
    }), phoneCall && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessagePhoneCall__WEBPACK_IMPORTED_MODULE_79__["default"], {
      message: message,
      phoneCall: phoneCall,
      chatId: chatId
    }), !isAlbum && isRoundVideo && !withVoiceTranscription && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_RoundVideo__WEBPACK_IMPORTED_MODULE_84__["default"], {
      message: message,
      observeIntersection: observeIntersectionForLoading,
      canAutoLoad: canAutoLoadMedia,
      isDownloading: isDownloading,
      onReadMedia: shouldReadMedia ? handleReadMedia : undefined,
      onHideTranscription: setTranscriptionHidden,
      isTranscriptionError: isTranscriptionError,
      isTranscribed: Boolean(transcribedText),
      canTranscribe: canTranscribeVoice && !hasTtl,
      isTranscriptionHidden: isTranscriptionHidden,
      isTranscribing: isTranscribing
    }), (audio || voice || withVoiceTranscription) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Audio__WEBPACK_IMPORTED_MODULE_46__["default"], {
      theme: theme,
      message: message,
      origin: _types__WEBPACK_IMPORTED_MODULE_3__.AudioOrigin.Inline,
      uploadProgress: uploadProgress,
      isSelectable: isInDocumentGroup,
      isSelected: isSelected,
      noAvatars: noAvatars,
      onPlay: handleAudioPlay,
      onReadMedia: voice && shouldReadMedia ? handleReadMedia : undefined,
      onCancelUpload: handleCancelUpload,
      isDownloading: isDownloading,
      isTranscribing: isTranscribing,
      isTranscriptionHidden: isTranscriptionHidden,
      isTranscribed: Boolean(transcribedText),
      isTranscriptionError: isTranscriptionError,
      canDownload: !isProtected,
      onHideTranscription: setTranscriptionHidden,
      canTranscribe: canTranscribeVoice && !hasTtl
    }), document && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Document__WEBPACK_IMPORTED_MODULE_49__["default"], {
      document: document,
      message: message,
      observeIntersection: observeIntersectionForLoading,
      canAutoLoad: canAutoLoadMedia,
      autoLoadFileMaxSizeMb: autoLoadFileMaxSizeMb,
      uploadProgress: uploadProgress,
      isSelectable: isInDocumentGroup,
      isSelected: isSelected,
      onMediaClick: handleDocumentClick,
      onCancelUpload: handleCancelUpload,
      isDownloading: isDownloading,
      shouldWarnAboutSvg: shouldWarnAboutSvg
    }), storyData && !isStoryMention && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Story__WEBPACK_IMPORTED_MODULE_86__["default"], {
      message: message,
      isProtected: isProtected
    }), isStoryMention && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StoryMention__WEBPACK_IMPORTED_MODULE_87__["default"], {
      message: message
    }), contact && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Contact__WEBPACK_IMPORTED_MODULE_67__["default"], {
      contact: contact,
      noUserColors: isOwn
    }), poll && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Poll__WEBPACK_IMPORTED_MODULE_82__["default"], {
      message: message,
      poll: poll,
      onSendVote: handleVoteSend
    }), todo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_TodoList__WEBPACK_IMPORTED_MODULE_88__["default"], {
      message: message,
      todoList: todo
    }), (giveaway || giveawayResults) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Giveaway__WEBPACK_IMPORTED_MODULE_71__["default"], {
      message: message
    }), game && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Game__WEBPACK_IMPORTED_MODULE_70__["default"], {
      message: message,
      canAutoLoadMedia: canAutoLoadMedia
    }), invoice?.extendedMedia && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_InvoiceMediaPreview__WEBPACK_IMPORTED_MODULE_74__["default"], {
      message: message,
      isConnected: isConnected
    }), withVoiceTranscription && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('transcription', !isTranscriptionHidden && isTranscriptionError && 'transcription-error'),
      dir: "auto"
    }, isTranscriptionError ? oldLang('NoWordsRecognized') : isTranscribing && transcribedText ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_DotAnimation__WEBPACK_IMPORTED_MODULE_50__["default"], {
      content: transcribedText
    }) : transcribedText), isInvertedMedia && renderInvertedMediaContent(hasCustomAppendix), !isInvertedMedia && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderInvertibleMediaContent(hasCustomAppendix), hasText && !hasAnimatedEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: textContentClass,
      dir: "auto"
    }, renderMessageText(), isTranslationPending && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "translation-animation"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-loading"
    }, renderMessageText(true))), hasFactCheck && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FactCheck__WEBPACK_IMPORTED_MODULE_69__["default"], {
      factCheck: factCheck,
      isToggleDisabled: isInSelectMode
    }), metaPosition === 'in-text' && renderReactionsAndMeta()), renderWebPage()), invoice && !invoice.extendedMedia && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Invoice__WEBPACK_IMPORTED_MODULE_73__["default"], {
      message: message,
      shouldAffectAppendix: hasCustomAppendix && !hasReactions,
      isInSelectMode: isInSelectMode,
      isSelected: isSelected,
      theme: theme,
      forcedWidth: contentWidth
    }), location && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Location__WEBPACK_IMPORTED_MODULE_75__["default"], {
      message: message,
      isInSelectMode: isInSelectMode,
      isSelected: isSelected,
      theme: theme,
      peer: sender
    }));
  }
  function renderInvertedMediaContent(hasCustomAppendix) {
    const textContentClass = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('text-content', 'clearfix');
    const footerClass = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('text-content', 'clearfix', metaPosition === 'in-text' && 'with-meta', outgoingStatus && 'with-outgoing-icon');
    const hasMediaAfterText = isAlbum || !isAlbum && photo || !isAlbum && video && !isRoundVideo;
    const hasContentAfterText = hasMediaAfterText || !hasAnimatedEmoji && hasFactCheck;
    const isMetaInText = metaPosition === 'in-text';
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderWebPage(), hasText && !hasAnimatedEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: textContentClass,
      dir: "auto"
    }, renderMessageText(), isTranslationPending && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "translation-animation"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-loading"
    }, renderMessageText(true))), !hasContentAfterText && isMetaInText && renderReactionsAndMeta()), hasContentAfterText && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, renderInvertibleMediaContent(hasCustomAppendix), !hasAnimatedEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: footerClass,
      dir: "auto"
    }, hasFactCheck && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_FactCheck__WEBPACK_IMPORTED_MODULE_69__["default"], {
      factCheck: factCheck,
      isToggleDisabled: isInSelectMode
    }), isMetaInText && renderReactionsAndMeta())));
  }
  function renderWebPage() {
    const messageWebPage = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageWebPage)(message);
    if (!messageWebPage || !webPage) return undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_WebPage__WEBPACK_IMPORTED_MODULE_90__["default"], {
      messageWebPage: messageWebPage,
      webPage: webPage,
      message: message,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      noAvatars: noAvatars,
      canAutoLoad: canAutoLoadMedia,
      canAutoPlay: canAutoPlayMedia,
      asForwarded: asForwarded,
      isDownloading: isDownloading,
      isProtected: isProtected,
      theme: theme,
      story: webPageStory,
      isConnected: isConnected,
      lastPlaybackTimestamp: lastPlaybackTimestamp,
      backgroundEmojiId: messageColorPeer?.color?.backgroundEmojiId,
      shouldWarnAboutSvg: shouldWarnAboutSvg,
      autoLoadFileMaxSizeMb: autoLoadFileMaxSizeMb,
      onAudioPlay: handleAudioPlay,
      onMediaClick: handleMediaClick,
      onDocumentClick: handleDocumentClick,
      onCancelMediaTransfer: handleCancelUpload
    });
  }
  function renderInvertibleMediaContent(hasCustomAppendix) {
    const content = /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, isAlbum && observeIntersectionForLoading && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Album__WEBPACK_IMPORTED_MODULE_63__["default"], {
      album: album,
      albumLayout: albumLayout,
      observeIntersection: observeIntersectionForLoading,
      isOwn: isOwn,
      isProtected: isProtected,
      hasCustomAppendix: hasCustomAppendix,
      onMediaClick: handleAlbumMediaClick
    }), !isAlbum && photo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Photo__WEBPACK_IMPORTED_MODULE_81__["default"], {
      messageText: text?.text,
      photo: photo,
      isOwn: isOwn,
      observeIntersection: observeIntersectionForLoading,
      noAvatars: noAvatars,
      canAutoLoad: canAutoLoadMedia,
      uploadProgress: uploadProgress,
      shouldAffectAppendix: hasCustomAppendix,
      isDownloading: isDownloading,
      isProtected: isProtected,
      asForwarded: asForwarded,
      theme: theme,
      isMediaNsfw: isMediaNsfw,
      forcedWidth: contentWidth,
      onClick: handlePhotoMediaClick,
      onCancelUpload: handleCancelUpload
    }), !isAlbum && video && !isRoundVideo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Video__WEBPACK_IMPORTED_MODULE_89__["default"], {
      video: video,
      isOwn: isOwn,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      forcedWidth: contentWidth,
      noAvatars: noAvatars,
      canAutoLoad: canAutoLoadMedia,
      canAutoPlay: canAutoPlayMedia,
      uploadProgress: uploadProgress,
      isDownloading: isDownloading,
      isProtected: isProtected,
      asForwarded: asForwarded,
      isMediaNsfw: isMediaNsfw,
      lastPlaybackTimestamp: lastPlaybackTimestamp,
      onClick: handleVideoMediaClick,
      onCancelUpload: handleCancelUpload
    }));
    if (paidMedia) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PaidMediaOverlay__WEBPACK_IMPORTED_MODULE_80__["default"], {
        chatId: chatId,
        messageId: messageId,
        paidMedia: paidMedia,
        isOutgoing: isOwn
      }, content);
    }
    return content;
  }
  function shouldRenderSenderName() {
    const media = photo || video || location || paidMedia;
    return !(isCustomShape && !viaBotId) && (withSenderName && (!media || hasTopicChip) || asForwarded || viaBotId || forceSenderName) && !isInDocumentGroupNotFirst && !(hasMessageReply && isCustomShape);
  }
  function renderForwardTitle() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "forward-title-container"
    }, asForwarded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_54__["default"], {
      name: forwardInfo?.hiddenUserName ? 'forward' : 'share-filled'
    }), asForwarded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "forward-title"
    }, oldLang('ForwardedFrom')));
  }
  const handleSuggestedMessageButton = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_35__["default"])(payload => {
    if (payload.button.type !== 'suggestedMessage') return;
    if (payload.button.buttonType === 'approve') {
      openSuggestedPostApprovalModal({
        chatId,
        messageId: message.id
      });
      return;
    }
    if (payload.button.buttonType === 'decline') {
      openDeclineDialog();
      return;
    }
    clickSuggestedMessageButton({
      ...payload,
      button: payload.button
    });
  });
  const handleDeclineReasonChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_35__["default"])(e => {
    setDeclineReason(e.target.value);
  });
  const handleDeclineConfirm = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_35__["default"])(() => {
    rejectSuggestedPost({
      chatId,
      messageId: message.id,
      rejectComment: declineReason.trim() || undefined
    });
    closeDeclineDialog();
    setDeclineReason('');
  });
  function renderSenderName(shouldSkipRenderForwardTitle = false, shouldSkipRenderAdminTitle = false) {
    let senderTitle;
    let senderColor;
    if (senderPeer && !(isCustomShape && viaBotId)) {
      senderTitle = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__.getPeerFullTitle)(oldLang, senderPeer);
    } else if (forwardInfo?.hiddenUserName) {
      senderTitle = forwardInfo.hiddenUserName;
    } else if (storyData && originSender) {
      senderTitle = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__.getPeerFullTitle)(oldLang, originSender);
    }
    const senderEmojiStatus = senderPeer && 'emojiStatus' in senderPeer && senderPeer.emojiStatus;
    const senderIsPremium = senderPeer && 'isPremium' in senderPeer && senderPeer.isPremium;
    const shouldRenderForwardAvatar = asForwarded && senderPeer;
    const hasBotSenderUsername = botSender?.hasUsername;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-title",
      dir: "ltr"
    }, senderTitle || asForwarded ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('message-title-name-container', forwardInfo?.hiddenUserName ? 'sender-hidden' : 'interactive', senderColor),
      dir: "ltr"
    }, !shouldSkipRenderForwardTitle && renderForwardTitle(), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "message-title-name"
    }, storyData && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_54__["default"], {
      name: "play-story"
    }), shouldRenderForwardAvatar && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_47__["default"], {
      className: "forward-avatar",
      peer: senderPeer,
      size: "micro"
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "sender-title",
      onClick: handleSenderClick
    }, senderTitle ? (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_22__["default"])(senderTitle) : asForwarded ? NBSP : undefined), !asForwarded && senderEmojiStatus && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_48__["default"], {
      documentId: senderEmojiStatus.documentId,
      className: "no-selection",
      loopLimit: _config__WEBPACK_IMPORTED_MODULE_4__.EMOJI_STATUS_LOOP_LIMIT,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying
    }), !asForwarded && !senderEmojiStatus && senderIsPremium && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_55__["default"], null), senderPeer?.fakeType && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_FakeIcon__WEBPACK_IMPORTED_MODULE_53__["default"], {
      fakeType: senderPeer.fakeType
    }))) : !botSender ? NBSP : undefined, botSender?.hasUsername && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "interactive"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "via"
    }, oldLang('ViaBot')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "sender-title",
      onClick: handleViaBotClick
    }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_22__["default"])(`@${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMainUsername)(botSender)}`))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "title-spacer"
    }), !shouldSkipRenderAdminTitle && !hasBotSenderUsername ? forwardInfo?.isLinkedChannelPost ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "admin-title",
      dir: "auto"
    }, oldLang('DiscussChannel')) : message.postAuthorTitle && isGroup && !asForwarded ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "admin-title",
      dir: "auto"
    }, message.postAuthorTitle) : senderAdminMember && !asForwarded && !viaBotId ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "admin-title",
      dir: "auto"
    }, senderAdminMember.customTitle || oldLang(senderAdminMember.isOwner ? 'GroupInfo.LabelOwner' : 'GroupInfo.LabelAdmin')) : undefined : undefined, canShowSenderBoosts && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "sender-boosts",
      "aria-hidden": true
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_54__["default"], {
      name: senderBoosts > 1 ? 'boosts' : 'boost'
    }), senderBoosts > 1 ? senderBoosts : undefined));
  }
  const forwardAuthor = isGroup && asForwarded ? message.postAuthorTitle : undefined;
  const shouldRenderSuggestedPostButtons = message.suggestedPostInfo && !message.isOutgoing && !message.suggestedPostInfo.isAccepted && !message.suggestedPostInfo.isRejected;
  const isSuggestedPostExpired = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!message.suggestedPostInfo?.scheduleDate || !minFutureTime) return false;
    const now = (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_15__.getServerTime)();
    return message.suggestedPostInfo.scheduleDate <= now + minFutureTime;
  }, [message.suggestedPostInfo, minFutureTime]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    id: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageHtmlId)(message.id),
    className: containerClassName,
    "data-message-id": messageId,
    onCopy: isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_16__["default"] : undefined,
    onMouseDown: handleMouseDown,
    onClick: handleClick,
    onContextMenu: handleContextMenu,
    onDoubleClick: handleDoubleClick,
    onMouseEnter: isInDocumentGroupNotLast ? handleDocumentGroupMouseEnter : undefined,
    onMouseMove: withQuickReactionButton ? handleMouseMove : undefined,
    onMouseLeave: withQuickReactionButton || isInDocumentGroupNotLast ? handleMouseLeave : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: bottomMarkerRef,
    className: "bottom-marker",
    "data-message-id": messageId,
    "data-last-message-id": album ? album.messages[album.messages.length - 1].id : undefined,
    "data-album-main-id": album ? album.mainMessage.id : undefined,
    "data-has-unread-mention": message.hasUnreadMention || undefined,
    "data-has-unread-reaction": hasUnreadReaction || undefined,
    "data-is-pinned": isPinned || undefined,
    "data-should-update-views": message.viewsCount !== undefined
  }), !isInDocumentGroup && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-select-control no-selection"
  }, isSelected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_54__["default"], {
    name: "select"
  })), isLastInDocumentGroup && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('message-select-control group-select no-selection', isGroupSelected && 'is-selected'),
    onClick: handleDocumentGroupSelectAll
  }, isGroupSelected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_54__["default"], {
    name: "select"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: messageContentRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('message-content-wrapper', contentClassName.includes('text') && 'can-select-text', contentClassName.includes('giveaway') && 'giveaway-result-content')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: contentClassName,
    style: style,
    dir: "auto"
  }, asForwarded && !isInDocumentGroupNotFirst && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, shouldRenderSenderName() && renderSenderName(), forwardAuthor && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "admin-title",
    dir: "auto"
  }, forwardAuthor)), renderContent(), !isInDocumentGroupNotLast && metaPosition === 'standalone' && !isStoryMention && renderReactionsAndMeta(), canShowActionButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_12__["default"])('message-action-buttons', isLoadingComments && 'message-action-buttons-shown')
  }, withCommentButton && isCustomShape && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_CommentButton__WEBPACK_IMPORTED_MODULE_66__["default"], {
    threadInfo: repliesThreadInfo,
    disabled: noComments,
    isLoading: isLoadingComments,
    isCustomShape: true,
    asActionButton: true
  }), canForward && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_60__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: oldLang('lng_context_forward_msg'),
    onClick: isLastInDocumentGroup ? handleGroupForward : handleForward
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_54__["default"], {
    name: "share-filled"
  })), canFocus && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_60__["default"], {
    className: "message-action-button",
    color: "translucent-white",
    round: true,
    size: "tiny",
    ariaLabel: "Focus message",
    onClick: isPinnedList ? handleFocus : handleFocusForwarded
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_54__["default"], {
    name: "arrow-right"
  }))), withCommentButton && !(canShowActionButton && isCustomShape) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_CommentButton__WEBPACK_IMPORTED_MODULE_66__["default"], {
    threadInfo: repliesThreadInfo,
    disabled: noComments,
    isLoading: isLoadingComments
  }), withAppendix && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MessageAppendix__WEBPACK_IMPORTED_MODULE_76__["default"], {
    isOwn: isOwn
  }), withQuickReactionButton && quickReactionPosition === 'in-content' && renderQuickReactionButton(), isGptMenuOpen && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_chatAssistant_component_message_gpt_menu__WEBPACK_IMPORTED_MODULE_18__["default"], {
    position: gptMenuPosition,
    message: message,
    messageListType: messageListType,
    detectedLanguage: detectedLanguage
  })), message.inlineButtons && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_InlineButtons__WEBPACK_IMPORTED_MODULE_72__["default"], {
    message: message,
    onClick: clickBotInlineButton
  }), shouldRenderSuggestedPostButtons && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_InlineButtons__WEBPACK_IMPORTED_MODULE_72__["default"], {
    message: {
      ...message,
      inlineButtons: [[{
        type: 'suggestedMessage',
        buttonType: 'decline',
        text: lang('SuggestedPostDecline')
      }, {
        type: 'suggestedMessage',
        buttonType: 'approve',
        text: lang('SuggestedPostApprove'),
        disabled: isSuggestedPostExpired
      }], [{
        type: 'suggestedMessage',
        buttonType: 'suggestChanges',
        text: lang('SuggestedPostSuggestChanges')
      }]]
    },
    onClick: handleSuggestedMessageButton
  }), reactionsPosition === 'outside' && !isStoryMention && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_reactions_Reactions__WEBPACK_IMPORTED_MODULE_83__["default"], {
    message: reactionMessage,
    threadId: threadId,
    isOutside: true,
    isCurrentUserPremium: isPremium,
    maxWidth: reactionsMaxWidth,
    observeIntersection: observeIntersectionForPlaying,
    noRecentReactors: isChannel,
    tags: tags,
    isAccountFrozen: isAccountFrozen
  })), contextMenuAnchor && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ContextMenuContainer_async__WEBPACK_IMPORTED_MODULE_68__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuAnchor,
    targetHref: contextMenuTarget?.matches('a[href]') ? contextMenuTarget.href : undefined,
    message: message,
    album: album,
    messageListType: messageListType,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide,
    repliesThreadInfo: repliesThreadInfo,
    noReplies: noReplies,
    detectedLanguage: detectedLanguage
  }), isDeclineDialogOpen && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_61__["default"], {
    isOpen: isDeclineDialogOpen,
    onClose: closeDeclineDialog,
    title: lang('SuggestedPostDecline'),
    confirmLabel: lang('SuggestedPostDecline'),
    confirmHandler: handleDeclineConfirm,
    confirmIsDestructive: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "decline-dialog-question"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_22__["default"])(lang('DeclinePostDialogQuestion', {
    sender: sender ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_6__.getPeerFullTitle)(oldLang, sender) : ''
  }, {
    withNodes: true,
    withMarkdown: true
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_InputText__WEBPACK_IMPORTED_MODULE_62__["default"], {
    placeholder: lang('DeclineReasonPlaceholder'),
    value: declineReason,
    onChange: handleDeclineReasonChange,
    maxLength: MAX_REASON_LENGTH
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, ownProps) => {
  const {
    focusedMessage,
    forwardMessages,
    activeReactions,
    activeEmojiInteractions,
    loadingThread
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTabState)(global);
  const {
    message,
    album,
    withSenderName,
    withAvatar,
    threadId,
    messageListType,
    isLastInDocumentGroup,
    isFirstInGroup
  } = ownProps;
  const {
    id,
    chatId,
    viaBotId,
    isOutgoing,
    forwardInfo,
    transcriptionId,
    isPinned,
    viaBusinessBotId,
    effectId,
    paidMessageStars
  } = message;
  const webPage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectFullWebPageFromMessage)(global, message);
  const {
    shouldWarnAboutSvg
  } = (0,_global_selectors_sharedState__WEBPACK_IMPORTED_MODULE_10__.selectSharedSettings)(global);
  const isChatWithUser = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_13__.isUserId)(chatId);
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, chatId);
  const isChatWithSelf = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatWithSelf)(global, chatId);
  const isSystemBotChat = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isSystemBot)(chatId);
  const isAnonymousForwards = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isAnonymousForwardsChat)(chatId);
  const isChannel = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatChannel)(chat);
  const isGroup = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatGroup)(chat);
  const chatFullInfo = !isChatWithUser ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatFullInfo)(global, chatId) : undefined;
  const webPageStoryData = webPage?.story;
  const webPageStory = webPageStoryData ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStory)(global, webPageStoryData.peerId, webPageStoryData.id) : undefined;
  const isForwarding = forwardMessages.messageIds && forwardMessages.messageIds.includes(id);
  const forceSenderName = !isChatWithSelf && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isAnonymousOwnMessage)(message);
  const canShowSender = withSenderName || withAvatar || forceSenderName;
  const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectSender)(global, message);
  const originSender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectForwardedSender)(global, message);
  const botSender = viaBotId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, viaBotId) : undefined;
  const senderAdminMember = sender?.id && isGroup ? chatFullInfo?.adminMembersById?.[sender?.id] : undefined;
  const isThreadTop = message.id === threadId;
  const {
    replyToMsgId,
    replyToPeerId,
    replyFrom
  } = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_7__.getMessageReplyInfo)(message) || {};
  const {
    peerId: storyReplyPeerId,
    storyId: storyReplyId
  } = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_7__.getStoryReplyInfo)(message) || {};
  const shouldHideReply = replyToMsgId && replyToMsgId === threadId;
  const replyMessage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectReplyMessage)(global, message);
  const forwardHeader = forwardInfo || replyFrom;
  const replyMessageSender = replyMessage ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectSender)(global, replyMessage) : forwardHeader && !isSystemBotChat && !isAnonymousForwards ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectSenderFromHeader)(global, forwardHeader) : undefined;
  const replyMessageForwardSender = replyMessage && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectForwardedSender)(global, replyMessage);
  const replyMessageChat = replyToPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChat)(global, replyToPeerId) : undefined;
  const isReplyPrivate = !isSystemBotChat && !isAnonymousForwards && replyMessageChat && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isChatPublic)(replyMessageChat) && (replyMessageChat.isNotJoined || (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatRestricted)(global, replyMessageChat.id));
  const isReplyToTopicStart = replyMessage?.content.action?.type === 'topicCreate';
  const replyStory = storyReplyId && storyReplyPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeerStory)(global, storyReplyPeerId, storyReplyId) : undefined;
  const storySender = storyReplyPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPeer)(global, storyReplyPeerId) : undefined;
  const uploadProgress = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUploadProgress)(global, message);
  const isFocused = messageListType === 'thread' && (album ? album.messages.some(m => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsMessageFocused)(global, m, threadId)) : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsMessageFocused)(global, message, threadId));
  const {
    direction: focusDirection,
    noHighlight: noFocusHighlight,
    isResizingContainer,
    quote: focusedQuote,
    quoteOffset: focusedQuoteOffset,
    scrollTargetPosition
  } = isFocused && focusedMessage || {};
  const middleSearch = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCurrentMiddleSearch)(global);
  const highlight = middleSearch?.results?.query && `${middleSearch.isHashtag ? '#' : ''}${middleSearch.results.query}`;
  const singleEmoji = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageSingleRegularEmoji)(message);
  const animatedEmoji = singleEmoji && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectAnimatedEmoji)(global, singleEmoji) ? singleEmoji : undefined;
  const animatedCustomEmoji = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getMessageSingleCustomEmoji)(message);
  let isSelected;
  if (album?.messages) {
    isSelected = album.messages.every(({
      id: messageId
    }) => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsMessageSelected)(global, messageId));
  } else {
    isSelected = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsMessageSelected)(global, id);
  }
  const canReply = messageListType === 'thread' && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCanReplyToMessage)(global, message, threadId);
  const activeDownloads = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectActiveDownloads)(global);
  const downloadableMedia = (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_9__.selectMessageDownloadableMedia)(global, message);
  const isDownloading = downloadableMedia && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.getIsDownloading)(activeDownloads, downloadableMedia);
  const repliesThreadInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectThreadInfo)(global, chatId, album?.commentsMessage?.id || id);
  const isInDocumentGroup = Boolean(message.groupedId) && !message.isInAlbum;
  const documentGroupFirstMessageId = isInDocumentGroup ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectMessageIdsByGroupId)(global, chatId, message.groupedId)[0] : undefined;
  const reactionMessage = isInDocumentGroup ? isLastInDocumentGroup ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatMessage)(global, chatId, documentGroupFirstMessageId) : undefined : message;
  const hasUnreadReaction = chat?.unreadReactions?.includes(message.id);
  const hasTopicChip = threadId === _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID && chat?.isForum && isFirstInGroup;
  const messageTopic = hasTopicChip ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTopicFromMessage)(global, message) : undefined;
  const chatTranslations = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectChatTranslations)(global, chatId);
  const requestedTranslationLanguage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectRequestedMessageTranslationLanguage)(global, chatId, message.id);
  const requestedChatTranslationLanguage = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectRequestedChatTranslationLanguage)(global, chatId);

  // Stop separate language detection if chat translation is requested
  // const areTranslationsEnabled = IS_TRANSLATION_SUPPORTED && global.settings.byKey.canTranslate
  //   && !requestedChatTranslationLanguage;
  const areTranslationsEnabled = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_11__.IS_TRANSLATION_SUPPORTED && !requestedChatTranslationLanguage;
  const isConnected = global.connectionState === 'connectionStateReady';
  const hasActiveReactions = Boolean(reactionMessage && activeReactions[(0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_14__.getMessageKey)(reactionMessage)]?.length);
  const isPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserPremium)(global);
  const senderBoosts = sender && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatWithSelf)(global, sender.id) ? chatFullInfo?.boostsApplied ?? message.senderBoosts : message.senderBoosts;
  const chatLevel = chat?.boostLevel || 0;
  const transcribeMinLevel = global.appConfig?.groupTranscribeLevelMin;
  const canTranscribeVoice = isPremium || Boolean(transcribeMinLevel && chatLevel >= transcribeMinLevel);
  const viaBusinessBot = viaBusinessBotId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectUser)(global, viaBusinessBotId) : undefined;
  const effect = effectId ? global.availableEffectById[effectId] : undefined;
  const poll = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPollFromMessage)(global, message);
  const maxTimestamp = (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_9__.selectMessageTimestampableDuration)(global, message);
  const lastPlaybackTimestamp = (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_9__.selectMessageLastPlaybackTimestamp)(global, chatId, message.id);
  const hasTranslation = requestedTranslationLanguage ? Boolean((0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectMessageTranslations)(global, message.chatId, requestedTranslationLanguage)[message.id]?.text) : undefined;
  const isAccountFrozen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsCurrentUserFrozen)(global);
  const minFutureTime = global.appConfig?.starsSuggestedPostFutureMin || _config__WEBPACK_IMPORTED_MODULE_4__.STARS_SUGGESTED_POST_FUTURE_MIN;
  const isMediaNsfw = (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_9__.selectIsMediaNsfw)(global, message);
  const isReplyMediaNsfw = replyMessage && (0,_global_selectors_media__WEBPACK_IMPORTED_MODULE_9__.selectIsMediaNsfw)(global, replyMessage);
  return {
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectTheme)(global),
    forceSenderName,
    sender,
    canShowSender,
    originSender,
    botSender,
    shouldHideReply: shouldHideReply || isReplyToTopicStart,
    isThreadTop,
    replyMessage,
    replyMessageSender,
    replyMessageForwardSender,
    replyMessageChat,
    replyStory,
    isReplyPrivate,
    storySender,
    isInDocumentGroup,
    isProtected: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsMessageProtected)(global, message),
    isChatProtected: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsChatProtected)(global, chatId),
    isFocused,
    isForwarding,
    reactionMessage,
    isChatWithSelf,
    isRepliesChat: isSystemBotChat,
    isAnonymousForwards,
    isChannel,
    isGroup,
    canReply,
    highlight,
    animatedEmoji,
    animatedCustomEmoji,
    isInSelectMode: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsInSelectMode)(global),
    isSelected,
    isGroupSelected: Boolean(message.groupedId) && !message.isInAlbum && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectIsDocumentGroupSelected)(global, chatId, message.groupedId),
    threadId,
    isDownloading,
    isPinnedList: messageListType === 'pinned',
    isPinned,
    canAutoLoadMedia: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCanAutoLoadMedia)(global, message),
    canAutoPlayMedia: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectCanAutoPlayMedia)(global, message),
    autoLoadFileMaxSizeMb: global.settings.byKey.autoLoadFileMaxSizeMb,
    shouldLoopStickers: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectShouldLoopStickers)(global),
    repliesThreadInfo,
    availableReactions: global.reactions.availableReactions,
    defaultReaction: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_5__.isMessageLocal)(message) || messageListType === 'scheduled' ? undefined : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectDefaultReaction)(global, chatId),
    hasActiveReactions,
    activeEmojiInteractions,
    hasUnreadReaction,
    isTranscribing: transcriptionId !== undefined && global.transcriptions[transcriptionId]?.isPending,
    transcribedText: transcriptionId !== undefined ? global.transcriptions[transcriptionId]?.text : undefined,
    hasTranslation,
    isPremium,
    senderAdminMember,
    messageTopic,
    hasTopicChip,
    chatTranslations,
    areTranslationsEnabled,
    shouldDetectChatLanguage: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectShouldDetectChatLanguage)(global, chatId),
    requestedTranslationLanguage,
    requestedChatTranslationLanguage,
    hasLinkedChat: Boolean(chatFullInfo?.linkedChatId),
    withAnimatedEffects: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectPerformanceSettingsValue)(global, 'stickerEffects'),
    webPageStory,
    isConnected,
    isLoadingComments: repliesThreadInfo?.isCommentsInfo && loadingThread?.loadingChatId === repliesThreadInfo?.originChannelId && loadingThread?.loadingMessageId === repliesThreadInfo?.originMessageId,
    shouldWarnAboutSvg,
    ...(isOutgoing && {
      outgoingStatus: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_8__.selectOutgoingStatus)(global, message, messageListType === 'scheduled')
    }),
    ...(typeof uploadProgress === 'number' && {
      uploadProgress
    }),
    ...(isFocused && {
      focusDirection,
      noFocusHighlight,
      isResizingContainer,
      focusedQuote,
      focusedQuoteOffset,
      scrollTargetPosition
    }),
    senderBoosts,
    tags: global.savedReactionTags?.byKey,
    canTranscribeVoice: true,
    viaBusinessBot,
    minFutureTime,
    effect,
    poll,
    maxTimestamp,
    lastPlaybackTimestamp,
    paidMessageStars,
    isChatWithUser,
    isAccountFrozen,
    isMediaNsfw,
    isReplyMediaNsfw,
    webPage
  };
})(Message)));

/***/ },

/***/ "./src/components/middle/message/MessageAppendix.tsx"
/*!***********************************************************!*\
  !*** ./src/components/middle/message/MessageAppendix.tsx ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");

function MessageAppendix({
  isOwn
}) {
  const path = isOwn ? 'M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 016 17z' : 'M3 17h6V0c-.193 2.84-.876 5.767-2.05 8.782-.904 2.325-2.446 4.485-4.625 6.48A1 1 0 003 17z';
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    width: "9",
    height: "20",
    className: "svg-appendix"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("defs", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("filter", {
    x: "-50%",
    y: "-14.7%",
    width: "200%",
    height: "141.2%",
    filterUnits: "objectBoundingBox",
    id: "messageAppendix"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feOffset", {
    dy: "1",
    in: "SourceAlpha",
    result: "shadowOffsetOuter1"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feGaussianBlur", {
    stdDeviation: "1",
    in: "shadowOffsetOuter1",
    result: "shadowBlurOuter1"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("feColorMatrix", {
    values: "0 0 0 0 0.0621962482 0 0 0 0 0.138574144 0 0 0 0 0.185037364 0 0 0 0.15 0",
    in: "shadowBlurOuter1"
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("g", {
    fill: "none",
    "fill-rule": "evenodd"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: path,
    fill: "#000",
    filter: "url(#messageAppendix)"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: path,
    fill: isOwn ? '#EEFFDE' : 'FFF',
    className: "corner"
  })));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (MessageAppendix);

/***/ },

/***/ "./src/components/middle/message/MessageEffect.module.scss"
/*!*****************************************************************!*\
  !*** ./src/components/middle/message/MessageEffect.module.scss ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"anchor":"IYu2f7FM","mirrorAnchor":"GsTZawTE","root":"McmbiWZE","mirror":"wNvU2uqi"});

/***/ },

/***/ "./src/components/middle/message/MessageEffect.tsx"
/*!*********************************************************!*\
  !*** ./src/components/middle/message/MessageEffect.tsx ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOverlayPosition__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./hooks/useOverlayPosition */ "./src/components/middle/message/hooks/useOverlayPosition.ts");
/* harmony import */ var _common_AnimatedSticker__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AnimatedSticker */ "./src/components/common/AnimatedSticker.tsx");
/* harmony import */ var _ui_Portal__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../ui/Portal */ "./src/components/ui/Portal.ts");
/* harmony import */ var _MessageEffect_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./MessageEffect.module.scss */ "./src/components/middle/message/MessageEffect.module.scss");











const EFFECT_SIZE = 256;
const MessageEffect = ({
  messageId,
  isMirrored,
  effect,
  shouldPlay,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  onStop
}) => {
  const anchorRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const canLoad = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__.useIsIntersecting)(anchorRef, observeIntersectionForLoading);
  const canPlay = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_3__.useIsIntersecting)(anchorRef, observeIntersectionForPlaying);
  const [isPlaying, startPlaying, stopPlaying] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const [isPositionUpdateRequired, requirePositionUpdate, resetPositionUpdate] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const effectHash = getEffectHash(effect);
  const effectBlob = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_5__["default"])(effectHash, !canLoad);
  const handleEnded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    stopPlaying();
    onStop?.();
  });
  const updatePosition = (0,_hooks_useOverlayPosition__WEBPACK_IMPORTED_MODULE_6__["default"])({
    anchorRef,
    overlayRef: ref,
    isMirrored,
    isDisabled: !isPlaying,
    isForMessageEffect: true,
    id: effect.id
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isPositionUpdateRequired) updatePosition();
    resetPositionUpdate();
  }, [updatePosition, resetPositionUpdate, isPositionUpdateRequired]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (canPlay && shouldPlay && effectBlob) {
      startPlaying();
      requirePositionUpdate();
    }
  }, [canPlay, effectBlob, shouldPlay, updatePosition]);
  const effectClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_MessageEffect_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root, isMirrored && _MessageEffect_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].mirror);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_MessageEffect_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].anchor, isMirrored && _MessageEffect_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].mirrorAnchor),
    ref: anchorRef
  }, isPlaying && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Portal__WEBPACK_IMPORTED_MODULE_8__["default"], null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedSticker__WEBPACK_IMPORTED_MODULE_7__["default"], {
    ref: ref,
    key: `effect-${messageId ?? effect.id}`,
    className: effectClassName,
    tgsUrl: effectBlob,
    size: EFFECT_SIZE,
    play: true,
    isLowPriority: true,
    noLoop: true,
    forceAlways: true,
    onEnded: handleEnded
  })));
};
function getEffectHash(effect) {
  if (effect.effectAnimationId) {
    return `sticker${effect.effectAnimationId}`;
  }
  return `sticker${effect.effectStickerId}?size=f`;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MessageEffect));

/***/ },

/***/ "./src/components/middle/message/MessageMeta.scss"
/*!********************************************************!*\
  !*** ./src/components/middle/message/MessageMeta.scss ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/MessageMeta.tsx"
/*!*******************************************************!*\
  !*** ./src/components/middle/message/MessageMeta.tsx ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MessageOutgoingStatus__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/MessageOutgoingStatus */ "./src/components/common/MessageOutgoingStatus.tsx");
/* harmony import */ var _MessageMeta_scss__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./MessageMeta.scss */ "./src/components/middle/message/MessageMeta.scss");















const MessageMeta = ({
  message,
  outgoingStatus,
  signature,
  withReactionOffset,
  repliesThreadInfo,
  renderQuickReactionButton,
  noReplies,
  isTranslated,
  isPinned,
  withFullDate,
  effectEmoji,
  onClick,
  onTranslationClick,
  onEffectClick,
  onOpenThread,
  paidMessageStars
}) => {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isActivated, markActivated] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  function handleImportedClick(e) {
    e.stopPropagation();
    showNotification({
      message: {
        key: 'ImportedInfo'
      }
    });
  }
  function handleOpenThread(e) {
    e.stopPropagation();
    onOpenThread();
  }
  const dateTitle = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isActivated) return undefined;
    const createDateTime = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)(message.date * 1000, oldLang.code, undefined, oldLang.timeFormat);
    const editDateTime = message.isEdited && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)(message.editDate * 1000, oldLang.code, undefined, oldLang.timeFormat);
    const forwardedDateTime = message.forwardInfo && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)((message.forwardInfo.savedDate || message.forwardInfo.date) * 1000, oldLang.code, undefined, oldLang.timeFormat);
    let text = createDateTime;
    if (editDateTime) {
      text += '\n';
      text += lang('MessageTooltipEditedDate', {
        date: editDateTime
      });
    }
    if (forwardedDateTime) {
      text += '\n';
      text += lang('MessageTooltipForwardedDate', {
        date: forwardedDateTime
      });
    }
    return text;
    // We need to listen to timeformat change
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [isActivated, oldLang, message, oldLang.timeFormat]);
  const viewsTitle = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!message.viewsCount) return undefined;
    let text = lang('MessageTooltipViews', {
      count: lang.number(message.viewsCount)
    }, {
      pluralValue: message.viewsCount
    });
    if (message.forwardsCount) {
      text += '\n';
      text += lang('MessageTooltipForwards', {
        count: lang.number(message.forwardsCount)
      }, {
        pluralValue: message.forwardsCount
      });
    }
    return text;
  }, [lang, message.forwardsCount, message.viewsCount]);
  const repliesTitle = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const count = repliesThreadInfo?.messagesCount;
    if (!count) return undefined;
    return lang('MessageTooltipReplies', {
      count
    }, {
      pluralValue: count
    });
  }, [lang, repliesThreadInfo]);
  const date = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const time = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatTime)(oldLang, message.date * 1000);
    if (!withFullDate) {
      return time;
    }
    return (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatPastTimeShort)(oldLang, (message.forwardInfo?.date || message.date) * 1000, true);
  }, [oldLang, message.date, message.forwardInfo?.date, withFullDate]);
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])('MessageMeta', withReactionOffset && 'reactions-offset', message.forwardInfo?.isImported && 'is-imported');
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: fullClassName,
    dir: lang.isRtl ? 'rtl' : 'ltr',
    onClick: onClick,
    "data-ignore-on-paste": true
  }, effectEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-effect-icon",
    onClick: onEffectClick
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(effectEmoji)), isTranslated && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "language",
    className: "message-translated",
    onClick: onTranslationClick
  }), Boolean(message.viewsCount) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-views",
    title: viewsTitle
  }, (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_5__.formatIntegerCompact)(lang, message.viewsCount)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "channelviews"
  })), !noReplies && Boolean(repliesThreadInfo?.messagesCount) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    onClick: handleOpenThread,
    className: "message-replies-wrapper",
    title: repliesTitle
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-replies"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_10__["default"], {
    text: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_5__.formatIntegerCompact)(lang, repliesThreadInfo.messagesCount)
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "reply-filled"
  })), isPinned && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
    name: "pinned-message",
    className: "message-pinned"
  }), signature && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-signature"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(signature)), Boolean(paidMessageStars) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-price"
  }, (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, paidMessageStars, {
    asFont: true,
    className: 'message-price-star-icon',
    containerClassName: 'message-price-stars-container'
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-time",
    title: dateTitle,
    onMouseEnter: markActivated
  }, message.forwardInfo?.isImported && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-imported",
    onClick: handleImportedClick
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatDateTimeToString)(message.forwardInfo.date * 1000, lang.code, true)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-imported",
    onClick: handleImportedClick
  }, lang('MessageMetaImported'))), message.isEdited && `${lang('MessageMetaEdited')} `, message.isVideoProcessingPending && `${lang('MessageMetaApproximate')} `, date), outgoingStatus && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MessageOutgoingStatus__WEBPACK_IMPORTED_MODULE_12__["default"], {
    status: outgoingStatus
  }), renderQuickReactionButton && renderQuickReactionButton());
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MessageMeta));

/***/ },

/***/ "./src/components/middle/message/MessagePhoneCall.module.scss"
/*!********************************************************************!*\
  !*** ./src/components/middle/message/MessagePhoneCall.module.scss ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"wqsZyy8u","button":"NGmo4ADz","info":"iFn6m6hd","reason":"l8QfocIQ","arrow":"ONmpzmUS","incoming":"BfgDXljM","missed":"Alra_BWu","canceled":"J7xsuCAm","meta":"rF5tkx92","duration":"kKPKwFzu"});

/***/ },

/***/ "./src/components/middle/message/MessagePhoneCall.tsx"
/*!************************************************************!*\
  !*** ./src/components/middle/message/MessagePhoneCall.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _helpers_messageActions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./helpers/messageActions */ "./src/components/middle/message/helpers/messageActions.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./MessagePhoneCall.module.scss */ "./src/components/middle/message/MessagePhoneCall.module.scss");












const MessagePhoneCall = ({
  phoneCall,
  message,
  chatId
}) => {
  const {
    requestMasterAndRequestCall
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    isVideo,
    reason,
    duration
  } = phoneCall;
  const isOutgoing = message.isOutgoing;
  const isMissed = reason === 'missed';
  const isCancelled = reason === 'busy' || duration === undefined;
  const handleCall = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    requestMasterAndRequestCall({
      isVideo,
      userId: chatId
    });
  });
  const formattedDuration = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return phoneCall.duration ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatTimeDuration)(lang, phoneCall.duration) : undefined;
  }, [lang, phoneCall.duration]);
  const timeFormatted = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatTime)(lang, message.date * 1000);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
    size: "smaller",
    color: "translucent",
    round: true,
    ripple: true,
    onClick: handleCall,
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].button,
    disabled: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.ARE_CALLS_SUPPORTED,
    ariaLabel: lang(isOutgoing ? 'CallAgain' : 'CallBack')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
    name: isVideo ? 'video-outlined' : 'phone'
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].info
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].reason
  }, lang((0,_helpers_messageActions__WEBPACK_IMPORTED_MODULE_5__.getCallMessageKey)(phoneCall, message.isOutgoing))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].meta
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
    name: "arrow-right",
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].arrow, isMissed && _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].missed, isCancelled && _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].canceled, !isOutgoing && _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].incoming)
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _MessagePhoneCall_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].duration
  }, formattedDuration ? lang('CallMessageWithDuration', [timeFormatted, formattedDuration]) : timeFormatted))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MessagePhoneCall));

/***/ },

/***/ "./src/components/middle/message/PaidMediaOverlay.module.scss"
/*!********************************************************************!*\
  !*** ./src/components/middle/message/PaidMediaOverlay.module.scss ***!
  \********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"mVaSjZRJ","buyButton":"GnKGu6D9","boughtStatus":"IGXW5hWr","star":"ywiOugiH","buttonText":"gLaaVQXr"});

/***/ },

/***/ "./src/components/middle/message/PaidMediaOverlay.tsx"
/*!************************************************************!*\
  !*** ./src/components/middle/message/PaidMediaOverlay.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_replaceWithTeact__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/replaceWithTeact */ "./src/util/replaceWithTeact.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./PaidMediaOverlay.module.scss */ "./src/components/middle/message/PaidMediaOverlay.module.scss");














const PaidMediaOverlay = ({
  paidMedia,
  chatId,
  messageId,
  isOutgoing,
  children
}) => {
  const {
    openInvoice
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const isClickable = !paidMedia.isBought;
  const buttonText = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const value = oldLang('UnlockPaidContent', paidMedia.starsAmount);
    return (0,_util_replaceWithTeact__WEBPACK_IMPORTED_MODULE_5__.replaceWithTeact)(value, _config__WEBPACK_IMPORTED_MODULE_2__.STARS_ICON_PLACEHOLDER, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_10__["default"], {
      className: _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].star,
      type: "gold",
      size: "adaptive"
    }));
  }, [oldLang, paidMedia]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(e => {
    openInvoice({
      type: 'message',
      chatId,
      messageId
    });
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_6__["default"])(e);
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].root,
    onClick: isClickable ? handleClick : undefined
  }, children, isClickable && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
    className: _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].buyButton,
    color: "dark",
    size: "tiny",
    fluid: true,
    pill: true
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].buttonText
  }, buttonText)), paidMedia.isBought && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('message-paid-media-status', _PaidMediaOverlay_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].boughtStatus)
  }, isOutgoing ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, paidMedia.starsAmount) : oldLang('Chat.PaidMedia.Purchased')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PaidMediaOverlay));

/***/ },

/***/ "./src/components/middle/message/Photo.tsx"
/*!*************************************************!*\
  !*** ./src/components/middle/message/Photo.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _helpers_getCustomAppendixBg__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./helpers/getCustomAppendixBg */ "./src/components/middle/message/helpers/getCustomAppendixBg.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/middle/message/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLayoutEffectWithPrevDeps */ "./src/hooks/useLayoutEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useMediaTransition__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useMediaTransition */ "./src/hooks/useMediaTransition.ts");
/* harmony import */ var _hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useMediaWithLoadProgress */ "./src/hooks/useMediaWithLoadProgress.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./hooks/useBlurredMediaThumbRef */ "./src/components/middle/message/hooks/useBlurredMediaThumbRef.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _common_SensitiveContentConfirmModal__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../common/SensitiveContentConfirmModal */ "./src/components/common/SensitiveContentConfirmModal.tsx");
/* harmony import */ var _ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/ProgressSpinner */ "./src/components/ui/ProgressSpinner.tsx");
























const Photo = ({
  id,
  photo,
  messageText,
  isOwn,
  noAvatars,
  canAutoLoad,
  isInSelectMode,
  isSelected,
  uploadProgress,
  forcedWidth,
  size = 'inline',
  dimensions,
  asForwarded,
  nonInteractive,
  shouldAffectAppendix,
  isDownloading,
  isProtected,
  theme,
  isInWebPage,
  clickArg,
  className,
  isMediaNsfw,
  observeIntersection,
  onClick,
  onCancelUpload,
  needsAgeVerification
}) => {
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isPaidPreview = photo.mediaType === 'extendedMediaPreview';
  const localBlobUrl = !isPaidPreview ? photo.blobUrl : undefined;
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_10__.useIsIntersecting)(ref, observeIntersection);
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [isLoadAllowed, setIsLoadAllowed] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(canAutoLoad);
  const shouldLoad = isLoadAllowed && isIntersecting && !isPaidPreview;
  const {
    mediaData,
    loadProgress
  } = (0,_hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_14__["default"])(!isPaidPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getPhotoMediaHash)(photo, size) : undefined, !shouldLoad);
  const prevMediaData = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_15__["default"])(mediaData);
  const fullMediaData = localBlobUrl || mediaData;
  const {
    ref: fullMediaRef,
    shouldRender: shouldRenderFullMedia
  } = (0,_hooks_useMediaTransition__WEBPACK_IMPORTED_MODULE_13__["default"])({
    hasMediaData: Boolean(fullMediaData),
    withShouldRender: true
  });
  const withBlurredBackground = Boolean(forcedWidth);
  const [withThumb] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!fullMediaData);
  const noThumb = Boolean(fullMediaData);
  const thumbRef = (0,_hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_18__["default"])(photo, noThumb);
  (0,_hooks_useMediaTransition__WEBPACK_IMPORTED_MODULE_13__["default"])({
    ref: thumbRef,
    hasMediaData: !noThumb
  });
  const blurredBackgroundRef = (0,_hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_18__["default"])(photo, !withBlurredBackground);
  const thumbDataUri = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaThumbUri)(photo);
  const {
    updateContentSettings,
    openAgeVerificationModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isNsfwModalOpen, openNsfwModal, closeNsfwModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [shouldAlwaysShowNsfw, setShouldAlwaysShowNsfw] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const shouldShowSpoiler = isPaidPreview || photo.isSpoiler || isMediaNsfw;
  const [isSpoilerShown, showSpoiler, hideSpoiler] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])(shouldShowSpoiler);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldShowSpoiler) {
      showSpoiler();
    } else {
      hideSpoiler();
    }
  }, [shouldShowSpoiler]);
  const handleNsfwConfirm = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    closeNsfwModal();
    hideSpoiler();
    if (shouldAlwaysShowNsfw) {
      updateContentSettings({
        isSensitiveEnabled: true
      });
    }
  });
  const {
    loadProgress: downloadProgress
  } = (0,_hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_14__["default"])(!isPaidPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getPhotoMediaHash)(photo, 'download') : undefined, !isDownloading, !isPaidPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaFormat)(photo, 'download') : undefined);
  const {
    isUploading,
    isTransferring,
    transferProgress
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_4__.getMediaTransferState)(uploadProgress || (isDownloading ? downloadProgress : loadProgress), shouldLoad && !fullMediaData, uploadProgress !== undefined);
  const wasLoadDisabled = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__["default"])(isLoadAllowed) === false;
  const {
    ref: spinnerRef,
    shouldRender: shouldRenderSpinner
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_17__["default"])({
    isOpen: isTransferring,
    noMountTransition: wasLoadDisabled,
    className: 'slow',
    withShouldRender: true
  });
  const {
    ref: downloadButtonRef,
    shouldRender: shouldRenderDownloadButton
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_17__["default"])({
    isOpen: !fullMediaData && !isLoadAllowed,
    withShouldRender: true
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    if (isUploading) {
      onCancelUpload?.(clickArg);
      return;
    }
    if (!fullMediaData) {
      setIsLoadAllowed(isAllowed => !isAllowed);
      return;
    }
    if (isSpoilerShown) {
      if (isMediaNsfw) {
        if (needsAgeVerification) {
          openAgeVerificationModal();
          return;
        }
        openNsfwModal();
        return;
      }
      hideSpoiler();
      return;
    }
    onClick?.(clickArg, e);
  });
  (0,_hooks_useLayoutEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_12__["default"])(([prevShouldAffectAppendix]) => {
    if (!shouldAffectAppendix) {
      if (prevShouldAffectAppendix) {
        ref.current.closest(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_CONTENT_SELECTOR).removeAttribute(_config__WEBPACK_IMPORTED_MODULE_2__.CUSTOM_APPENDIX_ATTRIBUTE);
      }
      return;
    }
    const contentEl = ref.current.closest(_config__WEBPACK_IMPORTED_MODULE_2__.MESSAGE_CONTENT_SELECTOR);
    if (fullMediaData) {
      const messageId = Number(contentEl.closest('.Message').dataset.messageId);
      (0,_helpers_getCustomAppendixBg__WEBPACK_IMPORTED_MODULE_6__["default"])(fullMediaData, Boolean(isOwn), messageId, isSelected, theme).then(appendixBg => {
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMutation)(() => {
          contentEl.style.setProperty('--appendix-bg', appendixBg);
          contentEl.setAttribute(_config__WEBPACK_IMPORTED_MODULE_2__.CUSTOM_APPENDIX_ATTRIBUTE, '');
        });
      });
    } else {
      contentEl.classList.add('has-appendix-thumb');
    }
  }, [shouldAffectAppendix, fullMediaData, isOwn, isInSelectMode, isSelected, theme]);
  const {
    width,
    height,
    isSmall
  } = dimensions || (0,_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__.calculateMediaDimensions)({
    media: photo,
    isOwn,
    asForwarded,
    noAvatars,
    isMobile,
    messageText,
    isInWebPage
  });
  const componentClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('media-inner', !isUploading && !nonInteractive && 'interactive', isSmall && 'small-image', (width === height || size === 'pictogram') && 'square-image', height < _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__.MIN_MEDIA_HEIGHT && 'fix-min-height', className);
  const dimensionsStyle = dimensions ? ` width: ${width}px; left: ${dimensions.x}px; top: ${dimensions.y}px;` : '';
  const style = size === 'inline' ? `height: ${height}px;${dimensionsStyle}` : undefined;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    id: id,
    ref: ref,
    className: componentClassName,
    style: style,
    onClick: isUploading ? undefined : handleClick
  }, withBlurredBackground && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: blurredBackgroundRef,
    className: "thumbnail blurred-bg"
  }), fullMediaData && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    ref: fullMediaRef,
    src: fullMediaData || prevMediaData,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('full-media', withBlurredBackground && 'with-blurred-bg'),
    alt: "",
    style: forcedWidth ? `width: ${forcedWidth}px` : undefined,
    draggable: !isProtected
  }), withThumb && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: thumbRef,
    className: "thumbnail"
  }), isProtected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  }), shouldRenderSpinner && !shouldRenderDownloadButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: spinnerRef,
    className: "media-loading"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_22__["default"], {
    progress: transferProgress,
    onClick: isUploading ? handleClick : undefined
  })), shouldRenderDownloadButton && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    ref: downloadButtonRef,
    name: "download"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_20__["default"], {
    isVisible: isSpoilerShown,
    withAnimation: true,
    thumbDataUri: thumbDataUri,
    width: width,
    height: height,
    className: "media-spoiler",
    isNsfw: isMediaNsfw
  }), isTransferring && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-transfer-progress"
  }, Math.round(transferProgress * 100), "%"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_SensitiveContentConfirmModal__WEBPACK_IMPORTED_MODULE_21__["default"], {
    isOpen: isNsfwModalOpen,
    onClose: closeNsfwModal,
    shouldAlwaysShow: shouldAlwaysShowNsfw,
    onAlwaysShowChanged: setShouldAlwaysShowNsfw,
    confirmHandler: handleNsfwConfirm
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const appConfig = global.appConfig;
  const needsAgeVerification = appConfig?.needAgeVideoVerification;
  return {
    needsAgeVerification
  };
})(Photo)));

/***/ },

/***/ "./src/components/middle/message/Poll.scss"
/*!*************************************************!*\
  !*** ./src/components/middle/message/Poll.scss ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/Poll.tsx"
/*!************************************************!*\
  !*** ./src/components/middle/message/Poll.tsx ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AvatarList__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/AvatarList */ "./src/components/common/AvatarList.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_CheckboxGroup__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/CheckboxGroup */ "./src/components/ui/CheckboxGroup.tsx");
/* harmony import */ var _ui_RadioGroup__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/RadioGroup */ "./src/components/ui/RadioGroup.tsx");
/* harmony import */ var _PollOption__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./PollOption */ "./src/components/middle/message/PollOption.tsx");
/* harmony import */ var _Poll_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./Poll.scss */ "./src/components/middle/message/Poll.scss");

















const SOLUTION_CONTAINER_ID = '#middle-column-portals';
const SOLUTION_DURATION = 5000;
const TIMER_RADIUS = 6;
const TIMER_CIRCUMFERENCE = TIMER_RADIUS * 2 * Math.PI;
const TIMER_UPDATE_INTERVAL = 1000;
const NBSP = '\u00A0';
const Poll = ({
  message,
  poll,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  onSendVote
}) => {
  const {
    loadMessage,
    openPollResults,
    requestConfetti,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    id: messageId,
    chatId
  } = message;
  const {
    summary,
    results
  } = poll;
  const [isSubmitting, setIsSubmitting] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [chosenOptions, setChosenOptions] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [wasSubmitted, setWasSubmitted] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [closePeriod, setClosePeriod] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(!summary.closed && summary.closeDate && summary.closeDate > 0 ? Math.min(summary.closeDate - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_5__.getServerTime)(), summary.closePeriod) : 0);
  const countdownRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const timerCircleRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    results: voteResults,
    totalVoters
  } = results;
  const hasVoted = voteResults && voteResults.some(r => r.isChosen);
  const canVote = !summary.closed && !hasVoted;
  const canViewResult = !canVote && summary.isPublic && Number(results.totalVoters) > 0;
  const isMultiple = canVote && summary.multipleChoice;
  const recentVoterIds = results.recentVoterIds;
  const maxVotersCount = voteResults ? Math.max(...voteResults.map(r => r.votersCount)) : totalVoters;
  const correctResults = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return voteResults?.filter(r => r.isCorrect).map(r => r.option) || [];
  }, [voteResults]);
  const answers = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => summary.answers.map(a => ({
    label: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_6__.renderTextWithEntities)({
      text: a.text.text,
      entities: a.text.entities,
      observeIntersectionForLoading,
      observeIntersectionForPlaying
    }),
    value: a.option,
    hidden: Boolean(summary.quiz && summary.closePeriod && closePeriod <= 0)
  })), [closePeriod, observeIntersectionForLoading, observeIntersectionForPlaying, summary.answers, summary.closePeriod, summary.quiz]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const chosen = poll.results.results?.find(result => result.isChosen);
    if (isSubmitting && chosen) {
      if (chosen.isCorrect) {
        requestConfetti({});
      }
      setIsSubmitting(false);
    }
  }, [isSubmitting, poll.results.results, requestConfetti]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (closePeriod > 0) {
      setTimeout(() => setClosePeriod(closePeriod - 1), TIMER_UPDATE_INTERVAL);
    }
    if (!timerCircleRef.current) return;
    if (closePeriod <= 5) {
      countdownRef.current.classList.add('hurry-up');
    }
    const strokeDashOffset = (summary.closePeriod - closePeriod) / summary.closePeriod * TIMER_CIRCUMFERENCE;
    timerCircleRef.current.setAttribute('stroke-dashoffset', `-${strokeDashOffset}`);
  }, [closePeriod, summary.closePeriod]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (summary.quiz && (closePeriod <= 0 || hasVoted && !summary.closed)) {
      loadMessage({
        chatId,
        messageId
      });
    }
  }, [chatId, closePeriod, hasVoted, loadMessage, messageId, summary.closed, summary.quiz]);

  // If the client time is not synchronized, the poll must be updated after the closePeriod time has expired.
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    let timer;
    if (summary.quiz && !summary.closed && summary.closePeriod && summary.closePeriod > 0) {
      timer = window.setTimeout(() => {
        loadMessage({
          chatId,
          messageId
        });
      }, summary.closePeriod * 1000);
    }
    return () => {
      if (timer) {
        window.clearTimeout(timer);
      }
    };
  }, [canVote, chatId, loadMessage, messageId, summary.closePeriod, summary.closed, summary.quiz]);
  const recentVoters = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    // No need for expensive global updates on chats or users, so we avoid them
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return recentVoterIds ? recentVoterIds.reduce((result, id) => {
      const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeer)(global, id);
      if (peer) {
        result.push(peer);
      }
      return result;
    }, []) : [];
  }, [recentVoterIds]);
  const handleRadioChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(option => {
    setChosenOptions([option]);
    setIsSubmitting(true);
    setWasSubmitted(true);
    onSendVote([option]);
  });
  const handleCheckboxChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(options => {
    setChosenOptions(options);
  });
  const handleVoteClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    setIsSubmitting(true);
    setWasSubmitted(true);
    onSendVote(chosenOptions);
  });
  const handleViewResultsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    openPollResults({
      chatId,
      messageId
    });
  });
  const showSolution = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    showNotification({
      localId: (0,_util_keys_messageKey__WEBPACK_IMPORTED_MODULE_4__.getMessageKey)(message),
      message: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_6__.renderTextWithEntities)({
        text: poll.results.solution,
        entities: poll.results.solutionEntities
      }),
      duration: SOLUTION_DURATION,
      containerSelector: SOLUTION_CONTAINER_ID
    });
  });

  // Show the solution to quiz if the answer was incorrect
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (wasSubmitted && hasVoted && summary.quiz && results.results && poll.results.solution) {
      const correctResult = results.results.find(r => r.isChosen && r.isCorrect);
      if (!correctResult) {
        showSolution();
      }
    }
  }, [hasVoted, wasSubmitted, results.results, summary.quiz, poll.results.solution]);
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  function renderResultOption(answer) {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_PollOption__WEBPACK_IMPORTED_MODULE_14__["default"], {
      key: answer.option,
      shouldAnimate: wasSubmitted || !canVote,
      answer: answer,
      voteResults: voteResults,
      totalVoters: totalVoters,
      maxVotersCount: maxVotersCount,
      correctResults: correctResults
    });
  }
  function renderRecentVoters() {
    return recentVoters.length > 0 && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "poll-recent-voters"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AvatarList__WEBPACK_IMPORTED_MODULE_9__["default"], {
      size: "micro",
      peers: recentVoters
    }));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "Poll",
    dir: lang.isRtl ? 'auto' : 'ltr'
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-question"
  }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_6__.renderTextWithEntities)({
    text: summary.question.text,
    entities: summary.question.entities,
    observeIntersectionForLoading,
    observeIntersectionForPlaying
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-type"
  }, lang(getPollTypeString(summary)), renderRecentVoters(), closePeriod > 0 && canVote && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: countdownRef,
    className: "poll-countdown"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_3__.formatMediaDuration)(closePeriod)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    width: "16px",
    height: "16px"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("circle", {
    ref: timerCircleRef,
    cx: "8",
    cy: "8",
    r: TIMER_RADIUS,
    className: "poll-countdown-progress",
    transform: "rotate(-90, 8, 8)",
    "stroke-dasharray": TIMER_CIRCUMFERENCE,
    "stroke-dashoffset": "0"
  }))), summary.quiz && poll.results.solution && !canVote && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
    round: true,
    size: "tiny",
    color: "translucent",
    className: "poll-quiz-help",
    onClick: showSolution,
    ariaLabel: "Show Solution"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_10__["default"], {
    name: "lamp"
  }))), canVote && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-answers",
    onClick: stopPropagation
  }, isMultiple ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_CheckboxGroup__WEBPACK_IMPORTED_MODULE_12__["default"], {
    options: answers,
    selected: chosenOptions,
    onChange: handleCheckboxChange,
    disabled: message.isScheduled || isSubmitting,
    loadingOptions: isSubmitting ? chosenOptions : undefined,
    isRound: true
  }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_RadioGroup__WEBPACK_IMPORTED_MODULE_13__["default"], {
    name: `poll-${messageId}`,
    options: answers,
    onChange: handleRadioChange,
    disabled: message.isScheduled || isSubmitting,
    loadingOption: isSubmitting ? chosenOptions[0] : undefined
  })), !canVote && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-results"
  }, summary.answers.map(renderResultOption)), !canViewResult && !isMultiple && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-voters-count"
  }, getReadableVotersCount(lang, summary.quiz, results.totalVoters)), isMultiple && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isText: true,
    disabled: chosenOptions.length === 0,
    size: "tiny",
    onClick: handleVoteClick
  }, lang('PollSubmitVotes')), canViewResult && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
    isText: true,
    size: "tiny",
    onClick: handleViewResultsClick
  }, lang('PollViewResults')));
};
function getPollTypeString(summary) {
  // When we just created the poll, some properties don't exist.
  if (typeof summary.isPublic === 'undefined') {
    return NBSP;
  }
  if (summary.closed) {
    return 'FinalResults';
  }
  if (summary.quiz) {
    return summary.isPublic ? 'QuizPoll' : 'AnonymousQuizPoll';
  }
  return summary.isPublic ? 'PublicPoll' : 'AnonymousPoll';
}
function getReadableVotersCount(lang, isQuiz, count) {
  if (!count) {
    return lang(isQuiz ? 'Chat.Quiz.TotalVotesEmpty' : 'Chat.Poll.TotalVotesResultEmpty');
  }
  return lang(isQuiz ? 'Answer' : 'Vote', count, 'i');
}
function stopPropagation(e) {
  e.stopPropagation();
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(Poll));

/***/ },

/***/ "./src/components/middle/message/PollOption.scss"
/*!*******************************************************!*\
  !*** ./src/components/middle/message/PollOption.scss ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/PollOption.tsx"
/*!******************************************************!*\
  !*** ./src/components/middle/message/PollOption.tsx ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _PollOption_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./PollOption.scss */ "./src/components/middle/message/PollOption.scss");







const PollOption = ({
  answer,
  voteResults,
  totalVoters,
  maxVotersCount,
  correctResults,
  shouldAnimate
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_3__["default"])();
  const result = voteResults && voteResults.find(r => r.option === answer.option);
  const correctAnswer = correctResults.length === 0 || correctResults.indexOf(answer.option) !== -1;
  const showIcon = correctResults.length > 0 && correctAnswer || result?.isChosen;
  const answerPercent = result ? getPercentage(result.votersCount, totalVoters || 0) : 0;
  const [finalPercent, setFinalPercent] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(shouldAnimate ? 0 : answerPercent);
  const lineWidth = result ? getPercentage(result.votersCount, maxVotersCount || 0) : 0;
  const isAnimationDoesNotStart = finalPercent !== answerPercent;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldAnimate) {
      setFinalPercent(answerPercent);
    }
  }, [shouldAnimate, answerPercent]);
  if (!voteResults || !result) {
    return undefined;
  }
  const lineStyle = `width: ${lineWidth}%; transform:scaleX(${isAnimationDoesNotStart ? 0 : 1})`;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "PollOption",
    dir: lang.isRtl ? 'rtl' : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: `poll-option-share ${answerPercent === '100' ? 'limit-width' : ''}`
  }, answerPercent, "%", showIcon && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('poll-option-chosen', !correctAnswer && 'wrong', shouldAnimate && 'animate')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
    name: correctAnswer ? 'check' : 'close',
    className: "poll-option-icon"
  }))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-option-right"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-option-text",
    dir: "auto"
  }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_2__.renderTextWithEntities)({
    text: answer.text.text,
    entities: answer.text.entities
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])('poll-option-answer', showIcon && !correctAnswer && 'wrong')
  }, shouldAnimate && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    className: "poll-line",
    style: !isAnimationDoesNotStart ? 'stroke-dasharray: 100% 200%; stroke-dashoffset: -44' : ''
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("path", {
    d: "M4.47 5.33v13.6a9 9 0 009 9h13"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "poll-option-line",
    style: lineStyle
  }))));
};
function getPercentage(value, total) {
  return total > 0 ? (value / total * 100).toFixed() : 0;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PollOption);

/***/ },

/***/ "./src/components/middle/message/RoundVideo.scss"
/*!*******************************************************!*\
  !*** ./src/components/middle/message/RoundVideo.scss ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/RoundVideo.tsx"
/*!******************************************************!*\
  !*** ./src/components/middle/message/RoundVideo.tsx ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_audioPlayer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/audioPlayer */ "./src/util/audioPlayer.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_safePlay__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/safePlay */ "./src/util/safePlay.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/media/useThumbnail */ "./src/hooks/media/useThumbnail.ts");
/* harmony import */ var _hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useAsyncResolvers */ "./src/hooks/useAsyncResolvers.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMediaTransition__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useMediaTransition */ "./src/hooks/useMediaTransition.ts");
/* harmony import */ var _hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useMediaWithLoadProgress */ "./src/hooks/useMediaWithLoadProgress.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./hooks/useBlurredMediaThumbRef */ "./src/components/middle/message/hooks/useBlurredMediaThumbRef.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/OptimizedVideo */ "./src/components/ui/OptimizedVideo.tsx");
/* harmony import */ var _ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../ui/ProgressSpinner */ "./src/components/ui/ProgressSpinner.tsx");
/* harmony import */ var _RoundVideo_scss__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./RoundVideo.scss */ "./src/components/middle/message/RoundVideo.scss");


























const PROGRESS_CENTER = _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX / 2;
const PROGRESS_MARGIN = 6;
const PROGRESS_CIRCUMFERENCE = (PROGRESS_CENTER - PROGRESS_MARGIN) * 2 * Math.PI;
const PROGRESS_THROTTLE = 16; // Min period needed for `playerEl.currentTime` to update

let stopPrevious;
const RoundVideo = ({
  message,
  className,
  canAutoLoad,
  isDownloading,
  origin,
  observeIntersection,
  onStop,
  onReadMedia,
  isTranscriptionError,
  isTranscribed,
  canTranscribe,
  onHideTranscription,
  isTranscriptionHidden,
  isTranscribing
}) => {
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const playerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const circleRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    cancelMediaDownload,
    openOneTimeMediaModal,
    transcribeAudio
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isIntersecting = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_12__.useIsIntersecting)(ref, observeIntersection);
  const video = message.content.video;
  const isMediaUnread = message.isMediaUnread;
  const [isLoadAllowed, setIsLoadAllowed] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(canAutoLoad);
  const shouldLoad = Boolean(isLoadAllowed && isIntersecting);
  const {
    mediaData,
    loadProgress
  } = (0,_hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_15__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getVideoMediaHash)(video, 'inline'), !shouldLoad, (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMediaFormat)(video, 'inline'));
  const {
    loadProgress: downloadProgress
  } = (0,_hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_15__["default"])((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getVideoMediaHash)(video, 'download'), !isDownloading, _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl);
  const [isPlayerReady, markPlayerReady] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const hasTtl = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.hasMessageTtl)(message);
  const isInOneTimeModal = origin === 'oneTimeModal';
  const shouldRenderSpoiler = hasTtl && !isInOneTimeModal;
  const thumbDataUri = (0,_hooks_media_useThumbnail__WEBPACK_IMPORTED_MODULE_9__["default"])(message);
  const hasThumb = Boolean(thumbDataUri);
  const noThumb = !hasThumb || isPlayerReady || shouldRenderSpoiler;
  const thumbRef = (0,_hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_18__["default"])(video, noThumb);
  (0,_hooks_useMediaTransition__WEBPACK_IMPORTED_MODULE_14__["default"])({
    hasMediaData: !noThumb,
    ref: thumbRef
  });
  const isTransferring = isLoadAllowed && !isPlayerReady || isDownloading;
  const wasLoadDisabled = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__["default"])(isLoadAllowed) === false;
  const {
    ref: spinnerRef,
    shouldRender: shouldRenderSpinner
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_17__["default"])({
    isOpen: isTransferring,
    noMountTransition: wasLoadDisabled,
    withShouldRender: true
  });
  const [isActivated, setIsActivated] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [currentTime, setCurrentTime] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [getProgress, setProgress] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)(0);
  const getThrottledProgress = (0,_hooks_useAsyncResolvers__WEBPACK_IMPORTED_MODULE_10__.useThrottledSignal)(getProgress, PROGRESS_THROTTLE);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isActivated) {
      return;
    }
    const playerEl = playerRef.current;
    setProgress(playerEl.currentTime / playerEl.duration);
  }, [setProgress, isActivated, getThrottledProgress]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!isActivated || !circleRef.current) {
      return;
    }
    const strokeDashOffset = PROGRESS_CIRCUMFERENCE - getThrottledProgress() * PROGRESS_CIRCUMFERENCE;
    circleRef.current.setAttribute('stroke-dashoffset', strokeDashOffset.toString());
  }, [isActivated, getThrottledProgress]);
  const shouldPlay = Boolean(mediaData && isIntersecting);
  const stopPlaying = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!playerRef.current) {
      return;
    }
    setIsActivated(false);
    setProgress(0);
    (0,_util_safePlay__WEBPACK_IMPORTED_MODULE_7__["default"])(playerRef.current);
  });
  const capturePlaying = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    stopPrevious?.();
    stopPrevious = stopPlaying;
  });
  const togglePlaying = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    const playerEl = playerRef.current;
    if (isActivated) {
      if (playerEl.paused) {
        (0,_util_safePlay__WEBPACK_IMPORTED_MODULE_7__["default"])(playerEl);
        (0,_util_audioPlayer__WEBPACK_IMPORTED_MODULE_4__.stopCurrentAudio)();
      } else {
        playerEl.pause();
      }
    } else {
      capturePlaying();
      // Pause is a workaround for iOS Safari – otherwise it stops video after several frames
      playerEl.pause();
      playerEl.currentTime = 0;
      (0,_util_safePlay__WEBPACK_IMPORTED_MODULE_7__["default"])(playerEl);
      (0,_util_audioPlayer__WEBPACK_IMPORTED_MODULE_4__.stopCurrentAudio)();
      setIsActivated(true);
    }
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isInOneTimeModal) {
      return;
    }
    togglePlaying();
  }, [isInOneTimeModal]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(event => {
    if (event.target.closest('.transcribe-button')) {
      return;
    }
    if (!mediaData) {
      setIsLoadAllowed(isAllowed => !isAllowed);
      return;
    }
    if (isDownloading) {
      cancelMediaDownload({
        media: video
      });
      return;
    }
    if (hasTtl && !isInOneTimeModal) {
      openOneTimeMediaModal({
        message
      });
      onReadMedia?.();
      return;
    }
    togglePlaying();
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (onReadMedia && isMediaUnread && isActivated) {
      onReadMedia();
    }
  }, [isActivated, isMediaUnread, onReadMedia]);
  const handleTimeUpdate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(e => {
    const playerEl = e.currentTarget;
    setProgress(playerEl.currentTime / playerEl.duration);
    setCurrentTime(Math.floor(playerEl.currentTime));
  });
  const handleTranscribe = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    transcribeAudio({
      chatId: message.chatId,
      messageId: message.id
    });
  });
  function renderPlayWrapper() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "play-wrapper"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
      color: "dark",
      round: true,
      size: "smaller",
      className: "play",
      nonInteractive: true
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
      name: "play"
    })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
      name: "view-once"
    }));
  }
  const handleButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if ((isTranscribed || isTranscriptionError) && onHideTranscription) {
      onHideTranscription(!isTranscriptionHidden);
    } else if (!isTranscribing) {
      handleTranscribe();
    }
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('RoundVideo', 'media-inner', isInOneTimeModal && 'non-interactive', className),
    onClick: handleClick
  }, mediaData && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "video-wrapper"
  }, shouldRenderSpoiler && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_20__["default"], {
    isVisible: true,
    thumbDataUri: thumbDataUri,
    width: _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX,
    height: _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX,
    className: "media-spoiler"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_22__["default"], {
    canPlay: shouldPlay,
    ref: playerRef,
    src: mediaData,
    className: "full-media",
    width: _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX,
    height: _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX,
    autoPlay: !shouldRenderSpoiler,
    disablePictureInPicture: true,
    muted: !isActivated,
    defaultMuted: true,
    loop: !isActivated,
    playsInline: true,
    isPriority: true,
    onEnded: isActivated ? onStop ?? stopPlaying : undefined,
    onTimeUpdate: isActivated ? handleTimeUpdate : undefined,
    onReady: markPlayerReady
  })), !shouldRenderSpoiler && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: thumbRef,
    className: "thumbnail",
    style: `width: ${_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX}px; height: ${_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX}px`
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "progress"
  }, isActivated && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    width: _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX,
    height: _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_8__.ROUND_VIDEO_DIMENSIONS_PX
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("circle", {
    ref: circleRef,
    cx: PROGRESS_CENTER,
    cy: PROGRESS_CENTER,
    r: PROGRESS_CENTER - PROGRESS_MARGIN,
    className: "progress-circle",
    transform: `rotate(-90, ${PROGRESS_CENTER}, ${PROGRESS_CENTER})`,
    "stroke-dasharray": PROGRESS_CIRCUMFERENCE,
    "stroke-dashoffset": PROGRESS_CIRCUMFERENCE
  }))), shouldRenderSpinner && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: spinnerRef,
    className: "media-loading"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_23__["default"], {
    progress: isDownloading ? downloadProgress : loadProgress
  })), shouldRenderSpoiler && !shouldRenderSpinner && renderPlayWrapper(), !mediaData && !isLoadAllowed && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    name: "download"
  }), !isInOneTimeModal && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('message-media-duration', isMediaUnread && 'unread')
  }, isActivated ? (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatMediaDuration)(currentTime) : (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatMediaDuration)(video.duration), (!isActivated || playerRef.current.paused) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    name: "muted"
  })), canTranscribe && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
    onClick: handleButtonClick,
    className: "transcribe-button"
  }, isTranscribed || isTranscriptionError ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    name: "down"
  }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    name: "transcribe"
  }), isTranscribing && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("svg", {
    viewBox: "0 0 32 24",
    className: "loading-svg"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("rect", {
    className: "loading-rect",
    fill: "transparent",
    width: "32",
    height: "24",
    "stroke-width": "3",
    "stroke-linejoin": "round",
    rx: "6",
    ry: "6",
    stroke: "white",
    "stroke-dashoffset": "1",
    "stroke-dasharray": "32,68"
  }))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (RoundVideo);

/***/ },

/***/ "./src/components/middle/message/SponsoredContextMenu.tsx"
/*!****************************************************************!*\
  !*** ./src/components/middle/message/SponsoredContextMenu.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../ui/MenuSeparator */ "./src/components/ui/MenuSeparator.tsx");
/* harmony import */ var _MessageContextMenu_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./MessageContextMenu.scss */ "./src/components/middle/message/MessageContextMenu.scss");








const SponsoredContextMenu = ({
  isOpen,
  sponsorInfo,
  canReport,
  anchor,
  triggerRef,
  shouldSkipAbout,
  onClose,
  onCloseAnimationEnd,
  onAboutAdsClick,
  onSponsoredHide,
  onSponsorInfo,
  onSponsoredReport
}) => {
  const menuRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_2__["default"])();
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__["default"])(() => triggerRef.current);
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__["default"])(() => ({
    withPortal: true
  }));
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__["default"])(() => menuRef.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_1__["default"])(() => document.body);
  const isSeparatorNeeded = sponsorInfo || !shouldSkipAbout || canReport;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_3__["default"], {
    ref: menuRef,
    isOpen: isOpen,
    anchor: anchor,
    withPortal: true,
    className: "with-menu-transitions",
    getLayout: getLayout,
    getTriggerElement: getTriggerElement,
    getMenuElement: getMenuElement,
    getRootElement: getRootElement,
    onClose: onClose,
    onCloseAnimationEnd: onCloseAnimationEnd
  }, sponsorInfo && onSponsorInfo && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_4__["default"], {
    icon: "channel",
    onClick: onSponsorInfo
  }, lang('SponsoredMessageSponsor')), !shouldSkipAbout && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_4__["default"], {
    icon: "info",
    onClick: onAboutAdsClick
  }, lang(canReport ? 'AboutRevenueSharingAds' : 'SponsoredMessageInfo')), canReport && onSponsoredReport && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_4__["default"], {
    icon: "hand-stop",
    onClick: onSponsoredReport
  }, lang('ReportAd')), isSeparatorNeeded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuSeparator__WEBPACK_IMPORTED_MODULE_5__["default"], null), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_4__["default"], {
    icon: "close-circle",
    onClick: onSponsoredHide
  }, lang('HideAd')));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(SponsoredContextMenu));

/***/ },

/***/ "./src/components/middle/message/SponsoredContextMenuContainer.tsx"
/*!*************************************************************************!*\
  !*** ./src/components/middle/message/SponsoredContextMenuContainer.tsx ***!
  \*************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _SponsoredContextMenu__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./SponsoredContextMenu */ "./src/components/middle/message/SponsoredContextMenu.tsx");






const SponsoredMessageContextMenuContainer = ({
  isOpen,
  randomId,
  sponsorInfo,
  additionalInfo,
  canReport,
  anchor,
  triggerRef,
  shouldSkipAbout,
  onItemClick,
  onClose,
  onCloseAnimationEnd
}) => {
  const {
    openAboutAdsModal,
    showDialog,
    reportSponsored,
    hideSponsored
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    ref
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_3__["default"])({
    isOpen,
    onCloseAnimationEnd
  });
  const handleItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    onItemClick?.();
    onClose();
  });
  const handleAboutAdsOpen = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    openAboutAdsModal({
      randomId,
      additionalInfo,
      canReport,
      sponsorInfo
    });
    handleItemClick();
  });
  const handleSponsoredHide = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    hideSponsored();
    handleItemClick();
  });
  const handleSponsorInfo = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    showDialog({
      data: {
        message: [sponsorInfo, additionalInfo].filter(Boolean).join('\n')
      }
    });
    handleItemClick();
  });
  const handleReportSponsoredMessage = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    reportSponsored({
      randomId
    });
    handleItemClick();
  });
  if (!anchor) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: "ContextMenuContainer"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SponsoredContextMenu__WEBPACK_IMPORTED_MODULE_4__["default"], {
    isOpen: isOpen,
    anchor: anchor,
    triggerRef: triggerRef,
    canReport: canReport,
    sponsorInfo: sponsorInfo,
    shouldSkipAbout: shouldSkipAbout,
    onClose: onClose,
    onCloseAnimationEnd: onClose,
    onAboutAdsClick: handleAboutAdsOpen,
    onSponsoredHide: handleSponsoredHide,
    onSponsorInfo: handleSponsorInfo,
    onSponsoredReport: handleReportSponsoredMessage
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(SponsoredMessageContextMenuContainer));

/***/ },

/***/ "./src/components/middle/message/Sticker.module.scss"
/*!***********************************************************!*\
  !*** ./src/components/middle/message/Sticker.module.scss ***!
  \***********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"FPceNkgD","inactive":"hruUWBuj","mirrored":"GydRBA08","effect":"WMMaWlOL"});

/***/ },

/***/ "./src/components/middle/message/Sticker.tsx"
/*!***************************************************!*\
  !*** ./src/components/middle/message/Sticker.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useOverlayPosition__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./hooks/useOverlayPosition */ "./src/components/middle/message/hooks/useOverlayPosition.ts");
/* harmony import */ var _common_AnimatedSticker__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/AnimatedSticker */ "./src/components/common/AnimatedSticker.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _common_SensitiveContentConfirmModal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/SensitiveContentConfirmModal */ "./src/components/common/SensitiveContentConfirmModal.tsx");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ui_Portal__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Portal */ "./src/components/ui/Portal.ts");
/* harmony import */ var _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./Sticker.module.scss */ "./src/components/middle/message/Sticker.module.scss");






















// https://github.com/telegramdesktop/tdesktop/blob/master/Telegram/SourceFiles/history/view/media/history_view_sticker.cpp#L42
const EFFECT_SIZE_MULTIPLIER = 1 + 0.245 * 2;
const Sticker = ({
  message,
  shouldLoop,
  shouldPlayEffect,
  withEffect,
  isMediaNsfw,
  onStopEffect,
  observeIntersection,
  observeIntersectionForPlaying,
  needsAgeVerification
}) => {
  const {
    showNotification,
    openStickerSet,
    updateContentSettings,
    openAgeVerificationModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const effectRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const sticker = message.content.sticker;
  const {
    stickerSetInfo,
    isVideo,
    hasEffect
  } = sticker;
  const isMirrored = !message.isOutgoing;
  const [isNsfwModalOpen, openNsfwModal, closeNsfwModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [shouldAlwaysShowNsfw, setShouldAlwaysShowNsfw] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const shouldShowSpoiler = isMediaNsfw;
  const [isSpoilerShown, showSpoiler, hideSpoiler] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])(shouldShowSpoiler);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldShowSpoiler) {
      showSpoiler();
    } else {
      hideSpoiler();
    }
  }, [shouldShowSpoiler]);
  const handleNsfwConfirm = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    closeNsfwModal();
    hideSpoiler();
    if (shouldAlwaysShowNsfw) {
      updateContentSettings({
        isSensitiveEnabled: true
      });
    }
  });
  const mediaHash = sticker.isPreloadedGlobally ? undefined : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getStickerMediaHash)(sticker, isVideo && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_WEBM_SUPPORTED ? 'pictogram' : 'inline');
  const canLoad = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_9__.useIsIntersecting)(ref, observeIntersection);
  const canPlay = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_9__.useIsIntersecting)(ref, observeIntersectionForPlaying);
  const mediaHashEffect = `sticker${sticker.id}?size=f`;
  const effectBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_11__["default"])(mediaHashEffect, !canLoad || !hasEffect || !withEffect, _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl);
  const [isPlayingEffect, startPlayingEffect, stopPlayingEffect] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const thumbDataUri = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMediaThumbUri)(sticker);
  const handleEffectEnded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    stopPlayingEffect();
    onStopEffect?.();
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (hasEffect && withEffect && canPlay && shouldPlayEffect) {
      startPlayingEffect();
    }
  }, [hasEffect, canPlay, shouldPlayEffect, startPlayingEffect, withEffect]);
  const shouldRenderEffect = hasEffect && withEffect && effectBlobUrl && isPlayingEffect;
  (0,_hooks_useOverlayPosition__WEBPACK_IMPORTED_MODULE_13__["default"])({
    anchorRef: ref,
    overlayRef: effectRef,
    isMirrored,
    isDisabled: !shouldRenderEffect
  });
  const openModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openStickerSet({
      stickerSetInfo: sticker.stickerSetInfo
    });
  });
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    if (isSpoilerShown) {
      if (isMediaNsfw) {
        if (needsAgeVerification) {
          openAgeVerificationModal();
          return;
        }
        openNsfwModal();
        return;
      }
      hideSpoiler();
      return;
    }
    if (hasEffect) {
      if (isPlayingEffect || !withEffect) {
        showNotification({
          message: lang('PremiumStickerTooltip'),
          action: {
            action: 'openStickerSet',
            payload: {
              stickerSetInfo: sticker.stickerSetInfo
            }
          },
          actionText: lang('ViewAction')
        });
        return;
      } else if (withEffect) {
        startPlayingEffect();
        return;
      }
    }
    openModal();
  });
  const isMemojiSticker = 'isMissing' in stickerSetInfo;
  const {
    width,
    height
  } = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.getStickerDimensions)(sticker, isMobile);
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('media-inner', _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].root, isMemojiSticker && _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].inactive, hasEffect && isMirrored && _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].mirrored);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: className,
    style: `width: ${width}px; height: ${height}px;`,
    onClick: !isMemojiSticker ? handleClick : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_StickerView__WEBPACK_IMPORTED_MODULE_17__["default"], {
    containerRef: ref,
    sticker: sticker,
    fullMediaHash: mediaHash,
    fullMediaClassName: "full-media",
    size: width,
    shouldLoop: shouldLoop,
    noLoad: !canLoad,
    noPlay: !canPlay,
    withSharedAnimation: true
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_15__["default"], {
    isVisible: isSpoilerShown,
    withAnimation: true,
    thumbDataUri: thumbDataUri,
    width: width,
    height: height,
    className: "media-spoiler",
    isNsfw: isMediaNsfw
  }), shouldRenderEffect && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Portal__WEBPACK_IMPORTED_MODULE_18__["default"], null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedSticker__WEBPACK_IMPORTED_MODULE_14__["default"], {
    ref: effectRef,
    key: mediaHashEffect,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_Sticker_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].effect, isMirrored && _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].mirrored),
    tgsUrl: effectBlobUrl,
    size: width * EFFECT_SIZE_MULTIPLIER,
    play: true,
    isLowPriority: true,
    noLoop: true,
    onEnded: handleEffectEnded
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_SensitiveContentConfirmModal__WEBPACK_IMPORTED_MODULE_16__["default"], {
    isOpen: isNsfwModalOpen,
    onClose: closeNsfwModal,
    shouldAlwaysShow: shouldAlwaysShowNsfw,
    onAlwaysShowChanged: setShouldAlwaysShowNsfw,
    confirmHandler: handleNsfwConfirm
  }), shouldRenderEffect && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Portal__WEBPACK_IMPORTED_MODULE_18__["default"], null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedSticker__WEBPACK_IMPORTED_MODULE_14__["default"], {
    ref: effectRef,
    key: mediaHashEffect,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_Sticker_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].effect, isMirrored && _Sticker_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].mirrored),
    tgsUrl: effectBlobUrl,
    size: width * EFFECT_SIZE_MULTIPLIER,
    play: true,
    isLowPriority: true,
    noLoop: true,
    onEnded: handleEffectEnded
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const appConfig = global.appConfig;
  const needsAgeVerification = appConfig?.needAgeVideoVerification;
  return {
    needsAgeVerification
  };
})(Sticker)));

/***/ },

/***/ "./src/components/middle/message/Story.tsx"
/*!*************************************************!*\
  !*** ./src/components/middle/message/Story.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _BaseStory__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./BaseStory */ "./src/components/middle/message/BaseStory.tsx");





function Story({
  message,
  story,
  isProtected,
  isConnected
}) {
  const {
    storyData
  } = message.content;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_BaseStory__WEBPACK_IMPORTED_MODULE_3__["default"], {
    story: story || storyData,
    isProtected: isProtected,
    isConnected: isConnected
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  message
}) => {
  const {
    id,
    peerId
  } = message.content.storyData;
  return {
    story: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectPeerStory)(global, peerId, id),
    isConnected: global.connectionState === 'connectionStateReady'
  };
})(Story)));

/***/ },

/***/ "./src/components/middle/message/StoryMention.tsx"
/*!********************************************************!*\
  !*** ./src/components/middle/message/StoryMention.tsx ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useEnsureStory */ "./src/hooks/useEnsureStory.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");












function StoryMention({
  message,
  story,
  peer,
  isUnread,
  targetUser
}) {
  const {
    openStoryViewer
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const {
    storyData
  } = message.content;
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openStoryViewer({
      peerId: story.peerId,
      storyId: story.id,
      isSinglePeer: true,
      isSingleStory: true
    });
  });
  const isDeleted = story && 'isDeleted' in story;
  const isLoaded = story && 'content' in story;
  const video = isLoaded ? story.content.video : undefined;
  const imageHash = isLoaded ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryMediaHash)(story, 'pictogram') : undefined;
  const imgBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_9__["default"])(imageHash);
  const thumbUrl = imgBlobUrl || video?.thumbnail?.dataUri;
  (0,_hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_7__["default"])(storyData.peerId, storyData.id, story);
  function getTitle() {
    if (peer && 'isSelf' in peer && peer.isSelf) {
      return isDeleted ? lang('ExpiredStoryMentioned', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(targetUser)) : lang('StoryYouMentionedTitle', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(targetUser));
    }
    return isDeleted ? lang('ExpiredStoryMention') : lang('StoryMentionedTitle', (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, peer));
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('action-message-story-mention', isUnread && 'is-unread', isLoaded && 'with-preview'),
    tabIndex: 0,
    role: "button",
    onClick: isLoaded ? handleClick : undefined
  }, isLoaded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "story-media-wrapper"
  }, thumbUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: thumbUrl,
    alt: "",
    className: "story-media"
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "story-title"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(getTitle(), ['emoji', 'simple_markdown'])));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  message
}) => {
  const {
    id,
    peerId
  } = message.content.storyData;
  const lastReadId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerStories)(global, peerId)?.lastReadId;
  return {
    story: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerStory)(global, peerId, id),
    peer: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId),
    targetUser: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, message.chatId),
    isUnread: Boolean(lastReadId && lastReadId < id)
  };
})(StoryMention)));

/***/ },

/***/ "./src/components/middle/message/TodoList.scss"
/*!*****************************************************!*\
  !*** ./src/components/middle/message/TodoList.scss ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/TodoList.tsx"
/*!****************************************************!*\
  !*** ./src/components/middle/message/TodoList.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_CheckboxGroup__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/CheckboxGroup */ "./src/components/ui/CheckboxGroup.tsx");
/* harmony import */ var _TodoList_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./TodoList.scss */ "./src/components/middle/message/TodoList.scss");













const TodoList = ({
  message,
  todoList,
  sender,
  isCurrentUserPremium,
  isSynced
}) => {
  const {
    toggleTodoCompleted,
    showNotification,
    requestConfetti
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    todo,
    completions
  } = todoList;
  const {
    title,
    items,
    othersCanComplete
  } = todo;
  const [completedTasks, setCompletedTasks] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const completedTasksSet = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => new Set(completedTasks), [completedTasks]);
  const canToggle = !message.isScheduled && isCurrentUserPremium && isSynced;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    const completedIds = completions?.map(c => c.itemId.toString()) || [];
    setCompletedTasks(completedIds);
  }, [completions]);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const handleTaskLabelClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(e => {
    e.preventDefault();
    e.stopPropagation();
    if (!isCurrentUserPremium) {
      showNotification({
        message: lang('SubscribeToTelegramPremiumForToggleTask'),
        action: {
          action: 'openPremiumModal',
          payload: {
            initialSection: 'todo'
          }
        },
        actionText: lang('PremiumMore')
      });
      return;
    }
  });
  const handleTaskToggle = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(newCompletedTasks => {
    const newCompletedId = newCompletedTasks.find(id => !completedTasksSet.has(id));
    const newIncompletedId = Array.from(completedTasksSet).find(id => !newCompletedTasks.includes(id));
    toggleTodoCompleted({
      chatId: message.chatId,
      messageId: message.id,
      completedIds: newCompletedId ? [Number(newCompletedId)] : [],
      incompletedIds: newIncompletedId ? [Number(newIncompletedId)] : []
    });
    if (newCompletedTasks.length === items.length) {
      requestConfetti({});
    }
  });
  const isReadOnly = Boolean(message.forwardInfo) || !othersCanComplete && !message.isOutgoing;
  const isOutgoing = message.isOutgoing;
  const tasks = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => items.map(task => {
    const user = !othersCanComplete ? undefined : (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), completions?.find(c => c.itemId === task.id)?.completedBy || '');
    const subLabel = user ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerFullTitle)(lang, user) : undefined;
    return {
      label: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_5__.renderTextWithEntities)(task.title),
      value: task.id.toString(),
      user,
      subLabel
    };
  }), [items, othersCanComplete, completions, lang]);
  const renderCheckBoxGroup = () => {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_CheckboxGroup__WEBPACK_IMPORTED_MODULE_10__["default"], {
      options: tasks,
      selected: completedTasks,
      onChange: handleTaskToggle,
      onClickLabel: !isCurrentUserPremium ? handleTaskLabelClick : undefined,
      disabled: !canToggle,
      isRound: true
    });
  };
  const renderReadOnlyTodoList = () => {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "todo-list-items"
    }, tasks.map(task => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      key: task.value,
      className: "todo-list-readonly-item"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "todo-readonly-item-checkbox"
    }, completedTasksSet.has(task.value) ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_9__["default"], {
      name: "check"
    }) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "todo-item-bullet-point"
    })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('readonly-item-label', completedTasksSet.has(task.value) && 'completed-label')
    }, task.label))));
  };
  const renderTodoListType = () => {
    if (message.forwardInfo) {
      return lang('TitleToDoList');
    }
    if (othersCanComplete) {
      return lang('TitleGroupToDoList');
    }
    if (isOutgoing) {
      return lang('TitleYourToDoList');
    }
    if (sender) {
      return lang('TitleUserToDoList', {
        peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, sender)
      }, {
        withNodes: true
      });
    }
    return lang('TitleToDoList');
  };
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "todo-list",
    dir: lang.isRtl ? 'auto' : 'ltr'
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "todo-list-header"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "todo-list-title"
  }, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_5__.renderTextWithEntities)(title)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "list-type"
  }, renderTodoListType())), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "todo-list-items"
  }, isReadOnly ? renderReadOnlyTodoList() : renderCheckBoxGroup()), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "completed-tasks-count"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_8__["default"], {
    text: lang('DescriptionCompletedToDoTasks', {
      number: completedTasks.length,
      count: tasks.length
    })
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  message
}) => {
  const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectSender)(global, message);
  return {
    sender,
    isCurrentUserPremium: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsCurrentUserPremium)(global),
    isSynced: global.isSynced
  };
})(TodoList)));

/***/ },

/***/ "./src/components/middle/message/Video.tsx"
/*!*************************************************!*\
  !*** ./src/components/middle/message/Video.tsx ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./helpers/mediaDimensions */ "./src/components/middle/message/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_media_useUnsupportedMedia__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/media/useUnsupportedMedia */ "./src/hooks/media/useUnsupportedMedia.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useMediaTransition__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useMediaTransition */ "./src/hooks/useMediaTransition.ts");
/* harmony import */ var _hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../hooks/useMediaWithLoadProgress */ "./src/hooks/useMediaWithLoadProgress.ts");
/* harmony import */ var _hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../hooks/usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./hooks/useBlurredMediaThumbRef */ "./src/components/middle/message/hooks/useBlurredMediaThumbRef.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _common_SensitiveContentConfirmModal__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../common/SensitiveContentConfirmModal */ "./src/components/common/SensitiveContentConfirmModal.tsx");
/* harmony import */ var _ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/OptimizedVideo */ "./src/components/ui/OptimizedVideo.tsx");
/* harmony import */ var _ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../ui/ProgressSpinner */ "./src/components/ui/ProgressSpinner.tsx");

























const Video = ({
  id,
  video,
  isOwn,
  isInWebPage,
  noAvatars,
  canAutoLoad,
  canAutoPlay,
  uploadProgress,
  forcedWidth,
  dimensions,
  asForwarded,
  isDownloading,
  isProtected,
  className,
  lastPlaybackTimestamp,
  clickArg,
  isMediaNsfw,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  onClick,
  onCancelUpload,
  needsAgeVerification
}) => {
  const {
    cancelMediaDownload,
    updateContentSettings,
    openAgeVerificationModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const videoRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [isNsfwModalOpen, openNsfwModal, closeNsfwModal] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const [shouldAlwaysShowNsfw, setShouldAlwaysShowNsfw] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const isPaidPreview = video.mediaType === 'extendedMediaPreview';
  const localBlobUrl = !isPaidPreview ? video.blobUrl : undefined;
  const shouldShowSpoiler = isPaidPreview || video.isSpoiler || isMediaNsfw;
  const [isSpoilerShown, showSpoiler, hideSpoiler] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_10__["default"])(shouldShowSpoiler);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldShowSpoiler) {
      showSpoiler();
    } else {
      hideSpoiler();
    }
  }, [shouldShowSpoiler]);
  const handleNsfwConfirm = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(() => {
    closeNsfwModal();
    hideSpoiler();
    if (shouldAlwaysShowNsfw) {
      updateContentSettings({
        isSensitiveEnabled: true
      });
    }
  });
  const isIntersectingForLoading = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_11__.useIsIntersecting)(ref, observeIntersectionForLoading);
  const isIntersectingForPlaying = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_11__.useIsIntersecting)(ref, observeIntersectionForPlaying) && isIntersectingForLoading;
  const wasIntersectedRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(isIntersectingForLoading);
  if (isIntersectingForPlaying && !wasIntersectedRef.current) {
    wasIntersectedRef.current = true;
  }
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [isLoadAllowed, setIsLoadAllowed] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(canAutoLoad);
  const shouldLoad = Boolean(isLoadAllowed && isIntersectingForLoading && !isPaidPreview);
  const [isPlayAllowed, setIsPlayAllowed] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(Boolean(canAutoPlay && !isSpoilerShown));
  const fullMediaHash = !isPaidPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getVideoMediaHash)(video, 'inline') : undefined;
  const [isFullMediaPreloaded] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(Boolean(fullMediaHash && _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.getFromMemory(fullMediaHash)));
  const {
    mediaData,
    loadProgress
  } = (0,_hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_15__["default"])(fullMediaHash, !shouldLoad, !isPaidPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMediaFormat)(video, 'inline') : undefined);
  const fullMediaData = localBlobUrl || mediaData;
  const [isPlayerReady, markPlayerReady] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const thumbDataUri = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMediaThumbUri)(video);
  const hasThumb = Boolean(thumbDataUri);
  const withBlurredBackground = Boolean(forcedWidth);
  const isInline = fullMediaData && wasIntersectedRef.current;
  const isUnsupported = (0,_hooks_media_useUnsupportedMedia__WEBPACK_IMPORTED_MODULE_8__["default"])(videoRef, true, !isInline);
  const previewMediaHash = !isPaidPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getVideoMediaHash)(video, 'preview') : undefined;
  const [isPreviewPreloaded] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(Boolean(previewMediaHash && _util_mediaLoader__WEBPACK_IMPORTED_MODULE_5__.getFromMemory(previewMediaHash)));
  const canLoadPreview = isIntersectingForLoading;
  const previewBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_13__["default"])(previewMediaHash, !canLoadPreview);
  const shouldHidePreview = isPlayerReady && !isUnsupported;
  const {
    ref: previewRef
  } = (0,_hooks_useMediaTransition__WEBPACK_IMPORTED_MODULE_14__["default"])({
    hasMediaData: Boolean((hasThumb || previewBlobUrl) && !shouldHidePreview)
  });
  const noThumb = Boolean(!hasThumb || previewBlobUrl || isPlayerReady);
  const thumbRef = (0,_hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_18__["default"])(video, noThumb);
  (0,_hooks_useMediaTransition__WEBPACK_IMPORTED_MODULE_14__["default"])({
    ref: thumbRef,
    hasMediaData: !noThumb
  });
  const blurredBackgroundRef = (0,_hooks_useBlurredMediaThumbRef__WEBPACK_IMPORTED_MODULE_18__["default"])(video, !withBlurredBackground);
  const {
    loadProgress: downloadProgress
  } = (0,_hooks_useMediaWithLoadProgress__WEBPACK_IMPORTED_MODULE_15__["default"])(!isPaidPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getVideoMediaHash)(video, 'download') : undefined, !isDownloading, !isPaidPreview ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMediaFormat)(video, 'download') : undefined);
  const {
    isUploading,
    isTransferring,
    transferProgress
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getMediaTransferState)(uploadProgress || (isDownloading ? downloadProgress : loadProgress), shouldLoad && !isPlayerReady && !isFullMediaPreloaded || isDownloading, uploadProgress !== undefined);
  const wasLoadDisabled = (0,_hooks_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_16__["default"])(isLoadAllowed) === false;
  const {
    ref: spinnerRef,
    shouldRender: shouldRenderSpinner
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_17__["default"])({
    isOpen: isTransferring && !isUnsupported,
    noMountTransition: wasLoadDisabled,
    withShouldRender: true
  });
  const {
    ref: playButtonRef
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_17__["default"])({
    isOpen: Boolean((isLoadAllowed || fullMediaData) && !isPlayAllowed && !shouldRenderSpinner)
  });
  const [playProgress, setPlayProgress] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const handleTimeUpdate = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(e => {
    setPlayProgress(Math.max(0, e.currentTarget.currentTime - 1));
  });
  const duration = (Number.isFinite(videoRef.current?.duration) && !isUnsupported ? videoRef.current?.duration : video.duration) || 0;
  const {
    width,
    height
  } = dimensions || (isPaidPreview ? (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.calculateExtendedPreviewDimensions)(video, Boolean(isOwn), asForwarded, isInWebPage, noAvatars, isMobile) : (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.calculateVideoDimensions)(video, Boolean(isOwn), asForwarded, isInWebPage, noAvatars, isMobile));
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])((e, isFromSpinner) => {
    if (isUploading) {
      onCancelUpload?.(clickArg);
      return;
    }
    if (!isPaidPreview && isDownloading) {
      cancelMediaDownload({
        media: video
      });
      return;
    }
    if (!fullMediaData) {
      setIsLoadAllowed(isAllowed => !isAllowed);
      return;
    }
    if (fullMediaData && !isPlayAllowed) {
      setIsPlayAllowed(true);
    }
    if (isSpoilerShown) {
      if (isMediaNsfw) {
        if (needsAgeVerification) {
          openAgeVerificationModal();
          return;
        }
        openNsfwModal();
        return;
      }
      hideSpoiler();
      return;
    }
    if (isFromSpinner && shouldLoad && !isPlayerReady && !isFullMediaPreloaded) {
      setIsLoadAllowed(false);
      e.stopPropagation();
      return;
    }
    onClick?.(clickArg, e);
  });
  const handleClickOnSpinner = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_12__["default"])(e => {
    handleClick(e, true);
  });
  const componentClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('media-inner dark', !isUploading && 'interactive', height < _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__.MIN_MEDIA_HEIGHT && 'fix-min-height', className);
  const dimensionsStyle = dimensions ? ` width: ${width}px; left: ${dimensions.x}px; top: ${dimensions.y}px;` : '';
  const style = `height: ${height}px;${dimensionsStyle}`;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    id: id,
    className: componentClassName,
    style: style,
    onClick: isUploading ? undefined : e => handleClick(e)
  }, withBlurredBackground && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: blurredBackgroundRef,
    className: "thumbnail blurred-bg"
  }), isInline && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_OptimizedVideo__WEBPACK_IMPORTED_MODULE_22__["default"], {
    ref: videoRef,
    src: fullMediaData,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('full-media', withBlurredBackground && 'with-blurred-bg'),
    canPlay: isPlayAllowed && isIntersectingForPlaying && !isUnsupported,
    defaultMuted: true,
    muted: true,
    loop: true,
    playsInline: true,
    disablePictureInPicture: true,
    draggable: !isProtected,
    onTimeUpdate: handleTimeUpdate,
    onReady: markPlayerReady,
    style: forcedWidth ? `width: ${forcedWidth}px` : undefined
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    ref: previewRef,
    src: previewBlobUrl,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('thumbnail', withBlurredBackground && 'with-blurred-bg'),
    alt: "",
    style: forcedWidth ? `width: ${forcedWidth}px;` : undefined,
    draggable: !isProtected
  }), hasThumb && !isPreviewPreloaded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("canvas", {
    ref: thumbRef,
    className: "thumbnail"
  }), isProtected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    ref: playButtonRef,
    name: "large-play"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_20__["default"], {
    isVisible: isSpoilerShown,
    withAnimation: true,
    thumbDataUri: thumbDataUri,
    isNsfw: isMediaNsfw,
    width: width,
    height: height,
    className: "media-spoiler"
  }), shouldRenderSpinner && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: spinnerRef,
    className: "media-loading"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ProgressSpinner__WEBPACK_IMPORTED_MODULE_23__["default"], {
    progress: transferProgress,
    onClick: handleClickOnSpinner
  })), !isLoadAllowed && !fullMediaData && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    name: "download"
  }), isTransferring && (!isUnsupported || isDownloading) ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "message-transfer-progress"
  }, isUploading || isDownloading ? `${Math.round(transferProgress * 100)}%` : '...') : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-media-duration"
  }, !isPaidPreview && video.isGif ? 'GIF' : (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatMediaDuration)(Math.max(duration - playProgress, 0)), isUnsupported && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
    name: "message-failed",
    className: "playback-failed"
  })), Boolean(lastPlaybackTimestamp) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "message-media-last-progress",
    style: `--_progress: ${Math.floor(lastPlaybackTimestamp / duration * 100)}%`
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_SensitiveContentConfirmModal__WEBPACK_IMPORTED_MODULE_21__["default"], {
    isOpen: isNsfwModalOpen,
    onClose: closeNsfwModal,
    shouldAlwaysShow: shouldAlwaysShowNsfw,
    onAlwaysShowChanged: setShouldAlwaysShowNsfw,
    confirmHandler: handleNsfwConfirm
  }));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const appConfig = global.appConfig;
  const needsAgeVerification = appConfig?.needAgeVideoVerification;
  return {
    needsAgeVerification
  };
})(Video)));

/***/ },

/***/ "./src/components/middle/message/WebPage.scss"
/*!****************************************************!*\
  !*** ./src/components/middle/message/WebPage.scss ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/middle/message/WebPage.tsx"
/*!***************************************************!*\
  !*** ./src/components/middle/message/WebPage.tsx ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _util_trimText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/trimText */ "./src/util/trimText.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_webpageType__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./helpers/webpageType */ "./src/components/middle/message/helpers/webpageType.ts");
/* harmony import */ var _hooks_stickers_useDynamicColorListener__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/stickers/useDynamicColorListener */ "./src/hooks/stickers/useDynamicColorListener.ts");
/* harmony import */ var _hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useEnsureStory */ "./src/hooks/useEnsureStory.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Audio__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/Audio */ "./src/components/common/Audio.tsx");
/* harmony import */ var _common_Document__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/Document */ "./src/components/common/Document.tsx");
/* harmony import */ var _common_embedded_EmojiIconBackground__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/embedded/EmojiIconBackground */ "./src/components/common/embedded/EmojiIconBackground.tsx");
/* harmony import */ var _common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../common/PeerColorWrapper */ "./src/components/common/PeerColorWrapper.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _BaseStory__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./BaseStory */ "./src/components/middle/message/BaseStory.tsx");
/* harmony import */ var _Photo__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./Photo */ "./src/components/middle/message/Photo.tsx");
/* harmony import */ var _Video__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./Video */ "./src/components/middle/message/Video.tsx");
/* harmony import */ var _WebPageUniqueGift__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./WebPageUniqueGift */ "./src/components/middle/message/WebPageUniqueGift.tsx");
/* harmony import */ var _WebPage_scss__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./WebPage.scss */ "./src/components/middle/message/WebPage.scss");




























const MAX_TEXT_LENGTH = 170; // symbols
const WEBPAGE_STORY_TYPE = 'telegram_story';
const WEBPAGE_GIFT_TYPE = 'telegram_nft';
const STICKER_SIZE = 80;
const EMOJI_SIZE = 38;
const WebPage = ({
  messageWebPage,
  webPage,
  message,
  noAvatars,
  canAutoLoad,
  canAutoPlay,
  asForwarded,
  isDownloading = false,
  isProtected,
  isConnected,
  story,
  theme,
  backgroundEmojiId,
  shouldWarnAboutSvg,
  autoLoadFileMaxSizeMb,
  lastPlaybackTimestamp,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  onMediaClick,
  onDocumentClick,
  onContainerClick,
  onAudioPlay,
  onCancelMediaTransfer
}) => {
  const {
    openUrl,
    openTelegramLink
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const stickersRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const handleMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    onMediaClick();
  });
  const handleContainerClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(e => {
    onContainerClick?.(e);
  });
  const fullWebPage = webPage?.webpageType === 'full' ? webPage : undefined;
  const {
    story: storyData,
    stickers
  } = fullWebPage || {};
  (0,_hooks_useEnsureStory__WEBPACK_IMPORTED_MODULE_11__["default"])(storyData?.peerId, storyData?.id, story);
  const hasCustomColor = stickers?.isWithTextColor || stickers?.documents?.[0]?.shouldUseTextColor;
  const customColor = (0,_hooks_stickers_useDynamicColorListener__WEBPACK_IMPORTED_MODULE_10__["default"])(stickersRef, undefined, !hasCustomColor);
  const linkTimestamp = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const parsedLink = webPage?.url && (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_6__.tryParseDeepLink)(webPage?.url);
    if (!parsedLink || !('timestamp' in parsedLink)) return undefined;
    return parsedLink.timestamp;
  }, [webPage?.url]);
  if (webPage?.webpageType !== 'full') return undefined;
  const handleOpenTelegramLink = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    openTelegramLink({
      url: webPage.url
    });
  });
  const {
    siteName,
    url,
    displayUrl,
    title,
    description,
    photo,
    video,
    audio,
    type,
    document
  } = webPage;
  const {
    mediaSize
  } = messageWebPage;
  const isStory = type === WEBPAGE_STORY_TYPE;
  const isGift = type === WEBPAGE_GIFT_TYPE;
  const isExpiredStory = story && 'isDeleted' in story;
  const resultType = stickers?.isEmoji ? 'telegram_emojiset' : type;
  const quickButtonLangKey = !isExpiredStory ? (0,_helpers_webpageType__WEBPACK_IMPORTED_MODULE_9__.getWebpageButtonLangKey)(resultType) : undefined;
  const quickButtonTitle = quickButtonLangKey && lang(quickButtonLangKey);
  const truncatedDescription = (0,_util_trimText__WEBPACK_IMPORTED_MODULE_7__["default"])(description, MAX_TEXT_LENGTH);
  const isArticle = Boolean(truncatedDescription || title || siteName);
  let isSquarePhoto = Boolean(stickers);
  if (isArticle && webPage?.photo && !webPage.video && !webPage.document) {
    isSquarePhoto = getIsSmallPhoto(webPage, mediaSize);
  }
  const isMediaInteractive = (photo || video) && onMediaClick && !isSquarePhoto;
  const className = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('WebPage', isSquarePhoto && 'with-square-photo', !photo && !video && 'without-media', video && 'with-video', !isArticle && 'no-article', document && 'with-document', quickButtonTitle && 'with-quick-button', isGift && 'with-gift');
  function renderQuickButton(caption) {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Button__WEBPACK_IMPORTED_MODULE_21__["default"], {
      className: "WebPage--quick-button",
      size: "tiny",
      color: "translucent",
      isRectangular: true,
      noForcedUpperCase: true,
      onClick: handleOpenTelegramLink
    }, caption);
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_PeerColorWrapper__WEBPACK_IMPORTED_MODULE_18__["default"], {
    className: className,
    "data-initial": (siteName || displayUrl)[0],
    dir: oldLang.isRtl ? 'rtl' : 'auto',
    onClick: handleContainerClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('WebPage--content', isStory && 'is-story', isGift && 'is-gift')
  }, backgroundEmojiId && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_embedded_EmojiIconBackground__WEBPACK_IMPORTED_MODULE_17__["default"], {
    emojiDocumentId: backgroundEmojiId,
    className: "WebPage--background-icons"
  }), isStory && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_BaseStory__WEBPACK_IMPORTED_MODULE_22__["default"], {
    story: story,
    isProtected: isProtected,
    isConnected: isConnected,
    isPreview: true
  }), isGift && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_WebPageUniqueGift__WEBPACK_IMPORTED_MODULE_25__["default"], {
    gift: webPage.gift,
    observeIntersectionForLoading: observeIntersectionForLoading,
    observeIntersectionForPlaying: observeIntersectionForPlaying,
    onClick: handleOpenTelegramLink
  }), isArticle && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('WebPage-text', 'WebPage-text_interactive'),
    onClick: () => openUrl({
      url,
      shouldSkipModal: messageWebPage.isSafe
    })
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_SafeLink__WEBPACK_IMPORTED_MODULE_19__["default"], {
    className: "site-name",
    url: url,
    text: siteName || displayUrl
  }), title && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "site-title"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_8__["default"])(title)), truncatedDescription && !isGift && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: "site-description"
  }, (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_8__["default"])(truncatedDescription, ['emoji', 'br']))), photo && !isGift && !video && !document && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Photo__WEBPACK_IMPORTED_MODULE_23__["default"], {
    photo: photo,
    isOwn: message?.isOutgoing,
    isInWebPage: true,
    observeIntersection: observeIntersectionForLoading,
    noAvatars: noAvatars,
    canAutoLoad: canAutoLoad,
    size: isSquarePhoto ? 'pictogram' : 'inline',
    asForwarded: asForwarded,
    nonInteractive: !isMediaInteractive,
    isDownloading: isDownloading,
    isProtected: isProtected,
    theme: theme,
    onClick: isMediaInteractive ? handleMediaClick : undefined,
    onCancelUpload: onCancelMediaTransfer
  }), video && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_Video__WEBPACK_IMPORTED_MODULE_24__["default"], {
    video: video,
    isOwn: message?.isOutgoing,
    isInWebPage: true,
    observeIntersectionForLoading: observeIntersectionForLoading,
    noAvatars: noAvatars,
    canAutoLoad: canAutoLoad,
    canAutoPlay: canAutoPlay,
    asForwarded: asForwarded,
    isDownloading: isDownloading,
    isProtected: isProtected,
    lastPlaybackTimestamp: lastPlaybackTimestamp || linkTimestamp,
    onClick: isMediaInteractive ? handleMediaClick : undefined,
    onCancelUpload: onCancelMediaTransfer
  }), audio && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Audio__WEBPACK_IMPORTED_MODULE_15__["default"], {
    theme: theme,
    message: message,
    origin: _types__WEBPACK_IMPORTED_MODULE_2__.AudioOrigin.Inline,
    noAvatars: noAvatars,
    isDownloading: isDownloading,
    onPlay: onAudioPlay,
    onCancelUpload: onCancelMediaTransfer
  }), document && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Document__WEBPACK_IMPORTED_MODULE_16__["default"], {
    document: document,
    message: message,
    observeIntersection: observeIntersectionForLoading,
    autoLoadFileMaxSizeMb: autoLoadFileMaxSizeMb,
    onMediaClick: onDocumentClick,
    onCancelUpload: onCancelMediaTransfer,
    isDownloading: isDownloading,
    shouldWarnAboutSvg: shouldWarnAboutSvg
  }), stickers && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: stickersRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])('media-inner', 'square-image', stickers.isEmoji && 'WebPage--emoji-grid', 'WebPage--stickers')
  }, stickers.documents.map(sticker => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    key: sticker.id,
    className: "WebPage--sticker"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_StickerView__WEBPACK_IMPORTED_MODULE_20__["default"], {
    containerRef: stickersRef,
    sticker: sticker,
    shouldLoop: true,
    size: stickers.isEmoji ? EMOJI_SIZE : STICKER_SIZE,
    customColor: customColor,
    observeIntersectionForPlaying: observeIntersectionForPlaying,
    observeIntersectionForLoading: observeIntersectionForLoading
  }))))), quickButtonTitle && renderQuickButton(quickButtonTitle));
};
function getIsSmallPhoto(webPage, mediaSize) {
  if (!webPage?.photo) return false;
  if (mediaSize === 'small') return true;
  if (mediaSize === 'large') return false;
  const {
    width,
    height
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getPhotoFullDimensions)(webPage.photo) || {};
  if (!width || !height) return false;
  return width === height && !webPage.hasLargeMedia;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    canPlayAnimatedEmojis: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanPlayAnimatedEmojis)(global)
  };
})(WebPage)));

/***/ },

/***/ "./src/components/middle/message/WebPageUniqueGift.module.scss"
/*!*********************************************************************!*\
  !*** ./src/components/middle/message/WebPageUniqueGift.module.scss ***!
  \*********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"LaOdPURl","backgroundWrapper":"zDnMa37m","background":"EdXfeKWY","stickerWrapper":"o_DYZEMV"});

/***/ },

/***/ "./src/components/middle/message/WebPageUniqueGift.tsx"
/*!*************************************************************!*\
  !*** ./src/components/middle/message/WebPageUniqueGift.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/browser/windowEnvironment.ts */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_buildClassName_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName.ts */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _hooks_useFlag_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useFlag.ts */ "./src/hooks/useFlag.ts");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _WebPageUniqueGift_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./WebPageUniqueGift.module.scss */ "./src/components/middle/message/WebPageUniqueGift.module.scss");









const STAR_GIFT_STICKER_SIZE = 120;
const WebPageUniqueGift = ({
  gift,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  onClick
}) => {
  const stickerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    backdrop,
    model,
    pattern
  } = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_3__.getGiftAttributes)(gift);
  const [isHover, markHover, unmarkHover] = (0,_hooks_useFlag_ts__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const backgroundColors = [backdrop.centerColor, backdrop.edgeColor];
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName_ts__WEBPACK_IMPORTED_MODULE_2__["default"])('interactive-gift', _WebPageUniqueGift_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root),
    onClick: onClick,
    onMouseEnter: !_util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_1__.IS_TOUCH_ENV ? markHover : undefined,
    onMouseLeave: !_util_browser_windowEnvironment_ts__WEBPACK_IMPORTED_MODULE_1__.IS_TOUCH_ENV ? unmarkHover : undefined
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _WebPageUniqueGift_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].backgroundWrapper
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_5__["default"], {
    className: _WebPageUniqueGift_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].background,
    backgroundColors: backgroundColors,
    patternColor: backdrop.patternColor,
    patternIcon: pattern.sticker
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: stickerRef,
    className: _WebPageUniqueGift_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].stickerWrapper
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_StickerView__WEBPACK_IMPORTED_MODULE_6__["default"], {
    containerRef: stickerRef,
    sticker: model.sticker,
    size: STAR_GIFT_STICKER_SIZE,
    shouldLoop: isHover,
    observeIntersectionForPlaying: observeIntersectionForPlaying,
    observeIntersectionForLoading: observeIntersectionForLoading
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(WebPageUniqueGift));

/***/ },

/***/ "./src/components/middle/message/helpers/buildContentClassName.ts"
/*!************************************************************************!*\
  !*** ./src/components/middle/message/helpers/buildContentClassName.ts ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   buildContentClassName: () => (/* binding */ buildContentClassName)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _getSingularPaidMedia__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./getSingularPaidMedia */ "./src/components/middle/message/helpers/getSingularPaidMedia.ts");



function buildContentClassName(message, album, {
  poll,
  webPage,
  hasSubheader,
  isCustomShape,
  isLastInGroup,
  asForwarded,
  hasThread,
  forceSenderName,
  hasCommentCounter,
  hasCommentButton,
  hasActionButton,
  hasReactions,
  isGeoLiveActive,
  withVoiceTranscription,
  peerColorClass,
  hasOutsideReactions
} = {}) {
  const {
    paidMedia
  } = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(message);
  const {
    photo: paidMediaPhoto,
    video: paidMediaVideo
  } = (0,_getSingularPaidMedia__WEBPACK_IMPORTED_MODULE_2__["default"])(paidMedia);
  const content = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(message);
  const {
    photo = paidMediaPhoto,
    video = paidMediaVideo,
    audio,
    voice,
    document,
    contact,
    location,
    invoice,
    storyData,
    giveaway,
    giveawayResults
  } = content;
  const text = album?.hasMultipleCaptions ? undefined : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(album?.captionMessage || message).text;
  const hasFactCheck = Boolean(message.factCheck?.text);
  const isRoundVideo = video?.mediaType === 'video' && video.isRound;
  const isInvertedMedia = message.isInvertedMedia;
  const isInvertibleMedia = photo || video && !isRoundVideo || album || webPage;
  const classNames = [_config__WEBPACK_IMPORTED_MODULE_0__.MESSAGE_CONTENT_CLASS_NAME];
  const isMedia = storyData || photo || video || location || invoice?.extendedMedia || paidMedia;
  const hasText = text || location?.mediaType === 'venue' || isGeoLiveActive || hasFactCheck;
  const isMediaWithNoText = isMedia && !hasText;
  const hasInlineKeyboard = Boolean(message.inlineButtons);
  const isViaBot = Boolean(message.viaBotId);
  const hasFooter = (() => {
    if (isInvertedMedia && isInvertibleMedia) {
      if (hasReactions && !hasOutsideReactions) return true;
      if (hasFactCheck) return true;
      if (webPage && hasText) return true;
      return false;
    }
    return hasText;
  })();
  if (peerColorClass) {
    classNames.push(peerColorClass);
  }
  if (!isMedia && message.emojiOnlyCount) {
    classNames.push('emoji-only');
    if (message.emojiOnlyCount <= _config__WEBPACK_IMPORTED_MODULE_0__.EMOJI_SIZES) {
      classNames.push(`emoji-only-${message.emojiOnlyCount}`);
    }
  } else if (hasText) {
    classNames.push('text');
  } else {
    classNames.push('no-text');
  }
  if (!Object.keys(content).length) {
    classNames.push('unsupported');
  }
  if (hasActionButton) {
    classNames.push('has-action-button');
  }
  if (isCustomShape) {
    classNames.push('custom-shape');
    if (isRoundVideo) {
      classNames.push('round');
    }
    if (hasCommentCounter) {
      classNames.push('has-comment-counter');
    }
  }
  if (isMedia && !withVoiceTranscription) {
    classNames.push('media');
  } else if (video) {
    classNames.push('video');
  } else if (audio) {
    classNames.push('audio');
  } else if (voice) {
    classNames.push('voice');
    if (withVoiceTranscription) {
      classNames.push('with-voice-transcription');
    }
  } else if (document) {
    classNames.push('document');
  } else if (contact) {
    classNames.push('contact');
  } else if (poll) {
    classNames.push('poll');
  } else if (giveaway || giveawayResults) {
    classNames.push('giveaway');
  } else if (webPage?.webpageType === 'full') {
    classNames.push('web-page');
    if (webPage.photo || webPage.video) {
      classNames.push('media');
    }
    if (webPage.document) {
      classNames.push('document');
    }
    if (webPage.gift) {
      classNames.push('gift');
    }
  }
  if (invoice && !invoice.extendedMedia) {
    classNames.push('invoice');
  }
  if (invoice && invoice.photo) {
    classNames.push('has-photo');
  }
  if (storyData) {
    classNames.push('story');
  }
  if (asForwarded) {
    classNames.push('is-forwarded');
  }
  if (hasSubheader) {
    classNames.push('has-subheader');
  }
  if (hasThread) {
    classNames.push('has-replies');
  }
  if (hasReactions) {
    classNames.push('has-reactions');
  }
  if (hasOutsideReactions) {
    classNames.push('has-outside-reactions');
  }
  if (isViaBot) {
    classNames.push('is-via-bot');
  }
  if (forceSenderName) {
    classNames.push('force-sender-name');
  }
  if (!isCustomShape) {
    classNames.push('has-shadow');
    if (isMedia && hasThread) {
      classNames.push('has-background');
    }
    if (hasSubheader || asForwarded || isViaBot || !isMediaWithNoText || forceSenderName || hasFactCheck || withVoiceTranscription) {
      classNames.push('has-solid-background');
    }
    if (hasFactCheck) {
      classNames.push('has-fact-check');
    }
    if (isLastInGroup && !hasInlineKeyboard && (photo || !isMediaWithNoText || hasCommentButton)) {
      classNames.push('has-appendix');
    }
  }
  if (isInvertibleMedia && isInvertedMedia) {
    classNames.push('is-inverted-media');
  }
  if (hasFooter) {
    classNames.push('has-footer');
  } else {
    classNames.push('no-footer');
  }
  return classNames.join(' ');
}

/***/ },

/***/ "./src/components/middle/message/helpers/calculateAlbumLayout.ts"
/*!***********************************************************************!*\
  !*** ./src/components/middle/message/helpers/calculateAlbumLayout.ts ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AlbumRectPart: () => (/* binding */ AlbumRectPart),
/* harmony export */   calculateAlbumLayout: () => (/* binding */ calculateAlbumLayout)
/* harmony export */ });
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_math__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/math */ "./src/util/math.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _mediaDimensions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./mediaDimensions */ "./src/components/middle/message/helpers/mediaDimensions.ts");
// Based on
// https://github.com/telegramdesktop/tdesktop/blob/dev/Telegram/SourceFiles/ui/grouped_layout.cpp
// https://github.com/overtake/TelegramSwift/blob/master/Telegram-Mac/GroupedLayout.swift#L83





const AlbumRectPart = {
  None: 0,
  Top: 1,
  Right: 2,
  Bottom: 4,
  Left: 8
};
function getRatios(messages, isSingleMessage, isMobile) {
  const isOutgoing = messages[0].isOutgoing;
  const allMedia = (isSingleMessage ? messages[0].content.paidMedia.extendedMedia.map(media => 'mediaType' in media ? media : media.photo || media.video) : messages.map(message => (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.getMessageContent)(message).photo || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.getMessageContent)(message).video)).filter(Boolean);
  return allMedia.map(media => {
    const dimensions = (0,_mediaDimensions__WEBPACK_IMPORTED_MODULE_3__.calculateMediaDimensions)({
      media,
      isOwn: isOutgoing,
      isMobile
    });
    return dimensions.width / dimensions.height;
  });
}
function getProportions(ratios) {
  return ratios.map(ratio => ratio > 1.2 ? 'w' : ratio < 0.8 ? 'n' : 'q').join('');
}
function getAverageRatio(ratios) {
  return ratios.reduce((result, ratio) => ratio + result, 1) / ratios.length;
}
function accumulate(list, initValue) {
  return list.reduce((accumulator, item) => accumulator + item, initValue);
}
function cropRatios(ratios, averageRatio) {
  return ratios.map(ratio => {
    return averageRatio > 1.1 ? (0,_util_math__WEBPACK_IMPORTED_MODULE_1__.clamp)(ratio, 1, 2.75) : (0,_util_math__WEBPACK_IMPORTED_MODULE_1__.clamp)(ratio, 0.6667, 1);
  });
}
function calculateContainerSize(layout) {
  const styles = {
    width: 0,
    height: 0
  };
  layout.forEach(({
    dimensions,
    sides
  }) => {
    if (sides & AlbumRectPart.Right) {
      styles.width = dimensions.width + dimensions.x;
    }
    if (sides & AlbumRectPart.Bottom) {
      styles.height = dimensions.height + dimensions.y;
    }
  });
  return styles;
}
function calculateAlbumLayout(isOwn, noAvatars, album, isMobile) {
  const spacing = 2;
  const ratios = getRatios(album.messages, album.isPaidMedia, isMobile);
  const proportions = getProportions(ratios);
  const averageRatio = getAverageRatio(ratios);
  const albumCount = ratios.length;
  const forceCalc = ratios.some(ratio => ratio > 2);
  const maxWidth = (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__.getAvailableWidth)(isOwn, false, noAvatars, isMobile);
  const maxHeight = maxWidth;
  let layout;
  const params = {
    ratios,
    proportions,
    averageRatio,
    maxWidth,
    minWidth: 100,
    maxHeight,
    spacing
  };
  if (albumCount >= 5 || forceCalc) {
    layout = layoutWithComplexLayouter(params);
  } else if (albumCount === 2) {
    layout = layoutTwo(params);
  } else if (albumCount === 3) {
    layout = layoutThree(params);
  } else {
    layout = layoutFour(params);
  }
  return {
    layout,
    containerStyle: calculateContainerSize(layout)
  };
}
function layoutWithComplexLayouter({
  ratios: originalRatios,
  averageRatio,
  maxWidth,
  minWidth,
  spacing,
  maxHeight = 4 * maxWidth / 3
}) {
  const ratios = cropRatios(originalRatios, averageRatio);
  const count = originalRatios.length;
  const result = new Array(count);
  const attempts = [];
  const multiHeight = (offset, attemptCount) => {
    const attemptRatios = ratios.slice(offset, offset + attemptCount);
    const sum = accumulate(attemptRatios, 0);
    return (maxWidth - (attemptCount - 1) * spacing) / sum;
  };
  const pushAttempt = lineCounts => {
    const heights = [];
    let offset = 0;
    lineCounts.forEach(currentCount => {
      heights.push(multiHeight(offset, currentCount));
      offset += currentCount;
    });
    attempts.push({
      lineCounts,
      heights
    });
  };
  for (let first = 1; first !== count; ++first) {
    const second = count - first;
    if (first <= 3 && second <= 3) {
      pushAttempt([first, second]);
    }
  }
  for (let first = 1; first !== count - 1; ++first) {
    for (let second = 1; second !== count - first; ++second) {
      const third = count - first - second;
      if (first <= 3 && second <= (averageRatio < 0.85 ? 4 : 3) && third <= 3) {
        pushAttempt([first, second, third]);
      }
    }
  }
  for (let first = 1; first !== count - 1; ++first) {
    for (let second = 1; second !== count - first; ++second) {
      for (let third = 1; third !== count - first - second; ++third) {
        const fourth = count - first - second - third;
        if (first <= 3 && second <= 3 && third <= 3 && fourth <= 4) {
          pushAttempt([first, second, third, fourth]);
        }
      }
    }
  }
  let optimalAttempt;
  let optimalDiff = 0;
  for (let i = 0; i < attempts.length; i++) {
    const {
      heights,
      lineCounts
    } = attempts[i];
    const lineCount = lineCounts.length;
    const totalHeight = accumulate(heights, 0) + spacing * (lineCount - 1);
    const minLineHeight = Math.min(...heights);
    const bad1 = minLineHeight < minWidth ? 1.5 : 1;
    const bad2 = (() => {
      for (let line = 1; line !== lineCount; ++line) {
        if (lineCounts[line - 1] > lineCounts[line]) {
          return 1.5;
        }
      }
      return 1;
    })();
    const diff = Math.abs(totalHeight - maxHeight) * bad1 * bad2;
    if (!optimalAttempt || diff < optimalDiff) {
      optimalAttempt = attempts[i];
      optimalDiff = diff;
    }
  }
  const optimalCounts = optimalAttempt.lineCounts;
  const optimalHeights = optimalAttempt.heights;
  const rowCount = optimalCounts.length;
  let index = 0;
  let y = 0;
  for (let row = 0; row !== rowCount; ++row) {
    const colCount = optimalCounts[row];
    const lineHeight = optimalHeights[row];
    const height = Math.round(lineHeight);
    let x = 0;
    for (let col = 0; col !== colCount; ++col) {
      const sides = AlbumRectPart.None | (row === 0 ? AlbumRectPart.Top : AlbumRectPart.None) | (row === rowCount - 1 ? AlbumRectPart.Bottom : AlbumRectPart.None) | (col === 0 ? AlbumRectPart.Left : AlbumRectPart.None) | (col === colCount - 1 ? AlbumRectPart.Right : AlbumRectPart.None);
      const ratio = ratios[index];
      const width = col === colCount - 1 ? maxWidth - x : Math.round(ratio * lineHeight);
      result[index] = {
        dimensions: {
          x,
          y,
          width,
          height
        },
        sides
      };
      x += width + spacing;
      ++index;
    }
    y += height + spacing;
  }
  return result;
}
function layoutTwo(params) {
  const {
    ratios,
    proportions,
    averageRatio
  } = params;
  return proportions === 'ww' && averageRatio > 1.4 && ratios[1] - ratios[0] < 0.2 ? layoutTwoTopBottom(params) : proportions === 'ww' || proportions === 'qq' ? layoutTwoLeftRightEqual(params) : layoutTwoLeftRight(params);
}
function layoutTwoTopBottom(params) {
  const {
    ratios,
    maxWidth,
    spacing,
    maxHeight
  } = params;
  const height = Math.round(Math.min(maxWidth / ratios[0], Math.min(maxWidth / ratios[1], (maxHeight - spacing) / 2)));
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: maxWidth,
      height
    },
    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: 0,
      y: height + spacing,
      width: maxWidth,
      height
    },
    sides: AlbumRectPart.Left | AlbumRectPart.Bottom | AlbumRectPart.Right
  }];
}
function layoutTwoLeftRightEqual(params) {
  const {
    ratios,
    maxWidth,
    spacing,
    maxHeight
  } = params;
  const width = (maxWidth - spacing) / 2;
  const height = Math.round(Math.min(width / ratios[0], Math.min(width / ratios[1], maxHeight)));
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width,
      height
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: width + spacing,
      y: 0,
      width,
      height
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Right | AlbumRectPart.Bottom
  }];
}
function layoutTwoLeftRight(params) {
  const {
    ratios,
    minWidth,
    maxWidth,
    spacing,
    maxHeight
  } = params;
  const minimalWidth = Math.round(1.5 * minWidth);
  const secondWidth = Math.min(Math.round(Math.max(0.4 * (maxWidth - spacing), (maxWidth - spacing) / ratios[0] / (1 / ratios[0] + 1 / ratios[1]))), maxWidth - spacing - minimalWidth);
  const firstWidth = maxWidth - secondWidth - spacing;
  const height = Math.min(maxHeight, Math.round(Math.min(firstWidth / ratios[0], secondWidth / ratios[1])));
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: firstWidth,
      height
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: firstWidth + spacing,
      y: 0,
      width: secondWidth,
      height
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Right | AlbumRectPart.Bottom
  }];
}
function layoutThree(params) {
  const {
    proportions
  } = params;
  return proportions[0] === 'n' ? layoutThreeLeftAndOther(params) : layoutThreeTopAndOther(params);
}
function layoutThreeLeftAndOther(params) {
  const {
    maxHeight,
    spacing,
    ratios,
    maxWidth,
    minWidth
  } = params;
  const firstHeight = maxHeight;
  const thirdHeight = Math.round(Math.min((maxHeight - spacing) / 2, ratios[1] * (maxWidth - spacing) / (ratios[2] + ratios[1])));
  const secondHeight = firstHeight - thirdHeight - spacing;
  const rightWidth = Math.max(minWidth, Math.round(Math.min((maxWidth - spacing) / 2, Math.min(thirdHeight * ratios[2], secondHeight * ratios[1]))));
  const leftWidth = Math.min(Math.round(firstHeight * ratios[0]), maxWidth - spacing - rightWidth);
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: leftWidth,
      height: firstHeight
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: leftWidth + spacing,
      y: 0,
      width: rightWidth,
      height: secondHeight
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: leftWidth + spacing,
      y: secondHeight + spacing,
      width: rightWidth,
      height: thirdHeight
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Right
  }];
}
function layoutThreeTopAndOther(params) {
  const {
    maxWidth,
    ratios,
    maxHeight,
    spacing
  } = params;
  const firstWidth = maxWidth;
  const firstHeight = Math.round(Math.min(firstWidth / ratios[0], 0.66 * (maxHeight - spacing)));
  const secondWidth = (maxWidth - spacing) / 2;
  const secondHeight = Math.min(maxHeight - firstHeight - spacing, Math.round(Math.min(secondWidth / ratios[1], secondWidth / ratios[2])));
  const thirdWidth = firstWidth - secondWidth - spacing;
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: firstWidth,
      height: firstHeight
    },
    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: 0,
      y: firstHeight + spacing,
      width: secondWidth,
      height: secondHeight
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Left
  }, {
    dimensions: {
      x: secondWidth + spacing,
      y: firstHeight + spacing,
      width: thirdWidth,
      height: secondHeight
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Right
  }];
}
function layoutFour(params) {
  const {
    proportions
  } = params;
  return proportions[0] === 'w' ? layoutFourTopAndOther(params) : layoutFourLeftAndOther(params);
}
function layoutFourTopAndOther({
  maxWidth,
  ratios,
  spacing,
  maxHeight,
  minWidth
}) {
  const w = maxWidth;
  const h0 = Math.round(Math.min(w / ratios[0], 0.66 * (maxHeight - spacing)));
  const h = Math.round((maxWidth - 2 * spacing) / (ratios[1] + ratios[2] + ratios[3]));
  const w0 = Math.max(minWidth, Math.round(Math.min(0.4 * (maxWidth - 2 * spacing), h * ratios[1])));
  const w2 = Math.round(Math.max(Math.max(minWidth, 0.33 * (maxWidth - 2 * spacing)), h * ratios[3]));
  const w1 = w - w0 - w2 - 2 * spacing;
  const h1 = Math.min(maxHeight - h0 - spacing, h);
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: w,
      height: h0
    },
    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: 0,
      y: h0 + spacing,
      width: w0,
      height: h1
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Left
  }, {
    dimensions: {
      x: w0 + spacing,
      y: h0 + spacing,
      width: w1,
      height: h1
    },
    sides: AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: w0 + spacing + w1 + spacing,
      y: h0 + spacing,
      width: w2,
      height: h1
    },
    sides: AlbumRectPart.Right | AlbumRectPart.Bottom
  }];
}
function layoutFourLeftAndOther({
  maxHeight,
  ratios,
  maxWidth,
  spacing,
  minWidth
}) {
  const h = maxHeight;
  const w0 = Math.round(Math.min(h * ratios[0], 0.6 * (maxWidth - spacing)));
  const w = Math.round((maxHeight - 2 * spacing) / (1 / ratios[1] + 1 / ratios[2] + 1 / ratios[3]));
  const h0 = Math.round(w / ratios[1]);
  const h1 = Math.round(w / ratios[2]);
  const h2 = h - h0 - h1 - 2 * spacing;
  const w1 = Math.max(minWidth, Math.min(maxWidth - w0 - spacing, w));
  return [{
    dimensions: {
      x: 0,
      y: 0,
      width: w0,
      height: h
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom
  }, {
    dimensions: {
      x: w0 + spacing,
      y: 0,
      width: w1,
      height: h0
    },
    sides: AlbumRectPart.Top | AlbumRectPart.Right
  }, {
    dimensions: {
      x: w0 + spacing,
      y: h0 + spacing,
      width: w1,
      height: h1
    },
    sides: AlbumRectPart.Right
  }, {
    dimensions: {
      x: w0 + spacing,
      y: h0 + h1 + 2 * spacing,
      width: w1,
      height: h2
    },
    sides: AlbumRectPart.Bottom | AlbumRectPart.Right
  }];
}

/***/ },

/***/ "./src/components/middle/message/helpers/getCustomAppendixBg.ts"
/*!**********************************************************************!*\
  !*** ./src/components/middle/message/helpers/getCustomAppendixBg.ts ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ getCustomAppendixBg)
/* harmony export */ });
/* harmony import */ var _util_launchMediaWorkers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../util/launchMediaWorkers */ "./src/util/launchMediaWorkers.ts");

const SELECTED_APPENDIX_COLORS = {
  dark: {
    outgoing: 'rgb(135,116,225)',
    incoming: 'rgb(33,33,33)'
  },
  light: {
    outgoing: 'rgb(238,255,222)',
    incoming: 'rgb(255,255,255)'
  }
};
function getCustomAppendixBg(src, isOwn, id, isSelected, theme) {
  if (isSelected) {
    return Promise.resolve(SELECTED_APPENDIX_COLORS[theme || 'light'][isOwn ? 'outgoing' : 'incoming']);
  }
  return (0,_util_launchMediaWorkers__WEBPACK_IMPORTED_MODULE_0__.requestMediaWorker)({
    name: 'offscreen-canvas:getAppendixColorFromImage',
    args: [src, isOwn]
  }, Math.round(id) % _util_launchMediaWorkers__WEBPACK_IMPORTED_MODULE_0__.MAX_WORKERS);
}

/***/ },

/***/ "./src/components/middle/message/helpers/getSingularPaidMedia.ts"
/*!***********************************************************************!*\
  !*** ./src/components/middle/message/helpers/getSingularPaidMedia.ts ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ getSingularPaidMedia)
/* harmony export */ });
function getSingularPaidMedia(media) {
  if (!media || media.extendedMedia.length !== 1) {
    return {
      photo: undefined,
      video: undefined
    };
  }
  const singularMedia = media.extendedMedia[0];
  const isPreview = 'mediaType' in singularMedia;
  const photo = isPreview ? !singularMedia.duration ? singularMedia : undefined : singularMedia.photo;
  const video = isPreview ? singularMedia.duration ? singularMedia : undefined : singularMedia.video;
  return {
    photo,
    video
  };
}

/***/ },

/***/ "./src/components/middle/message/helpers/mediaDimensions.ts"
/*!******************************************************************!*\
  !*** ./src/components/middle/message/helpers/mediaDimensions.ts ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MIN_MEDIA_HEIGHT: () => (/* binding */ MIN_MEDIA_HEIGHT),
/* harmony export */   MIN_MEDIA_WIDTH_WITH_TEXT: () => (/* binding */ MIN_MEDIA_WIDTH_WITH_TEXT),
/* harmony export */   calculateMediaDimensions: () => (/* binding */ calculateMediaDimensions),
/* harmony export */   getMinMediaWidth: () => (/* binding */ getMinMediaWidth)
/* harmony export */ });
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");

const SMALL_IMAGE_THRESHOLD = 12;
const MIN_MESSAGE_LENGTH_FOR_BLUR = 40;
const MIN_MEDIA_WIDTH_WITH_TEXT = 20 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_0__.REM;
const MIN_MEDIA_WIDTH = SMALL_IMAGE_THRESHOLD * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_0__.REM;
const MIN_MEDIA_HEIGHT = 5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_0__.REM;
function getMinMediaWidth(text, hasCommentButton) {
  return (text?.length ?? 0) > MIN_MESSAGE_LENGTH_FOR_BLUR || hasCommentButton ? MIN_MEDIA_WIDTH_WITH_TEXT : MIN_MEDIA_WIDTH;
}
function calculateMediaDimensions({
  media,
  messageText,
  isOwn,
  isInWebPage,
  asForwarded,
  noAvatars,
  isMobile
}) {
  const isPhoto = media.mediaType === 'photo';
  const isVideo = media.mediaType === 'video';
  const isWebPagePhoto = isPhoto && isInWebPage;
  const isWebPageVideo = isVideo && isInWebPage;
  const {
    width,
    height
  } = isPhoto ? (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_0__.calculateInlineImageDimensions)(media, isOwn, asForwarded, isWebPagePhoto, noAvatars, isMobile) : isVideo ? (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_0__.calculateVideoDimensions)(media, isOwn, asForwarded, isWebPageVideo, noAvatars, isMobile) : (0,_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_0__.calculateExtendedPreviewDimensions)(media, isOwn, asForwarded, isInWebPage, noAvatars, isMobile);
  const minMediaWidth = getMinMediaWidth(messageText);
  let stretchFactor = 1;
  if (width < minMediaWidth && minMediaWidth - width < SMALL_IMAGE_THRESHOLD) {
    stretchFactor = minMediaWidth / width;
  }
  if (height * stretchFactor < MIN_MEDIA_HEIGHT && MIN_MEDIA_HEIGHT - height * stretchFactor < SMALL_IMAGE_THRESHOLD) {
    stretchFactor = MIN_MEDIA_HEIGHT / height;
  }
  const finalWidth = Math.round(width * stretchFactor);
  const finalHeight = Math.round(height * stretchFactor);
  return {
    width: finalWidth,
    height: finalHeight,
    isSmall: finalWidth < minMediaWidth || finalHeight < MIN_MEDIA_HEIGHT
  };
}

/***/ },

/***/ "./src/components/middle/message/helpers/webpageType.ts"
/*!**************************************************************!*\
  !*** ./src/components/middle/message/helpers/webpageType.ts ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getWebpageButtonLangKey: () => (/* binding */ getWebpageButtonLangKey)
/* harmony export */ });
// https://github.com/telegramdesktop/tdesktop/blob/3da787791f6d227f69b32bf4003bc6071d05e2ac/Telegram/SourceFiles/history/view/history_view_view_button.cpp#L51
function getWebpageButtonLangKey(type) {
  switch (type) {
    case 'telegram_channel_request':
    case 'telegram_megagroup_request':
    case 'telegram_chat_request':
      return 'ViewButtonRequestJoin';
    case 'telegram_message':
      return 'ViewButtonMessage';
    case 'telegram_bot':
      return 'ViewButtonBot';
    case 'telegram_voicechat':
      return 'ViewButtonVoiceChat';
    case 'telegram_livestream':
      return 'ViewButtonVoiceChatChannel';
    case 'telegram_megagroup':
    case 'telegram_chat':
      return 'ViewButtonGroup';
    case 'telegram_channel':
      return 'ViewButtonChannel';
    case 'telegram_user':
      return 'ViewButtonUser';
    case 'telegram_botapp':
      return 'ViewButtonBotApp';
    case 'telegram_chatlist':
      return 'ViewChatList';
    case 'telegram_story':
      return 'ViewButtonStory';
    case 'telegram_channel_boost':
    case 'telegram_group_boost':
      return 'ViewButtonBoost';
    case 'telegram_stickerset':
      return 'ViewButtonStickerset';
    case 'telegram_emojiset':
      return 'ViewButtonEmojiset';
    case 'telegram_nft':
      return 'ViewButtonGiftUnique';
    default:
      return undefined;
  }
}

/***/ },

/***/ "./src/components/middle/message/hocs/withSelectControl.tsx"
/*!******************************************************************!*\
  !*** ./src/components/middle/message/hocs/withSelectControl.tsx ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ withSelectControl)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");







function withSelectControl(WrappedComponent) {
  const ComponentWithSelectControl = props => {
    const {
      isInSelectMode,
      isSelected,
      dimensions,
      clickArg
    } = props;
    const {
      toggleMessageSelection
    } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
    const handleMessageSelect = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(e => {
      e.stopPropagation();
      toggleMessageSelection({
        messageId: clickArg,
        withShift: e?.shiftKey
      });
    });
    const newProps = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
      const {
        dimensions: dims,
        onClick
      } = props;
      return {
        ...props,
        isInSelectMode,
        isSelected,
        dimensions: {
          ...dims,
          x: 0,
          y: 0
        },
        onClick: isInSelectMode ? undefined : onClick
      };
    }, [props, isInSelectMode, isSelected]);
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('album-item-select-wrapper', isSelected && 'is-selected'),
      style: dimensions ? `left: ${dimensions.x}px; top: ${dimensions.y}px;` : '',
      onClick: isInSelectMode ? handleMessageSelect : undefined
    }, isInSelectMode && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "message-select-control"
    }, isSelected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_5__["default"], {
      name: "select"
    })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(WrappedComponent, newProps));
  };
  return (0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, ownProps) => {
    const {
      clickArg,
      noSelectControls
    } = ownProps;
    return {
      isInSelectMode: !noSelectControls && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsInSelectMode)(global),
      isSelected: !noSelectControls && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsMessageSelected)(global, clickArg)
    };
  })(ComponentWithSelectControl));
}

/***/ },

/***/ "./src/components/middle/message/hooks/useBlurredMediaThumbRef.ts"
/*!************************************************************************!*\
  !*** ./src/components/middle/message/hooks/useBlurredMediaThumbRef.ts ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useBlurredMediaThumbRef)
/* harmony export */ });
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _hooks_useOffscreenCanvasBlur__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../hooks/useOffscreenCanvasBlur */ "./src/hooks/useOffscreenCanvasBlur.ts");


function useBlurredMediaThumbRef(media, isDisabled) {
  const dataUri = media ? typeof media === 'string' ? media : (0,_global_helpers__WEBPACK_IMPORTED_MODULE_0__.getMediaThumbUri)(media) : undefined;
  return (0,_hooks_useOffscreenCanvasBlur__WEBPACK_IMPORTED_MODULE_1__["default"])(dataUri, isDisabled);
}

/***/ },

/***/ "./src/components/middle/message/hooks/useDetectChatLanguage.ts"
/*!**********************************************************************!*\
  !*** ./src/components/middle/message/hooks/useDetectChatLanguage.ts ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useDetectChatLanguage)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_primitives_LimitedMap__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/primitives/LimitedMap */ "./src/util/primitives/LimitedMap.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/schedulers */ "./src/util/schedulers.ts");





// https://github.com/DrKLO/Telegram/blob/dfd74f809e97d1ecad9672fc7388cb0223a95dfc/TMessagesProj/src/main/java/org/telegram/messenger/TranslateController.java#L35
const MIN_MESSAGES_CHECKED = 8;
const MIN_TRANSLATABLE_RATIO = 0.3;
const MIN_DETECTABLE_RATIO = 0.6;
const THROTTLE_DELAY = 1000;
const MESSAGES_LIMIT = 150;
const CHAT_STATS = new Map();
function useDetectChatLanguage(message, detectedLanguage, isDisabled, getIsReady) {
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled || getIsReady && !getIsReady()) return;
    const isTranslatable = Boolean(message.content.text?.text.length);
    processMessageMetadata({
      chatId: message.chatId,
      id: message.id,
      isTranslatable,
      detectedLanguage
    });
  }, [message, detectedLanguage, isDisabled, getIsReady]);
}
const throttledMakeChatDecision = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_3__.throttle)(makeChatDecision, THROTTLE_DELAY);
function processMessageMetadata({
  chatId,
  id,
  isTranslatable,
  detectedLanguage
}) {
  const chatStats = CHAT_STATS.get(chatId) || new _util_primitives_LimitedMap__WEBPACK_IMPORTED_MODULE_2__["default"](MESSAGES_LIMIT);
  const previousMetadata = chatStats.get(id);
  if (previousMetadata && previousMetadata.detectedLanguage === detectedLanguage && previousMetadata.isTranslatable === isTranslatable) {
    return;
  }
  chatStats.set(id, {
    id,
    isTranslatable,
    detectedLanguage
  });
  CHAT_STATS.set(chatId, chatStats);
  throttledMakeChatDecision(chatId);
}
function makeChatDecision(chatId) {
  const {
    updateChatDetectedLanguage
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const chatStats = CHAT_STATS.get(chatId);
  if (!chatStats) {
    return;
  }
  const messagesChecked = chatStats.size;
  if (messagesChecked < MIN_MESSAGES_CHECKED) {
    return;
  }
  let translatableCount = 0;
  let detectableCount = 0;
  const languageOccurrences = new Map();
  for (const metadata of chatStats.values()) {
    if (metadata.isTranslatable) {
      translatableCount++;
    }
    if (metadata.detectedLanguage) {
      detectableCount++;
    }
    const language = metadata.detectedLanguage;
    if (language) {
      const occurrences = languageOccurrences.get(language) || 0;
      languageOccurrences.set(language, occurrences + 1);
    }
  }
  const translatableRatio = translatableCount / messagesChecked;
  const detectableRatio = detectableCount / translatableCount;
  if (translatableRatio < MIN_TRANSLATABLE_RATIO || detectableRatio < MIN_DETECTABLE_RATIO) {
    return;
  }
  const mostFrequentLanguage = Array.from(languageOccurrences.entries()).sort(([, a], [, b]) => b - a)[0][0];
  updateChatDetectedLanguage({
    chatId,
    detectedLanguage: mostFrequentLanguage
  });
}

/***/ },

/***/ "./src/components/middle/message/hooks/useInnerHandlers.ts"
/*!*****************************************************************!*\
  !*** ./src/components/middle/message/hooks/useInnerHandlers.ts ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useInnerHandlers)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_replies__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers/replies */ "./src/global/helpers/replies.ts");
/* harmony import */ var _util_deepLinkParser__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/deepLinkParser */ "./src/util/deepLinkParser.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");







function useInnerHandlers({
  lang,
  selectMessage,
  message,
  webPage,
  chatId,
  threadId,
  isInDocumentGroup,
  asForwarded,
  isScheduled,
  album,
  senderPeer,
  botSender,
  messageTopic,
  isTranslatingChat,
  story,
  isReplyPrivate,
  isRepliesChat,
  isSavedMessages,
  lastPlaybackTimestamp
}) {
  const {
    openChat,
    showNotification,
    focusMessage,
    openMediaViewer,
    openAudioPlayer,
    markMessagesRead,
    cancelUploadMedia,
    sendPollVote,
    openForwardMenu,
    openChatLanguageModal,
    openThread,
    openStoryViewer,
    searchChatMediaMessages
  } = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getActions)();
  const {
    id: messageId,
    forwardInfo,
    groupedId,
    content: {
      paidMedia,
      video
    }
  } = message;
  const {
    replyToMsgId,
    replyToPeerId,
    replyToTopId,
    isQuote,
    quoteText,
    quoteOffset
  } = (0,_global_helpers_replies__WEBPACK_IMPORTED_MODULE_4__.getMessageReplyInfo)(message) || {};
  const handleSenderClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!senderPeer) {
      showNotification({
        message: lang('HidAccount')
      });
      return;
    }
    if (asForwarded && forwardInfo?.channelPostId) {
      focusMessage({
        chatId: senderPeer.id,
        messageId: forwardInfo.channelPostId
      });
    } else {
      openChat({
        id: senderPeer.id
      });
    }
  });
  const handleViaBotClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!botSender) {
      return;
    }
    openChat({
      id: botSender.id
    });
  });
  const handleReplyClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!replyToMsgId || isReplyPrivate) {
      showNotification({
        message: isQuote ? lang('QuotePrivate') : lang('ReplyPrivate')
      });
      return;
    }
    if (isRepliesChat && replyToPeerId && replyToTopId) {
      openThread({
        isComments: true,
        originChannelId: replyToPeerId,
        originMessageId: replyToTopId,
        focusMessageId: replyToMsgId
      });
      return;
    }
    focusMessage({
      chatId: replyToPeerId || chatId,
      threadId: isRepliesChat ? replyToTopId : threadId,
      // Open comments from Replies bot, otherwise, keep current thread
      messageId: replyToMsgId,
      replyMessageId: replyToPeerId ? undefined : messageId,
      noForumTopicPanel: !replyToPeerId,
      // Open topic panel for cross-chat replies
      ...(isQuote && {
        quote: quoteText?.text,
        quoteOffset
      })
    });
  });
  const handleDocumentClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openMediaViewer({
      chatId,
      threadId,
      messageId,
      origin: isScheduled ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ScheduledInline : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.Inline
    });
  });
  const openMediaViewerWithPhotoOrVideo = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(withDynamicLoading => {
    if (paidMedia && !paidMedia.isBought) return;
    if (withDynamicLoading) {
      searchChatMediaMessages({
        chatId,
        threadId,
        currentMediaMessageId: messageId
      });
    }
    const parsedLink = webPage?.url && (0,_util_deepLinkParser__WEBPACK_IMPORTED_MODULE_5__.tryParseDeepLink)(webPage.url);
    const videoContent = video || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getWebPageVideo)(webPage);
    const webpageTimestamp = parsedLink && 'timestamp' in parsedLink ? parsedLink.timestamp : undefined;
    openMediaViewer({
      chatId,
      threadId,
      messageId,
      origin: isScheduled ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ScheduledInline : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.Inline,
      timestamp: lastPlaybackTimestamp || videoContent?.timestamp || webpageTimestamp,
      withDynamicLoading
    });
  });
  const handlePhotoMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const withDynamicLoading = !isScheduled && !paidMedia;
    openMediaViewerWithPhotoOrVideo(withDynamicLoading);
  });
  const handleVideoMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const isGif = message.content?.video?.isGif;
    const withDynamicLoading = !isGif && !isScheduled && !paidMedia;
    openMediaViewerWithPhotoOrVideo(withDynamicLoading);
  });
  const handleMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const photo = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessagePhoto)(message) || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getWebPagePhoto)(webPage);
    if (photo) {
      handlePhotoMediaClick();
    }
    handleVideoMediaClick();
  });
  const handleAudioPlay = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openAudioPlayer({
      chatId,
      messageId
    });
  });
  const handleAlbumMediaClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])((albumMessageId, albumIndex) => {
    if (paidMedia && !paidMedia.isBought) return;
    searchChatMediaMessages({
      chatId,
      threadId,
      currentMediaMessageId: messageId
    });
    openMediaViewer({
      chatId,
      threadId,
      messageId: albumMessageId,
      mediaIndex: albumIndex,
      origin: isScheduled ? _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.ScheduledAlbum : _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.Album,
      withDynamicLoading: !paidMedia
    });
  });
  const handleReadMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    markMessagesRead({
      messageIds: [messageId]
    });
  });
  const handleCancelUpload = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    cancelUploadMedia({
      chatId,
      messageId
    });
  });
  const handleVoteSend = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(options => {
    sendPollVote({
      chatId,
      messageId,
      options
    });
  });
  const handleGroupForward = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openForwardMenu({
      fromChatId: chatId,
      groupedId
    });
  });
  const handleForward = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (album && album.messages) {
      const messageIds = album.messages.map(({
        id
      }) => id);
      openForwardMenu({
        fromChatId: chatId,
        messageIds
      });
    } else {
      openForwardMenu({
        fromChatId: chatId,
        messageIds: [messageId]
      });
    }
  });
  const handleFocus = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    focusMessage({
      chatId,
      threadId: _api_types__WEBPACK_IMPORTED_MODULE_1__.MAIN_THREAD_ID,
      messageId
    });
  });
  const handleFocusForwarded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    const originalChatId = isSavedMessages && forwardInfo.savedFromPeerId || forwardInfo.fromChatId;
    if (isInDocumentGroup) {
      focusMessage({
        chatId: originalChatId,
        groupedId,
        groupedChatId: chatId,
        messageId: forwardInfo.fromMessageId
      });
      return;
    }
    if (replyToPeerId && replyToTopId) {
      if (isRepliesChat) {
        openThread({
          isComments: true,
          originChannelId: replyToPeerId,
          originMessageId: replyToTopId,
          focusMessageId: forwardInfo.fromMessageId
        });
      } else {
        focusMessage({
          chatId: replyToPeerId,
          threadId: replyToTopId,
          messageId: forwardInfo.fromMessageId
        });
      }
    } else {
      focusMessage({
        chatId: originalChatId,
        messageId: forwardInfo.fromMessageId
      });
    }
  });
  const selectWithGroupedId = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(e => {
    e.stopPropagation();
    selectMessage(e, groupedId);
  });
  const handleTranslationClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(e => {
    e.stopPropagation();
    openChatLanguageModal({
      chatId,
      messageId: !isTranslatingChat ? messageId : undefined
    });
  });
  const handleOpenThread = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    openThread({
      chatId: message.chatId,
      threadId: message.id
    });
  });
  const handleTopicChipClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!messageTopic) return;
    focusMessage({
      chatId: replyToPeerId || chatId,
      threadId: messageTopic.id,
      messageId
    });
  });
  const handleStoryClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!story) return;
    openStoryViewer({
      peerId: story.peerId,
      storyId: story.id,
      isSingleStory: true
    });
  });
  return {
    handleSenderClick,
    handleViaBotClick,
    handleReplyClick,
    handleDocumentClick,
    handleMediaClick,
    handleAudioPlay,
    handleAlbumMediaClick,
    handlePhotoMediaClick,
    handleVideoMediaClick,
    handleMetaClick: selectWithGroupedId,
    handleTranslationClick,
    handleOpenThread,
    handleReadMedia,
    handleCancelUpload,
    handleVoteSend,
    handleGroupForward,
    handleForward,
    handleFocus,
    handleFocusForwarded,
    handleDocumentGroupSelectAll: selectWithGroupedId,
    handleTopicChipClick,
    handleStoryClick
  };
}

/***/ },

/***/ "./src/components/middle/message/hooks/useMessageTranslation.ts"
/*!**********************************************************************!*\
  !*** ./src/components/middle/message/hooks/useMessageTranslation.ts ***!
  \**********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useMessageTranslation)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/schedulers */ "./src/util/schedulers.ts");



const MESSAGE_LIMIT_PER_REQUEST = 20;
const THROTTLE_DELAY = 500;
const PENDING_TRANSLATIONS = new Map();
function useMessageTranslation(chatTranslations, chatId, messageId, requestedLanguageCode) {
  const messageTranslation = requestedLanguageCode && messageId ? chatTranslations?.byLangCode[requestedLanguageCode]?.[messageId] : undefined;
  const {
    isPending,
    text
  } = messageTranslation || {};
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!chatId || !messageId) return;
    if (!text && isPending === undefined && requestedLanguageCode) {
      addPendingTranslation(chatId, messageId, requestedLanguageCode);
    }
  }, [chatId, text, isPending, messageId, requestedLanguageCode]);
  if (!chatId || !messageId) {
    return {
      isPending: false,
      translatedText: undefined
    };
  }
  return {
    isPending,
    translatedText: text
  };
}
const throttledProcessPending = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_2__.throttle)(processPending, THROTTLE_DELAY);
function processPending() {
  const {
    translateMessagesByTencent
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  let hasUnprocessed = false;
  PENDING_TRANSLATIONS.forEach((chats, toLanguageCode) => {
    chats.forEach((messageIds, chatId) => {
      const messageIdsToTranslate = messageIds.slice(0, MESSAGE_LIMIT_PER_REQUEST);
      if (messageIdsToTranslate.length < messageIds.length) {
        hasUnprocessed = true;
      }
      translateMessagesByTencent({
        chatId,
        messageIds: messageIdsToTranslate,
        toLanguageCode
      });
      removePendingTranslations(chatId, messageIdsToTranslate, toLanguageCode);
    });
  });
  if (hasUnprocessed) {
    throttledProcessPending();
  }
}
function addPendingTranslation(chatId, messageId, toLanguageCode) {
  const languageTranslations = PENDING_TRANSLATIONS.get(toLanguageCode) || new Map();
  const messageIds = languageTranslations.get(chatId) || [];
  if (messageIds.includes(messageId)) {
    throttledProcessPending();
    return;
  }
  messageIds.push(messageId);
  languageTranslations.set(chatId, messageIds);
  PENDING_TRANSLATIONS.set(toLanguageCode, languageTranslations);
  (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().markMessagesTranslationPending({
    chatId,
    messageIds,
    toLanguageCode
  });
  throttledProcessPending();
}
function removePendingTranslations(chatId, messageIds, toLanguageCode) {
  const languageTranslations = PENDING_TRANSLATIONS.get(toLanguageCode);
  if (!languageTranslations?.size) {
    PENDING_TRANSLATIONS.delete(toLanguageCode);
    return;
  }
  const oldMessageIds = languageTranslations.get(chatId);
  if (!oldMessageIds?.length) {
    languageTranslations.delete(chatId);
    return;
  }
  const newMessageIds = oldMessageIds.filter(id => !messageIds.includes(id));
  if (!newMessageIds?.length) {
    languageTranslations.delete(chatId);
    if (!languageTranslations.size) {
      PENDING_TRANSLATIONS.delete(toLanguageCode);
    }
    return;
  }
  languageTranslations.set(chatId, newMessageIds);
}

/***/ },

/***/ "./src/components/middle/message/hooks/useOuterHandlers.ts"
/*!*****************************************************************!*\
  !*** ./src/components/middle/message/hooks/useOuterHandlers.ts ***!
  \*****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useOuterHandlers)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_captureEvents__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/captureEvents */ "./src/util/captureEvents.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _util_windowSize__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/windowSize */ "./src/util/windowSize.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useThrottledCallback */ "./src/hooks/useThrottledCallback.ts");











const ANDROID_KEYBOARD_HIDE_DELAY_MS = 350;
const SWIPE_ANIMATION_DURATION = 150;
const QUICK_REACTION_DOUBLE_TAP_DELAY = 200;
const QUICK_REACTION_AREA_WIDTH = 3 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__.REM;
const QUICK_REACTION_AREA_HEIGHT = Number(_common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_7__.REM);
const GROUP_MESSAGE_HOVER_ATTRIBUTE = 'data-is-document-group-hover';
function useOuterHandlers(selectMessage, containerRef, messageId, isInSelectMode, canReply, isProtected, onContextMenu, handleBeforeContextMenu, chatId, isContextMenuShown, quickReactionRef, shouldHandleMouseLeave, getIsMessageListReady) {
  const {
    updateDraftReplyInfo,
    sendDefaultReaction
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isQuickReactionVisible, markQuickReactionVisible, unmarkQuickReactionVisible] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [isSwiped, markSwiped, unmarkSwiped] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const doubleTapTimeoutRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  function handleMouseDown(e) {
    (0,_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_8__.preventMessageInputBlur)(e);
    handleBeforeContextMenu(e);
  }
  const handleMouseMove = (0,_hooks_useThrottledCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(e => {
    const quickReactionContainer = quickReactionRef.current;
    if (!quickReactionContainer) return;
    const {
      clientX,
      clientY
    } = e;
    const {
      x: quickReactionX,
      width: quickReactionWidth,
      y: quickReactionY,
      height: quickReactionHeight
    } = quickReactionContainer.getBoundingClientRect();
    const x = quickReactionX + quickReactionWidth / 2;
    const y = quickReactionY + quickReactionHeight / 2;
    const isVisibleX = Math.abs(x - clientX) < QUICK_REACTION_AREA_WIDTH;
    const isVisibleY = Math.abs(y - clientY) < QUICK_REACTION_AREA_HEIGHT;
    if (isVisibleX && isVisibleY) {
      markQuickReactionVisible();
    } else {
      unmarkQuickReactionVisible();
    }
  }, [quickReactionRef], _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure);
  function handleSendQuickReaction(e) {
    e.stopPropagation();
    sendDefaultReaction({
      chatId,
      messageId
    });
  }
  function handleTap(e) {
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_ANDROID) {
      const target = e.target;
      if (!target.classList.contains('text-content') && !target.classList.contains('Message')) {
        return;
      }
      if (_util_windowSize__WEBPACK_IMPORTED_MODULE_6__["default"].getIsKeyboardVisible()) {
        setTimeout(() => {
          onContextMenu(e);
        }, ANDROID_KEYBOARD_HIDE_DELAY_MS);
      } else {
        onContextMenu(e);
      }
    }
  }
  function handleDoubleTap() {
    sendDefaultReaction({
      chatId,
      messageId
    });
  }
  function handleClick(e) {
    if (isInSelectMode) {
      selectMessage(e);
      return;
    }
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV) return;
    if (doubleTapTimeoutRef.current) {
      clearInterval(doubleTapTimeoutRef.current);
      doubleTapTimeoutRef.current = undefined;
      handleDoubleTap();
      return;
    }
    doubleTapTimeoutRef.current = setTimeout(() => {
      doubleTapTimeoutRef.current = undefined;
      handleTap(e);
    }, QUICK_REACTION_DOUBLE_TAP_DELAY);
  }
  function handleContextMenu(e) {
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_ANDROID) {
      if (e.target.matches('a[href]') || isContextMenuShown) {
        return;
      }
      e.preventDefault();
      selectMessage();
    } else {
      onContextMenu(e);
    }
  }
  function handleContainerDoubleClick() {
    if (_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV || !canReply) return;
    updateDraftReplyInfo({
      replyToMsgId: messageId,
      replyToPeerId: undefined,
      quoteText: undefined,
      quoteOffset: undefined
    });
  }
  function stopPropagation(e) {
    e.stopPropagation();
  }
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV || isInSelectMode || !canReply || isContextMenuShown || !getIsMessageListReady?.()) {
      return undefined;
    }
    let startedAt;
    return (0,_util_captureEvents__WEBPACK_IMPORTED_MODULE_4__.captureEvents)(containerRef.current, {
      selectorToPreventScroll: '.MessageList',
      excludedClosestSelector: '.no-word-wrap',
      onSwipe: (e, direction) => {
        if (direction === _util_captureEvents__WEBPACK_IMPORTED_MODULE_4__.SwipeDirection.Left) {
          if (!startedAt) {
            startedAt = Date.now();
          }
          markSwiped();
          return true;
        }
        return false;
      },
      onRelease: () => {
        if (!startedAt || !canReply) {
          return;
        }
        updateDraftReplyInfo({
          replyToMsgId: messageId
        });
        setTimeout(unmarkSwiped, Math.max(0, SWIPE_ANIMATION_DURATION - (Date.now() - startedAt)));
        startedAt = undefined;
      }
    });
  }, [containerRef, isInSelectMode, messageId, markSwiped, unmarkSwiped, canReply, isContextMenuShown, getIsMessageListReady]);
  function handleMouseLeave(e) {
    // Because `mousemove` event is throttled, we need to also throttle `mouseleave` event,
    // so the order of events is preserved
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMeasure)(unmarkQuickReactionVisible);
    if (shouldHandleMouseLeave) handleDocumentGroupMouseLeave(e);
  }
  return {
    handleMouseDown: !isInSelectMode ? handleMouseDown : undefined,
    handleClick,
    handleContextMenu: !isInSelectMode ? handleContextMenu : isProtected ? _util_stopEvent__WEBPACK_IMPORTED_MODULE_5__["default"] : undefined,
    handleDoubleClick: !isInSelectMode ? handleContainerDoubleClick : undefined,
    handleContentDoubleClick: !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_TOUCH_ENV ? stopPropagation : undefined,
    handleMouseMove,
    handleSendQuickReaction,
    handleMouseLeave,
    isSwiped,
    isQuickReactionVisible,
    handleDocumentGroupMouseEnter
  };
}
function handleDocumentGroupMouseEnter(e) {
  const lastGroupElement = getLastElementInDocumentGroup(e.currentTarget);
  if (lastGroupElement) {
    lastGroupElement.setAttribute(GROUP_MESSAGE_HOVER_ATTRIBUTE, '');
  }
}
function handleDocumentGroupMouseLeave(e) {
  const lastGroupElement = getLastElementInDocumentGroup(e.currentTarget);
  if (lastGroupElement) {
    lastGroupElement.removeAttribute(GROUP_MESSAGE_HOVER_ATTRIBUTE);
  }
}
function getLastElementInDocumentGroup(element) {
  let current = element;
  do {
    current = current.nextElementSibling;
  } while (current && !current.classList.contains('last-in-document-group'));
  return current;
}

/***/ },

/***/ "./src/components/middle/message/hooks/useOverlayPosition.ts"
/*!*******************************************************************!*\
  !*** ./src/components/middle/message/hooks/useOverlayPosition.ts ***!
  \*******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useOverlayPosition)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");




const OFFSET_X = _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__.REM;
function useOverlayPosition({
  anchorRef,
  overlayRef,
  isMirrored,
  isForMessageEffect,
  isDisabled,
  id
}) {
  const updatePosition = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    const element = overlayRef.current;
    const anchor = anchorRef.current;
    if (!element || !anchor) {
      return;
    }
    const anchorRect = anchor.getBoundingClientRect();
    const elementRect = element.getBoundingClientRect();
    const windowWidth = window.innerWidth;
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      const anchorCenterY = anchorRect.top + anchorRect.height / 2;
      const anchorBottomY = anchorRect.bottom;
      const y = isForMessageEffect ? anchorBottomY : anchorCenterY;
      element.style.top = `${y - elementRect.height / 2}px`;
      if (isMirrored) {
        element.style.left = `${anchorRect.left - OFFSET_X}px`;
      } else {
        element.style.right = `${windowWidth - anchorRect.right - OFFSET_X}px`;
      }
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled) return;
    updatePosition();
  }, [isDisabled, id]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled) return undefined;
    const messagesContainer = anchorRef.current.closest('.MessageList');
    if (!messagesContainer) return undefined;
    messagesContainer.addEventListener('scroll', updatePosition, {
      passive: true
    });
    return () => {
      messagesContainer.removeEventListener('scroll', updatePosition);
    };
  }, [isDisabled, anchorRef]);
  return updatePosition;
}

/***/ },

/***/ "./src/components/right/DeleteMemberModal.tsx"
/*!****************************************************!*\
  !*** ./src/components/right/DeleteMemberModal.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");








const DeleteMemberModal = ({
  isOpen,
  chat,
  userId,
  contactName,
  onClose
}) => {
  const {
    deleteChatMember
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleDeleteChatMember = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    deleteChatMember({
      chatId: chat.id,
      userId: userId
    });
    onClose();
  }, [chat, deleteChatMember, onClose, userId]);
  if (!chat || !userId) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_6__["default"], {
    isOpen: isOpen,
    onClose: onClose,
    title: lang('GroupRemoved.Remove'),
    textParts: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_4__["default"])(lang('PeerInfo.Confirm.RemovePeer', contactName)),
    confirmLabel: lang('lng_box_remove'),
    confirmHandler: handleDeleteChatMember,
    confirmIsDestructive: true
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  userId
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentChat)(global);
  const user = userId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, userId);
  const contactName = user ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFirstOrLastName)(user) : undefined;
  return {
    chat,
    contactName
  };
})(DeleteMemberModal)));

/***/ },

/***/ "./src/components/right/hooks/useAsyncRendering.ts"
/*!*********************************************************!*\
  !*** ./src/components/right/hooks/useAsyncRendering.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useAsyncRendering)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../hooks/useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../hooks/useSyncEffect */ "./src/hooks/useSyncEffect.ts");



function useAsyncRendering(dependencies, delay) {
  const isDisabled = delay === undefined;
  const shouldRenderRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(isDisabled);
  const timeoutRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const forceUpdate = (0,_hooks_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__["default"])();
  (0,_hooks_useSyncEffect__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    if (isDisabled) {
      return;
    }
    shouldRenderRef.current = false;
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
      timeoutRef.current = undefined;
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, dependencies);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled || shouldRenderRef.current) {
      return;
    }
    const exec = () => {
      shouldRenderRef.current = true;
      forceUpdate();
    };
    if (delay > 0) {
      timeoutRef.current = window.setTimeout(exec, delay);
    } else {
      exec();
    }
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, dependencies);
  return shouldRenderRef.current;
}

/***/ },

/***/ "./src/components/right/hooks/usePortrait.ts"
/*!***************************************************!*\
  !*** ./src/components/right/hooks/usePortrait.ts ***!
  \***************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePortrait)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_userPortrait__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/userPortrait */ "./src/util/userPortrait.ts");
/* harmony import */ var _chatAssistant_store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../chatAssistant/store */ "./src/components/chatAssistant/store/index.ts");
/* harmony import */ var _chatAssistant_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../chatAssistant/utils/ai-analyse-message */ "./src/components/chatAssistant/utils/ai-analyse-message.ts");
/* harmony import */ var _chatAssistant_utils_chat_api__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../chatAssistant/utils/chat-api */ "./src/components/chatAssistant/utils/chat-api.ts");






function usePortrait({
  userId
}) {
  const [loading, setLoading] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [messages, setMessages] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [userInfo, setUserInfo] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const [newUserInfo, setNewUserInfo] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const [portraitMessage, setPortraitMessage] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const [chatTags, setChatTags] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)([]);
  const searchUserMessages = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async senderId => {
    setLoading(true);
    const res = await (0,_util_userPortrait__WEBPACK_IMPORTED_MODULE_2__.getMessageBySendId)(senderId);
    setMessages(res?.filter(o => !(0,_chatAssistant_utils_ai_analyse_message__WEBPACK_IMPORTED_MODULE_4__.checkIsUrl)(o?.content)));
    setLoading(false);
  }, [setMessages]);
  const getActivityMessage = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(async senderId => {
    const portraitInfo = await _chatAssistant_store__WEBPACK_IMPORTED_MODULE_3__.ChataiStores.userPortrait?.getUserPortrait(senderId);
    if (portraitInfo) {
      setUserInfo(portraitInfo);
      setNewUserInfo(portraitInfo);
    } else {
      setUserInfo(undefined);
      setNewUserInfo(undefined);
    }
    const res = await _chatAssistant_store__WEBPACK_IMPORTED_MODULE_3__.ChataiStores.userPortraitMessage?.searchMessageBySenderId(senderId);
    setPortraitMessage(res);
  }, []);
  const handleSummaryMessages = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (messages?.length === 0) return;
    const maxId = Math.max(...messages.map(obj => obj.messageId));
    if ((!userInfo || !userInfo?.lastMsgId || userInfo && userInfo?.lastMsgId < maxId) && userId === messages?.[0]?.senderId) {
      const lastMsgId = userInfo?.lastMsgId ?? 0;
      const chatCountByChatId = messages.reduce((acc, message) => {
        acc[message.chatId] = (acc[message.chatId] || 0) + 1;
        return acc;
      }, {});
      const sortedChatIds = Object.entries(chatCountByChatId).sort((a, b) => b[1] - a[1]).map(entry => entry[0]);
      (0,_chatAssistant_utils_chat_api__WEBPACK_IMPORTED_MODULE_5__.chatAIUserTags)({
        messages: messages?.slice(0, 100)
      }).then(res => {
        if (res.code === 0 && res.data) {
          const userObj = {
            ...userInfo,
            id: userId,
            lastMsgId: maxId,
            langs: res.data?.langs,
            tags: res.data?.tags,
            chatCount: Object.keys(chatCountByChatId).length,
            chatIds: sortedChatIds
          };
          _chatAssistant_store__WEBPACK_IMPORTED_MODULE_3__.ChataiStores.userPortrait?.addUserPortrait(userObj);
          setNewUserInfo(userObj);
        }
      });
      const groupMessages = (0,_util_userPortrait__WEBPACK_IMPORTED_MODULE_2__.groupMessagesByHalfHour)(messages.filter(msg => msg.messageId > lastMsgId));
      if (groupMessages.length === 0) return;
      setLoading(true);
      const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
      const {
        telyAiLanguage = 'en'
      } = global.settings.byKey;
      (0,_chatAssistant_utils_chat_api__WEBPACK_IMPORTED_MODULE_5__.chatAIUserActivities)({
        language: telyAiLanguage,
        groupMessages
      }).then(res => {
        if (res.code === 0 && res.data && res.data.activities && Array.isArray(res.data.activities)) {
          const resultArr = [];
          res.data.activities?.forEach(item => {
            const sourceObj = groupMessages.find(o => o?.timeRange === item?.timeRange && o?.time === item?.time);
            const obj = {
              id: `${userId}-(${item?.time})-(${item?.timeRange})`,
              senderId: userId,
              isSummary: true,
              time: item?.time,
              timeRange: item?.timeRange,
              summaryTime: new Date().getTime(),
              messageCount: sourceObj?.chatGroups?.reduce((pre, cur) => pre + ((cur?.messages || [])?.length ?? 0), 0) ?? 0,
              chatGroups: item?.chatGroups?.map(chatGroup => ({
                chatId: chatGroup?.chatId,
                title: chatGroup?.title,
                summaryItems: chatGroup?.summaryItems
              }))
            };
            _chatAssistant_store__WEBPACK_IMPORTED_MODULE_3__.ChataiStores.userPortraitMessage?.addUserPortraitMessage(obj);
            resultArr.push(obj);
          });
          // delete old summary message TODO

          setPortraitMessage(pre => [...pre, ...resultArr]);
          setLoading(false);
        }
      }).catch(() => {
        setLoading(false);
      });
    }
  }, [messages, userId, userInfo]);
  const getChatTags = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    const newChatTags = [];
    if (newUserInfo?.chatIds && newUserInfo?.chatIds?.length > 0) {
      newUserInfo?.chatIds?.slice(0, 5).forEach(async chatI => {
        const chatFolder = await _chatAssistant_store__WEBPACK_IMPORTED_MODULE_3__.ChataiStores.aIChatFolders?.getAIChatFolder(chatI);
        newChatTags.push(chatFolder?.summary);
      });
    }
    setChatTags(newChatTags);
  }, [newUserInfo?.chatIds]);
  function resetState() {
    setLoading(false);
    setMessages([]);
    setPortraitMessage([]);
    setNewUserInfo({});
    setChatTags([]);
  }
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    handleSummaryMessages();
  }, [messages?.length, userInfo?.lastMsgId, handleSummaryMessages]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    getChatTags();
  }, [getChatTags, newUserInfo?.chatIds]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    resetState();
    getActivityMessage(userId);
    searchUserMessages(userId);
  }, [userId, searchUserMessages, getActivityMessage]);
  return {
    userPortraitInfo: newUserInfo,
    chatTags,
    portraitMessage,
    loading
  };
}

/***/ },

/***/ "./src/components/right/statistics/StatisticsOverview.module.scss"
/*!************************************************************************!*\
  !*** ./src/components/right/statistics/StatisticsOverview.module.scss ***!
  \************************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"Gi8Nokbl","header":"H01lE7mv","title":"VQbs04hT","caption":"X7bBlGdi","table":"s5beXqqL","tableCell":"gvrp3KoR","tableHeading":"IHb3ZATQ","tableValue":"zAPFdKbZ","tableSecondaryValue":"_mYEmh_u","value":"idLrmbhS","negative":"SLfwGHQC","decimalPart":"ZAfXkuWL","decimalUsdPart":"HRXb_S2M","toncoin":"it39BC_c"});

/***/ },

/***/ "./src/components/right/statistics/StatisticsOverview.tsx"
/*!****************************************************************!*\
  !*** ./src/components/right/statistics/StatisticsOverview.tsx ***!
  \****************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./StatisticsOverview.module.scss */ "./src/components/right/statistics/StatisticsOverview.module.scss");









const CHANNEL_OVERVIEW = [[{
  name: 'followers',
  title: 'ChannelStats.Overview.Followers'
}, {
  name: 'enabledNotifications',
  title: 'ChannelStats.Overview.EnabledNotifications',
  isPercentage: true
}], [{
  name: 'viewsPerPost',
  title: 'ChannelStats.Overview.ViewsPerPost'
}, {
  name: 'viewsPerStory',
  title: 'ChannelStats.Overview.ViewsPerStory'
}], [{
  name: 'sharesPerPost',
  title: 'ChannelStats.Overview.SharesPerPost'
}, {
  name: 'sharesPerStory',
  title: 'ChannelStats.Overview.SharesPerStory'
}], [{
  name: 'reactionsPerPost',
  title: 'ChannelStats.Overview.ReactionsPerPost'
}, {
  name: 'reactionsPerStory',
  title: 'ChannelStats.Overview.ReactionsPerStory'
}]];
const GROUP_OVERVIEW = [[{
  name: 'members',
  title: 'Stats.GroupMembers'
}, {
  name: 'messages',
  title: 'Stats.GroupMessages'
}], [{
  name: 'viewers',
  title: 'Stats.GroupViewers'
}, {
  name: 'posters',
  title: 'Stats.GroupPosters'
}]];
const MESSAGE_OVERVIEW = [[{
  name: 'viewsCount',
  title: 'Stats.Message.Views',
  isPlain: true
}, {
  name: 'publicForwards',
  title: 'Stats.Message.PublicShares',
  isPlain: true
}], [{
  name: 'reactionsCount',
  title: 'Channel.Stats.Overview.Reactions',
  isPlain: true
}, {
  name: 'forwardsCount',
  title: 'Stats.Message.PrivateShares',
  isPlain: true,
  isApproximate: true
}]];
const STORY_OVERVIEW = [[{
  name: 'viewsCount',
  title: 'Channel.Stats.Overview.Views',
  isPlain: true
}, {
  name: 'publicForwards',
  title: 'PublicShares',
  isPlain: true
}], [{
  name: 'reactionsCount',
  title: 'Channel.Stats.Overview.Reactions',
  isPlain: true
}, {
  name: 'forwardsCount',
  title: 'PrivateShares',
  isPlain: true
}]];
const BOOST_OVERVIEW = [[{
  name: 'level',
  title: 'Stats.Boosts.Level',
  isPlain: true
}, {
  name: 'premiumSubscribers',
  title: 'Stats.Boosts.PremiumSubscribers',
  isPercentage: true,
  isApproximate: true,
  withAbsoluteValue: true
}], [{
  name: 'boosts',
  title: 'Stats.Boosts.ExistingBoosts',
  isPlain: true
}, {
  name: 'remainingBoosts',
  title: 'Stats.Boosts.BoostsToLevelUp',
  isPlain: true
}]];
const DEFAULT_VALUE = 0;
const StatisticsOverview = ({
  title,
  type,
  statistics,
  isToncoin,
  className,
  subtitle
}) => {
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const renderOverviewItemValue = ({
    change,
    percentage
  }) => {
    if (!change) {
      return undefined;
    }
    const isChangeNegative = Number(change) < 0;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].value, isChangeNegative && _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].negative)
    }, isChangeNegative ? `-${(0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatIntegerCompact)(lang, Math.abs(change))}` : `+${(0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatIntegerCompact)(lang, change)}`, percentage && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, ' ', "(", percentage, "%)"));
  };
  const renderBalanceCell = (balance, usdRate, text) => {
    const [integerTonPart, decimalTonPart] = balance.toFixed(4).split('.');
    const [integerUsdPart, decimalUsdPart] = (balance * usdRate).toFixed(2).split('.');
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].toncoin,
      name: "toncoin"
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("b", {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableValue
    }, integerTonPart, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].decimalPart
    }, ".", decimalTonPart)), ' ', /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableHeading
    }, "\u2248 $", integerUsdPart, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].decimalUsdPart
    }, ".", decimalUsdPart)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableHeading
    }, oldLang(text)));
  };
  const {
    period
  } = statistics;
  const {
    balances,
    usdRate
  } = statistics;
  const schema = getSchemaByType(type);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_1__["default"])(_StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root, className)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].header
  }, title && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].title
  }, title), period && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].caption
  }, (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatFullDate)(oldLang, period.minDate * 1000), ' ', "\u2014", (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_2__.formatFullDate)(oldLang, period.maxDate * 1000))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("table", {
    className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].table
  }, isToncoin ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("tr", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("td", {
    className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableCell
  }, renderBalanceCell(balances?.availableBalance || 0, usdRate || 0, 'lng_channel_earn_available'), renderBalanceCell(balances?.currentBalance || 0, usdRate || 0, 'lng_channel_earn_reward'), renderBalanceCell(balances?.overallRevenue || 0, usdRate || 0, 'lng_channel_earn_total'))) : schema.map(row => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("tr", null, row.map(cell => {
    const field = statistics?.[cell.name];
    if (cell.isPlain) {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("td", {
        className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableCell
      }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("b", {
        className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableValue
      }, `${cell.isApproximate ? '≈ ' : ''}${(0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatInteger)(field ?? DEFAULT_VALUE)}`), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
        className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableHeading
      }, oldLang(cell.title)));
    }
    if (cell.isPercentage) {
      const part = field?.part ?? DEFAULT_VALUE;
      const percentage = field?.percentage ?? DEFAULT_VALUE;
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("td", {
        className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableCell
      }, cell.withAbsoluteValue && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableValue
      }, `${cell.isApproximate ? '≈ ' : ''}${(0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatInteger)(part)}`), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
        className: cell.withAbsoluteValue ? _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableSecondaryValue : _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableValue
      }, percentage, "%"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
        className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableHeading
      }, oldLang(cell.title)));
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("td", {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableCell
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("b", {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableValue
    }, (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatIntegerCompact)(lang, field?.current ?? DEFAULT_VALUE)), ' ', renderOverviewItemValue(field), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("h3", {
      className: _StatisticsOverview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].tableHeading
    }, oldLang(cell.title)));
  })))), subtitle);
};
function getSchemaByType(type) {
  switch (type) {
    case 'group':
      return GROUP_OVERVIEW;
    case 'message':
      return MESSAGE_OVERVIEW;
    case 'boost':
      return BOOST_OVERVIEW;
    case 'story':
      return STORY_OVERVIEW;
    case 'channel':
    default:
      return CHANNEL_OVERVIEW;
  }
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StatisticsOverview));

/***/ },

/***/ "./src/components/right/statistics/helpers/isGraph.ts"
/*!************************************************************!*\
  !*** ./src/components/right/statistics/helpers/isGraph.ts ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   isGraph: () => (/* binding */ isGraph)
/* harmony export */ });
function isGraph(obj) {
  // eslint-disable-next-line no-null/no-null
  return typeof obj === 'object' && obj !== null && 'graphType' in obj;
}

/***/ },

/***/ "./src/components/right/userPortrait/ActivityMessage.tsx"
/*!***************************************************************!*\
  !*** ./src/components/right/userPortrait/ActivityMessage.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _SummaryActivity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SummaryActivity */ "./src/components/right/userPortrait/SummaryActivity.tsx");


function ActivityMessage({
  user,
  data,
  isLast
}) {
  const isAiSummary = data.isSummary !== false;
  const isStory = !isAiSummary ? data?.id?.split('-')[1] === 'story' : false;
  return isAiSummary ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SummaryActivity__WEBPACK_IMPORTED_MODULE_1__["default"], {
    data: data,
    isLast: isLast
  }) : isStory ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_SummaryActivity__WEBPACK_IMPORTED_MODULE_1__.StoryActivity, {
    data: data,
    isLast: isLast,
    user: user
  }) : undefined;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ActivityMessage);

/***/ },

/***/ "./src/components/right/userPortrait/SummaryActivity.tsx"
/*!***************************************************************!*\
  !*** ./src/components/right/userPortrait/SummaryActivity.tsx ***!
  \***************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   StoryActivity: () => (/* binding */ StoryActivity),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dayjs */ "./node_modules/dayjs/dayjs.min.js");
/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _chatAssistant_assets_calendar_png__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../chatAssistant/assets/calendar.png */ "./src/components/chatAssistant/assets/calendar.png");
/* harmony import */ var _chatAssistant_assets_message_png__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../chatAssistant/assets/message.png */ "./src/components/chatAssistant/assets/message.png");
/* harmony import */ var _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../chatAssistant/assets/serena.png */ "./src/components/chatAssistant/assets/serena.png");
/* harmony import */ var _story_MediaStory__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../story/MediaStory */ "./src/components/story/MediaStory.tsx");
/* harmony import */ var _UserPortraitAvatar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./UserPortraitAvatar */ "./src/components/right/userPortrait/UserPortraitAvatar.tsx");









const SummaryTopicItem = ({
  topicItem,
  index,
  chatId
}) => {
  const {
    title,
    summaryItems
  } = topicItem;
  // if (!summaryItems.length) return undefined;
  if (!title || !chatId) return undefined;
  const {
    focusMessage
  } = (0,_global__WEBPACK_IMPORTED_MODULE_2__.getActions)();
  function openMessageDetail(msgIds) {
    if (!chatId) return;
    const minId = Math.min(...msgIds);
    if (minId) {
      focusMessage({
        chatId,
        messageId: minId
      });
    }
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "px-3"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex flex-row items-center flex-wrap"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("span", {
    className: "font-[700] mr-[14px]"
  }, index + 1, ". ", title), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_UserPortraitAvatar__WEBPACK_IMPORTED_MODULE_8__["default"], {
    chatId: chatId
  })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("ul", {
    className: "list-disc pl-1 list-inside"
  }, summaryItems.map(summaryItem => {
    const {
      content,
      relevantMessageIds
    } = summaryItem;
    if (!content) return undefined;
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("li", {
      role: "button",
      className: "cursor-pointer break-words",
      onClick: () => openMessageDetail(relevantMessageIds)
    }, content);
  })));
};
const SummaryActivity = ({
  data,
  isLast
}) => {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('flex flex-col border-b-[1px]', isLast ? 'border-[transparent]' : 'border-[#EDEDED]')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex items-center justify-between gap-1 px-3"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("img", {
    src: _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_6__,
    className: "w-[22px] h-[22px]",
    alt: ""
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "font-[600]"
  }, "TelyAI")), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "text-[12px] text-[#979797]"
  }, dayjs__WEBPACK_IMPORTED_MODULE_0___default()(data?.time).format('MMM D'), ", ", data?.timeRange?.split('-')?.[1])), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "my-2 px-3"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _chatAssistant_assets_calendar_png__WEBPACK_IMPORTED_MODULE_4__,
    alt: ""
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex items-center gap-[4px]"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("span", {
    className: "mr-[4px] font-bold text-[14px]"
  }, "Time range: "), dayjs__WEBPACK_IMPORTED_MODULE_0___default()(data?.time).format('MMM D'), ", ", data?.timeRange)), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex items-center gap-[8px]"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("img", {
    className: "w-[16px] h-[16px]",
    src: _chatAssistant_assets_message_png__WEBPACK_IMPORTED_MODULE_5__,
    alt: ""
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex items-center gap-[4px]"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("span", {
    className: "font-bold text-[14px]"
  }, "Messages: "), data?.messageCount ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("span", null, data?.messageCount) : undefined))), data?.chatGroups?.map((chatGroup, index) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(SummaryTopicItem, {
    key: chatGroup?.chatId,
    chatId: chatGroup?.chatId,
    topicItem: chatGroup,
    index: index
  })));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SummaryActivity);
const StoryActivity = ({
  user,
  data,
  isLast
}) => {
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])('flex flex-col pb-3 border-b-[1px]', isLast ? 'border-[transparent]' : 'border-[#EDEDED]')
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex items-center justify-between gap-1 px-3"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("img", {
    src: _chatAssistant_assets_serena_png__WEBPACK_IMPORTED_MODULE_6__,
    className: "w-[22px] h-[22px]",
    alt: ""
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "font-[600]"
  }, "TelyAI")), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "text-[12px] text-[#979797]"
  }, dayjs__WEBPACK_IMPORTED_MODULE_0___default()(data?.time).format('MMM D, HH:mm'))), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "ml-[25px] mt-2 px-3"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("div", {
    className: "mb-1"
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement("span", {
    className: "font-[600]"
  }, user?.firstName || '', " ", user?.lastName || ''), "Post a Story"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_1__["default"].createElement(_story_MediaStory__WEBPACK_IMPORTED_MODULE_7__["default"], {
    story: data.message,
    isArchive: false
  })));
};

/***/ },

/***/ "./src/components/right/userPortrait/UserPortrait.scss"
/*!*************************************************************!*\
  !*** ./src/components/right/userPortrait/UserPortrait.scss ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ },

/***/ "./src/components/right/userPortrait/UserPortrait.tsx"
/*!************************************************************!*\
  !*** ./src/components/right/userPortrait/UserPortrait.tsx ***!
  \************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PortraitTagColors: () => (/* binding */ PortraitTagColors),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! dayjs */ "./node_modules/dayjs/dayjs.min.js");
/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePortrait__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../hooks/usePortrait */ "./src/components/right/hooks/usePortrait.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Spinner__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/Spinner */ "./src/components/ui/Spinner.tsx");
/* harmony import */ var _ActivityMessage__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./ActivityMessage */ "./src/components/right/userPortrait/ActivityMessage.tsx");
/* harmony import */ var _UserPortraitAvatar__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./UserPortraitAvatar */ "./src/components/right/userPortrait/UserPortraitAvatar.tsx");
/* harmony import */ var _UserPortrait_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./UserPortrait.scss */ "./src/components/right/userPortrait/UserPortrait.scss");
/* harmony import */ var _chatAssistant_room_ai_room_ai_module_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../chatAssistant/room-ai/room-ai.module.scss */ "./src/components/chatAssistant/room-ai/room-ai.module.scss");
/* harmony import */ var _common_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/ProfileInfo.module.scss */ "./src/components/common/ProfileInfo.module.scss");

/* eslint-disable max-len */

















const PortraitTagColors = ['#E5D9FF', '#CCD6FF', '#B6FFCE', '#FFD9D9', '#FFD9FF'];
const UserPortrait = ({
  theme,
  userId,
  user
}) => {
  const {
    loading,
    userPortraitInfo,
    chatTags,
    portraitMessage
  } = (0,_hooks_usePortrait__WEBPACK_IMPORTED_MODULE_7__["default"])({
    userId
  });
  // eslint-disable-next-line no-null/no-null
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  function renderBasicInfo() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex flex-col gap-2 items-center justify-center"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_8__["default"], {
      peer: user,
      className: _common_ProfileInfo_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].fallbackPhotoAvatar,
      size: "giant"
    }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_9__["default"], {
      peer: user,
      canCopyTitle: true
    })), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[14px]"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-[16px] font-[700] mb-2"
    }, "Basic Description"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex flex-col gap-1"
    }, user?.usernames?.[0]?.username && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "font-[600]"
    }, "Username: "), user?.usernames?.[0]?.username), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "font-[600]"
    }, "Alias/Nickname: "), user?.firstName, " ", user?.lastName), userPortraitInfo?.langs && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "font-[600]"
    }, "Language: "), `${userPortraitInfo?.langs?.[0] ? `${userPortraitInfo?.langs?.[0]}(Primary)` : ''} ${userPortraitInfo?.langs?.[1] ? `, ${userPortraitInfo?.langs?.[1]}(Secondary)` : ''}`), userPortraitInfo?.tags && userPortraitInfo?.tags?.length > 0 && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
      className: "font-[600]"
    }, "Tags: ")), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex flex-row flex-wrap items-center gap-2"
    }, userPortraitInfo?.tags?.map((tag, index) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex items-center justify-center px-2 rounded-[4px] h-[28px] text-[12px] font-[500] text-black",
      style: `background: ${PortraitTagColors[index]}`
    }, tag)))))));
  }
  function renderBehaGroup() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] p-3 text-[14px]"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "text-[16px] font-[700] mb-2"
    }, "Behavioral Features & Group Participation"), userPortraitInfo?.chatCount && userPortraitInfo?.chatCount > 0 && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "font-[600]"
    }, "Group Coverage"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, "Participates in ", userPortraitInfo?.chatCount, " TG groups", ' ', chatTags?.length > 0 && chatTags?.filter(Boolean).length > 0 && `(${(0,lodash__WEBPACK_IMPORTED_MODULE_2__.uniq)(chatTags).join(',')})`)), userPortraitInfo?.chatIds?.length && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "mt-2"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "font-[600]"
    }, "Key Groups"), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex flex-col gap-2 mt-2"
    }, userPortraitInfo?.chatIds?.map(item => {
      return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_UserPortraitAvatar__WEBPACK_IMPORTED_MODULE_13__["default"], {
        key: item,
        chatId: item,
        size: 24,
        showName: true
      });
    }))));
  }
  function renderActivity() {
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "rounded-[16px] bg-[var(--color-ai-room-media-bg)] text-[14px]"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: " rounded-t-[16px] text-[16px] font-[700] p-3 sticky top-[-10px] z-10 bg-[var(--color-ai-room-media-bg)] "
    }, "Activity Stream"), loading && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex items-center justify-center p-3"
    }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Spinner__WEBPACK_IMPORTED_MODULE_11__["default"], {
      className: "w-[18px] h-[18px] ml-2",
      color: theme === 'dark' ? 'white' : 'black'
    })), portraitMessage?.length && user ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "flex flex-col gap-2"
    }, portraitMessage?.sort((a, b) => {
      return dayjs__WEBPACK_IMPORTED_MODULE_1___default()(b?.isSummary === false ? b?.time : `${b?.time} ${b?.timeRange?.split('-')[1]}`).unix() - dayjs__WEBPACK_IMPORTED_MODULE_1___default()(a?.isSummary === false ? a?.time : `${a?.time} ${a?.timeRange?.split('-')[1]}`).unix();
    })?.map((item, index) => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ActivityMessage__WEBPACK_IMPORTED_MODULE_12__["default"], {
      user: user,
      data: item,
      isLast: index === portraitMessage.length - 1,
      key: item?.id
    }))) : !loading && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
      className: "empty"
    }, lang('NoMessages')));
  }
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    containerRef?.current?.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  }, [userId]);
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_10__["default"], {
    ref: containerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_chatAssistant_room_ai_room_ai_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].rightPanelBg, 'Portrait custom-scroll'),
    noFastList: true
  }, renderBasicInfo(), userPortraitInfo ? renderBehaGroup() : undefined, renderActivity());
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_3__.withGlobal)(global => {
  const {
    userPortraitUserId
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  const user = userPortraitUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, userPortraitUserId) : undefined;
  return {
    user,
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTheme)(global)
  };
})(UserPortrait)));

/***/ },

/***/ "./src/components/right/userPortrait/UserPortraitAvatar.tsx"
/*!******************************************************************!*\
  !*** ./src/components/right/userPortrait/UserPortraitAvatar.tsx ***!
  \******************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _chatAssistant_utils_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../chatAssistant/utils/util */ "./src/components/chatAssistant/utils/util.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");






const UserPortraitAvatar = ({
  chatId,
  showName,
  size
}) => {
  const {
    openChat
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
  const isUser = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_2__.isUserId)(chatId);
  let peer;
  if (isUser) {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, chatId);
  } else {
    peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, chatId);
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: "flex items-center gap-2 cursor-pointer",
    onClick: () => {
      openChat({
        id: chatId
      });
    }
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_5__["default"], {
    key: chatId,
    className: (0,_chatAssistant_utils_util__WEBPACK_IMPORTED_MODULE_4__.cn)('overlay-avatar inline-block'),
    size: size ?? 20,
    peer: peer
  }), showName && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", null, isUser ? `${peer?.firstName ?? ''} ${peer?.lastName ?? ''}` : peer?.title));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (UserPortraitAvatar);

/***/ },

/***/ "./src/components/story/MediaStory.module.scss"
/*!*****************************************************!*\
  !*** ./src/components/story/MediaStory.module.scss ***!
  \*****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"kxMIqtqr","wrapper":"D6Yajvjx","media":"cV_QL3N5","expiredIcon":"cq7jTRkg","overlayIcon":"NOCaj4mx","pinnedIcon":"GTWFQyJx","viewsCount":"g09Rb4Ps","duration":"lM_2MMyQ","contextMenu":"UAfI9izT"});

/***/ },

/***/ "./src/components/story/MediaStory.tsx"
/*!*********************************************!*\
  !*** ./src/components/story/MediaStory.tsx ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _middle_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../middle/helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _mediaArea_MediaAreaOverlay__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./mediaArea/MediaAreaOverlay */ "./src/components/story/mediaArea/MediaAreaOverlay.tsx");
/* harmony import */ var _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./MediaStory.module.scss */ "./src/components/story/MediaStory.module.scss");


















function MediaStory({
  story,
  isProtected,
  isArchive,
  isPinned,
  canPin
}) {
  const {
    openStoryViewer,
    loadPeerSkippedStories,
    toggleStoryInProfile,
    toggleStoryPinnedToTop,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const containerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => containerRef.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => document.body);
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => document.querySelector('#portals .story-context-menu .bubble'));
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => ({
    withPortal: true,
    isDense: true
  }));
  const peerId = story && story.peerId;
  const isFullyLoaded = story && 'content' in story;
  const isOwn = isFullyLoaded && story.isOut;
  const isDeleted = story && 'isDeleted' in story;
  const video = isFullyLoaded ? story.content.video : undefined;
  const duration = video && (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_5__.formatMediaDuration)(video.duration);
  const imageHash = isFullyLoaded ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryMediaHash)(story) : undefined;
  const imgBlobUrl = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_10__["default"])(imageHash);
  const thumbUrl = imgBlobUrl || video?.thumbnail?.dataUri;
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (story && !(isFullyLoaded || isDeleted)) {
      loadPeerSkippedStories({
        peerId: story.peerId
      });
    }
  }, [isDeleted, isFullyLoaded, story]);
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_8__["default"])(containerRef, !isOwn);
  const handleClick = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    openStoryViewer({
      peerId: story.peerId,
      storyId: story.id,
      isSinglePeer: true,
      isPrivate: true,
      isArchive
    });
  }, [isArchive, story.id, story.peerId]);
  const handleMouseDown = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    (0,_middle_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_7__.preventMessageInputBlurWithBubbling)(e);
    handleBeforeContextMenu(e);
  });
  const handleUnarchiveClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_6__["default"])(e);
    toggleStoryInProfile({
      peerId,
      storyId: story.id,
      isInProfile: true
    });
    showNotification({
      message: lang('Story.ToastSavedToProfileText')
    });
    handleContextMenuClose();
  });
  const handleArchiveClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(e => {
    (0,_util_stopEvent__WEBPACK_IMPORTED_MODULE_6__["default"])(e);
    toggleStoryInProfile({
      peerId,
      storyId: story.id,
      isInProfile: false
    });
    showNotification({
      message: lang('Story.ToastRemovedFromProfileText')
    });
    handleContextMenuClose();
  });
  const handleTogglePinned = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    toggleStoryPinnedToTop({
      peerId,
      storyId: story.id
    });
    handleContextMenuClose();
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: containerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].root, 'scroll-item'),
    onMouseDown: handleMouseDown,
    onClick: handleClick,
    onContextMenu: handleContextMenu
  }, isDeleted && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].expiredIcon,
    name: "story-expired"
  }), lang('ExpiredStory')), isPinned && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].pinnedIcon),
    name: "pin-badge"
  }), isFullyLoaded && Boolean(story.views?.viewsCount) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].viewsCount)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
    name: "eye"
  }), story.views.viewsCount), duration && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].overlayIcon, _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].duration)
  }, duration), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].wrapper
  }, thumbUrl && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("img", {
    src: thumbUrl,
    alt: "",
    className: _MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].media,
    draggable: false
  }), isFullyLoaded && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_mediaArea_MediaAreaOverlay__WEBPACK_IMPORTED_MODULE_15__["default"], {
    story: story
  }), isProtected && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: "protector"
  })), contextMenuAnchor !== undefined && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_13__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuAnchor,
    getTriggerElement: getTriggerElement,
    getRootElement: getRootElement,
    getMenuElement: getMenuElement,
    getLayout: getLayout,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaStory_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].contextMenu, 'story-context-menu'),
    autoClose: true,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide,
    withPortal: true
  }, isArchive && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
    icon: "archive",
    onClick: handleUnarchiveClick
  }, lang('StoryList.SaveToProfile')), !isArchive && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
    icon: "archive",
    onClick: handleArchiveClick
  }, lang('Story.Context.RemoveFromProfile')), !isArchive && !isPinned && canPin && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
    icon: "pin",
    onClick: handleTogglePinned
  }, lang('StoryList.ItemAction.Pin')), !isArchive && isPinned && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_14__["default"], {
    icon: "unpin",
    onClick: handleTogglePinned
  }, lang('StoryList.ItemAction.Unpin'))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  story
}) => {
  const chat = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, story.peerId);
  const isProtected = chat?.isProtected;
  const {
    maxPinnedStoriesCount
  } = global.appConfig || {};
  const isOwn = 'isOut' in story && story.isOut;
  const pinnedStories = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPinnedStories)(global, story.peerId);
  const isPinned = pinnedStories?.some(pinnedStory => pinnedStory.id === story.id);
  const canPinMore = isOwn && (!maxPinnedStoriesCount || (pinnedStories?.length || 0) < maxPinnedStoriesCount);
  return {
    isProtected,
    isPinned,
    canPin: canPinMore
  };
})(MediaStory)));

/***/ },

/***/ "./src/components/story/StoryRibbon.module.scss"
/*!******************************************************!*\
  !*** ./src/components/story/StoryRibbon.module.scss ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"CdTfL4f7","fadeIn":"MyeHARy0","closing":"EZbKn_M3","peer":"kW0xpExG","name":"BDZrSTO_","name_hasUnreadStory":"OoUm5AUZ","nameHasUnreadStory":"OoUm5AUZ","hidden":"lnVtxMZI","contextMenu":"N1sagA0s"});

/***/ },

/***/ "./src/components/story/StoryRibbon.tsx"
/*!**********************************************!*\
  !*** ./src/components/story/StoryRibbon.tsx ***!
  \**********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../hooks/useHorizontalScroll */ "./src/hooks/useHorizontalScroll.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _StoryRibbonButton__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./StoryRibbonButton */ "./src/components/story/StoryRibbonButton.tsx");
/* harmony import */ var _StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./StoryRibbon.module.scss */ "./src/components/story/StoryRibbon.module.scss");









function StoryRibbon({
  isArchived,
  className,
  orderedPeerIds,
  usersById,
  chatsById,
  isClosing
}) {
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const fullClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root, !orderedPeerIds.length && _StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].hidden, isClosing && _StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].closing, className, 'no-scrollbar');
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  (0,_hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_4__["default"])(ref, (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_3__.getIsMobile)());
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    id: "StoryRibbon",
    className: fullClassName,
    dir: lang.isRtl ? 'rtl' : undefined
  }, orderedPeerIds.map(peerId => {
    const peer = usersById[peerId] || chatsById[peerId];
    if (!peer) {
      return undefined;
    }
    return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_StoryRibbonButton__WEBPACK_IMPORTED_MODULE_6__["default"], {
      key: peerId,
      peer: peer,
      isArchived: isArchived
    });
  }));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  isArchived
}) => {
  const {
    orderedPeerIds: {
      active,
      archived
    }
  } = global.stories;
  const usersById = global.users.byId;
  const chatsById = global.chats.byId;
  return {
    orderedPeerIds: isArchived ? archived : active,
    usersById,
    chatsById
  };
})(StoryRibbon)));

/***/ },

/***/ "./src/components/story/StoryRibbonButton.tsx"
/*!****************************************************!*\
  !*** ./src/components/story/StoryRibbonButton.tsx ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _middle_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../middle/helpers/preventMessageInputBlur */ "./src/components/middle/helpers/preventMessageInputBlur.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useStoryPreloader__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./hooks/useStoryPreloader */ "./src/components/story/hooks/useStoryPreloader.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./StoryRibbon.module.scss */ "./src/components/story/StoryRibbon.module.scss");
















function StoryRibbonButton({
  peer,
  isArchived
}) {
  const {
    openChat,
    openChatWithInfo,
    openStoryViewer,
    toggleStoriesHidden
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isSelf = 'isSelf' in peer && peer.isSelf;
  const isChannel = !(0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_5__.isUserId)(peer.id);
  (0,_hooks_useStoryPreloader__WEBPACK_IMPORTED_MODULE_10__["default"])(peer.id);
  const {
    isContextMenuOpen,
    contextMenuAnchor,
    handleBeforeContextMenu,
    handleContextMenu,
    handleContextMenuClose,
    handleContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_7__["default"])(ref);
  const getTriggerElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => ref.current);
  const getRootElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => document.body);
  const getMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => ref.current.querySelector('.story-peer-context-menu .bubble'));
  const getLayout = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => ({
    withPortal: true,
    isDense: true
  }));
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (isContextMenuOpen) return;
    openStoryViewer({
      peerId: peer.id,
      origin: _types__WEBPACK_IMPORTED_MODULE_2__.StoryViewerOrigin.StoryRibbon
    });
  });
  const handleMouseDown = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(e => {
    (0,_middle_helpers_preventMessageInputBlur__WEBPACK_IMPORTED_MODULE_6__.preventMessageInputBlurWithBubbling)(e);
    handleBeforeContextMenu(e);
  });
  const handleSavedStories = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openChatWithInfo({
      id: peer.id,
      shouldReplaceHistory: true,
      profileTab: 'stories'
    });
  });
  const handleArchivedStories = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openChatWithInfo({
      id: peer.id,
      shouldReplaceHistory: true,
      profileTab: 'storiesArchive'
    });
  });
  const handleOpenChat = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openChat({
      id: peer.id,
      shouldReplaceHistory: true
    });
  });
  const handleOpenProfile = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openChatWithInfo({
      id: peer.id,
      shouldReplaceHistory: true
    });
  });
  const handleArchivePeer = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    toggleStoriesHidden({
      peerId: peer.id,
      isHidden: !isArchived
    });
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    role: "button",
    "data-peer-id": peer.id,
    tabIndex: 0,
    className: _StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].peer,
    onMouseDown: handleMouseDown,
    onClick: handleClick,
    onContextMenu: handleContextMenu
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
    peer: peer,
    withStory: true,
    storyViewerOrigin: _types__WEBPACK_IMPORTED_MODULE_2__.StoryViewerOrigin.StoryRibbon,
    storyViewerMode: "full"
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].name, peer.hasUnreadStories && _StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].name_hasUnreadStory)
  }, isSelf ? lang('MyStory') : (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, peer)), contextMenuAnchor !== undefined && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_Menu__WEBPACK_IMPORTED_MODULE_12__["default"], {
    isOpen: isContextMenuOpen,
    anchor: contextMenuAnchor,
    getTriggerElement: getTriggerElement,
    getRootElement: getRootElement,
    getMenuElement: getMenuElement,
    getLayout: getLayout,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])('story-peer-context-menu', _StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].contextMenu),
    autoClose: true,
    withPortal: true,
    onClose: handleContextMenuClose,
    onCloseAnimationEnd: handleContextMenuHide
  }, isSelf ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    onClick: handleSavedStories,
    icon: "play-story"
  }, lang('StoryList.Context.SavedStories')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    onClick: handleArchivedStories,
    icon: "archive"
  }, lang('StoryList.Context.ArchivedStories'))) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_teact__WEBPACK_IMPORTED_MODULE_0__["default"].Fragment, null, !isChannel && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    onClick: handleOpenChat,
    icon: "message"
  }, lang('SendMessageTitle')), isChannel ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    onClick: handleOpenProfile,
    icon: "channel"
  }, lang('ChatList.ContextOpenChannel')) : /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    onClick: handleOpenProfile,
    icon: "user"
  }, lang('StoryList.Context.ViewProfile')), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_13__["default"], {
    onClick: handleArchivePeer,
    icon: isArchived ? 'unarchive' : 'archive'
  }, lang(isArchived ? 'StoryList.Context.Unarchive' : 'StoryList.Context.Archive')))));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StoryRibbonButton));

/***/ },

/***/ "./src/components/story/StoryToggler.module.scss"
/*!*******************************************************!*\
  !*** ./src/components/story/StoryToggler.module.scss ***!
  \*******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"name":"BDZrSTO_","root":"QOz6fQFU","avatar":"dXSy0i2c","avatarHidden":"n0vJEdNW","ghost":"E1IeDpeb","ghostAnimateName":"HMp3KTKQ","ghostRevealName":"unYkDic1","ghostLast":"dZJGfaXC"});

/***/ },

/***/ "./src/components/story/StoryToggler.tsx"
/*!***********************************************!*\
  !*** ./src/components/story/StoryToggler.tsx ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _helpers_ribbonAnimation__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers/ribbonAnimation */ "./src/components/story/helpers/ribbonAnimation.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../hooks/useShowTransition */ "./src/hooks/useShowTransition.ts");
/* harmony import */ var _hooks_useStoryPreloader__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./hooks/useStoryPreloader */ "./src/components/story/hooks/useStoryPreloader.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./StoryToggler.module.scss */ "./src/components/story/StoryToggler.module.scss");











const PRELOAD_PEERS = 5;
function StoryToggler({
  currentUserId,
  orderedPeerIds,
  usersById,
  chatsById,
  canShow,
  isShown,
  isForumPanelOpen,
  isArchived,
  withAnimation,
  peerStories
}) {
  const {
    toggleStoryRibbon
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const peers = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (orderedPeerIds.length === 1) {
      return [usersById[orderedPeerIds[0]] || chatsById[orderedPeerIds[0]]];
    }
    return orderedPeerIds.map(id => usersById[id] || chatsById[id]).filter(peer => peer && peer.id !== currentUserId).slice(0, _config__WEBPACK_IMPORTED_MODULE_2__.PREVIEW_AVATAR_COUNT).reverse();
  }, [currentUserId, orderedPeerIds, usersById, chatsById]);
  const closeFriends = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!peers?.length) return {};
    return peers.reduce((acc, peer) => {
      const stories = peerStories[peer.id];
      if (!stories) return acc;
      const isCloseFriend = stories.orderedIds.some(id => {
        const story = stories.byId[id];
        if (!story || !('isForCloseFriends' in story)) return false;
        const isRead = stories.lastReadId && story.id <= stories.lastReadId;
        return story.isForCloseFriends && !isRead;
      });
      acc[peer.id] = isCloseFriend;
      return acc;
    }, {});
  }, [peerStories, peers]);
  const preloadPeerIds = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return orderedPeerIds.slice(0, PRELOAD_PEERS);
  }, [orderedPeerIds]);
  (0,_hooks_useStoryPreloader__WEBPACK_IMPORTED_MODULE_7__["default"])(preloadPeerIds);
  const isVisible = canShow && isShown;
  // For some reason, setting 'slow' here also fixes scroll freezes on iOS when collapsing Story Ribbon
  const {
    ref,
    shouldRender
  } = (0,_hooks_useShowTransition__WEBPACK_IMPORTED_MODULE_6__["default"])({
    isOpen: isVisible,
    className: 'slow',
    withShouldRender: true
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!withAnimation || isForumPanelOpen) return;
    if (isVisible) {
      (0,_teact__WEBPACK_IMPORTED_MODULE_0__.beginHeavyAnimation)(_helpers_ribbonAnimation__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_DURATION + _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_END_DELAY);
      (0,_helpers_ribbonAnimation__WEBPACK_IMPORTED_MODULE_4__.animateClosing)(isArchived);
    } else {
      (0,_teact__WEBPACK_IMPORTED_MODULE_0__.beginHeavyAnimation)(_helpers_ribbonAnimation__WEBPACK_IMPORTED_MODULE_4__.ANIMATION_DURATION + _config__WEBPACK_IMPORTED_MODULE_2__.ANIMATION_END_DELAY);
      (0,_helpers_ribbonAnimation__WEBPACK_IMPORTED_MODULE_4__.animateOpening)(isArchived);
    }
  }, [isArchived, isVisible, withAnimation, isForumPanelOpen]);
  if (!shouldRender) {
    return undefined;
  }
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("button", {
    ref: ref,
    type: "button",
    id: "StoryToggler",
    className: _StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].root,
    "aria-label": lang('Chat.Context.Peer.OpenStory'),
    onClick: () => toggleStoryRibbon({
      isShown: true,
      isArchived
    }),
    dir: lang.isRtl ? 'rtl' : undefined
  }, peers.map(peer => /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_Avatar__WEBPACK_IMPORTED_MODULE_8__["default"], {
    key: peer.id,
    peer: peer,
    size: "tiny",
    className: _StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].avatar,
    withStorySolid: true,
    forceFriendStorySolid: closeFriends[peer.id]
  })));
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  isArchived
}) => {
  const {
    orderedPeerIds: {
      archived,
      active
    },
    byPeerId
  } = global.stories;
  const {
    storyViewer: {
      isRibbonShown,
      isArchivedRibbonShown
    }
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const isForumPanelOpen = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsForumPanelOpen)(global);
  const withAnimation = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPerformanceSettingsValue)(global, 'storyRibbonAnimations');
  return {
    currentUserId: global.currentUserId,
    orderedPeerIds: isArchived ? archived : active,
    isShown: isArchived ? !isArchivedRibbonShown : !isRibbonShown,
    isForumPanelOpen,
    withAnimation,
    usersById: global.users.byId,
    chatsById: global.chats.byId,
    peerStories: byPeerId
  };
})(StoryToggler)));

/***/ },

/***/ "./src/components/story/helpers/ribbonAnimation.ts"
/*!*********************************************************!*\
  !*** ./src/components/story/helpers/ribbonAnimation.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ANIMATION_DURATION: () => (/* binding */ ANIMATION_DURATION),
/* harmony export */   animateClosing: () => (/* binding */ animateClosing),
/* harmony export */   animateOpening: () => (/* binding */ animateOpening)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_animation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/animation */ "./src/util/animation.ts");
/* harmony import */ var _util_stopEvent__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/stopEvent */ "./src/util/stopEvent.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../StoryRibbon.module.scss */ "./src/components/story/StoryRibbon.module.scss");
/* harmony import */ var _StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../StoryToggler.module.scss */ "./src/components/story/StoryToggler.module.scss");







const ANIMATION_DURATION = 250;
const RIBBON_OFFSET = 0.25 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM;
const RIBBON_Z_INDEX = 11;
const STROKE_OFFSET = 0.1875 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM;
const CANVAS_OFFSET = 0.125 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM;
const callbacks = new Set();
function animateOpening(isArchived) {
  cancelDelayedCallbacks();
  const {
    container,
    toggler,
    leftMainHeader,
    ribbonPeers,
    toggleAvatars
  } = getHTMLElements(isArchived);
  if (!toggler || !toggleAvatars || !ribbonPeers || !container || !leftMainHeader) {
    return;
  }
  const {
    bottom: headerBottom,
    right: headerRight
  } = leftMainHeader.getBoundingClientRect();
  const toTop = headerBottom + RIBBON_OFFSET;

  // Toggle avatars are in the reverse order
  const lastToggleAvatar = toggleAvatars[0];
  const firstToggleAvatar = toggleAvatars[toggleAvatars.length - 1];
  const lastId = getPeerId(lastToggleAvatar);
  Array.from(ribbonPeers).reverse().forEach((peer, index, {
    length
  }) => {
    const id = getPeerId(peer);
    if (!id) return;
    const isLast = id === lastId;
    let toggleAvatar = selectByPeerId(toggler, id);
    let zIndex = RIBBON_Z_INDEX + index + 1;
    if (!toggleAvatar) {
      const isSelf = index === length - 1;

      // Self story should appear from the first toggle avatar
      toggleAvatar = isSelf ? firstToggleAvatar : lastToggleAvatar;
      zIndex = RIBBON_Z_INDEX;
    }
    if (!toggleAvatar) return;
    let {
      top: fromTop,
      left: fromLeft,
      width: fromWidth
    } = toggleAvatar.getBoundingClientRect();
    const {
      left: toLeft,
      width: toWidth
    } = peer.getBoundingClientRect();
    if (toLeft > headerRight) {
      return;
    }
    fromLeft -= STROKE_OFFSET;
    fromWidth += 2 * STROKE_OFFSET;
    const fromTranslateX = fromLeft - toLeft;
    const fromTranslateY = fromTop - toTop;
    const fromScale = fromWidth / toWidth;
    fromTop -= STROKE_OFFSET;
    const toTranslateX = toLeft - fromLeft + 2 * STROKE_OFFSET;
    const toTranslateY = toTop - fromTop + STROKE_OFFSET;
    const toScale = toWidth / (fromWidth + 2 * STROKE_OFFSET);
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      if (!toggleAvatar) return;
      const ghost = createGhost(peer);
      let ghost2;

      // If this is a toogle avatar we create a second ghost and do crossfade animation
      if (zIndex > RIBBON_Z_INDEX) {
        ghost2 = createGhost(toggleAvatar);
        if (isLast) {
          ghost2.classList.add(_StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghostLast);
        }
      } else {
        // Else we animate only name
        ghost.classList.add(_StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghostAnimateName);
      }
      (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.applyStyles)(ghost, {
        top: `${toTop}px`,
        left: `${toLeft}px`,
        zIndex: String(zIndex),
        opacity: ghost2 ? '0' : '',
        transform: `translate3d(${fromTranslateX}px, ${fromTranslateY}px, 0) scale(${fromScale})`
      });
      if (ghost2) {
        (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.applyStyles)(ghost2, {
          top: `${fromTop}px`,
          left: `${fromLeft}px`,
          zIndex: String(zIndex)
        });
      }
      container.appendChild(ghost);
      if (ghost2) {
        container.appendChild(ghost2);
      }
      toggleAvatar.classList.add('animating');
      peer.classList.add('animating');
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
        (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.applyStyles)(ghost, {
          opacity: '',
          transform: ''
        });
        if (ghost2) {
          (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.applyStyles)(ghost2, {
            opacity: '0',
            transform: `translate3d(${toTranslateX}px, ${toTranslateY}px, 0) scale(${toScale})`
          });
        } else {
          ghost.classList.add(_StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghostRevealName);
        }
        const cb = createDelayedCallback(() => {
          (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
            if (container.contains(ghost)) {
              container.removeChild(ghost);
            }
            if (ghost2 && container.contains(ghost2)) {
              container.removeChild(ghost2);
            }
            toggleAvatar?.classList.remove('animating');
            peer.classList.remove('animating');
            callbacks.delete(cb);
          });
        }, ANIMATION_DURATION + _config__WEBPACK_IMPORTED_MODULE_0__.ANIMATION_END_DELAY);
        callbacks.add(cb);
      });
    });
  });
}
function animateClosing(isArchived) {
  cancelDelayedCallbacks();
  const {
    container,
    toggler,
    toggleAvatars,
    ribbonPeers,
    leftMainHeader
  } = getHTMLElements(isArchived);
  if (!toggler || !toggleAvatars || !ribbonPeers || !container || !leftMainHeader) {
    return;
  }
  const {
    right: headerRight
  } = leftMainHeader.getBoundingClientRect();

  // Toggle avatars are in the reverse order
  const lastToggleAvatar = toggleAvatars[0];
  const firstToggleAvatar = toggleAvatars[toggleAvatars.length - 1];
  const lastId = getPeerId(lastToggleAvatar);
  Array.from(ribbonPeers).reverse().forEach((peer, index, {
    length
  }) => {
    const id = getPeerId(peer);
    if (!id) return;
    const isLast = id === lastId;
    let toggleAvatar = selectByPeerId(toggler, id);
    let zIndex = RIBBON_Z_INDEX + index + 1;
    if (!toggleAvatar) {
      const isSelf = index === length - 1;

      // Self story should appear from the first toggle avatar
      toggleAvatar = isSelf ? firstToggleAvatar : lastToggleAvatar;
      zIndex = RIBBON_Z_INDEX;
    }
    if (!toggleAvatar) return;
    const {
      top: fromTop,
      left: fromLeft,
      width: fromWidth
    } = peer.getBoundingClientRect();
    let {
      left: toLeft,
      width: toWidth,
      top: toTop
    } = toggleAvatar.getBoundingClientRect();
    if (fromLeft > headerRight) {
      return;
    }
    toLeft -= STROKE_OFFSET;
    toWidth += 2 * STROKE_OFFSET;
    const toTranslateX = toLeft - fromLeft;
    const toTranslateY = toTop - fromTop - CANVAS_OFFSET;
    const toScale = toWidth / fromWidth;
    toTop -= STROKE_OFFSET;
    const fromTranslateX = fromLeft - toLeft + 2 * STROKE_OFFSET;
    const fromTranslateY = fromTop - toTop + STROKE_OFFSET;
    const fromScale = fromWidth / (toWidth + 2 * STROKE_OFFSET);
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      const ghost = createGhost(peer);
      let ghost2;
      if (zIndex > RIBBON_Z_INDEX) {
        ghost2 = createGhost(toggleAvatar);
        if (isLast) {
          ghost2.classList.add(_StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghostLast);
        }
      } else {
        ghost.classList.add(_StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghostAnimateName, _StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghostRevealName);
      }
      (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.applyStyles)(ghost, {
        top: `${fromTop}px`,
        left: `${fromLeft}px`,
        width: `${fromWidth}px`,
        zIndex: String(zIndex)
      });
      if (ghost2) {
        (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.applyStyles)(ghost2, {
          top: `${toTop}px`,
          left: `${toLeft}px`,
          zIndex: String(zIndex),
          opacity: '0',
          transform: `translate3d(${fromTranslateX}px, ${fromTranslateY}px, 0) scale(${fromScale})`
        });
      }
      peer.classList.add('animating');
      toggleAvatar.classList.add('animating');
      container.appendChild(ghost);
      if (ghost2) {
        container.appendChild(ghost2);
      }
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
        (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.applyStyles)(ghost, {
          opacity: ghost2 ? '0' : '',
          transform: `translate3d(${toTranslateX}px, ${toTranslateY}px, 0) scale(${toScale})`
        });
        if (ghost2) {
          (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.applyStyles)(ghost2, {
            opacity: '',
            transform: ''
          });
        } else {
          ghost.classList.remove(_StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghostRevealName);
        }
        const cb = createDelayedCallback(() => {
          (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
            if (container.contains(ghost)) {
              container.removeChild(ghost);
            }
            if (ghost2 && container.contains(ghost2)) {
              container.removeChild(ghost2);
            }
            peer.classList.remove('animating');
            toggleAvatar.classList.remove('animating');
          });
          callbacks.delete(cb);
        }, ANIMATION_DURATION + _config__WEBPACK_IMPORTED_MODULE_0__.ANIMATION_END_DELAY);
        callbacks.add(cb);
      });
    });
  });
}
function getHTMLElements(isArchived) {
  let container = document.getElementById('LeftColumn');
  if (container && isArchived) {
    container = container.querySelector('.ArchivedChats');
  }
  if (!container) return {};
  const toggler = container.querySelector('#StoryToggler');
  const ribbon = container.querySelector('#StoryRibbon');
  const leftMainHeader = container.querySelector('.left-header');
  const ribbonPeers = ribbon?.querySelectorAll(`.${_StoryRibbon_module_scss__WEBPACK_IMPORTED_MODULE_5__["default"].peer}`);
  const toggleAvatars = toggler?.querySelectorAll('.Avatar');
  return {
    container,
    toggler,
    leftMainHeader,
    ribbonPeers,
    toggleAvatars
  };
}
function createGhost(sourceEl) {
  const ghost = sourceEl.cloneNode(true);
  ghost.classList.add(_StoryToggler_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].ghost);

  // Avoid source animating class being copied to the ghost
  ghost.classList.remove('animating');
  ghost.draggable = false;
  ghost.oncontextmenu = _util_stopEvent__WEBPACK_IMPORTED_MODULE_3__["default"];
  const sourceCanvas = sourceEl.querySelector('canvas');
  if (sourceCanvas) {
    const canvas = ghost.querySelector('canvas');
    canvas?.getContext('2d')?.drawImage(sourceCanvas, 0, 0);
  }
  return ghost;
}
function getPeerId(el) {
  return el?.getAttribute('data-peer-id');
}
function selectByPeerId(el, id) {
  return el?.querySelector(`[data-peer-id="${id}"]`);
}
function createDelayedCallback(callback, ms) {
  const timeout = setTimeout(callback, ms);
  return () => {
    clearTimeout(timeout);
    callback();
  };
}
function cancelDelayedCallbacks() {
  callbacks.forEach(cb => cb());
  callbacks.clear();
}

/***/ },

/***/ "./src/components/story/helpers/videoFormats.ts"
/*!******************************************************!*\
  !*** ./src/components/story/helpers/videoFormats.ts ***!
  \******************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PRIMARY_VIDEO_MIME: () => (/* binding */ PRIMARY_VIDEO_MIME),
/* harmony export */   SECONDARY_VIDEO_MIME: () => (/* binding */ SECONDARY_VIDEO_MIME)
/* harmony export */ });
const PRIMARY_VIDEO_MIME = 'video/mp4; codecs=hvc1.1.6.L63.00';
const SECONDARY_VIDEO_MIME = 'video/mp4; codecs=avc1.64001E';

/***/ },

/***/ "./src/components/story/hooks/useStoryPreloader.ts"
/*!*********************************************************!*\
  !*** ./src/components/story/hooks/useStoryPreloader.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_unloadVideo__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/browser/unloadVideo */ "./src/util/browser/unloadVideo.ts");
/* harmony import */ var _util_files__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/files */ "./src/util/files.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_progressiveLoader__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/progressiveLoader */ "./src/util/progressiveLoader.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _helpers_videoFormats__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../helpers/videoFormats */ "./src/components/story/helpers/videoFormats.ts");
/* harmony import */ var _hooks_useStreaming__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useStreaming */ "./src/hooks/useStreaming.ts");













const preloadedStories = {};
const PEER_STORIES_FOR_PRELOAD = 5;
const PROGRESSIVE_PRELOAD_DURATION = 1000;
const STREAM_PRELOAD_SIZE = 1024 * 1024 * 2; // 2 MB

const FIRST_PRELOAD_DELAY = 1000;
const canPreload = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_9__.pause)(FIRST_PRELOAD_DELAY);
function useStoryPreloader(peerId, aroundStoryId) {
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (peerId === undefined) return;
    const preloadHashes = async mediaHashes => {
      await canPreload;
      mediaHashes.forEach(({
        hash,
        format,
        isStream
      }) => {
        if (isStream) {
          preloadStream(hash);
          return;
        }
        _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.fetch(hash, format).then(result => {
          if (!result) return;
          if (format === _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.Progressive) {
            preloadProgressive(result);
          }
          if (format === _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl) {
            (0,_util_files__WEBPACK_IMPORTED_MODULE_6__.preloadImage)(result);
          }
        });
      });
    };
    const peerIds = Array.isArray(peerId) ? peerId : [peerId];
    peerIds.forEach(id => {
      const storyId = aroundStoryId || (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().stories.byPeerId[id]?.orderedIds?.[0];
      if (!storyId) return;
      preloadHashes(getPreloadMediaHashes(id, storyId));
    });
  }, [aroundStoryId, peerId]);
}
function findIdsAroundCurrentId(ids, currentId, aroundAmount) {
  const currentIndex = ids.indexOf(currentId);
  const start = Math.max(currentIndex - aroundAmount, 0);
  const end = Math.min(currentIndex + aroundAmount, ids.length);
  return ids.slice(start, end);
}
function getPreloadMediaHashes(peerId, storyId) {
  const peerStories = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerStories)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), peerId);
  if (!peerStories || !peerStories.orderedIds?.length) {
    return [];
  }
  const preloadIds = findIdsAroundCurrentId(peerStories.orderedIds, storyId, PEER_STORIES_FOR_PRELOAD);
  const mediaHashes = [];
  preloadIds.forEach(currentStoryId => {
    if (preloadedStories[peerId]?.has(currentStoryId)) {
      return;
    }
    const story = peerStories.byId[currentStoryId];
    if (!story || !('content' in story)) {
      return;
    }
    const isVideo = Boolean(story.content.video);

    // Media
    mediaHashes.push({
      hash: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getStoryMediaHash)(story, 'full'),
      format: isVideo ? _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.Progressive : _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl,
      isStream: isVideo && (0,_hooks_useStreaming__WEBPACK_IMPORTED_MODULE_11__.checkIfStreamingSupported)(_helpers_videoFormats__WEBPACK_IMPORTED_MODULE_10__.PRIMARY_VIDEO_MIME)
    });
    // Thumbnail
    mediaHashes.push({
      hash: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getStoryMediaHash)(story),
      format: _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl
    });
    if (story.content.altVideos) {
      mediaHashes.push({
        hash: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getStoryMediaHash)(story, 'full', true),
        format: _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.Progressive
      });
    }
    preloadedStories[peerId] = (preloadedStories[peerId] || new Set()).add(currentStoryId);
  });
  return mediaHashes;
}
function preloadProgressive(url) {
  const head = document.head;
  const video = document.createElement('video');
  video.preload = 'auto';
  video.src = url;
  video.muted = true;
  video.autoplay = true;
  video.disableRemotePlayback = true;
  video.style.display = 'none';
  head.appendChild(video);
  video.load();
  setTimeout(() => {
    (0,_util_browser_unloadVideo__WEBPACK_IMPORTED_MODULE_5__["default"])(video);
    head.removeChild(video);
  }, PROGRESSIVE_PRELOAD_DURATION);
}
async function preloadStream(hash) {
  const loader = (0,_util_progressiveLoader__WEBPACK_IMPORTED_MODULE_8__.makeProgressiveLoader)((0,_util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.getProgressiveUrl)(hash));
  let cachedSize = 0;
  for await (const chunk of loader) {
    cachedSize += chunk.byteLength;
    if (cachedSize >= STREAM_PRELOAD_SIZE) {
      break;
    }
  }
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useStoryPreloader);

/***/ },

/***/ "./src/components/story/mediaArea/MediaArea.module.scss"
/*!**************************************************************!*\
  !*** ./src/components/story/mediaArea/MediaArea.module.scss ***!
  \**************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"overlay":"RXAMu4VD","mediaArea":"pruw1nLm","preview":"_5HkplWee","shiny":"xFjJpeOA","wave":"Ux0tlNbE","light":"_7esBA3m","dark":"eic2vQ8c","reactionBackground":"c3ajA3hg","flipped":"furSXGdL","reaction":"Et3MvYmN","withCount":"mFTLUHm2","reactionCount":"Tr8mYyDk","weather":"KBjMtRUS","weatherInner":"IFChB3tD","temperature":"_ke1UBIl"});

/***/ },

/***/ "./src/components/story/mediaArea/MediaAreaOverlay.tsx"
/*!*************************************************************!*\
  !*** ./src/components/story/mediaArea/MediaAreaOverlay.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/window/useWindowSize */ "./src/hooks/window/useWindowSize.ts");
/* harmony import */ var _MediaAreaSuggestedReaction__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./MediaAreaSuggestedReaction */ "./src/components/story/mediaArea/MediaAreaSuggestedReaction.tsx");
/* harmony import */ var _MediaAreaWeather__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./MediaAreaWeather */ "./src/components/story/mediaArea/MediaAreaWeather.tsx");
/* harmony import */ var _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./MediaArea.module.scss */ "./src/components/story/mediaArea/MediaArea.module.scss");











const STORY_ASPECT_RATIO = 9 / 16;
const PERCENTAGE_BASE = 100;
const NO_SHINY_TYPES = new Set(['channelPost', 'uniqueGift']);
const MediaAreaOverlay = ({
  story,
  isActive,
  className,
  isStoryPlaying
}) => {
  const {
    openMapModal,
    openUniqueGiftBySlug,
    focusMessage,
    closeStoryViewer,
    openUrl
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [mediaWidth, setMediaWidth] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const windowSize = (0,_hooks_window_useWindowSize__WEBPACK_IMPORTED_MODULE_6__["default"])();
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!ref.current) return;
    const element = ref.current;
    setMediaWidth(element.clientWidth);
    if (windowSize.width > _config__WEBPACK_IMPORTED_MODULE_2__.MOBILE_SCREEN_MAX_WIDTH) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMutation)(() => {
        element.style.removeProperty('--media-width');
        element.style.removeProperty('--media-height');
      });
      return;
    }
    const screenAspectRatio = windowSize.width / windowSize.height;
    const width = screenAspectRatio < STORY_ASPECT_RATIO ? element.clientHeight * STORY_ASPECT_RATIO : element.clientWidth;
    const height = screenAspectRatio < STORY_ASPECT_RATIO ? element.clientHeight : element.clientWidth / STORY_ASPECT_RATIO;
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMutation)(() => {
      element.style.setProperty('--media-width', `${width}px`);
      element.style.setProperty('--media-height', `${height}px`);
    });
  }, [isActive, windowSize]);
  const handleMediaAreaClick = mediaArea => {
    switch (mediaArea.type) {
      case 'geoPoint':
      case 'venue':
        {
          openMapModal({
            geoPoint: mediaArea.geo
          });
          break;
        }
      case 'channelPost':
        {
          focusMessage({
            chatId: mediaArea.channelId,
            messageId: mediaArea.messageId
          });
          closeStoryViewer();
          break;
        }
      case 'url':
        {
          openUrl({
            url: mediaArea.url
          });
          break;
        }
      case 'uniqueGift':
        {
          openUniqueGiftBySlug({
            slug: mediaArea.slug
          });
          break;
        }
    }
  };
  const mediaAreas = story.mediaAreas;
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].overlay, !isActive && _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].preview, className),
    ref: ref
  }, mediaAreas?.map((mediaArea, i) => {
    switch (mediaArea.type) {
      case 'geoPoint':
      case 'venue':
      case 'channelPost':
      case 'url':
      case 'uniqueGift':
        {
          const isShiny = isActive && !NO_SHINY_TYPES.has(mediaArea.type);
          return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
            className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].mediaArea, isShiny && _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].shiny),
            style: prepareStyle(mediaArea),
            onClick: () => handleMediaAreaClick(mediaArea)
          });
        }
      case 'suggestedReaction':
        return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MediaAreaSuggestedReaction__WEBPACK_IMPORTED_MODULE_7__["default"], {
          key: `${mediaArea.type}-${i}`,
          story: story,
          mediaArea: mediaArea,
          index: i,
          isPreview: !isActive,
          className: _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].mediaArea,
          style: prepareStyle(mediaArea)
        });
      case 'weather':
        {
          return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_MediaAreaWeather__WEBPACK_IMPORTED_MODULE_8__["default"], {
            key: `${mediaArea.type}-${i}`,
            mediaArea: mediaArea,
            className: _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_9__["default"].mediaArea,
            style: prepareStyle(mediaArea, mediaWidth),
            isPreview: !isActive || isStoryPlaying
          });
        }
      default:
        return undefined;
    }
  }));
};
function prepareStyle(mediaArea, mediaWidth) {
  const {
    x,
    y,
    width,
    height,
    rotation,
    radius
  } = mediaArea.coordinates;
  let pixelRadius = '';
  if (mediaWidth && radius && mediaWidth > 0) {
    const pixelWidth = mediaWidth * (width / PERCENTAGE_BASE);
    const pixelHeight = mediaWidth * (height / PERCENTAGE_BASE);
    pixelRadius = `${Math.min(pixelWidth, pixelHeight) * (radius / PERCENTAGE_BASE)}px`;
  }
  return (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_5__["default"])(`left: ${x}%`, `top: ${y}%`, `width: ${width}%`, `height: ${height}%`, `transform: rotate(${rotation}deg) translate(-50%, -50%)`, pixelRadius && `border-radius: ${pixelRadius}`);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MediaAreaOverlay));

/***/ },

/***/ "./src/components/story/mediaArea/MediaAreaSuggestedReaction.tsx"
/*!***********************************************************************!*\
  !*** ./src/components/story/mediaArea/MediaAreaSuggestedReaction.tsx ***!
  \***********************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _common_reactions_ReactionAnimatedEmoji__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/reactions/ReactionAnimatedEmoji */ "./src/components/common/reactions/ReactionAnimatedEmoji.tsx");
/* harmony import */ var _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./MediaArea.module.scss */ "./src/components/story/mediaArea/MediaArea.module.scss");













const REACTION_SIZE_MULTIPLIER = 0.6;
const EFFECT_SIZE_MULTIPLIER = 4;
const MediaAreaSuggestedReaction = ({
  story,
  mediaArea,
  index,
  className,
  style,
  isPreview
}) => {
  const {
    sendStoryReaction
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [customEmojiSize, setCustomEmojiSize] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(1.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.REM);
  const {
    peerId,
    id,
    views
  } = story;
  const {
    reactions
  } = views || {};
  const {
    reaction,
    isDark,
    isFlipped
  } = mediaArea;
  const isChannel = !(0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_5__.isUserId)(peerId);
  const containerId = `${(0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getStoryKey)(peerId, id)}-${index}-${isPreview ? 'preview' : 'viewer'}`;
  const reactionCount = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => reactions?.find(r => (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isSameReaction)(r.reaction, reaction))?.count, [reaction, reactions]);
  const shouldDisplayCount = !isPreview && Boolean(reactionCount) && isChannel;
  const updateCustomEmojiSize = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!ref.current) return;
    const height = ref.current.clientHeight;
    setCustomEmojiSize(Math.round(height * REACTION_SIZE_MULTIPLIER));
  });
  (0,_hooks_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__["default"])(([prevReactionCount]) => {
    if (Boolean(reactionCount) !== Boolean(prevReactionCount)) {
      updateCustomEmojiSize();
    }
  }, [reactionCount]);
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_9__["default"])(ref, updateCustomEmojiSize);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    sendStoryReaction({
      peerId,
      storyId: id,
      containerId,
      reaction
    });
  });
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(isDark ? _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].dark : _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].light, className),
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(style, `--custom-emoji-size: ${customEmojiSize}px`),
    onClick: handleClick
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].reactionBackground, isFlipped && _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].flipped)
  }), Boolean(customEmojiSize) && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_reactions_ReactionAnimatedEmoji__WEBPACK_IMPORTED_MODULE_10__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].reaction, shouldDisplayCount && _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].withCount),
    reaction: reaction,
    containerId: containerId,
    size: customEmojiSize,
    effectSize: customEmojiSize * EFFECT_SIZE_MULTIPLIER,
    shouldPause: isPreview,
    shouldLoop: !isPreview
  }), shouldDisplayCount && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("span", {
    className: _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].reactionCount
  }, reactionCount));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(MediaAreaSuggestedReaction));

/***/ },

/***/ "./src/components/story/mediaArea/MediaAreaWeather.tsx"
/*!*************************************************************!*\
  !*** ./src/components/story/mediaArea/MediaAreaWeather.tsx ***!
  \*************************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/teact/teact-dom */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_colors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/colors */ "./src/util/colors.ts");
/* harmony import */ var _util_formatTemperature__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/formatTemperature */ "./src/util/formatTemperature.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _common_CustomEmoji__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../common/CustomEmoji */ "./src/components/common/CustomEmoji.tsx");
/* harmony import */ var _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./MediaArea.module.scss */ "./src/components/story/mediaArea/MediaArea.module.scss");














const EMOJI_SIZE_MULTIPLIER = 0.7;
const TEMPERATURE_SIZE = 32;
const MediaAreaWeather = ({
  mediaArea,
  className,
  style,
  restrictedEmoji,
  isPreview
}) => {
  const ref = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [customEmojiSize, setCustomEmojiSize] = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const {
    temperatureC,
    color
  } = mediaArea;
  const backgroundColor = (0,_util_colors__WEBPACK_IMPORTED_MODULE_7__.convertToRGBA)(color);
  const textColor = (0,_util_colors__WEBPACK_IMPORTED_MODULE_7__.getTextColor)(color);
  const updateCustomSize = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(isImmediate => {
    if (!ref.current) return undefined;
    const el = ref.current;
    const height = el.clientHeight;
    const customEmojiHeight = Math.round(height * EMOJI_SIZE_MULTIPLIER);
    setCustomEmojiSize(customEmojiHeight);
    const applyFn = () => {
      (0,_lib_teact_teact_dom__WEBPACK_IMPORTED_MODULE_1__.setExtraStyles)(el, {
        '--custom-emoji-size': `${customEmojiHeight}px`,
        'font-size': `${height / TEMPERATURE_SIZE}rem`
      });
    };
    if (isImmediate) return applyFn;
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestMutation)(applyFn);
    return undefined;
  });
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_3__.requestForcedReflow)(() => updateCustomSize(true));
  }, []);
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_10__["default"])(ref, () => updateCustomSize());
  return /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].weather, className),
    style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_6__["default"])(style, `--custom-background-color: ${backgroundColor}`, `color: ${textColor}`)
  }, /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    className: _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].weatherInner
  }, restrictedEmoji && /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement(_common_CustomEmoji__WEBPACK_IMPORTED_MODULE_11__["default"], {
    key: restrictedEmoji.id,
    documentId: restrictedEmoji.id,
    size: customEmojiSize,
    noPlay: isPreview,
    withTranslucentThumb: true,
    forceAlways: true
  }), /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("p", {
    className: _MediaArea_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].temperature
  }, (0,_util_formatTemperature__WEBPACK_IMPORTED_MODULE_8__.formatTemperature)(temperatureC))));
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_2__.withGlobal)((global, ownProps) => {
  const {
    mediaArea
  } = ownProps;
  const restrictedEmoji = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectRestrictedEmoji)(global, mediaArea.emoji);
  return {
    restrictedEmoji
  };
})(MediaAreaWeather)));

/***/ },

/***/ "./src/hooks/media/useMessageMediaHash.ts"
/*!************************************************!*\
  !*** ./src/hooks/media/useMessageMediaHash.ts ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useMessageMediaHash)
/* harmony export */ });
/* harmony import */ var _global_helpers_messageMedia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../global/helpers/messageMedia */ "./src/global/helpers/messageMedia.ts");
/* harmony import */ var _data_useSelector__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../data/useSelector */ "./src/hooks/data/useSelector.ts");


function selectWebPagesById(global) {
  return global.messages.webPageById;
}
function useMessageMediaHash(message, target) {
  const webPagesById = (0,_data_useSelector__WEBPACK_IMPORTED_MODULE_1__["default"])(selectWebPagesById);
  if (!message) return undefined;
  const webPageId = message.content.webPage?.id;
  const webPage = webPageId ? webPagesById[webPageId] : undefined;
  return (0,_global_helpers_messageMedia__WEBPACK_IMPORTED_MODULE_0__.getMessageMediaHash)(message, {
    webPage
  }, target);
}

/***/ },

/***/ "./src/hooks/media/useUnsupportedMedia.ts"
/*!************************************************!*\
  !*** ./src/hooks/media/useUnsupportedMedia.ts ***!
  \************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useUnsupportedMedia)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _useOldLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../useOldLang */ "./src/hooks/useOldLang.ts");





const NOTIFICATION_DURATION = 8000;
function useUnsupportedMedia(ref, shouldDisableNotification, isDisabled) {
  const {
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_useOldLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const [isUnsupported, setIsUnsupported] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const handleUnsupported = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    setIsUnsupported(true);
    if (shouldDisableNotification) return;
    showNotification({
      message: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_MOBILE ? lang('Video.Unsupported.Mobile') : lang('Video.Unsupported.Desktop'),
      duration: NOTIFICATION_DURATION
    });
  });
  const onError = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(event => {
    const target = event.currentTarget;
    const {
      error
    } = target;
    if (!error) return;

    // https://developer.mozilla.org/en-US/docs/Web/API/MediaError/code
    if (error.code === 3 || error.code === 4) {
      handleUnsupported();
    }
  });
  const onCanPlay = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_3__["default"])(event => {
    const target = event.currentTarget;
    if (!target.videoHeight || !target.videoWidth) {
      handleUnsupported();
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled) return undefined;
    const {
      current
    } = ref;
    if (!current) {
      return undefined;
    }
    current.addEventListener('error', onError);
    current.addEventListener('canplay', onCanPlay);
    return () => {
      current.removeEventListener('error', onError);
      current.removeEventListener('canplay', onCanPlay);
    };
  }, [isDisabled, ref]);
  return isUnsupported;
}

/***/ },

/***/ "./src/hooks/polling/usePeerStoriesPolling.ts"
/*!****************************************************!*\
  !*** ./src/hooks/polling/usePeerStoriesPolling.ts ***!
  \****************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePeerStoriesPolling)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/schedulers */ "./src/util/schedulers.ts");






const POLLING_INTERVAL = 60 * 60 * 1000;
const PEER_LAST_POLLING_TIME = new Map();
let PEER_ID_QUEUE = new Set();
const LIMIT_PER_REQUEST = 100;
const REQUEST_THROTTLE = 500;
const loadFromQueue = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_5__.throttle)(() => {
  const queue = Array.from(PEER_ID_QUEUE);
  const queueToLoad = queue.slice(0, LIMIT_PER_REQUEST);
  const otherQueue = queue.slice(LIMIT_PER_REQUEST + 1);
  (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().loadStoriesMaxIds({
    peerIds: queueToLoad
  });
  queueToLoad.forEach(id => PEER_LAST_POLLING_TIME.set(id, Date.now()));
  PEER_ID_QUEUE = new Set(otherQueue);

  // Schedule next load
  if (PEER_ID_QUEUE.size) {
    loadFromQueue();
  }
}, REQUEST_THROTTLE);
function usePeerStoriesPolling(ids) {
  const peers = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return ids?.map(id => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, id)).filter(Boolean);
  }, [ids]);
  const pollablePeerIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return peers?.filter(peer => {
      const lastPollingTime = PEER_LAST_POLLING_TIME.get(peer.id) || 0;
      if (Date.now() - lastPollingTime < POLLING_INTERVAL) {
        return false;
      }
      if ((0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_4__.isUserId)(peer.id)) {
        const user = peer;
        const status = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUserStatus)(global, user.id);
        const isStatusAvailable = status && status.type !== 'userStatusEmpty';
        return !user.isContact && !user.isSelf && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isUserBot)(user) && !peer.isSupport && isStatusAvailable;
      } else {
        const chat = peer;
        const isRestricted = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectIsChatRestricted)(global, chat.id);
        return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.isChatChannel)(chat) && !isRestricted;
      }
    }).map(user => user.id);
  }, [peers]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (pollablePeerIds?.length) {
      pollablePeerIds.forEach(id => PEER_ID_QUEUE.add(id));
      loadFromQueue();
    }
  }, [pollablePeerIds]);
}

/***/ },

/***/ "./src/hooks/reducers/useFoldersReducer.ts"
/*!*************************************************!*\
  !*** ./src/hooks/reducers/useFoldersReducer.ts ***!
  \*************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   selectChatFilters: () => (/* binding */ selectChatFilters)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _useReducer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../useReducer */ "./src/hooks/useReducer.ts");




const INCLUDE_FILTER_FIELDS = ['includedChatIds', 'bots', 'channels', 'groups', 'contacts', 'nonContacts'];
const EXCLUDE_FILTER_FIELDS = ['excludedChatIds', 'excludeArchived', 'excludeMuted', 'excludeRead'];
function selectChatFilters(state, mode, selectTemp) {
  let selectedChatIds = [];
  let selectedChatTypes = [];
  if (mode === 'included') {
    const {
      includedChatIds,
      ...includeFilters
    } = selectTemp ? state.includeFilters || {} : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.pick)(state.folder, INCLUDE_FILTER_FIELDS);
    selectedChatIds = includedChatIds || [];
    selectedChatTypes = Object.keys(includeFilters).filter(key => Boolean(includeFilters[key]));
  } else {
    const {
      excludedChatIds,
      ...excludeFilters
    } = selectTemp ? state.excludeFilters || {} : (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.pick)(state.folder, EXCLUDE_FILTER_FIELDS);
    selectedChatIds = excludedChatIds || [];
    selectedChatTypes = Object.keys(excludeFilters).filter(key => Boolean(excludeFilters[key]));
  }
  const global = (0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)();
  const existingSelectedChatIds = selectedChatIds.filter(id => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_1__.selectChat)(global, id));
  return {
    selectedChatIds: existingSelectedChatIds,
    selectedChatTypes
  };
}
function getSuggestedFolderName(includeFilters) {
  if (includeFilters) {
    const {
      includedChatIds,
      ...filters
    } = includeFilters;
    if (Object.values(filters).filter(Boolean).length > 1 || includedChatIds?.length) {
      return '';
    }
    if (filters.bots) {
      return 'Bots';
    } else if (filters.groups) {
      return 'Groups';
    } else if (filters.channels) {
      return 'Channels';
    } else if (filters.contacts) {
      return 'Contacts';
    } else if (filters.nonContacts) {
      return 'Non-Contacts';
    }
  }
  return '';
}
const INITIAL_STATE = {
  mode: 'create',
  chatFilter: '',
  folder: {
    title: {
      text: ''
    },
    includedChatIds: [],
    excludedChatIds: []
  }
};
const foldersReducer = (state, action) => {
  switch (action.type) {
    case 'setTitle':
      return {
        ...state,
        folder: {
          ...state.folder,
          title: {
            text: action.payload
          }
        },
        isTouched: true
      };
    case 'setFolderId':
      return {
        ...state,
        folderId: action.payload,
        mode: 'edit'
      };
    case 'editIncludeFilters':
      return {
        ...state,
        includeFilters: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.pick)(state.folder, INCLUDE_FILTER_FIELDS)
      };
    case 'editExcludeFilters':
      return {
        ...state,
        excludeFilters: (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.pick)(state.folder, EXCLUDE_FILTER_FIELDS)
      };
    case 'setIncludeFilters':
      return {
        ...state,
        includeFilters: action.payload,
        chatFilter: ''
      };
    case 'setExcludeFilters':
      return {
        ...state,
        excludeFilters: action.payload,
        chatFilter: ''
      };
    case 'saveFilters':
      if (state.includeFilters) {
        return {
          ...state,
          folder: {
            ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(state.folder, INCLUDE_FILTER_FIELDS),
            title: state.folder.title ? state.folder.title : {
              text: getSuggestedFolderName(state.includeFilters)
            },
            ...state.includeFilters
          },
          includeFilters: undefined,
          chatFilter: '',
          isTouched: true
        };
      } else if (state.excludeFilters) {
        return {
          ...state,
          folder: {
            ...(0,_util_iteratees__WEBPACK_IMPORTED_MODULE_2__.omit)(state.folder, EXCLUDE_FILTER_FIELDS),
            ...state.excludeFilters
          },
          excludeFilters: undefined,
          chatFilter: '',
          isTouched: true
        };
      } else {
        return state;
      }
    case 'editFolder':
      {
        const {
          id: folderId,
          ...folder
        } = action.payload;
        return {
          mode: 'edit',
          folderId,
          folder,
          chatFilter: ''
        };
      }
    case 'setChatFilter':
      {
        return {
          ...state,
          chatFilter: action.payload
        };
      }
    case 'setIsTouched':
      {
        return {
          ...state,
          isTouched: action.payload
        };
      }
    case 'setIsLoading':
      {
        return {
          ...state,
          isLoading: action.payload
        };
      }
    case 'setError':
      {
        return {
          ...state,
          isLoading: false,
          error: action.payload
        };
      }
    case 'setIsChatlist':
      return {
        ...state,
        folder: {
          ...state.folder,
          isChatList: action.payload
        }
      };
    case 'reset':
      return INITIAL_STATE;
    default:
      return state;
  }
};
const useFoldersReducer = () => {
  return (0,_useReducer__WEBPACK_IMPORTED_MODULE_3__["default"])(foldersReducer, INITIAL_STATE);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useFoldersReducer);

/***/ },

/***/ "./src/hooks/schedulers/useIntervalForceUpdate.ts"
/*!********************************************************!*\
  !*** ./src/hooks/schedulers/useIntervalForceUpdate.ts ***!
  \********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useIntervalForceUpdate)
/* harmony export */ });
/* harmony import */ var _useForceUpdate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _useInterval__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useInterval */ "./src/hooks/schedulers/useInterval.ts");


function useIntervalForceUpdate(interval) {
  const forceUpdate = (0,_useForceUpdate__WEBPACK_IMPORTED_MODULE_0__["default"])();
  (0,_useInterval__WEBPACK_IMPORTED_MODULE_1__["default"])(forceUpdate, interval, true);
}

/***/ },

/***/ "./src/hooks/scroll/useTopOverscroll.tsx"
/*!***********************************************!*\
  !*** ./src/hooks/scroll/useTopOverscroll.tsx ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useTopOverscroll)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_resetScroll__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../util/resetScroll */ "./src/util/resetScroll.ts");
/* harmony import */ var _useDebouncedCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../useDebouncedCallback */ "./src/hooks/useDebouncedCallback.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../useLastCallback */ "./src/hooks/useLastCallback.ts");







const MOUSE_WHEEL_DEBOUNCE = 250;
const TRIGGER_HEIGHT = 1;
const INERTIA_THRESHOLD = 100;
function useTopOverscroll(containerRef, onOverscroll, onReset, isDisabled) {
  const overscrollTriggerRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isTriggerJustEnabled = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const lastScrollTopRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
  const isTriggerEnabledRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const lastIsOnTopRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(true);
  const lastScrollAtRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
  const isReturningOverscrollRef = (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const enableOverscrollTrigger = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])((noScrollInertiaStop = false) => {
    if (isTriggerEnabledRef.current) return;
    if (!overscrollTriggerRef.current || !containerRef.current) return;
    overscrollTriggerRef.current.style.display = 'block';
    containerRef.current.scrollTop = TRIGGER_HEIGHT;
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_SAFARI && !noScrollInertiaStop) {
      (0,_util_resetScroll__WEBPACK_IMPORTED_MODULE_3__.stopScrollInertia)(containerRef.current);
    }
    isTriggerJustEnabled.current = true;
    lastScrollTopRef.current = TRIGGER_HEIGHT;
    isTriggerEnabledRef.current = true;
    lastIsOnTopRef.current = true;
  });
  const disableOverscrollTrigger = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (!isTriggerEnabledRef.current) return;
    if (!overscrollTriggerRef.current) return;
    overscrollTriggerRef.current.style.display = 'none';
    isTriggerEnabledRef.current = false;
  });
  const handleScroll = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    if (!containerRef.current) return;
    if (isTriggerJustEnabled.current) {
      isTriggerJustEnabled.current = false;
      return;
    }
    const newScrollTop = containerRef.current.scrollTop;
    const isMovingDown = newScrollTop > lastScrollTopRef.current;
    const isMovingUp = newScrollTop < lastScrollTopRef.current;
    const isOnTop = newScrollTop === 0;
    const lastEventDelay = Date.now() - lastScrollAtRef.current;
    if (overscrollTriggerRef.current) {
      if (isOnTop && !isTriggerEnabledRef.current) {
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.forceMutation)(enableOverscrollTrigger, [containerRef.current, overscrollTriggerRef.current]);
        return;
      }
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.forceMutation)(disableOverscrollTrigger, overscrollTriggerRef.current);
    }
    if (isMovingUp && (lastIsOnTopRef.current && lastEventDelay > INERTIA_THRESHOLD || newScrollTop < 0 && isReturningOverscrollRef.current // Overscroll repeated by the user
    )) {
      onOverscroll?.();
    } else if (isMovingDown && newScrollTop > 0) {
      onReset?.();
    }
    lastScrollTopRef.current = newScrollTop;
    lastIsOnTopRef.current = isOnTop;
    lastScrollAtRef.current = Date.now();
    isReturningOverscrollRef.current = isMovingDown && newScrollTop < 0;
  });

  // Handle non-scrollable container
  const handleWheel = (0,_useDebouncedCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(event => {
    if (!containerRef.current) return;
    const container = containerRef.current;
    const isScrollable = container.scrollHeight > container.offsetHeight;
    if (isScrollable || event.deltaY === 0) return;
    if (event.deltaY < 0) {
      onOverscroll?.();
    } else {
      onReset?.();
    }
  }, [containerRef, onOverscroll, onReset], MOUSE_WHEEL_DEBOUNCE);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const container = containerRef.current;
    if (!container) return undefined;
    if (container.scrollTop === 0) {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
        enableOverscrollTrigger(true);
      });
    }
    container.addEventListener('scroll', handleScroll, {
      passive: true
    });
    container.addEventListener('wheel', handleWheel, {
      passive: true
    });
    return () => {
      container.removeEventListener('scroll', handleScroll);
      container.removeEventListener('wheel', handleWheel);
    };
  }, [containerRef, handleWheel]);
  return !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_IOS && !isDisabled ? /*#__PURE__*/_teact__WEBPACK_IMPORTED_MODULE_0__["default"].createElement("div", {
    ref: overscrollTriggerRef,
    className: "overscroll-trigger",
    key: "overscroll-trigger"
  }) : undefined;
}

/***/ },

/***/ "./src/hooks/useAsyncResolvers.ts"
/*!****************************************!*\
  !*** ./src/hooks/useAsyncResolvers.ts ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useDebouncedResolver: () => (/* binding */ useDebouncedResolver),
/* harmony export */   useDebouncedSignal: () => (/* binding */ useDebouncedSignal),
/* harmony export */   useThrottledResolver: () => (/* binding */ useThrottledResolver),
/* harmony export */   useThrottledSignal: () => (/* binding */ useThrottledSignal)
/* harmony export */ });
/* harmony import */ var _useDebouncedCallback__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./useDebouncedCallback */ "./src/hooks/useDebouncedCallback.ts");
/* harmony import */ var _useDerivedSignal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useDerivedSignal */ "./src/hooks/useDerivedSignal.ts");
/* harmony import */ var _useThrottledCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useThrottledCallback */ "./src/hooks/useThrottledCallback.ts");



function useThrottledResolver(resolver, deps, msOrSchedulerFn, noFirst = false) {
  return (0,_useThrottledCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(setValue => {
    setValue(resolver());
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, deps, msOrSchedulerFn, noFirst);
}
function useThrottledSignal(getValue, ms, noFirst = false) {
  const throttledResolver = useThrottledResolver(() => getValue(), [getValue], ms, noFirst);
  return (0,_useDerivedSignal__WEBPACK_IMPORTED_MODULE_1__["default"])(throttledResolver, [throttledResolver, getValue], true);
}
function useDebouncedResolver(resolver, deps, ms, noFirst = false, noLast = false) {
  return (0,_useDebouncedCallback__WEBPACK_IMPORTED_MODULE_0__["default"])(setValue => {
    setValue(resolver());
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, deps, ms, noFirst, noLast);
}
function useDebouncedSignal(getValue, ms, noFirst = false, noLast = false) {
  const debouncedResolver = useDebouncedResolver(() => getValue(), [getValue], ms, noFirst, noLast);
  return (0,_useDerivedSignal__WEBPACK_IMPORTED_MODULE_1__["default"])(debouncedResolver, [debouncedResolver, getValue], true);
}

/***/ },

/***/ "./src/hooks/useAudioPlayer.ts"
/*!*************************************!*\
  !*** ./src/hooks/useAudioPlayer.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_audioPlayer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/audioPlayer */ "./src/util/audioPlayer.ts");
/* harmony import */ var _util_mediaSession__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../util/mediaSession */ "./src/util/mediaSession.ts");
/* harmony import */ var _util_patchSafariProgressiveAudio__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../util/patchSafariProgressiveAudio */ "./src/util/patchSafariProgressiveAudio.ts");
/* harmony import */ var _useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./useEffectWithPrevDeps */ "./src/hooks/useEffectWithPrevDeps.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _useSyncEffect__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./useSyncEffect */ "./src/hooks/useSyncEffect.ts");










const DEFAULT_SKIP_TIME = 10;
const useAudioPlayer = (trackId, originalDuration, trackType, src, handlers, metadata, onInit, shouldPlay = false, onForcePlay, onTrackChange, noPlaylist = false, noProgressUpdates = false, onPause, noReset = false, noHandleEvents = false) => {
  const controllerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const [isPlaying, setIsPlaying] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  let isPlayingSync = isPlaying;
  const [playProgress, setPlayProgress] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const handleTrackChange = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    setIsPlaying(false);
    if (onTrackChange) onTrackChange();
  });
  (0,_useSyncEffect__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (!trackId) {
      return;
    }
    controllerRef.current = (0,_util_audioPlayer__WEBPACK_IMPORTED_MODULE_4__.register)(trackId, trackType, (eventName, e) => {
      if (noHandleEvents) {
        return;
      }
      switch (eventName) {
        case 'onPlay':
          {
            const {
              setVolume,
              setPlaybackRate,
              toggleMuted,
              proxy
            } = controllerRef.current;
            setIsPlaying(true);
            if (trackType !== 'oneTimeVoice') {
              (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_5__.registerMediaSession)(metadata, makeMediaHandlers(controllerRef));
            }
            (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_5__.setPlaybackState)('playing');
            const {
              audioPlayer
            } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)());
            setVolume(audioPlayer.volume);
            toggleMuted(Boolean(audioPlayer.isMuted));
            const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;
            if (trackType === 'voice' || duration > _config__WEBPACK_IMPORTED_MODULE_2__.PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION) {
              setPlaybackRate(audioPlayer.playbackRate);
            }
            (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_5__.setPositionState)({
              duration: proxy.duration || 0,
              playbackRate: proxy.playbackRate,
              position: proxy.currentTime
            });
            break;
          }
        case 'onRateChange':
          {
            const {
              proxy
            } = controllerRef.current;
            (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_5__.setPositionState)({
              duration: proxy.duration || 0,
              playbackRate: proxy.playbackRate,
              position: proxy.currentTime
            });
            break;
          }
        case 'onPause':
          setIsPlaying(false);
          (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_5__.setPlaybackState)('paused');
          onPause?.();
          break;
        case 'onTimeUpdate':
          {
            const {
              proxy
            } = controllerRef.current;
            if (noReset && proxy.currentTime === 0) {
              break;
            }
            const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;
            if (!noProgressUpdates) setPlayProgress(proxy.currentTime / duration);
            break;
          }
        case 'onEnded':
          {
            (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_5__.setPlaybackState)('paused');
            break;
          }
      }
      handlers?.[eventName]?.(e);
    }, onForcePlay, handleTrackChange);
    const {
      proxy
    } = controllerRef.current;
    if (!isPlaying && !proxy.paused) {
      setIsPlaying(true);
      // `isPlayingSync` is only needed to help `setIsPlaying` because it is asynchronous
      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
      isPlayingSync = true;
    }
    if (onInit && !noHandleEvents) {
      onInit(proxy);
    }
  }, [trackId]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isPlaying && metadata) (0,_util_mediaSession__WEBPACK_IMPORTED_MODULE_5__.updateMetadata)(metadata);
  }, [metadata, isPlaying]);
  const {
    play,
    pause,
    setCurrentTime,
    proxy,
    destroy,
    setVolume,
    stop,
    isFirst,
    isLast,
    requestNextTrack,
    requestPreviousTrack,
    setPlaybackRate,
    toggleMuted
  } = controllerRef.current ?? {};
  const duration = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return proxy?.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;
  }, [proxy?.duration, originalDuration]);

  // RAF progress
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!proxy) {
      return;
    }
    if (noReset && proxy.currentTime === 0) {
      return;
    }
    if (duration && !(0,_util_patchSafariProgressiveAudio__WEBPACK_IMPORTED_MODULE_6__.isSafariPatchInProgress)(proxy) && !noProgressUpdates) {
      setPlayProgress(proxy.currentTime / duration);
    }
  }, [duration, playProgress, proxy, noProgressUpdates, noReset]);

  // Cleanup
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => () => {
    destroy?.(noPlaylist);
  }, [destroy, noPlaylist]);

  // Autoplay once `src` is present
  (0,_useEffectWithPrevDeps__WEBPACK_IMPORTED_MODULE_7__["default"])(([prevShouldPlay, prevSrc]) => {
    if (prevShouldPlay === shouldPlay && src === prevSrc) {
      return;
    }

    // When paused by another player
    if (proxy?.src && proxy?.paused) {
      return;
    }
    if (shouldPlay && src && !isPlaying) {
      play?.(src);
    }
  }, [shouldPlay, src, isPlaying, play, proxy?.src, proxy?.paused, trackType]);
  const playIfPresent = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (src) {
      play?.(src);
    }
  });
  const playPause = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (isPlaying) {
      pause?.();
    } else {
      playIfPresent();
    }
  });
  const setTime = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(time => {
    setCurrentTime?.(time);
    if (duration && proxy) {
      setPlayProgress(proxy.currentTime / duration);
    }
  });
  return {
    isPlaying: isPlayingSync,
    playProgress,
    playPause,
    pause,
    play: playIfPresent,
    stop,
    setCurrentTime: setTime,
    setVolume,
    audioProxy: proxy,
    duration,
    requestNextTrack,
    requestPreviousTrack,
    isFirst,
    isLast,
    setPlaybackRate,
    toggleMuted
  };
};
function makeMediaHandlers(controllerRef) {
  let mediaHandlers = {};
  if (controllerRef && controllerRef.current) {
    const {
      play,
      pause,
      setCurrentTime,
      proxy,
      requestNextTrack,
      requestPreviousTrack,
      isFirst,
      isLast
    } = controllerRef.current;
    mediaHandlers = {
      play: () => {
        play(proxy.src);
      },
      pause: () => {
        pause();
      },
      stop: () => {
        pause();
        setCurrentTime(0);
        (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().closeAudioPlayer();
      },
      seekbackward: event => {
        const skipTime = event.seekOffset || DEFAULT_SKIP_TIME;
        setCurrentTime(Math.max(proxy.currentTime - skipTime, 0));
      },
      seekforward: event => {
        const skipTime = event.seekOffset || DEFAULT_SKIP_TIME;
        setCurrentTime(Math.min(proxy.currentTime + skipTime, proxy.duration));
      },
      seekTo: event => {
        if (event.seekTime) {
          setCurrentTime(event.seekTime);
        }
      }
    };
    if (!isLast()) {
      mediaHandlers.nexttrack = () => {
        requestNextTrack();
      };
    }
    if (!isFirst()) {
      mediaHandlers.previoustrack = () => {
        requestPreviousTrack();
      };
    }
  }
  return mediaHandlers;
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useAudioPlayer);

/***/ },

/***/ "./src/hooks/useChatContextActions.ts"
/*!********************************************!*\
  !*** ./src/hooks/useChatContextActions.ts ***!
  \********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_entities_ids__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../util/entities/ids */ "./src/util/entities/ids.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../util/subscriptionHandler */ "./src/util/subscriptionHandler.ts");
/* harmony import */ var _useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./useLang */ "./src/hooks/useLang.ts");









const useChatContextActions = ({
  chat,
  user,
  folderId,
  isPinned,
  isMuted,
  canChangeFolder,
  isSavedDialog,
  currentUserId,
  isPreview,
  topics,
  handleDelete,
  handleMute,
  handleChatFolderChange,
  handleReport
}, isInSearch = false) => {
  const lang = (0,_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const {
    isSelf
  } = user || {};
  const isServiceNotifications = user?.id === _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID;
  const deleteTitle = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!chat) return undefined;
    if (isSavedDialog) {
      return lang('Delete');
    }
    if ((0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chat.id)) {
      return lang('DeleteChat');
    }
    if ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getCanDeleteChat)(chat)) {
      return lang('DeleteChat');
    }
    if ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat)) {
      return lang('ChannelLeave');
    }
    return lang('GroupLeaveGroup');
  }, [chat, isSavedDialog, lang]);
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!chat || isPreview) {
      return undefined;
    }
    const {
      toggleChatPinned,
      toggleSavedDialogPinned,
      updateChatMutedState,
      toggleChatArchived,
      markChatMessagesRead,
      markChatUnread,
      openChatInNewTab,
      openUserPortrait,
      openPayPackageModal
    } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
    const actionUserPortrait = (0,_util_entities_ids__WEBPACK_IMPORTED_MODULE_5__.isUserId)(chat.id) ? {
      title: 'User Portrait',
      icon: 'portrait-icon',
      handler: () => {
        if (!(0,_util_subscriptionHandler__WEBPACK_IMPORTED_MODULE_7__.checkCredisBalance)()) {
          openPayPackageModal();
          return;
        }
        const subscriptionInfo = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().subscriptionInfo;
        if (subscriptionInfo.subscriptionType === 'plus') {
          openUserPortrait({
            chatId: chat.id,
            userId: chat.id
          });
        } else {
          openPayPackageModal();
        }
      }
    } : undefined;
    const actionOpenInNewTab = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_OPEN_IN_NEW_TAB_SUPPORTED && {
      title: _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_ELECTRON ? lang('ChatListOpenInNewWindow') : lang('ChatListOpenInNewTab'),
      icon: 'open-in-new-tab',
      handler: () => {
        if (isSavedDialog) {
          openChatInNewTab({
            chatId: currentUserId,
            threadId: chat.id
          });
        } else {
          openChatInNewTab({
            chatId: chat.id
          });
        }
      }
    };
    const togglePinned = () => {
      if (isSavedDialog) {
        toggleSavedDialogPinned({
          id: chat.id
        });
      } else {
        toggleChatPinned({
          id: chat.id,
          folderId: folderId
        });
      }
    };
    const actionPin = isPinned ? {
      title: lang('ChatListUnpinFromTop'),
      icon: 'unpin',
      handler: togglePinned
    } : {
      title: lang('ChatListPinToTop'),
      icon: 'pin',
      handler: togglePinned
    };
    const actionDelete = {
      title: deleteTitle,
      icon: 'delete',
      destructive: true,
      handler: handleDelete
    };
    if (isSavedDialog) {
      return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_6__.compact)([actionOpenInNewTab, actionPin, actionDelete]);
    }
    const actionAddToFolder = canChangeFolder ? {
      title: lang('ChatListContextAddToFolder'),
      icon: 'folder',
      handler: handleChatFolderChange
    } : undefined;
    const actionMute = isMuted ? {
      title: lang('ChatsUnmute'),
      icon: 'unmute',
      handler: () => updateChatMutedState({
        chatId: chat.id,
        isMuted: false
      })
    } : {
      title: `${lang('ChatsMute')}...`,
      icon: 'mute',
      handler: handleMute
    };
    if (isInSearch) {
      return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_6__.compact)([actionOpenInNewTab, actionPin, actionAddToFolder, actionMute]);
    }
    const actionMaskAsRead = chat.unreadCount || chat.hasUnreadMark || Object.values(topics || {}).some(({
      unreadCount
    }) => unreadCount) ? {
      title: lang('ChatListContextMaskAsRead'),
      icon: 'readchats',
      handler: () => markChatMessagesRead({
        id: chat.id
      })
    } : undefined;
    const actionMarkAsUnread = !(chat.unreadCount || chat.hasUnreadMark) && !chat.isForum ? {
      title: lang('ChatListContextMaskAsUnread'),
      icon: 'unread',
      handler: () => markChatUnread({
        id: chat.id
      })
    } : undefined;
    const actionArchive = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatArchived)(chat) ? {
      title: lang('Unarchive'),
      icon: 'unarchive',
      handler: () => toggleChatArchived({
        id: chat.id
      })
    } : {
      title: lang('Archive'),
      icon: 'archive',
      handler: () => toggleChatArchived({
        id: chat.id
      })
    };
    const canReport = handleReport && !user && ((0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatChannel)(chat) || (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isChatGroup)(chat));
    const actionReport = canReport ? {
      title: lang('ReportPeerReport'),
      icon: 'flag',
      handler: handleReport
    } : undefined;
    const isInFolder = folderId !== undefined;
    return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_6__.compact)([actionUserPortrait, actionOpenInNewTab, actionAddToFolder, actionMaskAsRead, actionMarkAsUnread, actionPin, !isSelf && actionMute, !isSelf && !isServiceNotifications && !isInFolder && actionArchive, actionReport, actionDelete]);
  }, [chat, user, canChangeFolder, lang, handleChatFolderChange, isPinned, isInSearch, isMuted, currentUserId, handleDelete, handleMute, handleReport, folderId, isSelf, isServiceNotifications, isSavedDialog, deleteTitle, isPreview, topics]);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useChatContextActions);

/***/ },

/***/ "./src/hooks/useEnsureStory.ts"
/*!*************************************!*\
  !*** ./src/hooks/useEnsureStory.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global */ "./src/global/index.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/schedulers */ "./src/util/schedulers.ts");



const THROTTLE_THRESHOLD_MS = 200;
function useEnsureStory(peerId, storyId, story) {
  const {
    loadPeerStoriesByIds
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const loadStoryThrottled = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const throttled = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_2__.throttle)(loadPeerStoriesByIds, THROTTLE_THRESHOLD_MS, true);
    return () => {
      throttled({
        peerId: peerId,
        storyIds: [storyId]
      });
    };
  }, [storyId, peerId]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const shouldLoadStory = !story || !('content' in story || 'isDeleted' in story);
    if (peerId && storyId && shouldLoadStory) {
      loadStoryThrottled();
    }
  }, [loadStoryThrottled, story, storyId, peerId]);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useEnsureStory);

/***/ },

/***/ "./src/hooks/useForumPanelRender.ts"
/*!******************************************!*\
  !*** ./src/hooks/useForumPanelRender.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useForumPanelRender)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _useForceUpdate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _useSyncEffect__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useSyncEffect */ "./src/hooks/useSyncEffect.ts");




function useForumPanelRender(isForumPanelOpen = false) {
  const shouldRenderForumPanelRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(isForumPanelOpen);
  const isAnimationStartedRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const forceUpdate = (0,_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__["default"])();
  (0,_useSyncEffect__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    if (isForumPanelOpen) {
      shouldRenderForumPanelRef.current = true;
    }
  }, [isForumPanelOpen]);
  const handleForumPanelAnimationEnd = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    shouldRenderForumPanelRef.current = false;
    isAnimationStartedRef.current = false;
    forceUpdate();
  });
  const handleForumPanelAnimationStart = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    isAnimationStartedRef.current = true;
    forceUpdate();
  });
  return {
    shouldRenderForumPanel: shouldRenderForumPanelRef.current,
    isAnimationStarted: isAnimationStartedRef.current,
    handleForumPanelAnimationEnd,
    handleForumPanelAnimationStart
  };
}

/***/ },

/***/ "./src/hooks/useGetSelectionRange.ts"
/*!*******************************************!*\
  !*** ./src/hooks/useGetSelectionRange.ts ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useGetSelectionRange)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");

function useGetSelectionRange(inputSelector) {
  const [getRange, setRange] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useSignal)();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    function onSelectionChange() {
      const selection = window.getSelection();
      if (!selection?.rangeCount) return;
      const range = selection.getRangeAt(0);
      if (!range) {
        return;
      }
      const inputEl = document.querySelector(inputSelector);
      if (!inputEl) {
        return;
      }
      const {
        commonAncestorContainer
      } = range;
      const element = commonAncestorContainer instanceof Element ? commonAncestorContainer : commonAncestorContainer.parentElement;
      if (element.closest(inputSelector)) {
        setRange(range);
      }
    }
    document.addEventListener('selectionchange', onSelectionChange);
    return () => document.removeEventListener('selectionchange', onSelectionChange);
  }, [inputSelector, setRange]);
  return getRange;
}

/***/ },

/***/ "./src/hooks/useHotkeys.ts"
/*!*********************************!*\
  !*** ./src/hooks/useHotkeys.ts ***!
  \*********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useHotkeys: () => (/* binding */ useHotkeys)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_callbacks__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/callbacks */ "./src/util/callbacks.ts");
/* harmony import */ var _util_parseHotkey__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/parseHotkey */ "./src/util/parseHotkey.ts");



const IGNORE_TAGS = new Set(['INPUT', 'TEXTAREA', 'SELECT']);
const handlers = (0,_util_callbacks__WEBPACK_IMPORTED_MODULE_1__.createCallbackManager)();
document.documentElement.addEventListener('keydown', handlers.runCallbacks);
function useHotkeys(hotkeys) {
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!hotkeys) {
      return undefined;
    }
    const entries = Object.entries(hotkeys);
    function handleKeyDown(e) {
      if (!shouldFireEvent(e)) {
        return;
      }
      entries.forEach(([hotkey, handler]) => {
        if ((0,_util_parseHotkey__WEBPACK_IMPORTED_MODULE_2__.getHotkeyMatcher)(hotkey)(e)) {
          handler(e);
        }
      });
    }
    return handlers.addCallback(handleKeyDown);
  }, [hotkeys]);
}
function shouldFireEvent(e) {
  if (e.target instanceof HTMLElement) {
    return !IGNORE_TAGS.has(e.target.tagName);
  }
  return true;
}

/***/ },

/***/ "./src/hooks/useLongPress.ts"
/*!***********************************!*\
  !*** ./src/hooks/useLongPress.ts ***!
  \***********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");



const DEFAULT_THRESHOLD = 250;
function useLongPress({
  onClick,
  onStart,
  onEnd,
  threshold = DEFAULT_THRESHOLD
}) {
  const isLongPressActive = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const isPressed = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const timerId = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(undefined);
  const start = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(e => {
    const canProcessEvent = 'button' in e && e.button === 0 || 'touches' in e && e.touches.length > 0;
    if (isPressed.current || !canProcessEvent) {
      return;
    }
    isPressed.current = true;
    timerId.current = window.setTimeout(() => {
      onStart?.();
      isLongPressActive.current = true;
    }, threshold);
  });
  const end = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(e => {
    if (!isPressed.current) return;
    if (isLongPressActive.current) {
      onEnd?.();
    } else {
      onClick?.(e);
    }
    cancel();
  });
  const cancel = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    isLongPressActive.current = false;
    isPressed.current = false;
    window.clearTimeout(timerId.current);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useUnmountCleanup)(() => {
    window.clearTimeout(timerId.current);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    document.body.addEventListener(_config__WEBPACK_IMPORTED_MODULE_1__.ELECTRON_WINDOW_DRAG_EVENT_START, cancel);
    return () => {
      document.body.removeEventListener(_config__WEBPACK_IMPORTED_MODULE_1__.ELECTRON_WINDOW_DRAG_EVENT_START, cancel);
    };
  }, []);
  return {
    onMouseDown: start,
    onMouseUp: end,
    onMouseLeave: end,
    onTouchStart: start,
    onTouchEnd: end
  };
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useLongPress);

/***/ },

/***/ "./src/hooks/useMediaWithLoadProgress.ts"
/*!***********************************************!*\
  !*** ./src/hooks/useMediaWithLoadProgress.ts ***!
  \***********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useMediaWithLoadProgress)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _data_useSelector__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./data/useSelector */ "./src/hooks/data/useSelector.ts");
/* harmony import */ var _useForceUpdate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _useUniqueId__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./useUniqueId */ "./src/hooks/useUniqueId.ts");









const STREAMING_PROGRESS = 0.75;
const STREAMING_TIMEOUT = 1500;
const PROGRESS_THROTTLE = 500;
function useMediaWithLoadProgress(mediaHash, noLoad = false, mediaFormat = _api_types__WEBPACK_IMPORTED_MODULE_1__.ApiMediaFormat.BlobUrl, delay, isHtmlAllowed = false) {
  const mediaData = mediaHash ? _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.getFromMemory(mediaHash) : undefined;
  const isStreaming = _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_3__.IS_PROGRESSIVE_SUPPORTED && mediaFormat === _api_types__WEBPACK_IMPORTED_MODULE_1__.ApiMediaFormat.Progressive;
  const forceUpdate = (0,_useForceUpdate__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const isSynced = (0,_data_useSelector__WEBPACK_IMPORTED_MODULE_6__["default"])(_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsSynced);
  const id = (0,_useUniqueId__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [loadProgress, setLoadProgress] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(mediaData && !isStreaming ? 1 : 0);
  const startedAtRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const handleProgress = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_5__.throttle)(progress => {
      if (startedAtRef.current && (!delay || Date.now() - startedAtRef.current > delay)) {
        setLoadProgress(progress);
      }
    }, PROGRESS_THROTTLE, true);
  }, [delay]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!noLoad && mediaHash) {
      if (!mediaData) {
        setLoadProgress(0);
        if (startedAtRef.current) {
          _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.cancelProgress(handleProgress);
        }
        startedAtRef.current = Date.now();
        _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.fetch(mediaHash, mediaFormat, isHtmlAllowed, handleProgress, id).then(() => {
          const spentTime = Date.now() - startedAtRef.current;
          startedAtRef.current = undefined;
          if (!delay || spentTime >= delay) {
            forceUpdate();
          } else {
            setTimeout(forceUpdate, delay - spentTime);
          }
        });
      } else if (isStreaming) {
        setTimeout(() => {
          setLoadProgress(STREAMING_PROGRESS);
        }, STREAMING_TIMEOUT);
      }
    }
  }, [noLoad, mediaHash, mediaData, mediaFormat, isStreaming, delay, handleProgress, isHtmlAllowed, id, isSynced]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (noLoad && startedAtRef.current) {
      _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.cancelProgress(handleProgress);
      setLoadProgress(0);
      startedAtRef.current = undefined;
    }
  }, [handleProgress, noLoad]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    return () => {
      if (mediaHash) {
        _util_mediaLoader__WEBPACK_IMPORTED_MODULE_4__.removeCallback(mediaHash, id);
      }
    };
  }, [id, mediaHash]);
  return {
    mediaData,
    loadProgress
  };
}

/***/ },

/***/ "./src/hooks/useMouseInside.ts"
/*!*************************************!*\
  !*** ./src/hooks/useMouseInside.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useMouseInside)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");



const MENU_CLOSE_TIMEOUT = 250;
let closeTimeout;
function useMouseInside(isOpen, onClose, menuCloseTimeout = MENU_CLOSE_TIMEOUT, isDisabled = false) {
  const isMouseInside = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const markMouseInside = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    isMouseInside.current = true;
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (closeTimeout) {
      clearTimeout(closeTimeout);
      closeTimeout = undefined;
    }
    if (isOpen && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_1__.IS_TOUCH_ENV && !isDisabled) {
      closeTimeout = window.setTimeout(() => {
        if (!isMouseInside.current) {
          onClose();
        }
      }, menuCloseTimeout * 2);
    }
  }, [isDisabled, isOpen, menuCloseTimeout, onClose]);
  const handleMouseEnter = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    isMouseInside.current = true;
  });
  const handleMouseLeave = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(() => {
    isMouseInside.current = false;
    if (closeTimeout) {
      clearTimeout(closeTimeout);
      closeTimeout = undefined;
    }
    closeTimeout = window.setTimeout(() => {
      if (!isMouseInside.current) {
        onClose();
      }
    }, menuCloseTimeout);
  });
  return [handleMouseEnter, handleMouseLeave, markMouseInside];
}

/***/ },

/***/ "./src/hooks/useOffscreenCanvasBlur.ts"
/*!*********************************************!*\
  !*** ./src/hooks/useOffscreenCanvasBlur.ts ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useOffscreenCanvasBlur)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_cycleRestrict__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/cycleRestrict */ "./src/util/cycleRestrict.ts");
/* harmony import */ var _util_files__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/files */ "./src/util/files.ts");
/* harmony import */ var _util_launchMediaWorkers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/launchMediaWorkers */ "./src/util/launchMediaWorkers.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");






const RADIUS_RATIO = 0.1; // Use 10% of the smallest dimension as the blur radius

let lastWorkerIndex = -1;
function useOffscreenCanvasBlur(thumbData,
// data URI or blob URL
isDisabled = false) {
  const canvasRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const workerIndex = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => (0,_util_cycleRestrict__WEBPACK_IMPORTED_MODULE_2__["default"])(_util_launchMediaWorkers__WEBPACK_IMPORTED_MODULE_4__.MAX_WORKERS, ++lastWorkerIndex), []);
  const offscreenRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const blurThumb = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(async (canvas, uri) => {
    const image = await (0,_util_files__WEBPACK_IMPORTED_MODULE_3__.preloadImage)(uri);
    if (!image) {
      return;
    }
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
      canvas.width = image.width;
      canvas.height = image.height;
      offscreenRef.current = canvas.transferControlToOffscreen();
      const radius = Math.ceil(Math.min(image.width, image.height) * RADIUS_RATIO);
      (0,_util_launchMediaWorkers__WEBPACK_IMPORTED_MODULE_4__.requestMediaWorker)({
        name: 'offscreen-canvas:blurThumb',
        args: [offscreenRef.current, uri, radius],
        transferables: [offscreenRef.current]
      }, workerIndex);
    });
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    if (!thumbData || isDisabled || offscreenRef.current) return;
    const canvas = canvasRef.current;
    if (!canvas) return;
    blurThumb(canvas, thumbData);
  }, [blurThumb, isDisabled, thumbData]);
  return canvasRef;
}

/***/ },

/***/ "./src/hooks/usePrevDuringAnimation.ts"
/*!*********************************************!*\
  !*** ./src/hooks/usePrevDuringAnimation.ts ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePrevDuringAnimation)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _useForceUpdate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./usePreviousDeprecated */ "./src/hooks/usePreviousDeprecated.ts");
/* harmony import */ var _useSyncEffect__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useSyncEffect */ "./src/hooks/useSyncEffect.ts");




function usePrevDuringAnimation(current, duration) {
  const prev = (0,_usePreviousDeprecated__WEBPACK_IMPORTED_MODULE_2__["default"])(current, true);
  const timeoutRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const forceUpdate = (0,_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__["default"])();
  // eslint-disable-next-line no-null/no-null
  const isCurrentPresent = current !== undefined && current !== null;
  // eslint-disable-next-line no-null/no-null
  const isPrevPresent = prev !== undefined && prev !== null;
  if (isCurrentPresent && timeoutRef.current) {
    clearTimeout(timeoutRef.current);
    timeoutRef.current = undefined;
  }
  (0,_useSyncEffect__WEBPACK_IMPORTED_MODULE_3__["default"])(() => {
    // When `current` becomes empty
    if (duration && !isCurrentPresent && isPrevPresent && !timeoutRef.current) {
      timeoutRef.current = window.setTimeout(() => {
        timeoutRef.current = undefined;
        forceUpdate();
      }, duration);
    }
  }, [duration, forceUpdate, isCurrentPresent, isPrevPresent]);
  return !timeoutRef.current || !duration || isCurrentPresent ? current : prev;
}

/***/ },

/***/ "./src/hooks/useReducer.ts"
/*!*********************************!*\
  !*** ./src/hooks/useReducer.ts ***!
  \*********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useReducer)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _useForceUpdate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useForceUpdate */ "./src/hooks/useForceUpdate.ts");


function useReducer(reducer, initialState) {
  const forceUpdate = (0,_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__["default"])();
  const reducerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(reducer);
  const state = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(initialState);
  const dispatch = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(action => {
    state.current = reducerRef.current(state.current, action);
    forceUpdate();
    return state.current;
  }, []);
  return [state.current, dispatch];
}

/***/ },

/***/ "./src/hooks/useScrollNotch.ts"
/*!*************************************!*\
  !*** ./src/hooks/useScrollNotch.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _teact_teact_dom_ts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @teact/teact-dom.ts */ "./src/lib/teact/teact-dom.ts");
/* harmony import */ var _lib_fasterdom_fasterdom_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom.ts */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_schedulers_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/schedulers.ts */ "./src/util/schedulers.ts");




const THROTTLE_DELAY = 100;
const useScrollNotch = ({
  containerRef,
  selector
}, deps) => {
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    const elements = containerRef.current?.querySelectorAll(selector);
    if (!elements?.length) return undefined;
    const handleScroll = (0,_util_schedulers_ts__WEBPACK_IMPORTED_MODULE_3__.throttle)(event => {
      const target = event.target;
      const isScrolled = target.scrollTop > 0;
      (0,_lib_fasterdom_fasterdom_ts__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
        (0,_teact_teact_dom_ts__WEBPACK_IMPORTED_MODULE_1__.toggleExtraClass)(target, 'scrolled', isScrolled);
      });
    }, THROTTLE_DELAY);
    elements.forEach(el => {
      (0,_teact_teact_dom_ts__WEBPACK_IMPORTED_MODULE_1__.addExtraClass)(el, 'with-notch');
      el.addEventListener('scroll', handleScroll, {
        passive: true
      });
    });
    return () => {
      elements.forEach(el => {
        el.removeEventListener('scroll', handleScroll);
        (0,_teact_teact_dom_ts__WEBPACK_IMPORTED_MODULE_1__.removeExtraClass)(el, 'with-notch');
      });
    };
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [containerRef, selector, ...deps]);
  (0,_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const elements = containerRef.current?.querySelectorAll(selector);
    if (!elements?.length) return undefined;
    elements.forEach(el => {
      const isScrolled = el.scrollTop > 0;
      (0,_lib_fasterdom_fasterdom_ts__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
        (0,_teact_teact_dom_ts__WEBPACK_IMPORTED_MODULE_1__.toggleExtraClass)(el, 'scrolled', isScrolled);
      });
    });
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [containerRef, selector, ...deps]);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useScrollNotch);

/***/ },

/***/ "./src/hooks/useSendMessageAction.ts"
/*!*******************************************!*\
  !*** ./src/hooks/useSendMessageAction.ts ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/schedulers */ "./src/util/schedulers.ts");




const useSendMessageAction = (chatId, threadId) => {
  return (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_3__.throttle)(action => {
      if (!chatId || !threadId) return;
      (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)().sendMessageAction({
        chatId,
        threadId,
        action
      });
    }, _config__WEBPACK_IMPORTED_MODULE_2__.SEND_MESSAGE_ACTION_INTERVAL);
  }, [chatId, threadId]);
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (useSendMessageAction);

/***/ },

/***/ "./src/hooks/useStreaming.ts"
/*!***********************************!*\
  !*** ./src/hooks/useStreaming.ts ***!
  \***********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   checkIfStreamingSupported: () => (/* binding */ checkIfStreamingSupported),
/* harmony export */   useStreaming: () => (/* binding */ useStreaming)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_animation__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../util/animation */ "./src/util/animation.ts");
/* harmony import */ var _util_browser_unloadVideo__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/browser/unloadVideo */ "./src/util/browser/unloadVideo.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _util_progressiveLoader__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../util/progressiveLoader */ "./src/util/progressiveLoader.ts");







const VIDEO_REVEAL_DELAY = 100;
function useStreaming(videoRef, url, mimeType) {
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!url || !videoRef.current) return undefined;
    const MediaSourceClass = getMediaSource();
    const video = videoRef.current;
    if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_SAFARI || !mimeType || !MediaSourceClass?.isTypeSupported(mimeType)) {
      return undefined;
    }
    const mediaSource = new MediaSourceClass();
    function revealVideo() {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
        video.style.display = 'block';
        setTimeout(() => {
          (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
            (0,_util_animation__WEBPACK_IMPORTED_MODULE_3__.applyStyles)(video, {
              opacity: '1'
            });
          });
        }, VIDEO_REVEAL_DELAY);
      });
    }
    function onSourceOpen() {
      if (!url || !mimeType) return;
      const sourceBuffer = mediaSource.addSourceBuffer(mimeType);
      const loader = (0,_util_progressiveLoader__WEBPACK_IMPORTED_MODULE_6__.makeProgressiveLoader)(url);
      function onUpdateEnded() {
        loader.next().then(({
          value,
          done
        }) => {
          if (mediaSource.readyState !== 'open') return;
          if (done) {
            endOfStream(mediaSource);
            return;
          }
          appendBuffer(sourceBuffer, value);
        });
      }
      sourceBuffer.addEventListener('updateend', onUpdateEnded);
      loader.next().then(({
        value,
        done
      }) => {
        if (done || mediaSource.readyState !== 'open') return;
        revealVideo();
        appendBuffer(sourceBuffer, value);
      });
    }
    mediaSource.addEventListener('sourceopen', onSourceOpen, {
      once: true
    });
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
      (0,_util_animation__WEBPACK_IMPORTED_MODULE_3__.applyStyles)(video, {
        display: 'none',
        opacity: '0'
      });
      video.src = URL.createObjectURL(mediaSource);
    });
    return () => {
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestMutation)(() => {
        const src = video.src;
        (0,_util_browser_unloadVideo__WEBPACK_IMPORTED_MODULE_4__["default"])(video);
        mediaSource.removeEventListener('sourceopen', onSourceOpen);
        if (mediaSource.readyState === 'open') {
          endOfStream(mediaSource);
        }
        URL.revokeObjectURL(src);
      });
    };
  }, [mimeType, url, videoRef]);
  return checkIfStreamingSupported(mimeType);
}
function checkIfStreamingSupported(mimeType) {
  if (!_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_5__.IS_SAFARI || !mimeType) return false;
  return Boolean(getMediaSource()?.isTypeSupported(mimeType));
}
function appendBuffer(sourceBuffer, buffer) {
  try {
    sourceBuffer.appendBuffer(buffer);
  } catch (error) {
    if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG) {
      // eslint-disable-next-line no-console
      console.warn('[Stream] failed to append buffer', error);
    }
  }
}
function endOfStream(mediaSource) {
  try {
    mediaSource.endOfStream();
  } catch (error) {
    if (_config__WEBPACK_IMPORTED_MODULE_1__.DEBUG) {
      // eslint-disable-next-line no-console
      console.warn('[Stream] failed to end stream', error);
    }
  }
}
function getMediaSource() {
  if ('ManagedMediaSource' in window) {
    // @ts-ignore
    return ManagedMediaSource;
  }
  if ('MediaSource' in window) {
    return MediaSource;
  }
  return undefined;
}

/***/ },

/***/ "./src/hooks/useTextLanguage.ts"
/*!**************************************!*\
  !*** ./src/hooks/useTextLanguage.ts ***!
  \**************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useTextLanguage)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_languageDetection__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/languageDetection */ "./src/util/languageDetection.ts");


function useTextLanguage(text, isDisabled, getIsReady) {
  const [language, setLanguage] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isDisabled || getIsReady && !getIsReady()) return;
    if (text) {
      (0,_util_languageDetection__WEBPACK_IMPORTED_MODULE_1__.detectLanguage)(text).then(setLanguage);
    } else {
      setLanguage(undefined);
    }
  }, [isDisabled, text, getIsReady]);
  return language;
}

/***/ },

/***/ "./src/hooks/window/useBeforeUnload.ts"
/*!*********************************************!*\
  !*** ./src/hooks/window/useBeforeUnload.ts ***!
  \*********************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useBeforeUnload)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../useLastCallback */ "./src/hooks/useLastCallback.ts");



function useBeforeUnload(callback) {
  const lastCallback = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_2__["default"])(callback);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_1__.onBeforeUnload)(lastCallback), [lastCallback]);
}

/***/ },

/***/ "./src/hooks/window/useFullscreen.ts"
/*!*******************************************!*\
  !*** ./src/hooks/window/useFullscreen.ts ***!
  \*******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   checkIfFullscreen: () => (/* binding */ checkIfFullscreen),
/* harmony export */   "default": () => (/* binding */ useFullscreen),
/* harmony export */   safeExitFullscreen: () => (/* binding */ safeExitFullscreen),
/* harmony export */   safeRequestFullscreen: () => (/* binding */ safeRequestFullscreen),
/* harmony export */   useFullscreenStatus: () => (/* binding */ useFullscreenStatus)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _types_electron__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../types/electron */ "./src/types/electron.ts");
/* harmony import */ var _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../util/browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");



const prop = getBrowserFullscreenElementProp();
function useFullscreen(elRef, exitCallback, enterCallback) {
  const [isFullscreen, setIsFullscreen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(Boolean(prop && document[prop]));
  const setFullscreen = () => {
    if (!elRef.current || !(prop || _util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_IOS) || isFullscreen) {
      return;
    }
    safeRequestFullscreen(elRef.current);
    setIsFullscreen(true);
  };
  const exitFullscreen = () => {
    if (!elRef.current) {
      return;
    }
    safeExitFullscreen();
    setIsFullscreen(false);
  };
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(() => {
    const element = elRef.current;
    const listener = () => {
      const isEnabled = Boolean(prop && document[prop]);
      setIsFullscreen(isEnabled);
      if (isEnabled) {
        enterCallback?.(false);
      } else {
        exitCallback?.(false);
      }
      // In Firefox fullscreen video controls are not visible by default, so we force them manually
      if (element instanceof HTMLVideoElement) element.controls = isEnabled;
    };
    const listenerEnter = () => {
      setIsFullscreen(true);
      if (enterCallback) enterCallback(true);
    };
    const listenerExit = () => {
      setIsFullscreen(false);
      if (exitCallback) exitCallback(false);
    };
    document.addEventListener('fullscreenchange', listener, false);
    document.addEventListener('webkitfullscreenchange', listener, false);
    document.addEventListener('mozfullscreenchange', listener, false);
    if (element) {
      element.addEventListener('webkitbeginfullscreen', listenerEnter, false);
      element.addEventListener('webkitendfullscreen', listenerExit, false);
    }
    return () => {
      document.removeEventListener('fullscreenchange', listener, false);
      document.removeEventListener('webkitfullscreenchange', listener, false);
      document.removeEventListener('mozfullscreenchange', listener, false);
      if (element) {
        element.removeEventListener('webkitbeginfullscreen', listenerEnter, false);
        element.removeEventListener('webkitendfullscreen', listenerExit, false);
      }
    };
    // eslint-disable-next-line
  }, []);
  if (!prop && !_util_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_2__.IS_IOS) {
    return [false];
  }
  return [isFullscreen, setFullscreen, exitFullscreen];
}
const useFullscreenStatus = () => {
  const [isFullscreen, setIsFullscreen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const listener = () => {
      setIsFullscreen(checkIfFullscreen());
    };
    const removeElectronListener = window.electron?.on(_types_electron__WEBPACK_IMPORTED_MODULE_1__.ElectronEvent.FULLSCREEN_CHANGE, setIsFullscreen);
    window.electron?.isFullscreen().then(setIsFullscreen);
    document.addEventListener('fullscreenchange', listener, false);
    document.addEventListener('webkitfullscreenchange', listener, false);
    document.addEventListener('mozfullscreenchange', listener, false);
    return () => {
      removeElectronListener?.();
      document.removeEventListener('fullscreenchange', listener, false);
      document.removeEventListener('webkitfullscreenchange', listener, false);
      document.removeEventListener('mozfullscreenchange', listener, false);
    };
  }, []);
  return isFullscreen;
};
function getBrowserFullscreenElementProp() {
  if (typeof document.fullscreenElement !== 'undefined') {
    return 'fullscreenElement';
  } else if (typeof document.mozFullScreenElement !== 'undefined') {
    return 'mozFullScreenElement';
  } else if (typeof document.webkitFullscreenElement !== 'undefined') {
    return 'webkitFullscreenElement';
  }
  return '';
}
function checkIfFullscreen() {
  const fullscreenProp = getBrowserFullscreenElementProp();
  return Boolean(fullscreenProp && document[fullscreenProp]);
}
function safeRequestFullscreen(element) {
  if (element.requestFullscreen) {
    element.requestFullscreen();
  } else if (element.webkitRequestFullscreen) {
    element.webkitRequestFullscreen();
  } else if (element.webkitEnterFullscreen) {
    element.webkitEnterFullscreen();
  } else if (element.mozRequestFullScreen) {
    element.mozRequestFullScreen();
  }
}
function safeExitFullscreen() {
  if (document.exitFullscreen) {
    document.exitFullscreen();
  } else if (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
  } else if (document.webkitCancelFullScreen) {
    document.webkitCancelFullScreen();
  } else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
  }
}

/***/ },

/***/ "./src/lib/cleanDocsHtml.ts"
/*!**********************************!*\
  !*** ./src/lib/cleanDocsHtml.ts ***!
  \**********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ cleanDocsHtml)
/* harmony export */ });
// Utility for cleaning html code from Google Docs.
// Original source from DocsSoap:
// https://www.npmjs.com/package/docs-soap

const GDOCS_ELEMENT_ID_REGEXP = /id="docs-internal-guid/i;
const GDOCS_STYLES = {
  BOLD: '700',
  ITALIC: 'italic',
  UNDERLINE: 'underline',
  STRIKETHROUGH: 'line-through',
  SUPERSCRIPT: 'super',
  SUBSCRIPT: 'sub'
};
const ELEMENTS = {
  ANCHOR: 'a',
  BOLD: 'strong',
  ITALIC: 'em',
  UNDERLINE: 'u',
  BLOCKQUOTE: 'blockquote',
  STRIKETHROUGH: 'del',
  SUPERSCRIPT: 'sup',
  SUBSCRIPT: 'sub'
};
const headers = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6'];
function parseHtml(html) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(html, 'text/html');
  return doc.body;
}
function wrapNodeAnchor(node, href) {
  const anchor = document.createElement(ELEMENTS.ANCHOR);
  anchor.href = href;
  anchor.appendChild(node.cloneNode(true));
  return anchor;
}
function wrapNodeInline(node, style) {
  const el = document.createElement(style);
  el.appendChild(node.cloneNode(true));
  return el;
}
function wrapNode(inner, result) {
  let newNode = result.cloneNode(true);
  if (!inner) {
    return newNode;
  }
  if (inner.style && inner.style.fontWeight === GDOCS_STYLES.BOLD) {
    newNode = wrapNodeInline(newNode, ELEMENTS.BOLD);
  }
  if (inner.style && inner.style.fontStyle === GDOCS_STYLES.ITALIC) {
    newNode = wrapNodeInline(newNode, ELEMENTS.ITALIC);
  }
  if (inner.style && inner.style.textDecoration === GDOCS_STYLES.UNDERLINE) {
    newNode = wrapNodeInline(newNode, ELEMENTS.UNDERLINE);
  }
  if (inner.style && inner.style.textDecoration === GDOCS_STYLES.STRIKETHROUGH) {
    newNode = wrapNodeInline(newNode, ELEMENTS.STRIKETHROUGH);
  }
  if (inner.style && inner.style.verticalAlign === GDOCS_STYLES.SUPERSCRIPT) {
    newNode = wrapNodeInline(newNode, ELEMENTS.SUPERSCRIPT);
  }
  if (inner.style && inner.style.verticalAlign === GDOCS_STYLES.SUBSCRIPT) {
    newNode = wrapNodeInline(newNode, ELEMENTS.SUBSCRIPT);
  }
  return newNode;
}
function applyBlockStyles(dirty) {
  const node = dirty.cloneNode(true);
  let newNode = document.createTextNode(node.textContent || '');
  let styledNode = document.createTextNode('');
  if ('style' in node.childNodes[0] && Boolean(node.childNodes[0].style)) {
    styledNode = node.childNodes[0];
  }
  if (node.childNodes[0] && node.childNodes[0].nodeName === 'A') {
    newNode = wrapNodeAnchor(newNode.cloneNode(true), node.childNodes[0].href);
    styledNode = node.childNodes[0].childNodes[0];
  }
  newNode = wrapNode(styledNode, newNode);
  return newNode;
}
function applyInlineStyles(dirty) {
  const node = dirty.cloneNode(true);
  let newNode = document.createTextNode(node.textContent || '');
  let styledNode = node;
  if (node.nodeName === 'A') {
    newNode = wrapNodeAnchor(newNode, node.href);
    if ('style' in node.childNodes[0] && Boolean(node.childNodes[0].style)) {
      styledNode = node.childNodes[0];
    }
  }
  newNode = wrapNode(styledNode, newNode);
  return newNode;
}
function getCleanNode(node) {
  if (node.childNodes && (node.childNodes.length <= 1 || node.nodeName === 'OL' || node.nodeName === 'UL')) {
    let newWrapper;
    let newNode = document.createTextNode(node.textContent || '');
    if (node.nodeName === 'UL' || node.nodeName === 'OL' || node.nodeName === 'LI') {
      newWrapper = document.createElement(node.nodeName);
      newNode = document.createDocumentFragment();
      const items = [];
      for (let i = 0; i < node.childNodes.length; i++) {
        items.push(...getCleanNode(node.childNodes[i]));
      }
      items.map(i => newNode.appendChild(i));
    } else if (headers.indexOf(node.nodeName) !== -1) {
      newWrapper = document.createElement(node.nodeName);
      newNode = applyInlineStyles(node.childNodes[0]);
    } else if (node.nodeName === 'P') {
      newWrapper = document.createElement('p');
      newNode = applyBlockStyles(node);
    } else if (node.nodeName === 'BR') {
      newNode = node;
    } else {
      newWrapper = document.createElement('span');
      newNode = applyInlineStyles(node);
    }
    if (newWrapper) {
      newWrapper.appendChild(newNode);
      return [newWrapper];
    }
    return [node.cloneNode(true)];
  }
  if (node.childNodes) {
    const nodes = [];
    for (let i = 0; i < node.childNodes.length; i++) {
      nodes.push(...getCleanNode(node.childNodes[i]));
    }
    return nodes;
  }
  return [node];
}
function filterNode(node) {
  return node.nodeType !== 8; // Node.COMMENT_NODE = 8
}
function getCleanDocument(dirty) {
  const body = document.createElement('body');
  const nodes = dirty.childNodes;
  const filteredNodes = Array.from(nodes).filter(filterNode);
  const cleanNodes = [];
  for (const node of filteredNodes) {
    cleanNodes.push(...getCleanNode(node));
  }
  for (let i = 0; i < cleanNodes.length; i++) {
    body.appendChild(cleanNodes[i].cloneNode(true));
  }
  return body;
}
function cleanDocsHtml(clipboardContent) {
  if (!clipboardContent.match(GDOCS_ELEMENT_ID_REGEXP)) {
    return parseHtml(clipboardContent.replace(/(\r\n|\n|\r)/, '')).innerHTML;
  }
  return getCleanDocument(parseHtml(clipboardContent.replace(/(\r\n|\n|\r)/, ''))).innerHTML;
}

/***/ },

/***/ "./src/lib/utils.ts"
/*!**************************!*\
  !*** ./src/lib/utils.ts ***!
  \**************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   cn: () => (/* binding */ cn),
/* harmony export */   sanitizeUIMessages: () => (/* binding */ sanitizeUIMessages)
/* harmony export */ });
/* harmony import */ var clsx__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! clsx */ "./node_modules/clsx/dist/clsx.mjs");
/* harmony import */ var tailwind_merge__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tailwind-merge */ "./node_modules/tailwind-merge/dist/bundle-mjs.mjs");


function cn(...inputs) {
  return (0,tailwind_merge__WEBPACK_IMPORTED_MODULE_1__.twMerge)((0,clsx__WEBPACK_IMPORTED_MODULE_0__.clsx)(inputs));
}
function sanitizeUIMessages(messages) {
  // 对于自定义 Message 类型，过滤掉空内容的消息
  return messages.filter(message => message.content && message.content.length > 0);
}

/***/ },

/***/ "./src/types/electron.ts"
/*!*******************************!*\
  !*** ./src/types/electron.ts ***!
  \*******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ElectronAction: () => (/* binding */ ElectronAction),
/* harmony export */   ElectronEvent: () => (/* binding */ ElectronEvent)
/* harmony export */ });
let ElectronEvent = /*#__PURE__*/function (ElectronEvent) {
  ElectronEvent["FULLSCREEN_CHANGE"] = "fullscreen-change";
  ElectronEvent["UPDATE_ERROR"] = "update-error";
  ElectronEvent["UPDATE_AVAILABLE"] = "update-available";
  ElectronEvent["DEEPLINK"] = "deeplink";
  return ElectronEvent;
}({});
let ElectronAction = /*#__PURE__*/function (ElectronAction) {
  ElectronAction["GET_IS_FULLSCREEN"] = "get-is-fullscreen";
  ElectronAction["INSTALL_UPDATE"] = "install-update";
  ElectronAction["HANDLE_DOUBLE_CLICK"] = "handle-double-click";
  ElectronAction["OPEN_NEW_WINDOW"] = "open-new-window";
  ElectronAction["SET_WINDOW_TITLE"] = "set-window-title";
  ElectronAction["SET_WINDOW_BUTTONS_POSITION"] = "set-window-buttons-position";
  ElectronAction["SET_IS_AUTO_UPDATE_ENABLED"] = "set-is-auto-update-enabled";
  ElectronAction["GET_IS_AUTO_UPDATE_ENABLED"] = "get-is-auto-update-enabled";
  ElectronAction["SET_IS_TRAY_ICON_ENABLED"] = "set-is-tray-icon-enabled";
  ElectronAction["GET_IS_TRAY_ICON_ENABLED"] = "get-is-tray-icon-enabled";
  ElectronAction["RESTORE_LOCAL_STORAGE"] = "restore-local-storage";
  ElectronAction["GET_SYSTEM_LANGUAGE"] = "get-system-language";
  return ElectronAction;
}({});

/***/ },

/***/ "./src/util/AbsoluteVideo.ts"
/*!***********************************!*\
  !*** ./src/util/AbsoluteVideo.ts ***!
  \***********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ AbsoluteVideo)
/* harmony export */ });
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _safePlay__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./safePlay */ "./src/util/safePlay.ts");
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }


class AbsoluteVideo {
  constructor(videoUrl, container, options) {
    this.container = container;
    this.options = options;
    _defineProperty(this, "video", void 0);
    _defineProperty(this, "isPlaying", false);
    this.video = document.createElement('video');
    this.video.src = videoUrl;
    this.video.disablePictureInPicture = true;
    this.video.muted = true;
    if (options.style) {
      this.video.setAttribute('style', options.style);
    }
    this.video.style.position = 'absolute';
    this.video.load();
    if (!this.options.noLoop) {
      this.video.loop = true;
    }
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMutation)(() => {
      this.container.appendChild(this.video);
      this.recalculatePositionAndSize();
    });
  }
  play() {
    if (this.isPlaying || !this.video) return;
    this.recalculatePositionAndSize();
    if (this.video.paused) {
      (0,_safePlay__WEBPACK_IMPORTED_MODULE_1__["default"])(this.video);
    }
    this.isPlaying = true;
  }
  pause() {
    if (!this.isPlaying || !this.video) return;
    if (!this.video.paused) {
      this.video.pause();
    }
    this.isPlaying = false;
  }
  destroy() {
    this.pause();
    this.video?.remove();
    this.video = undefined;
  }
  updatePosition(position) {
    this.options.position = position;
    this.recalculatePositionAndSize();
  }
  recalculatePositionAndSize() {
    const {
      size,
      position: {
        x,
        y
      }
    } = this.options;
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMeasure)(() => {
      if (!this.video) return;
      const video = this.video;
      const {
        width,
        height
      } = this.container.getBoundingClientRect();
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMutation)(() => {
        video.style.left = `${Math.round(x * width)}px`;
        video.style.top = `${Math.round(y * height)}px`;
        video.style.width = `${size}px`;
        video.style.height = `${size}px`;
      });
    });
  }
}

/***/ },

/***/ "./src/util/PostMessageConnector.ts"
/*!******************************************!*\
  !*** ./src/util/PostMessageConnector.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   createConnector: () => (/* binding */ createConnector)
/* harmony export */ });
/* harmony import */ var _generateUniqueId__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./generateUniqueId */ "./src/util/generateUniqueId.ts");
/* harmony import */ var _schedulers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./schedulers */ "./src/util/schedulers.ts");
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }



// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents

class ConnectorClass {
  constructor(target, onUpdate, channel) {
    this.target = target;
    this.onUpdate = onUpdate;
    this.channel = channel;
    _defineProperty(this, "requestStates", new Map());
    _defineProperty(this, "requestStatesByCallback", new Map());
    _defineProperty(this, "pendingPayloads", []);
    _defineProperty(this, "pendingTransferables", []);
    _defineProperty(this, "postMessagesOnTickEnd", (0,_schedulers__WEBPACK_IMPORTED_MODULE_1__.throttleWithTickEnd)(() => {
      const {
        channel
      } = this;
      const payloads = this.pendingPayloads;
      const transferables = this.pendingTransferables;
      this.pendingPayloads = [];
      this.pendingTransferables = [];
      this.target.postMessage({
        channel,
        payloads
      }, transferables);
    }));
  }
  destroy() {}
  init(...args) {
    this.postMessageOnTickEnd({
      type: 'init',
      args
    });
  }
  request(messageData) {
    const {
      requestStates,
      requestStatesByCallback
    } = this;
    const {
      transferables,
      ...restMessageData
    } = messageData;
    const messageId = (0,_generateUniqueId__WEBPACK_IMPORTED_MODULE_0__["default"])();
    const payload = {
      type: 'callMethod',
      messageId,
      ...restMessageData
    };
    const requestState = {
      messageId
    };

    // Re-wrap type because of `postMessage`
    const promise = new Promise((resolve, reject) => {
      Object.assign(requestState, {
        resolve,
        reject
      });
    });
    if (typeof payload.args[payload.args.length - 1] === 'function') {
      payload.withCallback = true;
      const callback = payload.args.pop();
      requestState.callback = callback;
      requestStatesByCallback.set(callback, requestState);
    }
    requestStates.set(messageId, requestState);
    promise.catch(() => undefined).finally(() => {
      requestStates.delete(messageId);
      if (requestState.callback) {
        requestStatesByCallback.delete(requestState.callback);
      }
    });
    this.postMessageOnTickEnd(payload, transferables);
    return promise;
  }
  cancelCallback(progressCallback) {
    progressCallback.isCanceled = true;
    const {
      messageId
    } = this.requestStatesByCallback.get(progressCallback) || {};
    if (!messageId) {
      return;
    }
    this.postMessageOnTickEnd({
      type: 'cancelProgress',
      messageId
    });
  }
  onMessage(data) {
    const {
      requestStates,
      channel
    } = this;
    if (data.channel !== channel) {
      return;
    }
    data.payloads.forEach(payload => {
      if (payload.type === 'update' && this.onUpdate) {
        this.onUpdate(payload.update);
      }
      if (payload.type === 'methodResponse') {
        const requestState = requestStates.get(payload.messageId);
        if (requestState) {
          if (payload.error) {
            requestState.reject(payload.error);
          } else {
            requestState.resolve(payload.response);
          }
        }
      } else if (payload.type === 'methodCallback') {
        const requestState = requestStates.get(payload.messageId);
        requestState?.callback?.(...payload.callbackArgs);
      } else if (payload.type === 'unhandledError') {
        throw new Error(payload.error?.message);
      }
    });
  }
  postMessageOnTickEnd(payload, transferables) {
    this.pendingPayloads.push(payload);
    if (transferables) {
      this.pendingTransferables.push(...transferables);
    }
    this.postMessagesOnTickEnd();
  }
}
function createConnector(worker, onUpdate, channel) {
  const connector = new ConnectorClass(worker, onUpdate, channel);
  function handleMessage({
    data
  }) {
    connector.onMessage(data);
  }
  worker.addEventListener('message', handleMessage);
  connector.destroy = () => {
    worker.removeEventListener('message', handleMessage);
  };
  return connector;
}

/***/ },

/***/ "./src/util/audioPlayer.ts"
/*!*********************************!*\
  !*** ./src/util/audioPlayer.ts ***!
  \*********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   makeTrackId: () => (/* binding */ makeTrackId),
/* harmony export */   register: () => (/* binding */ register),
/* harmony export */   stopCurrentAudio: () => (/* binding */ stopCurrentAudio)
/* harmony export */ });
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../types */ "./src/types/index.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _keys_messageKey__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./keys/messageKey */ "./src/util/keys/messageKey.ts");
/* harmony import */ var _patchSafariProgressiveAudio__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./patchSafariProgressiveAudio */ "./src/util/patchSafariProgressiveAudio.ts");
/* harmony import */ var _safePlay__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./safePlay */ "./src/util/safePlay.ts");








const tracks = new Map();
let voiceQueue = [];
let musicQueue = [];
let currentTrackId;
function createAudio(trackId, type, onForcePlay, onTrackChange) {
  const audio = new Audio();
  function handleEvent(eventName) {
    return e => {
      if (!tracks.has(trackId)) {
        return;
      }
      if ((0,_patchSafariProgressiveAudio__WEBPACK_IMPORTED_MODULE_6__.isSafariPatchInProgress)(audio)) {
        return;
      }
      tracks.get(trackId).handlers.forEach(handler => {
        handler(eventName, e);
      });
    };
  }
  audio.addEventListener('timeupdate', handleEvent('onTimeUpdate'));
  audio.addEventListener('play', handleEvent('onPlay'));
  audio.addEventListener('pause', handleEvent('onPause'));
  audio.addEventListener('loadstart', handleEvent('onLoadStart'));
  audio.addEventListener('loadeddata', handleEvent('onLoadedData'));
  audio.addEventListener('playing', handleEvent('onPlaying'));
  audio.addEventListener('ended', () => {
    if (!tracks.has(trackId)) {
      return;
    }
    if ((0,_patchSafariProgressiveAudio__WEBPACK_IMPORTED_MODULE_6__.isSafariPatchInProgress)(audio)) {
      return;
    }
    playNext(trackId);
  });
  return {
    audio,
    type,
    proxy: new Proxy(audio, {
      get: (target, key) => target[key]
    }),
    handlers: [],
    onForcePlay,
    onTrackChange
  };
}
function playNext(trackId, isReverseOrder) {
  const currentTrack = currentTrackId && tracks.get(currentTrackId);
  if (currentTrack) {
    currentTrack.audio.pause();
    currentTrack.audio.currentTime = 0;
    if (currentTrack.onTrackChange) currentTrack.onTrackChange();
  }
  const origin = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)((0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)()).audioPlayer.origin || _types__WEBPACK_IMPORTED_MODULE_1__.AudioOrigin.Inline;
  const nextTrackId = findNextInQueue(trackId, origin, isReverseOrder);
  if (!nextTrackId) {
    return;
  }
  if (!tracks.has(nextTrackId)) {
    // A bit hacky way to continue playlist when switching chat
    (0,_global__WEBPACK_IMPORTED_MODULE_0__.getActions)().openAudioPlayer((0,_keys_messageKey__WEBPACK_IMPORTED_MODULE_5__.parseMessageKey)(splitTrackId(nextTrackId).messageKey));
    return;
  }
  const nextTrack = tracks.get(nextTrackId);
  if (nextTrack.onForcePlay) {
    nextTrack.onForcePlay();
  }
  currentTrackId = nextTrackId;
  if (nextTrack.audio.src) {
    (0,_safePlay__WEBPACK_IMPORTED_MODULE_7__["default"])(nextTrack.audio);
  }
}
function stopCurrentAudio() {
  const currentTrack = currentTrackId && tracks.get(currentTrackId);
  if (currentTrack) {
    currentTrack.audio.pause();
  }
}
function register(trackId, trackType, handler, onForcePlay, onTrackChange) {
  if (!tracks.has(trackId)) {
    const track = createAudio(trackId, trackType, onForcePlay, onTrackChange);
    tracks.set(trackId, track);
    addTrackToQueue(track, trackId);
  }
  const {
    audio,
    proxy,
    handlers
  } = tracks.get(trackId);
  handlers.push(handler);
  return {
    play(src) {
      if (!audio.paused) return;
      const currentTrack = currentTrackId && tracks.get(currentTrackId);
      if (currentTrack && currentTrackId !== trackId) {
        currentTrack.audio.pause();
        currentTrack.audio.currentTime = 0;
        if ((0,_patchSafariProgressiveAudio__WEBPACK_IMPORTED_MODULE_6__.isSafariPatchInProgress)(currentTrack.audio)) {
          currentTrack.audio.dataset.preventPlayAfterPatch = 'true';
        }
        if (currentTrack.onTrackChange) currentTrack.onTrackChange();
      }
      currentTrackId = trackId;
      if (!audio.src) {
        audio.src = src;
        audio.preload = 'auto';
        if (src.includes('/progressive/') && _browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_4__.IS_SAFARI) {
          delete audio.dataset.preventPlayAfterPatch;
          (0,_patchSafariProgressiveAudio__WEBPACK_IMPORTED_MODULE_6__.patchSafariProgressiveAudio)(audio);
        }
      }
      (0,_safePlay__WEBPACK_IMPORTED_MODULE_7__["default"])(audio);
      cleanUpQueue(trackType, trackId);
    },
    pause() {
      if (currentTrackId === trackId) {
        audio.pause();
      }
    },
    stop() {
      if (currentTrackId === trackId) {
        // Hack, reset `src` to remove default media session notification
        const prevSrc = audio.src;
        audio.pause();
        // `onPause` not called otherwise, but required to sync UI
        (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_2__.requestNextMutation)(() => {
          audio.src = '';
          audio.src = prevSrc;
        });
      }
    },
    setCurrentTime(time) {
      if (currentTrackId === trackId) {
        if (audio.fastSeek) {
          audio.fastSeek(time);
        } else {
          audio.currentTime = time;
        }
      }
    },
    setVolume(volume) {
      if (currentTrackId === trackId) {
        audio.volume = volume;
        audio.muted = false;
      }
    },
    setPlaybackRate(rate) {
      if (currentTrackId === trackId) {
        audio.playbackRate = rate;
      }
    },
    toggleMuted(muted) {
      if (muted === undefined) {
        audio.muted = !audio.muted;
      } else {
        audio.muted = muted;
      }
    },
    proxy,
    requestNextTrack() {
      playNext(trackId);
    },
    isLast() {
      return !findNextInQueue(trackId, (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)((0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)()).audioPlayer.origin);
    },
    isFirst() {
      return !findNextInQueue(trackId, (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)((0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)()).audioPlayer.origin, true);
    },
    requestPreviousTrack() {
      playNext(trackId, true);
    },
    destroy(shouldRemoveFromQueue = false) {
      const track = tracks.get(trackId);
      if (!track) {
        return;
      }
      track.handlers = track.handlers.filter(h => h !== handler);
      if (!track.handlers.length) {
        track.audio.pause();
        tracks.delete(trackId);
        if (shouldRemoveFromQueue) {
          removeFromQueue(track, trackId);
        }
        if (trackId === currentTrackId) {
          currentTrackId = undefined;
        }
      }
    }
  };
}
function getTrackQueue(track) {
  switch (track.type) {
    case 'audio':
      return musicQueue;
    case 'voice':
      return voiceQueue;
    default:
      return undefined;
  }
}
function addTrackToQueue(track, trackId) {
  if (track.type === 'audio' && !musicQueue.includes(trackId)) {
    musicQueue.push(trackId);
    musicQueue.sort(trackIdComparator);
  }
  if (track.type === 'voice' && !voiceQueue.includes(trackId)) {
    voiceQueue.push(trackId);
    voiceQueue.sort(trackIdComparator);
  }
}
function removeFromQueue(track, trackId) {
  const trackIdFilter = el => el !== trackId;
  if (track.type === 'audio') {
    musicQueue = musicQueue.filter(trackIdFilter);
  }
  if (track.type === 'voice') {
    voiceQueue = voiceQueue.filter(trackIdFilter);
  }
}
function cleanUpQueue(type, trackId) {
  if ((0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)((0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)()).globalSearch.currentContent === _types__WEBPACK_IMPORTED_MODULE_1__.GlobalSearchContent.Music) return;
  const {
    chatId
  } = (0,_keys_messageKey__WEBPACK_IMPORTED_MODULE_5__.parseMessageKey)(splitTrackId(trackId).messageKey);
  const openedChatId = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCurrentMessageList)((0,_global__WEBPACK_IMPORTED_MODULE_0__.getGlobal)())?.chatId;
  const queueFilter = id => id.startsWith(`msg${chatId}`) || openedChatId && id.startsWith(`msg${openedChatId}`);
  if (type === 'audio') {
    musicQueue = musicQueue.filter(queueFilter);
  }
  if (type === 'voice') {
    voiceQueue = voiceQueue.filter(queueFilter);
  }
}
function findNextInQueue(currentId, origin = _types__WEBPACK_IMPORTED_MODULE_1__.AudioOrigin.Inline, isReverseOrder) {
  const track = tracks.get(currentId);
  const queue = getTrackQueue(track);
  if (!queue) return undefined;
  if (origin === _types__WEBPACK_IMPORTED_MODULE_1__.AudioOrigin.Search) {
    const index = queue.indexOf(currentId);
    if (index < 0) return undefined;
    const direction = isReverseOrder ? -1 : 1;
    return queue[index + direction];
  }
  const {
    chatId
  } = (0,_keys_messageKey__WEBPACK_IMPORTED_MODULE_5__.parseMessageKey)(splitTrackId(currentId).messageKey);
  const chatAudio = queue.filter(id => id.startsWith(`msg${chatId}`));
  const index = chatAudio.indexOf(currentId);
  if (index < 0) return undefined;
  let direction = origin === _types__WEBPACK_IMPORTED_MODULE_1__.AudioOrigin.Inline ? -1 : 1;
  if (isReverseOrder) direction *= -1;
  return chatAudio[index + direction];
}
function makeTrackId(message) {
  const key = (0,_keys_messageKey__WEBPACK_IMPORTED_MODULE_5__.getMessageServerKey)(message);
  if (!key) {
    return undefined;
  }
  return `${key}-${message.date}`;
}
function splitTrackId(trackId) {
  const messageKey = trackId.match(/^msg(-?\d+)-(\d+)/)[0];
  const date = Number(trackId.split('-').pop());
  return {
    messageKey,
    date
  };
}

// Descending order by date
function trackIdComparator(one, two) {
  if (!one || !two) return 0;
  const {
    date: dateOne,
    messageKey: keyOne
  } = splitTrackId(one);
  const {
    date: dateTwo,
    messageKey: keyTwo
  } = splitTrackId(two);
  const diff = dateTwo - dateOne;
  return diff === 0 ? keyTwo.localeCompare(keyOne) : diff;
}

/***/ },

/***/ "./src/util/cycleRestrict.ts"
/*!***********************************!*\
  !*** ./src/util/cycleRestrict.ts ***!
  \***********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ cycleRestrict)
/* harmony export */ });
function cycleRestrict(length, index) {
  return index - Math.floor(index / length) * length;
}

/***/ },

/***/ "./src/util/dates/workHours.ts"
/*!*************************************!*\
  !*** ./src/util/dates/workHours.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getUtcOffset: () => (/* binding */ getUtcOffset),
/* harmony export */   getWeekStart: () => (/* binding */ getWeekStart),
/* harmony export */   shiftTimeRanges: () => (/* binding */ shiftTimeRanges),
/* harmony export */   splitDays: () => (/* binding */ splitDays)
/* harmony export */ });
const DAY_MINUTES = 1440;
const WEEK_MINUTES = 10080;

/**
 * @returns Monday 00:00 of the current week for the local timezone
 */
function getWeekStart() {
  const now = new Date();
  now.setHours(0, 0, 0, 0);
  const day = now.getDay();
  const diff = now.getDate() - day + (day === 0 ? -6 : 1);
  return new Date(now.setDate(diff)).getTime();
}

/**
 * @returns UTC offset in seconds
 */
function getUtcOffset() {
  return new Date().getTimezoneOffset() * -60;
}
function shiftTimeRanges(ranges, shift) {
  if (shift === 0) return ranges;
  const shiftedRanges = [];
  for (const range of ranges) {
    let start = (range.startMinute + shift) % WEEK_MINUTES;
    let end = (range.endMinute + shift) % WEEK_MINUTES;
    if (start < 0) start += WEEK_MINUTES;
    if (end <= 0) end += WEEK_MINUTES;
    if (start > end) {
      shiftedRanges.push({
        startMinute: start,
        endMinute: WEEK_MINUTES - 1
      });
      shiftedRanges.push({
        startMinute: 0,
        endMinute: end
      });
    } else {
      shiftedRanges.push({
        startMinute: start,
        endMinute: end
      });
    }
  }
  shiftedRanges.sort((a, b) => a.startMinute - b.startMinute);

  // Combine overlapping ranges
  return shiftedRanges.reduce((acc, range) => {
    const last = acc[acc.length - 1];
    if (last && last.endMinute >= range.startMinute) {
      last.endMinute = Math.max(last.endMinute, range.endMinute);
    } else {
      acc.push(range);
    }
    return acc;
  }, []);
}
function splitDays(ranges) {
  const days = {};
  for (const range of ranges) {
    const start = range.startMinute;
    const end = range.endMinute;
    const dayStart = Math.floor(start / DAY_MINUTES);
    const dayEnd = Math.floor((end - 1) / DAY_MINUTES); // 00:00 is counted as same day

    for (let day = dayStart; day <= dayEnd; day++) {
      if (!days[day]) {
        days[day] = [];
      }
      days[day].push({
        startMinute: Math.max(0, start - day * DAY_MINUTES),
        endMinute: Math.min(DAY_MINUTES, end - day * DAY_MINUTES)
      });
    }
  }
  return days;
}

/***/ },

/***/ "./src/util/deleteLastCharacterOutsideSelection.ts"
/*!*********************************************************!*\
  !*** ./src/util/deleteLastCharacterOutsideSelection.ts ***!
  \*********************************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ deleteLastCharacterOutsideSelection)
/* harmony export */ });
function deleteLastCharacterOutsideSelection(html) {
  const tempInput = document.createElement('div');
  tempInput.contentEditable = 'true';
  tempInput.style.position = 'absolute';
  tempInput.style.left = '-10000px';
  tempInput.style.top = '-10000px';
  tempInput.innerHTML = html;
  tempInput.className = 'allow-selection'; // Patch for Safari
  document.body.appendChild(tempInput);
  let element = tempInput.lastChild;
  if (element.lastChild) {
    // Selects the last and the deepest child of the element.
    while (element.lastChild) {
      element = element.lastChild;
    }
  }

  // Gets length of the element's content.
  const textLength = element.textContent.length;
  const range = document.createRange();
  const selection = window.getSelection();

  // Sets selection position to the end of the element.
  range.setStart(element, textLength);
  range.setEnd(element, textLength);
  selection.removeAllRanges();
  selection.addRange(range);
  document.execCommand('delete', false);
  const result = tempInput.innerHTML;
  document.body.removeChild(tempInput);
  return result;
}

/***/ },

/***/ "./src/util/download.ts"
/*!******************************!*\
  !*** ./src/util/download.ts ***!
  \******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ download)
/* harmony export */ });
/* harmony import */ var _schedulers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./schedulers */ "./src/util/schedulers.ts");

// Chrome prevents more than 10 downloads per second
const LIMIT_PER_BATCH = 10;
const BATCH_INTERVAL = 1000;
let pendingDownloads = [];
let planned = false;
function download(url, filename) {
  pendingDownloads.push({
    url,
    filename
  });
  if (!planned) {
    planned = true;
    setTimeout(async () => {
      await processQueue();
      planned = false;
    }, BATCH_INTERVAL);
  }
}
async function processQueue() {
  let count = 0;
  for (const pendingDownload of pendingDownloads) {
    downloadOne(pendingDownload);
    count++;
    if (count === LIMIT_PER_BATCH) {
      await (0,_schedulers__WEBPACK_IMPORTED_MODULE_0__.pause)(BATCH_INTERVAL);
      count = 0;
    }
  }
  pendingDownloads = [];
}
function downloadOne({
  url,
  filename
}) {
  const link = document.createElement('a');
  link.href = url;
  link.target = '_blank';
  link.rel = 'noopener noreferrer';
  link.download = filename;
  try {
    link.click();
  } catch (err) {
    // eslint-disable-next-line no-console
    console.error(err); // Suppress redundant "Blob loading failed" error popup on IOS
  }
}

/***/ },

/***/ "./src/util/focusEditableElement.ts"
/*!******************************************!*\
  !*** ./src/util/focusEditableElement.ts ***!
  \******************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ focusEditableElement)
/* harmony export */ });
/* harmony import */ var _browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");

function focusEditableElement(element, force, forcePlaceCaretAtEnd) {
  if (!force && element === document.activeElement) {
    return;
  }
  const selection = window.getSelection();
  const range = document.createRange();
  const lastChild = element.lastChild || element;
  if (!_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_TOUCH_ENV && !forcePlaceCaretAtEnd && (!lastChild || !lastChild.nodeValue)) {
    element.focus();
    return;
  }
  range.selectNodeContents(forcePlaceCaretAtEnd ? element : lastChild);
  // `false` means collapse to the end rather than the start
  range.collapse(false);
  selection.removeAllRanges();
  selection.addRange(range);
}

/***/ },

/***/ "./src/util/formatTemperature.ts"
/*!***************************************!*\
  !*** ./src/util/formatTemperature.ts ***!
  \***************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   formatTemperature: () => (/* binding */ formatTemperature)
/* harmony export */ });
const formatTemperature = temperatureC => {
  const isFahrenheit = Boolean(navigator.language === 'en-US');
  return isFahrenheit ? `${Math.round(temperatureC * 9 / 5 + 32)}°F` : `${Math.round(temperatureC)}°C`;
};

/***/ },

/***/ "./src/util/languageDetection.ts"
/*!***************************************!*\
  !*** ./src/util/languageDetection.ts ***!
  \***************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   detectLanguage: () => (/* binding */ detectLanguage),
/* harmony export */   detectLanguageProbability: () => (/* binding */ detectLanguageProbability)
/* harmony export */ });
/* harmony import */ var _browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./browser/windowEnvironment */ "./src/util/browser/windowEnvironment.ts");
/* harmony import */ var _Deferred__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Deferred */ "./src/util/Deferred.ts");
/* harmony import */ var _PostMessageConnector__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PostMessageConnector */ "./src/util/PostMessageConnector.ts");



const WORKER_INIT_DELAY = 4000;
const DEFAULT_THRESHOLD = 0.2;
const DEFAULT_LABELS_COUNT = 5;
let worker;
const initializationDeferred = new _Deferred__WEBPACK_IMPORTED_MODULE_1__["default"]();
if (_browser_windowEnvironment__WEBPACK_IMPORTED_MODULE_0__.IS_TRANSLATION_SUPPORTED) {
  setTimeout(initWorker, WORKER_INIT_DELAY);
}
function initWorker() {
  if (!worker) {
    worker = (0,_PostMessageConnector__WEBPACK_IMPORTED_MODULE_2__.createConnector)(new Worker(new URL(/* worker import */ __webpack_require__.p + __webpack_require__.u("src_lib_fasttextweb_fasttext_worker_ts"), __webpack_require__.b)));
    initializationDeferred.resolve();
  }
}
async function detectLanguage(text, threshold = DEFAULT_THRESHOLD) {
  if (!worker) await initializationDeferred.promise;
  const result = await worker.request({
    name: 'detectLanguage',
    args: [text, threshold]
  });
  return result;
}
async function detectLanguageProbability(text, labelsCount = DEFAULT_LABELS_COUNT, threshold = DEFAULT_THRESHOLD) {
  if (!worker) await initializationDeferred.promise;
  const result = await worker.request({
    name: 'detectLanguageProbability',
    args: [text, labelsCount, threshold]
  });
  return result;
}

/***/ },

/***/ "./src/util/launchMediaWorkers.ts"
/*!****************************************!*\
  !*** ./src/util/launchMediaWorkers.ts ***!
  \****************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MAX_WORKERS: () => (/* binding */ MAX_WORKERS),
/* harmony export */   "default": () => (/* binding */ launchMediaWorkers),
/* harmony export */   requestMediaWorker: () => (/* binding */ requestMediaWorker)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../config */ "./src/config.ts");
/* harmony import */ var _PostMessageConnector__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./PostMessageConnector */ "./src/util/PostMessageConnector.ts");


const MAX_WORKERS = Math.min(navigator.hardwareConcurrency || 4, 4);
let instances;
function launchMediaWorkers() {
  if (_config__WEBPACK_IMPORTED_MODULE_0__.IS_TEST) return [];
  if (!instances) {
    instances = new Array(MAX_WORKERS).fill(undefined).map(() => {
      const worker = new Worker(new URL(/* worker import */ __webpack_require__.p + __webpack_require__.u("src_lib_mediaWorker_index_worker_ts"), __webpack_require__.b));
      const connector = (0,_PostMessageConnector__WEBPACK_IMPORTED_MODULE_1__.createConnector)(worker, undefined, 'media');
      return {
        worker,
        connector
      };
    });
  }
  return instances;
}
function requestMediaWorker(payload, index) {
  return launchMediaWorkers()[index].connector.request(payload);
}

/***/ },

/***/ "./src/util/map.ts"
/*!*************************!*\
  !*** ./src/util/map.ts ***!
  \*************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getMetersPerPixel: () => (/* binding */ getMetersPerPixel),
/* harmony export */   getVenueColor: () => (/* binding */ getVenueColor),
/* harmony export */   getVenueIconUrl: () => (/* binding */ getVenueIconUrl),
/* harmony export */   prepareMapUrl: () => (/* binding */ prepareMapUrl)
/* harmony export */ });
const PROVIDERS = {
  google: 'https://maps.google.com/maps',
  bing: 'https://bing.com/maps/default.aspx',
  osm: 'https://www.openstreetmap.org',
  apple: 'https://maps.apple.com'
};

// https://github.com/TelegramMessenger/Telegram-iOS/blob/2a32c871882c4e1b1ccdecd34fccd301723b30d9/submodules/LocationResources/Sources/VenueIconResources.swift#L82
const VENUE_COLORS = new Map(Object.entries({
  'building/medical': '#43b3f4',
  'building/gym': '#43b3f4',
  'education/cafeteria': '#f7943f',
  'travel/bedandbreakfast': '#9987ff',
  'travel/hotel': '#9987ff',
  'travel/hostel': '#9987ff',
  'travel/resort': '#9987ff',
  'travel/hotel_bar': '#e56dd6',
  arts_entertainment: '#e56dd6',
  building: '#6e81b2',
  education: '#a57348',
  event: '#959595',
  food: '#f7943f',
  home: '#00aeef',
  nightlife: '#e56dd6',
  parks_outdoors: '#6cc039',
  shops: '#ffb300',
  travel: '#1c9fff',
  work: '#ad7854'
}));
const RANDOM_COLORS = ['#e56cd5', '#f89440', '#9986ff', '#44b3f5', '#6dc139', '#ff5d5a', '#f87aad', '#6e82b3', '#f5ba21'];
function prepareMapUrl(provider, point, zoom = 15) {
  const {
    lat,
    long
  } = point;
  const providerUrl = PROVIDERS[provider];
  switch (provider) {
    case 'google':
      return `${providerUrl}/place/${lat}+${long}/@${lat},${long},${zoom}z`;
    case 'bing':
      return `${providerUrl}?cp=${lat}~${long}&lvl=${zoom}&sp=point.${lat}_${long}`;
    case 'apple':
      return `${providerUrl}?q=${lat},${long}`;
    case 'osm':
    default:
      return `${providerUrl}/?mlat=${lat}&mlon=${long}&zoom=${zoom}`;
  }
}
function getMetersPerPixel(lat, zoom) {
  // https://groups.google.com/g/google-maps-js-api-v3/c/hDRO4oHVSeM/m/osOYQYXg2oUJ
  return 156543.03392 * Math.cos(lat * (Math.PI / 180)) / 2 ** zoom;
}
function getVenueIconUrl(type) {
  if (!type) return '';
  return `https://ss3.4sqi.net/img/categories_v2/${type}_88.png`;
}

// https://github.com/TelegramMessenger/Telegram-iOS/blob/2a32c871882c4e1b1ccdecd34fccd301723b30d9/submodules/LocationResources/Sources/VenueIconResources.swift#L104
function getVenueColor(type) {
  if (!type) return '#008df2';
  return VENUE_COLORS.get(type) || VENUE_COLORS.get(type.split('/')[0]) || RANDOM_COLORS[stringToNumber(type) % RANDOM_COLORS.length];
}
function stringToNumber(str) {
  return str.split('').reduce((prevHash, currVal) => (prevHash << 5) - prevHash + currVal.charCodeAt(0) | 0, 0);
}

/***/ },

/***/ "./src/util/mediaSession.ts"
/*!**********************************!*\
  !*** ./src/util/mediaSession.ts ***!
  \**********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   buildMediaMetadata: () => (/* binding */ buildMediaMetadata),
/* harmony export */   clearMediaSession: () => (/* binding */ clearMediaSession),
/* harmony export */   registerMediaSession: () => (/* binding */ registerMediaSession),
/* harmony export */   setMediaSessionHandlers: () => (/* binding */ setMediaSessionHandlers),
/* harmony export */   setPlaybackState: () => (/* binding */ setPlaybackState),
/* harmony export */   setPositionState: () => (/* binding */ setPositionState),
/* harmony export */   updateMetadata: () => (/* binding */ updateMetadata)
/* harmony export */ });
const DEFAULT_HANDLERS = {
  play: undefined,
  pause: undefined,
  seekbackward: undefined,
  seekforward: undefined,
  previoustrack: undefined,
  nexttrack: undefined,
  stop: undefined,
  seekTo: undefined
};
function registerMediaSession(metadata, handlers) {
  const {
    mediaSession
  } = window.navigator;
  if (mediaSession) {
    if (metadata) updateMetadata(metadata);
    if (handlers) setMediaSessionHandlers(handlers);
  } else {
    // eslint-disable-next-line no-console
    console.warn('MediaSession API not supported in this browser');
  }
}
function updateMetadata(metadata) {
  const {
    mediaSession
  } = window.navigator;
  if (mediaSession) {
    // eslint-disable-next-line no-null/no-null
    mediaSession.metadata = metadata ?? null;
  }
}
function setMediaSessionHandlers(handlers) {
  const {
    mediaSession
  } = window.navigator;
  if (mediaSession) {
    Object.entries({
      ...DEFAULT_HANDLERS,
      ...handlers
    }).forEach(([key, handler]) => {
      try {
        // @ts-ignore API not standardized yet
        mediaSession.setActionHandler(key, handler);
      } catch (err) {
        // Handler not supported, ignoring
      }
    });
  }
}
function clearMediaSession() {
  const {
    mediaSession
  } = window.navigator;
  if (mediaSession) {
    // eslint-disable-next-line no-null/no-null
    mediaSession.metadata = null;
    setMediaSessionHandlers(DEFAULT_HANDLERS);
    if (mediaSession.playbackState) mediaSession.playbackState = 'none';
    mediaSession.setPositionState?.();
  }
}
function setPlaybackState(state = 'none') {
  const {
    mediaSession
  } = window.navigator;
  if (mediaSession && mediaSession.playbackState) {
    mediaSession.playbackState = state;
  }
}
function setPositionState(state) {
  if (!state || state.position === undefined || state.duration === undefined) return;
  state.position = Math.min(state.position, state.duration);
  const {
    mediaSession
  } = window.navigator;
  mediaSession?.setPositionState?.(state);
}
function buildMediaMetadata({
  title,
  artist,
  album,
  artwork
}) {
  if ('MediaMetadata' in window) {
    return new window.MediaMetadata({
      title,
      artist,
      album,
      artwork
    });
  }
  return undefined;
}

/***/ },

/***/ "./src/util/memoized.ts"
/*!******************************!*\
  !*** ./src/util/memoized.ts ***!
  \******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ memoized)
/* harmony export */ });
/* harmony import */ var _iteratees__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./iteratees */ "./src/util/iteratees.ts");

const cache = new WeakMap();
function memoized(fn) {
  return (...args) => {
    const cached = cache.get(fn);
    if (cached && (0,_iteratees__WEBPACK_IMPORTED_MODULE_0__.areSortedArraysEqual)(cached.lastArgs, args)) {
      return cached.lastResult;
    }
    const result = fn(...args);
    cache.set(fn, {
      lastArgs: args,
      lastResult: result
    });
    return result;
  };
}

/***/ },

/***/ "./src/util/parseHotkey.ts"
/*!*********************************!*\
  !*** ./src/util/parseHotkey.ts ***!
  \*********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getHotkeyMatcher: () => (/* binding */ getHotkeyMatcher),
/* harmony export */   parseHotkey: () => (/* binding */ parseHotkey)
/* harmony export */ });
// Original source from Mantine
// https://github.com/mantinedev/mantine/blob/master/src/mantine-hooks/src/use-hotkeys/parse-hotkey.ts

function parseHotkey(hotkey) {
  const keys = hotkey.toLowerCase().split('+').map(part => part.trim());
  const modifiers = {
    alt: keys.includes('alt'),
    ctrl: keys.includes('ctrl'),
    meta: keys.includes('meta'),
    mod: keys.includes('mod'),
    shift: keys.includes('shift')
  };
  const reservedKeys = ['alt', 'ctrl', 'meta', 'shift', 'mod'];
  const freeKey = keys.find(key => !reservedKeys.includes(key));
  return {
    ...modifiers,
    key: freeKey
  };
}
function isExactHotkey(hotkey, event) {
  const {
    alt,
    ctrl,
    meta,
    mod,
    shift,
    key
  } = hotkey;
  const {
    altKey,
    ctrlKey,
    metaKey,
    shiftKey,
    key: pressedKey
  } = event;
  if (alt !== altKey) {
    return false;
  }
  if (mod) {
    if (!ctrlKey && !metaKey) {
      return false;
    }
  } else {
    if (ctrl !== ctrlKey) {
      return false;
    }
    if (meta !== metaKey) {
      return false;
    }
  }
  if (shift !== shiftKey) {
    return false;
  }
  return Boolean(key && (pressedKey.toLowerCase() === key.toLowerCase() || event.code.replace('Key', '').toLowerCase() === key.toLowerCase()));
}
function getHotkeyMatcher(hotkey) {
  return event => isExactHotkey(parseHotkey(hotkey), event);
}

/***/ },

/***/ "./src/util/progressiveLoader.ts"
/*!***************************************!*\
  !*** ./src/util/progressiveLoader.ts ***!
  \***************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   makeProgressiveLoader: () => (/* binding */ makeProgressiveLoader)
/* harmony export */ });
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../api/gramjs */ "./src/api/gramjs/index.ts");


const MB = 1024 * 1024;
const DEFAULT_PART_SIZE = 0.25 * MB;
const MAX_END_TO_CACHE = 5 * MB - 1; // We only cache the first 2 MB of each file

const bufferCache = new Map();
const sizeCache = new Map();
const pendingRequests = new Map();
async function* makeProgressiveLoader(url, start = 0, chunkSize = DEFAULT_PART_SIZE) {
  const match = url.match(/fileSize=(\d+)/);
  let fileSize;
  if (match) {
    fileSize = match && Number(match[1]);
  } else {
    fileSize = sizeCache.get(url);
  }
  while (true) {
    if (fileSize && start >= fileSize) return;
    let end = start + chunkSize - 1;
    if (fileSize && end > fileSize) {
      end = fileSize - 1;
    }

    // Check if we have the chunk in memory
    const cacheKey = `${url}:${start}-${end}`;
    let arrayBuffer = bufferCache.get(cacheKey);
    if (!arrayBuffer) {
      let request = pendingRequests.get(cacheKey);
      if (!request) {
        request = (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('downloadMedia', {
          mediaFormat: _api_types__WEBPACK_IMPORTED_MODULE_0__.ApiMediaFormat.Progressive,
          url,
          start,
          end
        });
        pendingRequests.set(cacheKey, request);
      }
      const result = await request.finally(() => {
        pendingRequests.delete(cacheKey);
      });
      if (!result?.arrayBuffer) return;

      // If fileSize is not yet defined, retrieve it from the first chunk's response
      if (result.fullSize && !fileSize) {
        fileSize = result.fullSize;
        sizeCache.set(url, result.fullSize);
      }

      // Store the chunk in memory
      arrayBuffer = result.arrayBuffer;

      // Cache the first 2 MB of each file
      if (end <= MAX_END_TO_CACHE) {
        bufferCache.set(cacheKey, result.arrayBuffer);
      }
    }

    // Yield the chunk data
    yield arrayBuffer;
    start = end + 1;
  }
}

/***/ },

/***/ "./src/util/selection.ts"
/*!*******************************!*\
  !*** ./src/util/selection.ts ***!
  \*******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getCaretPosition: () => (/* binding */ getCaretPosition),
/* harmony export */   getHtmlBeforeSelection: () => (/* binding */ getHtmlBeforeSelection),
/* harmony export */   insertHtmlInSelection: () => (/* binding */ insertHtmlInSelection),
/* harmony export */   removeAllSelections: () => (/* binding */ removeAllSelections),
/* harmony export */   setCaretPosition: () => (/* binding */ setCaretPosition)
/* harmony export */ });
const extractorEl = document.createElement('div');
function insertHtmlInSelection(html) {
  const selection = window.getSelection();
  if (selection?.getRangeAt && selection.rangeCount) {
    const range = selection.getRangeAt(0);
    range.deleteContents();
    const fragment = range.createContextualFragment(html);
    const lastInsertedNode = fragment.lastChild;
    range.insertNode(fragment);
    if (lastInsertedNode) {
      range.setStartAfter(lastInsertedNode);
      range.setEndAfter(lastInsertedNode);
    } else {
      range.collapse(false);
    }
    selection.removeAllRanges();
    selection.addRange(range);
  }
}
function getHtmlBeforeSelection(container, useCommonAncestor) {
  if (!container) {
    return '';
  }
  const sel = window.getSelection();
  if (!sel || !sel.rangeCount) {
    return container.innerHTML;
  }
  const range = sel.getRangeAt(0).cloneRange();
  if (!range.intersectsNode(container)) {
    return container.innerHTML;
  }
  if (!useCommonAncestor && !container.contains(range.commonAncestorContainer)) {
    return '';
  }
  range.collapse(true);
  range.setStart(container, 0);
  extractorEl.innerHTML = '';
  extractorEl.appendChild(range.cloneContents());
  return extractorEl.innerHTML;
}

// https://stackoverflow.com/a/3976125
function getCaretPosition(element) {
  let caretPosition = 0;
  const selection = window.getSelection();
  if (!selection || selection.rangeCount === 0) {
    return caretPosition;
  }
  const range = selection.getRangeAt(0);
  const caretRange = range.cloneRange();
  caretRange.selectNodeContents(element);
  caretRange.setEnd(range.endContainer, range.endOffset);
  caretPosition = caretRange.toString().length;
  return caretPosition;
}

// https://stackoverflow.com/a/36953852
function setCaretPosition(element, position) {
  for (const node of element.childNodes) {
    if (node.nodeType === Node.TEXT_NODE) {
      if (node.length >= position) {
        const range = document.createRange();
        const selection = window.getSelection();
        range.setStart(node, position);
        range.collapse(true);
        selection.removeAllRanges();
        selection.addRange(range);
        return -1;
      } else {
        position -= 'length' in node ? node.length : 0;
      }
    } else {
      position = setCaretPosition(node, position);
      if (position === -1) {
        return -1;
      }
    }
  }
  return position;
}
function removeAllSelections() {
  const selection = window.getSelection();
  selection?.removeAllRanges();
}

/***/ },

/***/ "./src/util/systemFilesDialog.ts"
/*!***************************************!*\
  !*** ./src/util/systemFilesDialog.ts ***!
  \***************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   openSystemFilesDialog: () => (/* binding */ openSystemFilesDialog)
/* harmony export */ });
let fileSelector;
function openSystemFilesDialog(accept = '*', callback, noMultiple = false) {
  if (!fileSelector) {
    fileSelector = document.createElement('input');
    fileSelector.setAttribute('type', 'file');
  }
  fileSelector.setAttribute('accept', accept);
  if (noMultiple) {
    fileSelector.removeAttribute('multiple');
  } else {
    fileSelector.setAttribute('multiple', 'multiple');
  }

  // eslint-disable-next-line no-null/no-null
  fileSelector.onchange = null;
  fileSelector.value = '';
  fileSelector.onchange = callback;
  fileSelector.click();
}

/***/ },

/***/ "./src/util/voiceRecording.ts"
/*!************************************!*\
  !*** ./src/util/voiceRecording.ts ***!
  \************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   init: () => (/* binding */ init),
/* harmony export */   start: () => (/* binding */ start)
/* harmony export */ });
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");

const encoderPath = new URL(/* asset import */ __webpack_require__(/*! opus-recorder/dist/encoderWorker.min */ "./node_modules/opus-recorder/dist/encoderWorker.min.js"), __webpack_require__.b).href;
const MIN_RECORDING_TIME = 1000;
const POLYFILL_OPTIONS = {
  encoderPath,
  reuseWorker: true
};
const BLOB_PARAMS = {
  type: 'audio/ogg'
};
const FFT_SIZE = 64;
const MIN_VOLUME = 0.1;
let opusRecorderPromise;
let OpusRecorder;
let mediaRecorder;
async function init() {
  // eslint-disable-next-line @typescript-eslint/no-misused-promises
  if (!opusRecorderPromise) {
    opusRecorderPromise = __webpack_require__.e(/*! import() */ "node_modules_opus-recorder_dist_recorder_min_js").then(__webpack_require__.t.bind(__webpack_require__, /*! opus-recorder */ "./node_modules/opus-recorder/dist/recorder.min.js", 23));
    OpusRecorder = (await opusRecorderPromise).default;
    mediaRecorder = new OpusRecorder(POLYFILL_OPTIONS);
  }
  return opusRecorderPromise;
}
async function start(analyzerCallback) {
  await startMediaRecorder();
  const startedAt = Date.now();
  let pausedAt;
  const chunks = [];
  const waveform = [];
  mediaRecorder.ondataavailable = typedArray => {
    chunks.push(typedArray);
  };
  const releaseAnalyzer = subscribeToAnalyzer(mediaRecorder, volume => {
    waveform.push(volume * 255);
    analyzerCallback(volume);
  });
  return {
    stop: () => new Promise((resolve, reject) => {
      mediaRecorder.onstop = () => {
        resolve({
          blob: new Blob(chunks, BLOB_PARAMS),
          duration: Math.round(((pausedAt || Date.now()) - startedAt) / 1000),
          waveform
        });
      };
      mediaRecorder.onerror = reject;
      const delayStop = Math.max(0, startedAt + MIN_RECORDING_TIME - Date.now());
      setTimeout(() => {
        mediaRecorder.stop();
        releaseAnalyzer();
      }, delayStop);
    }),
    pause: () => {
      const delayStop = Math.max(0, startedAt + MIN_RECORDING_TIME - Date.now());
      setTimeout(() => {
        mediaRecorder.pause();
        pausedAt = Date.now();
        releaseAnalyzer();
      }, delayStop);
    }
  };
}
async function startMediaRecorder() {
  await init();
  await mediaRecorder.start();
}
function subscribeToAnalyzer(recorder, cb) {
  const source = recorder.sourceNode;
  const analyser = source.context.createAnalyser();
  analyser.fftSize = FFT_SIZE;
  source.connect(analyser);
  const dataLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(dataLength);
  let isDestroyed = false;
  function tick() {
    if (isDestroyed) {
      return;
    }
    analyser.getByteFrequencyData(dataArray);
    const sum = dataArray.reduce((acc, current) => acc + current, 0);
    const mean = sum / dataLength;
    const volume = mean / 255;
    cb(volume < MIN_VOLUME ? 0 : volume);
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_0__.requestMeasure)(tick);
  }
  tick();
  return () => {
    isDestroyed = true;
  };
}

/***/ },

/***/ "./src/util/waveform.ts"
/*!******************************!*\
  !*** ./src/util/waveform.ts ***!
  \******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   decodeWaveform: () => (/* binding */ decodeWaveform),
/* harmony export */   interpolateArray: () => (/* binding */ interpolateArray)
/* harmony export */ });
// Ref: https://github.com/telegramdesktop/tdesktop/blob/0743e71ab6b928d2ee5bae1aed991849b1e2b291/Telegram/SourceFiles/data/data_document.cpp#L1018
function decodeWaveform(encoded5bit) {
  const bitsCount = encoded5bit.length * 8;
  const valuesCount = Math.floor(bitsCount / 5);
  if (!valuesCount) {
    return [];
  }

  // Read each 5 bit of encoded5bit as 0-31 unsigned char.
  // We count the index of the byte in which the desired 5-bit sequence starts.
  // And then we read a uint16 starting from that byte to guarantee to get all of those 5 bits.
  //
  // BUT! if it is the last byte we have, we're not allowed to read a uint16 starting with it.
  // Because it will be an overflow (we'll access one byte after the available memory).
  // We see, that only the last 5 bits could start in the last available byte and be problematic.
  // So we read in a general way all the entries in a general way except the last one.
  const result = Array(valuesCount);
  const bitsData = encoded5bit;
  for (let i = 0, l = valuesCount - 1; i !== l; ++i) {
    const byteIndex = Math.floor(i * 5 / 8);
    const bitShift = Math.floor(i * 5 % 8);
    const value = bitsData[byteIndex] + (bitsData[byteIndex + 1] << 8);
    result[i] = value >> bitShift & 0x1F;
  }
  const lastByteIndex = Math.floor((valuesCount - 1) * 5 / 8);
  const lastBitShift = Math.floor((valuesCount - 1) * 5 % 8);
  const lastValue = bitsData[lastByteIndex] + (bitsData[lastByteIndex + 1] << 8);
  result[valuesCount - 1] = lastValue >> lastBitShift & 0x1F;
  return result;
}
function interpolateArray(data, fitCount) {
  let peak = 0;
  const newData = new Array(fitCount);
  const springFactor = data.length / fitCount;
  const leftFiller = data[0];
  const rightFiller = data[data.length - 1];
  for (let i = 0; i < fitCount; i++) {
    const idx = Math.floor(i * springFactor);
    const val = ((data[idx - 1] ?? leftFiller) + (data[idx] ?? leftFiller) + (data[idx + 1] ?? rightFiller)) / 3;
    newData[i] = val;
    if (peak < val) {
      peak = val;
    }
  }
  return {
    data: newData,
    peak
  };
}

/***/ }

}]);
//# sourceMappingURL=src_components_chatAssistant_agent_useAgentChat_ts-src_components_chatAssistant_component_AIT-1ec862.7d33cbd3708c86fb47f5.js.map